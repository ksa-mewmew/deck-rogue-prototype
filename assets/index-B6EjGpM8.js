(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();function or(){const e=document.documentElement,t=180,n=5,r=7,o=3;let a=0;const s=()=>{a=0;const d=getComputedStyle(e),l=window.innerWidth,h=window.innerHeight,f=parseFloat(d.getPropertyValue("--hudH"))||140,p=parseFloat(d.getPropertyValue("--dockH"))||210,k=parseFloat(d.getPropertyValue("--uiGap"))||16,A=parseFloat(d.getPropertyValue("--edgePad"))||14,u=parseFloat(d.getPropertyValue("--logW"))||360,c=parseFloat(d.getPropertyValue("--logGap"))||14,y=parseFloat(d.getPropertyValue("--playerW"))||320,T=parseFloat(d.getPropertyValue("--slotGapXBase"))||22,b=parseFloat(d.getPropertyValue("--slotGapYBase"))||6,E=Math.max(320,l-(y+u+c*2+A*2)),w=Math.max(260,h-(f+p+k)),v=o*t+(o-1)*T,_=t*(r/n),g=parseFloat(d.getPropertyValue("--battleChromeHBase"))||140,B=_*2+b+g,O=E/v,D=w/B,L=Math.min(O,D),F=Math.max(.55,Math.min(L,1.25));e.style.setProperty("--u",String(F))},i=()=>{a||(a=requestAnimationFrame(s))};window.addEventListener("resize",i,{passive:!0}),s()}function ar(){let e=!1;const t=()=>{const o=window.innerWidth;!e&&o<1180&&(e=!0),e&&o>1220&&(e=!1),document.body.classList.toggle("compact",e)};let n=0;const r=()=>{n||(n=requestAnimationFrame(()=>{n=0,t()}))};window.addEventListener("resize",r,{passive:!0}),t()}function ut(e){return[{id:"A",type:e[0]},{id:"B",type:e[1]}]}function Me(e,t,n,r,o="SYSTEM"){r&&o==="PLAYER"&&t==="bleed"&&Number(r._bleedBonusPerApply??0),e.status[t]=Math.max(0,(e.status[t]??0)+n)}function Qe(e){const t=ut(pt(e)),n=ut(pt(e)),r=ut(pt(e));return{root:t,nextIfA:n,nextIfB:r}}function sr(e,t){e.run.branchOffer||(e.run.branchOffer=Qe(e));const n=e.run.branchOffer,r=t==="A"?n.nextIfA:n.nextIfB,o=Qe(e);e.run.branchOffer={root:r,nextIfA:o.nextIfA,nextIfB:o.nextIfB}}function Lt(e,t=0){return e<t?t:e}function Mt(e){const t=[...e];for(let n=t.length-1;n>0;n--){const r=Math.floor(Math.random()*(n+1));[t[n],t[r]]=[t[r],t[n]]}return t}function G(e,t="pickOne"){if(e.length===0)throw new Error(`${t}: empty array`);return e[Math.floor(Math.random()*e.length)]}function m(e,t){e.log.unshift(t),e.log=e.log.slice(0,250)}function Y(e){return e.enemies.filter(t=>t.hp>0)}function pt(e){const t=[],n=e.run.treasureObtained?24:20,r=e.run.treasureObtained?1:4,o=(e.run.treasureObtained,5),s=!e.run.treasureObtained&&e.run.nodePickCount>=30?1:0;for(let l=0;l<n;l++)t.push("BATTLE");for(let l=0;l<r;l++)t.push("REST");for(let l=0;l<o;l++)t.push("EVENT");for(let l=0;l<s;l++)t.push("TREASURE");const i=G(t,"rollNodeOffers pool");let d=G(t,"rollNodeOffers pool");if(i==="TREASURE"){const l=t.filter(h=>h!=="TREASURE");d=G(l,"rollNodeOffers poolNoTreasure")}return[i,d]}function ir(e){return Math.max(0,Math.min(1,e))}function it(e,t=0){const n=e.player?.fatigue??0,r=ir(t+Math.max(0,n-5)*.12),o=n<=5?0:n<=8?1:n<=11?2:3;return{f:n,p:r,tier:o}}function lr(e){return e.uidSeq+=1,String(e.uidSeq)}function cr(){return{relicRuntime:{},pendingRelicActivations:[],unlock:{rest:0,eliteWins:0,tookBigHit10:!1,kills:0,endedTurnWeak:!1,eventPicks:0,hpLeq15:!1,skippedTurn:!1,bleedApplied:0},encounterCount:0,treasureObtained:!1,afterTreasureNodePicks:0,nodeOfferQueue:[],finished:!1,nodePickCount:0,nodePickByType:{BATTLE:0,ELITE:0,REST:0,EVENT:0,TREASURE:0},currentNodeOffers:null,nextBattleSuppliesBonus:0,bossPool:["boss_gravity_master","boss_cursed_wall","boss_giant_orc","boss_soul_stealer"],branchOffer:null,battleCount:0,enemyLastSeenBattle:{},nextBossId:null,nextBossTime:40,forcedNext:null,bossOmenText:null,deckSizeAtTreasure:null,ominousProphecySeen:!1,relics:[],lastBattleWasElite:!1,eliteRelicOfferedThisBattle:!1,pendingElite:!1}}function Tt(e){const t={uidSeq:0,intentsRevealedThisTurn:!1,disruptIndexThisTurn:null,attackedEnemyIndicesThisTurn:[],phase:"NODE",log:[],run:cr(),player:{hp:40,maxHp:40,block:0,supplies:7,fatigue:0,zeroSupplyTurns:0,status:{vuln:0,weak:0,bleed:0,disrupt:0},immuneToDisruptThisTurn:!1,nullifyDamageThisTurn:!1},content:e,cards:{},deck:[],hand:[],discard:[],exhausted:[],vanished:[],frontSlots:[null,null,null],backSlots:[null,null,null],backSlotDisabled:[!1,!1,!1],enemies:[],usedThisTurn:0,frontPlacedThisTurn:0,selectedHandCardUid:null,winHooksAppliedThisCombat:!1,drawCountThisTurn:0,pendingTarget:null,pendingTargetQueue:[],backUidsThisTurn:[],victoryResolvedThisCombat:!1,time:0,choice:null,choiceQueue:[],choiceStack:[],choiceCtx:null,selectedEnemyIndex:null};return dr(t),m(t,"ÏÉà Îü∞ ÏãúÏûë."),t}function Te(e,t,n){for(let r=0;r<n;r++){const o=lr(e),a={uid:o,defId:t,zone:"deck",upgrade:0};e.cards[o]=a,e.deck.push(o)}}function dr(e){Te(e,"field_ration",2),Te(e,"maintenance",2),Te(e,"scout",2),Te(e,"shield",2),Te(e,"power_arrow",1),Te(e,"arrow",3),e.deck=Mt(e.deck)}function de(e,t){const n=e.cards[t],r=e.content.cardsById[n.defId],o=n.upgrade??0,a=r.upgrades?.[o-1];return a?{...r,...a}:r}function se(e,t,n){const r=e.cardsById[t],o=Math.max(0,n|0);if(o<=0)return r;const a=r.upgrades?.[o-1];return a?{...r,...a}:r}function Ee(e,t){const r=e.cards[t].upgrade??0,o=de(e,t);return r>0?`${o.name} +${r}`:o.name}const ur=[{id:"field_ration",name:"ÏïºÏ†Ñ ÏãùÎüâ",frontText:"Î∞©Ïñ¥ +3",backText:"S +2",front:[{op:"block",n:3}],back:[{op:"supplies",n:2}],upgrades:[{frontText:"Î∞©Ïñ¥ +5",front:[{op:"block",n:5}],backText:"S +3",back:[{op:"supplies",n:3}]}]},{id:"maintenance",name:"Ï†ïÎπÑ ÎèÑÍµ¨",exhaustWhen:"BACK",frontText:"Î∞©Ïñ¥ +3",backText:"F -1, ÏÜåÎ™®",front:[{op:"block",n:3}],back:[{op:"fatigue",n:-1}],upgrades:[{frontText:"Î∞©Ïñ¥ +5",front:[{op:"block",n:5}],backText:"F -1, S +1, ÏÜåÎ™®",back:[{op:"fatigue",n:-1},{op:"supplies",n:1}]}]},{id:"scout",name:"Ï†ïÏ∞∞",frontText:"ÏßÄÏ†ï ÌîºÌï¥ 3, Î∞©Ïñ¥ +1",backText:"ÎìúÎ°úÏö∞ 1, S +2",front:[{op:"damageEnemy",target:"select",n:3},{op:"block",n:1}],back:[{op:"draw",n:1},{op:"supplies",n:2}],upgrades:[{frontText:"ÏßÄÏ†ï ÌîºÌï¥ 4, Î∞©Ïñ¥ +2",front:[{op:"damageEnemy",target:"select",n:4},{op:"block",n:2}],backText:"ÎìúÎ°úÏö∞ 2, S +2",back:[{op:"draw",n:2},{op:"supplies",n:2}]}]},{id:"shield",name:"Î∞©Ìå®",frontText:"Î∞©Ïñ¥ +5",backText:"Î∞©Ïñ¥ +3",front:[{op:"block",n:5}],back:[{op:"block",n:3}],upgrades:[{frontText:"Î∞©Ïñ¥ +7",front:[{op:"block",n:7}],backText:"Î∞©Ïñ¥ +4",back:[{op:"block",n:4}]}]},{id:"power_arrow",name:"Í∞ïÎ†•Ìïú ÌôîÏÇ¥",frontText:"Î¨¥ÏûëÏúÑ ÌîºÌï¥ 10, S -2",backText:"Î¨¥ÏûëÏúÑ ÌîºÌï¥ 7, S -2",front:[{op:"supplies",n:-2},{op:"damageEnemy",target:"random",n:10}],back:[{op:"supplies",n:-2},{op:"damageEnemy",target:"random",n:7}],upgrades:[{frontText:"Î¨¥ÏûëÏúÑ ÌîºÌï¥ 13, S -2",front:[{op:"supplies",n:-2},{op:"damageEnemy",target:"random",n:13}],backText:"Î¨¥ÏûëÏúÑ ÌîºÌï¥ 10, S -2",back:[{op:"supplies",n:-2},{op:"damageEnemy",target:"random",n:10}]}]},{id:"arrow",name:"ÌôîÏÇ¥",frontText:"ÏßÄÏ†ï ÌîºÌï¥ 5",backText:"ÏßÄÏ†ï ÌîºÌï¥ 5, S -1",front:[{op:"damageEnemy",target:"select",n:5}],back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:5}],upgrades:[{frontText:"ÏßÄÏ†ï ÌîºÌï¥ 7",front:[{op:"damageEnemy",target:"select",n:7}],backText:"ÏßÄÏ†ï ÌîºÌï¥ 7, S -1",back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:7}]}]},{id:"goal_treasure",name:"Ï†ÄÏ£ºÎ∞õÏùÄ Î≥¥Î¨º",exhaustWhen:"BOTH",frontText:"F +1, ÏÜåÎ™®",backText:"S -1, F +1, ÏÜåÎ™®",front:[{op:"fatigue",n:1}],back:[{op:"supplies",n:-1},{op:"fatigue",n:1}]},{id:"berserk",name:"Í¥ëÌè≠Ìôî",frontText:"Î¨¥ÏûëÏúÑ ÌîºÌï¥ 15, F +1",backText:"S +4, F +1",front:[{op:"damageEnemy",target:"random",n:15},{op:"fatigue",n:1}],back:[{op:"supplies",n:4},{op:"fatigue",n:1}],upgrades:[{frontText:"Î¨¥ÏûëÏúÑ ÌîºÌï¥ 20, F +2",front:[{op:"damageEnemy",target:"random",n:20},{op:"fatigue",n:2}],backText:"S +6, F +2",back:[{op:"supplies",n:6},{op:"fatigue",n:2}]}]},{id:"bandage",name:"Î∂ïÎåÄ",exhaustWhen:"BOTH",frontText:"HP +4, ÏÜåÎ™®",backText:"HP +4, S -1, ÏÜåÎ™®",front:[{op:"heal",n:4}],back:[{op:"supplies",n:-1},{op:"heal",n:4}],upgrades:[{frontText:"HP +4, Ï∂úÌòà Ï†úÍ±∞, ÏÜåÎ™®",front:[{op:"heal",n:4},{op:"clearStatusSelf",key:"bleed"}],backText:"HP +4, Ï∂úÌòà Ï†úÍ±∞, S -1, ÏÜåÎ™®",back:[{op:"supplies",n:-1},{op:"heal",n:4},{op:"clearStatusSelf",key:"bleed"}]}]},{id:"arrow_rain",name:"ÌôîÏÇ¥Ïùò ÎπÑ",exhaustWhen:"BOTH",frontText:"Ï†ÑÏ≤¥ ÌîºÌï¥ 10, S -1, F +1, ÏÜåÎ™®",backText:"ÎìúÎ°úÏö∞ 2, S +2, F +1, ÏÜåÎ™®",front:[{op:"damageEnemy",target:"all",n:10},{op:"supplies",n:-1},{op:"fatigue",n:1}],back:[{op:"draw",n:2},{op:"supplies",n:2},{op:"fatigue",n:1}],upgrades:[{frontText:"Ï†ÑÏ≤¥ ÌîºÌï¥ 13, S -2, F +1, ÏÜåÎ™®",front:[{op:"damageEnemy",target:"all",n:13},{op:"supplies",n:-2},{op:"fatigue",n:1}],backText:"ÎìúÎ°úÏö∞ 3, S +3, F +2, ÏÜåÎ™®",back:[{op:"draw",n:3},{op:"supplies",n:3},{op:"fatigue",n:2}]}]},{id:"smoke",name:"Ïó∞Îßâ",exhaustWhen:"FRONT",frontText:"Ïù¥Î≤à ÌÑ¥ Ï†Å Í≥µÍ≤© ÌîºÌï¥ Î¨¥Ìö®, ÏÜåÎ™®",backText:"ÏûêÏã†ÏùÄ ÍµêÎûÄ ÎãπÌïòÏßÄ ÏïäÏùå",front:[{op:"nullifyDamageThisTurn"}],back:[{op:"immuneDisruptThisTurn"}]},{id:"redeploy",name:"Ïû¨Î∞∞Ïπò",frontText:"S +2",backText:"3Î≤à Ïä¨Î°ØÏóê ÏûàÎäî ÌõÑÏó¥ Ïπ¥ÎìúÏùò Ï†ÑÏó¥ Ìö®Í≥º Î∞úÎèô",front:[{op:"supplies",n:2}],back:[{op:"triggerFrontOfBackSlot",index:2}],upgrades:[{frontText:"S +3",front:[{op:"supplies",n:3}],backText:"3Î≤à Ïä¨Î°ØÏóê ÏûàÎäî ÌõÑÏó¥ Ïπ¥ÎìúÏùò Ï†ÑÏó¥ Ìö®Í≥º Î∞úÎèô, S +1",back:[{op:"triggerFrontOfBackSlot",index:2},{op:"supplies",n:1}]}]},{id:"secret_strike",name:"ÎπÑÏû•Ïùò ÏùºÍ≤©",exhaustWhen:"BOTH",frontText:"Î¨¥ÏûëÏúÑ ÌîºÌï¥ (FÏùò 3Î∞∞), ÏÜåÎ™®",backText:"Ï†ÑÏ≤¥ Ï∑®ÏïΩ +4 Î∞è ÏïΩÌôî +4, ÏÜåÎ™®",front:[{op:"damageEnemyByPlayerFatigue",target:"random",mult:3}],back:[{op:"statusEnemy",target:"all",key:"vuln",n:4},{op:"statusEnemy",target:"all",key:"weak",n:4}],upgrades:[{exhaustWhen:"FRONT",frontText:"ÏßÄÏ†ï ÌîºÌï¥ (FÏùò 3Î∞∞), ÏÜåÎ™®",front:[{op:"damageEnemyByPlayerFatigue",target:"select",mult:3}],backText:"Ï†ÑÏ≤¥ Ï∑®ÏïΩ +4 Î∞è ÏïΩÌôî +4",back:[{op:"statusEnemy",target:"all",key:"vuln",n:4},{op:"statusEnemy",target:"all",key:"weak",n:4}]}]},{id:"fire_scroll",name:"ÌôîÏóº ÎëêÎ£®ÎßàÎ¶¨",exhaustWhen:"BOTH",frontText:"Î∞©Ïñ¥ +7, ÏÜåÎ™®",backText:"Ï†ÑÏ≤¥ ÌîºÌï¥ 12, ÏÜåÎ™®",front:[{op:"block",n:7}],back:[{op:"damageEnemy",target:"all",n:12}],upgrades:[{frontText:"Î∞©Ïñ¥ +8, ÏÜåÎ™®",front:[{op:"block",n:8}],backText:"Ï†ÑÏ≤¥ ÌîºÌï¥ 14, ÏÜåÎ™®",back:[{op:"damageEnemy",target:"all",n:14}]}]},{id:"caltrops",name:"ÎßàÎ¶ÑÏá†",frontText:"Ï†ÑÏ≤¥ Ï∂úÌòà 4 Î∂ÄÏó¨",backText:"Ïù¥Î≤à ÌÑ¥Ïóê ÏûêÏã†ÏùÑ Í≥µÍ≤©ÌïòÎ†§Îäî Ï†ÅÏóêÍ≤å Ï∂úÌòà 3 Î∂ÄÏó¨",front:[{op:"statusEnemy",target:"all",key:"bleed",n:4}],back:[{op:"statusEnemiesAttackingThisTurn",key:"bleed",n:3}],upgrades:[{frontText:"Ï†ÑÏ≤¥ Ï∂úÌòà 5 Î∂ÄÏó¨",backText:"Ïù¥Î≤à ÌÑ¥Ïóê ÏûêÏã†ÏùÑ Í≥µÍ≤©ÌïòÎ†§Îäî Ï†ÅÏóêÍ≤å Ï∂úÌòà 4 Î∂ÄÏó¨",front:[{op:"statusEnemy",target:"all",key:"bleed",n:5}],back:[{op:"statusEnemiesAttackingThisTurn",key:"bleed",n:4}]}]},{id:"emergency_rations",name:"ÎπÑÏÉÅÏãùÎüâ",vanishWhen:"BACK",frontText:"S +2",backText:"SÎ•º 10ÏúºÎ°ú ÎßåÎì¶. ÏÜåÏã§",front:[{op:"supplies",n:2}],back:[{op:"setSupplies",n:10}],upgrades:[{frontText:"S +3",backText:"SÎ•º 15ÏúºÎ°ú ÎßåÎì¶. ÏÜåÏã§",front:[{op:"supplies",n:3}],back:[{op:"setSupplies",n:15}]}]},{id:"painkiller",name:"ÏßÑÌÜµÏ†ú",exhaustWhen:"BOTH",frontText:"HP -8, F -2, ÏÜåÎ™®",backText:"HP +8, F +2, ÏÜåÎ™®",front:[{op:"hp",n:-8},{op:"fatigue",n:-2}],back:[{op:"hp",n:8},{op:"fatigue",n:2}],upgrades:[{frontText:"HP -6, F -2, ÏÜåÎ™®",backText:"HP +10, F +2, ÏÜåÎ™®",front:[{op:"hp",n:-6},{op:"fatigue",n:-2}],back:[{op:"hp",n:10},{op:"fatigue",n:2}]}]},{id:"field_experience",name:"Ïã§Ï†Ñ Í≤ΩÌóò",exhaustWhen:"BACK",frontText:"Ï†ÑÏ≤¥ ÌîºÌï¥ 3",backText:"Ïù¥ Ïπ¥ÎìúÍ∞Ä ÌõÑÏó¥Ïóê ÏûàÎäî ÌÑ¥Ïóê ÏäπÎ¶¨ÌïòÎ©¥ ÏµúÎåÄ Ï≤¥Î†• +2, ÏÜåÎ™®",front:[{op:"damageEnemy",target:"all",n:3}],back:[],onWinWhileInBack:[{op:"maxHp",n:2}],upgrades:[{frontText:"Ï†ÑÏ≤¥ ÌîºÌï¥ 4",backText:"Ïù¥ Ïπ¥ÎìúÍ∞Ä ÌõÑÏó¥Ïóê ÏûàÎäî ÌÑ¥Ïóê ÏäπÎ¶¨ÌïòÎ©¥ ÏµúÎåÄ Ï≤¥Î†• +3, ÏÜåÎ™®",front:[{op:"damageEnemy",target:"all",n:4}],onWinWhileInBack:[{op:"maxHp",n:3}]}]},{id:"camp_prep",name:"ÏïºÏòÅ Ï§ÄÎπÑ",frontText:"Î∞©Ïñ¥ +4, S +1",backText:"S +3",front:[{op:"block",n:4},{op:"supplies",n:1}],back:[{op:"supplies",n:3}],upgrades:[{frontText:"Î∞©Ïñ¥ +5, S +2",backText:"S +5",front:[{op:"block",n:5},{op:"supplies",n:2}],back:[{op:"supplies",n:5}]}]},{id:"vital_shot",name:"Í∏âÏÜå ÏÇ¨Í≤©",frontText:"ÏßÄÏ†ï ÌîºÌï¥ 8",backText:"ÏßÄÏ†ï ÌîºÌï¥ 5, Ï∂úÌòà 2 Î∂ÄÏó¨, S -1",front:[{op:"damageEnemy",target:"select",n:8}],back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:5},{op:"statusEnemy",target:"select",key:"bleed",n:2}],upgrades:[{frontText:"ÏßÄÏ†ï ÌîºÌï¥ 11",backText:"ÏßÄÏ†ï ÌîºÌï¥ 6, Ï∂úÌòà 3 Î∂ÄÏó¨, S -1",front:[{op:"damageEnemy",target:"select",n:11}],back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:6},{op:"statusEnemy",target:"select",key:"bleed",n:3}]}]},{id:"taunt",name:"ÎèÖÏÑ§",frontText:"ÏßÄÏ†ï ÏïΩÌôî +4",backText:"Ï†ÑÏ≤¥ Ï∑®ÏïΩ +2 Î∞è ÏïΩÌôî +2",front:[{op:"statusEnemy",target:"select",key:"weak",n:4}],back:[{op:"statusEnemy",target:"all",key:"vuln",n:2},{op:"statusEnemy",target:"all",key:"weak",n:2}],upgrades:[{frontText:"ÏßÄÏ†ï ÏïΩÌôî +5",backText:"Ï†ÑÏ≤¥ Ï∑®ÏïΩ +2 Î∞è ÏïΩÌôî +3",front:[{op:"statusEnemy",target:"select",key:"weak",n:5}],back:[{op:"statusEnemy",target:"all",key:"vuln",n:2},{op:"statusEnemy",target:"all",key:"weak",n:3}]}]},{id:"rapid_fire",name:"Ïó∞ÏÜç ÏÇ¨Í≤©",frontText:"ÏßÄÏ†ï ÌîºÌï¥ 2, 3Î≤à Î∞úÎèô",backText:"Ïù¥Î≤à ÌÑ¥Ïóê Ïπ¥ÎìúÎ•º ÎΩëÏïòÏúºÎ©¥ Î¨¥ÏûëÏúÑ ÌîºÌï¥ 8",front:[{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2}],back:[{op:"ifDrewThisTurn",then:[{op:"damageEnemy",target:"random",n:8}]}],upgrades:[{frontText:"ÏßÄÏ†ï ÌîºÌï¥ 2, 4Î≤à Î∞úÎèô",backText:"Ïù¥Î≤à ÌÑ¥Ïóê Ïπ¥ÎìúÎ•º ÎΩëÏïòÏúºÎ©¥ Î¨¥ÏûëÏúÑ ÌîºÌï¥ 10",front:[{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2}],back:[{op:"ifDrewThisTurn",then:[{op:"damageEnemy",target:"random",n:10}]}]}]},{id:"mad_echo",name:"Î©îÏïÑÎ¶¨",frontText:"Î¨¥ÏûëÏúÑ ÌîºÌï¥ (F)",backText:"ÎìúÎ°úÏö∞ 1, S +2, F +1",front:[{op:"damageEnemyByPlayerFatigue",target:"random",mult:1}],back:[{op:"draw",n:1},{op:"supplies",n:2},{op:"fatigue",n:1}],upgrades:[{frontText:"Î¨¥ÏûëÏúÑ ÌîºÌï¥ (FÏùò 2Î∞∞)",front:[{op:"damageEnemyByPlayerFatigue",target:"random",mult:2}],backText:"ÎìúÎ°úÏö∞ 2, S +2, F +1",back:[{op:"draw",n:2},{op:"supplies",n:2},{op:"fatigue",n:1}]}]},{id:"mad_insight",name:"Í∏àÎã®Ïùò ÌÜµÏ∞∞",exhaustWhen:"BOTH",frontText:"Î∞©Ïñ¥ +8, ÎìúÎ°úÏö∞ 1, F +1, ÏÜåÎ™®",backText:"ÎìúÎ°úÏö∞ 3, S +2, F +2, ÏÜåÎ™®",front:[{op:"block",n:8},{op:"draw",n:1},{op:"fatigue",n:1}],back:[{op:"draw",n:3},{op:"supplies",n:2},{op:"fatigue",n:2}],upgrades:[{frontText:"Î∞©Ïñ¥ +10, ÎìúÎ°úÏö∞ 2, F +1, ÏÜåÎ™®",front:[{op:"block",n:10},{op:"draw",n:2},{op:"fatigue",n:1}],backText:"ÎìúÎ°úÏö∞ 4, S +3, F +2, ÏÜåÎ™®",back:[{op:"draw",n:4},{op:"supplies",n:3},{op:"fatigue",n:2}]}]},{id:"mad_bargain",name:"Í±∞ÎûòÏùò ÏûîÏû¨",exhaustWhen:"BOTH",frontText:"ÏßÄÏ†ï 12 ÌîºÌï¥, S -1, F +1, ÏÜåÎ™®",backText:"HP +6, F +2, ÏÜåÎ™®",front:[{op:"damageEnemy",target:"select",n:12},{op:"supplies",n:-1},{op:"fatigue",n:1}],back:[{op:"heal",n:6},{op:"fatigue",n:2}],upgrades:[{frontText:"ÏßÄÏ†ï 16 ÌîºÌï¥, S -1, F +1, ÏÜåÎ™®",front:[{op:"damageEnemy",target:"select",n:16},{op:"supplies",n:-1},{op:"fatigue",n:1}],backText:"HP +8, F +2, ÏÜåÎ™®",back:[{op:"heal",n:8},{op:"fatigue",n:2}]}]}],En=Object.fromEntries(ur.map(e=>[e.id,e])),pr=[{id:"other_adventurer",name:"Î≥¥Î¨ºÏùÑ ÎÖ∏Î¶¨Îäî Îã§Î•∏ Î™®ÌóòÍ∞Ä",maxHp:60,intents:[{label:"Ï∞Ω Ï∞åÎ•¥Í∏∞: 5 ÌîºÌï¥, 3Î≤à Î∞úÎèô",acts:[{op:"damagePlayer",n:5},{op:"damagePlayer",n:5},{op:"damagePlayer",n:5}]},{label:"ÎèÖÏïΩ ÎøåÎ¶¨Í∏∞: Ï∂úÌòà +4, Ï∑®ÏïΩ +4, ÏïΩÌôî +4 Î∂ÄÏó¨",acts:[{op:"statusPlayer",key:"bleed",n:4},{op:"statusPlayer",key:"vuln",n:4},{op:"statusPlayer",key:"weak",n:4}]}]},{id:"goblin_raider",name:"Í≥†Î∏îÎ¶∞ ÏïΩÌÉàÏûê",maxHp:20,intents:[{label:"Í∏∞Ïäµ: 12 - Ïù¥Î≤à ÌÑ¥Ïóê ÏÇ¨Ïö©Ìïú Ïπ¥ÎìúÏùò ÏàòÎßåÌÅº ÌîºÌï¥",acts:[{op:"damagePlayerFormula",kind:"goblin_raider"}]},{label:"ÌõîÏπòÍ∏∞: Ï∂úÌòà +2 Î∂ÄÏó¨, S -3",acts:[{op:"supplies",n:-3},{op:"statusPlayer",key:"bleed",n:2}]}]},{id:"watching_statue",name:"Í∞êÏãúÌïòÎäî ÏÑùÏÉÅ",maxHp:25,intents:[{label:"Í∞êÏãú: 4 + Ïù¥Î≤à ÌÑ¥Ïóê ÏÇ¨Ïö©Ìïú Ïπ¥ÎìúÏùò ÏàòÎßåÌÅº ÌîºÌï¥",acts:[{op:"damagePlayerFormula",kind:"watching_statue"}]}]},{id:"pebble_golem",name:"Ï°∞ÏïΩÎèå Í≥®Î†ò",maxHp:30,intents:[{label:"Ï°∞ÏïΩÎèå ÎçòÏßÄÍ∏∞: 8 ÌîºÌï¥",acts:[{op:"damagePlayer",n:8}]},{label:"Î™®Îûò Î™®ÏúºÍ∏∞: ÏûêÏã† HP 6 ÌöåÎ≥µ",acts:[{op:"enemyHealSelf",n:6}]}]},{id:"rock_golem",name:"Î∞îÏúÑ Í≥®Î†ò",maxHp:50,intents:[{label:"Î∞îÏúÑ ÎçòÏßÄÍ∏∞: 10 ÌîºÌï¥",acts:[{op:"damagePlayer",n:10}]},{label:"ÎïÖ Î™®ÏúºÍ∏∞: ÏûêÏã† HP 10 ÌöåÎ≥µ",acts:[{op:"enemyHealSelf",n:10}]}]},{id:"slime",name:"Ïä¨ÎùºÏûÑ",maxHp:30,intents:[{label:"Ïú†Ïó∞Ìïú Î™∏: Îã§Ïùå ÌÑ¥ ÎèôÏïà ÌîºÌï¥Î•º ÏûÖÏßÄ ÏïäÏùå",acts:[{op:"enemyImmuneNextTurn"}]},{label:"ÏÇ∞ÏÑ±Ïï°: ÏïΩÌôî +3 Î∂ÄÏó¨ ÌõÑ ÏûêÏã† HP 3 ÌöåÎ≥µ",acts:[{op:"statusPlayer",key:"weak",n:3},{op:"enemyHealSelf",n:3}]},{label:"ÎïåÎ¶¨Í∏∞: 6 ÌîºÌï¥",acts:[{op:"damagePlayer",n:6}]}]},{id:"poison_spider",name:"ÎèÖÍ±∞ÎØ∏",maxHp:28,intents:[{label:"ÎèÖÎãàÎ°ú Î¨ºÍ∏∞: Ï∂úÌòà +4 Î∂ÄÏó¨",acts:[{op:"statusPlayer",key:"bleed",n:4}]},{label:"ÏÜ°Í≥≥ÎãàÎ°ú Î¨ºÍ∏∞: 7 ÌîºÌï¥",acts:[{op:"damagePlayer",n:7}]},{label:"Îã®Î≤àÏóê Î¨ºÍ∏∞: Ï∂úÌòà +2 Î∂ÄÏó¨, 6 ÌîºÌï¥",acts:[{op:"statusPlayer",key:"bleed",n:2},{op:"damagePlayer",n:6}]}]},{id:"gravity_echo",name:"Ï§ëÎ†•Ïùò ÏûîÌñ•",maxHp:26,intents:[{label:"ÌïòÏ§ë Ïù∏Ïû•",acts:[{op:"damagePlayerByDeckSize",base:5,per:2,div:6,cap:18}]},{label:"ÏïïÏ∂ï: 7 ÌîºÌï¥",acts:[{op:"damagePlayer",n:7}]},{label:"ÎÜìÏπòÍ≤å ÎßåÎì§Í∏∞: S -3",acts:[{op:"supplies",n:-3}]}]},{id:"boss_gravity_master",name:"Ï§ëÎ†• ÌÜµÎã¨Ïûê",omen:"Î™∏Ïù¥ Ï†êÏ†ê Î¨¥Í≤ÅÎã§.",maxHp:80,intents:[{label:"Ï§ëÎ†• ÏàòÏ∂ï: ÏïΩÌôî +3 Î∂ÄÏó¨",acts:[{op:"statusPlayer",key:"weak",n:3}]},{label:"ÌäπÏù¥Ï†ê ÏÉùÏÑ±",acts:[{op:"damagePlayerByDeckSize",base:8,per:3,div:5,cap:30}]},{label:"Ï≤úÏû• Î∂ïÍ¥¥: 11 ÌîºÌï¥",acts:[{op:"damagePlayer",n:11}]}]},{id:"boss_cursed_wall",name:"Ï†ÄÏ£ºÎ∞õÏùÄ Î≤Ω",omen:"ÏõÄÏßÅÏù¥ÏßÄ ÏïäÎäîÎã§. ÎãπÏã†Ïù¥ Îã≥ÏïÑÍ∞ÑÎã§.",maxHp:150,intents:[{label:"Ï†ÄÏ£ºÏùò Í∏∞Ïö¥: F +1",acts:[{op:"fatiguePlayer",n:1}]},{label:"ÏïÑÎ¨¥ ÌñâÎèôÎèÑ ÌïòÏßÄ ÏïäÏùå",acts:[]}]},{id:"boss_giant_orc",name:"Í±∞ÎåÄÌïú Ïò§ÌÅ¨",omen:"Í±∞ÎåÄÌïú Î¨¥Ïñ∏Í∞ÄÍ∞Ä Í∏∞Îã§Î¶∞Îã§.",maxHp:90,intents:[{label:"ÎÇ¥Î†§ÏπòÍ∏∞: 15 ÌîºÌï¥",acts:[{op:"damagePlayer",n:15}]},{label:"Îã®Îã®Ìïú ÌîºÎ∂Ä: Îã§Ïùå ÌÑ¥ ÎèôÏïà ÌîºÌï¥Î•º ÏûÖÏßÄ ÏïäÏùå",acts:[{op:"enemyImmuneNextTurn"}]},{label:"ÌÉÄÍ≥†ÎÇú ÌöåÎ≥µ: ÏûêÏã† HP 15 ÌöåÎ≥µ",acts:[{op:"enemyHealSelf",n:15}]}]},{id:"boss_soul_stealer",name:"ÏòÅÌòº Í∞ïÌÉàÏûê",omen:"ÌñâÎèôÌïòÏßÄ ÏïäÏúºÎ©¥ Ï¢ÖÎßêÏù¥ Ïò§Î¶¨Îùº.",maxHp:70,intents:[{label:"ÌóàÍ∏∞: 7 ÌîºÌï¥, S -2",acts:[{op:"damagePlayer",n:7},{op:"supplies",n:-2}]},{label:"ÎÇòÌÉú: 7 ÌîºÌï¥, F +1",acts:[{op:"damagePlayer",n:7},{op:"fatiguePlayer",n:1}]},{label:"ÏòàÏñ∏: Ïπ¥Ïö¥Ìä∏ ÏßÑÌñâ",acts:[]}]}],fr=Object.fromEntries(pr.map(e=>[e.id,e]));function Je(e,t=10,n=16){const r=Math.max(0,e-n),o=Math.ceil(Math.sqrt(r));return t+o}function ft(e,t){const n=e.content.enemiesById[t];return{id:n.id,name:n.name,hp:n.maxHp,maxHp:n.maxHp,intentIndex:0,status:{vuln:0,weak:0,bleed:0,disrupt:0},immuneThisTurn:!1,immuneNextTurn:!1,lastIntentKey:null,lastIntentStreak:0,soulWarnCount:t==="boss_soul_stealer"?0:void 0,soulArmed:t==="boss_soul_stealer"?!1:void 0,soulWillNukeThisTurn:t==="boss_soul_stealer"?!1:void 0}}function mr(e,t,n,r=5){for(const o of t){const a=e.run.enemyLastSeenBattle?.[o];if(a!=null&&n-a<r)return!1}return!0}function Pe(e,t){const n=t?.forceBoss??!1,r=e.run,o=(t?.forceElite??r.pendingElite??!1)===!0;r.pendingElite=!1,e.run.enemyLastSeenBattle??={},e.run.battleCount??=0;const a=e.run.nodePickCount??0,s=(e.run.battleCount??0)+1;if(t?.forcePatternIds&&t.forcePatternIds.length>0){const b=t.forcePatternIds;e.run.battleCount=s;for(const E of b)e.run.enemyLastSeenBattle[E]=s;e.enemies=b.map(E=>ft(e,E)),e.run.lastBattleWasElite=!1,m(e,`Ï†ÑÌà¨ ÏãúÏûë! (ÎÖ∏Îìú ${a}, Ï†ÑÌà¨ ${s}ÌöåÏ∞®) Ï†Å: ${e.enemies.map(E=>E.name).join(", ")}`);return}if(n)if(e.run.lastBattleWasElite=!1,e.run.bossPool??=["boss_gravity_master","boss_cursed_wall","boss_giant_orc","boss_soul_stealer"],e.run.bossPool.length===0&&!e.run.nextBossId)m(e,`Î≥¥Ïä§ ÌíÄÏù¥ ÎπÑÏóàÏäµÎãàÎã§. ÏùºÎ∞ò Ï†ÑÌà¨Î°ú ÏßÑÌñâÌï©ÎãàÎã§. (ÎÖ∏Îìú ${a})`);else{let b=e.run.nextBossId??null;if(b!=null){const E=e.content.enemiesById[b];e.run.bossOmenText=Hn[b]??E.omen??null}b?(e.run.nextBossId=null,e.run.bossPool=e.run.bossPool.filter(E=>E!==b)):(b=G(e.run.bossPool),e.run.bossPool=e.run.bossPool.filter(E=>E!==b)),e.enemies=[ft(e,b)],e.run.ominousProphecySeen=!1,m(e,`Î≥¥Ïä§ Îì±Ïû•! (ÎÖ∏Îìú ${a}) Ï†Å: ${e.enemies[0].name}`),e.run.battleCount=s,e.run.enemyLastSeenBattle[b]=s;return}const i=[[["goblin_raider"],["watching_statue"],["pebble_golem"],["slime"]],[["goblin_raider","slime"],["pebble_golem","pebble_golem"],["rock_golem"],["goblin_raider","goblin_raider"],["poison_spider"]],[["goblin_raider","goblin_raider","goblin_raider"],["pebble_golem","pebble_golem","slime"],["rock_golem","pebble_golem"],["slime","slime"],["poison_spider","slime"],["gravity_echo"]]],d=[["gravity_echo","poison_spider"],["poison_spider","slime"],["watching_statue","slime"],["watching_statue","watching_statue"],["poison_spider","poison_spider"],["rock_golem","gravity_echo"],["goblin_raider","goblin_raider","watching_statue"]],l=[[["rock_golem"],["poison_spider"],["watching_statue","slime"]],[["rock_golem","slime"],["poison_spider","slime"],["watching_statue","watching_statue"]],[["gravity_echo"],["rock_golem","gravity_echo"],["poison_spider","poison_spider"]]],h=[["gravity_echo","gravity_echo"],["rock_golem","poison_spider"],["watching_statue","gravity_echo"]],f=(e.run.nodePickCount??0)+(e.time??0),p=Math.min(i.length-1,Math.floor(Math.max(0,f)/15)),k=o?e.run.treasureObtained?h:l[p]:e.run.treasureObtained?d:i[p],A=5,u=k.filter(b=>mr(e,b,s,A)),c=u.length>0?u:k,y=G(c);e.run.battleCount=s;for(const b of y)e.run.enemyLastSeenBattle[b]=s;e.enemies=y.map(b=>ft(e,b)),e.run.lastBattleWasElite=o,m(e,`Ï†ÑÌà¨ ÏãúÏûë!${o?" [Ï†ïÏòà]":""} (ÎÖ∏Îìú ${a}, Ï†ÑÌà¨ ${s}ÌöåÏ∞®) Ï†Å: ${e.enemies.map(b=>b.name).join(", ")}`)}function hr(){return Object.keys(j).sort((e,t)=>e.localeCompare(t))}const j={relic_unknown_square:{id:"relic_unknown_square",dormantName:"Ï†ñÏùÄ ÏÇ¨Í∞ÅÌòï",dormantText:"Í≥∞Ìå°Ïù¥ÏùºÍπå? Î®πÏùÑ Ïàò ÏûàÏùÑÍπå?",unlockHint:"Ï°∞Í±¥: Ìú¥Ïãù 1Ìöå",art:"assets/relics/relic_unknown_square.png",unlock:e=>e.run.unlock?.rest>=1,name:"Î®πÏùÑ Ïàò ÏûàÎäî ÏÇ¨Í∞ÅÌòï",text:"Ï†ÑÌà¨ ÏãúÏûë Ïãú üåæ S +1",unlockFlavor:"Î®πÏùÑ ÏàòÎäî ÏûàÎã§. ÏùºÎã®ÏùÄ.",onCombatStart(e){e.player.supplies+=1,m(e,"Ïú†Î¨º[Î®πÏùÑ Ïàò ÏûàÎäî ÏÇ¨Í∞ÅÌòï]: S +1")}},relic_monster_leather_helm:{id:"relic_monster_leather_helm",dormantName:"Îì§Îü¨Î∂ôÎäî Í∞ÄÏ£Ω",dormantText:"ÌÑ∏Í≥º ÌîºÍ∞Ä Îí§ÏÑûÏù∏ Í∞ÄÏ£ΩÏù¥ ÏÜêÏóê Îì§Îü¨Î∂ôÎäîÎã§.",unlockHint:"Ï°∞Í±¥: ÏóòÎ¶¨Ìä∏ Ï†ÑÌà¨ ÏäπÎ¶¨ 1Ìöå",art:"assets/relics/relic_monster_leather_helm.png",unlock:e=>e.run.unlock?.eliteWins>=1,name:"Î™¨Ïä§ÌÑ∞ Í∞ÄÏ£Ω Ìà¨Íµ¨",text:"Ï≤´ ÌÑ¥Ïóê üõ°Ô∏è Î∞©Ïñ¥ +4",unlockFlavor:"Î®∏Î¶¨Ïóê Îì§Îü¨Î∂ôÏñ¥ Îñ®Ïñ¥ÏßÄÏßÄ ÏïäÏßÄÎßå ÎãπÏû•Ïùò Î¨∏Ï†úÎäî ÏïÑÎãàÎã§.",onCombatStart(e){e.player.block+=4,m(e,"Ïú†Î¨º[Î™¨Ïä§ÌÑ∞ Í∞ÄÏ£Ω Ìà¨Íµ¨]: Î∞©Ïñ¥ +4")}},relic_smoke_bomb:{id:"relic_smoke_bomb",dormantName:"ÏÜçÏù¥ ÎπÑÏñ¥ ÏûàÎäî ÌÉÑÌôò",dormantText:"ÌùîÎì§Î©¥ ÏûëÏùÄ ÏïåÍ∞±Ïù¥Í∞Ä Íµ¥Îü¨Îã§ÎãåÎã§. Ïó∞Í∏∞Í∞Ä Ï°∞Í∏àÏî© ÏÉåÎã§.",unlockHint:"Ï°∞Í±¥: Ìïú Î≤àÏóê 10 Ïù¥ÏÉÅÏùò üó°Ô∏è ÌîºÌï¥ 1Ìöå Î∞õÍ∏∞",art:"assets/relics/relic_smoke_bomb.png",unlock:e=>!!e.run.unlock?.tookBigHit10,name:"Ïó∞ÎßâÌÉÑ",text:"ÌôúÏÑ±Ìôî Ïãú Ïó∞Îßâ Ïπ¥Îìú(ÏÜåÏã§) 1Ïû• ÌöçÎìù",unlockFlavor:"ÎπÑÏÉÅ ÌÉàÏ∂ú Î≤ÑÌäº!",onActivate(e){const t="smoke_vanish";e.uidSeq+=1;const n=String(e.uidSeq);e.cards[n]={uid:n,defId:t,zone:"deck",upgrade:0},e.deck.push(n),m(e,"Ïú†Î¨º[Ïó∞ÎßâÌÉÑ]: Ïó∞Îßâ Ïπ¥Îìú 1Ïû• ÌöçÎìù")}},relic_bone_compass:{id:"relic_bone_compass",dormantName:"Í∏∏ÏùÑ ÏûÉÎäî Î∞îÎäò",dormantText:"Î∞©Ìñ•ÏùÑ Í∞ÄÎ¶¨ÌÇ§ÏßÄ Î™ªÌïòÎäî Î∞îÎäòÏù¥ Ï£ºÎ®∏Îãà Î∞îÍπ•ÏúºÎ°ú ÎÇòÏò®Îã§.",unlockHint:"Ï°∞Í±¥: ÌÉêÌóò 5Ìöå",art:"assets/relics/relic_bone_compass.png",unlock:e=>(e.run?.nodePickCount??0)>=5,name:"ÎºàÍ∞Ä ÎßåÎì† ÎÇòÏπ®Î∞ò",text:"Ï†ÑÌà¨ ÏãúÏûë Ïãú üÉè ÎìúÎ°úÏö∞ +1",unlockFlavor:"Ïñ¥ÎîîÎ•º Í∞ÄÎ¶¨ÌÇ§Îäî Í≤ÉÏù¥ÏßÄ?",onCombatStart(e){e._combatStartExtraDraw=(e._combatStartExtraDraw??0)+1,m(e,"Ïú†Î¨º[ÎºàÍ∞Ä ÎßåÎì† ÎÇòÏπ®Î∞ò]: Ï†ÑÌà¨ ÏãúÏûë ÎìúÎ°úÏö∞ +1")}},relic_flesh_whetstone:{id:"relic_flesh_whetstone",dormantName:"Ïù¥Í∞Ä Îπ†ÏßÑ ÏπºÎÇ†",dormantText:"Ïñ¥ÎîîÏóê Ïì∞ÎùºÍ≥† ÏûàÎäîÏßÄ Î™®Î•¥Í≤†Îã§.",unlockHint:"Ï°∞Í±¥: Ï†Å Ï≤òÏπò 3Ìöå",art:"assets/relics/relic_flesh_whetstone.png",unlock:e=>(e.run.unlock?.kills??0)>=3,name:"ÏÜçÏÇ¥ÏùÑ Ï∞æÎäî Ïà´Îèå",text:"Ï†ÑÌà¨ÏóêÏÑú Ï≤´ Í≥µÍ≤©Ïù¥ Ï£ºÎäî üó°Ô∏è ÌîºÌï¥ +2",unlockFlavor:"Î∞§ÎßàÎã§ Î¨¥Ïñ∏Í∞Ä Í∞àÍ≥† ÏûàÎã§.",onCombatStart(e){e._firstPlayerAttackDoneThisCombat=!1},modifyDamage(e,t){if(t.phase!=="PRE_STATUS")return t.current;if(t.target==="ENEMY"&&t.source==="PLAYER_ATTACK"){const n=e;if(!n._firstPlayerAttackDoneThisCombat)return n._firstPlayerAttackDoneThisCombat=!0,t.current+2}return t.current}},relic_weak_bell:{id:"relic_weak_bell",dormantName:"ÏÉàÍπåÎßå Ï¢Ö",dormantText:"ÎßåÏßÄÎ©¥ ÏÜêÎÅùÏù¥ Î¨¥Í≤ÅÎã§. ÎãπÏû•Ïóî ÏïÑÎ¨¥ ÏùºÎèÑ ÏóÜÎã§.",unlockHint:"Ï°∞Í±¥: ü•Ä ÏïΩÌôîÎ•º Î∞õÏùÄ ÏÉÅÌÉúÎ°ú ÌÑ¥ Ï¢ÖÎ£å 1Ìöå",art:"assets/relics/relic_weak_bell.png",unlock:e=>!!e.run.unlock?.endedTurnWeak,name:"ÌóàÏïΩÏùò Ï¢ÖÏÜåÎ¶¨",text:"Ï†ÑÌà¨ ÏãúÏûë Ïãú Î™®Îì† Ï†ÅÏóêÍ≤å ü•Ä ÏïΩÌôî +2",unlockFlavor:"Ïô†ÏßÄ Îì§ÏúºÎ©¥ ÎßàÏùåÏù¥ ÌèâÏò®Ìï¥ÏßÑÎã§.",onCombatStart(e){const t=Y(e);for(const n of t)Me(n,"weak",2,e,"SYSTEM");t.length&&m(e,"Ïú†Î¨º[ÌóàÏïΩÏùò Ï¢ÖÏÜåÎ¶¨]: Î™®Îì† Ï†Å ÏïΩÌôî +2")}},relic_return_path_memory:{id:"relic_return_path_memory",dormantName:"Ï∞¢Ïñ¥ÏßÑ ÏßÄÎèÑ Ï°∞Í∞Å",dormantText:"ÏùΩÏùÑ Ïàò ÏóÜÎäî Í∏∏Ïù¥ Í∑∏Î†§Ï†∏ ÏûàÎã§. Í∞ÄÎ≥¥Í≥† Ïã∂Îã§.",unlockHint:"Ï°∞Í±¥: Ïù¥Î≤§Ìä∏ 2Ìöå ÏÑ†ÌÉù",art:"assets/relics/relic_return_path_memory.png",unlock:e=>(e.run.unlock?.eventPicks??0)>=2,name:"ÎèåÏïÑÏò® Í∏∏Ïùò Í∏∞Ïñµ",text:"Ï†ÑÌà¨ ÏäπÎ¶¨ Ïãú HP +2",unlockFlavor:"ÏôîÍ∏∞Ïóê Í∞à Ïàò ÏóÜÎã§.",onVictory(e){vt(e,2),m(e,"Ïú†Î¨º[ÎèåÏïÑÏò® Í∏∏Ïùò Í∏∞Ïñµ]: ÏäπÎ¶¨ ÌöåÎ≥µ +2")}},relic_wound_vial:{id:"relic_wound_vial",dormantName:"Î∞òÏù¥ÎÇò ÎÇ®ÏùÄ Î∂âÏùÄ Ïï°Ï≤¥",dormantText:"ÎßàÍ∞úÎ•º Ïó¥ÏßÄ ÏïäÏïòÎäîÎç∞ÎèÑ Ìîº ÎÉÑÏÉàÍ∞Ä ÎÇúÎã§.",unlockHint:"Ï°∞Í±¥: HPÍ∞Ä 15 Ïù¥ÌïòÎ°ú Îñ®Ïñ¥ÏßÑ Ï†Å 1Ìöå",art:"assets/relics/relic_wound_vial.png",unlock:e=>!!e.run.unlock?.hpLeq15,name:"ÏÉÅÏ≤òÎ°ú Í∏∞Ïñ¥Í∞ÄÎäî ÏïΩÎ≥ë",text:"Ï†ÑÌà¨ ÏãúÏûë Ïãú HP +2",unlockFlavor:"Ïî®ÏïóÏù¥ ÏûàÏóàÎÇò?",onCombatStart(e){vt(e,2),m(e,"Ïú†Î¨º[ÏÉÅÏ≤òÎ°ú Í∏∞Ïñ¥Í∞ÄÎäî ÏïΩÎ≥ë]: Ï†ÑÌà¨ ÏãúÏûë ÌöåÎ≥µ +2")}},relic_counting_needle:{id:"relic_counting_needle",dormantName:"Î©àÏ∂ò Î∞îÎäò",dormantText:"ÏãúÍ≥ÑÏùºÍπå? ÏãúÍ≥ÑÍ∞Ä ÏïÑÎãêÍπå? Îëò Îã§ ÏïÑÎãàÎã§.",unlockHint:"Ï°∞Í±¥: ÏïÑÎ¨¥ ÌñâÎèôÎèÑ ÌïòÏßÄ ÏïäÍ≥† ÌÑ¥ Ï¢ÖÎ£å 1Ìöå",art:"assets/relics/relic_counting_needle.png",unlock:e=>!!e.run.unlock?.skippedTurn,name:"Ïà®ÏùÑ ÏÑ∏Îäî Î∞îÎäò",text:"ÌÑ¥ Ï¢ÖÎ£å Ïãú Îã§Ïùå ÌÑ¥ üÉè ÎìúÎ°úÏö∞ +1",unlockFlavor:"Î∞îÎäòÏù¥ ÎèàÎã§. ÏïÑÎ¨¥Í≤ÉÎèÑ ÏóÜÏù¥.",onUpkeepEnd(e){e._extraDrawNextTurn=Number(e._extraDrawNextTurn??0)+1,m(e,"Ïú†Î¨º[Ïà®ÏùÑ ÏÑ∏Îäî Î∞îÎäò]: Îã§Ïùå ÌÑ¥ ÎìúÎ°úÏö∞ +1")}},relic_deeper_needle:{id:"relic_deeper_needle",dormantName:"ÎºàÎ°ú ÎßåÎì† Î∞îÎäò",dormantText:"Îî∞ÎÅîÌï®Ïóê ÏùµÏàôÌïú ÏßÄ Ïò§ÎûòÎã§.",unlockHint:"Ï°∞Í±¥: Ï†ÅÏóêÍ≤å ü©∏ Ï∂úÌòà Î∂ÄÏó¨ 3Ìöå",art:"assets/relics/relic_deeper_needle.png",unlock:e=>(e.run.unlock?.bleedApplied??0)>=3,name:"Îçî ÍπäÏùÄ Î∞îÎäò",text:"ü©∏ Ï∂úÌòàÏùÑ Î∂ÄÏó¨Ìï† ÎïåÎßàÎã§ +1 Ï∂îÍ∞Ä",unlockFlavor:"Î∞îÎäòÏù¥ ÌîºÎ•º Î®πÍ≥† Í∏∏Ïñ¥ÏßÑ Í≤É Í∞ôÎã§.",onCombatStart(e){e._bleedBonusPerApply=1},onVictory(e){delete e._bleedBonusPerApply}}},yr={rest:0,eliteWins:0,tookBigHit10:!1,kills:0,endedTurnWeak:!1,eventPicks:0,hpLeq15:!1,skippedTurn:!1,bleedApplied:0};function ke(e){e.run.relics??=[];const t=e.run;t.relicRuntime??={},t.pendingRelicActivations??=[],t.unlock??={...yr}}function Sn(e){return ke(e),e.run.relicRuntime}function gn(e){return ke(e),e.run.pendingRelicActivations}function ce(e){return ke(e),e.run.unlock}function We(e,t){const n=Sn(e);if(n[t])return n[t];const o=!j[t]?.unlock;return n[t]={active:o,pending:!1,obtainedAtNode:e.run.nodePickCount},n[t]}function br(e,t){return!!We(e,t).active}function xr(e,t){const n=e.run;return n.forceLockedRelics?.[t]===!0?!1:!!(n.forceUnlockedRelics?.[t]===!0||n.relicUnlocked?.[t]===!0||Array.isArray(n.unlockedRelics)&&n.unlockedRelics.includes(t)||n.unlockProgress?.relics?.[t]===!0||n.unlocks?.relics?.[t]===!0||(e.run.relics??[]).includes(t))}function Ze(e,t){const n=j[t],r=n?.name??t,o=n?.text??"",s=e.run.relicRuntime?.[t]??null,i=!!n?.unlock,d=xr(e,t),l=i&&d&&n?.unlockFlavor?`

${n.unlockFlavor}`:"";if(s?.active===!0&&(!i||d))return{id:t,state:"ACTIVE",name:r,text:`${o}${l}`};const f=s?.pending===!0?"PENDING":"DORMANT";if(i&&!d){const p=n?.dormantName??r,k=[];n?.dormantText&&k.push(n.dormantText),n?.unlockHint&&k.push(n.unlockHint);const A=k.length?k.join(`
`):o;return{id:t,state:f,name:p,text:A}}return{id:t,state:f,name:r,text:`${o}${l}`}}function vn(e,t){ke(e),e.run.relics.includes(t)||e.run.relics.push(t);const n=j[t],r=We(e,t);if(!n?.unlock){r.active=!0,r.pending=!1,m(e,`Ïú†Î¨º ÌöçÎìù: ${n?.name??t}`);return}r.active=!1;const o=Ze(e,t);m(e,`Ïú†Î¨º ÌöçÎìù: ${o.name}`),ie(e)}function kr(e,t){const n=We(e,t);if(n.active||n.pending)return;n.pending=!0;const r=gn(e);r.includes(t)||r.push(t);const o=j[t];m(e,`Ïú†Î¨º Ï°∞Í±¥ Îã¨ÏÑ±: ${o?.name??t} (Îã§Ïùå ÎÖ∏ÎìúÎ∂ÄÌÑ∞ ÌôúÏÑ±)`)}function ie(e){ke(e);for(const t of e.run.relics){const n=j[t];if(!n?.unlock)continue;const r=We(e,t);r.active||r.pending||n.unlock(e)&&kr(e,t)}}function Z(e){ke(e);const t=gn(e);if(!t.length)return;e.run.pendingRelicActivations=[];const n=Sn(e);for(const r of t){const o=n[r]??We(e,r);if(!o.pending)continue;o.pending=!1,o.active=!0,o.activatedAtNode=e.run.nodePickCount;const a=j[r];a?.onActivate?.(e),m(e,`Ïú†Î¨º ÌôúÏÑ±Ìôî: ${a?.name??r}`)}}function Tr(e){return ke(e),e.run.relics??[]}function Dt(e){return Tr(e).filter(t=>br(e,t))}function Ue(e,t,...n){for(const r of Dt(e)){const o=j[r];if(!o)continue;const a=o[t];a?.(e,...n)}}function le(e,t){let n=t.current;for(const r of Dt(e)){const a=j[r]?.modifyDamage;if(!a)continue;const s=a(e,{...t,current:n});n=Number.isFinite(s)?s:n,n<0&&(n=0)}return n}function wn(e,t,n){for(const r of Dt(e))j[r]?.onDamageApplied?.(e,t,n)}const Cr={other_adventurer:new Set([1]),slime:new Set([0,1]),pebble_golem:new Set([1]),rock_golem:new Set([1]),poison_spider:new Set([0,2]),boss_cursed_wall:new Set([0]),boss_giant_orc:new Set([1])};function Er(e,t){const n=Cr[e];return!!n&&n.has(t)}function Ct(e){if(e===null)return"null";const t=typeof e;return t==="number"||t==="boolean"?String(e):t==="string"?JSON.stringify(e):Array.isArray(e)?"["+e.map(Ct).join(",")+"]":t==="object"?"{"+Object.keys(e).sort().map(r=>JSON.stringify(r)+":"+Ct(e[r])).join(",")+"}":JSON.stringify(String(e))}function _n(e){if(!e)return"NONE";const t={};for(const n of Object.keys(e))n==="label"||n==="text"||n==="desc"||n==="name"||(t[n]=e[n]);return t.effects&&Array.isArray(t.effects)&&(t.effects=t.effects.map(n=>{const r={};for(const o of Object.keys(n??{}))o==="label"||o==="text"||o==="desc"||o==="name"||(r[o]=n[o]);return r})),Ct(t)}function Sr(e,t){const n=e.lastIntentKey??null,r=e.lastIntentStreak??0;n===t?e.lastIntentStreak=Math.min(3,r+1):(e.lastIntentKey=t,e.lastIntentStreak=1)}function gr(e,t,n,r,o){const a=e.length;if(a<=1)return 0;const s=Array.from({length:a},(p,k)=>k),i=p=>p===t&&Er(n,p),d=p=>!!r&&o>=2&&_n(e[p])===r,l=s.filter(p=>!i(p)&&!d(p));if(l.length>0)return G(l);const h=s.filter(p=>!d(p));if(h.length>0)return G(h);const f=s.filter(p=>!i(p));return f.length>0?G(f):G(s)}function vr(e){return e.deck.length+e.hand.length+e.discard.length+e.frontSlots.filter(Boolean).length+e.backSlots.filter(Boolean).length+e.exhausted.length}function wr(e,t){const n=Math.ceil(t/e.div);let r=e.base+e.per*n;return e.cap!=null&&(r=Math.min(r,e.cap)),{dmg:r,scale:n}}const _r=2,Pr=.6;function Ft(e){if(e.intentsRevealedThisTurn)return;e.intentsRevealedThisTurn=!0,e.attackedEnemyIndicesThisTurn=[],e.backUidsThisTurn=[],e.drawCountThisTurn=0,e.phase="REVEAL",e.player.immuneToDisruptThisTurn=!1,e.player.nullifyDamageThisTurn=!1,e.disruptIndexThisTurn=null,e.backSlotDisabled=[!1,!1,!1],(e.player.status.disrupt??0)>0&&(e.disruptIndexThisTurn=Math.floor(Math.random()*3),e.backSlotDisabled[e.disruptIndexThisTurn]=!0);for(const n of e.enemies)n.immuneThisTurn=n.immuneNextTurn,n.immuneNextTurn=!1;for(const n of Y(e)){n.intentLabelOverride=void 0;const o=e.content.enemiesById[n.id].intents;if(!o||o.length===0)continue;const a=gr(o,n.intentIndex??0,n.id,n.lastIntentKey??null,n.lastIntentStreak??0);n.intentIndex=a;const s=o[a%o.length];if(Sr(n,_n(s)),n.id==="boss_soul_stealer"){n.soulWillNukeThisTurn=!1;const h=n.soulWarnCount??0;if(!!n.soulArmed){if(Math.random()<Pr){n.soulWillNukeThisTurn=!0,n.intentLabelOverride="Ï¢ÖÎßê: 50 ÌîºÌï¥",m(e,`Ï†Å ÏùòÎèÑ: ${n.name} ‚Üí ${n.intentLabelOverride}`);continue}const k=o[n.intentIndex%o.length];n.intentLabelOverride=`${k.label} (‚ö† Ìè≠Î∞ú Í∞ÄÎä• ÏÉÅÌÉú)`,m(e,`Ï†Å ÏùòÎèÑ: ${n.name} ‚Üí ${n.intentLabelOverride}`);continue}const p=o[n.intentIndex%o.length];n.intentLabelOverride=`${p.label} (Í≤ΩÍ≥† ${h}/3)`,m(e,`Ï†Å ÏùòÎèÑ: ${n.name} ‚Üí ${n.intentLabelOverride}`);continue}const i=o[n.intentIndex%o.length];let d=i.label;const l=i.acts.find(h=>h.op==="damagePlayerByDeckSize");if(l&&l.op==="damagePlayerByDeckSize"){const h=vr(e),{dmg:f}=wr(l,h);d=`${i.label.split(":")[0].trim()}: ${f} ÌîºÌï¥`}n.intentLabelOverride=d,m(e,`Ï†Å ÏùòÎèÑ: ${n.name} ‚Üí ${d}`)}e.disruptIndexThisTurn!==null&&m(e,`ÍµêÎûÄ: Ïù¥Î≤à ÌÑ¥ ÌõÑÏó¥ ${e.disruptIndexThisTurn} Î¨¥Ìö®`),Ue(e,"onReveal"),e.phase="PLACE"}const $r=_r;function Zt(e,t){const n=e.game,r={kind:"damageSelect",amount:t,sourceCardUid:e.cardUid,reason:e.side==="front"?"FRONT":"BACK"};n.pendingTargetQueue??=[],n.pendingTarget==null?n.pendingTarget=r:n.pendingTargetQueue.push(r),m(n,`ÎåÄÏÉÅ ÏÑ†ÌÉù ÌïÑÏöî: Ï†ÅÏùÑ ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî. (${1+n.pendingTargetQueue.length}Í∞ú ÎÇ®Ïùå)`)}function Ar(e,t,n){const r=e.game,o={kind:"statusSelect",key:t,n,sourceCardUid:e.cardUid,reason:e.side==="front"?"FRONT":"BACK"};r.pendingTargetQueue??=[],r.pendingTarget==null?r.pendingTarget=o:r.pendingTargetQueue.push(o),m(r,"ÎåÄÏÉÅ ÏÑ†ÌÉù ÌïÑÏöî: Ï†ÅÏùÑ ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî.")}function Nr(e,t){if(t.id==="boss_soul_stealer"&&t.soulWillNukeThisTurn)return!0;const n=e.content.enemiesById[t.id];return n.intents[t.intentIndex%n.intents.length].acts.some(o=>o.op==="damagePlayer"||o.op==="damagePlayerFormula"||o.op==="damagePlayerByDeckSize")}function De(e,t){const n=e.game;for(const r of t)switch(r.op){case"block":io(n,r.n);break;case"supplies":lo(n,r.n);break;case"fatigue":xe(n,r.n);break;case"heal":vt(n,r.n);break;case"hp":n.player.hp=Math.max(0,Math.min(n.player.maxHp,n.player.hp+r.n)),m(n,`HP ${r.n>=0?"+":""}${r.n} (ÌòÑÏû¨ ${n.player.hp}/${n.player.maxHp})`);break;case"maxHp":n.player.maxHp+=r.n,n.player.hp=Math.min(n.player.maxHp,n.player.hp+r.n),m(n,`ÏµúÎåÄ HP +${r.n} (ÌòÑÏû¨ ${n.player.hp}/${n.player.maxHp})`);break;case"setSupplies":n.player.supplies=Math.max(0,r.n),m(n,`Î≥¥Í∏â SÎ•º ${n.player.supplies}ÏúºÎ°ú ÏÑ§Ï†ï`);break;case"draw":{const o=zt(n,r.n);n.drawCountThisTurn+=o;break}case"ifDrewThisTurn":{n.drawCountThisTurn>0&&De(e,r.then);break}case"damageEnemy":if(r.target==="random"){const o=Y(n);if(o.length===0)break;Oe(n,G(o),r.n)}else if(r.target==="all")for(const o of Y(n))Oe(n,o,r.n);else Zt(e,r.n);break;case"clearStatusSelf":{const o=r.key;n.player.status[o]=0,m(n,`ÏÉÅÌÉú Ìï¥Ï†ú: ${o} = 0`);break}case"damageEnemyBy":{if(r.target!=="random")break;const o=Y(n);if(o.length===0)break;let a=0;r.by==="frontCount"&&(a=n.frontSlots.filter(Boolean).length*r.nPer),Oe(n,G(o),a);break}case"damageEnemyByPlayerFatigue":{const o=Math.max(0,n.player.fatigue*r.mult);if(r.target==="random"){const a=Y(n);if(a.length===0)break;Oe(n,G(a),o);break}if(r.target==="select"){if(o<=0)break;Zt(e,o);break}break}case"statusPlayer":n.player.status[r.key]=Math.max(0,(n.player.status[r.key]??0)+r.n),m(n,`ÌîåÎ†àÏù¥Ïñ¥ ÏÉÅÌÉú: ${r.key} ${r.n>=0?"+":""}${r.n}`);break;case"statusEnemy":if(r.target==="random"){const o=Y(n);if(o.length===0)break;const a=G(o);if(Me(a,r.key,r.n,n,"PLAYER"),m(n,`Ï†Å(${a.name}) ÏÉÅÌÉú: ${r.key} ${r.n>=0?"+":""}${r.n}`),r.key==="bleed"&&r.n>0){const s=ce(n);s.bleedApplied+=1,ie(n)}}else if(r.target==="all"){const o=Y(n);if(o.length===0)break;for(const a of o)Me(a,r.key,r.n,n,"PLAYER");if(m(n,`Î™®Îì† Ï†Å ÏÉÅÌÉú: ${r.key} ${r.n>=0?"+":""}${r.n}`),r.key==="bleed"&&r.n>0){const a=ce(n);a.bleedApplied+=o.length,ie(n)}}else Ar(e,r.key,r.n);break;case"statusEnemiesAttackingThisTurn":{const o=Y(n).filter(a=>Nr(n,a));if(o.length===0){m(n,`Ïù¥Î≤à ÌÑ¥ Í≥µÍ≤© ÏùòÎèÑ Ï†Å ÏóÜÏùå ‚Üí ${r.key} Ï†ÅÏö© ÏóÜÏùå`);break}for(const a of o)a.status[r.key]=Math.max(0,(a.status[r.key]??0)+r.n);m(n,`Í≥µÍ≤© ÏùòÎèÑ Ï†ÅÏóêÍ≤å ${r.key} ${r.n>=0?"+":""}${r.n} (ÎåÄÏÉÅ ${o.length})`);break}case"immuneDisruptThisTurn":n.player.immuneToDisruptThisTurn=!0,m(n,"Ïù¥Î≤à ÌÑ¥ ÍµêÎûÄ Î¨¥Ïãú");break;case"nullifyDamageThisTurn":n.player.nullifyDamageThisTurn=!0,m(n,"Ïù¥Î≤à ÌÑ¥ Ï†Å Í≥µÍ≤© ÌîºÌï¥ Î¨¥Ìö®");break;case"triggerFrontOfBackSlot":{const o=n.backSlots[r.index];if(!o){m(n,`Ïû¨Î∞∞Ïπò: ÌõÑÏó¥ ${r.index+1}Î≤à Ïä¨Î°ØÏù¥ ÎπÑÏñ¥ ÏûàÏùå`);break}const a=de(n,o);m(n,`Ïû¨Î∞∞Ïπò: [[${Ee(n,o)}]]Ïùò Ï†ÑÏó¥ Ìö®Í≥ºÎ•º Ï∂îÍ∞Ä Î∞úÎèô`),De({game:n,side:"front",cardUid:o},a.front);break}default:return r}}function Ir(e){if(e.run.treasureObtained)return;e.run.treasureObtained=!0,e.run.afterTreasureNodePicks=0,e.run.deckSizeAtTreasure=lt(e);const t=Nn(e);e.cards[t]={uid:t,defId:"goal_treasure",zone:"deck",upgrade:0},e.deck.push(t),e.deck=Mt(e.deck),m(e,"Ï†ÄÏ£ºÎ∞õÏùÄ Î≥¥Î¨ºÏùÑ ÌöçÎìùÌñàÏäµÎãàÎã§! Îç±Ïóê [Ï†ÄÏ£ºÎ∞õÏùÄ Î≥¥Î¨º] Ï∂îÍ∞Ä")}const Rr=["arrow","shield","scout","field_ration"],He=[{id:"mad_echo",weight:20},{id:"mad_insight",weight:12},{id:"mad_bargain",weight:3}],$e=[{id:"berserk",weight:20},{id:"bandage",weight:12},{id:"arrow_rain",weight:20},{id:"smoke",weight:0},{id:"redeploy",weight:12},{id:"secret_strike",weight:3},{id:"fire_scroll",weight:3},{id:"caltrops",weight:12},{id:"emergency_rations",weight:3},{id:"painkiller",weight:12},{id:"field_experience",weight:3},{id:"camp_prep",weight:20},{id:"vital_shot",weight:12},{id:"taunt",weight:12},{id:"rapid_fire",weight:20}];function Ke(e,t,n){const r=n?$n(t,n):Pn(t);return{defId:Et(r),upgrade:t===He?0:St(e)}}function qe(e,t,n){const r=n?$n(t,n):Pn(t),o=Et(r),a=r.filter(h=>h.id!==o),s=Et(a),i=t===He,d=i?0:St(e),l=i?0:St(e);return[{defId:o,upgrade:d},{defId:s,upgrade:l}]}function Br(e){const{tier:t}=it(e);return Math.random()<(t===0?0:t===1?.15:t===2?.35:.6)}function Pn(e){const t=new Map;for(const n of e){const r=Math.max(0,n.weight??0);r<=0||t.set(n.id,(t.get(n.id)??0)+r)}return[...t.entries()].map(([n,r])=>({id:n,w:r}))}function $n(e,t={}){const n=t.mult3??1,r=t.mult12??1,o=t.mult20??1,a=new Map;for(const s of e){const i=Math.max(0,s.weight??0);if(i<=0||i===3&&t.drop3||i===12&&t.drop12||i===20&&t.drop20)continue;let d=null;i===3?d=i*n:i===12?d=i*r:i===20?d=i*o:d=i,!(d<=0)&&a.set(s.id,(a.get(s.id)??0)+d)}return[...a.entries()].map(([s,i])=>({id:s,w:i}))}function Et(e){let t=0;for(const r of e)t+=r.w;if(t<=0)throw new Error("No positive weights to pick from.");let n=Math.random()*t;for(const r of e)if(n-=r.w,n<=0)return r.id;return e[e.length-1].id}function St(e){const t=e?.player?.fatigue??0;if((e?.run.nodePickCount??999)<=6)return 0;const r=.1,o=t>=12?0:t>=9?.25:t>=6?.5:1;return Math.random()<r*o?1:0}function An(e){const t=e.player?.fatigue??0,n={defId:G(Rr),upgrade:0},r=()=>t<=3?qe(e,$e):t<=6?qe(e,$e,{mult3:.25,mult12:.75,mult20:1}):t<=8?qe(e,$e,{mult3:.1,mult12:.55,mult20:1}):qe(e,$e,{drop3:!0,mult12:.45,mult20:1}),o=i=>Br(e)?Ke(e,He):i;if(t<=8){if(t<=6){const[h,f]=r();return[o(h),o(f)]}const i=t===7?.3:.55;if(Math.random()<i){const[h]=r(),f=o(h);return Math.random()<.5?[n,f]:[f,n]}const[d,l]=r();return[o(d),o(l)]}if(t<=11){const i=o(Ke(e,$e,{drop3:!0,mult12:.45,mult20:1}));return Math.random()<.5?[n,i]:[i,n]}const a=Ke(e,He),s=Math.random()<.65?Ke(e,He):n;return Math.random()<.5?[a,s]:[s,a]}function Or(e){const t=An(e),n=t[0]??{defId:"arrow",upgrade:0},r=t[1]??{defId:"shield",upgrade:0};return[n,r]}function Nn(e){return e.uidSeq+=1,`c_${e.uidSeq}`}function et(e,t,n){const r=Nn(e);e.cards[r]={uid:r,defId:t,zone:"deck",upgrade:n?.upgrade??0},e.deck.push(r)}function Hr(e){const t=Object.values(e.cards).filter(r=>r.zone==="deck"||r.zone==="hand"||r.zone==="discard");if(t.length===0)return;const n=G(t);e.cards[n.uid].zone="vanished",e.vanished.push(n.uid),e.deck=e.deck.filter(r=>r!==n.uid),e.hand=e.hand.filter(r=>r!==n.uid),e.discard=e.discard.filter(r=>r!==n.uid),m(e,`Ïπ¥Îìú Ï†úÍ±∞: [${de(e,n.uid).name} +${e.cards[n.uid].upgrade??0}]`)}const Lr="goal_treasure";function Wt(e,t){const n=e.cards[t];if(n){if(n.defId===Lr){m(e,"Ï†ÄÏ£ºÎ∞õÏùÄ Î≥¥Î¨ºÏùÄ Îç±ÏóêÏÑú Ï†úÍ±∞Ìï† Ïàò ÏóÜÏäµÎãàÎã§.");return}e.deck=e.deck.filter(r=>r!==t),e.hand=e.hand.filter(r=>r!==t),e.discard=e.discard.filter(r=>r!==t),e.frontSlots=e.frontSlots.map(r=>r===t?null:r),e.backSlots=e.backSlots.map(r=>r===t?null:r),n.zone="vanished",e.vanished.push(t),m(e,`Ïπ¥Îìú Ï†úÍ±∞: [${de(e,n.uid).name} +${e.cards[n.uid].upgrade??0}]`)}}function Ut(e,t){const n=e.cards[t];if(!n)return!1;const o=e.content.cardsById[n.defId].upgrades?.length??0;return(n.upgrade??0)<o}function In(e,t){return Ut(e,t)?(e.cards[t].upgrade=(e.cards[t].upgrade??0)+1,!0):!1}function Rn(e,t,n=null){if(e.choiceQueue??=[],!e.choice){e.choice=t,e.choiceCtx=n;return}e.choiceQueue.push({choice:t,ctx:n})}function gt(e,t,n=null){e.choiceQueue=[],e.choice=t,e.choiceCtx=n}function Bn(e){e.choice=null,e.choiceCtx=null}function ne(e){e.choiceQueue=[],Bn(e),e.phase==="NODE"&&Z(e)}function fe(e){const t=e.choiceQueue??[];if(t.length>0){const n=t.shift()??null;if(n){e.choice=n.choice,e.choiceCtx=n.ctx,e.choiceQueue=t;return}}Bn(e),e.phase==="NODE"&&Z(e)}function Mr(e){const t=new Set(e.run.relics??[]);return Object.keys(j).filter(n=>{const r=j[n];return!(!r||r.debugOnly||t.has(n))})}function Dr(e,t=1){const n=Mr(e);if(n.length===0)return null;const r=[],o=n.slice(),a=Math.min(t,o.length);for(let s=0;s<a;s++){const i=G(o),d=o.indexOf(i);d>=0&&o.splice(d,1);const l=j[i]??{};r.push({id:i,name:l.name??String(i),desc:l.desc??l.description??l.text,art:l.art})}return{choices:r}}function Fr(e){const t=Or(e);if(!t)return;const[n,r]=t,o=se(e.content,n.defId,n.upgrade),a=se(e.content,r.defId,r.upgrade),s=`${o.name}${n.upgrade>0?` +${n.upgrade}`:""}`,i=`${a.name}${r.upgrade>0?` +${r.upgrade}`:""}`,d={kind:"REWARD",title:"Ï†ÑÌà¨ Î≥¥ÏÉÅ",prompt:"Ïπ¥Îìú 1Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÍ±∞ÎÇò ÏÉùÎûµÌï©ÎãàÎã§.",options:[{key:`pick:${n.defId}:${n.upgrade}`,label:s,detail:`Ï†ÑÏó¥: ${o.frontText} / ÌõÑÏó¥: ${o.backText}`},{key:`pick:${r.defId}:${r.upgrade}`,label:i,detail:`Ï†ÑÏó¥: ${a.frontText} / ÌõÑÏó¥: ${a.backText}`},{key:"skip",label:"ÏÉùÎûµ",detail:""}]};Rn(e,d,{kind:"BATTLE_CARD_REWARD",offers:[n,r]})}function Wr(e){if(!e.run.lastBattleWasElite||e.run.eliteRelicOfferedThisBattle)return;const t=Dr(e,1);if(!t)return;e.run.eliteRelicOfferedThisBattle=!0;const n=t.choices[0];if(!n)return;const r=n.id,o=j[r],a=!!o?.unlock,s=a?o?.dormantName??o?.name??r:o?.name??r,i=a?[o?.dormantText,o?.unlockHint].filter(Boolean).join(`
`):o?.text??"",l={kind:"REWARD",title:"Ï†ïÏòà Î≥¥ÏÉÅ: Ïú†Î¨º",prompt:"Ïú†Î¨ºÏùÑ Î∞õÍ±∞ÎÇò ÏÉùÎûµÌï©ÎãàÎã§.",options:[{key:"take",label:"Î∞õÍ∏∞",detail:`${s}

${i}`},{key:"skip",label:"ÏÉùÎûµ",detail:""}]};l.art=o?.art??void 0,Rn(e,l,{kind:"ELITE_RELIC",offerIds:[r]})}function Ur(e,t){if(!e.choice)return!1;if(t==="take"){if(e.choiceCtx?.kind!=="ELITE_RELIC")return!1;const r=e.choiceCtx.offerIds?.[0];return r?(e.run.relics??=[],e.run.relics.includes(r)||e.run.relics.push(r),m(e,`Ïú†Î¨º ÌöçÎìù: ${j[r]?.name??r}`),fe(e),!0):!1}if(t==="skip")return m(e,"Î≥¥ÏÉÅÏùÑ ÏÉùÎûµÌñàÏäµÎãàÎã§."),fe(e),!0;if(t.startsWith("pick:")){const r=t.split(":"),o=r[1]??"",a=Number(r[2]??0);return o?(et(e,o,{upgrade:Number.isFinite(a)?a:0}),m(e,`Ïπ¥Îìú ÌöçÎìù: ${o}${a>0?` +${a}`:""}`),fe(e),!0):!1}if(t.startsWith("up:")){const r=t.slice(3);if(!r)return!1;const o=e.cards[r];if(!o)return!1;const s=e.content.cardsById[o.defId]?.upgrades??[],i=o.upgrade??0;if(i>=s.length)return m(e,"Ïù¥ÎØ∏ ÏµúÎåÄ Í∞ïÌôîÏûÖÎãàÎã§."),fe(e),!0;o.upgrade=i+1;const d=se(e.content,o.defId,o.upgrade);return m(e,`Ïπ¥Îìú Í∞ïÌôî: ${d.name} +${o.upgrade}`),fe(e),!0}if(t.startsWith("remove:")){const r=t.slice(7);if(!r)return!1;const o=e.deck.indexOf(r);o>=0&&e.deck.splice(o,1);const a=e.hand.indexOf(r);a>=0&&e.hand.splice(a,1);const s=e.discard.indexOf(r);return s>=0&&e.discard.splice(s,1),delete e.cards[r],m(e,"Ïπ¥ÎìúÎ•º Ï†úÍ±∞ÌñàÏäµÎãàÎã§."),fe(e),!0}if(t.startsWith("relic:")){const r=t.slice(6);return!r||e.choiceCtx?.kind==="ELITE_RELIC"&&!e.choiceCtx.offerIds.includes(r)?!1:(e.run.relics??=[],e.run.relics.includes(r)||vn(e,r),m(e,`Ïú†Î¨º ÌöçÎìù: ${j[r]?.name??r}`),fe(e),!0)}return!1}function zr(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}function Kr(e){const t=[];for(const a of e.deck)t.push(a);for(const a of e.hand)t.push(a);for(const a of e.discard)t.push(a);for(const a of e.frontSlots)a&&t.push(a);for(const a of e.backSlots)a&&t.push(a);for(const a of e.exhausted)t.push(a);const n=new Set,o=t.filter(a=>n.has(a)?!1:(n.add(a),!0)).filter(a=>e.cards[a]?.zone!=="vanished");e.deck=o;for(const a of o)e.cards[a].zone="deck";e.hand=[],e.discard=[],e.frontSlots=[null,null,null],e.backSlots=[null,null,null],e.selectedHandCardUid=null,e.exhausted=[],e.pendingTarget=null,e.pendingTargetQueue=[],zr(e.deck)}function qr(e){if(!e.winHooksAppliedThisCombat){e.winHooksAppliedThisCombat=!0;for(const t of e.backUidsThisTurn){if(!e.cards[t])continue;const o=de(e,t).onWinWhileInBack;!o||o.length===0||De({game:e,side:"back",cardUid:t},o)}}}function Vr(e){const t=e.run.deckSizeAtTreasure??null;return t==null?10:Je(t)}function _e(e){if(e.player.hp<=0){on(e),e.run.finished=!0,m(e,"Ìå®Î∞∞: Ï£ΩÏóàÏäµÎãàÎã§.");return}if(!e.victoryResolvedThisCombat&&Y(e).length===0&&e.phase!=="NODE"){if(e.victoryResolvedThisCombat=!0,on(e),qr(e),m(e,"Ï†ÅÏùÑ Î™®Îëê Ï≤òÏπò!"),e.run.lastBattleWasElite){const t=ce(e);t.eliteWins+=1,ie(e)}if(Kr(e),e.enemies=[],e.player.zeroSupplyTurns=0,Ue(e,"onVictory"),Wr(e),Fr(e),e.phase="NODE",e.run.treasureObtained){const t=Vr(e);if(e.run.afterTreasureNodePicks>=t){e.run.finished=!0,m(e,`ÏäπÎ¶¨! Ï†ÄÏ£ºÎ∞õÏùÄ Î≥¥Î¨ºÏùÑ ÏñªÏùÄ ÌõÑ ${t}Î≤àÏùò ÌÉêÌóò ÎèôÏïà ÏÇ¥ÏïÑÎÇ®ÏïòÏäµÎãàÎã§.`);return}}return}}function lt(e){return e.deck.length+e.hand.length+e.discard.length+e.frontSlots.filter(Boolean).length+e.backSlots.filter(Boolean).length+e.exhausted.length}function Ae(e){e.player.block=0,e.player.status.vuln=0,e.player.status.weak=0,e.player.status.bleed=0,e.player.status.disrupt=0,e.player.zeroSupplyTurns=0,e.phase="REVEAL",e.frontSlots=[null,null,null],e.backSlots=[null,null,null],e.backSlotDisabled=[!1,!1,!1],e.backUidsThisTurn=[],e.hand=[],e.selectedHandCardUid=null,e.pendingTarget=null,e.pendingTargetQueue=[],e.usedThisTurn=0,e.frontPlacedThisTurn=0,e.winHooksAppliedThisCombat=!1,e.victoryResolvedThisCombat=!1,e.run.eliteRelicOfferedThisBattle=!1;const t=e.run.nextBattleSuppliesBonus??0;e.player.supplies=7+t,t!==0&&(m(e,`Îã§Ïùå Ï†ÑÌà¨ Î≥¥ÎÑàÏä§ Ï†ÅÏö©: S +${t}`),e.run.nextBattleSuppliesBonus=0),e.player.immuneToDisruptThisTurn=!1,e.player.nullifyDamageThisTurn=!1,e.intentsRevealedThisTurn=!1,e.disruptIndexThisTurn=null,e.drawCountThisTurn=0,e.attackedEnemyIndicesThisTurn=[],zt(e,4),Ft(e),e.phase="PLACE",Ue(e,"onCombatStart"),e._justStartedCombat=!0}function en(e,t,n,r){if(e.phase!=="PLACE"||!e.hand.includes(t))return;n==="back"&&(e.backUidsThisTurn.includes(t)||e.backUidsThisTurn.push(t));const o=n==="front"?e.frontSlots:e.backSlots;o[r]||(e.hand=e.hand.filter(a=>a!==t),o[r]=t,e.cards[t].zone=n,e.usedThisTurn+=1,n==="front"&&(e.frontPlacedThisTurn+=1),m(e,`[${Ee(e,t)}]Î•º ${n==="front"?"Ï†ÑÏó¥":"ÌõÑÏó¥"} ${r}Î≤àÏóê Î∞∞Ïπò`),Ue(e,"onPlaceCard",{side:n,idx:r,cardUid:t}))}function tn(e,t,n){return de(e,t).tags?.includes(n)??!1}function jr(e,t){e.frontSlots=e.frontSlots.map(n=>n===t?null:n),e.backSlots=e.backSlots.map(n=>n===t?null:n)}function nn(e,t,n){const r=de(e,t);jr(e,t),e.hand=e.hand.filter(d=>d!==t),e.deck=e.deck.filter(d=>d!==t),e.discard=e.discard.filter(d=>d!==t);const o=r.vanishWhen,a=r.exhaustWhen,s=o==="BOTH"||o==="FRONT"&&n==="front"||o==="BACK"&&n==="back",i=a==="BOTH"||a==="FRONT"&&n==="front"||a==="BACK"&&n==="back";if(o&&o!=="NONE"&&s){e.vanished.push(t),e.cards[t].zone="vanished",m(e,`[${Ee(e,t)}] ÏÜåÏã§(ÏòÅÍµ¨ Ï†úÍ±∞)`);return}if(a&&a!=="NONE"&&i){e.exhausted.push(t),e.cards[t].zone="exhausted",m(e,`[${Ee(e,t)}] ÏÜåÎ™®(Ïù¥Î≤à Ï†ÑÌà¨ÏóêÏÑú Ï†úÍ±∞)`);return}if(!o&&tn(e,t,"VANISH")){e.vanished.push(t),e.cards[t].zone="vanished",m(e,`[${Ee(e,t)}] ÏÜåÏã§(ÏòÅÍµ¨ Ï†úÍ±∞)`);return}if(!a&&tn(e,t,"EXHAUST")){e.exhausted.push(t),e.cards[t].zone="exhausted",m(e,`[${Ee(e,t)}] ÏÜåÎ™®(Ïù¥Î≤à Ï†ÑÌà¨ÏóêÏÑú Ï†úÍ±∞)`);return}e.discard.push(t),e.cards[t].zone="discard"}function Yr(e){for(let t=0;t<3;t++){const n=e.frontSlots[t];n&&nn(e,n,"front"),e.frontSlots[t]=null;const r=e.backSlots[t];r&&nn(e,r,"back"),e.backSlots[t]=null}}function Xr(e){if(!(e.phase!=="PLACE"&&e.phase!=="BACK")){e.phase="BACK",m(e,"=== ÌõÑÏó¥ Îã®Í≥Ñ ===");for(let t=0;t<3;t++){const n=e.backSlots[t];if(!n)continue;const r=de(e,n);if(!e.player.immuneToDisruptThisTurn&&e.backSlotDisabled[t]){m(e,`ÌõÑÏó¥ ${t}Î≤à [${r.name}] ÍµêÎûÄÏúºÎ°ú Î¨¥Ìö®`);continue}De({game:e,side:"back",cardUid:n},r.back)}e.phase="FRONT"}}function Gr(e){if(e.phase==="FRONT"){m(e,"=== Ï†ÑÏó¥ Îã®Í≥Ñ ===");for(let t=0;t<3;t++){const n=e.frontSlots[t];if(!n)continue;const r=de(e,n);De({game:e,side:"front",cardUid:n},r.front)}e.phase="ENEMY"}}const Qr=.6;function Jr(e){if(e.phase==="ENEMY"){m(e,"=== Ï†Å ÌñâÎèô ===");for(const t of Y(e)){const n=e.content.enemiesById[t.id],r=n.intents[t.intentIndex%n.intents.length];if(t.id==="boss_soul_stealer"){if(t.soulWillNukeThisTurn){const o=t.status.weak??0;he(e,50,"ENEMY_ATTACK","ÏòÅÌòº Í∞ïÌÉàÏûê",o),m(e,"ÏòÅÌòº Í∞ïÌÉàÏûê: ÏòÅÌòº Ìè≠Î∞ú ‚Üí 50 ÌîºÌï¥!"),t.soulWillNukeThisTurn=!1,t.soulArmed=!1,t.soulWarnCount=0;continue}for(const o of r.acts)rn(e,t,o);t.intentIndex===$r&&(t.soulWarnCount=(t.soulWarnCount??0)+1,m(e,`ÏòÅÌòº Í∞ïÌÉàÏûê: Í≤ΩÍ≥† +1 (${t.soulWarnCount}/3)`),(t.soulWarnCount??0)>=3&&(t.soulArmed=!0,m(e,"ÏòÅÌòº Í∞ïÌÉàÏûê: Í≤ΩÍ≥† 3Ìöå ÏôÑÎ£å ‚Üí Ìè≠Î∞ú Í∞ÄÎä• ÏÉÅÌÉú!"),Math.random()<Qr&&(t.soulWillNukeThisTurn=!0)));continue}for(const o of r.acts)rn(e,t,o)}e.phase="UPKEEP"}}function Zr(e){return e.deck.length+e.hand.length+e.discard.length+e.frontSlots.filter(Boolean).length+e.backSlots.filter(Boolean).length+e.exhausted.length}function eo(e,t){const n=Math.ceil(t/e.div);let r=e.base+e.per*n;return e.cap!=null&&(r=Math.min(r,e.cap)),{dmg:r,scale:n}}function rn(e,t,n){switch(n.op){case"damagePlayer":{const r=t.status.weak??0;he(e,n.n,"ENEMY_ATTACK",t.name,r);return}case"damagePlayerFormula":{if(n.kind==="goblin_raider"){const r=Math.max(0,12-e.usedThisTurn),o=t.status.weak??0;he(e,r,"ENEMY_ATTACK",t.name,o)}else{const r=4+e.usedThisTurn,o=t.status.weak??0;he(e,r,"ENEMY_ATTACK",t.name,o)}return}case"supplies":{e.player.supplies=Lt(e.player.supplies+n.n,0),m(e,`Ï†Å Ìö®Í≥º: Î≥¥Í∏â S ${n.n>=0?"+":""}${n.n} (ÌòÑÏû¨ ${e.player.supplies})`);return}case"statusPlayer":{Me(e.player,n.key,n.n,e,"ENEMY"),m(e,`Ï†Å Ìö®Í≥º: ÌîåÎ†àÏù¥Ïñ¥ ÏÉÅÌÉú ${n.key} ${n.n>=0?"+":""}${n.n}`);return}case"enemyHealSelf":{t.hp=Math.min(t.maxHp,t.hp+n.n),m(e,`Ï†Å(${t.name})Ïù¥(Í∞Ä) ${n.n} ÌöåÎ≥µ (HP ${t.hp}/${t.maxHp})`);return}case"enemyImmuneThisTurn":{t.immuneThisTurn=!0,m(e,`Ï†Å(${t.name})Ïù¥(Í∞Ä) ÌîºÌï¥ Î©¥Ïó≠ ÏÉÅÌÉúÍ∞Ä Îê®`);return}case"enemyImmuneNextTurn":{t.immuneNextTurn=!0,m(e,`Ï†Å(${t.name})Ïù¥(Í∞Ä) Îã§Ïùå ÌÑ¥ ÌîºÌï¥ Î©¥Ïó≠ ÏÉÅÌÉúÍ∞Ä Îê®`);return}case"fatiguePlayer":{e.player.fatigue=Math.max(0,e.player.fatigue+n.n),m(e,`Ï†Å Ìö®Í≥º: ÌîºÎ°ú F ${n.n>=0?"+":""}${n.n} (ÌòÑÏû¨ ${e.player.fatigue})`);return}case"damagePlayerByDeckSize":{const r=Zr(e),{dmg:o,scale:a}=eo(n,r);he(e,o,"ENEMY_ATTACK",t.name),m(e,`Ï§ëÎ†• ÌîºÌï¥: base ${n.base} + per ${n.per} * ceil(${r}/${n.div})=${a} => ${o}`);return}default:return n}}function to(e){if(e.phase!=="UPKEEP")return;m(e,"=== Ïú†ÏßÄÎπÑ / ÏÉÅÌÉú Ï≤òÎ¶¨ ===");{const o=ce(e);let a=!1;(e.player.status.weak??0)>0&&!o.endedTurnWeak&&(o.endedTurnWeak=!0,a=!0),(e.usedThisTurn??0)===0&&(e.frontPlacedThisTurn??0)===0&&(e.backUidsThisTurn?.length??0)===0&&!o.skippedTurn&&(o.skippedTurn=!0,a=!0),a&&ie(e)}const t=e.frontPlacedThisTurn;t>0&&m(e,`Ï†ÑÏó¥ Ïú†ÏßÄÎπÑ Ï≤òÎ¶¨: Ï†ÑÏó¥ ${t}Ïû•`);let n=!1;for(let o=0;o<t;o++)e.player.supplies>0?e.player.supplies-=1:n=!0;if(n&&(e.player.fatigue+=1,m(e,"Ï†ÑÏó¥ Ïú†ÏßÄÎπÑ Î∂ÄÏ°±! (F +1)")),e.player.supplies===0){e.player.zeroSupplyTurns+=1;const o=e.player.fatigue;he(e,o,"ZERO_SUPPLY",`Î≥¥Í∏â ÏóÜÏù¥ ÌÑ¥ Ï¢ÖÎ£å! ÌîºÌï¥ ${o}`)}const r=e.player.status.bleed??0;r>0&&he(e,r,"BLEED","Ï∂úÌòà");for(const o of Y(e)){const a=o.status.bleed??0;a>0&&(o.immuneThisTurn?m(e,`Ï†Å(${o.name})ÏùÄ(Îäî) Ïù¥Î≤à ÌÑ¥ Î©¥Ïó≠Ïù¥Îùº Ï∂úÌòà ÌîºÌï¥ Î¨¥Ïãú`):(o.hp=Math.max(0,o.hp-a),m(e,`Ï†Å(${o.name}) Ï∂úÌòàÎ°ú HP -${a} (HP ${o.hp}/${o.maxHp})`)))}e.frontPlacedThisTurn=0,no(e),Yr(e),Se(e),_e(e),Ue(e,"onUpkeepEnd"),e.phase="DRAW"}function no(e){const t=["vuln","weak","bleed","disrupt"];for(const n of t)e.player.status[n]>0&&(e.player.status[n]-=1);for(const n of e.enemies)for(const r of t)n.status[r]>0&&(n.status[r]-=1)}function ro(e){if(e.phase!=="DRAW"||(e.intentsRevealedThisTurn=!1,e.disruptIndexThisTurn=null,_e(e),e.run.finished))return;if(Y(e).length===0){On(e),e.phase="NODE";return}const t=e.usedThisTurn;e.usedThisTurn=0;const n=Number(e._extraDrawNextTurn??0);e._extraDrawNextTurn=0,zt(e,t+(n>0?n:0)),e.player.block>0&&(e.player.block=0,m(e,"Î∞©Ïñ¥(Î∏îÎ°ù) ÏÜåÏã§")),Ft(e),e.phase="PLACE",e.backUidsThisTurn=[],e.attackedEnemyIndicesThisTurn=[],e.drawCountThisTurn=0}function zt(e,t){let n=0;for(let r=0;r<t&&(oo(e),!e.run.finished);r++){const o=e.deck.pop();if(!o)break;e.hand.push(o),n++}return m(e,`ÎìúÎ°úÏö∞ ${n}/${t} (ÏÜêÌå® ${e.hand.length})`),n}function oo(e){e.deck.length===0&&e.discard.length>0&&(e.deck=Mt(e.discard),e.discard=[],e.player.fatigue+=1,m(e,`ÌîºÎ°úÎèÑ F +1 (ÏÖîÌîå, ÌòÑÏû¨ ${e.player.fatigue})`))}function On(e){e.player.block>0&&(e.player.block=0,m(e,"Î∞©Ïñ¥(Î∏îÎ°ù) ÏÜåÏã§")),e.intentsRevealedThisTurn=!1,e.disruptIndexThisTurn=null}function on(e){On(e)}function X(e){return e.pendingTarget!=null||(e.pendingTargetQueue?.length??0)>0}function ao(e,t){if(!e.pendingTarget)return!1;if(Y(e).length===0)return e.pendingTarget=null,e.pendingTargetQueue=[],e.selectedEnemyIndex=null,_e(e),!0;const n=e.enemies[t];if(!n||n.hp<=0)return!1;const r=e.pendingTarget;if(r.kind==="damageSelect")Oe(e,n,r.amount);else if(r.kind==="statusSelect"&&(Me(n,r.key,r.n,e,"PLAYER"),r.key==="bleed"&&r.n>0)){const o=ce(e);o.bleedApplied+=1,ie(e)}return Se(e),_e(e),Y(e).length===0?!0:(so(e),!e.pendingTarget&&(e.pendingTargetQueue?.length??0)===0)}function so(e){const t=e.pendingTargetQueue??[],n=t.shift()??null;e.pendingTarget=n,e.pendingTargetQueue=t,e.selectedEnemyIndex=null}function io(e,t){t<=0||(e.player.block+=t,m(e,`Î∞©Ïñ¥(Î∏îÎ°ù) +${t} (ÌòÑÏû¨ ${e.player.block})`))}function lo(e,t){e.player.supplies=Lt(e.player.supplies+t,0),m(e,`Î≥¥Í∏â S ${t>=0?"+":""}${t} (ÌòÑÏû¨ ${e.player.supplies})`)}function xe(e,t){e.player.fatigue=Lt(e.player.fatigue+t,0),m(e,`ÌîºÎ°ú F ${t>=0?"+":""}${t} (ÌòÑÏû¨ ${e.player.fatigue})`)}function vt(e,t){if(t<=0)return;const n=e.player.hp;e.player.hp=Math.min(e.player.maxHp,e.player.hp+t),m(e,`HP +${e.player.hp-n} (ÌòÑÏû¨ ${e.player.hp}/${e.player.maxHp})`)}function Se(e){Y(e).length===0&&(e.pendingTarget=null,e.pendingTargetQueue=[],e.selectedEnemyIndex=null)}function Oe(e,t,n){if(n<=0)return;const r=e.enemies.indexOf(t);if(r<0){m(e,`WARN: applyDamageToEnemy target not in g.enemies (${t?.id??"?"})`);return}if(e.attackedEnemyIndicesThisTurn.includes(r)||e.attackedEnemyIndicesThisTurn.push(r),t.immuneThisTurn){m(e,`Ï†Å(${t.name})ÏùÄ(Îäî) Ïù¥Î≤à ÌÑ¥ ÌîºÌï¥ Î©¥Ïó≠ ‚Üí ${n} ÌîºÌï¥ Î¨¥Ïãú`),Se(e);return}let o={target:"ENEMY",source:"PLAYER_ATTACK",raw:n,enemyIndex:r,enemyId:t.id},a=le(e,{...o,phase:"PRE_STATUS",current:n,targetVuln:t.status.vuln??0,attackerWeak:e.player.status.weak??0});const s=e.player.status.weak??0,i=t.status.vuln??0;if(a=a-s+i,a<0&&(a=0),a=le(e,{...o,phase:"POST_STATUS",current:a,afterStatus:a,targetVuln:i,attackerWeak:s}),a=le(e,{...o,phase:"FINAL",current:a,afterStatus:a,targetVuln:i,attackerWeak:s}),a<=0){m(e,`Ï†Å(${t.name})ÏóêÍ≤å ÌîºÌï¥ 0 (Ïú†Î¨º/ÏÉÅÌÉúÎ°ú ÏÉÅÏáÑ)`),Se(e);return}const d=t.hp;if(t.hp=Math.max(0,t.hp-a),m(e,`Ï†Å(${t.name})ÏóêÍ≤å ${a} ÌîºÌï¥. (HP ${t.hp}/${t.maxHp})`),d>0&&t.hp===0){const l=ce(e);l.kills+=1,ie(e)}wn(e,{...o,phase:"FINAL",current:a,afterStatus:a,targetVuln:i,attackerWeak:s},a),Se(e),Y(e).length===0&&(Se(e),_e(e))}function he(e,t,n,r,o){if(n==="ENEMY_ATTACK"&&e.player.nullifyDamageThisTurn)return m(e,`Ï†Å Í≥µÍ≤© ÌîºÌï¥ Î¨¥Ìö® (${r??n})`),0;if(t<=0)return 0;const s={target:"PLAYER",source:n==="ENEMY_ATTACK"?"ENEMY_ATTACK":n==="FATIGUE"?"FATIGUE":"OTHER",raw:t,reason:r};let i=le(e,{...s,phase:"PRE_STATUS",current:t,attackerWeak:o,targetVuln:e.player.status.vuln??0});if(n==="ENEMY_ATTACK"){const d=o??0,l=e.player.status.vuln??0;if(i=i-d+l,i<0&&(i=0),i=le(e,{...s,phase:"POST_STATUS",current:i,afterStatus:i,attackerWeak:d,targetVuln:l}),i=le(e,{...s,phase:"PRE_BLOCK",current:i,afterStatus:i,attackerWeak:d,targetVuln:l}),e.player.block>0){const h=Math.min(e.player.block,i);e.player.block-=h,i-=h}i=le(e,{...s,phase:"POST_BLOCK",current:i,afterStatus:i,afterBlock:i,attackerWeak:d,targetVuln:l})}else i=le(e,{...s,phase:"POST_STATUS",current:i,afterStatus:i});if(i=le(e,{...s,phase:"FINAL",current:i}),i<=0)return 0;e.player.hp=Math.max(0,e.player.hp-i),m(e,`ÌîåÎ†àÏù¥Ïñ¥ ${i} ÌîºÌï¥ (${r??n}). (HP ${e.player.hp}/${e.player.maxHp})`);{const d=ce(e);let l=!1;i>=10&&!d.tookBigHit10&&(d.tookBigHit10=!0,l=!0),e.player.hp<=15&&!d.hpLeq15&&(d.hpLeq15=!0,l=!0),l&&ie(e)}return wn(e,{...s,phase:"FINAL",current:i},i),i}function co(){return wt[Math.floor(Math.random()*wt.length)]}function an(e){const{tier:t}=it(e),n=t===0?0:t===1?.25:t===2?.55:.85;return Math.random()<n?uo():co()}const Hn={boss_cursed_wall:"ÏõÄÏßÅÏù¥ÏßÄ ÏïäÎäîÎã§. ÎãπÏã†Ïù¥ Îã≥ÏïÑÍ∞ÑÎã§.",boss_giant_orc:"Í±∞ÎåÄÌïú Î¨¥Ïñ∏Í∞ÄÍ∞Ä Í∏∞Îã§Î¶∞Îã§.",boss_soul_stealer:"ÌñâÎèôÌïòÏßÄ ÏïäÏúºÎ©¥ Ï¢ÖÎßêÏù¥ Ïò®Îã§.",boss_gravity_master:"Î™∏Ïù¥ Ï†êÏ†ê Î¨¥Í≤ÅÎã§. Î™∏ÏùÑ Í∞ÄÎ≥çÍ≤å ÌïòÎùº."},sn=[{id:"mad_mirror",name:"Í±∞Ïö∏Ïóê Ïû†Í∏¥ Î¨º",prompt:"Î¨º ÏÜçÏùò ÎãπÏã†Ïù¥ Î®ºÏ†Ä ÏõÉÏäµÎãàÎã§.",art:"assets/events/event_mad_mirror.png",options:e=>[{key:"mad_mirror:take",label:"ÏÜêÏùÑ ÎÑ£ÎäîÎã§",detail:"Ïπ¥Îìú Î≥¥ÏÉÅ. F +2.",apply:t=>(xe(t,2),m(t,"Í±∞Ïö∏: Î¨¥Ïñ∏Í∞ÄÎ•º Í±¥Ï†∏ Ïò¨Î†∏Îã§. (F +2)"),"REWARD")},{key:"mad_mirror:leave",label:"Ïô∏Î©¥ÌïúÎã§",apply:t=>(m(t,"Í±∞Ïö∏: ÎãπÏã†ÏùÄ Î¨ºÎü¨ÎÇ¨Îã§."),"NONE")}]},{id:"mad_contract",name:"Ï†ñÏùÄ Í≥ÑÏïΩÏÑú",prompt:"Í≥∞Ìå°Ïù¥ ÎÉÑÏÉàÍ∞Ä ÎÇ©ÎãàÎã§.",art:"assets/events/event_mad_contract.png",options:e=>[{key:"mad_contract:sign",label:"ÏÑúÎ™ÖÌïúÎã§",detail:"ÏµúÎåÄ HP +2. Ïπ¥Îìú 1Ïû• Ï†úÍ±∞ ÌõÑ Î≥¥ÏÉÅ.",apply:t=>(t.player.maxHp+=2,t.player.hp=Math.min(t.player.maxHp,t.player.hp+2),m(t,"Í≥ÑÏïΩ: ÏµúÎåÄ HP +2"),{kind:"REMOVE_PICK",title:"ÎåÄÍ∞Ä",prompt:"Ï†úÍ±∞Ìï† Ïπ¥Îìú 1Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.",then:"REWARD"})},{key:"mad_contract:burn",label:"Ï∞¢Ïñ¥Î≤ÑÎ¶∞Îã§",detail:"F +1",apply:t=>(xe(t,1),m(t,"Î∂àÍ∏∏Ìï®: F +1"),"NONE")}]},{id:"mad_lullaby",name:"ÏûêÏû•Í∞Ä",prompt:"Ïû†Îì§Î©¥ ÌöåÎ≥µÌïòÏßÄÎßå, Íπ®Ïñ¥ÎÇòÎ©¥ ÏûäÏäµÎãàÎã§.",art:"assets/events/event_mad_lullaby.png",options:e=>[{key:"mad_lullaby:sleep",label:"Ïû†Îì†Îã§",detail:"HP +12. Îç±ÏóêÏÑú Î¨¥ÏûëÏúÑ 1Ïû• ÏÜåÏã§.",apply:t=>(t.player.hp=Math.min(t.player.maxHp,t.player.hp+12),Hr(t),m(t,"ÏûêÏû•Í∞Ä: HP ÌöåÎ≥µ, Í∑∏Îü¨ÎÇò ÏûäÏóàÎã§‚Ä¶ (Î¨¥ÏûëÏúÑ 1Ïû• ÏÜåÏã§)"),"NONE")},{key:"mad_lullaby:stay",label:"Î≤ÑÌã¥Îã§",detail:"F -1",apply:t=>(xe(t,-1),m(t,"Î≤ÑÌåÄ: F -1"),"NONE")}]}];function uo(e){return sn[Math.floor(Math.random()*sn.length)]}const wt=[{id:"drop_bag",name:"Ïßê Î≤ÑÎ¶¨Í∏∞",prompt:"ÏßêÏùÑ Ï§ÑÏó¨ ÌîºÎ°úÎ•º ÎÇÆÏ∂îÏûê.",art:"assets/events/event_drop_bag.png",options:()=>[{key:"drop",label:"Ïπ¥Îìú 1Ïû• Ï†úÍ±∞, F -1",apply:e=>(xe(e,-1),m(e,"Ïù¥Î≤§Ìä∏: Ïßê Î≤ÑÎ¶¨Í∏∞ ‚Üí Ï†úÍ±∞Ìï† Ïπ¥ÎìúÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî."),{kind:"REMOVE_PICK",title:"Ïßê Î≤ÑÎ¶¨Í∏∞",prompt:"Ï†úÍ±∞Ìï† Ïπ¥Îìú 1Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.",then:"NONE"})},{key:"skip",label:"ÏïÑÎ¨¥Í≤ÉÎèÑ ÌïòÏßÄ ÏïäÎäîÎã§",apply:e=>(m(e,"Ïù¥Î≤§Ìä∏: Ïßê Î≤ÑÎ¶¨Í∏∞(ÏÉùÎûµ)"),"NONE")}]},{id:"hide_from_monster",name:"Î™¨Ïä§ÌÑ∞Î°úÎ∂ÄÌÑ∞ Ïà®Í∏∞",prompt:"Ï†ÑÌà¨ÌïòÍ±∞ÎÇò, ÎåÄÍ∞ÄÎ•º ÏπòÎ•¥Í≥† Ïà®ÏùÑ Ïàò ÏûàÎã§.",art:"assets/events/event_hide_from_monster.png",options:()=>[{key:"fight",label:"Ï†ÑÌà¨",apply:e=>(m(e,"Ïù¥Î≤§Ìä∏: Î™¨Ïä§ÌÑ∞Î°úÎ∂ÄÌÑ∞ Ïà®Í∏∞ ‚Üí Ï†ÑÌà¨ ÏÑ†ÌÉù"),"BATTLE")},{key:"remove_and_fatigue",label:"Ïπ¥Îìú 1Ïû• Ï†úÍ±∞ ÌõÑ F +1",apply:e=>(xe(e,1),m(e,"Ïù¥Î≤§Ìä∏: Î™¨Ïä§ÌÑ∞Î°úÎ∂ÄÌÑ∞ Ïà®Í∏∞ ‚Üí Ïπ¥Îìú Ï†úÍ±∞ ÌõÑ F+1"),{kind:"REMOVE_PICK",title:"Ïà®Í∏∞",prompt:"Ï†úÍ±∞Ìï† Ïπ¥Îìú 1Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.",then:"NONE"})}]},{id:"goblin_ambush_low_supplies",name:"Îß§Î≥µÌïú ÏïΩÌÉàÏûêÎì§",prompt:`Í≥†Î∏îÎ¶∞Îì§Ïù¥ Î≥¥Í∏âÏùÑ ÏïΩÌÉàÌñàÎã§.
Ïù¥Î≤à Ï†ÑÌà¨Îäî Î≥¥Í∏â(S) 5Î°ú ÏãúÏûëÌï©ÎãàÎã§.`,art:"assets/events/event_goblin_ambush_low_supplies.png",options:()=>[{key:"fight",label:"ÎßûÏÑú Ïã∏Ïö¥Îã§",detail:"Í≥†Î∏îÎ¶∞ ÏïΩÌÉàÏûê 2ÎßàÎ¶¨ Ï†ÑÌà¨ (S=5 ÏãúÏûë)",apply:e=>(e.run.nextBattleSuppliesBonus=-5,{kind:"BATTLE_SPECIAL",title:"Í≥†Î∏îÎ¶∞ Îß§Î≥µ",enemyIds:["goblin_raider","goblin_raider"]})}]},{id:"find_adventurer",name:"Îã§Î•∏ Î™®ÌóòÍ∞Ä Î∞úÍ≤¨",prompt:"Í±∞ÎûòÌïúÎã§.",art:"assets/events/event_find_adventurer.png",options:e=>e.run.treasureObtained?[{key:"adventurer:forced_battle",label:"ÎåÄÏπòÌïúÎã§",detail:"Î≥¥Î¨ºÏùÑ ÎÖ∏Î¶¨Í≥† Îç§Î≤ºÎì†Îã§.",apply:t=>({kind:"BATTLE_SPECIAL",enemyIds:["other_adventurer"],title:"Î≥¥Î¨ºÏùÑ ÎÖ∏Î¶¨Îäî Î™®ÌóòÍ∞Ä"})}]:[{key:"trade",label:"Ïπ¥Îìú 1Ïû• Ï†úÍ±∞ ÌõÑ Ïπ¥Îìú Î≥¥ÏÉÅ(2Ïû• Ï§ë 1Ïû•)",apply:t=>(m(t,"Ïù¥Î≤§Ìä∏: Îã§Î•∏ Î™®ÌóòÍ∞Ä Î∞úÍ≤¨ ‚Üí Ï†úÍ±∞Ìï† Ïπ¥Îìú ÏÑ†ÌÉù ÌõÑ Î≥¥ÏÉÅ"),{kind:"REMOVE_PICK",title:"Îã§Î•∏ Î™®ÌóòÍ∞Ä Î∞úÍ≤¨",prompt:"Ï†úÍ±∞Ìï† Ïπ¥Îìú 1Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.",then:"REWARD"})},{key:"leave",label:"ÏßÄÎÇòÏπúÎã§",apply:t=>(m(t,"Ïù¥Î≤§Ìä∏: Îã§Î•∏ Î™®ÌóòÍ∞Ä Î∞úÍ≤¨(ÏÉùÎûµ)"),"NONE")}]},{id:"edible_mushroom",name:"ÏãùÏö© Î≤ÑÏÑØ Î∞úÍ≤¨",prompt:"Í∏∞Ïö¥Ïù¥ ÎÇúÎã§. Îã§Ïùå Ï†ÑÌà¨Ïùò ÏãúÏûë Î≥¥Í∏âÏù¥ ÎäòÏñ¥ÎÇúÎã§.",art:"assets/events/event_edible_mushroom.png",options:()=>[{key:"eat",label:"F -2, Îã§Ïùå Ï†ÑÌà¨ ÏãúÏûë S +5",apply:e=>(e.player.fatigue=Math.max(0,e.player.fatigue-2),e.run.nextBattleSuppliesBonus+=5,m(e,"ÏãùÏö© Î≤ÑÏÑØ: F -2, Îã§Ïùå Ï†ÑÌà¨ ÏãúÏûë S +5"),"NONE")}]},{id:"ominous_prophecy",name:"Î∂àÍ∏∏Ìïú ÏòàÏñ∏",prompt:"Î∂àÍ∏∏Ìïú ÏÜçÏÇ≠ÏûÑÏù¥ Í∑ìÍ∞ÄÎ•º Îß¥ÎèàÎã§. ÎåÄÍ∞ÄÎ•º ÏπòÎ•¥Í≥† ÎØ∏ÎûòÎ•º ÏóøÎ≥ºÍπå?",art:"assets/events/event_ominous_prophecy.png",options:e=>[{key:"omen:listen",label:"ÏòàÏñ∏ÏùÑ Îì£ÎäîÎã§",detail:"F +1. Îã§Ïùå Î≥¥Ïä§Î•º ÌôïÏ†ïÌïòÍ≥† Í≥µÍ∞úÌï©ÎãàÎã§.",apply:t=>{if(xe(t,1),m(t,"Î∂àÍ∏∏Ìïú ÏòàÏñ∏: F +1"),t.run.nextBossId||(t.run.bossPool.length>0?t.run.nextBossId=G(t.run.bossPool):t.run.nextBossId=null),!t.run.nextBossId)return m(t,"ÏòàÏñ∏: ÎØ∏ÎûòÍ∞Ä ÌùêÎ¶øÌïòÎã§. (Î≥¥Ïä§Í∞Ä ÎÇ®ÏïÑÏûàÏßÄ ÏïäÏùå)"),"NONE";t.content.enemiesById[t.run.nextBossId];const n=Hn[t.run.nextBossId]??"Ï†ïÏ≤¥Î∂àÎ™ÖÏùò ÏúÑÌòëÏù¥ Îã§Í∞ÄÏò®Îã§.";return t.run.bossOmenText=`${n}`,m(t,`ÏòàÏñ∏: ${n}`),"NONE"}},{key:"omen:ignore",label:"Î¨¥ÏãúÌïúÎã§",detail:"ÏïÑÎ¨¥ ÏùºÎèÑ ÏùºÏñ¥ÎÇòÏßÄ ÏïäÏäµÎãàÎã§.",apply:t=>(m(t,"Î∂àÍ∏∏Ìïú ÏòàÏñ∏(Î¨¥Ïãú)"),"NONE")}]}];function Ln(e){return wt.find(t=>t.id===e)??null}function po(){return Object.keys(En).sort((e,t)=>e.localeCompare(t))}function fo(){return{cardsById:En,enemiesById:fr}}let we=!1,Kt=null,ge=[],Ne=[],ue=-1;function mo(e){return Array.from(new Set(e)).sort((t,n)=>t.localeCompare(n))}function ln(e,t){return e.toLowerCase().startsWith(t.toLowerCase())}function ho(){return[{name:"help",desc:"show commands"},{name:"state",desc:"print game state"},{name:"newrun",desc:"start new run"},{name:"hp",args:"<n>",desc:"set current hp"},{name:"maxhp",args:"<n>",desc:"set max hp"},{name:"supplies",args:"<n>",desc:"set supplies"},{name:"fatigue",args:"<n>",desc:"set fatigue"},{name:"phase",args:"<PLACE|BACK|FRONT|ENEMY|UPKEEP|DRAW|NODE>",desc:"set phase",suggest:()=>["PLACE","BACK","FRONT","ENEMY","UPKEEP","DRAW","NODE"]},{name:"addcard",args:"<defId> [upgrade=0] [zone=deck|hand|discard]",desc:"add card",suggest:(e,t)=>t.length<=2?po():t.length===4?["deck","hand","discard"]:[]},{name:"removecard",args:"<uid>",desc:"remove card",suggest:e=>mo(Object.keys(e.cards??{}))},{name:"win",desc:"force victory"},{name:"lose",desc:"force defeat"},{name:"log",args:"<text...>",desc:"log message"},{name:"addrelic",args:"<relicId> [now|locked|unlocked]",desc:"grant relic",suggest:(e,t)=>t.length<=2?hr():t.length===3?["now","locked","unlocked"]:[]},{name:"relicapply",desc:"apply pending relic activations"}]}function tt(e,t){ge.push({t:Date.now(),kind:e,text:t}),ge.length>300&&(ge=ge.slice(-300))}function yo(e){Kt=e}function bo(){return we}function xo(e){we=!we,ve()}function ve(){if(document.querySelector(".devConsole")?.remove(),!we)return;const e=document.createElement("div");e.className="devConsole",e.style.cssText=`
    position: fixed; inset: 0;
    z-index: 60000;
    pointer-events: auto;
    background: rgba(0,0,0,.35);
    backdrop-filter: blur(4px);
    display:flex; align-items:flex-end; justify-content:center;
    padding: 12px;
    box-sizing: border-box;
  `;const t=document.createElement("div");t.style.cssText=`
    width: min(980px, 100%);
    height: min(420px, 70vh);
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(10,12,14,.92);
    box-shadow: 0 18px 60px rgba(0,0,0,.55);
    display:flex;
    flex-direction: column;
    overflow:hidden;
  `;const n=document.createElement("div");n.style.cssText=`
    padding: 10px 12px;
    display:flex; align-items:center; justify-content:space-between;
    border-bottom: 1px solid rgba(255,255,255,.10);
  `;const r=document.createElement("div");r.textContent="Dev Console",r.style.cssText="font-weight:800; color:#fff; opacity:.95;";const o=document.createElement("div");o.style.cssText="display:flex; gap:8px;";const a=(y,T)=>{const b=document.createElement("button");return b.type="button",b.textContent=y,b.style.cssText=`
      padding: 6px 10px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: #fff;
      cursor: pointer;
      font-weight: 700;
    `,b.onclick=T,b};o.appendChild(a("Clear",()=>{ge=[],ve()})),o.appendChild(a("Close",()=>{we=!1,ve()})),n.appendChild(r),n.appendChild(o);const s=document.createElement("div");s.className="devConsoleOut",s.style.cssText=`
    flex: 1 1 auto;
    padding: 10px 12px;
    overflow: auto;
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 12px;
    line-height: 1.4;
    color: #ddd;
    white-space: pre-wrap;
  `;const i=y=>(y.kind==="in"?"> ":y.kind==="err"?"! ":"  ")+y.text;s.textContent=ge.map(i).join(`
`),queueMicrotask(()=>{s.scrollTop=s.scrollHeight});const d=document.createElement("div");d.style.cssText=`
    border-top: 1px solid rgba(255,255,255,.10);
    padding: 10px 12px;
    display:flex; gap:10px; align-items:center;
  `;const l=document.createElement("div");l.className="devConsoleHint",l.style.cssText=`
    margin-left: 10px;
    max-width: 45%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    color: rgba(255,255,255,.55);
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 12px;
  `;const h=document.createElement("div");h.textContent=">",h.style.cssText="color:#fff; font-weight:900; opacity:.9;";const f=document.createElement("input");f.type="text",f.placeholder="help / state / newrun ...",f.style.cssText=`
    flex: 1 1 auto;
    padding: 10px 12px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(255,255,255,.06);
    color: #fff;
    outline: none;
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 13px;
  `;const p=ho();let k={base:"",items:[],idx:-1,lastApplied:""};const A=y=>{const T=Kt?.getG();if(!T)return[];const b=y.split(/\s+/).filter(Boolean),E=/\s$/.test(y);if(b.length===0)return p.map(B=>B.name);if(b.length===1&&!E){const B=b[0];return p.map(O=>O.name).filter(O=>ln(O,B))}const w=(b[0]??"").toLowerCase(),v=p.find(B=>B.name===w);if(!v?.suggest)return[];const _=E?"":b[b.length-1]??"";return v.suggest(T,b).filter(B=>ln(B,_))},u=(y,T)=>{const b=/\s$/.test(y);if(!y.trim())return T+" ";const E=y.split(/\s+/);return b?y+T+" ":(E[E.length-1]=T,E.join(" ")+" ")},c=()=>{const y=A(f.value);if(!y.length){l.textContent="";return}const T=y.slice(0,6);l.textContent=T.join("  ")};f.onkeydown=y=>{if(y.key==="Escape"){we=!1,ve();return}if(y.key==="Enter"){const T=f.value.trim();if(!T)return;f.value="",Ne.unshift(T),ue=-1,tt("in",T);try{ko(T)}catch(b){tt("err",String(b?.message??b))}ve();return}if(y.key==="ArrowUp"){y.preventDefault();const T=Ne.length;if(T===0)return;ue=Math.min(T-1,ue+1),f.value=Ne[ue]??"";return}if(y.key==="ArrowDown"){if(y.preventDefault(),Ne.length===0)return;ue=Math.max(-1,ue-1),f.value=ue>=0?Ne[ue]??"":"";return}if(y.key==="Tab"){y.preventDefault();const T=y.shiftKey===!0,b=f.value;if(!(k.items.length>0&&(b===k.lastApplied||b===k.base))){const _=A(b);k.base=b,k.items=_,k.idx=-1,k.lastApplied=b}if(!k.items.length){c();return}T?k.idx=(k.idx-1+k.items.length)%k.items.length:k.idx=(k.idx+1)%k.items.length;const w=k.items[k.idx],v=u(k.base,w);f.value=v,k.lastApplied=v,c();return}},f.oninput=()=>{k.items=[],k.base="",k.idx=0,c()},d.appendChild(h),d.appendChild(f),d.appendChild(l),t.appendChild(n),t.appendChild(s),t.appendChild(d),t.onclick=y=>y.stopPropagation(),e.appendChild(t),document.body.appendChild(e),c(),queueMicrotask(()=>f.focus())}function ko(e){const t=Kt;if(!t){tt("err","Dev console context not set");return}const n=t.getG(),r=e.split(/\s+/).filter(Boolean),o=(r[0]??"").toLowerCase(),a=r[1],s=r[2],i=l=>tt("out",l);if(o==="help"){i(["help","state","newrun","hp <n> | maxhp <n> | supplies <n> | fatigue <n>","phase <PLACE|BACK|FRONT|ENEMY|UPKEEP|DRAW|NODE>","addcard <defId> [upgrade=0] [zone=deck|hand|discard]","removecard <uid>","addrelic <relicId> [now|locked|unlocked]","relicapply  (apply pending relic activations)","win | lose","log <text...>"].join(`
`));return}if(o==="state"){i(JSON.stringify({phase:n.phase,hp:`${n.player.hp}/${n.player.maxHp}`,supplies:n.player.supplies,fatigue:n.player.fatigue,deck:n.deck.length,hand:n.hand.length,discard:n.discard.length,enemies:n.enemies.map(l=>({id:l.id,hp:`${l.hp}/${l.maxHp}`,intent:l.intentIndex}))},null,2));return}if(o==="newrun"){t.actions.onNewRun(),i("OK: newrun");return}const d=(l,h)=>{const f=Number(a);if(!Number.isFinite(f)){i(`ERR: ${l} requires number`);return}h(f),t.rerender(),i(`OK: ${l} = ${f}`)};if(o==="hp")return d("hp",l=>n.player.hp=Math.max(0,Math.min(n.player.maxHp,l)));if(o==="maxhp")return d("maxHp",l=>{n.player.maxHp=Math.max(1,l),n.player.hp=Math.min(n.player.hp,n.player.maxHp)});if(o==="supplies")return d("supplies",l=>n.player.supplies=Math.max(0,l));if(o==="fatigue")return d("fatigue",l=>n.player.fatigue=Math.max(0,l));if(o==="phase"){const l=(a??"").toUpperCase();if(!new Set(["PLACE","BACK","FRONT","ENEMY","UPKEEP","DRAW","NODE"]).has(l)){i("ERR: phase invalid");return}n.phase=l,t.rerender(),i(`OK: phase=${l}`);return}if(o==="log"){const l=e.slice(e.indexOf(" ")+1);if(!l||l===e){i("ERR: log <text...>");return}t.log?.(`[DEV] ${l}`),i("OK: logged");return}if(o==="addcard"){const l=a;if(!l){i("ERR: addcard <defId> [upgrade=0] [zone=deck|hand|discard]");return}const h=Math.max(0,Number(s??"0")||0),f=r[3]??"deck";et(n,l,{upgrade:h});const p=n.deck[n.deck.length-1];p&&f!=="deck"&&(n.deck=n.deck.filter(k=>k!==p),f==="hand"?n.hand.push(p):f==="discard"&&n.discard.push(p),n.cards[p].zone=f),t.log?.(`[DEV] addcard ${l} +${h} (${f}) uid=${p}`),t.rerender(),i(`OK: addcard uid=${p}`);return}if(o==="removecard"){const l=a;if(!l){i("ERR: removecard <uid>");return}if(!n.cards[l]){i(`ERR: uid not found: ${l}`);return}const h=n.deck.includes(l),f=n.hand.includes(l),p=n.discard.includes(l);!h&&!f&&!p&&i(`WARN: uid exists but not in piles (deck/hand/discard): ${l} (zone=${n.cards[l]?.zone??"?"})`),Wt(n,l),t.log?.(`[DEV] removecard ${l}`),t.rerender(),i("OK: removecard");return}if(o==="addrelic"){const l=a,h=(s??"").toLowerCase();if(!l){i("ERR: addrelic <relicId> [now|locked|unlocked]");return}vn(n,l);const f=n.run;if(f.forceLockedRelics??={},f.forceUnlockedRelics??={},h==="locked"){f.forceLockedRelics[l]=!0,delete f.forceUnlockedRelics[l],f.relicRuntime??={},f.relicRuntime[l]??={active:!1,pending:!1,obtainedAtNode:n.run.nodePickCount},f.relicRuntime[l].active=!1,f.relicRuntime[l].pending=!1,t.log?.(`[DEV] addrelic ${l} (locked)`),t.rerender(),i(`OK: addrelic ${l} (locked)`);return}if(h==="unlocked"){f.forceUnlockedRelics[l]=!0,delete f.forceLockedRelics[l],t.log?.(`[DEV] addrelic ${l} (unlocked)`),t.rerender(),i(`OK: addrelic ${l} (unlocked)`);return}h==="now"&&Z(n),t.log?.(`[DEV] addrelic ${l}${h?` (${h})`:""}`),t.rerender(),i(`OK: addrelic ${l}`);return}if(o==="relicapply"){Z(n),t.log?.("[DEV] relicapply"),t.rerender(),i("OK: relicapply");return}if(o==="win"){if(!n.enemies||n.enemies.length===0){i("WARN: enemies=0");return}for(const l of n.enemies)l.hp=0;n.enemies=[],n.pendingTarget=null,n.pendingTargetQueue=[],n.selectedEnemyIndex=null,_e(n),t.log?.("[DEV] win"),t.rerender(),i("OK: win");return}if(o==="lose"){n.run.finished=!0,t.log?.("[DEV] lose"),t.rerender(),i("OK: lose");return}i(`Unknown command: ${o} (try: help)`)}function Ie(e,t){if(!t)return;const n=e.player.fatigue??0;n<10||(e.player.fatigue=Math.max(0,n-2),e.time=(e.time??0)+1,m(e,"ÌîºÎ°úÍ∞Ä ÎÑàÎ¨¥ ÎÜíÏïÑ Ìú¥ÏãùÏù¥ Îçî Ïò§Îûò Í±∏Î¶ΩÎãàÎã§. (F -2, ÏãúÍ∞Ñ +1)"))}function Mn(e){let t=Object.values(e.cards).filter(s=>(s.zone==="deck"||s.zone==="hand"||s.zone==="discard")&&Ut(e,s.uid)).map(s=>s.uid);const n=e.player.fatigue??0;let r=1/0;return n>=8?r=4:n>=5&&(r=8),r!==1/0&&t.length>r&&(t=[...t].sort(()=>Math.random()-.5).slice(0,r)),t.length===0?null:{kind:"UPGRADE_PICK",title:"Í∞ïÌôî",prompt:"Í∞ïÌôîÌï† Ïπ¥Îìú 1Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.",options:[...[...t].sort((s,i)=>{const d=e.cards[s],l=e.cards[i],h=e.content.cardsById[d.defId]?.name??d.defId,f=e.content.cardsById[l.defId]?.name??l.defId,p=h.localeCompare(f,"ko");return p!==0?p:(d.upgrade??0)-(l.upgrade??0)}).map(s=>{const i=e.cards[s],d=se(e.content,i.defId,i.upgrade??0),l=se(e.content,i.defId,(i.upgrade??0)+1),h=e.content.cardsById[i.defId]?.name??i.defId,f=(i.upgrade??0)>0?`${h} +${i.upgrade}`:h,p=`ÌòÑÏû¨: Ï†ÑÏó¥ ${d.frontText} / ÌõÑÏó¥ ${d.backText}
Í∞ïÌôî: Ï†ÑÏó¥ ${l.frontText} / ÌõÑÏó¥ ${l.backText}`;return{key:`up:${s}`,label:f,detail:p,cardUid:s}}),{key:"skip",label:"Ï∑®ÏÜå"}]}}function To(e,t){const n=e.choiceCtx&&e.choiceCtx.kind==="REST"&&typeof e.choiceCtx.highF=="boolean"?e.choiceCtx.highF:(e.player.fatigue??0)>=10;if(t.startsWith("rest:")){const r=ce(e);r.rest+=1,ie(e)}if(t==="rest:heal")return Ie(e,n),e.player.hp=Math.min(e.player.maxHp,e.player.hp+15),m(e,"Ìú¥Ïãù: HP +15"),ne(e),e.phase="NODE",Z(e),!0;if(t==="rest:clear_f")return Ie(e,n),e.player.fatigue=Math.max(0,(e.player.fatigue??0)-3),m(e,"Ìú¥Ïãù: ÌîºÎ°ú F-=3"),ne(e),e.phase="NODE",Z(e),!0;if(t==="rest:upgrade"){const r=Mn(e);return r?(Ie(e,n),gt(e,r,null),!0):(m(e,"Í∞ïÌôîÌï† Ïàò ÏûàÎäî Ïπ¥ÎìúÍ∞Ä ÏóÜÏäµÎãàÎã§."),Ie(e,n),ne(e),e.phase="NODE",Z(e),!0)}return t==="rest:skip"?(Ie(e,n),m(e,"Ìú¥Ïãù: ÏÉùÎûµ"),ne(e),e.phase="NODE",Z(e),!0):!1}function Co(e,t){if(!e.choiceCtx||e.choiceCtx.kind!=="EVENT")return!1;const n=Ln(e.choiceCtx.eventId);if(!n)return!1;const o=n.options(e).find(i=>i.key===t);if(!o)return!1;const a=ce(e);a.eventPicks+=1,ie(e);const s=o.apply(e);if(s&&typeof s=="object"&&s.kind==="UPGRADE_PICK"){const i=Mn(e);return i?(gt(e,i,null),!0):(m(e,"Í∞ïÌôîÌï† Ïàò ÏûàÎäî Ïπ¥ÎìúÍ∞Ä ÏóÜÏäµÎãàÎã§."),ne(e),e.phase="NODE",Z(e),!0)}if(s&&typeof s=="object"&&s.kind==="REMOVE_PICK"){const d=[...Object.values(e.cards).filter(l=>l.zone==="deck"||l.zone==="hand"||l.zone==="discard").map(l=>l.uid).map(l=>{const h=e.cards[l],f=se(e.content,h.defId,h.upgrade??0),p=e.content.cardsById[h.defId]?.name??h.defId,k=(h.upgrade??0)>0?`${p} +${h.upgrade}`:p;return{key:`remove:${l}`,label:k,detail:`Ï†ÑÏó¥: ${f.frontText} / ÌõÑÏó¥: ${f.backText}`,cardUid:l}}),{key:"skip",label:"Ï∑®ÏÜå"}];return gt(e,{kind:"REMOVE_PICK",title:s.title??"Ï†úÍ±∞",prompt:s.prompt??"Ï†úÍ±∞Ìï† Ïπ¥Îìú 1Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.",options:d},null),!0}return ne(e),e.phase="NODE",Z(e),!0}function Eo(e,t){const n=e.choice;if(!n)return!1;if(t==="close")return ne(e),!0;if(n.kind==="REWARD")return Ur(e,t);if(n.kind==="UPGRADE_PICK"){if(t==="skip")return m(e,"Í∞ïÌôî Ï∑®ÏÜå"),ne(e),e.phase="NODE",Z(e),!0;if(t.startsWith("up:")){const r=t.slice(3),o=In(e,r);return m(e,o?"Í∞ïÌôî ÏôÑÎ£å":"Í∞ïÌôî Ïã§Ìå®"),ne(e),e.phase="NODE",Z(e),!0}return!1}if(n.kind==="REMOVE_PICK"){if(t==="skip")return m(e,"Ï†úÍ±∞ Ï∑®ÏÜå"),ne(e),e.phase="NODE",Z(e),!0;if(t.startsWith("remove:")){const r=t.slice(7);return Wt(e,r),m(e,"Ïπ¥ÎìúÎ•º Ï†úÍ±∞ÌñàÏäµÎãàÎã§."),ne(e),e.phase="NODE",Z(e),!0}return!1}if(n.kind==="EVENT"){if(e.choiceCtx?.kind==="REST")return To(e,t);if(e.choiceCtx?.kind==="EVENT")return Co(e,t)}return t==="skip"?(ne(e),!0):!1}const ct="deck-rogue-save-v1",Dn=1;function So(e){try{return JSON.parse(e)}catch{return null}}function go(){return!!localStorage.getItem(ct)}function vo(){localStorage.removeItem(ct)}function wo(e,t){const n={ver:Dn,savedAt:Date.now(),build:t?.build,state:e};localStorage.setItem(ct,JSON.stringify(n))}function _o(){const e=localStorage.getItem(ct);if(!e)return null;const t=So(e);return!t||t.ver!==Dn||!t.state?null:{state:t.state,savedAt:t.savedAt}}function Po(e){return e<0?0:e}function cn(e,t,n){const r=t.player.status?.vuln??0,o=n.status?.weak??0;return Po(e+r-o)}function Ce(e,t){e.push(t)}function $o(e){const t=(e.dmgTotal??0)>0||(e.hits??0)>0||(e.perHit??0)>0,n=(e.applies??[]).some(o=>o.target==="player"&&["vuln","weak","bleed","disrupt","supplies","fatigue"].includes(String(o.kind))),r=(e.applies??[]).some(o=>o.target==="enemy"&&["vuln","weak","bleed","disrupt","immune"].includes(String(o.kind)));return t&&n?"ATTACK_DEBUFF":t&&r?"ATTACK_BUFF":t?"ATTACK":n?"DEBUFF":r?"BUFF":"OTHER"}function Ao(e,t,n){const r=t.usedThisTurn??0;return e==="goblin_raider"?{raw:Math.max(0,12-r),hits:1}:e==="watching_statue"?{raw:4+r,hits:1}:{raw:0,hits:1}}function No(e,t,n,r={}){if(n.meta?.preview){const f=n.meta.preview(e,t);if(f)return f}const o=[];let a=0,s=0,i=null;const d=[];if(n.meta?.applies)for(const f of n.meta.applies)Ce(o,f);for(const f of n.acts)switch(f.op){case"damagePlayer":{const p=f.n;a+=p,s+=1,i=i??p;break}case"damagePlayerFormula":{const{raw:p,hits:k}=Ao(f.kind,e);a+=p,s+=k??1;break}case"statusPlayer":{Ce(o,{target:"player",kind:f.key,amount:f.n});break}case"supplies":{Ce(o,{target:"player",kind:"supplies",amount:f.n});break}case"fatiguePlayer":{Ce(o,{target:"player",kind:"fatigue",amount:f.n});break}case"enemyHealSelf":{Ce(o,{target:"enemy",kind:"heal",amount:f.n});break}case"enemyImmuneNextTurn":{Ce(o,{target:"enemy",kind:"immune",amount:1});break}}t.immuneThisTurn;let l=a>0?cn(a,e,t):void 0;if(r.includeBlock&&l!=null){const f=e.player.block??0;l=Math.max(0,l-f)}const h={cat:n.meta?.cat??"OTHER",dmgTotal:l,hits:s>0?s:n.meta?.hits,perHit:i!=null?cn(i,e,t):n.meta?.baseDmg,applies:o.length?o:void 0,notes:d.length?d:void 0};return h.cat=n.meta?.cat??$o(h),h.shortText||(h.dmgTotal!=null&&(h.hits??0)>1?h.shortText=`${h.dmgTotal} (${h.hits}ÌÉÄ)`:h.dmgTotal!=null&&(h.shortText=`${h.dmgTotal}`)),h}const Io=`# Deck Rogue Prototype ‚Äî Î£∞Î∂Å (ÌîåÎ†àÏù¥Ïñ¥Ïö©)

Ïù¥ Î¨∏ÏÑúÎäî Ïä§Ìè¨ÏùºÎü¨Î•º ÏµúÏÜåÌôîÌï©ÎãàÎã§.

[1] Í∞úÏöî
ÎÖ∏ÎìúÎ•º ÏÑ†ÌÉùÌïòÎ©∞ ÏßÑÌñâÌïòÍ≥†, Ï†ÑÌà¨ÏóêÏÑú ÏÇ¥ÏïÑÎÇ®ÏïÑ ÏÑ±Ïû•Ìï©ÎãàÎã§. Î™©ÌëúÎäî Î¨¥ÏóáÏùºÍπåÏöî?
Î™®Îì† Ïπ¥ÎìúÎäî Ï†ÑÏó¥Í≥º ÌõÑÏó¥Ïù¥ ÏûàÏäµÎãàÎã§. Î∞∞ÏπòÏóê Îî∞Îùº Ïó≠Ìï†Ïù¥ Îã¨ÎùºÏßëÎãàÎã§.

[2] Î≥¥Í∏âÍ≥º ÌîºÎ°úÎèÑ

Î≥¥Í∏â(S): Ï†ÑÏó¥ Ïπ¥Îìú Î∞è ÏùºÎ∂Ä Ìö®Í≥ºÏùò Î∞úÎèôÏóê ÏÇ¨Ïö©Îê©ÎãàÎã§. Î≥¥ÌÜµ 7Î°ú ÏãúÏûëÌï©ÎãàÎã§.
Î≥¥Í∏âÏù¥ Î∂ÄÏ°±Ìïú ÏÉÅÌÉúÎ°ú ÌÑ¥ Ï¢ÖÎ£å Ïãú ÌîºÎ°úÎèÑÎßåÌÅº ÌîºÌï¥Î•º Î∞õÏäµÎãàÎã§.

ÌîºÎ°úÎèÑ(F): Îç±ÏùÑ ÏÑûÍ±∞ÎÇò Ï†ÑÏó¥ Ïπ¥ÎìúÏùò Î≥¥Í∏âÏù¥ Î∂ÄÏ°±Ìïú Ï±ÑÎ°ú ÌÑ¥ÏùÑ ÎßàÏπ† Îïå ÌîºÎ°úÎèÑÍ∞Ä 1 Ïò¨ÎùºÍ∞ÄÎ©∞, ÏùºÎ∂Ä Ïπ¥ÎìúÏùò Ìö®Í≥ºÎ°úÎèÑ Î≥ÄÌï©ÎãàÎã§.
ÌîºÎ°úÎèÑÎäî Ï†ÑÌà¨Í∞Ä ÎÅùÎÇòÎèÑ Ïú†ÏßÄÎê©ÎãàÎã§. ÎÑàÎ¨¥ ÏåìÏù∏ ÌîºÎ°úÎäî ÎïåÎïåÎ°ú ÎãπÏã†ÏùÑ Î≥ÄÌïòÍ≤å Ìï©ÎãàÎã§.

[3] Ï†ÑÌà¨ ÌùêÎ¶Ñ
Î∞∞Ïπò ‚Üí ÌõÑÏó¥ Î∞úÎèô ‚Üí Ï†ÑÏó¥ Î∞úÎèô ‚Üí Ï†Å ÌñâÎèô ‚Üí Ï†ïÎ¶¨ ‚Üí ÎìúÎ°úÏö∞
‚Äª ‚ÄúÎåÄÏÉÅ ÏÑ†ÌÉù ÌïÑÏöî‚ÄùÍ∞Ä Îú®Î©¥ ÏÇ¥ÏïÑÏûàÎäî Ï†ÅÏùÑ ÌÅ¥Î¶≠Ìï¥ ÎåÄÏÉÅÏùÑ Ï†ïÌïòÏÑ∏Ïöî.
‚Äª ÌõÑÏó¥ Î∞úÎèôÏùÑ ÎàÑÎ•¥Î©¥ ÌÑ¥Ïù¥ ÏßÑÌñâÎêòÏñ¥, Ïπ¥ÎìúÏùò Î∞∞ÏπòÎ•º Î≥ÄÍ≤ΩÌï† Ïàò ÏóÜÏäµÎãàÎã§.
Î≥¥Í∏â Î∞è Í∑∏Ïóê Îî∞Î•∏ Î≥ÄÌôîÎäî Ï†ïÎ¶¨ Îã®Í≥ÑÏóêÏÑú Ï≤òÎ¶¨Ìï©ÎãàÎã§.

ÏÜêÌå®Îäî ÌÑ¥Ïù¥ Ï¢ÖÎ£åÎêòÏñ¥ÎèÑ Ïú†ÏßÄÎê©ÎãàÎã§.
Ïπ¥ÎìúÎäî Îß§ ÌÑ¥ÎßàÎã§ ÏÇ¨Ïö©Ìïú ÎßåÌÅº ÎΩëÏäµÎãàÎã§. Ï¶â, Ïπ¥ÎìúÎ°ú Ïù∏Ìïú ÎìúÎ°úÏö∞Îäî Ìå®Ïùò Îß§Ïàò ÏûêÏ≤¥Î•º ÎäòÎ¶¨Îäî Ìö®Í≥ºÍ∞Ä ÏûàÏäµÎãàÎã§.

[4] Ïö©Ïñ¥
- ÏÜåÎ™®: Ïù¥Î≤à Ï†ÑÌà¨ÏóêÏÑú ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÍ≤å ÎêòÎäî Í≤ÉÏûÖÎãàÎã§.
- ÏÜåÏã§: Îü∞ Ï†ÑÏ≤¥ÏóêÏÑú Ìï¥Îãπ Ïπ¥ÎìúÍ∞Ä ÏÇ¨ÎùºÏßÄÎäî Í≤ÉÏûÖÎãàÎã§.
- Ï∑®ÏïΩ: Î∞õÎäî ÌîºÌï¥Í∞Ä (Ï∑®ÏïΩ)ÎßåÌÅº Ï¶ùÍ∞ÄÌï©ÎãàÎã§.
- ÏïΩÌôî: Ï£ºÎäî ÌîºÌï¥Í∞Ä (ÏïΩÌôî)ÎßåÌÅº Í∞êÏÜåÌï©ÎãàÎã§.
- Ï∂úÌòà: ÌÑ¥ Ï¢ÖÎ£å Ïãú (Ï∂úÌòà)ÎßåÌÅº ÌîºÌï¥Î•º ÏûÖÏäµÎãàÎã§.
- ÍµêÎûÄ: ÎãπÏã†ÏùÑ Î∞©Ìï¥Ìï©ÎãàÎã§. Î¨¥ÏóáÏùºÍπåÏöî?

[5] Ï°∞Ïûë

(Ïª¥Ìì®ÌÑ∞)
- 4: ÏÑ†ÌÉù Ìï¥Ï†ú
- Tab: ÏÜêÌå® ÏÑ†ÌÉù Ïù¥Îèô
- 1~3: Ï†ÑÏó¥ Î∞∞Ïπò / q,w,e: ÌõÑÏó¥ Î∞∞Ïπò
- ÎìúÎûòÍ∑∏: ÏÜêÌå®‚ÜíÏä¨Î°Ø Î∞∞Ïπò, Ïä¨Î°Ø‚ÜîÏä¨Î°Ø Ïä§Ïôë, Ïä¨Î°Ø‚ÜíÏÜêÌå® ÌöåÏàò
- Space: Îã§Ïùå ÌÑ¥
- P: ÏÉàÎ°úÏö¥ Îü∞

(Î™®Î∞îÏùº)
- ÏÜêÌå®: ÌÅ¥Î¶≠ Ïãú ÏÑ†ÌÉù, Í∏∏Í≤å ÎàÑÎ•º Ïãú ÌôïÎåÄ
- Ïπ¥Îìú ÏÑ†ÌÉù ÏÉÅÌÉúÏóêÏÑú Ïä¨Î°ØÏùÑ ÎàåÎü¨ Î∞∞Ïπò
- Ïä¨Î°Ø: ÌÅ¥Î¶≠ Ïãú ÌôïÎåÄ, Í∏∏Í≤å ÎàÑÎ•º Ïãú ÌöåÏàò
- Ïä¨Î°ØÏóê ÎÑ£ÏùÄ Ïπ¥ÎìúÎäî Ïù¥Î¶ÑÎßå Î≥¥ÏûÖÎãàÎã§.

[6] ÎãπÏã†ÏùÑ ÏúÑÌïú Ï°∞Ïñ∏

Îç±ÏùÄ ÎãπÏã†Ïùò ÎπÑÌíàÏûÖÎãàÎã§. ÎπÑÌíàÏù¥ Ï†ÅÏúºÎ©¥, Îäò ÏÉàÎ°ú Íæ∏Î¶¨ÎäêÎùº ÌûòÎì§ Í≤ÅÎãàÎã§. ÎπÑÌíàÏù¥ ÎßéÏúºÎ©¥, Îì§Í≥† Îã§ÎãàÍ∏∞ ÌûòÎì§Í≤†ÏßÄÏöî. Í∑†ÌòïÏùÑ Ï∞æÏúºÏÑ∏Ïöî.

[7] ÏãúÍ∞Ñ

ÏãúÍ∞ÑÏùÄ Í∏àÏûÖÎãàÎã§. Î™®Îì† ÌñâÎèôÏùÄ ÏãúÍ∞ÑÏùÑ ÏÜåÎ™®Ìï©ÎãàÎã§. Ïã∏ÏõÄÏùÄ Ï¢Ä Îçî ÏÜåÎ™®Ìï†ÏßÄÎèÑ Î™®Î•¥Í≤†Íµ∞Ïöî.
Ï§ëÏöîÌïú Í±¥ Ïù¥Í≥≥Ïù¥ ÎãπÏã†ÏóêÍ≤å ÎÑâÎÑâÌïú ÏãúÍ∞ÑÏùÑ Ï£ºÏßÄ ÏïäÎäîÎã§Îäî Í≤ÉÏù¥Í≤†ÏßÄÏöî.
`;function Ro(e){return new Promise(t=>window.setTimeout(t,e))}function Bo(e){switch(e){case"BACK":return 100;case"FRONT":return 100;case"ENEMY":return 100;case"UPKEEP":return 100;case"DRAW":return 100;case"PLACE":return 0;default:return 220}}let mt=!1;function Oo(){document.querySelectorAll(".slot").forEach(e=>{const t=e.querySelector(".slotCardScaler");t&&er(e,t)})}function Ho(e){mt||(mt=!0,requestAnimationFrame(()=>{mt=!1,Yt(),Qt(),Gt(),Oo()}))}let Lo=1,nt=[],Fn=null;function Fe(e,t,n,r){nt.push({id:Lo++,kind:e,text:t,x:n,y:r,born:performance.now()})}function Mo(){const e=performance.now();nt=nt.filter(t=>e-t.born<700)}let Ve=null,je=null,ht=[];function Do(e){if(!(!e.run.finished&&e.enemies.length>0&&e.phase!=="NODE")){Ve=null,je=null,ht=[];return}if(Ve!=null){const n=e.player.hp-Ve;n!==0&&Fo(n)}if(je!=null){const n=e.player.block-je;n!==0&&Wo(n)}for(let n=0;n<e.enemies.length;n++){const r=e.enemies[n].hp,o=ht[n];o!=null&&r!==o&&Uo(n,r-o)}Ve=e.player.hp,je=e.player.block,ht=e.enemies.map(n=>n.hp)}function Fo(e){const t=document.querySelector(".playerHudBox")??document.querySelector(".playerHudLeft");if(!t)return;const n=t.getBoundingClientRect(),r=(n.left+n.right)/2,o=n.top+14;e<0?Fe("dmg",`${e}`,r,o):Fe("heal",`+${e}`,r,o),t.classList.add("fxFlash"),setTimeout(()=>t.classList.remove("fxFlash"),240)}function Wo(e){const t=document.querySelector(".playerHudBox")??document.querySelector(".playerHudLeft");if(!t)return;const n=t.getBoundingClientRect(),r=(n.left+n.right)/2,o=n.top+34;Fe("block",e>0?`+${e}`:`${e}`,r,o)}function Uo(e,t){const r=Array.from(document.querySelectorAll(".enemyHudCenter .enemyBanner"))[e];if(!r)return;const o=r.getBoundingClientRect(),a=(o.left+o.right)/2,s=o.top+14;t<0?Fe("dmg",`${t}`,a,s):Fe("heal",`+${t}`,a,s),r.classList.add("fxFlash"),setTimeout(()=>r.classList.remove("fxFlash"),240)}const Wn="deckrogue_uiSettings_v1";function _t(e,t,n){return Math.max(t,Math.min(n,e))}function Un(){try{const e=localStorage.getItem(Wn);if(!e)return{uiScaleDesktop:1,uiScaleMobile:1,slotCardMode:"FULL"};const t=JSON.parse(e),n=t.slotCardMode==="NAME_ONLY"?"NAME_ONLY":"FULL";return{uiScaleDesktop:_t(Number(t.uiScaleDesktop??1)||1,.75,1.5),uiScaleMobile:_t(Number(t.uiScaleMobile??1)||1,.75,1.5),slotCardMode:n}}catch{return{uiScaleDesktop:1,uiScaleMobile:1,slotCardMode:"FULL"}}}let Q=Un();function zo(){return dt()?Q.uiScaleMobile:Q.uiScaleDesktop}function R(e){return Math.round(e*zo())}function dt(){return window.matchMedia("(max-width: 900px) and (pointer: coarse)").matches}let me=!1;function Ko(){try{const e=localStorage.getItem("deckrogue_logCollapsed");if(e==null)return;me=e==="1"}catch{}}function qo(){try{localStorage.setItem("deckrogue_logCollapsed",me?"1":"0")}catch{}}let Ye=null;function Vo(e){Ye!=null&&window.clearTimeout(Ye),Ye=window.setTimeout(()=>{Ye=null,wo(e)},250)}let yt=!1;async function jo(e,t){if(e._justStartedCombat){e._justStartedCombat=!1;return}if(!yt){yt=!0;try{if(e.run.finished||e.choice||X(e)||M||e.phase==="NODE")return;let n=0;for(;n++<60&&!(e.run.finished||e.choice||M||X(e));){const r=Zn(e,t,!1);if(!r.fn||r.disabled)break;const o=e.phase;if(r.fn(),C(e,t),e.phase==="PLACE")break;const a=Bo(o);a>0&&await Ro(a)}}finally{yt=!1}}}function Pt(e){const t=e.run;t.nextBossTime==null&&(t.nextBossTime=40),t.forcedNext==null&&(t.forcedNext=null)}function $t(e){return(e.run.nodePickCount??0)+(e.time??0)}function dn(e){const o=Math.max(0,e-20),a=Math.min(85,Math.floor(o*o/3));return{extra:Math.random()*100<a?1:0,pPct:a}}function Yo(e,t){const n=e;return n.content=t,n.time??=0,n.run.relics??=[],n.run??={},n.run.nextBossTime??=40,n.run.forcedNext??=null,n.run.bossOmenText??=null,n.run.enemyLastSeenBattle??={},n.run.nodePickByType??={BATTLE:0,ELITE:0,REST:0,EVENT:0,TREASURE:0},n.run.bossPool??=["boss_gravity_master","boss_cursed_wall","boss_giant_orc","boss_soul_stealer"],n.run.nextBossId??=null,n.run.afterTreasureNodePicks??=0,n.run.deckSizeAtTreasure??=null,n.run.treasureObtained&&n.run.deckSizeAtTreasure==null&&(n.run.deckSizeAtTreasure=lt(n)),n.choiceStack??=[],n.pendingTargetQueue??=[],n.exhausted??=[],n.vanished??=[],n.choiceQueue??=[],n.choiceCtx??=null,n}function Xo(e){if(!go())return Tt(e);const t=_o();return t?Yo(t.state,e):Tt(e)}function Go(){if(document.querySelector(".bgLayer"))return;const e=document.createElement("div");e.className="bgLayer",document.body.appendChild(e)}let un=0,pn=0,re=null,zn=0;function qt(){try{Kn.hide()}catch{}const e=document.querySelector(".cardHoverPreview");e&&e.classList.remove("on")}function Vt(e=250){zn=performance.now()+e}const Kn=Qo();function Qo(){let e=null,t=null,n=null,r=null;function o(i){if(e)return;e=x("cardHoverPreview"),t=x("cardHoverPreviewTitle");const d=x("cardHoverPreviewRow");n=x("cardHoverPreviewCard"),r=x("cardHoverPreviewDetail"),d.appendChild(n),d.appendChild(r),e.appendChild(t),e.appendChild(d),i.appendChild(e)}function a(i){!e||!t||!n||!r||(t.textContent=i.title,n.innerHTML="",i.cardEl&&n.appendChild(i.cardEl),r.textContent=i.detail,e.classList.add("on"))}function s(){e&&e.classList.remove("on")}return{ensure:o,show:a,hide:s}}function rt(e,t){const n=e.cards[t];return se(e.content,n.defId,n.upgrade??0)}function ot(e,t){return e.content.cardsById[t]?.name??t}function Jo(e,t,n){const r=n??0,o=e.content.cardsById[t]?.name??t;return r>0?`${o} +${r}`:o}function te(e,t){const n=e.cards[t];return Jo(e,n.defId,n.upgrade??0)}function ze(e,t,n,r,o){const a=e.cards[t],s=se(e.content,a.defId,a.upgrade??0),i=o?.draggable??!0,d=o?.mode??"FULL",l=x("card");e.selectedHandCardUid===t&&l.classList.add("selected"),s.tags?.includes("EXHAUST")&&l.classList.add("exhaust"),s.tags?.includes("VANISH")&&l.classList.add("vanish"),d==="SLOT_NAME_ONLY"&&l.classList.add("slotNameOnly");const h=x("cardHeader"),f=Vn(e,t);if(h.appendChild(J("cardTitle",f)),d==="FULL"){const p=x("cardMeta");s.tags?.includes("EXHAUST")&&p.appendChild(At("ÏÜåÎ™®")),s.tags?.includes("VANISH")&&p.appendChild(At("ÏÜåÏã§")),h.appendChild(p)}if(l.appendChild(h),d==="FULL"){const p=x("cardBody"),k=x("cardSection");k.classList.add("front"),k.appendChild(mn(s.frontText)),p.appendChild(k);const A=x("cardSection");A.classList.add("back"),A.appendChild(mn(s.backText)),p.appendChild(A),l.appendChild(p)}if(n&&r&&(l.onclick=()=>r(t)),n&&(l.onpointerdown=p=>{if(p.button!==0&&p.pointerType==="mouse"||X(e)||e.phase!=="PLACE"||!i)return;const k=e.hand.indexOf(t);tr(p,{kind:"hand",cardUid:t,fromHandIndex:k})}),o?.hoverPreview){const{root:p,api:k,buildDetail:A}=o.hoverPreview;k.ensure(p);const u=A?.(e,t)??(()=>{const c=at(s.frontText),y=at(s.backText);return`Ï†ÑÏó¥: ${c||"ÏóÜÏùå"}
ÌõÑÏó¥: ${y||"ÏóÜÏùå"}`})();l.addEventListener("pointerenter",c=>{if(performance.now()<zn||S?.dragging)return;const y=ze(e,t,!1,void 0,{draggable:!1,mode:"FULL"});y.classList.add("isPreviewCard"),k.show({title:f,detail:u,cardEl:y})}),l.addEventListener("pointerleave",()=>{k.hide()}),l.addEventListener("pointerdown",()=>{Vt(250),qt()},{capture:!0})}return l}function at(e){if(!e)return"";if(typeof e=="string")return e;if(Array.isArray(e))return e.map(at).join("");if(typeof e=="object"){if(e.text)return String(e.text);if(e.children)return at(e.children)}return""}function x(e){const t=document.createElement("div");return t.className=e,t}function J(e,t){const n=document.createElement("div");return n.className=e,n.textContent=t,n}function Zo(e){const t=document.createElement("h2");return t.textContent=e,t}function ea(e){const t=document.createElement("h3");return t.textContent=e,t}function jt(e){const t=document.createElement("p");return t.textContent=e,t}function At(e){const t=document.createElement("span");return t.className="badge",t.textContent=e,t}function Nt(e,t,n){const r=document.createElement("button");return r.textContent=e,r.disabled=n,r.onclick=t,r}function ta(e){const t=document.createElement("pre");return t.className="log",t.textContent=e,t}function qn(e,t){const n=t??0;return n>0?`${e} +${n}`:e}function Vn(e,t){const n=e.cards[t],r=e.content.cardsById[n.defId].name;return qn(r,n.upgrade)}function na(e,t){const n=e.content.cardsById[t.defId].name;return qn(n,t.upgrade)}const ra={Ï∑®ÏïΩ:"üéØ",ÏïΩÌôî:"ü•Ä",Ï∂úÌòà:"ü©∏",ÍµêÎûÄ:"üåÄ",Î©¥Ïó≠:"‚ú®",S:"üåæ",F:"üí§",ÎìúÎ°úÏö∞:"üÉè",ÌîºÌï¥:"üó°Ô∏è",ÌöåÎ≥µ:"üíä",Î∞©Ïñ¥:"üõ°Ô∏è",Î∏îÎ°ù:"üõ°Ô∏è",ÏÜåÎ™®:"üî•",ÏÜåÏã§:"üï≥Ô∏è"};function fn(e,t,n){const r=ra[e]??"",o=t!=null?`${e} ${t}`:e;return`<span class="kwBadge"><span class="kwIcon">${r}</span> <span class="kwLabel">${o}</span><span class="kwPunc">${n||""}</span></span>`}const jn="[,Ôºå„ÄÅ]",oa=new RegExp(`(Ï∑®ÏïΩ|ÏïΩÌôî|Ï∂úÌòà|ÍµêÎûÄ|Î©¥Ïó≠|S|F|ÎìúÎ°úÏö∞|ÌîºÌï¥|Î∞©Ïñ¥|Î∏îÎ°ù|ÌöåÎ≥µ|ÏÜåÎ™®|ÏÜåÏã§)\\s*([+-]?\\d+)\\s*(${jn})?`,"g"),aa=new RegExp(`(^|[^Í∞Ä-Ìû£A-Za-z0-9_])(ÏÜåÎ™®|ÏÜåÏã§)\\s*(${jn})?`,"g");function sa(e){let t=e.replace(oa,(n,r,o,a)=>fn(r,o,a));return t=t.replace(aa,(n,r,o,a)=>`${r}${fn(o,void 0,a)}`),t=t.replace(/\n/g,"<br>"),t}function mn(e){const t=x("cardText");return t.innerHTML=sa(e),t}function ia(e){return`assets/enemies/${e}.png`}const hn={vuln:"üéØ",weak:"ü•Ä",bleed:"ü©∏",disrupt:"üåÄ",immune:"‚ú®",supplies:"üåæ",fatigue:"üí§"};function Yn(e){return e==="ATTACK"||e==="ATTACK_BUFF"||e==="ATTACK_DEBUFF"}function la(e,t,n){if(!n||!Yn(n.cat))return"";const r=Math.max(1,Number(n.hits??1)||1),o=Math.max(0,Number(n.perHit??0)||0),a=Math.max(0,Number(n.dmgTotal??o*r)||0);return r>1?`${a} (${o}*${r})`:`${a}`}function ca(e){if(!e)return"Ôºü";const t=Yn(e.cat),n=e.applies??[],r=n.some(s=>s.target==="player"),o=n.some(s=>s.target==="enemy");let a="";if(t&&(a+="üó°Ô∏è"),r&&(a+="üåÄ"),o&&(a+="‚ú®"),!a){const s=e.cat;return s==="DEFEND"?"üõ°Ô∏è":s==="BUFF"?"‚ú®":s==="DEBUFF"?"üåÄ":"Ôºü"}return a}function da(e,t){const n=x("enemyStatusEmojiRow"),r=(o,a)=>{if(!a||a<=0)return;const s=document.createElement("span");s.className="stEmoji",s.textContent=`${hn[o]??"?"}${a}`,n.appendChild(s)};if(r("vuln",e?.vuln??0),r("weak",e?.weak??0),r("bleed",e?.bleed??0),r("disrupt",e?.disrupt??0),t){const o=document.createElement("span");o.className="stEmoji",o.textContent=`${hn.immune}1`,n.appendChild(o)}return n}let M=null,yn=!1,S=null,ae=null,It=!1,oe=null,ye=null,be=null;function ua(e,t,n){const r=e.cards[t];return Xn(e,r.defId,n)}function st(e,t,n){const o=ze(e,t,!!n,n,{draggable:!1});return o.classList.add("overlayCard"),o}function Xn(e,t,n){const r=`__preview:${t}:${n}:${Math.random().toString(36).slice(2)}`,o=e.cards[r];e.cards[r]={uid:r,defId:t,upgrade:n,zone:"preview"};const a=ze(e,r,!1,void 0,{draggable:!1});return a.classList.add("overlayCard"),a.draggable=!1,a.style.pointerEvents="none",o?e.cards[r]=o:delete e.cards[r],a}const Re="Ô∏é";function bn(e,t){const n=document.createElement("span");return n.className=e,n.textContent=t,n}function pa(e,t){return e==="BATTLE"?t?{icon:"‚ò†"+Re,text:"Î≥¥Ïä§",kind:"boss"}:{icon:"‚öî"+Re,text:"Ï†ÑÌà¨",kind:"battle"}:e==="ELITE"?{icon:"‚ò†"+Re,text:"Ï†ïÏòà",kind:"elite"}:e==="REST"?{icon:"‚õ∫Ô∏é"+Re,text:"Ìú¥Ïãù",kind:"rest"}:e==="EVENT"?{icon:"‚ùîÔ∏é"+Re,text:"ÎØ∏ÏßÄ",kind:"event"}:{icon:"‚ú¶",text:"Î≥¥Î¨º",kind:"treasure"}}function Xe(e,t,n){const r=pa(t,n),o=document.createElement("span");o.className=`nodeIcon ${r.kind}`,o.textContent=r.icon;const a=document.createElement("span");a.className="nodeText",a.textContent=`(${r.text})`,e.appendChild(o),e.appendChild(a)}function fa(e,t,n){const r=R(106),o=x("nodeSelectWrap");o.style.cssText=`margin-top:${r}px;`;const a=[`[ÌÉêÌóò ${t.run.nodePickCount}Ìöå]`];if(t.run.treasureObtained){const g=t.run.deckSizeAtTreasure??lt(t),B=Je(g);a.push(`[ÌÉàÏ∂úÍπåÏßÄ ${t.run.afterTreasureNodePicks}/${B}]`)}o.appendChild(jt(a.join(" "))),Pt(t),(!t.run.bossOmenText||String(t.run.bossOmenText).trim()==="")&&(t.run.bossOmenText="ÏïÑÏßÅ ÏßïÏ°∞Í∞Ä ÏóÜÎã§.");const s=t.run,i=$t(t),d=s.nextBossTime??40,l=n.getNodeOffers(),h=s.nodeExtra01??0,f=i+1+h,p=s.forcedNext==="BOSS",k=!p&&f>=d,A=!p&&!k&&(l[0]?.type==="BATTLE"||l[1]?.type==="BATTLE"),u=f+1,c=p?f+1:A?u:f,y=Math.max(0,d-i);if(c>=d&&s.forcedNext!=="BOSS"){const g=J("bossIncomingBanner","Î≥¥Ïä§Í∞Ä Ïò®Îã§.");g.style.cssText="margin-top:10px; padding:10px 12px; border-radius:14px;border:1px solid rgba(255,255,255,1);background: rgba(255,120,60,1);font-weight:700; font-size:13px; line-height:1.25;",o.appendChild(g)}const{tier:b}=it(t),E=b===0?"":b===1?Math.random()<.1?" . . . Îì§Î¶∞Îã§.":"":b===2?Math.random()<.1?" . . . Î≥¥Ïù∏Îã§.":"":Math.random()<.1?" . . . ÎãøÏïòÎã§.":"",w=` . . . ${t.run.bossOmenText}${E}`,v=J("bossOmenBanner",`Îã§Ïùå Î≥¥Ïä§ÍπåÏßÄ ÎÇ®ÏùÄ ÏãúÍ∞Ñ: ${y}${w}`);v.style.cssText="margin-top:8px; padding:10px 12px; border-radius:14px;border:1px solid rgba(255, 255, 255, 1);background:rgba(0, 0, 0, 1);font-weight:600;font-size:13px;line-height:1.2;",v.style.color="white",o.appendChild(v);const _=t.run.branchOffer;if(_){const g=x("nodePreviewBox");g.style.cssText="margin-top:10px; padding:12px; border:1px solid rgba(255,255,255,1); border-radius:16px; background:rgba(0,0,0,1);";const B=s.forcedNext==="BOSS",O=D=>{const L=x("nodePreviewRow");L.onmouseenter=()=>L.style.background="rgba(255,255,255,.06)",L.onmouseleave=()=>L.style.background="transparent",L.onclick=()=>n.onChooseNode(D);const F=D==="A"?0:1,$=x("nodeCol"),P=document.createElement("div");P.className="nodePill primary",P.onclick=pe=>{pe.stopPropagation(),n.onChooseNode(D)},P.replaceChildren(),B?Xe(P,"BATTLE",!0):Xe(P,l[F]?.type??"BATTLE",!1),$.appendChild(P);const W=x("nodeCol");W.appendChild(bn("nodeSepArrow","‚Üí"));const z=D==="A"?_.nextIfA:_.nextIfB,I=z[0]?.type??"BATTLE",V=z[1]?.type??"BATTLE",N=x("nodeCol"),K=document.createElement("span");K.replaceChildren(),Xe(K,I,!1),N.appendChild(K);const H=x("nodeCol");H.appendChild(bn("nodeSepSlash","/"));const q=x("nodeCol"),U=document.createElement("span");return U.replaceChildren(),Xe(U,V,!1),q.appendChild(U),L.appendChild($),L.appendChild(W),L.appendChild(N),L.appendChild(H),L.appendChild(q),L};g.appendChild(O("A")),g.appendChild(O("B")),o.appendChild(g),o.appendChild(ma()),e.appendChild(o)}}function ma(){return document.createElement("hr")}function Gn(e,t){let n=null,r=!1,o=!1;const a=[];function s(u){a.length=0,u.choice=null,n=null,document.querySelector(".choice-overlay")?.remove()}function i(u){a.push({choice:u.choice,handler:n})}function d(u){const c=a.pop();if(!c){l(u);return}u.choice=c.choice,n=c.handler}function l(u){if(a.length>0){d(u);return}u.choice=null,n=null,document.querySelector(".choice-overlay")?.remove()}function h(u,c,y){u.choice&&i(u),u.choice=c,n=y}const f=()=>re||e,p={onHotkeySlot:(u,c)=>{const y=f();if(y.run.finished||X(y)||y.phase!=="PLACE"||u==="back"&&y.backSlotDisabled?.[c])return;const T=u==="front"?y.frontSlots:y.backSlots,b=T[c];if(!y.selectedHandCardUid){if(!b)return;p.onReturnSlotToHand(u,c);return}const E=y.selectedHandCardUid;if(!b){p.onPlaceHandUidToSlot(E,u,c);return}T[c]=null,y.usedThisTurn=Math.max(0,y.usedThisTurn-1),u==="front"&&(y.frontPlacedThisTurn=Math.max(0,y.frontPlacedThisTurn-1)),y.hand.push(b),y.cards[b].zone="hand",en(y,E,u,c),y.selectedHandCardUid=null,m(y,`[${te(y,E)}] ‚Üî [${te(y,b)}] Ïä§Ïôë: ÏÜêÌå® ‚Üî ${u}${c+1}`),C(y,p)},rerender:()=>{const u=f();C(u,p)},onToggleLogOverlay:()=>{It=!It,C(f(),p)},onCloseOverlay:()=>{const u=f();M=null,C(u,p)},onNewRun:()=>{const u=f();ae=null,M=null,S=null,l(u),vo(),t(Tt(u.content))},onViewRulebook:()=>{const u=f();M={kind:"RULEBOOK"},C(u,p)},onViewPile:u=>{const c=f();M={kind:"PILE",pile:u},C(c,p)},onViewSettings:()=>{const u=f();M={kind:"SETTINGS"},C(u,p)},onReturnSlotToHand:(u,c)=>{const y=f();if(y.run.finished||X(y)||y.phase!=="PLACE")return;const T=u==="front"?y.frontSlots:y.backSlots,b=T[c];b&&(T[c]=null,y.usedThisTurn=Math.max(0,y.usedThisTurn-1),u==="front"&&(y.frontPlacedThisTurn=Math.max(0,y.frontPlacedThisTurn-1)),y.hand.push(b),y.cards[b].zone="hand",m(y,`[${te(y,b)}] ÌöåÏàò: ${u}${c+1} ‚Üí ÏÜêÌå®`),C(y,p))},onClearSelected:()=>{const u=f();u.selectedHandCardUid=null,C(u,p)},onSelectEnemy:u=>{const c=f();if(o)return;o=!0,requestAnimationFrame(()=>{o=!1});const y=ao(c,u);C(c,p),y&&!c.choice&&!c.run.finished&&p.onAutoAdvance()},onSelectHandCard:u=>{const c=f();X(c)||(c.selectedHandCardUid=c.selectedHandCardUid===u?null:u,C(c,p))},getNodeOffers:()=>{const u=f();Pt(u),u.run.branchOffer||(u.run.branchOffer=Qe(u));const c=u.run,y=$t(u);if(c.forcedNext==="BOSS")return c.nodeExtra01=0,[{id:"A",type:"BATTLE"},{id:"B",type:"BATTLE"}];if(c.nodeExtra01==null&&(c.nodeExtra01=dn(u.deck.length).extra),y+1+c.nodeExtra01>=c.nextBossTime)return[{id:"A",type:"REST"},{id:"B",type:"REST"}];const E=.05,w=u.run.branchOffer.root;if(c.nodeEliteAB==null){const v=w[0].type==="BATTLE"&&Math.random()<E,_=w[1].type==="BATTLE"&&Math.random()<E;c.nodeEliteAB={A:v,B:_}}return[{...w[0],type:c.nodeEliteAB.A?"ELITE":w[0].type},{...w[1],type:c.nodeEliteAB.B?"ELITE":w[1].type}]},getNodeOffer:u=>{const c=p.getNodeOffers(),y=c[0]??{id:"A",type:"BATTLE"},T=c[1]??y;return u==="A"?y:T},onChooseNode:u=>{const c=f();if(r||(r=!0,queueMicrotask(()=>r=!1),c.run.finished)||c.phase!=="NODE")return;Pt(c),c.run.branchOffer||(c.run.branchOffer=Qe(c));const y=c.run,T=p.getNodeOffers(),b=u==="A"?T[0].type:T[1].type,E=$t(c),w=y.forcedNext==="BOSS";let v=0;w||(y.nodeExtra01==null&&(y.nodeExtra01=dn(c.deck.length).extra),v=y.nodeExtra01);const _=E+1+v,g=c.run.nodePickCount+1;c.run.nodePickCount=g,y.nodeExtra01=null,y.nodeEliteAB=null;const B=!w&&_>=y.nextBossTime,O=w?"BATTLE":B?"REST":b,D=O==="BATTLE"||O==="ELITE"?1:0,L=_+D;if(c.time=(c.time??0)+v+D,D&&m(c,"Ï†ÑÌà¨Î•º ÏÑ†ÌÉùÌï¥ ÏãúÍ∞ÑÏù¥ Îçî ÏÜåÎ™®ÎêúÎã§. (ÏãúÍ∞Ñ +1)"),sr(c,u),c.run.nodePickByType[O]=(c.run.nodePickByType[O]??0)+1,c.run.treasureObtained&&O!=="TREASURE"){c.run.afterTreasureNodePicks+=1;const F=c.run.deckSizeAtTreasure??lt(c),$=Je(F);if(c.run.afterTreasureNodePicks>=$){c.run.finished=!0,m(c,`ÏäπÎ¶¨! Î≥¥Î¨º ÌöçÎìù ÌõÑ ${$}Î≤àÏùò ÌÉêÌóòÏùÑ Î≤ÑÌã∞Í≥† ÌÉàÏ∂úÌñàÏäµÎãàÎã§.`),C(c,p);return}}if(w){y.forcedNext=null,y.nextBossTime+=40,c.run.bossOmenText=null,m(c,`=== ÏãúÍ∞Ñ ${L}: Î≥¥Ïä§ Ï†ÑÌà¨ ===`),Pe(c,{forceBoss:!0}),Ae(c),c._justStartedCombat=!1,C(c,p);return}if(!w&&L>=y.nextBossTime&&(y.forcedNext="BOSS",m(c,"ÏãúÍ∞ÑÏù¥ ÌùòÎü¨ Î≥¥Ïä§Í∞Ä Îã§Í∞ÄÏòµÎãàÎã§!")),O==="BATTLE"||O==="ELITE"){O==="ELITE"&&(c.run.pendingElite=!0,m(c,"Ï†ïÏòàÍ∞Ä ÎÇòÌÉÄÎÇ¨Îã§!")),Pe(c,{forceBoss:!1}),Ae(c),c._justStartedCombat=!1,C(c,p);return}if(O==="REST"){let F=function(P){const W=P.player.fatigue??0;W<10||(P.player.fatigue=Math.max(0,W-2),P.time=(P.time??0)+1,m(P,"ÌîºÎ°úÍ∞Ä ÎÑàÎ¨¥ ÎÜíÏïÑ Ìú¥ÏãùÏù¥ Îçî Ïò§Îûò Í±∏Î¶ΩÎãàÎã§. (F -2, ÏãúÍ∞Ñ +1)"))};const $=()=>{const P=(c.player.fatigue??0)>=10,W=P?"ÌîºÎ°úÎèÑÍ∞Ä ÎÑàÎ¨¥ ÎÜíÏïÑ Îçî Ïâ¨Ïñ¥Ïïº Ìï©ÎãàÎã§.":"Ìú¥Ïãù",z=P?" (ÌîºÎ°úÎèÑ 10 Ïù¥ÏÉÅ: F -2, ÏãúÍ∞Ñ +1)":"";c.choice={kind:"EVENT",title:W,prompt:"Î¨¥ÏóáÏùÑ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?",art:"assets/events/event_rest.png",options:[{key:"rest:heal",label:`HP +15 ${z}`},{key:"rest:clear_f",label:`F -3 ${z}`},{key:"rest:upgrade",label:`Í∞ïÌôî ${z}`},{key:"rest:skip",label:"ÏÉùÎûµ"}]},n=I=>{if(I==="rest:heal"){F(c),c.player.hp=Math.min(c.player.maxHp,c.player.hp+15),m(c,"Ìú¥Ïãù: HP +15"),l(c),c.phase="NODE",C(c,p);return}if(I==="rest:clear_f"){F(c),c.player.fatigue=Math.max(0,c.player.fatigue-3),m(c,"Ìú¥Ïãù: ÌîºÎ°ú F-=3"),l(c),c.phase="NODE",C(c,p);return}if(I==="rest:upgrade"){A(c,p,"Í∞ïÌôî","Í∞ïÌôîÌï† Ïπ¥Îìú 1Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.",{onDone:()=>{F(c),c.phase="NODE",C(c,p)},onSkip:()=>{$(),C(c,p)}});return}m(c,"Ìú¥Ïãù: ÏÉùÎûµ"),l(c),c.phase="NODE",C(c,p)}};$(),C(c,p);return}if(O==="TREASURE"){Ir(c);const F=c.run.deckSizeAtTreasure,$=Je(F);m(c,`Ï†ÄÏ£ºÎ∞õÏùÄ Î≥¥Î¨ºÏùÑ ÏñªÏóàÏäµÎãàÎã§! Ïù¥Ï†úÎ∂ÄÌÑ∞ ${$}Î≤àÏùò ÌÉêÌóòÏùÑ Î≤ÑÌã∞Î©¥ ÌÉàÏ∂úÌï©ÎãàÎã§.`),C(c,p);return}if(O==="EVENT"){const F=c.run;F.ominousProphecySeen??=!1;const $=.3;let P=an(c);if(F.ominousProphecySeen===!0)for(let I=0;I<50&&P.id==="ominous_prophecy";I++)P=an(c);else Math.random()<$&&(P=Ln("ominous_prophecy")??P,F.ominousProphecySeen=!0);const W=P.options(c),{tier:z}=it(c);z>=2&&W.push({key:"mad:whisper",label:"ÏÜçÏÇ≠ÏûÑÏóê Í∑Ä Í∏∞Ïö∏Ïù∏Îã§.",detail:"Î¨¥Ïñ∏Í∞ÄÎ•º ÏñªÎäîÎã§. Í∑∏Î¶¨Í≥† Î¨¥Ïñ∏Í∞ÄÎ•º ÏûÉÎäîÎã§.",apply:I=>{const V=Math.random();return V<.34?(I.player.hp=Math.min(I.player.maxHp,I.player.hp+10),m(I,"ÏÜçÏÇ≠ÏûÑ: HP +10")):V<.67?(I.player.fatigue+=1,m(I,"ÏÜçÏÇ≠ÏûÑ: F +1 (ÎåÄÍ∞Ä)")):(et(I,"mad_echo",{upgrade:0}),m(I,"ÏÜçÏÇ≠ÏûÑ: [Î©îÏïÑÎ¶¨]Î•º ÏñªÏóàÎã§.")),"NONE"}}),c.choice={kind:"EVENT",title:P.name,prompt:P.prompt,art:P.art??null,options:W.map(I=>({key:I.key,label:I.label,detail:I.detail}))},n=I=>{const V=W.find(K=>K.key===I);if(!V)return;const N=V.apply(c);if(typeof N=="object"&&N.kind==="UPGRADE_PICK"){A(c,p,N.title??"Í∞ïÌôî",N.prompt??"Í∞ïÌôîÌï† Ïπ¥Îìú 1Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.");return}if(typeof N=="object"&&N.kind==="REMOVE_PICK"){const K=Object.values(c.cards).filter(H=>H.zone==="deck"||H.zone==="hand"||H.zone==="discard").map(H=>H.uid);h(c,{kind:"PICK_CARD",title:N.title,prompt:N.prompt??"Ï†úÍ±∞Ìï† Ïπ¥Îìú 1Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.",options:[...K.map(H=>{const q=rt(c,H);return{key:`remove:${H}`,label:te(c,H),detail:`Ï†ÑÏó¥: ${q.frontText} / ÌõÑÏó¥: ${q.backText}`,cardUid:H}}),{key:"cancel",label:"Ï∑®ÏÜå"}]},H=>{if(H==="cancel"){m(c,"Ï†úÍ±∞ Ï∑®ÏÜå"),l(c),C(c,p);return}if(!H.startsWith("remove:")){C(c,p);return}const q=H.slice(7);Wt(c,q);const U=N.then,pe=U==="REWARD"||U==="REWARD_PICK"?"REWARD_PICK":U==="BATTLE"?"BATTLE":U==="NONE"?"NONE":void 0;if(pe==="BATTLE"){s(c),c.phase="NODE",Pe(c),Ae(c),C(c,p);return}if(pe==="REWARD_PICK"){s(c),k(c,p,"Ïπ¥Îìú Î≥¥ÏÉÅ","Îëê Ïû• Ï§ë Ìïú Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÍ±∞ÎÇò ÏÉùÎûµÌï©ÎãàÎã§."),C(c,p);return}s(c),c.phase="NODE",C(c,p)}),C(c,p);return}if(typeof N=="object"&&N.kind==="BATTLE_SPECIAL"){s(c),m(c,N.title?`Ïù¥Î≤§Ìä∏ Ï†ÑÌà¨: ${N.title}`:"Ïù¥Î≤§Ìä∏ Ï†ÑÌà¨ Î∞úÏÉù!"),c.phase="NODE",Pe(c,{forcePatternIds:N.enemyIds}),Ae(c),C(c,p);return}if(N==="BATTLE"){s(c),c.phase="NODE",Pe(c),Ae(c),C(c,p);return}if(N==="REWARD"){s(c),k(c,p,"Ïπ¥Îìú Î≥¥ÏÉÅ","Îëê Ïû• Ï§ë Ìïú Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÍ±∞ÎÇò ÏÉùÎûµÌï©ÎãàÎã§."),C(c,p);return}l(c),C(c,p)},C(c,p);return}},onChooseChoice:u=>{const c=f();if(!c.choice)return;const y=c.choice.kind;if(Eo(c,u)){const T=y==="EVENT"&&u==="startBattle";C(c,p),T||p.onAutoAdvance();return}if(n){n(u);const T=y==="EVENT"&&u==="startBattle";C(c,p),T||p.onAutoAdvance();return}m(c,`ÏÑ†ÌÉù Ï≤òÎ¶¨ Î∂àÍ∞Ä: handler ÏóÜÏùå (kind=${y}, key=${u})`)},onAutoAdvance:()=>{const u=f();jo(u,p)},onRevealIntents:()=>{const u=f();u.run.finished||u.enemies.length!==0&&(Ft(u),C(u,p))},onPlaceHandUidToSlot:(u,c,y)=>{const T=f();T.run.finished||X(T)||T.phase==="PLACE"&&(c==="back"&&T.backSlotDisabled?.[y]||(en(T,u,c,y),T.selectedHandCardUid=null,C(T,p)))},onPlaceSelected:(u,c)=>{const y=f();y.selectedHandCardUid&&p.onPlaceHandUidToSlot(y.selectedHandCardUid,u,c)},onMoveSlotCard:(u,c,y,T)=>{const b=f();if(b.run.finished||X(b)||b.phase!=="PLACE"||y==="back"&&b.backSlotDisabled?.[T])return;const E=u==="front"?b.frontSlots:b.backSlots,w=y==="front"?b.frontSlots:b.backSlots,v=E[c];if(!v)return;const _=w[T];E[c]=_??null,w[T]=v,b.cards[v].zone=y,_&&(b.cards[_].zone=u),u!==y&&(u==="front"&&(b.frontPlacedThisTurn=Math.max(0,b.frontPlacedThisTurn-1)),y==="front"&&(b.frontPlacedThisTurn+=1),_&&(y==="front"&&(b.frontPlacedThisTurn=Math.max(0,b.frontPlacedThisTurn-1)),u==="front"&&(b.frontPlacedThisTurn+=1))),m(b,_?`[${te(b,v)}] ‚Üî [${te(b,_)}] Ïä§Ïôë: ${u}${c+1} ‚Üî ${y}${T+1}`:`[${te(b,v)}] Ïù¥Îèô: ${u}${c+1} ‚Üí ${y}${T+1}`),Rt(b),C(b,p)},onResolveBack:()=>{const u=f();u.phase==="PLACE"&&Rt(u),Xr(u),C(u,p)},onResolveFront:()=>{const u=f();Gr(u),C(u,p)},onResolveEnemy:()=>{const u=f();Jr(u),C(u,p)},onUpkeep:()=>{const u=f();to(u),C(u,p)},onDrawNextTurn:()=>{const u=f();ro(u),C(u,p)}};function k(u,c,y,T){const E=An(u).map(w=>{const v=se(u.content,w.defId,w.upgrade);return{key:`pick:${w.defId}:${w.upgrade}`,label:na(u,w),detail:`Ï†ÑÏó¥: ${v.frontText} / ÌõÑÏó¥: ${v.backText}`}});u.choice={kind:"REWARD",title:y,prompt:T,options:[...E,{key:"skip",label:"ÏÉùÎûµ"}]},n=w=>{if(n=null,w.startsWith("pick:")){const v=w.slice(5),[_,g]=v.split(":"),B=Number(g??"0")||0;et(u,_,{upgrade:B})}else m(u,"Ïπ¥Îìú Î≥¥ÏÉÅ ÏÉùÎûµ");l(u),u.choice=null,u.run.finished||(u.phase="NODE"),C(u,c)},C(u,c)}function A(u,c,y,T,b){let E=Object.values(u.cards).filter(g=>(g.zone==="deck"||g.zone==="hand"||g.zone==="discard")&&Ut(u,g.uid)).map(g=>g.uid);const w=u.player.fatigue??0;let v=1/0;if(w>=8?v=4:w>=5&&(v=8),v!==1/0&&E.length>v&&(E=[...E].sort(()=>Math.random()-.5).slice(0,v)),E.length===0){m(u,"Í∞ïÌôîÌï† Ïàò ÏûàÎäî Ïπ¥ÎìúÍ∞Ä ÏóÜÏäµÎãàÎã§."),u.choice=null,n=null,b?.onSkip?b.onSkip():C(u,c);return}const _=[...E].sort((g,B)=>{const O=u.cards[g],D=u.cards[B],L=ot(u,O.defId),F=ot(u,D.defId),$=L.localeCompare(F,"ko");return $!==0?$:(O.upgrade??0)-(D.upgrade??0)});u.choice={kind:"UPGRADE_PICK",title:y,prompt:T,options:[..._.map(g=>{const B=u.cards[g],O=rt(u,g),D=se(u.content,B.defId,(B.upgrade??0)+1),L=te(u,g),F=`ÌòÑÏû¨: Ï†ÑÏó¥ ${O.frontText} / ÌõÑÏó¥ ${O.backText}
Í∞ïÌôî: Ï†ÑÏó¥ ${D.frontText} / ÌõÑÏó¥ ${D.backText}`;return{key:`up:${g}`,label:L,detail:F,cardUid:g}}),{key:"skip",label:"Ï∑®ÏÜå"}]},n=g=>{if(g==="skip"){m(u,"Í∞ïÌôî Ï∑®ÏÜå"),l(u),b?.onSkip?b.onSkip():C(u,c);return}if(g.startsWith("up:")){const B=g.slice(3),O=In(u,B);m(u,O?`Í∞ïÌôî: [${te(u,B)}]`:"Í∞ïÌôî Ïã§Ìå®"),l(u),b?.onDone?b.onDone():C(u,c);return}l(u),C(u,c)},C(u,c)}return p}function Rt(e){const t=e.frontSlots.filter(r=>r!=null).length,n=e.backSlots.filter(r=>r!=null).length;e.frontPlacedThisTurn=t,e.usedThisTurn=t+n}function ha(){const e=document.querySelector("#app");return e.innerHTML="",e}function ee(e,t,n=""){const r=document.createElement("button");return n&&(r.className=n),r.type="button",r.textContent=e,r.onclick=t,r}function Yt(){const e=Array.from(document.querySelectorAll(".enemyName"));if(e.length===0)return;e.forEach(o=>{o.style.display="inline-block",o.style.width="auto",o.style.whiteSpace="nowrap"});let t=0;for(const o of e)t=Math.max(t,o.scrollWidth);const r=Math.min(t,320);e.forEach(o=>{o.style.width=`${r}px`,o.style.overflow="hidden",o.style.textOverflow="ellipsis"})}function ya(){document.querySelector(".phaseBanner")?.remove(),performance.now()}function ba(){Mo();let e=document.querySelector(".floatFxLayer");e||(e=document.createElement("div"),e.className="floatFxLayer",document.body.appendChild(e)),e.style.cssText="position:fixed; inset:0;pointer-events:none;z-index: var(--zChrome);";for(const t of nt){const n=String(t.id);let r=e.querySelector(`.floatNum[data-fx-id="${n}"]`);r?(r.style.left=`${Math.round(t.x)}px`,r.style.top=`${Math.round(t.y)}px`):(r=document.createElement("div"),r.className=`floatNum ${t.kind}`,r.dataset.fxId=n,r.textContent=t.text,r.style.position="absolute",r.style.left=`${Math.round(t.x)}px`,r.style.top=`${Math.round(t.y)}px`,e.appendChild(r))}}function xa(){if(document.querySelector(".floatingNewRun"))return;const e=document.createElement("button");e.className="floatingNewRun",e.type="button",e.textContent="ÏÉàÎ°úÏö¥ Îü∞",e.style.cssText=`
    position: fixed;
    top: calc(env(safe-area-inset-top, 0px) + 10px);
    left: calc(env(safe-area-inset-left, 0px) + 10px);
    pointer-events: auto;
    z-index: var(--zChrome);

    padding: 10px 12px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,.16);
    background: rgba(0,0,0,.55);
    color: #fff;

    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    cursor: pointer;
    touch-action: manipulation;
  `,e.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),Fn?.()}),document.body.appendChild(e)}function C(e,t){C._uiScaleInitDone||(C._uiScaleInitDone=!0,Q=Un(),Qn()),re=e,yo({getG:()=>re??e,actions:{onNewRun:()=>t.onNewRun()},rerender:()=>C(re??e,t),log:h=>m(re??e,h)}),ve(),Fn=()=>t.onNewRun(),xa(),Go(),C._logInitDone||(C._logInitDone=!0,Ko());const n=document.querySelector(".mainPanel");n&&(un=n.scrollTop,pn=n.scrollLeft);const r=ha();yn||(window.addEventListener("resize",()=>{}),Ha(()=>re??e,t),yn=!0),r.appendChild(_a(e,t));const o=x("mainRow"),a=x("stage"),s=x("stageInner"),i=x("panel mainPanel"),d=!e.run.finished&&e.enemies.length>0&&e.phase!=="NODE";i.classList.toggle("inCombat",d),i.scrollTop=un,i.scrollLeft=pn,i.appendChild($a(e)),e.run.finished?i.appendChild(jt("Îü∞ Ï¢ÖÎ£å")):e.phase==="NODE"?fa(i,e,t):Ia(i,e,t),s.appendChild(i),a.appendChild(s);const l=x("panel logPanel");if(l.classList.toggle("collapsed",me),l.appendChild(Aa(me,()=>{me=!me,qo(),C(e,t)})),l.classList.add("logScroll"),!me){const h=ta(e.log.join(`
`));h.classList.add("log"),l.appendChild(h)}o.appendChild(a),o.appendChild(l),r.appendChild(o),Yt(),Ta(e),Ra(e,t,X(e)),Qt(),Gt(),Sa(),nr(),ga(e,{...t,onCloseOverlay:()=>{M=null,C(re??e,t)}}),wa(e,t),Ca(e,t),va(e,t),Ge(e,t),Do(e),ya(),ba(),ka(e,t),Vo(e),Ho()}function Xt(e,t){const n=j[t]??null,r=Ze(e,t),o=n?.art??n?.icon??null,a=o??null;return{id:t,name:r.name,desc:r.text,state:r.state,icon:a,art:o}}function ka(e,t){document.querySelector(".relicHud")?.remove(),document.querySelector(".relicTooltip")?.remove(),Ge(e,t);const n=(e.run.relics??[]).slice();if(n.length===0)return;const r=document.createElement("div");r.className="relicHud";for(const o of n.slice().reverse()){const a=Xt(e,o),s=document.createElement("div");if(s.className="relicIcon",s.setAttribute("role","button"),s.tabIndex=0,a.icon){const d=document.createElement("div");d.className="relicIconImg",d.style.backgroundImage=`url(${a.icon})`,s.appendChild(d)}else{const d=document.createElement("div");d.textContent=a.name.slice(0,2),d.style.fontWeight="900",d.style.fontSize="12px",d.style.opacity=".95",s.appendChild(d)}const i=(d,l)=>{oe=o,ye={x:d,y:l},bt(e)};s.onpointerenter=d=>i(d.clientX??0,d.clientY??0),s.onpointermove=d=>{oe===o&&(ye={x:d.clientX??0,y:d.clientY??0},bt(e))},s.onpointerleave=()=>{oe===o&&(oe=null,ye=null,document.querySelector(".relicTooltip")?.remove())},s.onclick=d=>{d.preventDefault(),d.stopPropagation(),be=o,oe=null,ye=null,document.querySelector(".relicTooltip")?.remove(),Ge(e,t)},s.onkeydown=d=>{(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),be=o,Ge(e,t))},r.appendChild(s)}document.body.appendChild(r),bt(e)}function bt(e){if(document.querySelector(".relicTooltip")?.remove(),!oe||!ye)return;const t=Xt(e,oe);if(!t.desc&&!t.name)return;const n=document.createElement("div");n.className="relicTooltip";const r=document.createElement("div");if(r.className="relicTooltipTitle",r.textContent=t.name,n.appendChild(r),t.desc){const d=document.createElement("div");d.className="relicTooltipDesc",d.textContent=t.desc,n.appendChild(d)}document.body.appendChild(n);const o=12,a=n.getBoundingClientRect();let s=ye.x-a.width,i=ye.y-a.height-10;s=Math.max(o,Math.min(window.innerWidth-a.width-o,s)),i=Math.max(o,Math.min(window.innerHeight-a.height-o,i)),n.style.left=`${Math.round(s)}px`,n.style.top=`${Math.round(i)}px`}function Ge(e,t){if(document.querySelector(".relicModal")?.remove(),!be)return;const n=Xt(e,be),r=document.createElement("div");r.className="relicModal",r.style.cssText=`
    position: fixed;
    inset: 0;
    z-index: var(--zRelicModal, 70000);
    pointer-events: auto;
    background: rgba(0,0,0,.55);
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 18px;
    box-sizing: border-box;
  `,r.onclick=p=>{p.target===r&&(be=null,C(e,t))};const o=document.createElement("div");o.className="relicModalPanel",o.onclick=p=>p.stopPropagation();const a=document.createElement("div");a.className="relicModalHeader";const s=document.createElement("h3");s.className="relicModalTitle",s.textContent=n.name,s.style.fontFamily='"Î¨ºÎßàÎ£®", serif';const i=document.createElement("button");i.type="button",i.textContent="Îã´Í∏∞",i.className="overlayClose",i.onclick=()=>{be=null,C(e,t)},a.appendChild(s),a.appendChild(i);const d=document.createElement("div");d.className="relicModalBody";const l=document.createElement("div");l.className="relicModalArt";const h=document.createElement("div");h.className="relicModalArtImg",n.art&&(h.style.backgroundImage=`url(${n.art})`),l.appendChild(h);const f=document.createElement("pre");f.className="relicModalDesc",f.textContent=n.desc||"",f.style.fontFamily='"Î¨ºÎßàÎ£®", serif',d.appendChild(l),d.appendChild(f),o.appendChild(a),o.appendChild(d),r.appendChild(o),document.body.appendChild(r)}function Ta(e){const t=document.querySelector(".stageInner");if(!t)return;document.querySelector(".stageCornerHud")?.remove();const n=document.createElement("div");n.className="stageCornerHud",n.textContent=Pa(e),document.body.appendChild(n);const r=t.getBoundingClientRect(),o=-56,a=(r.left+r.right)/2;n.style.right="",n.style.left=`${Math.round(a)}px`,n.style.top=`${Math.round(r.top+o)}px`,n.style.transform="translateX(-50%)"}function Bt(){try{localStorage.setItem(Wn,JSON.stringify(Q))}catch{}}function xt(e){const t=_t(e,.75,1.5);dt()?Q.uiScaleMobile=t:Q.uiScaleDesktop=t,Bt(),Qn()}function Ca(e,t){if(document.querySelector(".logOverlay")?.remove(),!It)return;const n=x("logOverlay");n.style.cssText=`
    position: fixed; inset: 0;
    pointer-events:auto;
    background: rgba(0,0,0,.55);
    backdrop-filter: blur(6px);
    display: flex;
    align-items: flex-end;
    justify-content: center;
  `;const r=x("panel");r.style.cssText=`
    width: min(720px, 100%);
    max-height: 70vh;
    border-radius: 18px 18px 0 0;
    padding: 12px;
    margin: 0;
  `;const o=x("panelHeader"),a=document.createElement("h2");a.textContent="Î°úÍ∑∏",o.appendChild(a);const s=ee("Îã´Í∏∞",()=>t.onToggleLogOverlay());o.appendChild(s),r.appendChild(o);const i=document.createElement("pre");i.className="log",i.textContent=e.log.join(`
`),i.style.maxHeight="60vh",i.style.overflow="auto",r.appendChild(i),n.onclick=()=>t.onToggleLogOverlay(),r.onclick=d=>d.stopPropagation(),n.appendChild(r),document.body.appendChild(n)}function Ea(e,t){const n=x("settingsPanel");n.style.cssText="display:flex; flex-direction:column; gap:12px;";const r=x("settingsRow");r.style.cssText="display:flex; align-items:center; gap:12px; flex-wrap:wrap;";const o=J("","UI Ïä§ÏºÄÏùº");o.style.cssText="font-weight:800;";const a=()=>dt()?Q.uiScaleMobile:Q.uiScaleDesktop,s=J("",`${Math.round(a()*100)}%`);s.style.cssText="opacity:.9; min-width:64px; text-align:right;";const i=document.createElement("input");i.type="range",i.min="0.75",i.max="1.25",i.step="0.01",i.value=String(a()),i.style.cssText="flex:1 1 260px;",i.oninput=()=>{const y=Number(i.value);xt(y),s.textContent=`${Math.round(a()*100)}%`,e()},r.appendChild(o),r.appendChild(i),r.appendChild(s),n.appendChild(r);const d=x("settingsPresets");d.style.cssText="display:flex; gap:8px; flex-wrap:wrap;";const l=(y,T)=>{const b=ee(y,()=>{xt(T),i.value=String(a()),s.textContent=`${Math.round(a()*100)}%`,e()});return b.style.cssText="padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.16);background:rgba(255,255,255,.06); color:#fff; cursor:pointer;",b};d.appendChild(l("ÏûëÍ≤å 90%",.9)),d.appendChild(l("Í∏∞Î≥∏ 100%",1)),d.appendChild(l("ÌÅ¨Í≤å 110%",1.1)),d.appendChild(l("Îçî ÌÅ¨Í≤å 120%",1.2)),n.appendChild(d);const h=x("settingsResetRow");h.style.cssText="display:flex; justify-content:flex-end; margin-top:6px;";const f=ee("Ï¥àÍ∏∞Ìôî",()=>{xt(1),i.value=String(a()),s.textContent=`${Math.round(a()*100)}%`,e()});f.style.cssText="padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.16);background:rgba(255,255,255,.06); color:#fff; cursor:pointer;",h.appendChild(f),n.appendChild(h);const p=x("settingsRow");p.style.cssText="display:flex; align-items:center; gap:12px; flex-wrap:wrap;";const k=J("","Ïä¨Î°Ø Ïπ¥Îìú ÌëúÏãú");k.style.cssText="font-weight:800;";const A=Q.slotCardMode??"FULL",u=ee("Ï†ÑÏ≤¥",()=>{Q.slotCardMode="FULL",Bt(),e()}),c=ee("Ïù¥Î¶ÑÎßå",()=>{Q.slotCardMode="NAME_ONLY",Bt(),e()});return u.style.cssText=`padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.16);
    background:${A==="FULL"?"rgba(255,255,255,.16)":"rgba(255,255,255,.06)"}; color:#fff; cursor:pointer;`,c.style.cssText=`padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.16);
    background:${A==="NAME_ONLY"?"rgba(255,255,255,.16)":"rgba(255,255,255,.06)"}; color:#fff; cursor:pointer;`,p.appendChild(k),p.appendChild(u),p.appendChild(c),n.appendChild(p),n}function Sa(){const e=document.querySelector(".stageInner");if(!e)return;const t=e.getBoundingClientRect(),n=Math.round(t.left),r=Math.round(t.top),o=document.documentElement;o.style.setProperty("--stageLeftPx",`${n}px`),o.style.setProperty("--stageTopPx",`${r}px`),o.style.setProperty("--stageHPx",`${Math.round(t.height)}px`)}function Qn(){const e=document.documentElement,t=dt()?Q.uiScaleMobile:Q.uiScaleDesktop;e.style.setProperty("--uiScale",String(t)),e.style.setProperty("--uiScaleDesktop",String(Q.uiScaleDesktop)),e.style.setProperty("--uiScaleMobile",String(Q.uiScaleMobile))}function ga(e,t){if(document.querySelector(".overlay-layer")?.remove(),!M)return;const n=M.kind==="SETTINGS",r=x("overlay-layer");r.style.cssText=n?"position:fixed; inset:0;background:rgba(0,0,0,1);display:flex; justify-content:center; align-items:flex-start;padding:24px; box-sizing:border-box;":"position:fixed; inset:0;background:rgba(0,0,0,.55);display:flex; justify-content:center; align-items:center;",r.onclick=l=>{l.target===r&&t.onCloseOverlay()};const o=x("overlay-panel");o.style.cssText=n?"width:min(860px, 96vw); max-height:calc(100vh - 48px); overflow:auto;padding:16px; border:1px solid rgba(255,255,255,.12); border-radius:16px;background:rgba(15,18,22,1); box-shadow:0 18px 60px rgba(0,0,0,.45);":"width:min(980px, 92vw); max-height:80vh; overflow:auto; padding:16px;border:1px solid rgba(255,255,255,.12); border-radius:16px;background:rgba(15,18,22,.92); box-shadow:0 18px 60px rgba(0,0,0,.45);",o.onclick=l=>l.stopPropagation();const a=M.kind==="RULEBOOK"?"Î£∞Î∂Å":M.kind==="SETTINGS"?"ÏÑ§Ï†ï":M.pile==="deck"?"Îç±":M.pile==="discard"?"Î≤ÑÎ¶º ÎçîÎØ∏":M.pile==="exhausted"?"ÏÜåÎ™®(Ïù¥Î≤à Ï†ÑÌà¨)":M.pile==="vanished"?"ÏÜåÏã§(ÏòÅÍµ¨)":"ÏÜêÌå®",s=x("overlayHeader");s.style.cssText="display:flex; align-items:center; justify-content:space-between; gap:12px; position:sticky; top:0; padding-bottom:12px; margin-bottom:12px; background:rgba(15,18,22,.92);";const i=ea(a);i.classList.add("overlayTitle");const d=Nt("Îã´Í∏∞",t.onCloseOverlay,!1);if(d.classList.add("overlayClose"),d.style.cssText="padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.16); background:rgba(255,255,255,.06); color:#fff; cursor:pointer;",s.appendChild(i),s.appendChild(d),o.appendChild(s),M.kind==="RULEBOOK"){const l=document.createElement("pre");l.className="rulebook",l.textContent=Io,l.style.cssText="white-space:pre-wrap; line-height:1.45; font-size:13px; margin:0; padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.10); background:rgba(0,0,0,.18);",o.appendChild(l)}else if(M.kind==="SETTINGS")o.appendChild(Ea(()=>{re&&(Yt(),Qt(),Gt()),C(re??e,t)}));else{const h=[...M.pile==="deck"?e.deck:M.pile==="discard"?e.discard:M.pile==="exhausted"?e.exhausted:M.pile==="vanished"?e.vanished:e.hand].sort((b,E)=>{const w=e.cards[b],v=e.cards[E],_=ot(e,w.defId),g=ot(e,v.defId),B=_.localeCompare(g,"ko");return B!==0?B:(w.upgrade??0)-(v.upgrade??0)}),f=x("pileView");f.style.cssText="display:grid;grid-template-columns: 1fr 320px;gap:16px;align-items:start;";const p=x("pileGrid");p.style.cssText="display:grid;grid-template-columns: repeat(auto-fill, minmax(var(--handCardW), 1fr));gap:10px;align-content:start;min-width:0;max-height: 62vh;overflow-y: auto;overflow-x: hidden;";const k=x("pileSide");k.style.cssText="position:sticky; top:72px;align-self:start;border:1px solid rgba(255,255,255,.10);border-radius:14px;padding:12px;background:rgba(0,0,0,.22);";const A=x("pileSideTitle");A.style.cssText="font-weight:800; margin:0 0 10px 0; opacity:.95;",k.appendChild(A);const u=x("pilePreviewBox");u.style.cssText="display:flex; justify-content:center; align-items:flex-start;padding:8px 0 10px 0;",k.appendChild(u);const c=document.createElement("pre");c.className="pileSideDetail",c.style.cssText="margin:0;padding:10px;white-space:pre-wrap;border-radius:12px;border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.20);font-size:12px;line-height:1.45;",k.appendChild(c);let y=h[0]??null;const T=()=>{if(u.innerHTML="",!y){A.textContent="ÏÑ†ÌÉùÎêú Ïπ¥Îìú ÏóÜÏùå",c.textContent="";return}const b=rt(e,y),E=Vn(e,y);A.textContent=E;const w=st(e,y);u.appendChild(w),c.textContent=`Ï†ÑÏó¥: ${b.frontText}
ÌõÑÏó¥: ${b.backText}`};if(h.length===0){const b=x("overlayEmpty");b.textContent="ÎπÑÏñ¥ ÏûàÏùå",b.style.cssText="padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.10); background:rgba(255,255,255,.03);",p.appendChild(b)}else for(const b of h){const E=st(e,b,v=>{y=v,T()});E.style.width="var(--handCardW)",E.style.height="var(--handCardH)",E.style.boxSizing="border-box",E.style.cursor="pointer";const w=()=>{y=b,p.querySelectorAll(".pileSelected").forEach(v=>v.classList.remove("pileSelected")),E.classList.add("pileSelected"),T()};E.onclick=w,E.onmouseenter=w,p.appendChild(E)}if(f.appendChild(p),f.appendChild(k),o.appendChild(f),y){const b=p.firstElementChild;b&&b.classList.add("pileSelected")}T()}r.appendChild(o),document.body.appendChild(r)}function Be(e,t){const n=document.createElement(e);return t&&(n.className=t),n}function va(e,t){const n=document.getElementById("relicTray");n&&n.remove();const r=e.run.relics??[];if(r.length===0)return;const o=Be("div","relicTray");o.id="relicTray";const a=Be("div","relicHoverTip");o.appendChild(a);const s=Be("div","relicTrayList");o.appendChild(s);const i=()=>{const d=oe;if(!d){a.style.display="none",a.textContent="";return}if(!j[d]){a.style.display="none",a.textContent="";return}const h=Ze(e,d);a.style.display="block",a.innerHTML="";const f=Be("div","relicTipTitle");f.textContent=h.name;const p=Be("div","relicTipBody");p.textContent=h.text,a.appendChild(f),a.appendChild(p)};for(const d of r){const l=j[d];if(!l)continue;const h=Ze(e,d),f=document.createElement("button");if(f.type="button",f.className="relicIcon",l.art){const p=document.createElement("img");p.src=l.art,p.className="relicIconImg",p.alt=h.name,f.appendChild(p)}else f.textContent=h.name.slice(0,1);f.onmouseenter=()=>{oe=d,i()},f.onmouseleave=()=>{oe=null,i()},f.onclick=()=>{be=d,C(e,t)},s.appendChild(f)}i(),document.body.appendChild(o)}function wa(e,t){document.querySelector(".choice-overlay")?.remove();const n=e.choice,r=document.querySelector(".mainPanel");if(!n){r?.classList.remove("choiceOpen");return}if(!r)return;r.classList.add("choiceOpen");const o=R(70),a=R(20)+o,s=R(36),i=R(16),d=R(16),l=R(18),h=R(10),f=R(260),p=R(200),k=R(14),A=R(12),u=R(10),c=R(12),y=R(12),T=R(220),b=R(22),E=R(14),w=x("choice-overlay");w.style.cssText="position:fixed; inset:0; z-index: var(--zChoice);display:flex; justify-content:center; align-items:flex-start;pointer-events:auto;";const v=x("choice-backdrop");v.style.cssText="position:absolute; inset:0;background: rgba(0,0,0,.72);backdrop-filter: blur(4px);-webkit-backdrop-filter: blur(4px);pointer-events:auto;",v.onclick=()=>{};const _=x("choice-padWrap");_.style.cssText=`position:relative; width:100%;padding:${a}px ${s}px ${i}px ${d}px;box-sizing:border-box;display:flex; justify-content:center; align-items:flex-start;pointer-events:auto;`;const g=x("choice-panel");g.style.cssText="position:relative;pointer-events:auto;",g.onclick=$=>$.stopPropagation();const B=Zo(n.title);if(B.style.cssText=`margin:0 0 ${R(8)}px 0; font-size:${b}px; font-weight:900;text-align:left;`,g.appendChild(B),n.prompt){const $=jt(n.prompt);$.style.cssText=`margin:0 0 ${R(12)}px 0; font-size:${E}px; line-height:1.25; opacity:.95;`,g.appendChild($)}const O=$=>{$.style.width="var(--handCardW)",$.style.height="var(--handCardH)",$.style.boxSizing="border-box"},D=$=>{const P=document.createElement("pre");return P.className="choice-detail",P.textContent=String($),P.style.cssText=`margin:${R(10)}px 0 0 0; padding:${u}px;white-space:pre-wrap;border-radius:${c}px; border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.22);font-size:${y}px; line-height:1.45;max-height:${T}px; overflow:auto;`,P},L=()=>{const $=x("choice-item");return $.style.cssText=`display:flex;gap:${R(12)}px;align-items:flex-start;border:1px solid rgba(255,255,255,.10); border-radius:${k}px;padding:${A}px;background:rgba(255,255,255,.03);`,$};if(n.options.some($=>$.cardUid?!0:typeof $.key=="string"&&$.key.startsWith("pick:"))){const $=x("choice-list");$.style.cssText=`display:flex; flex-direction:column;gap:${h}px; margin-top:${R(12)}px;`,n.options.forEach(P=>{const W=L(),z=x("choice-left");z.style.cssText="flex:0 0 auto;";const I=P.cardUid;if(I){const K=e.choice?.kind==="UPGRADE_PICK",q=(e.cards[I].upgrade??0)+1;let U;try{U=K?ua(e,I,q):st(e,I)}catch{U=st(e,I)}O(U),z.appendChild(U)}else if(typeof P.key=="string"&&P.key.startsWith("pick:")){const K=P.key.slice(5),[H,q]=K.split(":"),U=Number(q??"0")||0,pe=Xn(e,H,U);O(pe),z.appendChild(pe)}const V=x("choice-right");V.style.cssText=`flex:1 1 auto; min-width:${R(260)}px;`;const N=Nt(P.label,()=>t.onChooseChoice(P.key),!1);N.classList.add("primary"),N.style.fontSize=`${R(14)}px`,N.style.padding=`${R(10)}px ${R(12)}px`,N.style.borderRadius=`${R(10)}px`,V.appendChild(N),P.detail&&V.appendChild(D(P.detail)),W.appendChild(z),W.appendChild(V),$.appendChild(W)}),g.appendChild($)}else{const $=x("choice-contentRow");$.style.cssText=`display:flex;gap:${l}px; margin-top:${R(12)}px;justify-content:center; align-items:stretch;`;const P=x("choice-leftCol");P.style.cssText=`flex:1 1 ${R(640)}px; max-width:${R(720)}px; min-width:0;display:flex; flex-direction:column;`;const W=x("choice-list");W.style.cssText=`display:flex; flex-direction:column; gap:${h}px;`,n.options.forEach(N=>{const K=L(),H=Nt(N.label,()=>t.onChooseChoice(N.key),!1);H.classList.add("choiceOptBtn"),H.style.fontSize=`${R(14)}px`,H.style.padding=`${R(10)}px ${R(12)}px`,H.style.borderRadius=`${R(10)}px`,K.appendChild(H),N.detail&&K.appendChild(D(N.detail)),W.appendChild(K)}),P.appendChild(W);const z=x("choice-illuCol");z.style.cssText=`flex:0 0 ${f}px; min-width:${p}px;display:flex; align-items:center; justify-content:center;`;const I=x("choice-illuBox");I.style.cssText=`width:100%; aspect-ratio:1/1;border-radius:${R(18)}px; border:1px solid rgba(255,255,255,.16);background:rgba(0,0,0,.35);position:relative; overflow:hidden;box-shadow: 0 10px 30px rgba(0,0,0,.35);`;const V=n.art;if(V){const N=document.createElement("img");N.src=V,N.alt=n.title??"illustration";const K=1.5;N.style.imageRendering="pixelated",N.style.cssText=`position:absolute; inset:0;width:${K*100}%; height:${K*100}%;left:${-.5*50}%; top:${-.5*50}%;object-fit:cover; object-position:50% 50%;image-rendering: pixelated; image-rendering: crisp-edges;`,I.appendChild(N)}z.appendChild(I),$.appendChild(P),$.appendChild(z),g.appendChild($)}_.appendChild(g),w.appendChild(v),w.appendChild(_),document.body.appendChild(w)}function _a(e,t){document.querySelectorAll(".topHud").forEach(T=>T.remove()),document.querySelectorAll(".enemyHudCenter").forEach(T=>T.remove());const n=x("topHud");n.appendChild(x("topHudLeftSpacer"));const r=x("playerHudLeft"),o=x("playerTitleRow");o.appendChild(J("playerHudTitle","ÌîåÎ†àÏù¥Ïñ¥"));const a=x("pileButtons");a.appendChild(ee("Îç±",()=>t.onViewPile("deck"))),a.appendChild(ee("Î≤ÑÎ¶º",()=>t.onViewPile("discard"))),a.appendChild(ee("ÏÜêÌå®",()=>t.onViewPile("hand"))),a.appendChild(ee("ÏÜåÎ™®",()=>t.onViewPile("exhausted"))),a.appendChild(ee("ÏÜåÏã§",()=>t.onViewPile("vanished"))),o.appendChild(a),r.appendChild(o);const s=x("enemyChip");s.classList.add("playerHudBox");const i=x("enemyChipTop");i.appendChild(J("","HP")),i.appendChild(J("",`${e.player.hp}/${e.player.maxHp}`)),s.appendChild(i);const d=x("enemyHPOuter"),l=x("enemyHPFill");l.style.width=`${Math.max(0,Math.min(100,e.player.hp/Math.max(1,e.player.maxHp)*100))}%`,d.appendChild(l),s.appendChild(d);const h=x("enemyChipTop");h.appendChild(J("","Î∏îÎ°ù")),h.appendChild(J("",`${e.player.block}`)),s.appendChild(h);const f=x("enemyHPOuter"),p=x("enemyHPFill");p.style.background="linear-gradient(90deg, #64b5ff, #2a7cff)",p.style.width=`${Math.max(0,Math.min(100,e.player.block/Math.max(1,e.player.maxHp)*100))}%`,f.appendChild(p),s.appendChild(f);const k=e.player.status,A=x("enemyBadges");s.appendChild(A);const u=[];(k.vuln??0)>0&&u.push(`Ï∑®ÏïΩ ${k.vuln}`),(k.weak??0)>0&&u.push(`ÏïΩÌôî ${k.weak}`),(k.bleed??0)>0&&u.push(`Ï∂úÌòà ${k.bleed}`),(k.disrupt??0)>0&&u.push(`ÍµêÎûÄ ${k.disrupt}`);for(const T of u)A.appendChild(At(T));if(r.appendChild(s),!e.run.finished&&e.enemies.length>0&&e.phase!=="NODE"){const T=x("enemyHudCenter"),b=x("enemyHudCenterMover"),E=x("enemyHud");E.style.cssText=`
      display: flex;
      flex-direction: row;
      flex-wrap: nowrap;
      justify-content: center;
      align-items: stretch;
      gap: 14px;
      overflow: visible;
      white-space: nowrap;
    `,T.style.overflow="visible",b.style.overflow="visible",b.style.width="max-content";const w=X(e);b.appendChild(E),T.appendChild(b),document.body.appendChild(T);for(let v=0;v<e.enemies.length;v++){const _=e.enemies[v],g=x("enemyBanner enemyCardWrap");w&&_.hp>0&&g.classList.add("targetable"),g.onclick=()=>t.onSelectEnemy(v);const B=x("enemyArtWrap"),O=x("enemyArtCard");B.style.setProperty("--frameImg",'url("assets/enemies/enemies_frame.png")'),B.style.setProperty("--artImg",`url("${ia(_.id)}")`),B.appendChild(O);const D=x("enemyMiniHud"),L=e.content.enemiesById[_.id],F=L.intents[_.intentIndex%L.intents.length],$=_.intentLabelOverride??F.label,P=e.intentsRevealedThisTurn?No(e,_,F,{includeBlock:!1}):null,W=x("enemyIntentTopRow");let z="Ôºü",I="";e.intentsRevealedThisTurn&&P?(z=ca(P),I=la(e,_,P)??""):(z="Ôºü",I=""),W.appendChild(J("enemyIntentIcon",z)),W.appendChild(J("enemyIntentDmg",I)),D.appendChild(W);const V=x("enemyHpLine");V.appendChild(J("enemyHpText",`HP ${_.hp}/${_.maxHp}`));const N=x("enemyHPOuter"),K=x("enemyHPFill");K.style.width=`${Math.max(0,Math.min(100,_.hp/Math.max(1,_.maxHp)*100))}%`,N.appendChild(K),V.appendChild(N),D.appendChild(V),D.appendChild(da(_.status,_.immuneThisTurn));const H=x("enemyHoverDetail"),q=_.status,U=[];(q.vuln??0)>0&&U.push(`Ï∑®ÏïΩ ${q.vuln}`),(q.weak??0)>0&&U.push(`ÏïΩÌôî ${q.weak}`),(q.bleed??0)>0&&U.push(`Ï∂úÌòà ${q.bleed}`),(q.disrupt??0)>0&&U.push(`ÍµêÎûÄ ${q.disrupt}`),_.immuneThisTurn&&U.push("Î©¥Ïó≠"),H.textContent=e.enemies[v].name+`
 
`+(e.intentsRevealedThisTurn?`${$}
 
`:"")+(U.length?`ÏÉÅÌÉú: ${U.join(", ")}`:"ÏÉÅÌÉú: ÏóÜÏùå"),g.appendChild(B),g.appendChild(D),g.appendChild(H),E.appendChild(g)}}n.appendChild(r);const y=x("topHudRight");return y.appendChild(ee("Î£∞Î∂Å",()=>t.onViewRulebook())),y.appendChild(ee("Î°úÍ∑∏",()=>t.onToggleLogOverlay())),y.appendChild(ee("ÏÑ§Ï†ï",()=>{M={kind:"SETTINGS"},C(e,t)})),n.appendChild(y),n}function Pa(e){const t=e.enemies.length>0&&e.phase!=="NODE",n=e.run.nextBattleSuppliesBonus??0,r=[];return t?r.push(`üåæ S ${e.player.supplies} |`):n>0&&r.push(`Î≥¥ÎÑàÏä§ üåæ S +${n} |`),r.push(`üí§ F ${e.player.fatigue}`),r.push(`| ‚è≥ ÏãúÍ∞Ñ ${Math.max(0,(e.run.nodePickCount??0)+(e.time??0))}`),r.push(`| üÉè Îç± ${e.deck.length}`),r.join(" ")}function kt(e,t=""){const n=document.createElement("span");return n.className="chip"+(t?` ${t}`:""),n.textContent=e,n}function $a(e){const t=x("battleTitleRow");t.style.display="flex",t.style.alignItems="center",t.style.gap="12px";const n=document.createElement("h2");n.textContent="",t.appendChild(n);const r=Na(e),o=J("targetHintInline","");o.style.cssText="padding:5px 10px; border-radius:12px; border:1px solid rgba(0,0,0,.55);background: rgb(255, 0, 0);opacity:.9;font-weight:400; font-size:12px; line-height:1.2;white-space:nowrap; overflow:hidden; text-overflow:ellipsis;width: min(240px, 92vw);max-width: none;pointer-events:auto;",r?(o.textContent=r,o.style.visibility="visible",o.style.pointerEvents="auto"):(o.textContent="ÎåÄÏÉÅ ÏÑ†ÌÉù ÌïÑÏöî",o.style.visibility="hidden",o.style.pointerEvents="none");const a=x("battleTitleRight");a.style.cssText="margin-left:auto;display:flex; align-items:center; gap:10px;flex: 0 0 auto;white-space:nowrap;position:relative;";const s=x("resourceRow inline");return s.appendChild(kt("")),s.appendChild(kt("")),s.appendChild(kt("")),a.appendChild(s),o.style.position="absolute",o.style.right="207px",o.style.top="calc(100% - 8px)",o.style.marginTop="0px",o.style.zIndex="5",o.style.pointerEvents=r?"auto":"none",t.appendChild(o),t.appendChild(a),t}function Aa(e,t){const n=x("logHeaderRow");n.tabIndex=0;const r=document.createElement("h2");r.textContent="Î°úÍ∑∏";const o=document.createElement("span");return o.className="chev",o.textContent=e?"‚ñ∏":"‚ñæ",n.appendChild(r),n.appendChild(o),n.onclick=()=>t(),n.onkeydown=a=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),t())},n}function Na(e){if(!X(e)||e.selectedEnemyIndex!=null)return null;const t=e.pendingTarget??null,n=t?.sourceCardUid?te(e,t.sourceCardUid):null,r=t?.sourceLabel??null,o=t?.reason??null,a=n?`ÎåÄÏÉÅ ÏÑ†ÌÉù (${n})`:r?`ÎåÄÏÉÅ ÏÑ†ÌÉù (${r})`:"ÎåÄÏÉÅ ÏÑ†ÌÉù ÌïÑÏöî",s=o==="FRONT"?"Ï†ÑÏó¥":o==="BACK"?"ÌõÑÏó¥":o==="EVENT"?"Ïù¥Î≤§Ìä∏":o==="RELIC"?"Ïú†Î¨º":null,i=s?` ‚Äî ${s}`:"",d=e.pendingTargetQueue?.length??0,l=(e.pendingTarget?1:0)+d,h=l>1?` (ÎÇ®ÏùÄ ${l}Í∞ú)`:" (ÎÇ®ÏùÄ 1Í∞ú)";return`${a}${i}${h}`}function Ia(e,t,n){const r=x("combatRoot"),o=x("boardArea"),a=!t.run.finished&&t.enemies.length>0&&t.phase!=="NODE";o.classList.toggle("slabOn",a);const s=x("boardSlotsWrap");s.style.paddingTop=`${R(6)}px`,s.appendChild(kn(t,n,"front")),s.appendChild(kn(t,n,"back")),o.appendChild(s),r.appendChild(o),e.appendChild(r)}let Ot=null,Jn=!0;function xn(e,t){Ot=e,Jn=t}function Zn(e,t,n){return e.run.finished?{label:"Ï¢ÖÎ£å",fn:null,disabled:!0,activePhase:e.phase}:e.choice||M?{label:"ÏÑ†ÌÉù Ï§ë",fn:null,disabled:!0,activePhase:e.phase}:n?{label:"ÎåÄÏÉÅ ÏÑ†ÌÉù",fn:null,disabled:!0,activePhase:e.phase}:e.phase==="NODE"?{label:"ÎÖ∏Îìú ÏÑ†ÌÉù",fn:null,disabled:!0,activePhase:e.phase}:e.phase==="PLACE"?e.enemies.length>0&&!e.intentsRevealedThisTurn?{label:"Îã§Ïùå: Ï†ïÏ∞∞",fn:t.onRevealIntents,disabled:!1,activePhase:e.phase}:{label:"Îã§Ïùå: ÌõÑÏó¥",fn:t.onResolveBack,disabled:!1,activePhase:e.phase}:e.phase==="BACK"?{label:"Îã§Ïùå: ÌõÑÏó¥",fn:t.onResolveBack,disabled:!1,activePhase:e.phase}:e.phase==="FRONT"?{label:"Îã§Ïùå: Ï†ÑÏó¥",fn:t.onResolveFront,disabled:!1,activePhase:e.phase}:e.phase==="ENEMY"?{label:"Îã§Ïùå: Ï†Å",fn:t.onResolveEnemy,disabled:!1,activePhase:e.phase}:e.phase==="UPKEEP"?{label:"Îã§Ïùå: Ï†ïÎ¶¨",fn:t.onUpkeep,disabled:!1,activePhase:e.phase}:e.phase==="DRAW"?{label:"Îã§Ïùå ÌÑ¥",fn:t.onDrawNextTurn,disabled:!1,activePhase:e.phase}:{label:"Îã§Ïùå",fn:null,disabled:!0,activePhase:e.phase}}function Ra(e,t,n){const r=document.querySelector(".handDock");r&&r.remove();const o=!e.run.finished&&e.enemies.length>0&&e.phase!=="NODE";document.querySelector(".combatControls")?.remove();const a=x("handDock"),s=Zn(e,t,n);if(o){const l=x("combatControls"),h=document.createElement("button");h.textContent="Îã§Ïùå ÌÑ¥",h.className="stepBtn primary",h.disabled=s.disabled||e.phase==="NODE",h.onclick=()=>t.onAutoAdvance();const f=document.createElement("button");f.textContent="ÏÑ†ÌÉù Ìï¥Ï†ú",f.className="clearBtn primary",f.disabled=!e.selectedHandCardUid,f.onclick=t.onClearSelected,l.appendChild(h),l.appendChild(f),document.body.appendChild(l);const p=document.querySelector('.slot[data-slot-side="front"][data-slot-index="1"]')??document.querySelector(".stageInner");if(p){const k=p.getBoundingClientRect(),A=k.left+k.width/2;l.style.left=`${Math.round(A)}px`}xn(()=>t.onAutoAdvance(),h.disabled)}else xn(null,!0);const i=x("hand");i.dataset.dropHand="1";const d=x("handCardsRow");if(i.appendChild(d),e.hand.length===0){const l=x("handEmptyHint");l.textContent="",d.appendChild(l)}else for(const l of e.hand)d.appendChild(ze(e,l,!0,t.onSelectHandCard,{draggable:!0}));a.appendChild(i),document.body.appendChild(a),Ba(i)}function Ba(e){e.dataset?.wheelX!=="1"&&(e.dataset.wheelX="1",e.addEventListener("wheel",t=>{if(t.shiftKey)return;const n=Math.abs(t.deltaX)>Math.abs(t.deltaY)?t.deltaX:t.deltaY;e.scrollLeft+=n,t.preventDefault()},{passive:!1}))}function Gt(){const e=document.querySelector(".enemyHudCenter");if(!e)return;const t=e.querySelector(".enemyHudCenterMover")??e,n=e.querySelector(".enemyHud")??e.querySelector(".enemyStrip")??t;e.style.position="fixed";const r=document.querySelector(".topHud"),s=r?Math.round(r.getBoundingClientRect().bottom+10):8;e.style.top=`${s}px`,e.style.top="8px",e.style.left="50%",e.style.right="auto",e.style.transform="translateX(-50%)",e.style.overflow="visible",t.style.transform="",t.style.overflow="visible";const i=Array.from(e.querySelectorAll(".enemyBanner")),d=i.length;if(d===0){e.style.width="";return}const l=14,h=Math.ceil(i[0].getBoundingClientRect().width)||460,f=Math.max(320,Math.floor(window.innerWidth-16)),p=Math.min(f,h),k=Math.min(f,h*2+l),A=Math.min(f,h*3+l*2);n.style.display="flex",n.style.flexWrap="nowrap",n.style.justifyContent="center",n.style.alignItems="stretch",n.style.gap=`${l}px`,e.style.width=`${d===1?p:d===2?k:A}px`,t.style.width="100%"}function Qt(e){const t=document.querySelector(".hand"),n=document.querySelector(".handCardsRow");if(!t||!n)return;const r=document.querySelector('.slot[data-slot-side="front"][data-slot-index="1"]'),o=document.querySelector(".stageInner"),a=r?.getBoundingClientRect()??o?.getBoundingClientRect();if(!a)return;const s=a.left+a.width/2,i=Array.from(n.querySelectorAll(".card"));if(i.length===0)return;const d=i[0].getBoundingClientRect(),l=i[i.length-1].getBoundingClientRect(),h=d.left,f=l.right,p=(h+f)/2,k=s-p,A=n.scrollWidth,u=t.clientWidth;if(A<=u+1){n.style.transform=`translateX(${Math.round(k)}px)`,t.scrollLeft=0;return}let c=t.scrollLeft-k;const y=Math.max(0,A-u);c<0&&(c=0),c>y&&(c=y),t.scrollLeft=Math.round(c),n.style.transform=""}function er(e,t){const n=getComputedStyle(document.documentElement),r=parseFloat(n.getPropertyValue("--handCardW"))||240,o=parseFloat(n.getPropertyValue("--handCardH"))||336,a=e.getBoundingClientRect();if(a.width<=0||a.height<=0)return;const s=6,i=Math.max(1,a.width-s*2),d=Math.max(1,a.height-s*2);let l=Math.min(i/r,d/o);l=Math.max(.8,Math.min(1,l)),t.style.setProperty("--slotCardScale",String(l))}function kn(e,t,n){const r=x("grid6"),o=!!e.selectedHandCardUid,a=n==="front"?e.frontSlots:e.backSlots;for(let s=0;s<3;s++){const i=n==="back"?!!e.backSlotDisabled?.[s]:!1,d=x("slot"+(i?" disabled":""));d.dataset.slotSide=n,d.dataset.slotIndex=String(s),ae&&ae.side===n&&ae.idx===s&&d.classList.add("dropHover"),o&&!i&&d.classList.add("placeable");const l=a[s];if(l){const h=Q.slotCardMode==="NAME_ONLY"?"SLOT_NAME_ONLY":"FULL",f=ze(e,l,!1,void 0,{draggable:!1,mode:h,hoverPreview:{root:document.body,api:Kn,buildDetail:(k,A)=>{const u=rt(k,A);return`Ï†ÑÏó¥: ${u.frontText}
ÌõÑÏó¥: ${u.backText}`}}});f.classList.add("inSlot");const p=document.createElement("div");p.className="slotCardScaler",p.appendChild(f),d.appendChild(p),f.onpointerdown=k=>{k.button!==0&&k.pointerType==="mouse"||X(e)||e.phase==="PLACE"&&tr(k,{kind:"slot",cardUid:l,fromSide:n,fromIdx:s})},f.ondblclick=()=>t.onReturnSlotToHand(n,s),requestAnimationFrame(()=>er(d,p))}r.appendChild(d)}return r}function Oa(){if(document.querySelectorAll(".slot.dropHover").forEach(n=>n.classList.remove("dropHover")),!ae)return;const e=`.slot[data-slot-side="${ae.side}"][data-slot-index="${ae.idx}"]`,t=document.querySelector(e);t&&t.classList.add("dropHover")}let Tn=!1;function Ha(e,t){Tn||(Tn=!0,window.addEventListener("pointermove",n=>{const r=e();if(r.choice||M||!S||n.pointerId!==S.pointerId)return;S.x=n.clientX,S.y=n.clientY;const o=S.x-S.startX,a=S.y-S.startY,s=S.dragging;!S.dragging&&o*o+a*a>36&&(S.dragging=!0),!s&&S.dragging&&(Vt(250),qt()),ae=S.dragging?Cn(n.clientX,n.clientY,r):null,nr(document.querySelector("#app")),Oa()},{passive:!0}),window.addEventListener("pointerup",n=>{const r=e();if(!(r.choice||M)&&!(!S||n.pointerId!==S.pointerId)){if(S.dragging){const o=La(n.clientX,n.clientY),a=Cn(n.clientX,n.clientY,r);if(o&&S.kind==="slot"&&S.fromSide!=null&&S.fromIdx!=null){!r.run.finished&&!X(r)&&r.phase==="PLACE"&&t.onReturnSlotToHand(S.fromSide,S.fromIdx),S=null,ae=null,C(r,t);return}if(a)if(S.kind==="hand"){const s=e();if(!(s.run.finished||X(s)||s.phase!=="PLACE")){const i=a.side,d=a.idx;if(!(i==="back"&&s.backSlotDisabled?.[d])){const l=i==="front"?s.frontSlots:s.backSlots,h=l[d];if(!h)t.onPlaceHandUidToSlot(S.cardUid,i,d);else{const f=S.fromHandIndex!=null&&S.fromHandIndex>=0?S.fromHandIndex:s.hand.indexOf(S.cardUid),p=s.hand.indexOf(S.cardUid);p>=0&&s.hand.splice(p,1),l[d]=S.cardUid,s.cards[S.cardUid].zone=i;const k=f!=null&&f>=0&&f<=s.hand.length?f:s.hand.length;s.hand.splice(k,0,h),s.cards[h].zone="hand",s.selectedHandCardUid=null,Rt(s),m(s,`[${te(s,S.cardUid)}] ‚Üî [${te(s,h)}] Ïä§Ïôë: ÏÜêÌå® ‚Üî ${i}${d+1}`),C(s,t)}}}}else S.kind==="slot"&&S.fromSide!=null&&S.fromIdx!=null&&(S.fromSide===a.side&&S.fromIdx===a.idx||t.onMoveSlotCard(S.fromSide,S.fromIdx,a.side,a.idx))}S?.sourceEl&&S.sourceEl.classList.remove("isDraggingSource"),S=null,ae=null,C(r,t)}}),window.addEventListener("keydown",n=>{const r=n.target;if(r&&(r.tagName==="INPUT"||r.tagName==="TEXTAREA"))return;const o=e();if(!bo()){if(n.ctrlKey&&n.shiftKey&&n.code==="KeyK"){n.preventDefault(),xo();return}if(n.code==="KeyP"){n.preventDefault(),t.onNewRun();return}if(n.code==="Digit4"){if(n.preventDefault(),X(o)){o.pendingTarget=null,o.pendingTargetQueue=[],o.selectedEnemyIndex=null,m(o,"ÎåÄÏÉÅ ÏÑ†ÌÉù Ï∑®ÏÜå"),C(o,t);return}t.onClearSelected();return}if(n.key==="Tab"){if(n.preventDefault(),o.hand.length===0)return;const a=o.selectedHandCardUid,s=a?o.hand.indexOf(a):-1,i=n.shiftKey?-1:1,d=((s+i)%o.hand.length+o.hand.length)%o.hand.length;o.selectedHandCardUid=o.hand[d],C(o,t);return}if(n.code==="Space"){n.preventDefault();const a=e();if(a.run.finished||a.choice||X(a))return;t.onAutoAdvance();return}if(n.code==="Digit1"||n.code==="Digit2"||n.code==="Digit3"){n.preventDefault();const a=n.code==="Digit1"?0:n.code==="Digit2"?1:2;if(X(o)){const s=o.enemies[a];if(!s||s.hp<=0){m(o,`ÎåÄÏÉÅ ÏÑ†ÌÉù Ïã§Ìå®: ${a+1}Î≤à Ï†ÅÏù¥ ÏóÜÏäµÎãàÎã§.`),C(o,t);return}t.onSelectEnemy(a);return}t.onHotkeySlot("front",a);return}if(n.code==="KeyQ"||n.code==="KeyW"||n.code==="KeyE"){n.preventDefault();const a=n.code==="KeyQ"?0:n.code==="KeyW"?1:2;t.onHotkeySlot("back",a);return}if(n.code==="Enter"){n.preventDefault(),!Jn&&Ot&&Ot();return}}}))}function tr(e,t){Vt(250),qt();const n=e.currentTarget;try{n.setPointerCapture(e.pointerId)}catch{}const r=n.closest(".card");r&&r.classList.add("isDraggingSource");const o=r?.getBoundingClientRect(),a=o?e.clientX-o.left:20,s=o?e.clientY-o.top:20,i=getComputedStyle(document.documentElement),d=parseFloat(i.getPropertyValue("--handCardW"))||void 0,l=parseFloat(i.getPropertyValue("--handCardH"))||void 0;if(S={kind:t.kind,cardUid:t.cardUid,fromHandIndex:t.fromHandIndex,fromSide:t.fromSide,fromIdx:t.fromIdx,pointerId:e.pointerId,startX:e.clientX,startY:e.clientY,x:e.clientX,y:e.clientY,dragging:!1,previewEl:void 0,previewW:o?.width??d,previewH:o?.height??l,grabDX:a,grabDY:s},r){S.sourceEl=r;const h=r.cloneNode(!0);h.classList.remove("inSlot"),h.classList.remove("selected"),h.classList.remove("isDraggingSource"),h.style.position="static",h.style.inset="",h.style.width="100%",h.style.height="100%",h.style.margin="0",h.style.boxSizing="border-box",h.style.opacity="1",h.style.filter="none",h.style.transform="none",h.style.backgroundColor="transparent",S.previewEl=h}}function La(e,t){const n=document.elementFromPoint(e,t);if(!n)return!1;let r=n;for(;r;){if(r.dataset?.dropHand==="1")return!0;r=r.parentElement}return!1}function Cn(e,t,n){const r=document.elementFromPoint(e,t);if(!r)return null;const o=Ma(r,["slotSide","slotIndex"]);if(!o)return null;const a=o.dataset.slotSide,s=Number(o.dataset.slotIndex);return a==="back"&&n.backSlotDisabled?.[s]?null:{side:a,idx:s}}function Ma(e,t){let n=e;for(;n;){const r=n.dataset;let o=!0;for(const a of t)if(r[a]==null){o=!1;break}if(o)return n;n=n.parentElement}return null}function nr(e,t){if(!S||!S.dragging){document.querySelector(".dragLayer")?.remove();return}let n=document.querySelector(".dragLayer");if(n||(n=document.createElement("div"),n.className="dragLayer",n.style.position="fixed",n.style.inset="0",n.style.zIndex="21000",n.style.pointerEvents="none",document.body.appendChild(n)),n.innerHTML="",!S.previewEl)return;const r=document.createElement("div");r.className="dragCardPreview",r.style.position="fixed",r.style.left=`${Math.round(S.x-(S.grabDX??20))}px`,r.style.top=`${Math.round(S.y-(S.grabDY??20))}px`;const o=S.previewW??0,a=S.previewH??0;o>0&&(r.style.width=`${Math.round(o)}px`),a>0&&(r.style.height=`${Math.round(a)}px`),r.style.transform="none",r.style.opacity="1",r.style.filter="none",r.style.boxShadow="0 16px 44px rgba(0,0,0,.65)",r.style.backdropFilter="none",r.style.isolation="isolate",r.style.mixBlendMode="normal",r.style.overflow="hidden",r.style.borderRadius="16px",r.style.background="transparent",r.style.clipPath="inset(0 round 16px)",r.appendChild(S.previewEl),n.appendChild(r)}or();ar();const Da=fo();let Le=Xo(Da);function rr(e){Le=e,Ht=Gn(Le,rr),C(Le,Ht)}let Ht=Gn(Le,rr);C(Le,Ht);document.documentElement.style.setProperty("--base","/deck-rogue-prototype/");const Jt="/deck-rogue-prototype/";document.documentElement.style.setProperty("--bgUrl",`url(${Jt}ui/background/dungeon_bg.png)`);document.documentElement.style.setProperty("--boardUrl",`url(${Jt}ui/boards/battle_board.png)`);document.documentElement.style.setProperty("--cardUrl",`url(${Jt}ui/cards/card_parchment.png)`);
