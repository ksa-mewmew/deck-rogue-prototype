(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();function Br(){const e=document.documentElement,t=180,n=5,r=7,o=3;let s=0;const a=()=>{s=0;const d=getComputedStyle(e),c=window.innerWidth,m=window.innerHeight,u=parseFloat(d.getPropertyValue("--hudH"))||140,l=parseFloat(d.getPropertyValue("--dockH"))||210,x=parseFloat(d.getPropertyValue("--uiGap"))||16,w=parseFloat(d.getPropertyValue("--edgePad"))||14,f=parseFloat(d.getPropertyValue("--logW"))||360,p=parseFloat(d.getPropertyValue("--logGap"))||14,b=parseFloat(d.getPropertyValue("--playerW"))||320,g=parseFloat(d.getPropertyValue("--slotGapXBase"))||22,h=parseFloat(d.getPropertyValue("--slotGapYBase"))||6,k=Math.max(320,c-(b+f+p*2+w*2)),M=Math.max(260,m-(u+l+x)),T=o*t+(o-1)*g,L=t*(r/n),I=parseFloat(d.getPropertyValue("--battleChromeHBase"))||140,E=L*2+h+I,_=k/T,N=M/E,C=Math.min(_,N),P=Math.max(.55,Math.min(C,1.25));e.style.setProperty("--u",String(P))},i=()=>{s||(s=requestAnimationFrame(a))};window.addEventListener("resize",i,{passive:!0}),a()}function Or(){let e=!1;const t=()=>{const o=window.innerWidth;!e&&o<1180&&(e=!0),e&&o>1220&&(e=!1),document.body.classList.toggle("compact",e)};let n=0;const r=()=>{n||(n=requestAnimationFrame(()=>{n=0,t()}))};window.addEventListener("resize",r,{passive:!0}),t()}function et(e,t,n,r,o="SYSTEM"){let s=n;if(r&&o==="PLAYER"&&t==="bleed"){const a=Number(r._bleedBonusPerApply??0);a&&(s+=a)}e.status[t]=Math.max(0,(e.status[t]??0)+s)}function tn(e,t=0){return e<t?t:e}function nn(e){const t=[...e];for(let n=t.length-1;n>0;n--){const r=Math.floor(Math.random()*(n+1));[t[n],t[r]]=[t[r],t[n]]}return t}function re(e,t="pickOne"){if(e.length===0)throw new Error(`${t}: empty array`);return e[Math.floor(Math.random()*e.length)]}function y(e,t){e.log.unshift(t),e.log=e.log.slice(0,250)}function G(e){return e.enemies.filter(t=>t.hp>0)}function Fr(e){return Math.max(0,Math.min(1,e))}function Vn(e,t=0){const n=e.player?.fatigue??0,r=Fr(t+Math.max(0,n-5)*.12),o=n<=5?0:n<=8?1:n<=11?2:3;return{f:n,p:r,tier:o}}function vn(e,t){e.includes(t)||e.push(t)}function Nt(e,t,n){e[t]??=[],e[n]??=[],vn(e[t],n),vn(e[n],t)}function Wr(e,t,n){return(e[t]??[]).includes(n)}function Sn(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}function Ur(e){return e[Math.floor(Math.random()*e.length)]}function Kr(e){const t=Math.floor((e+1)/2),r=Math.round((Math.max(4,e)-1)/3.2)+1,o=12,s=Math.min(t,32),a=Math.max(o,Math.min(s,r));return Math.max(3,Math.min(t,a))}function zr(e){let n=Kr(e);for(;n>2&&1+2*(n-1)>e;)n-=1;const r=Math.floor((e+1)/2);for(;n<r&&1+4*(n-1)<e;)n+=1;const o=4,s=new Array(n).fill(2);s[0]=1;let a=e-(1+2*(n-1));for(;a>0;){const i=1+Math.floor(Math.random()*(n-1));s[i]>=o||(s[i]+=1,a-=1)}for(let i=0;i<24;i++){const d=1+Math.floor(Math.random()*(n-1)),c=1+Math.floor(Math.random()*(n-1));d!==c&&(s[d]<=2||s[c]>=o||Math.random()<.5&&(s[d]-=1,s[c]+=1))}return s}function jr(e){const n=Math.max(18,Math.floor(8.64)),r=Math.max(2,Math.floor(72/15)),o={},s={},a=zr(72),i=[];let d=0;for(let C=0;C<a.length;C++){const P=a[C],v=[];for(let $=0;$<P;$++){const D=`n${d++}`;v.push(D)}i.push(v)}for(;d<72;)i[i.length-1].length>=4&&i.push([]),i[i.length-1].push(`n${d++}`);for(let C=0;C<i.length;C++){const P=i[C];for(let v=0;v<P.length;v++){const $=P[v];o[$]={id:$,kind:C===0&&v===0?"START":"BATTLE",depth:C,order:v,visited:C===0&&v===0,cleared:C===0&&v===0,reprocCount:0,lastProcTime:-999},s[$]=[]}}const c=i.slice(0,-1).map(()=>[]),m=(C,P)=>{if(Wr(s,C,P))return!1;const v=o[C]?.depth??0,$=o[P]?.depth??0;if(Math.abs(v-$)!==1)return!1;const D=Math.min(v,$),F=v<$?C:P,H=v<$?P:C,U=o[F]?.order??0,B=o[H]?.order??0;for(const[K,z]of c[D])if(U<K&&B>z||U>K&&B<z)return!1;return Nt(s,F,H),c[D].push([U,B]),!0};for(let C=0;C<i.length-1;C++){const P=i[C],v=i[C+1];for(let D=0;D<v.length;D++){const F=Math.floor(D*P.length/v.length),H=(Math.random()<.5?-1:1)*(Math.random()<.35?1:0),U=Math.max(0,Math.min(P.length-1,F+H));m(P[U],v[D])}const $=.35;for(let D=0;D<P.length;D++){if(Math.random()>$)continue;const F=Math.floor(D*v.length/P.length),H=(Math.random()<.5?-1:1)*(Math.random()<.35?1:0),U=Math.max(0,Math.min(v.length-1,F+H));m(P[D],v[U])}}i.length>=2&&i[1].length>=2&&m(i[0][0],i[1][i[1].length-1]);const u=Math.max(0,Math.min(n,144));let l=0,x=0;for(;l<u&&x++<8e3;){const C=Math.floor(Math.random()*(i.length-1)),P=i[C],v=i[C+1],$=P[Math.floor(Math.random()*P.length)],D=v[Math.floor(Math.random()*v.length)];m($,D)&&(l+=1)}const w=.25;for(let C=0;C<i.length;C++){const P=i[C];if(P.length<2)continue;const v=Math.floor(Math.random()*(P.length-1));Nt(s,P[v],P[v+1]);for(let $=0;$<P.length-1;$++)$!==v&&Math.random()<w&&Nt(s,P[$],P[$+1])}const f={nodes:o,edges:s,startId:i[0][0],pos:i[0][0],treasureId:null,visionNonce:0},p=[],b=Math.max(2,Math.floor(i.length*.85)),g=Math.max(b,Math.floor(i.length*1)-1);for(let C=b;C<=g&&C<i.length;C++)for(const P of i[C])p.push(P);const h=p.length?Ur(p):"n71";f.treasureId=h,o[h].kind="TREASURE";const k=Object.keys(o).filter(C=>C!==f.startId&&C!==h);Sn(k);const M=k.filter(C=>(o[C]?.depth??0)>=2);Sn(M);const T=new Set(M.slice(0,Math.min(r,M.length))),L=4,I={battleMul:.25,eventMul:1.35,restMul:1.55},E=C=>s[C]?.length??0,_=new Set(Object.keys(o).filter(C=>C===f.startId||(o[C]?.depth??0)<L?!1:E(C)===1)),N=(C,P)=>{let v=.5,$=.25,D=.25;C<=1?(v=.72,$=.14,D=.14):C<=3&&(v=.6,$=.2,D=.2),P&&(v*=I.battleMul??.25,$*=I.eventMul??1.35,D*=I.restMul??1.55);const F=v+$+D,H=Math.random()*F;return H<v?"BATTLE":H<v+$?"EVENT":"REST"};for(const C of k){if(T.has(C)){o[C].kind="ELITE";continue}const P=o[C]?.depth??0;o[C].kind=N(P,_.has(C))}return f}function qr(e){return e.uidSeq+=1,String(e.uidSeq)}function Vr(){return{relicRuntime:{},pendingRelicActivations:[],unlock:{rest:0,eliteWins:0,tookBigHit10:!1,kills:0,endedTurnWeak:!1,eventPicks:0,hpLeq15:!1,skippedTurn:!1,bleedApplied:0},timeMove:0,map:jr(),pursuit:{heat:0},vision:{mode:"NORMAL",blind:!1,presenceR:2,typeR:2,detailR:0,noise:0},encounterCount:0,treasureObtained:!1,afterTreasureNodePicks:0,nodeOfferQueue:[],finished:!1,nodePickCount:0,nodePickByType:{BATTLE:0,ELITE:0,REST:0,EVENT:0,TREASURE:0},currentNodeOffers:null,nextBattleSuppliesBonus:0,bossPool:["boss_gravity_master","boss_cursed_wall","boss_giant_orc","boss_soul_stealer"],branchOffer:null,battleCount:0,enemyLastSeenBattle:{},nextBossId:null,nextBossTime:40,forcedNext:null,bossOmenText:null,deckSizeAtTreasure:null,ominousProphecySeen:!1,relics:[],lastBattleWasElite:!1,eliteRelicOfferedThisBattle:!1,pendingElite:!1}}function Ot(e){const t={uidSeq:0,combatTurn:0,intentsRevealedThisTurn:!1,disruptIndexThisTurn:null,attackedEnemyIndicesThisTurn:[],phase:"NODE",log:[],run:Vr(),player:{hp:60,maxHp:60,block:0,supplies:7,fatigue:0,zeroSupplyTurns:0,status:{vuln:0,weak:0,bleed:0,disrupt:0},immuneToDisruptThisTurn:!1,nullifyDamageThisTurn:!1},content:e,cards:{},deck:[],hand:[],discard:[],exhausted:[],vanished:[],frontSlots:[null,null,null],backSlots:[null,null,null],backSlotDisabled:[!1,!1,!1],enemies:[],usedThisTurn:0,frontPlacedThisTurn:0,selectedHandCardUid:null,winHooksAppliedThisCombat:!1,drawCountThisTurn:0,pendingTarget:null,pendingTargetQueue:[],backUidsThisTurn:[],victoryResolvedThisCombat:!1,time:0,choice:null,choiceQueue:[],choiceStack:[],choiceCtx:null,selectedEnemyIndex:null,_justStartedCombat:!1};return Yr(t),y(t,"ìƒˆ ëŸ° ì‹œì‘."),t}function Re(e,t,n){for(let r=0;r<n;r++){const o=qr(e),s={uid:o,defId:t,zone:"deck",upgrade:0};e.cards[o]=s,e.deck.push(o)}}function Yr(e){Re(e,"field_ration",2),Re(e,"maintenance",2),Re(e,"scout",2),Re(e,"shield",2),Re(e,"power_arrow",1),Re(e,"arrow",3),e.deck=nn(e.deck)}function ge(e,t){const n=e.cards[t],r=e.content.cardsById[n.defId],o=n.upgrade??0,s=r.upgrades?.[o-1];return s?{...r,...s}:r}function ye(e,t,n){const r=e.cardsById[t],o=Math.max(0,n|0);if(o<=0)return r;const s=r.upgrades?.[o-1];return s?{...r,...s}:r}function De(e,t){const r=e.cards[t].upgrade??0,o=ge(e,t);return r>0?`${o.name} +${r}`:o.name}const Xr=[{id:"field_ration",name:"ì•¼ì „ ì‹ëŸ‰",frontText:"ë°©ì–´ +3",backText:"S +2",front:[{op:"block",n:3}],back:[{op:"supplies",n:2}],upgrades:[{frontText:"ë°©ì–´ +5",front:[{op:"block",n:5}],backText:"S +3",back:[{op:"supplies",n:3}]}]},{id:"maintenance",name:"ì •ë¹„ ë„êµ¬",exhaustWhen:"BACK",frontText:"ë°©ì–´ +3",backText:"F -1, ì†Œëª¨",front:[{op:"block",n:3}],back:[{op:"fatigue",n:-1}],upgrades:[{frontText:"ë°©ì–´ +5",front:[{op:"block",n:5}],backText:"F -1, S +2, ì†Œëª¨",back:[{op:"fatigue",n:-1},{op:"supplies",n:2}]}]},{id:"scout",name:"ì •ì°°",frontText:"ì§€ì • í”¼í•´ 3, ë°©ì–´ +1",backText:"ë“œë¡œìš° 1, S +2",front:[{op:"damageEnemy",target:"select",n:3},{op:"block",n:1}],back:[{op:"draw",n:1},{op:"supplies",n:2}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 4, ë°©ì–´ +2",front:[{op:"damageEnemy",target:"select",n:4},{op:"block",n:2}],backText:"ë“œë¡œìš° 2, S +3",back:[{op:"draw",n:2},{op:"supplies",n:3}]}]},{id:"shield",name:"ë°©íŒ¨",frontText:"ë°©ì–´ +5",backText:"ë°©ì–´ +3",front:[{op:"block",n:5}],back:[{op:"block",n:3}],upgrades:[{frontText:"ë°©ì–´ +7",front:[{op:"block",n:7}],backText:"ë°©ì–´ +4",back:[{op:"block",n:4}]}]},{id:"power_arrow",name:"ê°•ë ¥í•œ í™”ì‚´",frontText:"ë¬´ì‘ìœ„ í”¼í•´ 10, S -2",backText:"ë¬´ì‘ìœ„ í”¼í•´ 7, S -2",front:[{op:"supplies",n:-2},{op:"damageEnemy",target:"random",n:10}],back:[{op:"supplies",n:-2},{op:"damageEnemy",target:"random",n:7}],upgrades:[{frontText:"ë¬´ì‘ìœ„ í”¼í•´ 13, S -2",front:[{op:"supplies",n:-2},{op:"damageEnemy",target:"random",n:13}],backText:"ë¬´ì‘ìœ„ í”¼í•´ 10, S -2",back:[{op:"supplies",n:-2},{op:"damageEnemy",target:"random",n:10}]}]},{id:"arrow",name:"í™”ì‚´",frontText:"ì§€ì • í”¼í•´ 5",backText:"ì§€ì • í”¼í•´ 5, S -1",front:[{op:"damageEnemy",target:"select",n:5}],back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:5}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 7",front:[{op:"damageEnemy",target:"select",n:7}],backText:"ì§€ì • í”¼í•´ 7, S -1",back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:7}]}]},{id:"goal_treasure",name:"ì €ì£¼ë°›ì€ ë³´ë¬¼",exhaustWhen:"BOTH",frontText:"F +1, ì†Œëª¨",backText:"S -1, F +1, ì†Œëª¨",front:[{op:"fatigue",n:1}],back:[{op:"supplies",n:-1},{op:"fatigue",n:1}]},{id:"berserk",name:"ê´‘í­í™”",frontText:"ë¬´ì‘ìœ„ í”¼í•´ 15, S -3",backText:"S +4, F +1",front:[{op:"damageEnemy",target:"random",n:15},{op:"supplies",n:-3}],back:[{op:"supplies",n:4},{op:"fatigue",n:1}],upgrades:[{frontText:"ë¬´ì‘ìœ„ í”¼í•´ 20, S -4",front:[{op:"damageEnemy",target:"random",n:20},{op:"supplies",n:-4}],backText:"S +6, F +2",back:[{op:"supplies",n:6},{op:"fatigue",n:2}]}]},{id:"bandage",name:"ë¶•ëŒ€",exhaustWhen:"BOTH",frontText:"HP +4, ì†Œëª¨",backText:"HP +4, S -1, ì†Œëª¨",front:[{op:"heal",n:4}],back:[{op:"supplies",n:-1},{op:"heal",n:4}],upgrades:[{frontText:"HP +4, ì¶œí˜ˆ ì œê±°, ì†Œëª¨",front:[{op:"heal",n:4},{op:"clearStatusSelf",key:"bleed"}],backText:"HP +4, ì¶œí˜ˆ ì œê±°, S -1, ì†Œëª¨",back:[{op:"supplies",n:-1},{op:"heal",n:4},{op:"clearStatusSelf",key:"bleed"}]}]},{id:"arrow_rain",name:"í™”ì‚´ì˜ ë¹„",exhaustWhen:"BOTH",frontText:"ì „ì²´ í”¼í•´ 10, S -2 ì†Œëª¨",backText:"ë“œë¡œìš° 2, S +2, F +1, ì†Œëª¨",front:[{op:"damageEnemy",target:"all",n:10},{op:"supplies",n:-2}],back:[{op:"draw",n:2},{op:"supplies",n:2},{op:"fatigue",n:1}],upgrades:[{frontText:"ì „ì²´ í”¼í•´ 13, S -2, ì†Œëª¨",front:[{op:"damageEnemy",target:"all",n:13},{op:"supplies",n:-2}],backText:"ë“œë¡œìš° 3, S +3, F +2, ì†Œëª¨",back:[{op:"draw",n:3},{op:"supplies",n:3},{op:"fatigue",n:2}]}]},{id:"smoke",name:"ì—°ë§‰",vanishWhen:"FRONT",frontText:"ì´ë²ˆ í„´ ì  ê³µê²© í”¼í•´ ë¬´íš¨, ì†Œì‹¤",backText:"F +1",front:[{op:"nullifyDamageThisTurn"}],back:[{op:"fatigue",n:1}]},{id:"redeploy",name:"ì¬ë°°ì¹˜",frontText:"S +2",backText:"3ë²ˆ ìŠ¬ë¡¯ì— ìˆëŠ” í›„ì—´ ì¹´ë“œì˜ ì „ì—´ íš¨ê³¼ ë°œë™",front:[{op:"supplies",n:2}],back:[{op:"triggerFrontOfBackSlot",index:2}],upgrades:[{frontText:"S +3",front:[{op:"supplies",n:3}],backText:"3ë²ˆ ìŠ¬ë¡¯ì— ìˆëŠ” í›„ì—´ ì¹´ë“œì˜ ì „ì—´ íš¨ê³¼ ë°œë™, S +1",back:[{op:"triggerFrontOfBackSlot",index:2},{op:"supplies",n:1}]}]},{id:"secret_strike",name:"ë¹„ì¥ì˜ ì¼ê²©",exhaustWhen:"BOTH",frontText:"ë¬´ì‘ìœ„ í”¼í•´ (Fì˜ 2ë°°), ì†Œëª¨",backText:"ì „ì²´ ì·¨ì•½ +3 ë° ì•½í™” +3, ì†Œëª¨",front:[{op:"damageEnemyByPlayerFatigue",target:"random",mult:2}],back:[{op:"statusEnemy",target:"all",key:"vuln",n:3},{op:"statusEnemy",target:"all",key:"weak",n:3}],upgrades:[{exhaustWhen:"FRONT",frontText:"ì§€ì • í”¼í•´ (Fì˜ 2ë°°), ì†Œëª¨",front:[{op:"damageEnemyByPlayerFatigue",target:"select",mult:2}],backText:"ì „ì²´ ì·¨ì•½ +4 ë° ì•½í™” +4",back:[{op:"statusEnemy",target:"all",key:"vuln",n:4},{op:"statusEnemy",target:"all",key:"weak",n:4}]}]},{id:"fire_scroll",name:"í™”ì—¼ ë‘ë£¨ë§ˆë¦¬",exhaustWhen:"FRONT",vanishWhen:"BACK",frontText:"ì „ì²´ í”¼í•´ 6, ì†Œëª¨",backText:"ì „ì²´ í”¼í•´ 12, ì†Œì‹¤",front:[{op:"damageEnemy",target:"all",n:6}],back:[{op:"damageEnemy",target:"all",n:12}],upgrades:[{frontText:"ì „ì²´ í”¼í•´ 8, ì†Œëª¨",front:[{op:"damageEnemy",target:"all",n:8}],backText:"ì „ì²´ í”¼í•´ 15, ì†Œì‹¤",back:[{op:"damageEnemy",target:"all",n:15}]}]},{id:"caltrops",name:"ë§ˆë¦„ì‡ ",frontText:"ì „ì²´ ì¶œí˜ˆ 4 ë¶€ì—¬",backText:"ì´ë²ˆ í„´ì— ìì‹ ì„ ê³µê²©í•˜ë ¤ëŠ” ì ì—ê²Œ ì¶œí˜ˆ 3 ë¶€ì—¬",front:[{op:"statusEnemy",target:"all",key:"bleed",n:4}],back:[{op:"statusEnemiesAttackingThisTurn",key:"bleed",n:3}],upgrades:[{frontText:"ì „ì²´ ì¶œí˜ˆ 5 ë¶€ì—¬",backText:"ì´ë²ˆ í„´ì— ìì‹ ì„ ê³µê²©í•˜ë ¤ëŠ” ì ì—ê²Œ ì¶œí˜ˆ 4 ë¶€ì—¬",front:[{op:"statusEnemy",target:"all",key:"bleed",n:5}],back:[{op:"statusEnemiesAttackingThisTurn",key:"bleed",n:4}]}]},{id:"emergency_rations",name:"ë¹„ìƒì‹ëŸ‰",vanishWhen:"BACK",frontText:"S +2",backText:"Së¥¼ 7ë¡œ ë§Œë“¦. ì†Œì‹¤",front:[{op:"supplies",n:2}],back:[{op:"setSupplies",n:7}],upgrades:[{frontText:"S +3",backText:"Së¥¼ 10ìœ¼ë¡œ ë§Œë“¦. ì†Œì‹¤",front:[{op:"supplies",n:3}],back:[{op:"setSupplies",n:10}]}]},{id:"painkiller",name:"ì§„í†µì œ",exhaustWhen:"FRONT",vanishWhen:"BACK",frontText:"HP -8, F -3, ì†Œëª¨",backText:"HP +8, F +1, ì†Œì‹¤",front:[{op:"hp",n:-8},{op:"fatigue",n:-3}],back:[{op:"hp",n:8},{op:"fatigue",n:1}],upgrades:[{frontText:"HP -6, F -3, ì†Œëª¨",backText:"HP +10, F +1, ì†Œì‹¤",front:[{op:"hp",n:-6},{op:"fatigue",n:-3}],back:[{op:"hp",n:10},{op:"fatigue",n:1}]}]},{id:"field_experience",name:"ì‹¤ì „ ê²½í—˜",exhaustWhen:"BACK",frontText:"ì „ì²´ í”¼í•´ 3",backText:"ì´ ì¹´ë“œê°€ í›„ì—´ì— ìˆëŠ” í„´ì— ìŠ¹ë¦¬í•˜ë©´ ìµœëŒ€ ì²´ë ¥ +2, ì†Œëª¨",front:[{op:"damageEnemy",target:"all",n:3}],back:[],onWinWhileInBack:[{op:"maxHp",n:2}],upgrades:[{frontText:"ì „ì²´ í”¼í•´ 4",backText:"ì´ ì¹´ë“œê°€ í›„ì—´ì— ìˆëŠ” í„´ì— ìŠ¹ë¦¬í•˜ë©´ ìµœëŒ€ ì²´ë ¥ +3, ì†Œëª¨",front:[{op:"damageEnemy",target:"all",n:4}],back:[],onWinWhileInBack:[{op:"maxHp",n:3}]}]},{id:"camp_prep",name:"ì•¼ì˜ ì¤€ë¹„",frontText:"ë°©ì–´ +4, S +1",backText:"S +3",front:[{op:"block",n:4},{op:"supplies",n:1}],back:[{op:"supplies",n:3}],upgrades:[{frontText:"ë°©ì–´ +5, S +2",backText:"S +5",front:[{op:"block",n:5},{op:"supplies",n:2}],back:[{op:"supplies",n:5}]}]},{id:"vital_shot",name:"ê¸‰ì†Œ ì‚¬ê²©",frontText:"ì§€ì • í”¼í•´ 8",backText:"ì§€ì • í”¼í•´ 5, ì¶œí˜ˆ 2 ë¶€ì—¬, S -1",front:[{op:"damageEnemy",target:"select",n:8}],back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:5},{op:"statusEnemy",target:"select",key:"bleed",n:2}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 11",backText:"ì§€ì • í”¼í•´ 6, ì¶œí˜ˆ 3 ë¶€ì—¬, S -1",front:[{op:"damageEnemy",target:"select",n:11}],back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:6},{op:"statusEnemy",target:"select",key:"bleed",n:3}]}]},{id:"taunt",name:"ë…ì„¤",frontText:"ì§€ì • ì•½í™” +4",backText:"ì „ì²´ ì·¨ì•½ +2 ë° ì•½í™” +2",front:[{op:"statusEnemy",target:"select",key:"weak",n:4}],back:[{op:"statusEnemy",target:"all",key:"vuln",n:2},{op:"statusEnemy",target:"all",key:"weak",n:2}],upgrades:[{frontText:"ì§€ì • ì•½í™” +5",backText:"ì „ì²´ ì·¨ì•½ +2 ë° ì•½í™” +3",front:[{op:"statusEnemy",target:"select",key:"weak",n:5}],back:[{op:"statusEnemy",target:"all",key:"vuln",n:2},{op:"statusEnemy",target:"all",key:"weak",n:3}]}]},{id:"rapid_fire",name:"ì—°ì† ì‚¬ê²©",frontText:"ì§€ì • í”¼í•´ 2, 3ë²ˆ ë°œë™",backText:"ì´ë²ˆ í„´ì— ì¹´ë“œë¥¼ ë½‘ì•˜ìœ¼ë©´ ë¬´ì‘ìœ„ í”¼í•´ 8",front:[{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2}],back:[{op:"ifDrewThisTurn",then:[{op:"damageEnemy",target:"random",n:8}]}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 2, 4ë²ˆ ë°œë™",backText:"ì´ë²ˆ í„´ì— ì¹´ë“œë¥¼ ë½‘ì•˜ìœ¼ë©´ ë¬´ì‘ìœ„ í”¼í•´ 10",front:[{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2}],back:[{op:"ifDrewThisTurn",then:[{op:"damageEnemy",target:"random",n:10}]}]}]},{id:"blood_contract",name:"í”¼ì˜ ê³„ì•½",frontText:"ì§€ì • í”¼í•´ 12, HP -3",backText:"S +3, F +1",front:[{op:"damageEnemy",target:"select",n:12},{op:"hp",n:-3}],back:[{op:"supplies",n:3},{op:"fatigue",n:1}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 15, HP -3",backText:"S +4, F +1",front:[{op:"damageEnemy",target:"select",n:15},{op:"hp",n:-3}],back:[{op:"supplies",n:4},{op:"fatigue",n:1}]}]},{id:"cloth_scrap_armor",name:"ì²œ ì¡°ê° ê°‘ì˜·",frontText:"ë°©ì–´ +8, S -1",backText:"ë°©ì–´ +4",front:[{op:"supplies",n:-1},{op:"block",n:8}],back:[{op:"block",n:4}],upgrades:[{frontText:"ë°©ì–´ +10, S -1",backText:"ë°©ì–´ +5",front:[{op:"supplies",n:-1},{op:"block",n:10}],back:[{op:"block",n:5}]}]},{id:"mad_echo",name:"ë©”ì•„ë¦¬",frontText:"ë¬´ì‘ìœ„ í”¼í•´ (Fì˜ ì ˆë°˜ (ë²„ë¦¼))",backText:"ë“œë¡œìš° 1, S +2, F +1",front:[{op:"damageEnemyByPlayerFatigue",target:"random",mult:.5}],back:[{op:"draw",n:1},{op:"supplies",n:2},{op:"fatigue",n:1}],upgrades:[{frontText:"ë¬´ì‘ìœ„ í”¼í•´ (F)",front:[{op:"damageEnemyByPlayerFatigue",target:"random",mult:1}],backText:"ë“œë¡œìš° 2, S +2, F +1",back:[{op:"draw",n:2},{op:"supplies",n:2},{op:"fatigue",n:1}]}]},{id:"mad_insight",name:"ê¸ˆë‹¨ì˜ í†µì°°",exhaustWhen:"BOTH",frontText:"ë°©ì–´ +8, ë“œë¡œìš° 1, F +1, ì†Œëª¨",backText:"ë“œë¡œìš° 3, S +2, F +2, ì†Œëª¨",front:[{op:"block",n:8},{op:"draw",n:1},{op:"fatigue",n:1}],back:[{op:"draw",n:3},{op:"supplies",n:2},{op:"fatigue",n:2}],upgrades:[{frontText:"ë°©ì–´ +10, ë“œë¡œìš° 2, F +1, ì†Œëª¨",front:[{op:"block",n:10},{op:"draw",n:2},{op:"fatigue",n:1}],backText:"ë“œë¡œìš° 4, S +3, F +2, ì†Œëª¨",back:[{op:"draw",n:4},{op:"supplies",n:3},{op:"fatigue",n:2}]}]},{id:"mad_bargain",name:"ê±°ë˜ì˜ ì”ì¬",exhaustWhen:"BOTH",frontText:"ì§€ì • 12 í”¼í•´, S -1, F +1, ì†Œëª¨",backText:"HP +6, F +2, ì†Œëª¨",front:[{op:"damageEnemy",target:"select",n:12},{op:"supplies",n:-1},{op:"fatigue",n:1}],back:[{op:"heal",n:6},{op:"fatigue",n:2}],upgrades:[{frontText:"ì§€ì • 20 í”¼í•´, S -1, F +1, ì†Œëª¨",front:[{op:"damageEnemy",target:"select",n:20},{op:"supplies",n:-1},{op:"fatigue",n:1}],backText:"HP +8, F +2, ì†Œëª¨",back:[{op:"heal",n:8},{op:"fatigue",n:2}]}]}],Yn=Object.fromEntries(Xr.map(e=>[e.id,e])),Gr=[{id:"other_adventurer",name:"ë³´ë¬¼ì„ ë…¸ë¦¬ëŠ” ë‹¤ë¥¸ ëª¨í—˜ê°€",maxHp:60,intents:[{label:"ì°½ ì°Œë¥´ê¸°: 5 í”¼í•´, 3ë²ˆ ë°œë™",acts:[{op:"damagePlayer",n:5},{op:"damagePlayer",n:5},{op:"damagePlayer",n:5}]},{label:"ë…ì•½ ë¿Œë¦¬ê¸°: ì¶œí˜ˆ +4, ì·¨ì•½ +4, ì•½í™” +4 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"bleed",n:4},{op:"statusPlayer",key:"vuln",n:4},{op:"statusPlayer",key:"weak",n:4}]}]},{id:"goblin_raider",name:"ê³ ë¸”ë¦° ì•½íƒˆì",maxHp:15,intents:[{label:"ê¸°ìŠµ: 12 - ì´ë²ˆ í„´ì— ì‚¬ìš©í•œ ì¹´ë“œì˜ ìˆ˜ë§Œí¼ í”¼í•´",acts:[{op:"damagePlayerFormula",kind:"goblin_raider"}]},{label:"í›”ì¹˜ê¸°: ì¶œí˜ˆ +2 ë¶€ì—¬, S -3",acts:[{op:"supplies",n:-3},{op:"statusPlayer",key:"bleed",n:2}]}]},{id:"watching_statue",name:"ê°ì‹œí•˜ëŠ” ì„ìƒ",maxHp:25,intents:[{label:"ê°ì‹œ: 4 + ì´ë²ˆ í„´ì— ì‚¬ìš©í•œ ì¹´ë“œì˜ ìˆ˜ë§Œí¼ í”¼í•´",acts:[{op:"damagePlayerFormula",kind:"watching_statue"}]}]},{id:"pebble_golem",name:"ì¡°ì•½ëŒ ê³¨ë ˜",maxHp:30,intents:[{label:"ì¡°ì•½ëŒ ë˜ì§€ê¸°: 8 í”¼í•´",acts:[{op:"damagePlayer",n:8}]},{label:"ëª¨ë˜ ëª¨ìœ¼ê¸°: ìì‹  HP 6 íšŒë³µ",acts:[{op:"enemyHealSelf",n:6}]}]},{id:"rock_golem",name:"ë°”ìœ„ ê³¨ë ˜",maxHp:50,intents:[{label:"ë°”ìœ„ ë˜ì§€ê¸°: 10 í”¼í•´",acts:[{op:"damagePlayer",n:10}]},{label:"ë•… ëª¨ìœ¼ê¸°: ìì‹  HP 8 íšŒë³µ",acts:[{op:"enemyHealSelf",n:10}]}]},{id:"slime",name:"ìŠ¬ë¼ì„",maxHp:30,intents:[{label:"ì‚°ì„±ì•¡: ì¶œí˜ˆ +3 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"bleed",n:3}]},{label:"ì ì•¡: ì•½í™” +3 ë¶€ì—¬ í›„ ìì‹  HP 3 íšŒë³µ",acts:[{op:"statusPlayer",key:"weak",n:3},{op:"enemyHealSelf",n:3}]},{label:"ë•Œë¦¬ê¸°: 6 í”¼í•´",acts:[{op:"damagePlayer",n:6}]}]},{id:"poison_spider",name:"ë…ê±°ë¯¸",maxHp:28,intents:[{label:"ë…ë‹ˆë¡œ ë¬¼ê¸°: ì¶œí˜ˆ +4 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"bleed",n:4}]},{label:"ì†¡ê³³ë‹ˆë¡œ ë¬¼ê¸°: 7 í”¼í•´",acts:[{op:"damagePlayer",n:7}]},{label:"ë‹¨ë²ˆì— ë¬¼ê¸°: ì¶œí˜ˆ +2 ë¶€ì—¬, 6 í”¼í•´",acts:[{op:"statusPlayer",key:"bleed",n:2},{op:"damagePlayer",n:6}]}]},{id:"gravity_echo",name:"ì¤‘ë ¥ì˜ ì”í–¥",maxHp:35,intents:[{label:"í•˜ì¤‘ ì¸ì¥",acts:[{op:"damagePlayerByDeckSize",base:5,per:2,div:6,cap:18}]},{label:"ì••ì¶•: 7 í”¼í•´",acts:[{op:"damagePlayer",n:7}]},{label:"ë†“ì¹˜ê²Œ ë§Œë“¤ê¸°: S -3",acts:[{op:"supplies",n:-3}]}]},{id:"rat_swarm",name:"ì¥ë–¼",maxHp:20,intents:[{label:"ëœ¯ê¸°: 4 í”¼í•´, 2ë²ˆ ë°œë™",acts:[{op:"damagePlayer",n:4},{op:"damagePlayer",n:4}]},{label:"ê¸°ìŠµí•˜ê¸°: ì·¨ì•½ +2 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"vuln",n:2}]},{label:"ê´‘ë€: 2 í”¼í•´ (íƒ€ìˆ˜ê°€ ì¦ê°€í•©ë‹ˆë‹¤!) ",acts:[{op:"damagePlayerRampHits",n:2,baseHits:1,everyTurns:1,capHits:6}]}]},{id:"goblin_commander",name:"ê³ ë¸”ë¦° ì§€íœ˜ê´€",maxHp:30,intents:[{label:"í˜¸ë ¹: ì·¨ì•½ +2 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"vuln",n:2}]},{label:"ë°œë¡œ ì°¨ê¸°: 7 í”¼í•´",acts:[{op:"damagePlayer",n:7}]},{label:"ì „ìˆ  ì§€ì‹œ: ì•½í™” +2 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"weak",n:2}]}]},{id:"goblin_archer",name:"ê³ ë¸”ë¦° ê¶ìˆ˜",maxHp:15,intents:[{label:"ì¡°ì¤€: 2 í”¼í•´, 3ë²ˆ",acts:[{op:"damagePlayer",n:2},{op:"damagePlayer",n:2},{op:"damagePlayer",n:2}]},{label:"ì—°ì‚¬: 1 í”¼í•´ (íƒ€ìˆ˜ê°€ ì¦ê°€í•©ë‹ˆë‹¤!)",acts:[{op:"damagePlayerRampHits",n:1,baseHits:1,everyTurns:1,capHits:10}]}]},{id:"gloved_hunter",name:"ì¥ê°‘ ë‚€ ì‚¬ëƒ¥ê¾¼",maxHp:52,intents:[{label:"ê°€ëŠ : ì·¨ì•½ +3 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"vuln",n:3}]},{label:"ì‚¬ëƒ¥: 6 í”¼í•´, ë°©ì–´ê°€ 4 ì´ìƒì´ë©´ ëŒ€ì‹  12 í”¼í•´",acts:[{op:"damagePlayerFormula",kind:"gloved_hunter"}]},{label:"ì‚¬ì‚´: 9 í”¼í•´",acts:[{op:"damagePlayer",n:9}]}]},{id:"boss_gravity_master",name:"ì¤‘ë ¥ í†µë‹¬ì",omen:"ëª¸ì´ ì ì  ë¬´ê²ë‹¤. ì§ì„ ë¹„ì›Œë¼.",maxHp:90,intents:[{label:"ì¤‘ë ¥ ìˆ˜ì¶•: ì•½í™” +3 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"weak",n:3}]},{label:"íŠ¹ì´ì  ìƒì„±",acts:[{op:"damagePlayerByDeckSize",base:8,per:3,div:5,cap:30}]},{label:"ì²œì¥ ë¶•ê´´: 11 í”¼í•´",acts:[{op:"damagePlayer",n:11}]}]},{id:"boss_cursed_wall",name:"ì €ì£¼ë°›ì€ ë²½",omen:"ì›€ì§ì´ì§€ ì•ŠëŠ”ë‹¤. ë‹³ì•„ê°„ë‹¤.",maxHp:160,intents:[{label:"ì €ì£¼ì˜ ê¸°ìš´: ì¶œí˜ˆ +3 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"bleed",n:3}]},{label:"ì €ì£¼ì˜ ê¸°ìš´: F +1",acts:[{op:"fatiguePlayer",n:1}]},{label:"ì•„ë¬´ í–‰ë™ë„ í•˜ì§€ ì•ŠìŒ",acts:[]}]},{id:"boss_giant_orc",name:"ê±°ëŒ€í•œ ì˜¤í¬",omen:"ê±°ëŒ€í•œ ì§ìŠ¹ì´ ê¸°ë‹¤ë¦°ë‹¤. í˜ì„ ê¹ì•„ì•¼ í•œë‹¤.",maxHp:95,intents:[{label:"ë‚´ë ¤ì¹˜ê¸°: ì·¨ì•½ +2 ë¶€ì—¬, 10 í”¼í•´",acts:[{op:"statusPlayer",key:"vuln",n:2},{op:"damagePlayer",n:15}]},{label:"ë‹¨ë‹¨í•œ í”¼ë¶€: ë‹¤ìŒ í„´ ë™ì•ˆ í”¼í•´ë¥¼ ì…ì§€ ì•ŠìŒ",acts:[{op:"enemyImmuneNextTurn"}]},{label:"íƒ€ê³ ë‚œ íšŒë³µ: ìì‹  HP 15 íšŒë³µ",acts:[{op:"enemyHealSelf",n:15}]},{label:"ê´‘ë¶„: 6 í”¼í•´ (íƒ€ìˆ˜ê°€ ì¦ê°€í•©ë‹ˆë‹¤!)",acts:[{op:"damagePlayerRampHits",n:6,baseHits:1,everyTurns:1,capHits:6}],meta:{cat:"ATTACK"}}]},{id:"boss_soul_stealer",name:"ì˜í˜¼ ê°•íƒˆì",omen:"í–‰ë™í•˜ì§€ ì•Šìœ¼ë©´ ì¢…ë§ì´ ì˜¨ë‹¤.",maxHp:80,intents:[{label:"í—ˆê¸°: 7 í”¼í•´, S -2",acts:[{op:"damagePlayer",n:7},{op:"supplies",n:-2}]},{label:"ë‚˜íƒœ: 7 í”¼í•´, F +1",acts:[{op:"damagePlayer",n:7},{op:"fatiguePlayer",n:1}]},{label:"ì˜ˆì–¸: ì¹´ìš´íŠ¸ ì§„í–‰",acts:[]}]}],Qr=Object.fromEntries(Gr.map(e=>[e.id,e]));function Jr(e,t=10,n=16){const r=Math.max(0,e-n),o=Math.ceil(Math.sqrt(r));return t+o}function Pt(e,t){const n=e.content.enemiesById[t];return{id:n.id,name:n.name,hp:n.maxHp,maxHp:n.maxHp,intentIndex:0,status:{vuln:0,weak:0,bleed:0,disrupt:0},immuneThisTurn:!1,immuneNextTurn:!1,lastIntentKey:null,lastIntentStreak:0,soulWarnCount:t==="boss_soul_stealer"?0:void 0,soulArmed:t==="boss_soul_stealer"?!1:void 0,soulWillNukeThisTurn:t==="boss_soul_stealer"?!1:void 0}}function Zr(e,t,n,r=5){for(const o of t){const s=e.run.enemyLastSeenBattle?.[o];if(s!=null&&n-s<r)return!1}return!0}function Ie(e,t){const n=t?.forceBoss??!1,r=e.run,o=(t?.forceElite??r.pendingElite??!1)===!0;r.pendingElite=!1,e.run.enemyLastSeenBattle??={},e.run.battleCount??=0;const s=e.run.nodePickCount??0,a=(e.run.battleCount??0)+1;if(t?.forcePatternIds&&t.forcePatternIds.length>0){const h=t.forcePatternIds;e.run.battleCount=a;for(const k of h)e.run.enemyLastSeenBattle[k]=a;e.enemies=h.map(k=>Pt(e,k)),e.run.lastBattleWasElite=!1,y(e,`ì „íˆ¬ ì‹œì‘! (ë…¸ë“œ ${s}, ì „íˆ¬ ${a}íšŒì°¨) ì : ${e.enemies.map(k=>k.name).join(", ")}`);return}if(n)if(e.run.lastBattleWasElite=!1,e.run.bossPool??=["boss_gravity_master","boss_cursed_wall","boss_giant_orc","boss_soul_stealer"],e.run.bossPool.length===0&&!e.run.nextBossId)y(e,`ë³´ìŠ¤ í’€ì´ ë¹„ì—ˆìŠµë‹ˆë‹¤. ì¼ë°˜ ì „íˆ¬ë¡œ ì§„í–‰í•©ë‹ˆë‹¤. (ë…¸ë“œ ${s})`);else{let h=e.run.nextBossId??null;if(h!=null){const k=e.content.enemiesById[h];e.run.bossOmenText=lr[h]??k.omen??null}h?(e.run.nextBossId=null,e.run.bossPool=e.run.bossPool.filter(k=>k!==h)):(h=re(e.run.bossPool),e.run.bossPool=e.run.bossPool.filter(k=>k!==h)),e.enemies=[Pt(e,h)],e.run.ominousProphecySeen=!1,y(e,`ë³´ìŠ¤ ë“±ì¥! (ë…¸ë“œ ${s}) ì : ${e.enemies[0].name}`),e.run.battleCount=a,e.run.enemyLastSeenBattle[h]=a;return}const i=[[["goblin_raider"],["watching_statue"],["pebble_golem"],["slime"],["rat_swarm"]],[["goblin_raider","slime"],["pebble_golem","pebble_golem"],["rock_golem"],["poison_spider"],["rat_swarm","rat_swarm"],["goblin_archer","goblin_raider"]],[["goblin_raider","goblin_raider","goblin_raider"],["rock_golem","pebble_golem"],["slime","slime"],["poison_spider","slime"],["gravity_echo"],["gloved_hunter"]]],d=[["gravity_echo","poison_spider"],["poison_spider","slime"],["watching_statue","slime"],["watching_statue","watching_statue"],["poison_spider","poison_spider"],["rock_golem","gravity_echo"],["goblin_raider","goblin_raider","watching_statue"],["rat_swarm","rat_swarm","rat_swarm"]],c=[[["goblin_raider","watching_statue"],["rat_swarm","goblin_archer"]],[["goblin_commander","goblin_archer","goblin_archer"],["watching_statue","watching_statue"],["gloved_hunter","rat_swarm"]],[["rock_golem","gravity_echo"],["poison_spider","poison_spider"]]],m=[["gravity_echo","gravity_echo"],["rock_golem","poison_spider"],["watching_statue","gravity_echo"]],u=Number(e.run.timeMove??0)+(e.time??0),l=Math.min(i.length-1,Math.floor(Math.max(0,u)/15)),x=o?e.run.treasureObtained?m:c[l]:e.run.treasureObtained?d:i[l],w=5,f=x.filter(h=>Zr(e,h,a,w)),p=f.length>0?f:x,b=re(p);e.run.battleCount=a;for(const h of b)e.run.enemyLastSeenBattle[h]=a;e.enemies=b.map(h=>Pt(e,h)),e.run.lastBattleWasElite=o,y(e,`ì „íˆ¬ ì‹œì‘!${o?" [ì •ì˜ˆ]":""} (ë…¸ë“œ ${s}, ì „íˆ¬ ${a}íšŒì°¨) ì : ${e.enemies.map(h=>h.name).join(", ")}`)}function eo(){return Object.keys(Q).sort((e,t)=>e.localeCompare(t))}const Q={relic_unknown_square:{id:"relic_unknown_square",dormantName:"ì –ì€ ì‚¬ê°í˜•",dormantText:"ê³°íŒ¡ì´ì¼ê¹Œ? ë¨¹ì„ ìˆ˜ ìˆì„ê¹Œ?",unlockHint:"ì¡°ê±´: íœ´ì‹ 1íšŒ",art:"assets/relics/relic_unknown_square.png",unlock:e=>e.run.unlock?.rest>=1,name:"ë¨¹ì„ ìˆ˜ ìˆëŠ” ì‚¬ê°í˜•",text:"ì „íˆ¬ ì‹œì‘ ì‹œ ğŸŒ¾ S +2",unlockFlavor:"ë¨¹ì„ ìˆ˜ëŠ” ìˆë‹¤. ì¼ë‹¨ì€.",onCombatStart(e){e.player.supplies+=2,y(e,"ìœ ë¬¼[ë¨¹ì„ ìˆ˜ ìˆëŠ” ì‚¬ê°í˜•]: S +2")}},relic_monster_leather_helm:{id:"relic_monster_leather_helm",dormantName:"ë“¤ëŸ¬ë¶™ëŠ” ê°€ì£½",dormantText:"í„¸ê³¼ í”¼ê°€ ë’¤ì„ì¸ ê°€ì£½ì´ ì†ì— ë“¤ëŸ¬ë¶™ëŠ”ë‹¤.",unlockHint:"ì¡°ê±´: ì—˜ë¦¬íŠ¸ ì „íˆ¬ ìŠ¹ë¦¬ 1íšŒ",art:"assets/relics/relic_monster_leather_helm.png",unlock:e=>e.run.unlock?.eliteWins>=1,name:"ëª¬ìŠ¤í„° ê°€ì£½ íˆ¬êµ¬",text:"ì²« í„´ì— ğŸ›¡ï¸ ë°©ì–´ +4",unlockFlavor:"ë¨¸ë¦¬ì— ë“¤ëŸ¬ë¶™ì–´ ë–¨ì–´ì§€ì§€ ì•Šì§€ë§Œ ë‹¹ì¥ì˜ ë¬¸ì œëŠ” ì•„ë‹ˆë‹¤.",onCombatStart(e){e.player.block+=4,y(e,"ìœ ë¬¼[ëª¬ìŠ¤í„° ê°€ì£½ íˆ¬êµ¬]: ë°©ì–´ +4")}},relic_smoke_bomb:{id:"relic_smoke_bomb",dormantName:"ì†ì´ ë¹„ì–´ ìˆëŠ” íƒ„í™˜",dormantText:"í”ë“¤ë©´ ì‘ì€ ì•Œê°±ì´ê°€ êµ´ëŸ¬ë‹¤ë‹Œë‹¤. ì—°ê¸°ê°€ ì¡°ê¸ˆì”© ìƒŒë‹¤.",unlockHint:"ì¡°ê±´: í•œ ë²ˆì— 10 ì´ìƒì˜ ğŸ—¡ï¸ í”¼í•´ 1íšŒ ë°›ê¸°",art:"assets/relics/relic_smoke_bomb.png",unlock:e=>!!e.run.unlock?.tookBigHit10,name:"ì—°ë§‰íƒ„",text:"í™œì„±í™” ì‹œ ì—°ë§‰ ì¹´ë“œ(ì†Œì‹¤) 1ì¥ íšë“",unlockFlavor:"ë¹„ìƒ íƒˆì¶œ!",onActivate(e){const t="smoke";e.uidSeq+=1;const n=String(e.uidSeq);e.cards[n]={uid:n,defId:t,zone:"deck",upgrade:0},e.deck.push(n),y(e,"ìœ ë¬¼[ì—°ë§‰íƒ„]: ì—°ë§‰ ì¹´ë“œ 1ì¥ íšë“")}},relic_bone_compass:{id:"relic_bone_compass",dormantName:"ê¸¸ì„ ìƒëŠ” ë°”ëŠ˜",dormantText:"ë°©í–¥ì„ ê°€ë¦¬í‚¤ì§€ ëª»í•˜ëŠ” ë°”ëŠ˜ì´ ì£¼ë¨¸ë‹ˆ ë°”ê¹¥ìœ¼ë¡œ ë‚˜ì˜¨ë‹¤.",unlockHint:"ì¡°ê±´: íƒí—˜ 5íšŒ",art:"assets/relics/relic_bone_compass.png",unlock:e=>(e.run?.nodePickCount??0)>=5,name:"ë¼ˆê°€ ë§Œë“  ë‚˜ì¹¨ë°˜",text:"ì „íˆ¬ ì‹œì‘ ì‹œ ğŸƒ ë“œë¡œìš° +1",unlockFlavor:"ì–´ë””ë¥¼ ê°€ë¦¬í‚¤ëŠ” ê²ƒì´ì§€?",onCombatStart(e){e._combatStartExtraDraw=(e._combatStartExtraDraw??0)+1,y(e,"ìœ ë¬¼[ë¼ˆê°€ ë§Œë“  ë‚˜ì¹¨ë°˜]: ì „íˆ¬ ì‹œì‘ ë“œë¡œìš° +1")}},relic_flesh_whetstone:{id:"relic_flesh_whetstone",dormantName:"ì´ê°€ ë¹ ì§„ ì¹¼ë‚ ",dormantText:"ì–´ë””ì— ì“°ë¼ê³  ìˆëŠ”ì§€ ëª¨ë¥´ê² ë‹¤.",unlockHint:"ì¡°ê±´: ì  ì²˜ì¹˜ 3íšŒ",art:"assets/relics/relic_flesh_whetstone.png",unlock:e=>(e.run.unlock?.kills??0)>=3,name:"ì†ì‚´ì„ ì°¾ëŠ” ìˆ«ëŒ",text:"ì „íˆ¬ì—ì„œ ì²« ê³µê²©ì´ ì£¼ëŠ” ğŸ—¡ï¸ í”¼í•´ +3",unlockFlavor:"ë°¤ë§ˆë‹¤ ë¬´ì–¸ê°€ ê°ˆê³  ìˆë‹¤.",onCombatStart(e){e._firstPlayerAttackDoneThisCombat=!1},modifyDamage(e,t){if(t.phase!=="PRE_STATUS")return t.current;if(t.target==="ENEMY"&&t.source==="PLAYER_ATTACK"){const n=e;if(!n._firstPlayerAttackDoneThisCombat)return n._firstPlayerAttackDoneThisCombat=!0,t.current+3}return t.current}},relic_weak_bell:{id:"relic_weak_bell",dormantName:"ìƒˆê¹Œë§Œ ì¢…",dormantText:"ë§Œì§€ë©´ ì†ëì´ ë¬´ê²ë‹¤. ë‹¹ì¥ì—” ì•„ë¬´ ì¼ë„ ì—†ë‹¤.",unlockHint:"ì¡°ê±´: ğŸ¥€ ì•½í™”ë¥¼ ë°›ì€ ìƒíƒœë¡œ í„´ ì¢…ë£Œ 1íšŒ",art:"assets/relics/relic_weak_bell.png",unlock:e=>!!e.run.unlock?.endedTurnWeak,name:"í—ˆì•½ì˜ ì¢…ì†Œë¦¬",text:"ì „íˆ¬ ì‹œì‘ ì‹œ ëª¨ë“  ì ì—ê²Œ ğŸ¥€ ì•½í™” +2",unlockFlavor:"ì™ ì§€ ë“¤ìœ¼ë©´ ë§ˆìŒì´ í‰ì˜¨í•´ì§„ë‹¤.",onCombatStart(e){const t=G(e);for(const n of t)et(n,"weak",2,e,"SYSTEM");t.length&&y(e,"ìœ ë¬¼[í—ˆì•½ì˜ ì¢…ì†Œë¦¬]: ëª¨ë“  ì  ì•½í™” +2")}},relic_return_path_memory:{id:"relic_return_path_memory",dormantName:"ì°¢ì–´ì§„ ì§€ë„ ì¡°ê°",dormantText:"ì½ì„ ìˆ˜ ì—†ëŠ” ê¸¸ì´ ê·¸ë ¤ì ¸ ìˆë‹¤. ê°€ë³´ê³  ì‹¶ë‹¤.",unlockHint:"ì¡°ê±´: ì´ë²¤íŠ¸ 2íšŒ ì„ íƒ",art:"assets/relics/relic_return_path_memory.png",unlock:e=>(e.run.unlock?.eventPicks??0)>=2,name:"ëŒì•„ì˜¨ ê¸¸ì˜ ê¸°ì–µ",text:"ì „íˆ¬ ìŠ¹ë¦¬ ì‹œ HP +3",unlockFlavor:"ì™”ê¸°ì— ê°ˆ ìˆ˜ ì—†ë‹¤.",onVictory(e){nt(e,3),y(e,"ìœ ë¬¼[ëŒì•„ì˜¨ ê¸¸ì˜ ê¸°ì–µ]: ìŠ¹ë¦¬ íšŒë³µ +3")}},relic_wound_vial:{id:"relic_wound_vial",dormantName:"ë°˜ì´ë‚˜ ë‚¨ì€ ë¶‰ì€ ì•¡ì²´",dormantText:"ë§ˆê°œë¥¼ ì—´ì§€ ì•Šì•˜ëŠ”ë°ë„ í”¼ ëƒ„ìƒˆê°€ ë‚œë‹¤.",unlockHint:"ì¡°ê±´: HPê°€ 15 ì´í•˜ë¡œ ë–¨ì–´ì§„ ì  1íšŒ",art:"assets/relics/relic_wound_vial.png",unlock:e=>!!e.run.unlock?.hpLeq15,name:"ìƒì²˜ë¡œ ê¸°ì–´ê°€ëŠ” ì•½ë³‘",text:"ì „íˆ¬ ì‹œì‘ ì‹œ HP +3",unlockFlavor:"ì”¨ì•—ì´ ìˆì—ˆë‚˜?",onCombatStart(e){nt(e,3),y(e,"ìœ ë¬¼[ìƒì²˜ë¡œ ê¸°ì–´ê°€ëŠ” ì•½ë³‘]: ì „íˆ¬ ì‹œì‘ íšŒë³µ +3")}},relic_counting_needle:{id:"relic_counting_needle",dormantName:"ë©ˆì¶˜ ë°”ëŠ˜",dormantText:"ì‹œê³„ì¼ê¹Œ? ì‹œê³„ê°€ ì•„ë‹ê¹Œ? ë‘˜ ë‹¤ ì•„ë‹ˆë‹¤.",unlockHint:"ì¡°ê±´: ì•„ë¬´ í–‰ë™ë„ í•˜ì§€ ì•Šê³  í„´ ì¢…ë£Œ 1íšŒ",art:"assets/relics/relic_counting_needle.png",unlock:e=>!!e.run.unlock?.skippedTurn,name:"ìˆ¨ì„ ì„¸ëŠ” ë°”ëŠ˜",text:"í„´ ì¢…ë£Œ ì‹œ ë‹¤ìŒ í„´ ğŸƒ ë“œë¡œìš° +1",unlockFlavor:"ë°”ëŠ˜ì´ ëˆë‹¤. ì•„ë¬´ê²ƒë„ ì—†ì´.",onUpkeepEnd(e){e._extraDrawNextTurn=Number(e._extraDrawNextTurn??0)+1,y(e,"ìœ ë¬¼[ìˆ¨ì„ ì„¸ëŠ” ë°”ëŠ˜]: ë‹¤ìŒ í„´ ë“œë¡œìš° +1")}},relic_deeper_needle:{id:"relic_deeper_needle",dormantName:"ë¼ˆë¡œ ë§Œë“  ë°”ëŠ˜",dormantText:"ë”°ë”í•¨ì— ìµìˆ™í•œ ì§€ ì˜¤ë˜ë‹¤.",unlockHint:"ì¡°ê±´: ì ì—ê²Œ ğŸ©¸ ì¶œí˜ˆ ë¶€ì—¬ 3íšŒ",art:"assets/relics/relic_deeper_needle.png",unlock:e=>(e.run.unlock?.bleedApplied??0)>=3,name:"ë” ê¹Šì€ ë°”ëŠ˜",text:"ğŸ©¸ ì¶œí˜ˆì„ ë¶€ì—¬í•  ë•Œë§ˆë‹¤ +1 ì¶”ê°€",unlockFlavor:"ë°”ëŠ˜ì´ í”¼ë¥¼ ë¨¹ê³  ê¸¸ì–´ì§„ ê²ƒ ê°™ë‹¤.",onCombatStart(e){e._bleedBonusPerApply=1},onVictory(e){delete e._bleedBonusPerApply}},relic_broken_millstone:{id:"relic_broken_millstone",dormantName:"ê¸ˆ ê°„ ë§·ëŒ",dormantText:"ê°ˆê³  ìˆìœ¼ë©´ ì‹œê°„ ê°€ëŠ” ì¤„ ëª¨ë¥´ê² ë‹¤.",unlockHint:"ì¡°ê±´: ì‹œê°„ 10 í˜ë ¤ë³´ë‚´ê¸°",art:"assets/relics/relic_broken_millstone.png",unlock:e=>{const t=e.run,n=Number(t.timeMove??0)||0,r=Number(e.time??0)||0;return n+r>=10},name:"ê¹¨ì§„ ë§·ëŒ",text:"ë§¤ í„´ ëª¨ë“  ì ì—ê²Œ ğŸ—¡ï¸ 2 í”¼í•´",unlockFlavor:"ëŒì´ ë‹³ëŠ”ë‹¤. ì ë„ ë‹³ëŠ”ë‹¤.",onUpkeepEnd(e){const t=G(e);if(t?.length){for(const n of t){let r=2;const o=Number(n.block??0);if(o>0){const s=Math.min(o,r);n.block=o-s,r-=s}if(r>0){const s=Number(n.hp??0);n.hp=Math.max(0,s-r)}}y(e,"ìœ ë¬¼[ê¹¨ì§„ ë§·ëŒ]: ëª¨ë“  ì ì—ê²Œ 2 í”¼í•´")}}},relic_bloody_spoon:{id:"relic_bloody_spoon",dormantName:"ë¶‰ì€ ìˆŸê°€ë½",dormantText:"ì‡  ëƒ„ìƒˆê°€ ì§„í•˜ë‹¤.",unlockHint:"ì¡°ê±´: ğŸ’¤ F 10 ì´ìƒ",art:"assets/relics/relic_bloody_spoon.png",unlock:e=>e.player.fatigue>9,name:"í”¼ ë¬»ì€ ìˆŸê°€ë½",text:"íšŒë³µ ì‹œ 1 ì¶”ê°€ íšŒë³µ",unlockFlavor:"ì´ëŸ°, í”¼ì˜€ë‹¤."},relic_black_ledger_shard:{id:"relic_black_ledger_shard",dormantName:"ê²€ëŒ• ë¬»ì€ ì¢…ì´",dormantText:"ê²€ì€ ì¢…ì´ë‹¤. íƒ€ê³  ë‚¨ì€ ì¡°ê°ì¼ì§€ë„ ëª¨ë¥´ê² ë‹¤.",unlockHint:"ì¡°ê±´: ğŸŒ¾S = 0",art:"assets/relics/relic_black_ledger_shard.png",unlock:e=>e.player.supplies===0,name:"ê²€ì€ ì¥ë¶€ ì¡°ê°",text:"ğŸŒ¾S = 0ìœ¼ë¡œ í„´ì„ ì¢…ë£Œí•˜ë©´, ğŸŒ¾S +2, ğŸ’¤ F +1",unlockFlavor:"ì¥ë¶€. ë¬´ì—‡ì˜?",onUpkeepEnd(e){const t=G(e);if(t?.length){for(const n of t){let r=2;const o=Number(n.block??0);if(o>0){const s=Math.min(o,r);n.block=o-s,r-=s}if(r>0){const s=Number(n.hp??0);n.hp=Math.max(0,s-r)}}y(e,"ìœ ë¬¼[ê²€ì€ ì¥ë¶€ ì¡°ê°]: S +2, F +1")}}}},to={rest:0,eliteWins:0,tookBigHit10:!1,kills:0,endedTurnWeak:!1,eventPicks:0,hpLeq15:!1,skippedTurn:!1,bleedApplied:0};function Pe(e){e.run.relics??=[];const t=e.run;t.relicRuntime??={},t.pendingRelicActivations??=[],t.unlock??={...to}}function Xn(e){return Pe(e),e.run.relicRuntime}function Gn(e){return Pe(e),e.run.pendingRelicActivations}function xe(e){return Pe(e),e.run.unlock}function at(e,t){const n=Xn(e);if(n[t])return n[t];const o=!Q[t]?.unlock;return n[t]={active:o,pending:!1,obtainedAtNode:e.run.nodePickCount},n[t]}function rn(e,t){return!!at(e,t).active}function no(e,t){const n=e.run;return n.forceLockedRelics?.[t]===!0?!1:!!(n.forceUnlockedRelics?.[t]===!0||n.relicUnlocked?.[t]===!0||Array.isArray(n.unlockedRelics)&&n.unlockedRelics.includes(t)||n.unlockProgress?.relics?.[t]===!0||n.unlocks?.relics?.[t]===!0||(e.run.relics??[]).includes(t))}function yt(e,t){const n=Q[t],r=n?.name??t,o=n?.text??"",a=e.run.relicRuntime?.[t]??null,i=!!n?.unlock,d=no(e,t),c=i&&d&&n?.unlockFlavor?`

${n.unlockFlavor}`:"";if(a?.active===!0&&(!i||d))return{id:t,state:"ACTIVE",name:r,text:`${o}${c}`};const u=a?.pending===!0?"PENDING":"DORMANT";if(i&&!d){const l=n?.dormantName??r,x=[];n?.dormantText&&x.push(n.dormantText),n?.unlockHint&&x.push(n.unlockHint);const w=x.length?x.join(`
`):o;return{id:t,state:u,name:l,text:w}}return{id:t,state:u,name:r,text:`${o}${c}`}}function Ft(e,t){Pe(e),e.run.relics.includes(t)||e.run.relics.push(t);const n=Q[t],r=at(e,t);if(!n?.unlock){r.active=!0,r.pending=!1,y(e,`ìœ ë¬¼ íšë“: ${n?.name??t}`);return}r.active=!1;const o=yt(e,t);y(e,`ìœ ë¬¼ íšë“: ${o.name}`),pe(e)}function ro(e,t){const n=at(e,t);if(n.active||n.pending)return;n.pending=!0;const r=Gn(e);r.includes(t)||r.push(t);const o=Q[t];y(e,`ìœ ë¬¼ ì¡°ê±´ ë‹¬ì„±: ${o?.name??t} (ë‹¤ìŒ ë…¸ë“œë¶€í„° í™œì„±)`)}function pe(e){Pe(e);for(const t of e.run.relics){const n=Q[t];if(!n?.unlock)continue;const r=at(e,t);r.active||r.pending||n.unlock(e)&&ro(e,t)}}function oe(e){Pe(e);const t=Gn(e);if(!t.length)return;e.run.pendingRelicActivations=[];const n=Xn(e);for(const r of t){const o=n[r]??at(e,r);if(!o.pending)continue;o.pending=!1,o.active=!0,o.activatedAtNode=e.run.nodePickCount;const s=Q[r];s?.onActivate?.(e),y(e,`ìœ ë¬¼ í™œì„±í™”: ${s?.name??r}`)}}function oo(e){return Pe(e),e.run.relics??[]}function on(e){return oo(e).filter(t=>rn(e,t))}function it(e,t,...n){for(const r of on(e)){const o=Q[r];if(!o)continue;const s=o[t];s?.(e,...n)}}function ke(e,t){let n=t.current;for(const r of on(e)){const s=Q[r]?.modifyDamage;if(!s)continue;const a=s(e,{...t,current:n});n=Number.isFinite(a)?a:n,n<0&&(n=0)}return n}function Qn(e,t,n){for(const r of on(e))Q[r]?.onDamageApplied?.(e,t,n)}const so={other_adventurer:new Set([1]),slime:new Set([0,1]),pebble_golem:new Set([1]),rock_golem:new Set([1]),poison_spider:new Set([0,2]),boss_cursed_wall:new Set([0]),boss_giant_orc:new Set([1])};function ao(e,t){const n=so[e];return!!n&&n.has(t)}function Wt(e){if(e===null)return"null";const t=typeof e;return t==="number"||t==="boolean"?String(e):t==="string"?JSON.stringify(e):Array.isArray(e)?"["+e.map(Wt).join(",")+"]":t==="object"?"{"+Object.keys(e).sort().map(r=>JSON.stringify(r)+":"+Wt(e[r])).join(",")+"}":JSON.stringify(String(e))}function Jn(e){if(!e)return"NONE";const t={};for(const n of Object.keys(e))n==="label"||n==="text"||n==="desc"||n==="name"||(t[n]=e[n]);return t.effects&&Array.isArray(t.effects)&&(t.effects=t.effects.map(n=>{const r={};for(const o of Object.keys(n??{}))o==="label"||o==="text"||o==="desc"||o==="name"||(r[o]=n[o]);return r})),Wt(t)}function io(e,t){const n=e.lastIntentKey??null,r=e.lastIntentStreak??0;n===t?e.lastIntentStreak=Math.min(3,r+1):(e.lastIntentKey=t,e.lastIntentStreak=1)}function lo(e,t,n,r,o){const s=e.length;if(s<=1)return 0;const a=Array.from({length:s},(l,x)=>x),i=l=>l===t&&ao(n,l),d=l=>!!r&&o>=2&&Jn(e[l])===r,c=a.filter(l=>!i(l)&&!d(l));if(c.length>0)return re(c);const m=a.filter(l=>!d(l));if(m.length>0)return re(m);const u=a.filter(l=>!i(l));return u.length>0?re(u):re(a)}function co(e){return e.deck.length+e.hand.length+e.discard.length+e.frontSlots.filter(Boolean).length+e.backSlots.filter(Boolean).length+e.exhausted.length}function uo(e,t){const n=Math.ceil(t/e.div);let r=e.base+e.per*n;return e.cap!=null&&(r=Math.min(r,e.cap)),{dmg:r,scale:n}}const po=2,fo=.6;function sn(e){if(e.intentsRevealedThisTurn)return;e.intentsRevealedThisTurn=!0,e.attackedEnemyIndicesThisTurn=[],e.backUidsThisTurn=[],e.drawCountThisTurn=0,e.phase="REVEAL",e.player.immuneToDisruptThisTurn=!1,e.player.nullifyDamageThisTurn=!1,e.disruptIndexThisTurn=null,e.backSlotDisabled=[!1,!1,!1],(e.player.status.disrupt??0)>0&&(e.disruptIndexThisTurn=Math.floor(Math.random()*3),e.backSlotDisabled[e.disruptIndexThisTurn]=!0);for(const n of e.enemies)n.immuneThisTurn=n.immuneNextTurn,n.immuneNextTurn=!1;for(const n of G(e)){n.intentLabelOverride=void 0;const o=e.content.enemiesById[n.id].intents;if(!o||o.length===0)continue;const s=lo(o,n.intentIndex??0,n.id,n.lastIntentKey??null,n.lastIntentStreak??0);n.intentIndex=s;const a=o[s%o.length];if(io(n,Jn(a)),n.id==="boss_soul_stealer"){n.soulWillNukeThisTurn=!1;const u=n.soulWarnCount??0;if(!!n.soulArmed){if(Math.random()<fo){n.soulWillNukeThisTurn=!0,n.intentLabelOverride="ì¢…ë§: 50 í”¼í•´",y(e,`ì  ì˜ë„: ${n.name} â†’ ${n.intentLabelOverride}`);continue}const w=o[n.intentIndex%o.length];n.intentLabelOverride=`${w.label} (âš  í­ë°œ ê°€ëŠ¥ ìƒíƒœ)`,y(e,`ì  ì˜ë„: ${n.name} â†’ ${n.intentLabelOverride}`);continue}const x=o[n.intentIndex%o.length];n.intentLabelOverride=`${x.label} (ê²½ê³  ${u}/3)`,y(e,`ì  ì˜ë„: ${n.name} â†’ ${n.intentLabelOverride}`);continue}const i=o[n.intentIndex%o.length];let d=i.label;const c=i.acts.find(u=>u.op==="damagePlayerByDeckSize");if(c&&c.op==="damagePlayerByDeckSize"){const u=co(e),{dmg:l}=uo(c,u);d=`${i.label.split(":")[0].trim()}: ${l} í”¼í•´`}const m=i.acts.find(u=>u.op==="damagePlayerRampHits");if(m&&m.op==="damagePlayerRampHits"){const u=Math.max(1,Number(e.combatTurn??1)),l=Math.max(1,Number(m.baseHits??1)),x=Math.max(1,Number(m.everyTurns??1));let w=l+Math.floor((u-1)/x);m.capHits!=null&&(w=Math.min(w,Math.max(1,Number(m.capHits)))),d=`${i.label.split(":")[0].trim()}: ${m.n} í”¼í•´ (${w}íƒ€)`}n.intentLabelOverride=d,y(e,`ì  ì˜ë„: ${n.name} â†’ ${d}`)}e.disruptIndexThisTurn!==null&&y(e,`êµë€: ì´ë²ˆ í„´ í›„ì—´ ${e.disruptIndexThisTurn} ë¬´íš¨`),it(e,"onReveal"),e.phase="PLACE"}const ho=po;function wn(e,t){const n=e.game,r={kind:"damageSelect",amount:t,sourceCardUid:e.cardUid,reason:e.side==="front"?"FRONT":"BACK"};n.pendingTargetQueue??=[],n.pendingTarget==null?n.pendingTarget=r:n.pendingTargetQueue.push(r),y(n,`ëŒ€ìƒ ì„ íƒ í•„ìš”: ì ì„ í´ë¦­í•˜ì„¸ìš”. (${1+n.pendingTargetQueue.length}ê°œ ë‚¨ìŒ)`)}function mo(e,t,n){const r=e.game,o={kind:"statusSelect",key:t,n,sourceCardUid:e.cardUid,reason:e.side==="front"?"FRONT":"BACK"};r.pendingTargetQueue??=[],r.pendingTarget==null?r.pendingTarget=o:r.pendingTargetQueue.push(o),y(r,"ëŒ€ìƒ ì„ íƒ í•„ìš”: ì ì„ í´ë¦­í•˜ì„¸ìš”.")}function bo(e,t){if(t.id==="boss_soul_stealer"&&t.soulWillNukeThisTurn)return!0;const n=e.content.enemiesById[t.id];return n.intents[t.intentIndex%n.intents.length].acts.some(o=>o.op==="damagePlayer"||o.op==="damagePlayerFormula"||o.op==="damagePlayerByDeckSize")}function tt(e,t){const n=e.game;for(const r of t)switch(r.op){case"block":Yo(n,r.n);break;case"supplies":Xo(n,r.n);break;case"fatigue":Ne(n,r.n);break;case"heal":nt(n,r.n);break;case"hp":n.player.hp=Math.max(0,Math.min(n.player.maxHp,n.player.hp+r.n)),y(n,`HP ${r.n>=0?"+":""}${r.n} (í˜„ì¬ ${n.player.hp}/${n.player.maxHp})`);break;case"maxHp":n.player.maxHp+=r.n,n.player.hp=Math.min(n.player.maxHp,n.player.hp+r.n),y(n,`ìµœëŒ€ HP +${r.n} (í˜„ì¬ ${n.player.hp}/${n.player.maxHp})`);break;case"setSupplies":n.player.supplies=Math.max(0,r.n),y(n,`ë³´ê¸‰ Së¥¼ ${n.player.supplies}ìœ¼ë¡œ ì„¤ì •`);break;case"draw":{const o=dn(n,r.n);n.drawCountThisTurn+=o;break}case"ifDrewThisTurn":{n.drawCountThisTurn>0&&tt(e,r.then);break}case"damageEnemy":if(r.target==="random"){const o=G(n);if(o.length===0)break;Qe(n,re(o),r.n)}else if(r.target==="all")for(const o of G(n))Qe(n,o,r.n);else wn(e,r.n);break;case"clearStatusSelf":{const o=r.key;n.player.status[o]=0,y(n,`ìƒíƒœ í•´ì œ: ${o} = 0`);break}case"damageEnemyBy":{if(r.target!=="random")break;const o=G(n);if(o.length===0)break;let s=0;r.by==="frontCount"&&(s=n.frontSlots.filter(Boolean).length*r.nPer),Qe(n,re(o),s);break}case"damageEnemyByPlayerFatigue":{const o=Math.max(0,Math.floor(n.player.fatigue*r.mult));if(r.target==="random"){const s=G(n);if(s.length===0)break;Qe(n,re(s),o);break}if(r.target==="select"){if(o<=0)break;wn(e,o);break}break}case"statusPlayer":n.player.status[r.key]=Math.max(0,(n.player.status[r.key]??0)+r.n),y(n,`í”Œë ˆì´ì–´ ìƒíƒœ: ${r.key} ${r.n>=0?"+":""}${r.n}`);break;case"statusEnemy":if(r.target==="random"){const o=G(n);if(o.length===0)break;const s=re(o);if(et(s,r.key,r.n,n,"PLAYER"),y(n,`ì (${s.name}) ìƒíƒœ: ${r.key} ${r.n>=0?"+":""}${r.n}`),r.key==="bleed"&&r.n>0){const a=xe(n);a.bleedApplied+=1,pe(n)}}else if(r.target==="all"){const o=G(n);if(o.length===0)break;for(const s of o)et(s,r.key,r.n,n,"PLAYER");if(y(n,`ëª¨ë“  ì  ìƒíƒœ: ${r.key} ${r.n>=0?"+":""}${r.n}`),r.key==="bleed"&&r.n>0){const s=xe(n);s.bleedApplied+=o.length,pe(n)}}else mo(e,r.key,r.n);break;case"statusEnemiesAttackingThisTurn":{const o=G(n).filter(s=>bo(n,s));if(o.length===0){y(n,`ì´ë²ˆ í„´ ê³µê²© ì˜ë„ ì  ì—†ìŒ â†’ ${r.key} ì ìš© ì—†ìŒ`);break}for(const s of o)s.status[r.key]=Math.max(0,(s.status[r.key]??0)+r.n);y(n,`ê³µê²© ì˜ë„ ì ì—ê²Œ ${r.key} ${r.n>=0?"+":""}${r.n} (ëŒ€ìƒ ${o.length})`);break}case"immuneDisruptThisTurn":n.player.immuneToDisruptThisTurn=!0,y(n,"ì´ë²ˆ í„´ êµë€ ë¬´ì‹œ");break;case"nullifyDamageThisTurn":n.player.nullifyDamageThisTurn=!0,y(n,"ì´ë²ˆ í„´ ì  ê³µê²© í”¼í•´ ë¬´íš¨");break;case"triggerFrontOfBackSlot":{const o=n.backSlots[r.index];if(!o){y(n,`ì¬ë°°ì¹˜: í›„ì—´ ${r.index+1}ë²ˆ ìŠ¬ë¡¯ì´ ë¹„ì–´ ìˆìŒ`);break}const s=ge(n,o);y(n,`ì¬ë°°ì¹˜: [[${De(n,o)}]]ì˜ ì „ì—´ íš¨ê³¼ë¥¼ ì¶”ê°€ ë°œë™`),tt({game:n,side:"front",cardUid:o},s.front);break}default:return r}}function yo(e){if(e.run.treasureObtained)return;e.run.treasureObtained=!0,e.run.afterTreasureNodePicks=0,e.run.deckSizeAtTreasure=ar(e);const t=nr(e);e.cards[t]={uid:t,defId:"goal_treasure",zone:"deck",upgrade:0},e.deck.push(t),e.deck=nn(e.deck),y(e,"ì €ì£¼ë°›ì€ ë³´ë¬¼ì„ íšë“í–ˆìŠµë‹ˆë‹¤! ë±ì— [ì €ì£¼ë°›ì€ ë³´ë¬¼] ì¶”ê°€"),xo(e),y(e,"ë³´ë¬¼ì´ ìš¸ë¶€ì§–ì, ë˜ì „ì˜ ëª¨ë“  ë°©ì´ ë‹¤ì‹œ ì±„ì›Œì§‘ë‹ˆë‹¤...")}function xo(e){const t=e.run?.map;if(!t||!t.nodes)return;const n=t.startId,r=t.treasureId,o=Object.keys(t.nodes);for(const s of o){if(s===n||s===r)continue;const a=t.nodes[s];if(!a)continue;a.cleared=!1,delete a.noRespawn,delete a.lastClearedMove,a.reprocCount=Number(a.reprocCount??0)+1;const i=Number(a.depth??0);if(a.kind==="ELITE"||a.kind==="START"||a.kind==="TREASURE")continue;const d=Math.min(.88,.72+i*.01),c=.18,m=Math.random();a.kind=m<d?"BATTLE":m<d+c?"EVENT":"REST"}}const ko=["arrow","shield","scout","field_ration"],Je=[{id:"mad_echo",weight:12},{id:"mad_insight",weight:12},{id:"mad_bargain",weight:3}],je=[{id:"berserk",weight:20},{id:"bandage",weight:12},{id:"arrow_rain",weight:20},{id:"smoke",weight:0},{id:"redeploy",weight:12},{id:"secret_strike",weight:3},{id:"fire_scroll",weight:3},{id:"caltrops",weight:12},{id:"emergency_rations",weight:3},{id:"painkiller",weight:12},{id:"field_experience",weight:3},{id:"camp_prep",weight:20},{id:"vital_shot",weight:12},{id:"taunt",weight:12},{id:"rapid_fire",weight:20},{id:"blood_contract",weight:20},{id:"cloth_scrap_armor",weight:12}];function ut(e,t,n){const r=n?er(t,n):Zn(t);return{defId:Ut(r),upgrade:t===Je?0:Kt(e)}}function pt(e,t,n){const r=n?er(t,n):Zn(t),o=Ut(r),s=r.filter(m=>m.id!==o),a=Ut(s),i=t===Je,d=i?0:Kt(e),c=i?0:Kt(e);return[{defId:o,upgrade:d},{defId:a,upgrade:c}]}function To(e){const{tier:t}=Vn(e);return Math.random()<(t===0?0:t===1?.15:t===2?.35:.6)}function Zn(e){const t=new Map;for(const n of e){const r=Math.max(0,n.weight??0);r<=0||t.set(n.id,(t.get(n.id)??0)+r)}return[...t.entries()].map(([n,r])=>({id:n,w:r}))}function er(e,t={}){const n=t.mult3??1,r=t.mult12??1,o=t.mult20??1,s=new Map;for(const a of e){const i=Math.max(0,a.weight??0);if(i<=0||i===3&&t.drop3||i===12&&t.drop12||i===20&&t.drop20)continue;let d=null;i===3?d=i*n:i===12?d=i*r:i===20?d=i*o:d=i,!(d<=0)&&s.set(a.id,(s.get(a.id)??0)+d)}return[...s.entries()].map(([a,i])=>({id:a,w:i}))}function Ut(e){let t=0;for(const r of e)t+=r.w;if(t<=0)throw new Error("No positive weights to pick from.");let n=Math.random()*t;for(const r of e)if(n-=r.w,n<=0)return r.id;return e[e.length-1].id}function Kt(e){const t=e?.player?.fatigue??0;if((e?.run.nodePickCount??999)<=6)return 0;const r=.1,o=t>=12?0:t>=9?.25:t>=6?.5:1;return Math.random()<r*o?1:0}function tr(e){const t=e.player?.fatigue??0,n={defId:re(ko),upgrade:0},r=()=>t<=3?pt(e,je):t<=6?pt(e,je,{mult3:.25,mult12:.75,mult20:1}):t<=8?pt(e,je,{mult3:.1,mult12:.55,mult20:1}):pt(e,je,{drop3:!0,mult12:.45,mult20:1}),o=i=>To(e)?ut(e,Je):i;if(t<=8){if(t<=6){const[m,u]=r();return[o(m),o(u)]}const i=t===7?.3:.55;if(Math.random()<i){const[m]=r(),u=o(m);return Math.random()<.5?[n,u]:[u,n]}const[d,c]=r();return[o(d),o(c)]}if(t<=11){const i=o(ut(e,je,{drop3:!0,mult12:.45,mult20:1}));return Math.random()<.5?[n,i]:[i,n]}const s=ut(e,Je),a=Math.random()<.65?ut(e,Je):n;return Math.random()<.5?[s,a]:[a,s]}function go(e){const t=tr(e),n=t[0]??{defId:"arrow",upgrade:0},r=t[1]??{defId:"shield",upgrade:0};return[n,r]}function nr(e){return e.uidSeq+=1,`c_${e.uidSeq}`}function an(e,t,n){const r=nr(e);e.cards[r]={uid:r,defId:t,zone:"deck",upgrade:n?.upgrade??0},e.deck.push(r)}function Eo(e){const t=Object.values(e.cards).filter(r=>r.zone==="deck"||r.zone==="hand"||r.zone==="discard");if(t.length===0)return;const n=re(t);e.cards[n.uid].zone="vanished",e.vanished.push(n.uid),e.deck=e.deck.filter(r=>r!==n.uid),e.hand=e.hand.filter(r=>r!==n.uid),e.discard=e.discard.filter(r=>r!==n.uid),y(e,`ì¹´ë“œ ì œê±°: [${ge(e,n.uid).name} +${e.cards[n.uid].upgrade??0}]`)}const Co="goal_treasure";function wt(e,t){const n=e.cards[t];return n?n.defId===Co?(y(e,"ì €ì£¼ë°›ì€ ë³´ë¬¼ì€ ë±ì—ì„œ ì œê±°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."),!1):(e.deck=e.deck.filter(r=>r!==t),e.hand=e.hand.filter(r=>r!==t),e.discard=e.discard.filter(r=>r!==t),e.frontSlots=e.frontSlots.map(r=>r===t?null:r),e.backSlots=e.backSlots.map(r=>r===t?null:r),n.zone="vanished",e.vanished.push(t),y(e,`ì¹´ë“œ ì œê±°: [${ge(e,n.uid).name} +${e.cards[n.uid].upgrade??0}]`),!0):!1}function ln(e,t){const n=e.cards[t];if(!n)return!1;const o=e.content.cardsById[n.defId].upgrades?.length??0;return(n.upgrade??0)<o}function rr(e,t){return ln(e,t)?(e.cards[t].upgrade=(e.cards[t].upgrade??0)+1,!0):!1}function cn(e,t,n=null){if(e.choiceQueue??=[],!e.choice){e.choice=t,e.choiceCtx=n;return}e.choiceQueue.push({choice:t,ctx:n})}function zt(e,t,n=null){e.choiceQueue=[],e.choice=t,e.choiceCtx=n}function or(e){e.choice=null,e.choiceCtx=null}function de(e){e.choiceQueue=[],or(e),e.phase==="NODE"&&oe(e)}function Se(e){const t=e.choiceQueue??[];if(t.length>0){const n=t.shift()??null;if(n){e.choice=n.choice,e.choiceCtx=n.ctx,e.choiceQueue=t;return}}or(e),e.phase==="NODE"&&oe(e)}function vo(e){const t=new Set(e.run.relics??[]);return Object.keys(Q).filter(n=>{const r=Q[n];return!(!r||r.debugOnly||t.has(n))})}function sr(e,t=1){const n=vo(e);if(n.length===0)return null;const r=[],o=n.slice(),s=Math.min(t,o.length);for(let a=0;a<s;a++){const i=re(o),d=o.indexOf(i);d>=0&&o.splice(d,1);const c=Q[i]??{};r.push({id:i,name:c.name??String(i),desc:c.desc??c.description??c.text,art:c.art})}return{choices:r}}function So(e){const t=go(e);if(!t)return;const[n,r]=t,o=ye(e.content,n.defId,n.upgrade),s=ye(e.content,r.defId,r.upgrade),a=`${o.name}${n.upgrade>0?` +${n.upgrade}`:""}`,i=`${s.name}${r.upgrade>0?` +${r.upgrade}`:""}`,d={kind:"REWARD",title:"ì „íˆ¬ ë³´ìƒ",prompt:"ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ê±°ë‚˜ ìƒëµí•©ë‹ˆë‹¤.",options:[{key:`pick:${n.defId}:${n.upgrade}`,label:a,detail:`ì „ì—´: ${o.frontText} / í›„ì—´: ${o.backText}`},{key:`pick:${r.defId}:${r.upgrade}`,label:i,detail:`ì „ì—´: ${s.frontText} / í›„ì—´: ${s.backText}`},{key:"skip",label:"ìƒëµ",detail:""}]};cn(e,d,{kind:"BATTLE_CARD_REWARD",offers:[n,r]})}function wo(e){if(!e.run.lastBattleWasElite||e.run.eliteRelicOfferedThisBattle)return;const t=sr(e,1);if(!t)return;e.run.eliteRelicOfferedThisBattle=!0;const n=t.choices[0];if(!n)return;const r=n.id,o=Q[r],s=!!o?.unlock,a=s?o?.dormantName??o?.name??r:o?.name??r,i=s?[o?.dormantText,o?.unlockHint].filter(Boolean).join(`
`):o?.text??"",c={kind:"REWARD",title:"ì •ì˜ˆ ë³´ìƒ: ìœ ë¬¼",prompt:"ìœ ë¬¼ì„ ë°›ê±°ë‚˜ ìƒëµí•©ë‹ˆë‹¤.",options:[{key:"take",label:"ë°›ê¸°",detail:`${a}

${i}`},{key:"skip",label:"ìƒëµ",detail:""}]};c.art=o?.art??void 0,cn(e,c,{kind:"ELITE_RELIC",offerIds:[r]})}function _o(e,t){if(!e.choice)return!1;if(t==="take"){if(e.choiceCtx?.kind!=="ELITE_RELIC")return!1;const r=e.choiceCtx.offerIds?.[0];return r?(e.run.relics??=[],e.run.relics.includes(r)||Ft(e,r),y(e,`ìœ ë¬¼ íšë“: ${Q[r]?.name??r}`),Se(e),!0):!1}if(t==="skip")return y(e,"ë³´ìƒì„ ìƒëµí–ˆìŠµë‹ˆë‹¤."),Se(e),!0;if(t.startsWith("pick:")){const r=t.split(":"),o=r[1]??"",s=Number(r[2]??0);return o?(an(e,o,{upgrade:Number.isFinite(s)?s:0}),y(e,`ì¹´ë“œ íšë“: ${o}${s>0?` +${s}`:""}`),Se(e),!0):!1}if(t.startsWith("up:")){const r=t.slice(3);if(!r)return!1;const o=e.cards[r];if(!o)return!1;const a=e.content.cardsById[o.defId]?.upgrades??[],i=o.upgrade??0;if(i>=a.length)return y(e,"ì´ë¯¸ ìµœëŒ€ ê°•í™”ì…ë‹ˆë‹¤."),Se(e),!0;o.upgrade=i+1;const d=ye(e.content,o.defId,o.upgrade);return y(e,`ì¹´ë“œ ê°•í™”: ${d.name} +${o.upgrade}`),Se(e),!0}if(t.startsWith("remove:")){const r=t.slice(7);return!r||!wt(e,r)?!1:(Se(e),!0)}if(t.startsWith("relic:")){const r=t.slice(6);if(!r)return!1;const o=e.choiceCtx?.offerIds;return o&&o.length>0&&!o.includes(r)?!1:(e.run.relics??=[],e.run.relics.includes(r)||Ft(e,r),y(e,`ìœ ë¬¼ íšë“: ${Q[r]?.name??r}`),Se(e),!0)}return!1}function $o(e,t){const n=sr(e,t.count);if(!n||n.choices.length===0)return null;const r=n.choices.map(a=>a.id),o=n.choices.map(a=>{const i=Q[a.id],d=!!i?.unlock,c=d?i?.dormantName??i?.name??a.id:i?.name??a.id,m=d?[i?.dormantText,i?.unlockHint].filter(Boolean).join(`
`):i?.text??"";return{key:`relic:${a.id}`,label:c,detail:`${c}

${m}`}}),s={kind:"REWARD",title:t.title,prompt:t.prompt,options:o};return cn(e,s,{kind:"RELIC_OFFER",offerIds:r,source:t.source}),r}function Mo(e){return $o(e,{count:3,title:"ë³´ìŠ¤ ë³´ìƒ: ìœ ë¬¼",prompt:"ìœ ë¬¼ 1ê°œë¥¼ ì„ íƒí•©ë‹ˆë‹¤.",source:"BOSS"})}function No(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}function Po(e){const t=[];for(const s of e.deck)t.push(s);for(const s of e.hand)t.push(s);for(const s of e.discard)t.push(s);for(const s of e.frontSlots)s&&t.push(s);for(const s of e.backSlots)s&&t.push(s);for(const s of e.exhausted)t.push(s);const n=new Set,o=t.filter(s=>n.has(s)?!1:(n.add(s),!0)).filter(s=>e.cards[s]?.zone!=="vanished");e.deck=o;for(const s of o)e.cards[s].zone="deck";e.hand=[],e.discard=[],e.frontSlots=[null,null,null],e.backSlots=[null,null,null],e.selectedHandCardUid=null,e.exhausted=[],e.pendingTarget=null,e.pendingTargetQueue=[],No(e.deck)}function Ao(e){if(!e.winHooksAppliedThisCombat){e.winHooksAppliedThisCombat=!0;for(const t of e.backUidsThisTurn){if(!e.cards[t])continue;const o=ge(e,t).onWinWhileInBack;!o||o.length===0||tt({game:e,side:"back",cardUid:t},o)}}}function Ro(e){const t=e.run.deckSizeAtTreasure??null;return t==null?10:Jr(t)}function Ue(e){if(e.player.hp<=0){Pn(e),e.run.finished=!0,y(e,"íŒ¨ë°°: ì£½ì—ˆìŠµë‹ˆë‹¤.");return}if(!e.victoryResolvedThisCombat&&G(e).length===0&&e.phase!=="NODE"){e.victoryResolvedThisCombat=!0;const t=e.enemies.some(n=>String(n.id).startsWith("boss_"));Pn(e),Ao(e),y(e,"ì ì„ ëª¨ë‘ ì²˜ì¹˜!");{const n=e.run.map;n&&n.nodes&&n.pos&&n.nodes[n.pos]&&(n.nodes[n.pos].cleared=!0,n.nodes[n.pos].visited=!0)}if(e.run.lastBattleWasElite){const n=xe(e);n.eliteWins+=1,pe(e)}if(Po(e),e.enemies=[],e.player.zeroSupplyTurns=0,it(e,"onVictory"),t&&(e.player.hp=e.player.maxHp,y(e,"ë³´ìŠ¤ ê²©íŒŒ! ì²´ë ¥ì´ ì™„ì „íˆ íšŒë³µë˜ì—ˆìŠµë‹ˆë‹¤."),Mo(e)),wo(e),So(e),e.phase="NODE",e.run.treasureObtained){const n=Ro(e);if(e.run.afterTreasureNodePicks>=n){e.run.finished=!0,y(e,`ìŠ¹ë¦¬! ì €ì£¼ë°›ì€ ë³´ë¬¼ì„ ì–»ì€ í›„ ${n}ë²ˆì˜ íƒí—˜ ë™ì•ˆ ì‚´ì•„ë‚¨ì•˜ìŠµë‹ˆë‹¤.`);return}}return}}function ar(e){return e.deck.length+e.hand.length+e.discard.length+e.frontSlots.filter(Boolean).length+e.backSlots.filter(Boolean).length+e.exhausted.length}function qe(e){e.combatTurn=1,e.time=(e.time??0)+1,y(e,"ì „íˆ¬: ì‹œê°„ +1"),e.player.block=0,e.player.status.vuln=0,e.player.status.weak=0,e.player.status.bleed=0,e.player.status.disrupt=0,e.player.zeroSupplyTurns=0,e.phase="REVEAL",e.frontSlots=[null,null,null],e.backSlots=[null,null,null],e.backSlotDisabled=[!1,!1,!1],e.backUidsThisTurn=[],e.hand=[],e.selectedHandCardUid=null,e.pendingTarget=null,e.pendingTargetQueue=[],e.usedThisTurn=0,e.frontPlacedThisTurn=0,e.winHooksAppliedThisCombat=!1,e.victoryResolvedThisCombat=!1,e.run.eliteRelicOfferedThisBattle=!1;const t=e.run.nextBattleSuppliesBonus??0;e.player.supplies=7+t,t!==0&&(y(e,`ë‹¤ìŒ ì „íˆ¬ ë³´ë„ˆìŠ¤ ì ìš©: S +${t}`),e.run.nextBattleSuppliesBonus=0),e.player.immuneToDisruptThisTurn=!1,e.player.nullifyDamageThisTurn=!1,e.intentsRevealedThisTurn=!1,e.disruptIndexThisTurn=null,e.drawCountThisTurn=0,e.attackedEnemyIndicesThisTurn=[],dn(e,4),sn(e),e.phase="PLACE",it(e,"onCombatStart")}function _n(e,t,n,r){if(e.phase!=="PLACE"||!e.hand.includes(t))return;n==="back"&&(e.backUidsThisTurn.includes(t)||e.backUidsThisTurn.push(t));const o=n==="front"?e.frontSlots:e.backSlots;o[r]||(e.hand=e.hand.filter(s=>s!==t),o[r]=t,e.cards[t].zone=n,e.usedThisTurn+=1,n==="front"&&(e.frontPlacedThisTurn+=1),y(e,`[${De(e,t)}]ë¥¼ ${n==="front"?"ì „ì—´":"í›„ì—´"} ${r}ë²ˆì— ë°°ì¹˜`),it(e,"onPlaceCard",{side:n,idx:r,cardUid:t}))}function $n(e,t,n){return ge(e,t).tags?.includes(n)??!1}function Io(e,t){e.frontSlots=e.frontSlots.map(n=>n===t?null:n),e.backSlots=e.backSlots.map(n=>n===t?null:n)}function Mn(e,t,n){const r=ge(e,t);Io(e,t),e.hand=e.hand.filter(d=>d!==t),e.deck=e.deck.filter(d=>d!==t),e.discard=e.discard.filter(d=>d!==t);const o=r.vanishWhen,s=r.exhaustWhen,a=o==="BOTH"||o==="FRONT"&&n==="front"||o==="BACK"&&n==="back",i=s==="BOTH"||s==="FRONT"&&n==="front"||s==="BACK"&&n==="back";if(o&&o!=="NONE"&&a){e.vanished.push(t),e.cards[t].zone="vanished",y(e,`[${De(e,t)}] ì†Œì‹¤(ì˜êµ¬ ì œê±°)`);return}if(s&&s!=="NONE"&&i){e.exhausted.push(t),e.cards[t].zone="exhausted",y(e,`[${De(e,t)}] ì†Œëª¨(ì´ë²ˆ ì „íˆ¬ì—ì„œ ì œê±°)`);return}if(!o&&$n(e,t,"VANISH")){e.vanished.push(t),e.cards[t].zone="vanished",y(e,`[${De(e,t)}] ì†Œì‹¤(ì˜êµ¬ ì œê±°)`);return}if(!s&&$n(e,t,"EXHAUST")){e.exhausted.push(t),e.cards[t].zone="exhausted",y(e,`[${De(e,t)}] ì†Œëª¨(ì´ë²ˆ ì „íˆ¬ì—ì„œ ì œê±°)`);return}e.discard.push(t),e.cards[t].zone="discard"}function Lo(e){for(let t=0;t<3;t++){const n=e.frontSlots[t];n&&Mn(e,n,"front"),e.frontSlots[t]=null;const r=e.backSlots[t];r&&Mn(e,r,"back"),e.backSlots[t]=null}}function Ho(e){if(!(e.phase!=="PLACE"&&e.phase!=="BACK")){e.phase="BACK",y(e,"=== í›„ì—´ ë‹¨ê³„ ===");for(let t=0;t<3;t++){const n=e.backSlots[t];if(!n)continue;const r=ge(e,n);if(!e.player.immuneToDisruptThisTurn&&e.backSlotDisabled[t]){y(e,`í›„ì—´ ${t}ë²ˆ [${r.name}] êµë€ìœ¼ë¡œ ë¬´íš¨`);continue}tt({game:e,side:"back",cardUid:n},r.back)}e.phase="FRONT"}}function Do(e){if(e.phase==="FRONT"){y(e,"=== ì „ì—´ ë‹¨ê³„ ===");for(let t=0;t<3;t++){const n=e.frontSlots[t];if(!n)continue;const r=ge(e,n);tt({game:e,side:"front",cardUid:n},r.front)}e.phase="ENEMY"}}const Bo=.6;function Oo(e){if(e.phase==="ENEMY"){y(e,"=== ì  í–‰ë™ ===");for(const t of G(e)){const n=e.content.enemiesById[t.id],r=n.intents[t.intentIndex%n.intents.length];if(t.id==="boss_soul_stealer"){if(t.soulWillNukeThisTurn){const o=t.status.weak??0;Te(e,50,"ENEMY_ATTACK","ì˜í˜¼ ê°•íƒˆì",o),y(e,"ì˜í˜¼ ê°•íƒˆì: ì˜í˜¼ í­ë°œ â†’ 50 í”¼í•´!"),t.soulWillNukeThisTurn=!1,t.soulArmed=!1,t.soulWarnCount=0;continue}for(const o of r.acts)Nn(e,t,o);t.intentIndex===ho&&(t.soulWarnCount=(t.soulWarnCount??0)+1,y(e,`ì˜í˜¼ ê°•íƒˆì: ê²½ê³  +1 (${t.soulWarnCount}/3)`),(t.soulWarnCount??0)>=3&&(t.soulArmed=!0,y(e,"ì˜í˜¼ ê°•íƒˆì: ê²½ê³  3íšŒ ì™„ë£Œ â†’ í­ë°œ ê°€ëŠ¥ ìƒíƒœ!"),Math.random()<Bo&&(t.soulWillNukeThisTurn=!0)));continue}for(const o of r.acts)Nn(e,t,o)}e.phase="UPKEEP"}}function Fo(e){return e.deck.length+e.hand.length+e.discard.length+e.frontSlots.filter(Boolean).length+e.backSlots.filter(Boolean).length+e.exhausted.length}function Wo(e,t){const n=Math.ceil(t/e.div);let r=e.base+e.per*n;return e.cap!=null&&(r=Math.min(r,e.cap)),{dmg:r,scale:n}}function Nn(e,t,n){switch(n.op){case"damagePlayer":{const r=t.status.weak??0;Te(e,n.n,"ENEMY_ATTACK",t.name,r);return}case"damagePlayerFormula":{if(n.kind==="goblin_raider"){const r=Math.max(0,12-e.usedThisTurn),o=t.status.weak??0;Te(e,r,"ENEMY_ATTACK",t.name,o)}else if(n.kind==="gloved_hunter"){const o=(e.player.block??0)>=4?12:6,s=t.status.weak??0;Te(e,o,"ENEMY_ATTACK",t.name,s)}else{const r=4+e.usedThisTurn,o=t.status.weak??0;Te(e,r,"ENEMY_ATTACK",t.name,o)}return}case"supplies":{e.player.supplies=tn(e.player.supplies+n.n,0),y(e,`ì  íš¨ê³¼: ë³´ê¸‰ S ${n.n>=0?"+":""}${n.n} (í˜„ì¬ ${e.player.supplies})`);return}case"statusPlayer":{et(e.player,n.key,n.n,e,"ENEMY"),y(e,`ì  íš¨ê³¼: í”Œë ˆì´ì–´ ìƒíƒœ ${n.key} ${n.n>=0?"+":""}${n.n}`);return}case"enemyHealSelf":{t.hp=Math.min(t.maxHp,t.hp+n.n),y(e,`ì (${t.name})ì´(ê°€) ${n.n} íšŒë³µ (HP ${t.hp}/${t.maxHp})`);return}case"enemyImmuneThisTurn":{t.immuneThisTurn=!0,y(e,`ì (${t.name})ì´(ê°€) í”¼í•´ ë©´ì—­ ìƒíƒœê°€ ë¨`);return}case"enemyImmuneNextTurn":{t.immuneNextTurn=!0,y(e,`ì (${t.name})ì´(ê°€) ë‹¤ìŒ í„´ í”¼í•´ ë©´ì—­ ìƒíƒœê°€ ë¨`);return}case"fatiguePlayer":{e.player.fatigue=Math.max(0,e.player.fatigue+n.n),y(e,`ì  íš¨ê³¼: í”¼ë¡œ F ${n.n>=0?"+":""}${n.n} (í˜„ì¬ ${e.player.fatigue})`);return}case"damagePlayerByDeckSize":{const r=Fo(e),{dmg:o,scale:s}=Wo(n,r);Te(e,o,"ENEMY_ATTACK",t.name),y(e,`ì¤‘ë ¥ í”¼í•´: base ${n.base} + per ${n.per} * ceil(${r}/${n.div})=${s} => ${o}`);return}case"damagePlayerRampHits":{const r=Math.max(1,Number(e.combatTurn??1)),o=Math.max(1,Number(n.baseHits??1)),s=Math.max(1,Number(n.everyTurns??1));let a=o+Math.floor((r-1)/s);n.capHits!=null&&(a=Math.min(a,Math.max(1,Number(n.capHits))));const i=t.status.weak??0,d=`${t.name} (${a}íƒ€)`;for(let c=0;c<a;c++)Te(e,n.n,"ENEMY_ATTACK",d,i);return}default:return n}}function Uo(e){if(e.phase!=="UPKEEP")return;y(e,"=== ìœ ì§€ë¹„ / ìƒíƒœ ì²˜ë¦¬ ===");{const o=xe(e);let s=!1;(e.player.status.weak??0)>0&&!o.endedTurnWeak&&(o.endedTurnWeak=!0,s=!0),(e.usedThisTurn??0)===0&&(e.frontPlacedThisTurn??0)===0&&(e.backUidsThisTurn?.length??0)===0&&!o.skippedTurn&&(o.skippedTurn=!0,s=!0),s&&pe(e)}const t=e.frontPlacedThisTurn;t>0&&y(e,`ì „ì—´ ìœ ì§€ë¹„ ì²˜ë¦¬: ì „ì—´ ${t}ì¥`);let n=!1;for(let o=0;o<t;o++)e.player.supplies>0?e.player.supplies-=1:n=!0;if(n&&(e.player.fatigue+=1,y(e,"ì „ì—´ ìœ ì§€ë¹„ ë¶€ì¡±! (F +1)")),e.player.supplies===0){e.player.zeroSupplyTurns+=1;const o=e.player.fatigue;Te(e,o,"ZERO_SUPPLY",`ë³´ê¸‰ ì—†ì´ í„´ ì¢…ë£Œ! í”¼í•´ ${o}`)}const r=e.player.status.bleed??0;r>0&&Te(e,r,"BLEED","ì¶œí˜ˆ");for(const o of G(e)){const s=o.status.bleed??0;s>0&&(o.immuneThisTurn?y(e,`ì (${o.name})ì€(ëŠ”) ì´ë²ˆ í„´ ë©´ì—­ì´ë¼ ì¶œí˜ˆ í”¼í•´ ë¬´ì‹œ`):(o.hp=Math.max(0,o.hp-s),y(e,`ì (${o.name}) ì¶œí˜ˆë¡œ HP -${s} (HP ${o.hp}/${o.maxHp})`)))}e.frontPlacedThisTurn=0,Ko(e),Lo(e),Be(e),Ue(e),it(e,"onUpkeepEnd"),e.phase="DRAW"}function Ko(e){const t=["vuln","weak","bleed","disrupt"];for(const n of t)e.player.status[n]>0&&(e.player.status[n]-=1);for(const n of e.enemies)for(const r of t)n.status[r]>0&&(n.status[r]-=1)}function zo(e){if(e.phase!=="DRAW"||(e.intentsRevealedThisTurn=!1,e.disruptIndexThisTurn=null,Ue(e),e.run.finished))return;if(G(e).length===0){ir(e),e.phase="NODE";return}const t=e.usedThisTurn;e.usedThisTurn=0;const n=Number(e._extraDrawNextTurn??0);e._extraDrawNextTurn=0,dn(e,t+(n>0?n:0)),e.player.block>0&&(e.player.block=0,y(e,"ë°©ì–´(ë¸”ë¡) ì†Œì‹¤")),sn(e),e.phase="PLACE",e.backUidsThisTurn=[],e.attackedEnemyIndicesThisTurn=[],e.drawCountThisTurn=0,e.combatTurn=(e.combatTurn??0)+1,G(e).length>0&&e.player.supplies===0&&rn(e,"relic_black_ledger_shard")&&(e.player.supplies+=2,e.player.fatigue+=1)}function dn(e,t){let n=0;for(let r=0;r<t&&(jo(e),!e.run.finished);r++){const o=e.deck.pop();if(!o)break;e.hand.push(o),n++}return y(e,`ë“œë¡œìš° ${n}/${t} (ì†íŒ¨ ${e.hand.length})`),n}function jo(e){e.deck.length===0&&e.discard.length>0&&(e.deck=nn(e.discard),e.discard=[],e.player.fatigue+=1,y(e,`í”¼ë¡œë„ F +1 (ì…”í”Œ, í˜„ì¬ ${e.player.fatigue})`))}function ir(e){e.player.block>0&&(e.player.block=0,y(e,"ë°©ì–´(ë¸”ë¡) ì†Œì‹¤")),e.intentsRevealedThisTurn=!1,e.disruptIndexThisTurn=null}function Pn(e){ir(e)}function Z(e){return e.pendingTarget!=null||(e.pendingTargetQueue?.length??0)>0}function qo(e,t){if(!e.pendingTarget)return!1;if(G(e).length===0)return e.pendingTarget=null,e.pendingTargetQueue=[],e.selectedEnemyIndex=null,Ue(e),!0;const n=e.enemies[t];if(!n||n.hp<=0)return!1;const r=e.pendingTarget;if(r.kind==="damageSelect")Qe(e,n,r.amount);else if(r.kind==="statusSelect"&&(et(n,r.key,r.n,e,"PLAYER"),r.key==="bleed"&&r.n>0)){const o=xe(e);o.bleedApplied+=1,pe(e)}return Be(e),Ue(e),G(e).length===0?!0:(Vo(e),!e.pendingTarget&&(e.pendingTargetQueue?.length??0)===0)}function Vo(e){const t=e.pendingTargetQueue??[],n=t.shift()??null;e.pendingTarget=n,e.pendingTargetQueue=t,e.selectedEnemyIndex=null}function Yo(e,t){t<=0||(e.player.block+=t,y(e,`ë°©ì–´(ë¸”ë¡) +${t} (í˜„ì¬ ${e.player.block})`))}function Xo(e,t){e.player.supplies=tn(e.player.supplies+t,0),y(e,`ë³´ê¸‰ S ${t>=0?"+":""}${t} (í˜„ì¬ ${e.player.supplies})`)}function Ne(e,t){e.player.fatigue=tn(e.player.fatigue+t,0),y(e,`í”¼ë¡œ F ${t>=0?"+":""}${t} (í˜„ì¬ ${e.player.fatigue})`)}function nt(e,t){if(t<=0)return;let n=t;rn(e,"relic_bloody_spoon")&&n>0&&(n+=1,y(e,"í”¼ ë¬»ì€ ìˆŸê°€ë½, ì¶”ê°€ íšŒë³µ +1"));const r=e.player.hp;e.player.hp=Math.min(e.player.maxHp,e.player.hp+n),y(e,`HP +${e.player.hp-r} (í˜„ì¬ ${e.player.hp}/${e.player.maxHp})`)}function Be(e){G(e).length===0&&(e.pendingTarget=null,e.pendingTargetQueue=[],e.selectedEnemyIndex=null)}function Qe(e,t,n){if(n<=0)return;const r=e.enemies.indexOf(t);if(r<0){y(e,`WARN: applyDamageToEnemy target not in g.enemies (${t?.id??"?"})`);return}if(e.attackedEnemyIndicesThisTurn.includes(r)||e.attackedEnemyIndicesThisTurn.push(r),t.immuneThisTurn){y(e,`ì (${t.name})ì€(ëŠ”) ì´ë²ˆ í„´ í”¼í•´ ë©´ì—­ â†’ ${n} í”¼í•´ ë¬´ì‹œ`),Be(e);return}let o={target:"ENEMY",source:"PLAYER_ATTACK",raw:n,enemyIndex:r,enemyId:t.id},s=ke(e,{...o,phase:"PRE_STATUS",current:n,targetVuln:t.status.vuln??0,attackerWeak:e.player.status.weak??0});const a=e.player.status.weak??0,i=t.status.vuln??0;if(s=s-a+i,s<0&&(s=0),s=ke(e,{...o,phase:"POST_STATUS",current:s,afterStatus:s,targetVuln:i,attackerWeak:a}),s=ke(e,{...o,phase:"FINAL",current:s,afterStatus:s,targetVuln:i,attackerWeak:a}),s<=0){y(e,`ì (${t.name})ì—ê²Œ í”¼í•´ 0 (ìœ ë¬¼/ìƒíƒœë¡œ ìƒì‡„)`),Be(e);return}const d=t.hp;if(t.hp=Math.max(0,t.hp-s),y(e,`ì (${t.name})ì—ê²Œ ${s} í”¼í•´. (HP ${t.hp}/${t.maxHp})`),d>0&&t.hp===0){const c=xe(e);c.kills+=1,pe(e)}Qn(e,{...o,phase:"FINAL",current:s,afterStatus:s,targetVuln:i,attackerWeak:a},s),Be(e),G(e).length===0&&(Be(e),Ue(e))}function Te(e,t,n,r,o){if(n==="ENEMY_ATTACK"&&e.player.nullifyDamageThisTurn)return y(e,`ì  ê³µê²© í”¼í•´ ë¬´íš¨ (${r??n})`),0;if(t<=0)return 0;const a={target:"PLAYER",source:n==="ENEMY_ATTACK"?"ENEMY_ATTACK":n==="FATIGUE"?"FATIGUE":"OTHER",raw:t,reason:r};let i=ke(e,{...a,phase:"PRE_STATUS",current:t,attackerWeak:o,targetVuln:e.player.status.vuln??0});if(n==="ENEMY_ATTACK"){const d=o??0,c=e.player.status.vuln??0;if(i=i-d+c,i<0&&(i=0),i=ke(e,{...a,phase:"POST_STATUS",current:i,afterStatus:i,attackerWeak:d,targetVuln:c}),i=ke(e,{...a,phase:"PRE_BLOCK",current:i,afterStatus:i,attackerWeak:d,targetVuln:c}),e.player.block>0){const m=Math.min(e.player.block,i);e.player.block-=m,i-=m}i=ke(e,{...a,phase:"POST_BLOCK",current:i,afterStatus:i,afterBlock:i,attackerWeak:d,targetVuln:c})}else i=ke(e,{...a,phase:"POST_STATUS",current:i,afterStatus:i});if(i=ke(e,{...a,phase:"FINAL",current:i}),i<=0)return 0;e.player.hp=Math.max(0,e.player.hp-i),y(e,`í”Œë ˆì´ì–´ ${i} í”¼í•´ (${r??n}). (HP ${e.player.hp}/${e.player.maxHp})`);{const d=xe(e);let c=!1;i>=10&&!d.tookBigHit10&&(d.tookBigHit10=!0,c=!0),e.player.hp<=15&&!d.hpLeq15&&(d.hpLeq15=!0,c=!0),c&&pe(e)}return Qn(e,{...a,phase:"FINAL",current:i},i),i}function Go(){return jt[Math.floor(Math.random()*jt.length)]}function An(e){const{tier:t}=Vn(e),n=t===0?0:t===1?.25:t===2?.55:.85;return Math.random()<n?Qo():Go()}const lr={boss_cursed_wall:"ì›€ì§ì´ì§€ ì•ŠëŠ”ë‹¤. ë‹¹ì‹ ì´ ë‹³ì•„ê°„ë‹¤.",boss_giant_orc:"ê±°ëŒ€í•œ ë¬´ì–¸ê°€ê°€ ê¸°ë‹¤ë¦°ë‹¤.",boss_soul_stealer:"í–‰ë™í•˜ì§€ ì•Šìœ¼ë©´ ì¢…ë§ì´ ì˜¨ë‹¤.",boss_gravity_master:"ëª¸ì´ ì ì  ë¬´ê²ë‹¤. ëª¸ì„ ê°€ë³ê²Œ í•˜ë¼."},Ce="/deck-rogue-prototype/",Rn=[{id:"mad_mirror",name:"ê±°ìš¸ì— ì ê¸´ ë¬¼",prompt:"ë¬¼ ì†ì˜ ë‹¹ì‹ ì´ ë¨¼ì € ì›ƒìŠµë‹ˆë‹¤.",art:`${Ce}assets/events/event_mad_mirror.png`,options:e=>[{key:"mad_mirror:take",label:"ì†ì„ ë„£ëŠ”ë‹¤",detail:"ì¹´ë“œ ë³´ìƒ. F +2.",apply:t=>(Ne(t,2),y(t,"ê±°ìš¸: ë¬´ì–¸ê°€ë¥¼ ê±´ì ¸ ì˜¬ë ¸ë‹¤. (F +2)"),"REWARD")},{key:"mad_mirror:leave",label:"ì™¸ë©´í•œë‹¤",apply:t=>(y(t,"ê±°ìš¸: ë‹¹ì‹ ì€ ë¬¼ëŸ¬ë‚¬ë‹¤."),"NONE")}]},{id:"mad_contract",name:"ì –ì€ ê³„ì•½ì„œ",prompt:"ê³°íŒ¡ì´ ëƒ„ìƒˆê°€ ë‚©ë‹ˆë‹¤.",art:`${Ce}assets/events/event_mad_contract.png`,options:e=>[{key:"mad_contract:sign",label:"ì„œëª…í•œë‹¤",detail:"ìµœëŒ€ HP +2. ì¹´ë“œ 1ì¥ ì œê±° í›„ ë³´ìƒ.",apply:t=>(t.player.maxHp+=2,t.player.hp=Math.min(t.player.maxHp,t.player.hp+2),y(t,"ê³„ì•½: ìµœëŒ€ HP +2"),{kind:"REMOVE_PICK",title:"ëŒ€ê°€",prompt:"ì œê±°í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",then:"REWARD"})},{key:"mad_contract:burn",label:"ì°¢ì–´ë²„ë¦°ë‹¤",detail:"F +1",apply:t=>(Ne(t,1),y(t,"ë¶ˆê¸¸í•¨: F +1"),"NONE")}]},{id:"mad_lullaby",name:"ìì¥ê°€",prompt:"ì ë“¤ë©´ íšŒë³µí•˜ì§€ë§Œ, ê¹¨ì–´ë‚˜ë©´ ìŠìŠµë‹ˆë‹¤.",art:`${Ce}assets/events/event_mad_lullaby.png`,options:e=>[{key:"mad_lullaby:sleep",label:"ì ë“ ë‹¤",detail:"HP +12. ë±ì—ì„œ ë¬´ì‘ìœ„ 1ì¥ ì†Œì‹¤.",apply:t=>(nt(t,12),Eo(t),y(t,"ìì¥ê°€: HP íšŒë³µ, ê·¸ëŸ¬ë‚˜ ìŠì—ˆë‹¤â€¦ (ë¬´ì‘ìœ„ 1ì¥ ì†Œì‹¤)"),"NONE")},{key:"mad_lullaby:stay",label:"ë²„í‹´ë‹¤",detail:"F -1",apply:t=>(Ne(t,-1),y(t,"ë²„íŒ€: F -1"),"NONE")}]}];function Qo(e){return Rn[Math.floor(Math.random()*Rn.length)]}const jt=[{id:"drop_bag",name:"ì§ ë²„ë¦¬ê¸°",prompt:"ì§ì„ ì¤„ì—¬ í”¼ë¡œë¥¼ ë‚®ì¶”ì.",art:`${Ce}assets/events/event_drop_bag.png`,options:()=>[{key:"drop",label:"ì¹´ë“œ 1ì¥ ì œê±°, F -1",apply:e=>(Ne(e,-1),y(e,"ì´ë²¤íŠ¸: ì§ ë²„ë¦¬ê¸° â†’ ì œê±°í•  ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”."),{kind:"REMOVE_PICK",title:"ì§ ë²„ë¦¬ê¸°",prompt:"ì œê±°í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",then:"NONE"})},{key:"skip",label:"ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠëŠ”ë‹¤",apply:e=>(y(e,"ì´ë²¤íŠ¸: ì§ ë²„ë¦¬ê¸°(ìƒëµ)"),"NONE")}]},{id:"hide_from_monster",name:"ëª¬ìŠ¤í„°ë¡œë¶€í„° ìˆ¨ê¸°",prompt:"ì „íˆ¬í•˜ê±°ë‚˜, ëŒ€ê°€ë¥¼ ì¹˜ë¥´ê³  ìˆ¨ì„ ìˆ˜ ìˆë‹¤.",art:`${Ce}assets/events/event_hide_from_monster.png`,options:()=>[{key:"fight",label:"ì „íˆ¬",apply:e=>(y(e,"ì´ë²¤íŠ¸: ëª¬ìŠ¤í„°ë¡œë¶€í„° ìˆ¨ê¸° â†’ ì „íˆ¬ ì„ íƒ"),"BATTLE")},{key:"remove_and_fatigue",label:"ì¹´ë“œ 1ì¥ ì œê±° í›„ F +1",apply:e=>(Ne(e,1),y(e,"ì´ë²¤íŠ¸: ëª¬ìŠ¤í„°ë¡œë¶€í„° ìˆ¨ê¸° â†’ ì¹´ë“œ ì œê±° í›„ F+1"),{kind:"REMOVE_PICK",title:"ìˆ¨ê¸°",prompt:"ì œê±°í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",then:"NONE"})}]},{id:"goblin_ambush_low_supplies",name:"ë§¤ë³µí•œ ì•½íƒˆìë“¤",prompt:`ê³ ë¸”ë¦°ë“¤ì´ ë³´ê¸‰ì„ ì•½íƒˆí–ˆë‹¤.
ì´ë²ˆ ì „íˆ¬ëŠ” ë³´ê¸‰(S) 5ë¡œ ì‹œì‘í•©ë‹ˆë‹¤.`,art:`${Ce}assets/events/event_goblin_ambush_low_supplies.png`,options:()=>[{key:"fight",label:"ë§ì„œ ì‹¸ìš´ë‹¤",detail:"ê³ ë¸”ë¦° ì•½íƒˆì 2ë§ˆë¦¬ ì „íˆ¬ (S=5 ì‹œì‘)",apply:e=>(e.run.nextBattleSuppliesBonus=-5,{kind:"BATTLE_SPECIAL",title:"ê³ ë¸”ë¦° ë§¤ë³µ",enemyIds:["goblin_raider","goblin_raider"]})}]},{id:"find_adventurer",name:"ë‹¤ë¥¸ ëª¨í—˜ê°€ ë°œê²¬",prompt:"ê±°ë˜í•œë‹¤.",art:`${Ce}assets/events/event_find_adventurer.png`,options:e=>e.run.treasureObtained?[{key:"adventurer:forced_battle",label:"ëŒ€ì¹˜í•œë‹¤",detail:"ë³´ë¬¼ì„ ë…¸ë¦¬ê³  ë¤ë²¼ë“ ë‹¤.",apply:t=>({kind:"BATTLE_SPECIAL",enemyIds:["other_adventurer"],title:"ë³´ë¬¼ì„ ë…¸ë¦¬ëŠ” ëª¨í—˜ê°€"})}]:[{key:"trade",label:"ì¹´ë“œ 1ì¥ ì œê±° í›„ ì¹´ë“œ ë³´ìƒ(2ì¥ ì¤‘ 1ì¥)",apply:t=>(y(t,"ì´ë²¤íŠ¸: ë‹¤ë¥¸ ëª¨í—˜ê°€ ë°œê²¬ â†’ ì œê±°í•  ì¹´ë“œ ì„ íƒ í›„ ë³´ìƒ"),{kind:"REMOVE_PICK",title:"ë‹¤ë¥¸ ëª¨í—˜ê°€ ë°œê²¬",prompt:"ì œê±°í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",then:"REWARD"})},{key:"leave",label:"ì§€ë‚˜ì¹œë‹¤",apply:t=>(y(t,"ì´ë²¤íŠ¸: ë‹¤ë¥¸ ëª¨í—˜ê°€ ë°œê²¬(ìƒëµ)"),"NONE")}]},{id:"ominous_prophecy",name:"ë¶ˆê¸¸í•œ ì˜ˆì–¸",prompt:"ë¶ˆê¸¸í•œ ì†ì‚­ì„ì´ ê·“ê°€ë¥¼ ë§´ëˆë‹¤. ëŒ€ê°€ë¥¼ ì¹˜ë¥´ê³  ë¯¸ë˜ë¥¼ ì—¿ë³¼ê¹Œ?",art:`${Ce}assets/events/event_ominous_prophecy.png`,options:e=>[{key:"omen:listen",label:"ì˜ˆì–¸ì„ ë“£ëŠ”ë‹¤",detail:"F +1. ë‹¤ìŒ ë³´ìŠ¤ë¥¼ í™•ì •í•˜ê³  ê³µê°œí•©ë‹ˆë‹¤.",apply:t=>{if(Ne(t,1),y(t,"ë¶ˆê¸¸í•œ ì˜ˆì–¸: F +1"),t.run.nextBossId||(t.run.bossPool.length>0?t.run.nextBossId=re(t.run.bossPool):t.run.nextBossId=null),!t.run.nextBossId)return y(t,"ì˜ˆì–¸: ë¯¸ë˜ê°€ íë¦¿í•˜ë‹¤. (ë³´ìŠ¤ê°€ ë‚¨ì•„ìˆì§€ ì•ŠìŒ)"),"NONE";t.content.enemiesById[t.run.nextBossId];const n=lr[t.run.nextBossId]??"ì •ì²´ë¶ˆëª…ì˜ ìœ„í˜‘ì´ ë‹¤ê°€ì˜¨ë‹¤.";return t.run.bossOmenText=`${n}`,y(t,`ì˜ˆì–¸: ${n}`),"NONE"}},{key:"omen:ignore",label:"ë¬´ì‹œí•œë‹¤",detail:"ì•„ë¬´ ì¼ë„ ì¼ì–´ë‚˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",apply:t=>(y(t,"ë¶ˆê¸¸í•œ ì˜ˆì–¸(ë¬´ì‹œ)"),"NONE")}]}];function cr(e){return jt.find(t=>t.id===e)??null}function Jo(){return Object.keys(Yn).sort((e,t)=>e.localeCompare(t))}function Zo(){return{cardsById:Yn,enemiesById:Qr}}let We=!1,un=null,Oe=[],Ve=[],Ee=-1;function es(e){return Array.from(new Set(e)).sort((t,n)=>t.localeCompare(n))}function In(e,t){return e.toLowerCase().startsWith(t.toLowerCase())}function ts(){return[{name:"help",desc:"show commands"},{name:"state",desc:"print game state"},{name:"newrun",desc:"start new run"},{name:"hp",args:"<n>",desc:"set current hp"},{name:"maxhp",args:"<n>",desc:"set max hp"},{name:"supplies",args:"<n>",desc:"set supplies"},{name:"fatigue",args:"<n>",desc:"set fatigue"},{name:"phase",args:"<PLACE|BACK|FRONT|ENEMY|UPKEEP|DRAW|NODE>",desc:"set phase",suggest:()=>["PLACE","BACK","FRONT","ENEMY","UPKEEP","DRAW","NODE"]},{name:"addcard",args:"<defId> [upgrade=0] [zone=deck|hand|discard]",desc:"add card",suggest:(e,t)=>t.length<=2?Jo():t.length===4?["deck","hand","discard"]:[]},{name:"removecard",args:"<uid>",desc:"remove card",suggest:e=>es(Object.keys(e.cards??{}))},{name:"win",desc:"force victory"},{name:"lose",desc:"force defeat"},{name:"log",args:"<text...>",desc:"log message"},{name:"addrelic",args:"<relicId> [now|locked|unlocked]",desc:"grant relic",suggest:(e,t)=>t.length<=2?eo():t.length===3?["now","locked","unlocked"]:[]},{name:"relicapply",desc:"apply pending relic activations"}]}function xt(e,t){Oe.push({t:Date.now(),kind:e,text:t}),Oe.length>300&&(Oe=Oe.slice(-300))}function ns(e){un=e}function rs(){return We}function os(e){We=!We,Fe()}function Fe(){if(document.querySelector(".devConsole")?.remove(),!We)return;const e=document.createElement("div");e.className="devConsole",e.style.cssText=`
    position: fixed; inset: 0;
    z-index: 60000;
    pointer-events: auto;
    background: rgba(0,0,0,.35);
    backdrop-filter: blur(4px);
    display:flex; align-items:flex-end; justify-content:center;
    padding: 12px;
    box-sizing: border-box;
  `;const t=document.createElement("div");t.style.cssText=`
    width: min(980px, 100%);
    height: min(420px, 70vh);
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(10,12,14,.92);
    box-shadow: 0 18px 60px rgba(0,0,0,.55);
    display:flex;
    flex-direction: column;
    overflow:hidden;
  `;const n=document.createElement("div");n.style.cssText=`
    padding: 10px 12px;
    display:flex; align-items:center; justify-content:space-between;
    border-bottom: 1px solid rgba(255,255,255,.10);
  `;const r=document.createElement("div");r.textContent="Dev Console",r.style.cssText="font-weight:800; color:#fff; opacity:.95;";const o=document.createElement("div");o.style.cssText="display:flex; gap:8px;";const s=(b,g)=>{const h=document.createElement("button");return h.type="button",h.textContent=b,h.style.cssText=`
      padding: 6px 10px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: #fff;
      cursor: pointer;
      font-weight: 700;
    `,h.onclick=g,h};o.appendChild(s("Clear",()=>{Oe=[],Fe()})),o.appendChild(s("Close",()=>{We=!1,Fe()})),n.appendChild(r),n.appendChild(o);const a=document.createElement("div");a.className="devConsoleOut",a.style.cssText=`
    flex: 1 1 auto;
    padding: 10px 12px;
    overflow: auto;
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 12px;
    line-height: 1.4;
    color: #ddd;
    white-space: pre-wrap;
  `;const i=b=>(b.kind==="in"?"> ":b.kind==="err"?"! ":"  ")+b.text;a.textContent=Oe.map(i).join(`
`),queueMicrotask(()=>{a.scrollTop=a.scrollHeight});const d=document.createElement("div");d.style.cssText=`
    border-top: 1px solid rgba(255,255,255,.10);
    padding: 10px 12px;
    display:flex; gap:10px; align-items:center;
  `;const c=document.createElement("div");c.className="devConsoleHint",c.style.cssText=`
    margin-left: 10px;
    max-width: 45%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    color: rgba(255,255,255,.55);
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 12px;
  `;const m=document.createElement("div");m.textContent=">",m.style.cssText="color:#fff; font-weight:900; opacity:.9;";const u=document.createElement("input");u.type="text",u.placeholder="help / state / newrun ...",u.style.cssText=`
    flex: 1 1 auto;
    padding: 10px 12px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(255,255,255,.06);
    color: #fff;
    outline: none;
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 13px;
  `;const l=ts();let x={base:"",items:[],idx:-1,lastApplied:""};const w=b=>{const g=un?.getG();if(!g)return[];const h=b.split(/\s+/).filter(Boolean),k=/\s$/.test(b);if(h.length===0)return l.map(E=>E.name);if(h.length===1&&!k){const E=h[0];return l.map(_=>_.name).filter(_=>In(_,E))}const M=(h[0]??"").toLowerCase(),T=l.find(E=>E.name===M);if(!T?.suggest)return[];const L=k?"":h[h.length-1]??"";return T.suggest(g,h).filter(E=>In(E,L))},f=(b,g)=>{const h=/\s$/.test(b);if(!b.trim())return g+" ";const k=b.split(/\s+/);return h?b+g+" ":(k[k.length-1]=g,k.join(" ")+" ")},p=()=>{const b=w(u.value);if(!b.length){c.textContent="";return}const g=b.slice(0,6);c.textContent=g.join("  ")};u.onkeydown=b=>{if(b.key==="Escape"){We=!1,Fe();return}if(b.key==="Enter"){const g=u.value.trim();if(!g)return;u.value="",Ve.unshift(g),Ee=-1,xt("in",g);try{ss(g)}catch(h){xt("err",String(h?.message??h))}Fe();return}if(b.key==="ArrowUp"){b.preventDefault();const g=Ve.length;if(g===0)return;Ee=Math.min(g-1,Ee+1),u.value=Ve[Ee]??"";return}if(b.key==="ArrowDown"){if(b.preventDefault(),Ve.length===0)return;Ee=Math.max(-1,Ee-1),u.value=Ee>=0?Ve[Ee]??"":"";return}if(b.key==="Tab"){b.preventDefault();const g=b.shiftKey===!0,h=u.value;if(!(x.items.length>0&&(h===x.lastApplied||h===x.base))){const L=w(h);x.base=h,x.items=L,x.idx=-1,x.lastApplied=h}if(!x.items.length){p();return}g?x.idx=(x.idx-1+x.items.length)%x.items.length:x.idx=(x.idx+1)%x.items.length;const M=x.items[x.idx],T=f(x.base,M);u.value=T,x.lastApplied=T,p();return}},u.oninput=()=>{x.items=[],x.base="",x.idx=0,p()},d.appendChild(m),d.appendChild(u),d.appendChild(c),t.appendChild(n),t.appendChild(a),t.appendChild(d),t.onclick=b=>b.stopPropagation(),e.appendChild(t),document.body.appendChild(e),p(),queueMicrotask(()=>u.focus())}function ss(e){const t=un;if(!t){xt("err","Dev console context not set");return}const n=t.getG(),r=e.split(/\s+/).filter(Boolean),o=(r[0]??"").toLowerCase(),s=r[1],a=r[2],i=c=>xt("out",c);if(o==="help"){i(["help","state","newrun","hp <n> | maxhp <n> | supplies <n> | fatigue <n>","phase <PLACE|BACK|FRONT|ENEMY|UPKEEP|DRAW|NODE>","addcard <defId> [upgrade=0] [zone=deck|hand|discard]","removecard <uid>","addrelic <relicId> [now|locked|unlocked]","relicapply  (apply pending relic activations)","win | lose","log <text...>"].join(`
`));return}if(o==="state"){i(JSON.stringify({phase:n.phase,hp:`${n.player.hp}/${n.player.maxHp}`,supplies:n.player.supplies,fatigue:n.player.fatigue,deck:n.deck.length,hand:n.hand.length,discard:n.discard.length,enemies:n.enemies.map(c=>({id:c.id,hp:`${c.hp}/${c.maxHp}`,intent:c.intentIndex}))},null,2));return}if(o==="newrun"){t.actions.onNewRun(),i("OK: newrun");return}const d=(c,m)=>{const u=Number(s);if(!Number.isFinite(u)){i(`ERR: ${c} requires number`);return}m(u),t.rerender(),i(`OK: ${c} = ${u}`)};if(o==="hp")return d("hp",c=>n.player.hp=Math.max(0,Math.min(n.player.maxHp,c)));if(o==="maxhp")return d("maxHp",c=>{n.player.maxHp=Math.max(1,c),n.player.hp=Math.min(n.player.hp,n.player.maxHp)});if(o==="supplies")return d("supplies",c=>n.player.supplies=Math.max(0,c));if(o==="fatigue")return d("fatigue",c=>n.player.fatigue=Math.max(0,c));if(o==="phase"){const c=(s??"").toUpperCase();if(!new Set(["PLACE","BACK","FRONT","ENEMY","UPKEEP","DRAW","NODE"]).has(c)){i("ERR: phase invalid");return}n.phase=c,t.rerender(),i(`OK: phase=${c}`);return}if(o==="log"){const c=e.slice(e.indexOf(" ")+1);if(!c||c===e){i("ERR: log <text...>");return}t.log?.(`[DEV] ${c}`),i("OK: logged");return}if(o==="addcard"){const c=s;if(!c){i("ERR: addcard <defId> [upgrade=0] [zone=deck|hand|discard]");return}const m=Math.max(0,Number(a??"0")||0),u=r[3]??"deck";an(n,c,{upgrade:m});const l=n.deck[n.deck.length-1];l&&u!=="deck"&&(n.deck=n.deck.filter(x=>x!==l),u==="hand"?n.hand.push(l):u==="discard"&&n.discard.push(l),n.cards[l].zone=u),t.log?.(`[DEV] addcard ${c} +${m} (${u}) uid=${l}`),t.rerender(),i(`OK: addcard uid=${l}`);return}if(o==="removecard"){const c=s;if(!c){i("ERR: removecard <uid>");return}if(!n.cards[c]){i(`ERR: uid not found: ${c}`);return}const m=n.deck.includes(c),u=n.hand.includes(c),l=n.discard.includes(c);!m&&!u&&!l&&i(`WARN: uid exists but not in piles (deck/hand/discard): ${c} (zone=${n.cards[c]?.zone??"?"})`),wt(n,c),t.log?.(`[DEV] removecard ${c}`),t.rerender(),i("OK: removecard");return}if(o==="addrelic"){const c=s,m=(a??"").toLowerCase();if(!c){i("ERR: addrelic <relicId> [now|locked|unlocked]");return}Ft(n,c);const u=n.run;if(u.forceLockedRelics??={},u.forceUnlockedRelics??={},m==="locked"){u.forceLockedRelics[c]=!0,delete u.forceUnlockedRelics[c],u.relicRuntime??={},u.relicRuntime[c]??={active:!1,pending:!1,obtainedAtNode:n.run.nodePickCount},u.relicRuntime[c].active=!1,u.relicRuntime[c].pending=!1,t.log?.(`[DEV] addrelic ${c} (locked)`),t.rerender(),i(`OK: addrelic ${c} (locked)`);return}if(m==="unlocked"){u.forceUnlockedRelics[c]=!0,delete u.forceLockedRelics[c],t.log?.(`[DEV] addrelic ${c} (unlocked)`),t.rerender(),i(`OK: addrelic ${c} (unlocked)`);return}m==="now"&&oe(n),t.log?.(`[DEV] addrelic ${c}${m?` (${m})`:""}`),t.rerender(),i(`OK: addrelic ${c}`);return}if(o==="relicapply"){oe(n),t.log?.("[DEV] relicapply"),t.rerender(),i("OK: relicapply");return}if(o==="win"){if(!n.enemies||n.enemies.length===0){i("WARN: enemies=0");return}for(const c of n.enemies)c.hp=0;n.enemies=[],n.pendingTarget=null,n.pendingTargetQueue=[],n.selectedEnemyIndex=null,Ue(n),t.log?.("[DEV] win"),t.rerender(),i("OK: win");return}if(o==="lose"){n.run.finished=!0,t.log?.("[DEV] lose"),t.rerender(),i("OK: lose");return}i(`Unknown command: ${o} (try: help)`)}function Ye(e,t){if(!t)return;const n=e.player.fatigue??0;n<10||(e.player.fatigue=Math.max(0,n-2),e.time=(e.time??0)+1,y(e,"í”¼ë¡œê°€ ë„ˆë¬´ ë†’ì•„ íœ´ì‹ì´ ë” ì˜¤ë˜ ê±¸ë¦½ë‹ˆë‹¤. (F -2, ì‹œê°„ +1)"))}function dr(e){let t=Object.values(e.cards).filter(a=>(a.zone==="deck"||a.zone==="hand"||a.zone==="discard")&&ln(e,a.uid)).map(a=>a.uid);const n=e.player.fatigue??0;let r=1/0;return n>=8?r=4:n>=5&&(r=8),r!==1/0&&t.length>r&&(t=[...t].sort(()=>Math.random()-.5).slice(0,r)),t.length===0?null:{kind:"UPGRADE_PICK",title:"ê°•í™”",prompt:"ê°•í™”í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",options:[...[...t].sort((a,i)=>{const d=e.cards[a],c=e.cards[i],m=e.content.cardsById[d.defId]?.name??d.defId,u=e.content.cardsById[c.defId]?.name??c.defId,l=m.localeCompare(u,"ko");return l!==0?l:(d.upgrade??0)-(c.upgrade??0)}).map(a=>{const i=e.cards[a],d=ye(e.content,i.defId,i.upgrade??0),c=ye(e.content,i.defId,(i.upgrade??0)+1),m=e.content.cardsById[i.defId]?.name??i.defId,u=(i.upgrade??0)>0?`${m} +${i.upgrade}`:m,l=`í˜„ì¬: ì „ì—´ ${d.frontText} / í›„ì—´ ${d.backText}
ê°•í™”: ì „ì—´ ${c.frontText} / í›„ì—´ ${c.backText}`;return{key:`up:${a}`,label:u,detail:l,cardUid:a}}),{key:"skip",label:"ì·¨ì†Œ"}]}}function as(e,t){const n=e.choiceCtx&&e.choiceCtx.kind==="REST"&&typeof e.choiceCtx.highF=="boolean"?e.choiceCtx.highF:(e.player.fatigue??0)>=10;if(t.startsWith("rest:")){const r=xe(e);r.rest+=1,pe(e)}if(t==="rest:heal")return Ye(e,n),nt(e,15),y(e,"íœ´ì‹: HP +15"),de(e),e.phase="NODE",oe(e),!0;if(t==="rest:clear_f")return Ye(e,n),e.player.fatigue=Math.max(0,(e.player.fatigue??0)-3),y(e,"íœ´ì‹: í”¼ë¡œ F-=3"),de(e),e.phase="NODE",oe(e),!0;if(t==="rest:upgrade"){const r=dr(e);return r?(Ye(e,n),zt(e,r,null),!0):(y(e,"ê°•í™”í•  ìˆ˜ ìˆëŠ” ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤."),Ye(e,n),de(e),e.phase="NODE",oe(e),!0)}return t==="rest:skip"?(Ye(e,n),y(e,"íœ´ì‹: ìƒëµ"),de(e),e.phase="NODE",oe(e),!0):!1}function is(e,t){if(!e.choiceCtx||e.choiceCtx.kind!=="EVENT")return!1;const n=cr(e.choiceCtx.eventId);if(!n)return!1;const o=n.options(e).find(i=>i.key===t);if(!o)return!1;const s=xe(e);s.eventPicks+=1,pe(e);const a=o.apply(e);if(a&&typeof a=="object"&&a.kind==="UPGRADE_PICK"){const i=dr(e);return i?(zt(e,i,null),!0):(y(e,"ê°•í™”í•  ìˆ˜ ìˆëŠ” ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤."),de(e),e.phase="NODE",oe(e),!0)}if(a&&typeof a=="object"&&a.kind==="REMOVE_PICK"){const d=[...Object.values(e.cards).filter(c=>c.zone==="deck"||c.zone==="hand"||c.zone==="discard").map(c=>c.uid).map(c=>{const m=e.cards[c],u=ye(e.content,m.defId,m.upgrade??0),l=e.content.cardsById[m.defId]?.name??m.defId,x=(m.upgrade??0)>0?`${l} +${m.upgrade}`:l;return{key:`remove:${c}`,label:x,detail:`ì „ì—´: ${u.frontText} / í›„ì—´: ${u.backText}`,cardUid:c}}),{key:"skip",label:"ì·¨ì†Œ"}];return zt(e,{kind:"REMOVE_PICK",title:a.title??"ì œê±°",prompt:a.prompt??"ì œê±°í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",options:d},null),!0}return de(e),e.phase="NODE",oe(e),!0}function ls(e,t){const n=e.choice;if(!n)return!1;if(t==="close")return de(e),!0;if(n.kind==="REWARD")return _o(e,t);if(n.kind==="UPGRADE_PICK"){if(t==="skip")return y(e,"ê°•í™” ì·¨ì†Œ"),de(e),e.phase="NODE",oe(e),!0;if(t.startsWith("up:")){const r=t.slice(3),o=rr(e,r);return y(e,o?"ê°•í™” ì™„ë£Œ":"ê°•í™” ì‹¤íŒ¨"),de(e),e.phase="NODE",oe(e),!0}return!1}if(n.kind==="REMOVE_PICK"){if(t==="skip")return y(e,"ì œê±° ì·¨ì†Œ"),de(e),e.phase="NODE",oe(e),!0;if(t.startsWith("remove:")){const r=t.slice(7);return wt(e,r),y(e,"ì¹´ë“œë¥¼ ì œê±°í–ˆìŠµë‹ˆë‹¤."),de(e),e.phase="NODE",oe(e),!0}return!1}if(n.kind==="EVENT"){if(e.choiceCtx?.kind==="REST")return as(e,t);if(e.choiceCtx?.kind==="EVENT")return is(e,t)}return t==="skip"?(de(e),!0):!1}const _t="deck-rogue-save-v1",ur=1;function cs(e){try{return JSON.parse(e)}catch{return null}}function ds(){return!!localStorage.getItem(_t)}function us(){localStorage.removeItem(_t)}function ps(e,t){const n={ver:ur,savedAt:Date.now(),build:t?.build,state:e};localStorage.setItem(_t,JSON.stringify(n))}function fs(){const e=localStorage.getItem(_t);if(!e)return null;const t=cs(e);return!t||t.ver!==ur||!t.state?null:{state:t.state,savedAt:t.savedAt}}function hs(e){return e<0?0:e}function ms(e,t,n){const r=t.player.status?.vuln??0,o=n.status?.weak??0;return hs(e+r-o)}function bs(e,t){let n=Math.max(0,Number(t)||0);const r=[];for(const o of e){const s=Math.min(n,o);n-=s,r.push(o-s)}return r}function Le(e,t){e.push(t)}function ys(e){const t=(e.dmgTotal??0)>0||(e.hits??0)>0||(e.perHit??0)>0,n=(e.applies??[]).some(o=>o.target==="player"&&["vuln","weak","bleed","disrupt","supplies","fatigue"].includes(String(o.kind))),r=(e.applies??[]).some(o=>o.target==="enemy"&&["vuln","weak","bleed","disrupt","immune"].includes(String(o.kind)));return t&&n?"ATTACK_DEBUFF":t&&r?"ATTACK_BUFF":t?"ATTACK":n?"DEBUFF":r?"BUFF":"OTHER"}function xs(e,t,n){const r=t.usedThisTurn??0;return e==="goblin_raider"?{raw:Math.max(0,12-r),hits:1}:e==="watching_statue"?{raw:4+r,hits:1}:{raw:0,hits:1}}function ks(e,t,n,r={}){if(n.meta?.preview){const l=n.meta.preview(e,t);if(l)return l}const o=[],s=[],a=[];if(n.meta?.applies)for(const l of n.meta.applies)Le(o,l);for(const l of n.acts)switch(l.op){case"damagePlayer":{a.push(Math.max(0,Number(l.n)||0));break}case"damagePlayerFormula":{const{raw:x,hits:w}=xs(l.kind,e),f=Math.max(1,Number(w??1)||1),p=Math.max(0,Number(x)||0);for(let b=0;b<f;b++)a.push(p);break}case"statusPlayer":{Le(o,{target:"player",kind:l.key,amount:l.n});break}case"supplies":{Le(o,{target:"player",kind:"supplies",amount:l.n});break}case"fatiguePlayer":{Le(o,{target:"player",kind:"fatigue",amount:l.n});break}case"enemyHealSelf":{Le(o,{target:"enemy",kind:"heal",amount:l.n});break}case"enemyImmuneNextTurn":{Le(o,{target:"enemy",kind:"immune",amount:1});break}case"damagePlayerRampHits":{const x=Math.max(1,Number(e.combatTurn??1)),w=Math.max(1,Number(l.baseHits??1)),f=Math.max(1,Number(l.everyTurns??1));let p=w+Math.floor((x-1)/f);l.capHits!=null&&(p=Math.min(p,Math.max(1,Number(l.capHits))));const b=Math.max(0,Number(l.n)||0);for(let g=0;g<p;g++)a.push(b);break}}if(!a.length){const l=Math.max(0,Number(n.meta?.hits??0)||0),x=Math.max(0,Number(n.meta?.baseDmg??0)||0);if(l>0&&x>0)for(let w=0;w<l;w++)a.push(x)}let i=a.map(l=>ms(l,e,t));r.includeBlock&&i.length&&(i=bs(i,e.player.block??0));const d=i.length,c=d?i.reduce((l,x)=>l+x,0):void 0,m=d&&i.every(l=>l===i[0])?i[0]:void 0,u={cat:n.meta?.cat??"OTHER",dmgTotal:c,hits:d>0?d:n.meta?.hits,perHit:m??n.meta?.baseDmg,applies:o.length?o:void 0,notes:s.length?s:void 0};return u.cat=n.meta?.cat??ys(u),u.shortText||(u.dmgTotal!=null&&(u.hits??0)>1?u.shortText=`${u.dmgTotal} (${u.hits}íƒ€)`:u.dmgTotal!=null&&(u.shortText=`${u.dmgTotal}`)),u}const Ts=`# Deck Rogue Prototype â€” ë£°ë¶ (í”Œë ˆì´ì–´ìš©)

ì´ ë¬¸ì„œëŠ” ìŠ¤í¬ì¼ëŸ¬ë¥¼ ìµœì†Œí™”í•©ë‹ˆë‹¤.

[1] ê°œìš”
ë…¸ë“œë¥¼ ì„ íƒí•˜ë©° ì§„í–‰í•˜ê³ , ì „íˆ¬ì—ì„œ ì‚´ì•„ë‚¨ì•„ ì„±ì¥í•©ë‹ˆë‹¤. ëª©í‘œëŠ” ë¬´ì—‡ì¼ê¹Œìš”?
ëª¨ë“  ì¹´ë“œëŠ” ì „ì—´ê³¼ í›„ì—´ì´ ìˆìŠµë‹ˆë‹¤. ë°°ì¹˜ì— ë”°ë¼ ì—­í• ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤.

[2] ë³´ê¸‰ê³¼ í”¼ë¡œë„

ë³´ê¸‰(S): ì „ì—´ ì¹´ë“œ ë° ì¼ë¶€ íš¨ê³¼ì˜ ë°œë™ì— ì‚¬ìš©ë©ë‹ˆë‹¤. ë³´í†µ 7ë¡œ ì‹œì‘í•©ë‹ˆë‹¤.
ë³´ê¸‰ì´ ë¶€ì¡±í•œ ìƒíƒœë¡œ í„´ ì¢…ë£Œ ì‹œ í”¼ë¡œë„ë§Œí¼ í”¼í•´ë¥¼ ë°›ìŠµë‹ˆë‹¤.

í”¼ë¡œë„(F): ë±ì„ ì„ê±°ë‚˜ ì „ì—´ ì¹´ë“œì˜ ë³´ê¸‰ì´ ë¶€ì¡±í•œ ì±„ë¡œ í„´ì„ ë§ˆì¹  ë•Œ í”¼ë¡œë„ê°€ 1 ì˜¬ë¼ê°€ë©°, ì¼ë¶€ ì¹´ë“œì˜ íš¨ê³¼ë¡œë„ ë³€í•©ë‹ˆë‹¤.
í”¼ë¡œë„ëŠ” ì „íˆ¬ê°€ ëë‚˜ë„ ìœ ì§€ë©ë‹ˆë‹¤. ë„ˆë¬´ ìŒ“ì¸ í”¼ë¡œëŠ” ë•Œë•Œë¡œ ë‹¹ì‹ ì„ ë³€í•˜ê²Œ í•©ë‹ˆë‹¤.

[3] ì „íˆ¬ íë¦„
ë°°ì¹˜ â†’ í›„ì—´ ë°œë™ â†’ ì „ì—´ ë°œë™ â†’ ì  í–‰ë™ â†’ ì •ë¦¬ â†’ ë“œë¡œìš°
â€» â€œëŒ€ìƒ ì„ íƒ í•„ìš”â€ê°€ ëœ¨ë©´ ì‚´ì•„ìˆëŠ” ì ì„ í´ë¦­í•´ ëŒ€ìƒì„ ì •í•˜ì„¸ìš”.
â€» í›„ì—´ ë°œë™ì„ ëˆ„ë¥´ë©´ í„´ì´ ì§„í–‰ë˜ì–´, ì¹´ë“œì˜ ë°°ì¹˜ë¥¼ ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
ë³´ê¸‰ ë° ê·¸ì— ë”°ë¥¸ ë³€í™”ëŠ” ì •ë¦¬ ë‹¨ê³„ì—ì„œ ì²˜ë¦¬í•©ë‹ˆë‹¤.

ì†íŒ¨ëŠ” í„´ì´ ì¢…ë£Œë˜ì–´ë„ ìœ ì§€ë©ë‹ˆë‹¤.
ì¹´ë“œëŠ” ë§¤ í„´ë§ˆë‹¤ ì‚¬ìš©í•œ ë§Œí¼ ë½‘ìŠµë‹ˆë‹¤. ì¦‰, ì¹´ë“œë¡œ ì¸í•œ ë“œë¡œìš°ëŠ” íŒ¨ì˜ ë§¤ìˆ˜ ìì²´ë¥¼ ëŠ˜ë¦¬ëŠ” íš¨ê³¼ê°€ ìˆìŠµë‹ˆë‹¤.

[4] ìš©ì–´
- ì†Œëª¨: ì´ë²ˆ ì „íˆ¬ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ì—†ê²Œ ë˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
- ì†Œì‹¤: ëŸ° ì „ì²´ì—ì„œ í•´ë‹¹ ì¹´ë“œê°€ ì‚¬ë¼ì§€ëŠ” ê²ƒì…ë‹ˆë‹¤.
- ì·¨ì•½: ë°›ëŠ” í”¼í•´ê°€ (ì·¨ì•½)ë§Œí¼ ì¦ê°€í•©ë‹ˆë‹¤.
- ì•½í™”: ì£¼ëŠ” í”¼í•´ê°€ (ì•½í™”)ë§Œí¼ ê°ì†Œí•©ë‹ˆë‹¤.
- ì¶œí˜ˆ: í„´ ì¢…ë£Œ ì‹œ (ì¶œí˜ˆ)ë§Œí¼ í”¼í•´ë¥¼ ì…ìŠµë‹ˆë‹¤.
- êµë€: ë‹¹ì‹ ì„ ë°©í•´í•©ë‹ˆë‹¤. ë¬´ì—‡ì¼ê¹Œìš”?

[5] ì¡°ì‘

(ì»´í“¨í„°)
- 4: ì„ íƒ í•´ì œ
- Tab: ì†íŒ¨ ì„ íƒ ì´ë™
- 1~3: ì „ì—´ ë°°ì¹˜ / q,w,e: í›„ì—´ ë°°ì¹˜
- ë“œë˜ê·¸: ì†íŒ¨â†’ìŠ¬ë¡¯ ë°°ì¹˜, ìŠ¬ë¡¯â†”ìŠ¬ë¡¯ ìŠ¤ì™‘, ìŠ¬ë¡¯â†’ì†íŒ¨ íšŒìˆ˜
- Space: ë‹¤ìŒ í„´
- P: ìƒˆë¡œìš´ ëŸ°

(ëª¨ë°”ì¼)
- ì†íŒ¨: í´ë¦­ ì‹œ ì„ íƒ, ê¸¸ê²Œ ëˆ„ë¥¼ ì‹œ í™•ëŒ€
- ì¹´ë“œ ì„ íƒ ìƒíƒœì—ì„œ ìŠ¬ë¡¯ì„ ëˆŒëŸ¬ ë°°ì¹˜
- ìŠ¬ë¡¯: í´ë¦­ ì‹œ í™•ëŒ€, ê¸¸ê²Œ ëˆ„ë¥¼ ì‹œ íšŒìˆ˜
- ìŠ¬ë¡¯ì— ë„£ì€ ì¹´ë“œëŠ” ì´ë¦„ë§Œ ë³´ì…ë‹ˆë‹¤.

[6] ë‹¹ì‹ ì„ ìœ„í•œ ì¡°ì–¸

ë±ì€ ë‹¹ì‹ ì˜ ë¹„í’ˆì…ë‹ˆë‹¤. ë¹„í’ˆì´ ì ìœ¼ë©´, ëŠ˜ ìƒˆë¡œ ê¾¸ë¦¬ëŠë¼ í˜ë“¤ ê²ë‹ˆë‹¤. ë¹„í’ˆì´ ë§ìœ¼ë©´, ë“¤ê³  ë‹¤ë‹ˆê¸° í˜ë“¤ê² ì§€ìš”. ê· í˜•ì„ ì°¾ìœ¼ì„¸ìš”.

[7] ì‹œê°„

ì‹œê°„ì€ ê¸ˆì…ë‹ˆë‹¤. ëª¨ë“  í–‰ë™ì€ ì‹œê°„ì„ ì†Œëª¨í•©ë‹ˆë‹¤. ì‹¸ì›€ì€ ì¢€ ë” ì†Œëª¨í• ì§€ë„ ëª¨ë¥´ê² êµ°ìš”.
ì¤‘ìš”í•œ ê±´ ì´ê³³ì´ ë‹¹ì‹ ì—ê²Œ ë„‰ë„‰í•œ ì‹œê°„ì„ ì£¼ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒì´ê² ì§€ìš”.
`,gs=new URL("/deck-rogue-prototype/",window.location.origin).href;function me(e){if(!e||/^(https?:|data:|blob:)/i.test(e))return e;const t=e.replace(/^\/+/,"");return new URL(t,gs).href}let Ln=!1;function Es(){if(Ln)return;Ln=!0;const e=document.documentElement;e.style.setProperty("--bgUrl",`url("${me("assets/ui/background/dungeon_bg.png")}")`),e.style.setProperty("--boardUrl",`url("${me("assets/ui/boards/battle_board.png")}")`),e.style.setProperty("--cardUrl",`url("${me("assets/ui/cards/card_parchment.png")}")`),e.style.setProperty("--mapBgUrl",`url("${me("assets/ui/background/map_bg.png")}")`)}function Cs(e){return new Promise(t=>window.setTimeout(t,e))}function vs(e){switch(e){case"BACK":return 100;case"FRONT":return 100;case"ENEMY":return 100;case"UPKEEP":return 100;case"DRAW":return 100;case"PLACE":return 0;default:return 220}}let At=!1;function Ss(){document.querySelectorAll(".slot").forEach(e=>{const t=e.querySelector(".slotCardScaler");t&&Nr(e,t)})}function ws(e){At||(At=!0,requestAnimationFrame(()=>{At=!1,bn(),kn(),xn(),Ss()}))}let _s=1,kt=[],pr=null;function rt(e,t,n,r){kt.push({id:_s++,kind:e,text:t,x:n,y:r,born:performance.now()})}function $s(){const e=performance.now();kt=kt.filter(t=>e-t.born<700)}let ft=null,ht=null,Rt=[];function Ms(e){if(!(!e.run.finished&&e.enemies.length>0&&e.phase!=="NODE")){ft=null,ht=null,Rt=[];return}if(ft!=null){const n=e.player.hp-ft;n!==0&&Ns(n)}if(ht!=null){const n=e.player.block-ht;n!==0&&Ps(n)}for(let n=0;n<e.enemies.length;n++){const r=e.enemies[n].hp,o=Rt[n];o!=null&&r!==o&&As(n,r-o)}ft=e.player.hp,ht=e.player.block,Rt=e.enemies.map(n=>n.hp)}function Ns(e){const t=document.querySelector(".playerHudBox")??document.querySelector(".playerHudLeft");if(!t)return;const n=t.getBoundingClientRect(),r=(n.left+n.right)/2,o=n.top+14;e<0?rt("dmg",`${e}`,r,o):rt("heal",`+${e}`,r,o),t.classList.add("fxFlash"),setTimeout(()=>t.classList.remove("fxFlash"),240)}function Ps(e){const t=document.querySelector(".playerHudBox")??document.querySelector(".playerHudLeft");if(!t)return;const n=t.getBoundingClientRect(),r=(n.left+n.right)/2,o=n.top+34;rt("block",e>0?`+${e}`:`${e}`,r,o)}function As(e,t){const r=Array.from(document.querySelectorAll(".enemyHudCenter .enemyBanner"))[e];if(!r)return;const o=r.getBoundingClientRect(),s=(o.left+o.right)/2,a=o.top+14;t<0?rt("dmg",`${t}`,s,a):rt("heal",`+${t}`,s,a),r.classList.add("fxFlash"),setTimeout(()=>r.classList.remove("fxFlash"),240)}const fr="deckrogue_uiSettings_v1";function qt(e,t,n){return Math.max(t,Math.min(n,e))}function hr(){try{const e=localStorage.getItem(fr);if(!e)return{uiScaleDesktop:1,uiScaleMobile:1,slotCardMode:"FULL"};const t=JSON.parse(e),n=t.slotCardMode==="NAME_ONLY"?"NAME_ONLY":"FULL";return{uiScaleDesktop:qt(Number(t.uiScaleDesktop??1)||1,.75,1.5),uiScaleMobile:qt(Number(t.uiScaleMobile??1)||1,.75,1.5),slotCardMode:n}}catch{return{uiScaleDesktop:1,uiScaleMobile:1,slotCardMode:"FULL"}}}let te=hr();function mr(){return $t()?te.uiScaleMobile:te.uiScaleDesktop}function A(e){return Math.round(e*mr())}function $t(){return window.matchMedia("(max-width: 900px) and (pointer: coarse)").matches}let we=!1;function Rs(){try{const e=localStorage.getItem("deckrogue_logCollapsed");if(e==null)return;we=e==="1"}catch{}}function Is(){try{localStorage.setItem("deckrogue_logCollapsed",we?"1":"0")}catch{}}let mt=null;function Ls(e){mt!=null&&window.clearTimeout(mt),mt=window.setTimeout(()=>{mt=null,ps(e)},250)}let It=!1;async function Hs(e,t){if(e._justStartedCombat){e._justStartedCombat=!1;return}if(!It){It=!0;try{if(e.run.finished||e.choice||Z(e)||q||e.phase==="NODE")return;let n=0;for(;n++<60&&!(e.run.finished||e.choice||q||Z(e));){const r=Mr(e,t,!1);if(!r.fn||r.disabled)break;const o=e.phase;if(r.fn(),R(e,t),e.phase==="PLACE")break;const s=vs(o);s>0&&await Cs(s)}}finally{It=!1}}}function br(e){const t=e.run;t.timeMove==null&&(t.timeMove=e.run.nodePickCount??0),t.nextBossTime==null&&(t.nextBossTime=40),t.forcedNext==null&&(t.forcedNext=null)}function Ds(e,t){const n=e;return n.content=t,n.time??=0,n.run.relics??=[],n.run??={},n.run.timeMove??=n.run.nodePickCount??0,n.run.nextBossTime??=40,n.run.forcedNext??=null,n.run.bossOmenText??=null,n.run.enemyLastSeenBattle??={},n.run.nodePickByType??={BATTLE:0,ELITE:0,REST:0,EVENT:0,TREASURE:0},n.run.bossPool??=["boss_gravity_master","boss_cursed_wall","boss_giant_orc","boss_soul_stealer"],n.run.nextBossId??=null,n.run.afterTreasureNodePicks??=0,n.run.deckSizeAtTreasure??=null,n.run.treasureObtained&&n.run.deckSizeAtTreasure==null&&(n.run.deckSizeAtTreasure=ar(n)),n.choiceStack??=[],n.pendingTargetQueue??=[],n.exhausted??=[],n.vanished??=[],n.choiceQueue??=[],n.choiceCtx??=null,n}function Bs(e){if(!ds())return Ot(e);const t=fs();return t?Ds(t.state,e):Ot(e)}function Os(){if(document.querySelector(".bgLayer"))return;const e=document.createElement("div");e.className="bgLayer",document.body.appendChild(e)}let Hn=0,Dn=0,fe=null,yr=0;function pn(){try{xr.hide()}catch{}const e=document.querySelector(".cardHoverPreview");e&&e.classList.remove("on")}function fn(e=250){yr=performance.now()+e}const xr=Fs();function Fs(){let e=null,t=null,n=null,r=null;function o(i){if(e)return;e=S("cardHoverPreview"),t=S("cardHoverPreviewTitle");const d=S("cardHoverPreviewRow");n=S("cardHoverPreviewCard"),r=S("cardHoverPreviewDetail"),d.appendChild(n),d.appendChild(r),e.appendChild(t),e.appendChild(d),i.appendChild(e)}function s(i){!e||!t||!n||!r||(t.textContent=i.title,n.innerHTML="",i.cardEl&&n.appendChild(i.cardEl),r.textContent=i.detail,e.classList.add("on"))}function a(){e&&e.classList.remove("on")}return{ensure:o,show:s,hide:a}}function Tt(e,t){const n=e.cards[t];return ye(e.content,n.defId,n.upgrade??0)}function gt(e,t){return e.content.cardsById[t]?.name??t}function Ws(e,t,n){const r=n??0,o=e.content.cardsById[t]?.name??t;return r>0?`${o} +${r}`:o}function ce(e,t){const n=e.cards[t];return Ws(e,n.defId,n.upgrade??0)}function lt(e,t,n,r,o){const s=e.cards[t],a=ye(e.content,s.defId,s.upgrade??0),i=o?.draggable??!0,d=o?.mode??"FULL",c=S("card");e.selectedHandCardUid===t&&c.classList.add("selected"),a.tags?.includes("EXHAUST")&&c.classList.add("exhaust"),a.tags?.includes("VANISH")&&c.classList.add("vanish"),d==="SLOT_NAME_ONLY"&&c.classList.add("slotNameOnly");const m=S("cardHeader"),u=Tr(e,t);if(m.appendChild(Y("cardTitle",u)),d==="FULL"){const l=S("cardMeta");a.tags?.includes("EXHAUST")&&l.appendChild(Yt("ì†Œëª¨")),a.tags?.includes("VANISH")&&l.appendChild(Yt("ì†Œì‹¤")),m.appendChild(l)}if(c.appendChild(m),d==="FULL"){const l=S("cardBody"),x=S("cardSection");x.classList.add("front"),x.appendChild(On(a.frontText)),l.appendChild(x);const w=S("cardSection");w.classList.add("back"),w.appendChild(On(a.backText)),l.appendChild(w),c.appendChild(l)}if(n&&r&&(c.onclick=()=>r(t)),n&&(c.onpointerdown=l=>{if(l.button!==0&&l.pointerType==="mouse"||Z(e)||e.phase!=="PLACE"||!i)return;const x=e.hand.indexOf(t);Pr(l,{kind:"hand",cardUid:t,fromHandIndex:x})}),o?.hoverPreview){const{root:l,api:x,buildDetail:w}=o.hoverPreview;x.ensure(l);const f=w?.(e,t)??(()=>{const p=Et(a.frontText),b=Et(a.backText);return`ì „ì—´: ${p||"ì—†ìŒ"}
í›„ì—´: ${b||"ì—†ìŒ"}`})();c.addEventListener("pointerenter",p=>{if(performance.now()<yr||O?.dragging)return;const b=lt(e,t,!1,void 0,{draggable:!1,mode:"FULL"});b.classList.add("isPreviewCard"),x.show({title:u,detail:f,cardEl:b})}),c.addEventListener("pointerleave",()=>{x.hide()}),c.addEventListener("pointerdown",()=>{fn(250),pn()},{capture:!0})}return c}function Et(e){if(!e)return"";if(typeof e=="string")return e;if(Array.isArray(e))return e.map(Et).join("");if(typeof e=="object"){if(e.text)return String(e.text);if(e.children)return Et(e.children)}return""}function S(e){const t=document.createElement("div");return t.className=e,t}function Y(e,t){const n=document.createElement("div");return n.className=e,n.textContent=t,n}function Us(e){const t=document.createElement("h2");return t.textContent=e,t}function Vt(e){const t=document.createElement("h3");return t.textContent=e,t}function hn(e){const t=document.createElement("p");return t.textContent=e,t}function Yt(e){const t=document.createElement("span");return t.className="badge",t.textContent=e,t}function Xt(e,t,n){const r=document.createElement("button");return r.textContent=e,r.disabled=n,r.onclick=t,r}function Ks(e){const t=document.createElement("pre");return t.className="log",t.textContent=e,t}function kr(e,t){const n=t??0;return n>0?`${e} +${n}`:e}function Tr(e,t){const n=e.cards[t],r=e.content.cardsById[n.defId].name;return kr(r,n.upgrade)}function zs(e,t){const n=e.content.cardsById[t.defId].name;return kr(n,t.upgrade)}const js={ì·¨ì•½:"ğŸ¯",ì•½í™”:"ğŸ¥€",ì¶œí˜ˆ:"ğŸ©¸",êµë€:"ğŸŒ€",ë©´ì—­:"âœ¨",S:"ğŸŒ¾",F:"ğŸ’¤",ë“œë¡œìš°:"ğŸƒ",í”¼í•´:"ğŸ—¡ï¸",íšŒë³µ:"ğŸ’Š",ë°©ì–´:"ğŸ›¡ï¸",ë¸”ë¡:"ğŸ›¡ï¸",ì†Œëª¨:"ğŸ”¥",ì†Œì‹¤:"ğŸ•³ï¸"};function Bn(e,t,n){const r=js[e]??"",o=t!=null?`${e} ${t}`:e;return`<span class="kwBadge"><span class="kwIcon">${r}</span> <span class="kwLabel">${o}</span><span class="kwPunc">${n||""}</span></span>`}const gr="[,ï¼Œã€]",qs=new RegExp(`(ì·¨ì•½|ì•½í™”|ì¶œí˜ˆ|êµë€|ë©´ì—­|S|F|ë“œë¡œìš°|í”¼í•´|ë°©ì–´|ë¸”ë¡|íšŒë³µ|ì†Œëª¨|ì†Œì‹¤)\\s*([+-]?\\d+)\\s*(${gr})?`,"g"),Vs=new RegExp(`(^|[^ê°€-í£A-Za-z0-9_])(ì†Œëª¨|ì†Œì‹¤)\\s*(${gr})?`,"g");function Ys(e){let t=e.replace(qs,(n,r,o,s)=>Bn(r,o,s));return t=t.replace(Vs,(n,r,o,s)=>`${r}${Bn(o,void 0,s)}`),t=t.replace(/\n/g,"<br>"),t}function On(e){const t=S("cardText");return t.innerHTML=Ys(e),t}function Xs(e){return me(`assets/enemies/${e}.png`)}const Fn={vuln:"ğŸ¯",weak:"ğŸ¥€",bleed:"ğŸ©¸",disrupt:"ğŸŒ€",immune:"âœ¨",supplies:"ğŸŒ¾",fatigue:"ğŸ’¤"};function Er(e){return e==="ATTACK"||e==="ATTACK_BUFF"||e==="ATTACK_DEBUFF"}function Gs(e,t,n){if(!n||!Er(n.cat))return"";const r=Math.max(1,Number(n.hits??1)||1),o=Math.max(0,Number(n.perHit??0)||0),s=Math.max(0,Number(n.dmgTotal??o*r)||0);if(r>1){if(o<=0)return`${s} (${r}íƒ€)`;const a=o*r;if(s===a)return`${s} (${o}x${r})`;const i=Math.max(0,Number(e.player?.block??0)||0);if(i>0){let d=i;const c=[];for(let u=0;u<r;u++){const l=Math.min(d,o);d-=l,c.push(o-l)}if(c.reduce((u,l)=>u+l,0)===s)return c.every(l=>l===c[0])?`${s} (${c[0]}x${r})`:`${s} (${c.join("+")})`}return`${s} (${o}x${r})`}return`${s}`}function Qs(e){if(!e)return"ï¼Ÿ";const t=Er(e.cat),n=e.applies??[],r=n.some(a=>a.target==="player"),o=n.some(a=>a.target==="enemy");let s="";if(t&&(s+="ğŸ—¡ï¸"),r&&(s+="ğŸŒ€"),o&&(s+="âœ¨"),!s){const a=e.cat;return a==="DEFEND"?"ğŸ›¡ï¸":a==="BUFF"?"âœ¨":a==="DEBUFF"?"ğŸŒ€":"ï¼Ÿ"}return s}function Js(e,t){const n=S("enemyStatusEmojiRow"),r=(o,s)=>{if(!s||s<=0)return;const a=document.createElement("span");a.className="stEmoji",a.textContent=`${Fn[o]??"?"}${s}`,n.appendChild(a)};if(r("vuln",e?.vuln??0),r("weak",e?.weak??0),r("bleed",e?.bleed??0),r("disrupt",e?.disrupt??0),t){const o=document.createElement("span");o.className="stEmoji",o.textContent=`${Fn.immune}1`,n.appendChild(o)}return n}let q=null,Wn=!1,O=null,be=null,Gt=!1,He=!1,he=null,$e=null,Me=null;function Zs(e,t,n){const r=e.cards[t];return Cr(e,r.defId,n)}function Ct(e,t,n){const o=lt(e,t,!!n,n,{draggable:!1});return o.classList.add("overlayCard"),o}function Cr(e,t,n){const r=`__preview:${t}:${n}:${Math.random().toString(36).slice(2)}`,o=e.cards[r];e.cards[r]={uid:r,defId:t,upgrade:n,zone:"preview"};const s=lt(e,r,!1,void 0,{draggable:!1});return s.classList.add("overlayCard"),s.draggable=!1,s.style.pointerEvents="none",o?e.cards[r]=o:delete e.cards[r],s}const Xe="ï¸";function ot(e,t){return e==="BATTLE"?t?{icon:"â˜ "+Xe,text:"ë³´ìŠ¤",kind:"boss"}:{icon:"âš”"+Xe,text:"ì „íˆ¬",kind:"battle"}:e==="ELITE"?{icon:"â˜ "+Xe,text:"ì •ì˜ˆ",kind:"elite"}:e==="REST"?{icon:"â›ºï¸"+Xe,text:"íœ´ì‹",kind:"rest"}:e==="EVENT"?{icon:"â”ï¸"+Xe,text:"ë¯¸ì§€",kind:"event"}:{icon:"âœ¦",text:"ë³´ë¬¼",kind:"treasure"}}function ea(e,t,n){const r=ot(t,n),o=document.createElement("span");o.className=`nodeIcon ${r.kind}`,o.textContent=r.icon;const s=document.createElement("span");s.className="nodeText",s.textContent=`(${r.text})`,e.appendChild(o),e.appendChild(s)}function Un(e){let t=2166136261;for(let n=0;n<e.length;n++)t^=e.charCodeAt(n),t=Math.imul(t,16777619);return t>>>0}function ta(e){let t=e>>>0;return t^=t<<13,t^=t>>>17,t^=t<<5,(t>>>0)/4294967296}function _e(e){return Math.max(0,Math.min(1,e))}function Lt(e,t,n){return Math.max(t,Math.min(n,Math.floor(e)))}function ct(e){const t=e.run;if(t.timeMove??=0,t.vision??={mode:"NORMAL",presenceR:2,typeR:1,detailR:0,noise:.01*e.player.fatigue},t.pursuit??={heat:0},!t.map)t.map=sa();else{const o=t.map;if(Array.isArray(o.nodes)){const s={};for(const a of o.nodes)s[String(a.id)]=a;o.nodes=s}}const n=t.map;if(!Object.keys(n?.nodes??{}).every(o=>typeof n.nodes[o]?.order=="number"))try{Sr(n,2)}catch{}try{mn(n)}catch{}return{map:t.map,vision:t.vision,pursuit:t.pursuit,timeMove:t.timeMove}}function vr(e){const t=e.run,n=Number(t.timeMove??0)||0,r=Number(e.time??0)||0;return n+r}function st(e){return e>=14?3:e>=9?2:e>=5?1:0}function na(e){const{map:t,pursuit:n}=ct(e),r=st(n.heat??0);if(r<=0)return;const o=.05+.04*r;if(Math.random()>=o)return;const s=t.edges??={},a=Object.keys(t.nodes);if(a.length<4)return;const i=h=>Number(t.nodes[h]?.depth??999),d=h=>Number(t.nodes[h]?.order??0),c=(h,k)=>{s[h]??=[],s[k]??=[],s[h].includes(k)||s[h].push(k),s[k].includes(h)||s[k].push(h)},m=(h,k)=>{s[h]=(s[h]??[]).filter(M=>M!==k),s[k]=(s[k]??[]).filter(M=>M!==h)},u=h=>{const k=new Set,M=[h];for(k.add(h);M.length;){const T=M.shift();for(const L of s[T]??[])k.has(L)||(k.add(L),M.push(L))}return k},l=new Map;for(const h of a){const k=i(h);l.has(k)||l.set(k,[]),l.get(k).push(h)}for(const[h,k]of l)k.sort((M,T)=>d(M)-d(T)||M.localeCompare(T));const x=Array.from(l.keys()).filter(h=>l.has(h)&&l.has(h+1));if(x.length===0)return;const w=h=>{const k=l.get(h)??[],M=l.get(h+1)??[],T=new Map,L=new Map;for(let E=0;E<k.length;E++)T.set(k[E],E);for(let E=0;E<M.length;E++)L.set(M[E],E);const I=[];for(const E of k)for(const _ of s[E]??[]){if(i(_)!==h+1)continue;const N=T.get(E),C=L.get(_);N==null||C==null||I.push([N,C])}return{left:k,right:M,li:T,ri:L,pairs:I}},f=(h,k,M)=>{const{li:T,ri:L,pairs:I}=w(h),E=T.get(k),_=L.get(M);if(E==null||_==null)return!0;for(const[N,C]of I)if(E<N&&_>C||E>N&&_<C)return!0;return!1},p=(h,k)=>{if((s[h]??[]).includes(k))return!1;const M=i(h),T=i(k);if(Math.abs(M-T)!==1)return!1;const L=Math.min(M,T),I=M<T?h:k,E=M<T?k:h;return f(L,I,E)?!1:(c(I,E),!0)};if(Math.random()<.55){for(let h=0;h<80;h++){const k=x[Math.floor(Math.random()*x.length)],{left:M,right:T}=w(k);if(!M.length||!T.length)continue;const L=M[Math.floor(Math.random()*M.length)],I=T[Math.floor(Math.random()*T.length)];if(p(L,I)){y(e,`ëŒ€ê²©ë³€: ê¸¸ì´ ìƒˆë¡œ ì—´ë ¸ìŠµë‹ˆë‹¤. (${L} â†” ${I})`);return}}return}const g=[];for(const h of a)for(const k of s[h]??[])h>=k||Math.abs(i(h)-i(k))===1&&g.push([h,k]);if(g.length!==0)for(let h=0;h<120;h++){const[k,M]=g[Math.floor(Math.random()*g.length)],T=(s[k]??[]).length,L=(s[M]??[]).length;if(T<=1||L<=1)continue;m(k,M);const I=Object.values(t.nodes).find(_=>_.kind==="START")?.id??t.pos;if(u(I).size===a.length&&a.every(_=>(s[_]??[]).length>=1)){y(e,`ëŒ€ê²©ë³€: ê¸¸ì´ ë¬´ë„ˆì¡ŒìŠµë‹ˆë‹¤. (${k} â†” ${M})`);return}c(k,M)}}function Ke(e,t,n){const r={},o=[];for(r[t]=0,o.push(t);o.length;){const s=o.shift(),a=r[s]??0;if(a>=n)continue;const i=e.edges[s]??[];for(const d of i)r[d]==null&&(r[d]=a+1,o.push(d))}return r}function mn(e){const t=e;return t.seen||(t.seen={}),t.seen[e.pos]=3,t.seen}function ra(e,t){const n=mn(e),r=Math.max(0,t.presenceR|0),o=Ke(e,e.pos,r);for(const s of Object.keys(o)){const a=o[s]??0,i=vt(a,t),d=n[s]??0;i>d&&(n[s]=i)}n[e.pos]=3}function oa(e,t){return(e.seen??{})[t]??0}function Sr(e,t=2){const n=Object.keys(e.nodes);if(n.length<=2)return;e.edges??={};for(const u of Object.keys(e.edges))for(const l of(e.edges[u]??[]).slice())e.edges[l]??=[],e.edges[l].includes(u)||e.edges[l].push(u);const r=u=>Number(e.nodes[u]?.depth??999),o=u=>Number(e.nodes[u]?.order??0),s=u=>(e.edges[u]??[]).length,a=n.every(u=>{const l=r(u);return l>=0&&l<900&&typeof e.nodes[u]?.order=="number"}),i=new Map;if(a){for(const u of n){const l=r(u);i.has(l)||i.set(l,[]),i.get(l).push(u)}for(const[u,l]of i)l.sort((x,w)=>o(x)-o(w)||x.localeCompare(w))}const d=u=>{const l=i.get(u)??[],x=i.get(u+1)??[],w=new Map,f=new Map;for(let b=0;b<l.length;b++)w.set(l[b],b);for(let b=0;b<x.length;b++)f.set(x[b],b);const p=[];for(const b of l)for(const g of e.edges[b]??[]){if(r(g)!==u+1)continue;const h=w.get(b),k=f.get(g);h==null||k==null||p.push([h,k])}return{left:l,right:x,li:w,ri:f,pairs:p}},c=(u,l)=>{const x=r(u);if(r(l)!==x+1)return!0;const{li:f,ri:p,pairs:b}=d(x),g=f.get(u),h=p.get(l);if(g==null||h==null)return!0;for(const[k,M]of b)if(g<k&&h>M||g>k&&h<M)return!0;return!1},m=u=>{e.edges[u]??=[];const l=new Set(e.edges[u]??[]),x=r(u);let w=n.filter(p=>p!==u&&!l.has(p));if(w.length===0||a&&(w=w.filter(p=>Math.abs(r(p)-x)===1),w.length===0||(w=w.filter(p=>{const b=r(u),g=r(p),h=b<g?u:p,k=b<g?p:u;return!c(h,k)}),w.length===0)))return!1;w.sort((p,b)=>s(b)-s(p));const f=w[0];return e.edges[u].push(f),e.edges[f]??=[],e.edges[f].push(u),!0};for(let u=0;u<200;u++){const l=n.filter(w=>s(w)<t);if(l.length===0)break;let x=!1;for(const w of l)for(;s(w)<t&&m(w);)x=!0;if(!x)break}}function sa(){const t={},n={},r=Array.from({length:18},(m,u)=>`n${u}`);n[r[0]]=[],t[r[0]]={id:r[0],kind:"START",visited:!0,cleared:!0,depth:0};for(let m=1;m<r.length;m++){const u=r[m],l=r[Math.floor(Math.random()*m)];n[u]??=[],n[l]??=[],n[u].push(l),n[l].push(u),t[u]={id:u,kind:"BATTLE",visited:!1,cleared:!1}}const o=10;for(let m=0;m<o;m++){const u=r[Math.floor(Math.random()*r.length)],l=r[Math.floor(Math.random()*r.length)];u!==l&&(n[u]??=[],n[l]??=[],!n[u].includes(l)&&(n[u].push(l),n[l].push(u)))}const s={pos:r[0],startId:r[0],nodes:t,edges:n,treasureId:r[r.length-1]};Sr(s,2);const a=Ke(s,r[0],999);let i=r[1],d=-1;for(const m of r){const u=a[m]??999;t[m].depth=u,m!==r[0]&&u>d&&(d=u,i=m)}for(const m of r)m!==r[0]&&(t[m].kind="BATTLE");const c=["BATTLE","BATTLE","BATTLE","EVENT","REST","ELITE"];for(const m of r){if(m===r[0]||m===i)continue;const u=c[Math.floor(Math.random()*c.length)];t[m].kind=u}return t[i].kind="TREASURE",{pos:r[0],startId:r[0],nodes:t,edges:n,visionNonce:1,treasureId:i}}function aa(e){const{vision:t,pursuit:n}=ct(e),r=e.run,o=Number(r.timeMove??0)||0,s=t;s.forceModeUntilMove!=null&&o>=Number(s.forceModeUntilMove)&&(s.forceModeUntilMove=null,s.forceMode=null),s.switchLockedUntilMove!=null&&o>=Number(s.switchLockedUntilMove)&&(s.switchLockedUntilMove=null);let a=s.forceMode??t.mode??"NORMAL",i=Number(t.presenceR??2)||0,d=Number(t.typeR??1)||0,c=Number(t.detailR??0)||0,m=_e(Number(t.noise??.08)||0);if(a==="FOCUS"?(i-=1,d-=1,c+=1,m*=.6):a==="WIDE"&&(i+=1,d+=1,c+=0,m=_e(m*1.35)),e.run.treasureObtained){const l=st(n.heat??0);i+=l>=2?1:0,d-=l,c-=Math.max(0,l-1),m=_e(m+l*.07)}const u=Math.max(0,Number(e.player.fatigue??0)||0);if(u>0){const l=Math.floor(u/14),x=Math.floor(u/6),w=Math.floor(u/10);i-=l,d-=x,c-=w,m=_e(m+Math.min(.3,u*.015))}return i=Lt(i,0,99),d=Lt(d,0,i),c=Lt(c,0,d),m=_e(m),{mode:a,presenceR:i,typeR:d,detailR:c,noise:m}}function vt(e,t){return e<=0||e<=t.detailR?3:e<=t.typeR?2:e<=t.presenceR?1:0}function St(e,t,n,r,o){if(r===0)return{shown:null,label:"ë³´ì´ì§€ ì•ŠìŒ",certainty:"HIDDEN"};if(r===1)return{shown:null,label:"ë¬´ì–¸ê°€",certainty:"PRESENCE"};if(n==="START")return{shown:null,label:"ì…êµ¬",certainty:r===3?"DETAIL":"TYPE"};if(n==="EMPTY")return{shown:null,label:"ì§€ë‚˜ê°„ ê³³",certainty:"PRESENCE"};if(r===3)return{shown:n,label:ot(n,!1).text,certainty:"DETAIL"};const s=Un(t)^Math.imul(Un(String(e.run.map?.visionNonce??1)),2654435761);return ta(s)<o.noise?{shown:null,label:"ë¬´ì–¸ê°€",certainty:"PRESENCE"}:{shown:n,label:ot(n,!1).text,certainty:"TYPE"}}function ia(e,t){const n=S("mapNodeLine");if(n.style.cssText=`display:flex; gap:${A(8)}px; align-items:center;`,t.shown)ea(n,t.shown,!1);else{const r=document.createElement("span");r.className="nodeText",r.textContent=`(${t.label})`,n.appendChild(r)}e.appendChild(n)}function la(e){const t=Object.keys(e.nodes);if(t.length===0||t.every(s=>{const a=e.nodes[s]?.depth,i=Number(a);return a!=null&&Number.isFinite(i)&&i>=0&&i<900}))return;const r=Object.values(e.nodes).find(s=>s.kind==="START")?.id??e.pos??t[0],o=Ke(e,r,999);for(const s of t){const a=e.nodes[s]?.depth;if(a!=null&&Number.isFinite(Number(a))&&Number(a)<900)continue;const i=o[s];e.nodes[s].depth=i??e.nodes[s].depth??999}}function ca(e){la(e);const t=Object.keys(e.nodes),n=t.every(E=>typeof e.nodes[E]?.order=="number"),r=new Map;let o=0;for(const E of t){const _=Number(e.nodes[E]?.depth??999),N=Number.isFinite(_)?_:999;o=Math.max(o,N),r.has(N)||r.set(N,[]),r.get(N).push(E)}const s=Array.from(r.keys()).sort((E,_)=>E-_),a=s.filter(E=>E<900).length?Math.max(...s.filter(E=>E<900)):o,i=s.some(E=>E>=900),d=a+(i?1:0),c=110,m=64,u=54,l=40,x=E=>{const _=Number(e.nodes[E]?.depth??999),N=Number.isFinite(_)?_:999;return N>=900?a+1:N},w=Array.from({length:d+1},(E,_)=>_),f={};for(const E of w)f[E]=[];for(const E of t){const _=x(E);f[_].push(E)}for(const E of w)f[E].sort((_,N)=>(e.nodes[_].order??0)-(e.nodes[N].order??0)||_.localeCompare(N));const p=E=>{const _=new Map,N=f[E]??[];for(let C=0;C<N.length;C++)_.set(N[C],C);return _},b=E=>e.edges[E]??[],g=E=>{if(E==="LR")for(let _=1;_<=d;_++){const N=f[_-1];if(!N||N.length===0)continue;const C=p(_-1);f[_].sort((v,$)=>{const D=h(v,C,_-1),F=h($,C,_-1);return D!==F?D-F:v.localeCompare($)})}else for(let _=d-1;_>=0;_--){const N=f[_+1];if(!N||N.length===0)continue;const C=p(_+1);f[_].sort((v,$)=>{const D=h(v,C,_+1),F=h($,C,_+1);return D!==F?D-F:v.localeCompare($)})}},h=(E,_,N)=>{const C=b(E);let P=0,v=0;for(const $ of C){if(x($)!==N)continue;const D=_.get($);D!=null&&(P+=D,v+=1)}if(v===0){const $=x(E),D=(f[$]??[]).indexOf(E);return D<0?9999:D}return P/v};if(!n)for(let E=0;E<4;E++)g("LR"),g("RL");let k=1;for(const E of w)k=Math.max(k,f[E]?.length??0);const M=k*m,T=l*2+M,L=u*2+(d+1)*c,I={};for(const E of w){const _=f[E]??[],N=_.length,C=N*m,P=(M-C)/2,v=u+E*c;for(let $=0;$<N;$++){const D=_[$],F=l+P+($+.5)*m;I[D]={x:v,y:F,depth:Number(e.nodes[D]?.depth??999)}}}return{width:L,height:T,pos:I,maxDepth:d,maxCount:k}}function da(e,t,n){return n?"â—":t==="HIDDEN"?"":t==="PRESENCE"?"Â·":e?ot(e,!1).icon:"?"}function ua(e,t,n,r,o,s){const a=ca(r),i=mn(r),d=Ke(r,r.pos,Math.max(0,o.presenceR|0)),c=W=>W===r.pos||(i[W]??0)>0,m=Object.keys(r.nodes).filter(c);m.includes(r.pos)||m.push(r.pos);const u=70;let l=1/0,x=1/0,w=-1/0,f=-1/0;for(const W of m){const j=a.pos[W];j&&(l=Math.min(l,j.x),x=Math.min(x,j.y),w=Math.max(w,j.x),f=Math.max(f,j.y))}Number.isFinite(l)||(l=0,x=0,w=300,f=200);const p=l-u,b=x-u,g=w-l+u*2,h=f-x+u*2,k=1.4,M=460,T="#0B0B0B",L="#1A0B0B",I="rgba(242,241,234,.70)",E="rgba(242,241,234,.34)",_="rgba(242,241,234,1)",N="rgba(179,74,70,.34)",C=L,P=T,v=S("mapMiniBox");v.style.cssText=`margin-top:${A(12)}px; border:1px solid rgba(255,255,255,.12); border-radius:${A(12)}px; background:rgba(0,0,0,.18); padding:${A(10)}px;`;const $=Y("","ì§€ë„");$.style.cssText=`font-weight:700; margin-bottom:${A(8)}px; opacity:.95;`,v.appendChild($);const D=S("mapMiniScroller"),F=S("mapMiniViewport");D.appendChild(F),D.style.cssText=`position:relative; overflow:auto; max-height:${A(M)}px; border-radius:${A(10)}px; background:rgba(255,255,255,.02);`,F.addEventListener("wheel",W=>{Math.abs(W.deltaY)>Math.abs(W.deltaX)&&(F.scrollLeft+=W.deltaY,W.preventDefault())},{passive:!1});const H=document.createElementNS("http://www.w3.org/2000/svg","svg");H.setAttribute("viewBox",`${p} ${b} ${g} ${h}`),H.setAttribute("width",String(A(g*k))),H.setAttribute("height",String(A(h*k))),H.setAttribute("preserveAspectRatio","xMidYMid meet"),H.style.display="block";const U=me("assets/ui/background/map_bg.png"),B=document.createElementNS("http://www.w3.org/2000/svg","image");B.setAttribute("href",U),B.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",U),B.setAttribute("x",String(p)),B.setAttribute("y",String(b)),B.setAttribute("width",String(g)),B.setAttribute("height",String(h)),B.setAttribute("preserveAspectRatio","none"),B.setAttribute("opacity","0.22"),H.appendChild(B);const K=document.createElementNS("http://www.w3.org/2000/svg","g"),z=document.createElementNS("http://www.w3.org/2000/svg","g");H.appendChild(K),H.appendChild(z);const V=new Set(r.edges[r.pos]??[]),X=(W,j,J)=>{const ee=Math.max(0,Math.min(3,J));return St(t,W,j,ee,{...o,noise:0})},dt=(W,j)=>{const J=W.x,ee=W.y,se=j.x,ae=j.y,ue=Math.abs((W.depth??0)-(j.depth??0));if(ue===0)return`M ${J} ${ee} L ${se} ${ae}`;if(ue>=2){const Mt=38+10*ue,ie=Math.max(J,se)+Mt;return`M ${J} ${ee} C ${ie} ${ee}, ${ie} ${ae}, ${se} ${ae}`}const Ae=se-J,ve=J+Ae*.35,ze=J+Ae*.65;return`M ${J} ${ee} C ${ve} ${ee}, ${ze} ${ae}, ${se} ${ae}`},Ir=new Set(m);for(const W of m)for(const j of r.edges[W]??[]){if(W>=j||!Ir.has(j))continue;const J=r.nodes[W]?.depth,ee=r.nodes[j]?.depth;if(J!=null&&ee!=null&&Math.abs(Number(J)-Number(ee))>1)continue;const se=a.pos[W],ae=a.pos[j];if(!se||!ae)continue;const ue=document.createElementNS("http://www.w3.org/2000/svg","path");ue.setAttribute("d",dt(se,ae)),ue.setAttribute("fill","none"),ue.setAttribute("stroke",I),ue.setAttribute("stroke-width","2"),K.appendChild(ue)}const Lr=m.slice().sort((W,j)=>W.localeCompare(j));for(const W of Lr){const j=a.pos[W];if(!j)continue;const J=r.nodes[W],ee=J?.kind??"BATTLE",se=d[W],ae=W===r.pos?3:se==null?0:vt(se,o),ue=i[W]??0,Ae=ae>0?St(t,W,ee,ae,o):X(W,ee,ue),ve=W===r.pos,ze=V.has(W),Mt=ee==="START",ie=document.createElementNS("http://www.w3.org/2000/svg","circle");ie.setAttribute("cx",String(j.x)),ie.setAttribute("cy",String(j.y)),ie.setAttribute("r",String(ve?13:10));const gn=ve||ze;ie.setAttribute("fill",gn?N:E),ie.setAttribute("stroke",gn?C:_),ie.setAttribute("stroke-width",String(ve?3:2)),ie.style.cursor=ze&&!ve?"pointer":"default",ze&&!ve&&ie.addEventListener("click",Cn=>{Cn.preventDefault(),Cn.stopPropagation(),n.onMoveToNode?.(W)});const En=document.createElementNS("http://www.w3.org/2000/svg","title"),Hr=J?.cleared?"í´ë¦¬ì–´":J?.visited?"ë°©ë¬¸":"ë¯¸ë°©ë¬¸";En.textContent=`${Hr}`,ie.appendChild(En),z.appendChild(ie);const le=document.createElementNS("http://www.w3.org/2000/svg","text");le.setAttribute("x",String(j.x)),le.setAttribute("y",String(j.y)),le.setAttribute("dy","0.05em"),le.setAttribute("dominant-baseline","central"),le.setAttribute("text-anchor","middle"),le.setAttribute("font-size","14"),le.setAttribute("fill",P),le.style.pointerEvents="none",le.style.userSelect="none";const Dr=da(Ae.shown,Ae.certainty,Mt);le.textContent=Dr,le.style.opacity="0.95",z.appendChild(le)}F.appendChild(H),v.appendChild(D),requestAnimationFrame(()=>{const W=a.pos[r.pos];if(!W)return;const j=mr(),J=(W.x-p)*j*k,ee=(W.y-b)*j*k,se=Math.max(0,J-F.clientWidth*.45),ae=Math.max(0,ee-F.clientHeight*.45);F.scrollLeft=se,F.scrollTop=ae});const Tn=Y("","ê´€ì¸¡ ê°€ëŠ¥í•œ ê³³ë§Œ ì§€ë„ì— ë“œëŸ¬ë‚©ë‹ˆë‹¤. ì¸ì ‘ ë…¸ë“œë¥¼ í´ë¦­í•´ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");Tn.style.cssText=`margin-top:${A(8)}px; font-size:12px; opacity:.8; line-height:1.3;`,v.appendChild(Tn),e.appendChild(v)}function pa(e,t,n){const{map:r,timeMove:o,pursuit:s}=ct(t),a=aa(t);ra(r,a);const i=S("nodeSelectWrap");i.classList.add("mapNodeSelect");const d=S("nodeSelectHeader");d.style.cssText="display:flex; align-items:flex-end; justify-content:space-between; gap:16px;";const c=S("nodeSelectTitle"),m=vr(t),u=t.run.nodePickCount??0;c.appendChild(Y("",`ì´ ì‹œê°„ ${m} Â· íƒí—˜ ${u} Â· ì´ë™ ${o}`)),br(t);const l=t.run,x=Number(l.nextBossTime??40)||40,w=Math.max(0,x-m),f=t.run.bossOmenText&&String(t.run.bossOmenText).trim()!==""?String(t.run.bossOmenText):"ì•„ì§ ì§•ì¡°ê°€ ì—†ë‹¤.";if(c.appendChild(Y("",`ë‹¤ìŒ ë³´ìŠ¤ê¹Œì§€ ${w} Â· ${f}`)),t.run.treasureObtained){const h=Ke(r,r.pos,9999)[r.startId],k=h==null?"?":String(h);c.appendChild(Y("",`ì¶”ê²© ${s.heat??0} (tier ${st(s.heat??0)}) Â· ì…êµ¬ê¹Œì§€ ${k}`))}const p=S("nodeSelectHeaderRight"),b=Y("",`ì˜¤ë¥˜ ${Math.round(a.noise*100)}%`);b.style.opacity="0.8",p.appendChild(b);const g=ne(He?"ìƒì„¸ ë‹«ê¸°":"ìƒì„¸",()=>{He=!He,R(t,n)});if(g.style.cssText=`margin-left:${A(-10)}px; padding:${A(2)}px ${A(5)}px; opacity:.9;`,p.appendChild(g),d.appendChild(c),d.appendChild(p),i.appendChild(d),ua(i,t,n,r,a),He){const h=S("mapDetailPanel");h.style.cssText=`position:fixed; right:${A(24)}px; top:${A(24)}px; width:min(${A(520)}px, calc(100vw - ${A(64)}px)); max-height:calc(100vh - ${A(64)}px); overflow-y:auto; overflow-x:hidden; z-index:70001; border:1px solid rgba(255,255,255,.14); border-radius:${A(14)}px; background:rgba(0,0,0,1); backdrop-filter:none; padding:${A(12)}px;`,h.addEventListener("click",N=>N.stopPropagation()),h.addEventListener("wheel",N=>N.stopPropagation(),{passive:!0});const k=N=>{const C=N.target;C&&h.contains(C)||(He=!1,document.removeEventListener("pointerdown",k,!0),R(t,n))},M=S("");M.style.cssText=`display:flex; align-items:center; justify-content:space-between; gap:${A(10)}px;`;const T=Y("","ì§€ë„ ìƒì„¸");T.style.cssText="font-weight:700; opacity:.95;",M.appendChild(T);const L=ne("ë‹«ê¸°",()=>{He=!1,R(t,n)});L.style.cssText=`padding:${A(6)}px ${A(10)}px; opacity:.9;`,M.appendChild(L),h.appendChild(M);const I=S("");I.style.cssText=`margin-top:${A(10)}px; padding:${A(10)}px; border:1px solid rgba(255,255,255,.10); border-radius:${A(12)}px; background:rgba(255,255,255,.03);`;const E=Vt("ì´ë™ ê°€ëŠ¥í•œ ì´ì›ƒ");E.style.margin=`0 0 ${A(6)}px 0`,I.appendChild(E);const _=r.edges[r.pos]??[];_.length===0&&I.appendChild(hn("ì´ì›ƒì´ ì—†ìŠµë‹ˆë‹¤."));for(let N=0;N<_.length;N++){const C=_[N],v=r.nodes[C]?.kind??"BATTLE",$=a.presenceR>=1?vt(1,a):0,D=oa(r,C),F=$>0?St(t,C,v,$,a):D>=2?v==="START"?{shown:null,label:"ì…êµ¬"}:{shown:v,label:ot(v,!1).text}:D===1?{shown:null,label:"ë¬´ì–¸ê°€"}:{shown:null,label:"ë³´ì´ì§€ ì•ŠìŒ"},H=S("");H.style.cssText=`display:flex; align-items:center; gap:${A(10)}px; padding:${A(8)}px ${A(10)}px; border-radius:${A(10)}px; border:1px solid rgba(255,255,255,.10); background:rgba(0,0,0,.20);margin-top:${A(6)}px;`;const U=Y("",$>0||D>0?`${C}`:`ì¶œêµ¬ ${N+1}`);U.style.cssText=`flex:0 0 auto; padding:${A(4)}px ${A(8)}px; border-radius:${A(10)}px; border:1px solid rgba(255,255,255,.14); background:rgba(0,0,0,.25); opacity:.9;`,H.appendChild(U);const B=S("");B.style.cssText="flex:1 1 auto; min-width:0;",ia(B,F),H.appendChild(B),I.appendChild(H)}if(h.appendChild(I),a.presenceR>=2){const N=Ke(r,r.pos,a.presenceR),C=Object.keys(N).filter(P=>(N[P]??999)>=2&&(N[P]??999)<=a.presenceR).sort((P,v)=>N[P]-N[v]||P.localeCompare(v));if(C.length){const P=S("");P.style.cssText=`margin-top:${A(10)}px; padding:${A(10)}px; border:1px solid rgba(255,255,255,.10); border-radius:${A(12)}px; background:rgba(255,255,255,.03);`;const v=Vt("ë©€ë¦¬ ë³´ì´ëŠ” ê³³");v.style.margin=`0 0 ${A(6)}px 0`,P.appendChild(v);const $=new Map;for(const F of C){const H=N[F]??0,B=r.nodes[F]?.kind??"BATTLE",K=vt(H,a),z=St(t,F,B,K,a),V=z.certainty==="PRESENCE"?"ë¬´ì–¸ê°€":z.label,X=$.get(H)??{};X[V]=(X[V]??0)+1,$.set(H,X)}const D=Array.from($.keys()).sort((F,H)=>F-H);for(const F of D){const H=$.get(F),U=Object.keys(H).map(B=>`${B}Ã—${H[B]}`);P.appendChild(Y("",`ê±°ë¦¬ ${F}: ${U.join(" Â· ")}`))}h.appendChild(P)}}document.addEventListener("pointerdown",k,!0),e.appendChild(h)}e.appendChild(i)}function fa(e,t,n){ct(t),pa(e,t,n)}function wr(e,t){let n=null,r=!1,o=!1;const s=[];function a(f){s.length=0,f.choice=null,n=null,document.querySelector(".choice-overlay")?.remove()}function i(f){s.push({choice:f.choice,handler:n})}function d(f){const p=s.pop();if(!p){c(f);return}f.choice=p.choice,n=p.handler}function c(f){if(s.length>0){d(f);return}f.choice=null,n=null,document.querySelector(".choice-overlay")?.remove()}function m(f,p,b){f.choice&&i(f),f.choice=p,n=b}const u=()=>fe||e,l={onHotkeySlot:(f,p)=>{const b=u();if(b.run.finished||Z(b)||b.phase!=="PLACE"||f==="back"&&b.backSlotDisabled?.[p])return;const g=f==="front"?b.frontSlots:b.backSlots,h=g[p];if(!b.selectedHandCardUid){if(!h)return;l.onReturnSlotToHand(f,p);return}const k=b.selectedHandCardUid;if(!h){l.onPlaceHandUidToSlot(k,f,p);return}g[p]=null,b.usedThisTurn=Math.max(0,b.usedThisTurn-1),f==="front"&&(b.frontPlacedThisTurn=Math.max(0,b.frontPlacedThisTurn-1)),b.hand.push(h),b.cards[h].zone="hand",_n(b,k,f,p),b.selectedHandCardUid=null,y(b,`[${ce(b,k)}] â†” [${ce(b,h)}] ìŠ¤ì™‘: ì†íŒ¨ â†” ${f}${p+1}`),R(b,l)},rerender:()=>{const f=u();R(f,l)},onToggleLogOverlay:()=>{Gt=!Gt,R(u(),l)},onCloseOverlay:()=>{const f=u();q=null,R(f,l)},onNewRun:()=>{const f=u();be=null,q=null,O=null,c(f),us(),t(Ot(f.content))},onViewRulebook:()=>{const f=u();q={kind:"RULEBOOK"},R(f,l)},onViewPile:f=>{const p=u();q={kind:"PILE",pile:f},R(p,l)},onViewSettings:()=>{const f=u();q={kind:"SETTINGS"},R(f,l)},onReturnSlotToHand:(f,p)=>{const b=u();if(b.run.finished||Z(b)||b.phase!=="PLACE")return;const g=f==="front"?b.frontSlots:b.backSlots,h=g[p];h&&(g[p]=null,b.usedThisTurn=Math.max(0,b.usedThisTurn-1),f==="front"&&(b.frontPlacedThisTurn=Math.max(0,b.frontPlacedThisTurn-1)),b.hand.push(h),b.cards[h].zone="hand",y(b,`[${ce(b,h)}] íšŒìˆ˜: ${f}${p+1} â†’ ì†íŒ¨`),R(b,l))},onClearSelected:()=>{const f=u();f.selectedHandCardUid=null,R(f,l)},onSelectEnemy:f=>{const p=u();if(o)return;o=!0,requestAnimationFrame(()=>{o=!1});const b=qo(p,f);R(p,l),b&&!p.choice&&!p.run.finished&&l.onAutoAdvance()},onSelectHandCard:f=>{const p=u();Z(p)||(p.selectedHandCardUid=p.selectedHandCardUid===f?null:f,R(p,l))},onMoveToNode:f=>{const p=u();if(p.run.finished||p.choice||p.phase!=="NODE"||r)return;r=!0,setTimeout(()=>r=!1,180);const b=p.run,{map:g,pursuit:h}=ct(p),k=g.pos;if(!(g.edges[k]??[]).includes(f))return;b.timeMove=Number(b.timeMove??0)+1,g.visionNonce=Number(g.visionNonce??0)+1,g.pos=f;const T=g.nodes[f]??(g.nodes[f]={id:f,kind:"BATTLE"}),L=!T.visited;if(L&&(T.visited=!0,p.run.nodePickCount=(p.run.nodePickCount??0)+1),p.run.treasureObtained){if(h.heat=Number(h.heat??0)+1,st(h.heat),na(p),g.pos===g.startId){p.run.finished=!0,y(p,"ë³´ë¬¼ì„ ë“¤ê³  ì…êµ¬ë¡œ ëŒì•„ì™”ë‹¤! íƒˆì¶œì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤!"),R(p,l);return}L&&T.kind!=="TREASURE"&&T.kind!=="START"&&(p.run.afterTreasureNodePicks=(p.run.afterTreasureNodePicks??0)+1)}br(p);const I=vr(p);if(Number(b.nextBossTime??0)>0&&I>=Number(b.nextBossTime??0)){b.forcedNext=null,b.nextBossTime=Number(b.nextBossTime??0)+40,p.run.bossOmenText=null,T.cleared=!0,T.kind="EMPTY",T.noRespawn=!0,T.lastClearedMove=Number(b.timeMove??0),y(p,"ì‹œê°„ì´ ë‹¤ ë˜ì–´ ë³´ìŠ¤ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. (ì‹œê°„ +1)"),Ie(p,{forceBoss:!0}),qe(p),R(p,l);return}const E=Number(b.timeMove??0)||0;T.cleared&&(T.kind==="BATTLE"||T.kind==="EVENT"||T.kind==="REST"||T.kind==="ELITE")&&(T.kind==="ELITE"&&(T.noRespawn=!0),T.kind="EMPTY",T.lastClearedMove=Number(T.lastClearedMove??E));let _=T.kind;if(_==="EMPTY"){const N=!!T.noRespawn,C=Number(T.lastClearedMove??-999),P=Number(b.respawnCooldownMoves??2)||2,v=E-C<=P;if(!N&&!v){const $=p.run.treasureObtained?st(h.heat):0,D=Math.max(0,Number(p.player.fatigue??0)||0),F=_e(D/25)*.18,H=p.run.treasureObtained?.22:.12,U=p.run.treasureObtained?.1:.08,B=_e(H+$*U+F);if(Math.random()<B){const K=Math.random(),z=p.run.treasureObtained?.72:.55,V=p.run.treasureObtained?.9:.85;_=K<z?"BATTLE":K<V?"EVENT":"REST",T.kind=_,T.cleared=!1,T.respawnCount=Number(T.respawnCount??0)+1,y(p,"ì¬ë°œë™: ì´ê³³ì—ì„œ ë‹¤ì‹œ ë¬´ì–¸ê°€ê°€ ì¼ì–´ë‚©ë‹ˆë‹¤...")}}}if(_==="START"){R(p,l);return}if(_==="TREASURE"){T.cleared=!0,T.kind="EMPTY",T.noRespawn=!0,T.lastClearedMove=E,yo(p),R(p,l);return}if(_==="REST"){T.cleared=!0,T.kind="EMPTY",T.lastClearedMove=E;const N=(p.player.fatigue??0)>=10;p.choice={kind:"EVENT",title:"íœ´ì‹",art:me("assets/events/event_rest.png"),prompt:N?"í”¼ë¡œê°€ ë„ˆë¬´ ë†’ì•„ ì‹œê°„ì´ ë” ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.":"ìº í”„ì— ì ì‹œ ë¨¸ë¬¸ë‹¤.",options:[{key:"rest:heal",label:"íšŒë³µ",detail:"HP +15"},{key:"rest:clear_f",label:"ì •ë¹„",detail:"F -3"},{key:"rest:upgrade",label:"ê°•í™”",detail:"ì¹´ë“œ 1ì¥ ê°•í™”"},{key:"rest:skip",label:"ë– ë‚˜ê¸°"}]},p.choiceCtx={kind:"REST",highF:N},R(p,l);return}if(_==="EVENT"){T.cleared=!0,T.kind="EMPTY",T.lastClearedMove=E;const N=p.run;N.ominousProphecySeen??=!1;const C=.3;let P=An(p);if(N.ominousProphecySeen===!0)for(let $=0;$<50&&P.id==="ominous_prophecy";$++)P=An(p);else Math.random()<C&&(P=cr("ominous_prophecy")??P,N.ominousProphecySeen=!0);if(!P){R(p,l);return}let v=P.options(p);p.choice={kind:"EVENT",title:P.name,prompt:P.prompt,art:P.art??null,options:v.map($=>({key:$.key,label:$.label,detail:$.detail}))},n=$=>{const D=v.find(U=>U.key===$);if(!D)return;const F=xe(p);F.eventPicks+=1,pe(p);const H=D.apply(p);if(typeof H=="object"&&H.kind==="UPGRADE_PICK"){w(p,l,H.title??"ê°•í™”",H.prompt??"ê°•í™”í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.");return}if(typeof H=="object"&&H.kind==="REMOVE_PICK"){const U=Object.values(p.cards).filter(B=>B.zone==="deck"||B.zone==="hand"||B.zone==="discard").map(B=>B.uid);m(p,{kind:"PICK_CARD",title:H.title,prompt:H.prompt??"ì œê±°í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",options:[...U.map(B=>{const K=Tt(p,B);return{key:`remove:${B}`,label:ce(p,B),detail:`ì „ì—´: ${K.frontText} / í›„ì—´: ${K.backText}`,cardUid:B}}),{key:"cancel",label:"ì·¨ì†Œ"}]},B=>{if(B==="cancel"){y(p,"ì œê±° ì·¨ì†Œ"),c(p),R(p,l);return}if(!B.startsWith("remove:")){R(p,l);return}const K=B.slice(7);wt(p,K);const z=H.then,V=z==="REWARD"||z==="REWARD_PICK"?"REWARD_PICK":z==="BATTLE"?"BATTLE":z==="NONE"?"NONE":void 0;if(V==="BATTLE"){a(p),p.phase="NODE",Ie(p),qe(p),R(p,l);return}if(V==="REWARD_PICK"){a(p),x(p,l,"ì¹´ë“œ ë³´ìƒ","ë‘ ì¥ ì¤‘ í•œ ì¥ì„ ì„ íƒí•˜ê±°ë‚˜ ìƒëµí•©ë‹ˆë‹¤."),R(p,l);return}a(p),p.phase="NODE",R(p,l)}),R(p,l);return}if(typeof H=="object"&&H.kind==="BATTLE_SPECIAL"){a(p),y(p,H.title?`ì´ë²¤íŠ¸ ì „íˆ¬: ${H.title}`:"ì´ë²¤íŠ¸ ì „íˆ¬ ë°œìƒ!"),p.phase="NODE",Ie(p,{forcePatternIds:H.enemyIds}),p._justStartedCombat=!0,qe(p),R(p,l);return}if(H==="BATTLE"){a(p),p.phase="NODE",Ie(p),p._justStartedCombat=!0,qe(p),R(p,l);return}if(H==="REWARD"){a(p),x(p,l,"ì¹´ë“œ ë³´ìƒ","ë‘ ì¥ ì¤‘ í•œ ì¥ì„ ì„ íƒí•˜ê±°ë‚˜ ìƒëµí•©ë‹ˆë‹¤."),R(p,l);return}c(p),R(p,l)},R(p,l);return}if(_==="BATTLE"||_==="ELITE"){T.cleared=!0,T.kind="EMPTY",T.lastClearedMove=E,_==="ELITE"&&(T.noRespawn=!0),y(p,"ì´ë™ í›„ ì „íˆ¬ ì‹œì‘ (ì‹œê°„ +1)"),_==="ELITE"?Ie(p,{forceBoss:!1,forceElite:!0}):Ie(p,{forceBoss:!1}),qe(p),R(p,l);return}R(p,l)},onChooseChoice:f=>{const p=u();if(!p.choice)return;const b=p.choice.kind;if(ls(p,f)){const g=b==="EVENT"&&f==="startBattle";R(p,l),g||l.onAutoAdvance();return}if(n){n(f);const g=b==="EVENT"&&f==="startBattle";R(p,l),g||l.onAutoAdvance();return}y(p,`ì„ íƒ ì²˜ë¦¬ ë¶ˆê°€: handler ì—†ìŒ (kind=${b}, key=${f})`)},onAutoAdvance:()=>{const f=u();Hs(f,l)},onRevealIntents:()=>{const f=u();f.run.finished||f.enemies.length!==0&&(sn(f),R(f,l))},onPlaceHandUidToSlot:(f,p,b)=>{const g=u();g.run.finished||Z(g)||g.phase==="PLACE"&&(p==="back"&&g.backSlotDisabled?.[b]||(_n(g,f,p,b),g.selectedHandCardUid=null,R(g,l)))},onPlaceSelected:(f,p)=>{const b=u();b.selectedHandCardUid&&l.onPlaceHandUidToSlot(b.selectedHandCardUid,f,p)},onMoveSlotCard:(f,p,b,g)=>{const h=u();if(h.run.finished||Z(h)||h.phase!=="PLACE"||b==="back"&&h.backSlotDisabled?.[g])return;const k=f==="front"?h.frontSlots:h.backSlots,M=b==="front"?h.frontSlots:h.backSlots,T=k[p];if(!T)return;const L=M[g];k[p]=L??null,M[g]=T,h.cards[T].zone=b,L&&(h.cards[L].zone=f),f!==b&&(f==="front"&&(h.frontPlacedThisTurn=Math.max(0,h.frontPlacedThisTurn-1)),b==="front"&&(h.frontPlacedThisTurn+=1),L&&(b==="front"&&(h.frontPlacedThisTurn=Math.max(0,h.frontPlacedThisTurn-1)),f==="front"&&(h.frontPlacedThisTurn+=1))),y(h,L?`[${ce(h,T)}] â†” [${ce(h,L)}] ìŠ¤ì™‘: ${f}${p+1} â†” ${b}${g+1}`:`[${ce(h,T)}] ì´ë™: ${f}${p+1} â†’ ${b}${g+1}`),Qt(h),R(h,l)},onResolveBack:()=>{const f=u();f.phase==="PLACE"&&Qt(f),Ho(f),R(f,l)},onResolveFront:()=>{const f=u();Do(f),R(f,l)},onResolveEnemy:()=>{const f=u();Oo(f),R(f,l)},onUpkeep:()=>{const f=u();Uo(f),R(f,l)},onDrawNextTurn:()=>{const f=u();zo(f),R(f,l)}};function x(f,p,b,g){const k=tr(f).map(M=>{const T=ye(f.content,M.defId,M.upgrade);return{key:`pick:${M.defId}:${M.upgrade}`,label:zs(f,M),detail:`ì „ì—´: ${T.frontText} / í›„ì—´: ${T.backText}`}});f.choice={kind:"REWARD",title:b,prompt:g,options:[...k,{key:"skip",label:"ìƒëµ"}]},n=M=>{if(n=null,M.startsWith("pick:")){const T=M.slice(5),[L,I]=T.split(":"),E=Number(I??"0")||0;an(f,L,{upgrade:E})}else y(f,"ì¹´ë“œ ë³´ìƒ ìƒëµ");c(f),f.choice=null,f.run.finished||(f.phase="NODE"),R(f,p)},R(f,p)}function w(f,p,b,g,h){let k=Object.values(f.cards).filter(I=>(I.zone==="deck"||I.zone==="hand"||I.zone==="discard")&&ln(f,I.uid)).map(I=>I.uid);const M=f.player.fatigue??0;let T=1/0;if(M>=8?T=4:M>=5&&(T=8),T!==1/0&&k.length>T&&(k=[...k].sort(()=>Math.random()-.5).slice(0,T)),k.length===0){y(f,"ê°•í™”í•  ìˆ˜ ìˆëŠ” ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤."),f.choice=null,n=null,R(f,p);return}const L=[...k].sort((I,E)=>{const _=f.cards[I],N=f.cards[E],C=gt(f,_.defId),P=gt(f,N.defId),v=C.localeCompare(P,"ko");return v!==0?v:(_.upgrade??0)-(N.upgrade??0)});f.choice={kind:"UPGRADE_PICK",title:b,prompt:g,options:[...L.map(I=>{const E=f.cards[I],_=Tt(f,I),N=ye(f.content,E.defId,(E.upgrade??0)+1),C=ce(f,I),P=`í˜„ì¬: ì „ì—´ ${_.frontText} / í›„ì—´ ${_.backText}
ê°•í™”: ì „ì—´ ${N.frontText} / í›„ì—´ ${N.backText}`;return{key:`up:${I}`,label:C,detail:P,cardUid:I}}),{key:"skip",label:"ì·¨ì†Œ"}]},n=I=>{if(I==="skip"){y(f,"ê°•í™” ì·¨ì†Œ"),c(f),R(f,p);return}if(I.startsWith("up:")){const E=I.slice(3),_=rr(f,E);y(f,_?`ê°•í™”: [${ce(f,E)}]`:"ê°•í™” ì‹¤íŒ¨"),c(f),R(f,p);return}c(f),R(f,p)},R(f,p)}return l}function Qt(e){const t=e.frontSlots.filter(r=>r!=null).length,n=e.backSlots.filter(r=>r!=null).length;e.frontPlacedThisTurn=t,e.usedThisTurn=t+n}function ha(){Es();const e=document.querySelector("#app");return e.innerHTML="",e}function ne(e,t,n=""){const r=document.createElement("button");return n&&(r.className=n),r.type="button",r.textContent=e,r.onclick=t,r}function bn(){const e=Array.from(document.querySelectorAll(".enemyName"));if(e.length===0)return;e.forEach(o=>{o.style.display="inline-block",o.style.width="auto",o.style.whiteSpace="nowrap"});let t=0;for(const o of e)t=Math.max(t,o.scrollWidth);const r=Math.min(t,320);e.forEach(o=>{o.style.width=`${r}px`,o.style.overflow="hidden",o.style.textOverflow="ellipsis"})}function ma(){document.querySelector(".phaseBanner")?.remove(),performance.now()}function ba(){$s();let e=document.querySelector(".floatFxLayer");e||(e=document.createElement("div"),e.className="floatFxLayer",document.body.appendChild(e)),e.style.cssText="position:fixed; inset:0;pointer-events:none;z-index: var(--zChrome);";for(const t of kt){const n=String(t.id);let r=e.querySelector(`.floatNum[data-fx-id="${n}"]`);r?(r.style.left=`${Math.round(t.x)}px`,r.style.top=`${Math.round(t.y)}px`):(r=document.createElement("div"),r.className=`floatNum ${t.kind}`,r.dataset.fxId=n,r.textContent=t.text,r.style.position="absolute",r.style.left=`${Math.round(t.x)}px`,r.style.top=`${Math.round(t.y)}px`,e.appendChild(r))}}function ya(){if(document.querySelector(".floatingNewRun"))return;const e=document.createElement("button");e.className="floatingNewRun",e.type="button",e.textContent="ìƒˆë¡œìš´ ëŸ°",e.style.cssText=`
    position: fixed;
    top: calc(env(safe-area-inset-top, 0px) + 10px);
    left: calc(env(safe-area-inset-left, 0px) + 10px);
    pointer-events: auto;
    z-index: var(--zChrome);

    padding: 10px 12px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,.16);
    background: rgba(0,0,0,.55);
    color: #fff;

    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    cursor: pointer;
    touch-action: manipulation;
  `,e.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),pr?.()}),document.body.appendChild(e)}function R(e,t){R._uiScaleInitDone||(R._uiScaleInitDone=!0,te=hr(),_r()),fe=e,ns({getG:()=>fe??e,actions:{onNewRun:()=>t.onNewRun()},rerender:()=>R(fe??e,t),log:m=>y(fe??e,m)}),Fe(),pr=()=>t.onNewRun(),ya(),Os(),R._logInitDone||(R._logInitDone=!0,Rs());const n=document.querySelector(".mainPanel");n&&(Hn=n.scrollTop,Dn=n.scrollLeft);const r=ha();Wn||(window.addEventListener("resize",()=>{}),La(()=>fe??e,t),Wn=!0),r.appendChild(wa(e,t));const o=S("mainRow"),s=S("stage"),a=S("stageInner"),i=S("panel mainPanel"),d=!e.run.finished&&e.enemies.length>0&&e.phase!=="NODE";i.classList.toggle("inCombat",d),i.scrollTop=Hn,i.scrollLeft=Dn,i.appendChild($a(e)),e.run.finished?i.appendChild(hn("ëŸ° ì¢…ë£Œ. ìƒˆë¡œìš´ ëŸ°ì„ ì›í•˜ì‹œë©´ ë²„íŠ¼ì„ ëˆ„ë¥´ê±°ë‚˜ í‚¤ë³´ë“œ Pë¥¼ ì…ë ¥í•˜ì‹­ì‹œì˜¤.")):e.phase==="NODE"?fa(i,e,t):Pa(i,e,t),a.appendChild(i),s.appendChild(a);const c=S("panel logPanel");if(c.classList.toggle("collapsed",we),c.appendChild(Ma(we,()=>{we=!we,Is(),R(e,t)})),c.classList.add("logScroll"),!we){const m=Ks(e.log.join(`
`));m.classList.add("log"),c.appendChild(m)}o.appendChild(s),o.appendChild(c),r.appendChild(o),bn(),ka(e),Aa(e,t,Z(e)),kn(),xn(),Ea(),Ar(),Ca(e,{...t,onCloseOverlay:()=>{q=null,R(fe??e,t)}}),Sa(e,t),Ta(e,t),va(e,t),bt(e,t),Ms(e),ma(),ba(),xa(e,t),Ls(e),ws()}function yn(e,t){const n=Q[t]??null,r=yt(e,t),o=n?.art??n?.icon??null,s=o??null;return{id:t,name:r.name,desc:r.text,state:r.state,icon:s,art:o}}function xa(e,t){document.querySelector(".relicHud")?.remove(),document.querySelector(".relicTooltip")?.remove(),bt(e,t);const n=(e.run.relics??[]).slice();if(n.length===0)return;const r=document.createElement("div");r.className="relicHud";for(const o of n.slice().reverse()){const s=yn(e,o),a=document.createElement("div");if(a.className="relicIcon",a.setAttribute("role","button"),a.tabIndex=0,s.icon){const d=document.createElement("div");d.className="relicIconImg",d.style.backgroundImage=`url(${s.icon})`,a.appendChild(d)}else{const d=document.createElement("div");d.textContent=s.name.slice(0,2),d.style.fontWeight="900",d.style.fontSize="12px",d.style.opacity=".95",a.appendChild(d)}const i=(d,c)=>{he=o,$e={x:d,y:c},Ht(e)};a.onpointerenter=d=>i(d.clientX??0,d.clientY??0),a.onpointermove=d=>{he===o&&($e={x:d.clientX??0,y:d.clientY??0},Ht(e))},a.onpointerleave=()=>{he===o&&(he=null,$e=null,document.querySelector(".relicTooltip")?.remove())},a.onclick=d=>{d.preventDefault(),d.stopPropagation(),Me=o,he=null,$e=null,document.querySelector(".relicTooltip")?.remove(),bt(e,t)},a.onkeydown=d=>{(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),Me=o,bt(e,t))},r.appendChild(a)}document.body.appendChild(r),Ht(e)}function Ht(e){if(document.querySelector(".relicTooltip")?.remove(),!he||!$e)return;const t=yn(e,he);if(!t.desc&&!t.name)return;const n=document.createElement("div");n.className="relicTooltip";const r=document.createElement("div");if(r.className="relicTooltipTitle",r.textContent=t.name,n.appendChild(r),t.desc){const d=document.createElement("div");d.className="relicTooltipDesc",d.textContent=t.desc,n.appendChild(d)}document.body.appendChild(n);const o=12,s=n.getBoundingClientRect();let a=$e.x-s.width,i=$e.y-s.height-10;a=Math.max(o,Math.min(window.innerWidth-s.width-o,a)),i=Math.max(o,Math.min(window.innerHeight-s.height-o,i)),n.style.left=`${Math.round(a)}px`,n.style.top=`${Math.round(i)}px`}function bt(e,t){if(document.querySelector(".relicModal")?.remove(),!Me)return;const n=yn(e,Me),r=document.createElement("div");r.className="relicModal",r.style.cssText=`
    position: fixed;
    inset: 0;
    z-index: var(--zRelicModal, 70000);
    pointer-events: auto;
    background: rgba(0,0,0,.55);
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 18px;
    box-sizing: border-box;
  `,r.onclick=l=>{l.target===r&&(Me=null,R(e,t))};const o=document.createElement("div");o.className="relicModalPanel",o.onclick=l=>l.stopPropagation();const s=document.createElement("div");s.className="relicModalHeader";const a=document.createElement("h3");a.className="relicModalTitle",a.textContent=n.name,a.style.fontFamily='"ë¬¼ë§ˆë£¨", serif';const i=document.createElement("button");i.type="button",i.textContent="ë‹«ê¸°",i.className="overlayClose",i.onclick=()=>{Me=null,R(e,t)},s.appendChild(a),s.appendChild(i);const d=document.createElement("div");d.className="relicModalBody";const c=document.createElement("div");c.className="relicModalArt";const m=document.createElement("div");m.className="relicModalArtImg",n.art&&(m.style.backgroundImage=`url("${me(n.art)}")`),c.appendChild(m);const u=document.createElement("pre");u.className="relicModalDesc",u.textContent=n.desc||"",u.style.fontFamily='"ë¬¼ë§ˆë£¨", serif',d.appendChild(c),d.appendChild(u),o.appendChild(s),o.appendChild(d),r.appendChild(o),document.body.appendChild(r)}function ka(e){const t=document.querySelector(".stageInner");if(!t)return;document.querySelector(".stageCornerHud")?.remove();const n=document.createElement("div");n.className="stageCornerHud",n.textContent=_a(e),document.body.appendChild(n);const r=t.getBoundingClientRect(),o=-56,s=(r.left+r.right)/2;n.style.right="",n.style.left=`${Math.round(s)}px`,n.style.top=`${Math.round(r.top+o)}px`,n.style.transform="translateX(-50%)"}function Jt(){try{localStorage.setItem(fr,JSON.stringify(te))}catch{}}function Dt(e){const t=qt(e,.75,1.5);$t()?te.uiScaleMobile=t:te.uiScaleDesktop=t,Jt(),_r()}function Ta(e,t){if(document.querySelector(".logOverlay")?.remove(),!Gt)return;const n=S("logOverlay");n.style.cssText=`
    position: fixed; inset: 0;
    pointer-events:auto;
    background: rgba(0,0,0,.55);
    backdrop-filter: blur(6px);
    display: flex;
    align-items: flex-end;
    justify-content: center;
  `;const r=S("panel");r.style.cssText=`
    width: min(720px, 100%);
    max-height: 70vh;
    border-radius: 18px 18px 0 0;
    padding: 12px;
    margin: 0;
  `;const o=S("panelHeader"),s=document.createElement("h2");s.textContent="ë¡œê·¸",o.appendChild(s);const a=ne("ë‹«ê¸°",()=>t.onToggleLogOverlay());o.appendChild(a),r.appendChild(o);const i=document.createElement("pre");i.className="log",i.textContent=e.log.join(`
`),i.style.maxHeight="60vh",i.style.overflow="auto",r.appendChild(i),n.onclick=()=>t.onToggleLogOverlay(),r.onclick=d=>d.stopPropagation(),n.appendChild(r),document.body.appendChild(n)}function ga(e,t){const n=S("settingsPanel");n.style.cssText="display:flex; flex-direction:column; gap:12px;";const r=S("settingsRow");r.style.cssText="display:flex; align-items:center; gap:12px; flex-wrap:wrap;";const o=Y("","UI ìŠ¤ì¼€ì¼");o.style.cssText="font-weight:800;";const s=()=>$t()?te.uiScaleMobile:te.uiScaleDesktop,a=Y("",`${Math.round(s()*100)}%`);a.style.cssText="opacity:.9; min-width:64px; text-align:right;";const i=document.createElement("input");i.type="range",i.min="0.75",i.max="1.25",i.step="0.01",i.value=String(s()),i.style.cssText="flex:1 1 260px;",i.oninput=()=>{const b=Number(i.value);Dt(b),a.textContent=`${Math.round(s()*100)}%`,e()},r.appendChild(o),r.appendChild(i),r.appendChild(a),n.appendChild(r);const d=S("settingsPresets");d.style.cssText="display:flex; gap:8px; flex-wrap:wrap;";const c=(b,g)=>{const h=ne(b,()=>{Dt(g),i.value=String(s()),a.textContent=`${Math.round(s()*100)}%`,e()});return h.style.cssText="padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.16);background:rgba(255,255,255,.06); color:#fff; cursor:pointer;",h};d.appendChild(c("ì‘ê²Œ 90%",.9)),d.appendChild(c("ê¸°ë³¸ 100%",1)),d.appendChild(c("í¬ê²Œ 110%",1.1)),d.appendChild(c("ë” í¬ê²Œ 120%",1.2)),n.appendChild(d);const m=S("settingsResetRow");m.style.cssText="display:flex; justify-content:flex-end; margin-top:6px;";const u=ne("ì´ˆê¸°í™”",()=>{Dt(1),i.value=String(s()),a.textContent=`${Math.round(s()*100)}%`,e()});u.style.cssText="padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.16);background:rgba(255,255,255,.06); color:#fff; cursor:pointer;",m.appendChild(u),n.appendChild(m);const l=S("settingsRow");l.style.cssText="display:flex; align-items:center; gap:12px; flex-wrap:wrap;";const x=Y("","ìŠ¬ë¡¯ ì¹´ë“œ í‘œì‹œ");x.style.cssText="font-weight:800;";const w=te.slotCardMode??"FULL",f=ne("ì „ì²´",()=>{te.slotCardMode="FULL",Jt(),e()}),p=ne("ì´ë¦„ë§Œ",()=>{te.slotCardMode="NAME_ONLY",Jt(),e()});return f.style.cssText=`padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.16);
    background:${w==="FULL"?"rgba(255,255,255,.16)":"rgba(255,255,255,.06)"}; color:#fff; cursor:pointer;`,p.style.cssText=`padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.16);
    background:${w==="NAME_ONLY"?"rgba(255,255,255,.16)":"rgba(255,255,255,.06)"}; color:#fff; cursor:pointer;`,l.appendChild(x),l.appendChild(f),l.appendChild(p),n.appendChild(l),n}function Ea(){const e=document.querySelector(".stageInner");if(!e)return;const t=e.getBoundingClientRect(),n=Math.round(t.left),r=Math.round(t.top),o=document.documentElement;o.style.setProperty("--stageLeftPx",`${n}px`),o.style.setProperty("--stageTopPx",`${r}px`),o.style.setProperty("--stageHPx",`${Math.round(t.height)}px`)}function _r(){const e=document.documentElement,t=$t()?te.uiScaleMobile:te.uiScaleDesktop;e.style.setProperty("--uiScale",String(t)),e.style.setProperty("--uiScaleDesktop",String(te.uiScaleDesktop)),e.style.setProperty("--uiScaleMobile",String(te.uiScaleMobile))}function Ca(e,t){if(document.querySelector(".overlay-layer")?.remove(),!q)return;const n=q.kind==="SETTINGS",r=S("overlay-layer");r.style.cssText=n?"position:fixed; inset:0;background:rgba(0,0,0,1);display:flex; justify-content:center; align-items:flex-start;padding:24px; box-sizing:border-box;":"position:fixed; inset:0;background:rgba(0,0,0,.55);display:flex; justify-content:center; align-items:center;",r.onclick=c=>{c.target===r&&t.onCloseOverlay()};const o=S("overlay-panel");o.style.cssText=n?"width:min(860px, 96vw); max-height:calc(100vh - 48px); overflow:auto;padding:16px; border:1px solid rgba(255,255,255,.12); border-radius:16px;background:rgba(15,18,22,1); box-shadow:0 18px 60px rgba(0,0,0,.45);":"width:min(980px, 92vw); max-height:80vh; overflow:auto; padding:16px;border:1px solid rgba(255,255,255,.12); border-radius:16px;background:rgba(15,18,22,.92); box-shadow:0 18px 60px rgba(0,0,0,.45);",o.onclick=c=>c.stopPropagation();const s=q.kind==="RULEBOOK"?"ë£°ë¶":q.kind==="SETTINGS"?"ì„¤ì •":q.pile==="deck"?"ë±":q.pile==="discard"?"ë²„ë¦¼ ë”ë¯¸":q.pile==="exhausted"?"ì†Œëª¨(ì´ë²ˆ ì „íˆ¬)":q.pile==="vanished"?"ì†Œì‹¤(ì˜êµ¬)":"ì†íŒ¨",a=S("overlayHeader");a.style.cssText="display:flex; align-items:center; justify-content:space-between; gap:12px; position:sticky; top:0; padding-bottom:12px; margin-bottom:12px; background:rgba(15,18,22,.92);";const i=Vt(s);i.classList.add("overlayTitle");const d=Xt("ë‹«ê¸°",t.onCloseOverlay,!1);if(d.classList.add("overlayClose"),d.style.cssText="padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.16); background:rgba(255,255,255,.06); color:#fff; cursor:pointer;",a.appendChild(i),a.appendChild(d),o.appendChild(a),q.kind==="RULEBOOK"){const c=document.createElement("pre");c.className="rulebook",c.textContent=Ts,c.style.cssText="white-space:pre-wrap; line-height:1.45; font-size:13px; margin:0; padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.10); background:rgba(0,0,0,.18);",o.appendChild(c)}else if(q.kind==="SETTINGS")o.appendChild(ga(()=>{fe&&(bn(),kn(),xn()),R(fe??e,t)}));else{const m=[...q.pile==="deck"?e.deck:q.pile==="discard"?e.discard:q.pile==="exhausted"?e.exhausted:q.pile==="vanished"?e.vanished:e.hand].sort((h,k)=>{const M=e.cards[h],T=e.cards[k],L=gt(e,M.defId),I=gt(e,T.defId),E=L.localeCompare(I,"ko");return E!==0?E:(M.upgrade??0)-(T.upgrade??0)}),u=S("pileView");u.style.cssText="display:grid;grid-template-columns: 1fr 320px;gap:16px;align-items:start;";const l=S("pileGrid");l.style.cssText="display:grid;grid-template-columns: repeat(auto-fill, minmax(var(--handCardW), 1fr));gap:10px;align-content:start;min-width:0;max-height: 62vh;overflow-y: auto;overflow-x: hidden;";const x=S("pileSide");x.style.cssText="position:sticky; top:72px;align-self:start;border:1px solid rgba(255,255,255,.10);border-radius:14px;padding:12px;background:rgba(0,0,0,.22);";const w=S("pileSideTitle");w.style.cssText="font-weight:800; margin:0 0 10px 0; opacity:.95;",x.appendChild(w);const f=S("pilePreviewBox");f.style.cssText="display:flex; justify-content:center; align-items:flex-start;padding:8px 0 10px 0;",x.appendChild(f);const p=document.createElement("pre");p.className="pileSideDetail",p.style.cssText="margin:0;padding:10px;white-space:pre-wrap;border-radius:12px;border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.20);font-size:12px;line-height:1.45;",x.appendChild(p);let b=m[0]??null;const g=()=>{if(f.innerHTML="",!b){w.textContent="ì„ íƒëœ ì¹´ë“œ ì—†ìŒ",p.textContent="";return}const h=Tt(e,b),k=Tr(e,b);w.textContent=k;const M=Ct(e,b);f.appendChild(M),p.textContent=`ì „ì—´: ${h.frontText}
í›„ì—´: ${h.backText}`};if(m.length===0){const h=S("overlayEmpty");h.textContent="ë¹„ì–´ ìˆìŒ",h.style.cssText="padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.10); background:rgba(255,255,255,.03);",l.appendChild(h)}else for(const h of m){const k=Ct(e,h,T=>{b=T,g()});k.style.width="var(--handCardW)",k.style.height="var(--handCardH)",k.style.boxSizing="border-box",k.style.cursor="pointer";const M=()=>{b=h,l.querySelectorAll(".pileSelected").forEach(T=>T.classList.remove("pileSelected")),k.classList.add("pileSelected"),g()};k.onclick=M,k.onmouseenter=M,l.appendChild(k)}if(u.appendChild(l),u.appendChild(x),o.appendChild(u),b){const h=l.firstElementChild;h&&h.classList.add("pileSelected")}g()}r.appendChild(o),document.body.appendChild(r)}function Ge(e,t){const n=document.createElement(e);return t&&(n.className=t),n}function va(e,t){const n=document.getElementById("relicTray");n&&n.remove();const r=e.run.relics??[];if(r.length===0)return;const o=Ge("div","relicTray");o.id="relicTray";const s=Ge("div","relicHoverTip");o.appendChild(s);const a=Ge("div","relicTrayList");o.appendChild(a);const i=()=>{const d=he;if(!d){s.style.display="none",s.textContent="";return}if(!Q[d]){s.style.display="none",s.textContent="";return}const m=yt(e,d);s.style.display="block",s.innerHTML="";const u=Ge("div","relicTipTitle");u.textContent=m.name;const l=Ge("div","relicTipBody");l.textContent=m.text,s.appendChild(u),s.appendChild(l)};for(const d of r){const c=Q[d];if(!c)continue;const m=yt(e,d),u=document.createElement("button");if(u.type="button",u.className="relicIcon",c.art){const l=document.createElement("img");l.className="relicIconImg",l.alt=m.name,u.appendChild(l)}else u.textContent=m.name.slice(0,1);u.onmouseenter=()=>{he=d,i()},u.onmouseleave=()=>{he=null,i()},u.onclick=()=>{Me=d,R(e,t)},a.appendChild(u)}i(),document.body.appendChild(o)}function Sa(e,t){document.querySelector(".choice-overlay")?.remove();const n=e.choice,r=document.querySelector(".mainPanel");if(!n){r?.classList.remove("choiceOpen");return}if(!r)return;r.classList.add("choiceOpen");const o=A(70),s=A(20)+o,a=A(36),i=A(16),d=A(16),c=A(18),m=A(10),u=A(260),l=A(200),x=A(14),w=A(12),f=A(10),p=A(12),b=A(12),g=A(220),h=A(22),k=A(14),M=S("choice-overlay");M.style.cssText="position:fixed; inset:0; z-index: var(--zChoice);display:flex; justify-content:center; align-items:flex-start;pointer-events:auto;";const T=S("choice-backdrop");T.style.cssText="position:absolute; inset:0;background: rgba(0,0,0,.72);backdrop-filter: blur(4px);-webkit-backdrop-filter: blur(4px);pointer-events:auto;",T.onclick=()=>{};const L=S("choice-padWrap");L.style.cssText=`position:relative; width:100%;padding:${s}px ${a}px ${i}px ${d}px;box-sizing:border-box;display:flex; justify-content:center; align-items:flex-start;pointer-events:auto;`;const I=S("choice-panel");I.style.cssText="position:relative;pointer-events:auto;",I.onclick=v=>v.stopPropagation();const E=Us(n.title);if(E.style.cssText=`margin:0 0 ${A(8)}px 0; font-size:${h}px; font-weight:900;text-align:left;`,I.appendChild(E),n.prompt){const v=hn(n.prompt);v.style.cssText=`margin:0 0 ${A(12)}px 0; font-size:${k}px; line-height:1.25; opacity:.95;`,I.appendChild(v)}const _=v=>{v.style.width="var(--handCardW)",v.style.height="var(--handCardH)",v.style.boxSizing="border-box"},N=v=>{const $=document.createElement("pre");return $.className="choice-detail",$.textContent=String(v),$.style.cssText=`margin:${A(10)}px 0 0 0; padding:${f}px;white-space:pre-wrap;border-radius:${p}px; border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.22);font-size:${b}px; line-height:1.45;max-height:${g}px; overflow:auto;`,$},C=()=>{const v=S("choice-item");return v.style.cssText=`display:flex;gap:${A(12)}px;align-items:flex-start;border:1px solid rgba(255,255,255,.10); border-radius:${x}px;padding:${w}px;background:rgba(255,255,255,.03);`,v};if(n.options.some(v=>v.cardUid?!0:typeof v.key=="string"&&v.key.startsWith("pick:"))){const v=S("choice-list");v.style.cssText=`display:flex; flex-direction:column;gap:${m}px; margin-top:${A(12)}px;`,n.options.forEach($=>{const D=C(),F=S("choice-left");F.style.cssText="flex:0 0 auto;";const H=$.cardUid;if(H){const K=e.choice?.kind==="UPGRADE_PICK",V=(e.cards[H].upgrade??0)+1;let X;try{X=K?Zs(e,H,V):Ct(e,H)}catch{X=Ct(e,H)}_(X),F.appendChild(X)}else if(typeof $.key=="string"&&$.key.startsWith("pick:")){const K=$.key.slice(5),[z,V]=K.split(":"),X=Number(V??"0")||0,dt=Cr(e,z,X);_(dt),F.appendChild(dt)}const U=S("choice-right");U.style.cssText=`flex:1 1 auto; min-width:${A(260)}px;`;const B=Xt($.label,()=>t.onChooseChoice($.key),!1);B.classList.add("primary"),B.style.fontSize=`${A(14)}px`,B.style.padding=`${A(10)}px ${A(12)}px`,B.style.borderRadius=`${A(10)}px`,U.appendChild(B),$.detail&&U.appendChild(N($.detail)),D.appendChild(F),D.appendChild(U),v.appendChild(D)}),I.appendChild(v)}else{const v=S("choice-contentRow");v.style.cssText=`display:flex;gap:${c}px; margin-top:${A(12)}px;justify-content:center; align-items:stretch;`;const $=S("choice-leftCol");$.style.cssText=`flex:1 1 ${A(640)}px; max-width:${A(720)}px; min-width:0;display:flex; flex-direction:column;`;const D=S("choice-list");D.style.cssText=`display:flex; flex-direction:column; gap:${m}px;`,n.options.forEach(B=>{const K=C(),z=Xt(B.label,()=>t.onChooseChoice(B.key),!1);z.classList.add("choiceOptBtn"),z.style.fontSize=`${A(14)}px`,z.style.padding=`${A(10)}px ${A(12)}px`,z.style.borderRadius=`${A(10)}px`,K.appendChild(z),B.detail&&K.appendChild(N(B.detail)),D.appendChild(K)}),$.appendChild(D);const F=S("choice-illuCol");F.style.cssText=`flex:0 0 ${u}px; min-width:${l}px;display:flex; align-items:center; justify-content:center;`;const H=S("choice-illuBox");H.style.cssText=`width:100%; aspect-ratio:1/1;border-radius:${A(18)}px; border:1px solid rgba(255,255,255,.16);background:rgba(0,0,0,.35);position:relative; overflow:hidden;box-shadow: 0 10px 30px rgba(0,0,0,.35);`;const U=n.art;if(U){const B=document.createElement("img");B.src=me(U),B.alt=n.title??"illustration";const K=1.5;B.style.imageRendering="pixelated",B.style.cssText=`position:absolute; inset:0;width:${K*100}%; height:${K*100}%;left:${-.5*50}%; top:${-.5*50}%;object-fit:cover; object-position:50% 50%;image-rendering: pixelated; image-rendering: crisp-edges;`,H.appendChild(B)}F.appendChild(H),v.appendChild($),v.appendChild(F),I.appendChild(v)}L.appendChild(I),M.appendChild(T),M.appendChild(L),document.body.appendChild(M)}function wa(e,t){document.querySelectorAll(".topHud").forEach(g=>g.remove()),document.querySelectorAll(".enemyHudCenter").forEach(g=>g.remove());const n=S("topHud");n.appendChild(S("topHudLeftSpacer"));const r=S("playerHudLeft"),o=S("playerTitleRow");o.appendChild(Y("playerHudTitle","í”Œë ˆì´ì–´"));const s=S("pileButtons");s.appendChild(ne("ë±",()=>t.onViewPile("deck"))),s.appendChild(ne("ë²„ë¦¼",()=>t.onViewPile("discard"))),s.appendChild(ne("ì†íŒ¨",()=>t.onViewPile("hand"))),s.appendChild(ne("ì†Œëª¨",()=>t.onViewPile("exhausted"))),s.appendChild(ne("ì†Œì‹¤",()=>t.onViewPile("vanished"))),o.appendChild(s),r.appendChild(o);const a=S("enemyChip");a.classList.add("playerHudBox");const i=S("enemyChipTop");i.appendChild(Y("","HP")),i.appendChild(Y("",`${e.player.hp}/${e.player.maxHp}`)),a.appendChild(i);const d=S("enemyHPOuter"),c=S("enemyHPFill");c.style.width=`${Math.max(0,Math.min(100,e.player.hp/Math.max(1,e.player.maxHp)*100))}%`,d.appendChild(c),a.appendChild(d);const m=S("enemyChipTop");m.appendChild(Y("","ë¸”ë¡")),m.appendChild(Y("",`${e.player.block}`)),a.appendChild(m);const u=S("enemyHPOuter"),l=S("enemyHPFill");l.style.background="linear-gradient(90deg, #64b5ff, #2a7cff)",l.style.width=`${Math.max(0,Math.min(100,e.player.block/Math.max(1,e.player.maxHp)*100))}%`,u.appendChild(l),a.appendChild(u);const x=e.player.status,w=S("enemyBadges");a.appendChild(w);const f=[];(x.vuln??0)>0&&f.push(`ì·¨ì•½ ${x.vuln}`),(x.weak??0)>0&&f.push(`ì•½í™” ${x.weak}`),(x.bleed??0)>0&&f.push(`ì¶œí˜ˆ ${x.bleed}`),(x.disrupt??0)>0&&f.push(`êµë€ ${x.disrupt}`);for(const g of f)w.appendChild(Yt(g));if(r.appendChild(a),!e.run.finished&&e.enemies.length>0&&e.phase!=="NODE"){const g=S("enemyHudCenter"),h=S("enemyHudCenterMover"),k=S("enemyHud");k.style.cssText=`
      display: flex;
      flex-direction: row;
      flex-wrap: nowrap;
      justify-content: center;
      align-items: stretch;
      gap: 14px;
      overflow: visible;
      white-space: nowrap;
    `,g.style.overflow="visible",h.style.overflow="visible",h.style.width="max-content";const M=Z(e);h.appendChild(k),g.appendChild(h),document.body.appendChild(g);for(let T=0;T<e.enemies.length;T++){const L=e.enemies[T],I=S("enemyBanner enemyCardWrap");M&&L.hp>0&&I.classList.add("targetable"),I.onclick=()=>t.onSelectEnemy(T);const E=S("enemyArtWrap"),_=S("enemyArtCard");E.style.setProperty("--frameImg",`url("${me("assets/enemies/enemies_frame.png")}")`),E.style.setProperty("--artImg",`url("${Xs(L.id)}")`),E.appendChild(_);const N=S("enemyMiniHud"),C=e.content.enemiesById[L.id],P=C.intents[L.intentIndex%C.intents.length],v=L.intentLabelOverride??P.label,$=e.intentsRevealedThisTurn?ks(e,L,P,{includeBlock:!1}):null,D=S("enemyIntentTopRow");let F="ï¼Ÿ",H="";e.intentsRevealedThisTurn&&$?(F=Qs($),H=Gs(e,L,$)??""):(F="ï¼Ÿ",H=""),D.appendChild(Y("enemyIntentIcon",F)),D.appendChild(Y("enemyIntentDmg",H)),N.appendChild(D);const U=S("enemyHpLine");U.appendChild(Y("enemyHpText",`HP ${L.hp}/${L.maxHp}`));const B=S("enemyHPOuter"),K=S("enemyHPFill");K.style.width=`${Math.max(0,Math.min(100,L.hp/Math.max(1,L.maxHp)*100))}%`,B.appendChild(K),U.appendChild(B),N.appendChild(U),N.appendChild(Js(L.status,L.immuneThisTurn));const z=S("enemyHoverDetail"),V=L.status,X=[];(V.vuln??0)>0&&X.push(`ì·¨ì•½ ${V.vuln}`),(V.weak??0)>0&&X.push(`ì•½í™” ${V.weak}`),(V.bleed??0)>0&&X.push(`ì¶œí˜ˆ ${V.bleed}`),(V.disrupt??0)>0&&X.push(`êµë€ ${V.disrupt}`),L.immuneThisTurn&&X.push("ë©´ì—­"),z.textContent=e.enemies[T].name+`
 
`+(e.intentsRevealedThisTurn?`${v}
 
`:"")+(X.length?`ìƒíƒœ: ${X.join(", ")}`:"ìƒíƒœ: ì—†ìŒ"),I.appendChild(E),I.appendChild(N),I.appendChild(z),k.appendChild(I)}}n.appendChild(r);const b=S("topHudRight");return b.appendChild(ne("ë£°ë¶",()=>t.onViewRulebook())),b.appendChild(ne("ë¡œê·¸",()=>t.onToggleLogOverlay())),b.appendChild(ne("ì„¤ì •",()=>{q={kind:"SETTINGS"},R(e,t)})),n.appendChild(b),n}function _a(e){const t=e.enemies.length>0&&e.phase!=="NODE",n=e.run.nextBattleSuppliesBonus??0,r=[];t?r.push(`ğŸŒ¾ S ${e.player.supplies} |`):n>0&&r.push(`ë³´ë„ˆìŠ¤ ğŸŒ¾ S +${n} |`),r.push(`ğŸ’¤ F ${e.player.fatigue}`);const o=e.run,s=Number(o.timeMove??0)||0,a=Number(e.time??0)||0,i=s+a;return r.push(`| â³ ì´ ${i}`),r.push(`| ğŸƒ ë± ${e.deck.length}`),r.join(" ")}function Bt(e,t=""){const n=document.createElement("span");return n.className="chip"+(t?` ${t}`:""),n.textContent=e,n}function $a(e){const t=S("battleTitleRow");t.style.display="flex",t.style.alignItems="center",t.style.gap="12px";const n=document.createElement("h2");n.textContent="",t.appendChild(n);const r=Na(e),o=Y("targetHintInline","");o.style.cssText="padding:5px 10px; border-radius:12px; border:1px solid rgba(0,0,0,.55);background: rgb(255, 0, 0);opacity:.9;font-weight:400; font-size:12px; line-height:1.2;white-space:nowrap; overflow:hidden; text-overflow:ellipsis;width: min(240px, 92vw);max-width: none;pointer-events:auto;",r?(o.textContent=r,o.style.visibility="visible",o.style.pointerEvents="auto"):(o.textContent="ëŒ€ìƒ ì„ íƒ í•„ìš”",o.style.visibility="hidden",o.style.pointerEvents="none");const s=S("battleTitleRight");s.style.cssText="margin-left:auto;display:flex; align-items:center; gap:10px;flex: 0 0 auto;white-space:nowrap;position:relative;";const a=S("resourceRow inline");return a.appendChild(Bt("")),a.appendChild(Bt("")),a.appendChild(Bt("")),s.appendChild(a),o.style.position="absolute",o.style.right="207px",o.style.top="calc(100% - 8px)",o.style.marginTop="0px",o.style.zIndex="5",o.style.pointerEvents=r?"auto":"none",t.appendChild(o),t.appendChild(s),t}function Ma(e,t){const n=S("logHeaderRow");n.tabIndex=0;const r=document.createElement("h2");r.textContent="ë¡œê·¸";const o=document.createElement("span");return o.className="chev",o.textContent=e?"â–¸":"â–¾",n.appendChild(r),n.appendChild(o),n.onclick=()=>t(),n.onkeydown=s=>{(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),t())},n}function Na(e){if(!Z(e)||e.selectedEnemyIndex!=null)return null;const t=e.pendingTarget??null,n=t?.sourceCardUid?ce(e,t.sourceCardUid):null,r=t?.sourceLabel??null,o=t?.reason??null,s=n?`ëŒ€ìƒ ì„ íƒ (${n})`:r?`ëŒ€ìƒ ì„ íƒ (${r})`:"ëŒ€ìƒ ì„ íƒ í•„ìš”",a=o==="FRONT"?"ì „ì—´":o==="BACK"?"í›„ì—´":o==="EVENT"?"ì´ë²¤íŠ¸":o==="RELIC"?"ìœ ë¬¼":null,i=a?` â€” ${a}`:"",d=e.pendingTargetQueue?.length??0,c=(e.pendingTarget?1:0)+d,m=c>1?` (ë‚¨ì€ ${c}ê°œ)`:" (ë‚¨ì€ 1ê°œ)";return`${s}${i}${m}`}function Pa(e,t,n){const r=S("combatRoot"),o=S("boardArea"),s=!t.run.finished&&t.enemies.length>0&&t.phase!=="NODE";o.classList.toggle("slabOn",s);const a=S("boardSlotsWrap");a.style.paddingTop=`${A(6)}px`,a.appendChild(zn(t,n,"front")),a.appendChild(zn(t,n,"back")),o.appendChild(a),r.appendChild(o),e.appendChild(r)}let Zt=null,$r=!0;function Kn(e,t){Zt=e,$r=t}function Mr(e,t,n){return e.run.finished?{label:"ì¢…ë£Œ",fn:null,disabled:!0,activePhase:e.phase}:e.choice||q?{label:"ì„ íƒ ì¤‘",fn:null,disabled:!0,activePhase:e.phase}:n?{label:"ëŒ€ìƒ ì„ íƒ",fn:null,disabled:!0,activePhase:e.phase}:e.phase==="NODE"?{label:"ë…¸ë“œ ì„ íƒ",fn:null,disabled:!0,activePhase:e.phase}:e.phase==="PLACE"?e.enemies.length>0&&!e.intentsRevealedThisTurn?{label:"ë‹¤ìŒ: ì •ì°°",fn:t.onRevealIntents,disabled:!1,activePhase:e.phase}:{label:"ë‹¤ìŒ: í›„ì—´",fn:t.onResolveBack,disabled:!1,activePhase:e.phase}:e.phase==="BACK"?{label:"ë‹¤ìŒ: í›„ì—´",fn:t.onResolveBack,disabled:!1,activePhase:e.phase}:e.phase==="FRONT"?{label:"ë‹¤ìŒ: ì „ì—´",fn:t.onResolveFront,disabled:!1,activePhase:e.phase}:e.phase==="ENEMY"?{label:"ë‹¤ìŒ: ì ",fn:t.onResolveEnemy,disabled:!1,activePhase:e.phase}:e.phase==="UPKEEP"?{label:"ë‹¤ìŒ: ì •ë¦¬",fn:t.onUpkeep,disabled:!1,activePhase:e.phase}:e.phase==="DRAW"?{label:"ë‹¤ìŒ í„´",fn:t.onDrawNextTurn,disabled:!1,activePhase:e.phase}:{label:"ë‹¤ìŒ",fn:null,disabled:!0,activePhase:e.phase}}function Aa(e,t,n){const r=document.querySelector(".handDock");r&&r.remove();const o=!e.run.finished&&e.enemies.length>0&&e.phase!=="NODE";document.querySelector(".combatControls")?.remove();const s=S("handDock"),a=Mr(e,t,n);if(o){const c=S("combatControls"),m=document.createElement("button");m.textContent="ë‹¤ìŒ í„´",m.className="stepBtn primary",m.disabled=a.disabled||e.phase==="NODE",m.onclick=()=>t.onAutoAdvance();const u=document.createElement("button");u.textContent="ì„ íƒ í•´ì œ",u.className="clearBtn primary",u.disabled=!e.selectedHandCardUid,u.onclick=t.onClearSelected,c.appendChild(m),c.appendChild(u),document.body.appendChild(c);const l=document.querySelector('.slot[data-slot-side="front"][data-slot-index="1"]')??document.querySelector(".stageInner");if(l){const x=l.getBoundingClientRect(),w=x.left+x.width/2;c.style.left=`${Math.round(w)}px`}Kn(()=>t.onAutoAdvance(),m.disabled)}else Kn(null,!0);const i=S("hand");i.dataset.dropHand="1";const d=S("handCardsRow");if(i.appendChild(d),e.hand.length===0){const c=S("handEmptyHint");c.textContent="",d.appendChild(c)}else for(const c of e.hand)d.appendChild(lt(e,c,!0,t.onSelectHandCard,{draggable:!0}));s.appendChild(i),document.body.appendChild(s),Ra(i)}function Ra(e){e.dataset?.wheelX!=="1"&&(e.dataset.wheelX="1",e.addEventListener("wheel",t=>{if(t.shiftKey)return;const n=Math.abs(t.deltaX)>Math.abs(t.deltaY)?t.deltaX:t.deltaY;e.scrollLeft+=n,t.preventDefault()},{passive:!1}))}function xn(){const e=document.querySelector(".enemyHudCenter");if(!e)return;const t=e.querySelector(".enemyHudCenterMover")??e,n=e.querySelector(".enemyHud")??e.querySelector(".enemyStrip")??t;e.style.position="fixed";const r=document.querySelector(".topHud"),a=r?Math.round(r.getBoundingClientRect().bottom+10):8;e.style.top=`${a}px`,e.style.top="8px",e.style.left="50%",e.style.right="auto",e.style.transform="translateX(-50%)",e.style.overflow="visible",t.style.transform="",t.style.overflow="visible";const i=Array.from(e.querySelectorAll(".enemyBanner")),d=i.length;if(d===0){e.style.width="";return}const c=14,m=Math.ceil(i[0].getBoundingClientRect().width)||460,u=Math.max(320,Math.floor(window.innerWidth-16)),l=Math.min(u,m),x=Math.min(u,m*2+c),w=Math.min(u,m*3+c*2);n.style.display="flex",n.style.flexWrap="nowrap",n.style.justifyContent="center",n.style.alignItems="stretch",n.style.gap=`${c}px`,e.style.width=`${d===1?l:d===2?x:w}px`,t.style.width="100%"}function kn(e){const t=document.querySelector(".hand"),n=document.querySelector(".handCardsRow");if(!t||!n)return;const r=document.querySelector('.slot[data-slot-side="front"][data-slot-index="1"]'),o=document.querySelector(".stageInner"),s=r?.getBoundingClientRect()??o?.getBoundingClientRect();if(!s)return;const a=s.left+s.width/2,i=Array.from(n.querySelectorAll(".card"));if(i.length===0)return;const d=i[0].getBoundingClientRect(),c=i[i.length-1].getBoundingClientRect(),m=d.left,u=c.right,l=(m+u)/2,x=a-l,w=n.scrollWidth,f=t.clientWidth;if(w<=f+1){n.style.transform=`translateX(${Math.round(x)}px)`,t.scrollLeft=0;return}let p=t.scrollLeft-x;const b=Math.max(0,w-f);p<0&&(p=0),p>b&&(p=b),t.scrollLeft=Math.round(p),n.style.transform=""}function Nr(e,t){const n=getComputedStyle(document.documentElement),r=parseFloat(n.getPropertyValue("--handCardW"))||240,o=parseFloat(n.getPropertyValue("--handCardH"))||336,s=e.getBoundingClientRect();if(s.width<=0||s.height<=0)return;const a=6,i=Math.max(1,s.width-a*2),d=Math.max(1,s.height-a*2);let c=Math.min(i/r,d/o);c=Math.max(.8,Math.min(1,c)),t.style.setProperty("--slotCardScale",String(c))}function zn(e,t,n){const r=S("grid6"),o=!!e.selectedHandCardUid,s=n==="front"?e.frontSlots:e.backSlots;for(let a=0;a<3;a++){const i=n==="back"?!!e.backSlotDisabled?.[a]:!1,d=S("slot"+(i?" disabled":""));d.dataset.slotSide=n,d.dataset.slotIndex=String(a),be&&be.side===n&&be.idx===a&&d.classList.add("dropHover"),o&&!i&&d.classList.add("placeable");const c=s[a];if(c){const m=te.slotCardMode==="NAME_ONLY"?"SLOT_NAME_ONLY":"FULL",u=lt(e,c,!1,void 0,{draggable:!1,mode:m,hoverPreview:{root:document.body,api:xr,buildDetail:(x,w)=>{const f=Tt(x,w);return`ì „ì—´: ${f.frontText}
í›„ì—´: ${f.backText}`}}});u.classList.add("inSlot");const l=document.createElement("div");l.className="slotCardScaler",l.appendChild(u),d.appendChild(l),u.onpointerdown=x=>{x.button!==0&&x.pointerType==="mouse"||Z(e)||e.phase==="PLACE"&&Pr(x,{kind:"slot",cardUid:c,fromSide:n,fromIdx:a})},u.ondblclick=()=>t.onReturnSlotToHand(n,a),requestAnimationFrame(()=>Nr(d,l))}r.appendChild(d)}return r}function Ia(){if(document.querySelectorAll(".slot.dropHover").forEach(n=>n.classList.remove("dropHover")),!be)return;const e=`.slot[data-slot-side="${be.side}"][data-slot-index="${be.idx}"]`,t=document.querySelector(e);t&&t.classList.add("dropHover")}let jn=!1;function La(e,t){jn||(jn=!0,window.addEventListener("pointermove",n=>{const r=e();if(r.choice||q||!O||n.pointerId!==O.pointerId)return;O.x=n.clientX,O.y=n.clientY;const o=O.x-O.startX,s=O.y-O.startY,a=O.dragging;!O.dragging&&o*o+s*s>36&&(O.dragging=!0),!a&&O.dragging&&(fn(250),pn()),be=O.dragging?qn(n.clientX,n.clientY,r):null,Ar(document.querySelector("#app")),Ia()},{passive:!0}),window.addEventListener("pointerup",n=>{const r=e();if(!(r.choice||q)&&!(!O||n.pointerId!==O.pointerId)){if(O.dragging){const o=Ha(n.clientX,n.clientY),s=qn(n.clientX,n.clientY,r);if(o&&O.kind==="slot"&&O.fromSide!=null&&O.fromIdx!=null){!r.run.finished&&!Z(r)&&r.phase==="PLACE"&&t.onReturnSlotToHand(O.fromSide,O.fromIdx),O=null,be=null,R(r,t);return}if(s)if(O.kind==="hand"){const a=e();if(!(a.run.finished||Z(a)||a.phase!=="PLACE")){const i=s.side,d=s.idx;if(!(i==="back"&&a.backSlotDisabled?.[d])){const c=i==="front"?a.frontSlots:a.backSlots,m=c[d];if(!m)t.onPlaceHandUidToSlot(O.cardUid,i,d);else{const u=O.fromHandIndex!=null&&O.fromHandIndex>=0?O.fromHandIndex:a.hand.indexOf(O.cardUid),l=a.hand.indexOf(O.cardUid);l>=0&&a.hand.splice(l,1),c[d]=O.cardUid,a.cards[O.cardUid].zone=i;const x=u!=null&&u>=0&&u<=a.hand.length?u:a.hand.length;a.hand.splice(x,0,m),a.cards[m].zone="hand",a.selectedHandCardUid=null,Qt(a),y(a,`[${ce(a,O.cardUid)}] â†” [${ce(a,m)}] ìŠ¤ì™‘: ì†íŒ¨ â†” ${i}${d+1}`),R(a,t)}}}}else O.kind==="slot"&&O.fromSide!=null&&O.fromIdx!=null&&(O.fromSide===s.side&&O.fromIdx===s.idx||t.onMoveSlotCard(O.fromSide,O.fromIdx,s.side,s.idx))}O?.sourceEl&&O.sourceEl.classList.remove("isDraggingSource"),O=null,be=null,R(r,t)}}),window.addEventListener("keydown",n=>{const r=n.target;if(r&&(r.tagName==="INPUT"||r.tagName==="TEXTAREA"))return;const o=e();if(!rs()){if(n.ctrlKey&&n.shiftKey&&n.code==="KeyK"){n.preventDefault(),os();return}if(n.code==="KeyP"){n.preventDefault(),t.onNewRun();return}if(n.code==="Digit4"){if(n.preventDefault(),Z(o)){o.pendingTarget=null,o.pendingTargetQueue=[],o.selectedEnemyIndex=null,y(o,"ëŒ€ìƒ ì„ íƒ ì·¨ì†Œ"),R(o,t);return}t.onClearSelected();return}if(n.key==="Tab"){if(n.preventDefault(),o.hand.length===0)return;const s=o.selectedHandCardUid,a=s?o.hand.indexOf(s):-1,i=n.shiftKey?-1:1,d=((a+i)%o.hand.length+o.hand.length)%o.hand.length;o.selectedHandCardUid=o.hand[d],R(o,t);return}if(n.code==="Space"){n.preventDefault();const s=e();if(s.run.finished||s.choice||Z(s))return;t.onAutoAdvance();return}if(n.code==="Digit1"||n.code==="Digit2"||n.code==="Digit3"){n.preventDefault();const s=n.code==="Digit1"?0:n.code==="Digit2"?1:2;if(Z(o)){const a=o.enemies[s];if(!a||a.hp<=0){y(o,`ëŒ€ìƒ ì„ íƒ ì‹¤íŒ¨: ${s+1}ë²ˆ ì ì´ ì—†ìŠµë‹ˆë‹¤.`),R(o,t);return}t.onSelectEnemy(s);return}t.onHotkeySlot("front",s);return}if(n.code==="KeyQ"||n.code==="KeyW"||n.code==="KeyE"){n.preventDefault();const s=n.code==="KeyQ"?0:n.code==="KeyW"?1:2;t.onHotkeySlot("back",s);return}if(n.code==="Enter"){n.preventDefault(),!$r&&Zt&&Zt();return}}}))}function Pr(e,t){fn(250),pn();const n=e.currentTarget;try{n.setPointerCapture(e.pointerId)}catch{}const r=n.closest(".card");r&&r.classList.add("isDraggingSource");const o=r?.getBoundingClientRect(),s=o?e.clientX-o.left:20,a=o?e.clientY-o.top:20,i=getComputedStyle(document.documentElement),d=parseFloat(i.getPropertyValue("--handCardW"))||void 0,c=parseFloat(i.getPropertyValue("--handCardH"))||void 0;if(O={kind:t.kind,cardUid:t.cardUid,fromHandIndex:t.fromHandIndex,fromSide:t.fromSide,fromIdx:t.fromIdx,pointerId:e.pointerId,startX:e.clientX,startY:e.clientY,x:e.clientX,y:e.clientY,dragging:!1,previewEl:void 0,previewW:o?.width??d,previewH:o?.height??c,grabDX:s,grabDY:a},r){O.sourceEl=r;const m=r.cloneNode(!0);m.classList.remove("inSlot"),m.classList.remove("selected"),m.classList.remove("isDraggingSource"),m.style.position="static",m.style.inset="",m.style.width="100%",m.style.height="100%",m.style.margin="0",m.style.boxSizing="border-box",m.style.opacity="1",m.style.filter="none",m.style.transform="none",m.style.backgroundColor="transparent",O.previewEl=m}}function Ha(e,t){const n=document.elementFromPoint(e,t);if(!n)return!1;let r=n;for(;r;){if(r.dataset?.dropHand==="1")return!0;r=r.parentElement}return!1}function qn(e,t,n){const r=document.elementFromPoint(e,t);if(!r)return null;const o=Da(r,["slotSide","slotIndex"]);if(!o)return null;const s=o.dataset.slotSide,a=Number(o.dataset.slotIndex);return s==="back"&&n.backSlotDisabled?.[a]?null:{side:s,idx:a}}function Da(e,t){let n=e;for(;n;){const r=n.dataset;let o=!0;for(const s of t)if(r[s]==null){o=!1;break}if(o)return n;n=n.parentElement}return null}function Ar(e,t){if(!O||!O.dragging){document.querySelector(".dragLayer")?.remove();return}let n=document.querySelector(".dragLayer");if(n||(n=document.createElement("div"),n.className="dragLayer",n.style.position="fixed",n.style.inset="0",n.style.zIndex="21000",n.style.pointerEvents="none",document.body.appendChild(n)),n.innerHTML="",!O.previewEl)return;const r=document.createElement("div");r.className="dragCardPreview",r.style.position="fixed",r.style.left=`${Math.round(O.x-(O.grabDX??20))}px`,r.style.top=`${Math.round(O.y-(O.grabDY??20))}px`;const o=O.previewW??0,s=O.previewH??0;o>0&&(r.style.width=`${Math.round(o)}px`),s>0&&(r.style.height=`${Math.round(s)}px`),r.style.transform="none",r.style.opacity="1",r.style.filter="none",r.style.boxShadow="0 16px 44px rgba(0,0,0,.65)",r.style.backdropFilter="none",r.style.isolation="isolate",r.style.mixBlendMode="normal",r.style.overflow="hidden",r.style.borderRadius="16px",r.style.background="transparent",r.style.clipPath="inset(0 round 16px)",r.appendChild(O.previewEl),n.appendChild(r)}Br();Or();const Ba=Zo();let Ze=Bs(Ba);function Rr(e){Ze=e,en=wr(Ze,Rr),R(Ze,en)}let en=wr(Ze,Rr);R(Ze,en);document.documentElement.style.setProperty("--base","/deck-rogue-prototype/");
