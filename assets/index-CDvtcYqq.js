(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();function ae(e){return[{id:"A",type:e[0]},{id:"B",type:e[1]}]}function ie(e,n,t){e.status[n]=Math.max(0,(e.status[n]??0)+t)}function z(e){const n=ae(re(e)),t=ae(re(e)),a=ae(re(e));return{root:n,nextIfA:t,nextIfB:a}}function Re(e,n){e.run.branchOffer||(e.run.branchOffer=z(e));const t=e.run.branchOffer,a=n==="A"?t.nextIfA:t.nextIfB,r=z(e);e.run.branchOffer={root:a,nextIfA:r.nextIfA,nextIfB:r.nextIfB}}function ve(){return Math.random().toString(16).slice(2)+"-"+Date.now().toString(16)}function ne(e,n=0){return e<n?n:e}function Se(e){const n=[...e];for(let t=n.length-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));[n[t],n[a]]=[n[a],n[t]]}return n}function _(e){return e[Math.floor(Math.random()*e.length)]}function s(e,n){e.log.unshift(n),e.log=e.log.slice(0,250)}function H(e){return e.enemies.filter(n=>n.hp>0)}function De(e,n,t){e.status[n]=ne((e.status[n]??0)+t,0)}function re(e){if((e.run.nodePickCount+1)%30===0)return["BATTLE","BATTLE"];const t=[],a=e.run.treasureObtained?20:19,r=4,o=6,f=!e.run.treasureObtained&&e.run.nodePickCount>=30?1:0;for(let i=0;i<a;i++)t.push("BATTLE");for(let i=0;i<r;i++)t.push("REST");for(let i=0;i<o;i++)t.push("EVENT");for(let i=0;i<f;i++)t.push("TREASURE");const c=_(t);let p=_(t);if(c==="TREASURE"&&p==="TREASURE"){let i=0;do if(p=_(t),i++,i>50)break;while(p==="TREASURE")}return[c,p]}function Pe(e){const n={phase:"NODE",log:[],uidSeq:0,winHooksAppliedThisCombat:!1,intentsRevealedThisTurn:!1,disruptIndexThisTurn:null,backUidsThisTurn:[],run:{encounterCount:0,treasureObtained:!1,afterTreasureNodePicks:0,finished:!1,nextBattleSuppliesBonus:0,bossPool:["boss_cursed_wall","boss_giant_orc","boss_soul_stealer"],nodePickCount:0,branchOffer:null,nodeOfferQueue:[],currentNodeOffers:null,nodePickByType:{BATTLE:0,REST:0,EVENT:0,TREASURE:0},battleCount:0,enemyLastSeenBattle:{}},player:{hp:40,maxHp:40,block:0,supplies:0,fatigue:0,zeroSupplyTurns:0,status:{vuln:0,weak:0,bleed:0,disrupt:0},immuneToDisruptThisTurn:!1,nullifyDamageThisTurn:!1},content:e,cards:{},deck:[],hand:[],discard:[],exhausted:[],vanished:[],choice:null,choiceStack:[],frontSlots:[null,null,null],backSlots:[null,null,null],backSlotDisabled:[!1,!1,!1],enemies:[],attackedEnemyIndicesThisTurn:[],usedThisTurn:0,frontPlacedThisTurn:0,selectedHandCardUid:null,pendingTargetQueue:[],pendingTarget:null,drawCountThisTurn:0};return n.run.branchOffer=z(n),We(n),s(n,"ìƒˆ ëŸ° ì‹œì‘. ë‹¤ìŒ ì¸ì¹´ìš´í„°ë¥¼ ì„ íƒí•˜ì„¸ìš”."),n}function L(e,n,t){for(let a=0;a<t;a++){const r=ve(),o={uid:r,defId:n,zone:"deck",upgrade:0};e.cards[r]=o,e.deck.push(r)}}function We(e){L(e,"field_ration",2),L(e,"maintenance",2),L(e,"scout",2),L(e,"shield",2),L(e,"power_arrow",1),L(e,"arrow",3),e.deck=Se(e.deck)}function I(e,n){const t=e.cards[n],a=e.content.cardsById[t.defId],r=t.upgrade??0,o=a.upgrades?.[r-1];return o?{...a,...o}:a}function Y(e,n,t){const a=e.cardsById[n],r=Math.max(0,t|0);if(r<=0)return a;const o=a.upgrades?.[r-1];return o?{...a,...o}:a}function S(e,n){const a=e.cards[n].upgrade??0,r=I(e,n);return a>0?`${r.name} +${a}`:r.name}const Le=[{id:"field_ration",name:"ì•¼ì „ ì‹ëŸ‰",frontText:"ë°©ì–´ +3",backText:"S +2",front:[{op:"block",n:3}],back:[{op:"supplies",n:2}],upgrades:[{frontText:"ë°©ì–´ +5",front:[{op:"block",n:5}],backText:"S +3",back:[{op:"supplies",n:3}]}]},{id:"maintenance",name:"ì •ë¹„ ë„êµ¬",tags:["EXHAUST"],exhaustWhen:"BACK",frontText:"ë°©ì–´ +3",backText:"F -1, ì†Œëª¨",front:[{op:"block",n:3}],back:[{op:"fatigue",n:-1}],upgrades:[{frontText:"ë°©ì–´ +5",front:[{op:"block",n:5}],backText:"F -1, S +1, ì†Œëª¨",back:[{op:"fatigue",n:-1},{op:"supplies",n:1}]}]},{id:"scout",name:"ì •ì°°",frontText:"ì„ íƒí•œ ì ì—ê²Œ 3 í”¼í•´, ë°©ì–´ +2",backText:"ë“œë¡œìš° 1, ì†íŒ¨ í¬ê¸° +1, S +2",front:[{op:"damageEnemy",target:"select",n:3},{op:"block",n:2}],back:[{op:"draw",n:1},{op:"supplies",n:2}]},{id:"shield",name:"ë°©íŒ¨",frontText:"ë°©ì–´ +6",backText:"ë°©ì–´ +3",front:[{op:"block",n:6}],back:[{op:"block",n:3}]},{id:"power_arrow",name:"ê°•ë ¥í•œ í™”ì‚´",frontText:"ë¬´ì‘ìœ„ ì ì—ê²Œ 10 í”¼í•´ S -1",backText:"ë¬´ì‘ìœ„ ì ì—ê²Œ ì „ì—´ í•œ ì¥ë‹¹ 2 í”¼í•´, S -1",front:[{op:"supplies",n:-1},{op:"damageEnemy",target:"random",n:10}],back:[{op:"supplies",n:-1},{op:"damageEnemyBy",target:"random",nPer:2,by:"frontCount"}]},{id:"arrow",name:"í™”ì‚´",frontText:"ì„ íƒí•œ ì ì—ê²Œ 5 í”¼í•´",backText:"ì„ íƒí•œ ì ì—ê²Œ 5 í”¼í•´, S -1",front:[{op:"damageEnemy",target:"select",n:5}],back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:5}],upgrades:[{frontText:"ì„ íƒí•œ ì ì—ê²Œ 7 í”¼í•´",front:[{op:"damageEnemy",target:"select",n:7}],backText:"ì„ íƒí•œ ì ì—ê²Œ 7 í”¼í•´, S -1",back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:7}]}]},{id:"goal_treasure",name:"ì €ì£¼ë°›ì€ ë³´ë¬¼",tags:["EXHAUST"],exhaustWhen:"BOTH",frontText:"F +1, ì†Œëª¨",backText:"S -1, F +1, ì†Œëª¨",front:[{op:"fatigue",n:1}],back:[{op:"supplies",n:-1},{op:"fatigue",n:1}]},{id:"berserk",name:"ê´‘í­í™”",frontText:"ë¬´ì‘ìœ„ ì ì—ê²Œ 15 í”¼í•´, F +1",backText:"S +4, F +1",front:[{op:"damageEnemy",target:"random",n:15},{op:"fatigue",n:1}],back:[{op:"supplies",n:4},{op:"fatigue",n:1}]},{id:"bandage",name:"ë¶•ëŒ€",frontText:"HP +4",backText:"HP +4, S -1",front:[{op:"heal",n:4}],back:[{op:"supplies",n:-1},{op:"heal",n:4}]},{id:"arrow_rain",name:"í™”ì‚´ì˜ ë¹„",tags:["EXHAUST"],exhaustWhen:"BOTH",frontText:"ëª¨ë“  ì ì—ê²Œ 10 í”¼í•´, S -1, F +1, ì†Œëª¨",backText:"ë“œë¡œìš° 2, ì†íŒ¨ í¬ê¸° +2, S +2, F +1, ì†Œëª¨",front:[{op:"damageEnemy",target:"all",n:10},{op:"supplies",n:-1},{op:"fatigue",n:1}],back:[{op:"draw",n:2},{op:"supplies",n:2},{op:"fatigue",n:1}]},{id:"smoke",name:"ì—°ë§‰",tags:["EXHAUST"],exhaustWhen:"FRONT",frontText:"ì´ë²ˆ í„´ í”¼í•´ ë¬´íš¨, ì†Œëª¨",backText:"ìì‹ ì€ êµë€ ë‹¹í•˜ì§€ ì•ŠìŒ",front:[{op:"nullifyDamageThisTurn"}],back:[{op:"immuneDisruptThisTurn"}]},{id:"redeploy",name:"ì¬ë°°ì¹˜",frontText:"S +2",backText:"3ë²ˆ ìŠ¬ë¡¯ì— ìˆëŠ” í›„ì—´ ì¹´ë“œì˜ ì „ì—´ íš¨ê³¼ ë°œë™",front:[{op:"supplies",n:2}],back:[{op:"triggerFrontOfBackSlot",index:2}]},{id:"secret_strike",name:"ë¹„ì¥ì˜ ì¼ê²©",tags:["EXHAUST"],exhaustWhen:"BOTH",frontText:"ë¬´ì‘ìœ„ ì ì—ê²Œ ìì‹ ì˜ Fì˜ 3ë°° í”¼í•´, ì†Œëª¨",backText:"ëª¨ë“  ì ì—ê²Œ ì·¨ì•½ +4 ë° ì•½í™” +4, ì†Œëª¨",front:[{op:"damageEnemyByPlayerFatigue",target:"random",mult:3}],back:[{op:"statusEnemy",target:"all",key:"vuln",n:4},{op:"statusEnemy",target:"all",key:"weak",n:4}]},{id:"fire_scroll",name:"í™”ì—¼ ë‘ë£¨ë§ˆë¦¬",tags:["EXHAUST"],exhaustWhen:"BOTH",frontText:"ë°©ì–´ +7, ì†Œëª¨",backText:"ëª¨ë“  ì ì—ê²Œ 12 í”¼í•´, ì†Œëª¨",front:[{op:"block",n:7}],back:[{op:"damageEnemy",target:"all",n:12}]},{id:"caltrops",name:"ë§ˆë¦„ì‡ ",frontText:"ëª¨ë“  ì ì—ê²Œ ì¶œí˜ˆ 4 ë¶€ì—¬",backText:"ì´ë²ˆ í„´ì— ìì‹ ì„ ê³µê²©í•˜ë ¤ëŠ” ì ì—ê²Œ ì¶œí˜ˆ 3 ë¶€ì—¬",front:[{op:"statusEnemy",target:"all",key:"bleed",n:4}],back:[{op:"statusEnemiesAttackingThisTurn",key:"bleed",n:3}]},{id:"emergency_rations",name:"ë¹„ìƒì‹ëŸ‰",tags:["VANISH"],vanishWhen:"BACK",frontText:"S +2",backText:"Së¥¼ 10ìœ¼ë¡œ ë§Œë“¦. ì†Œì‹¤",front:[{op:"supplies",n:2}],back:[{op:"setSupplies",n:10}]},{id:"painkiller",name:"ì§„í†µì œ",tags:["EXHAUST"],exhaustWhen:"BOTH",frontText:"HP -5, F -2, ì†Œëª¨",backText:"HP +10, F +2, ì†Œëª¨",front:[{op:"hp",n:-5},{op:"fatigue",n:-2}],back:[{op:"hp",n:10},{op:"fatigue",n:2}]},{id:"field_experience",name:"ì‹¤ì „ ê²½í—˜",tags:["EXHAUST"],exhaustWhen:"BACK",frontText:"ëª¨ë“  ì ì—ê²Œ 3 í”¼í•´",backText:"ì´ ì¹´ë“œê°€ í›„ì—´ì— ìˆëŠ” í„´ì— ìŠ¹ë¦¬í•˜ë©´ ìµœëŒ€ ì²´ë ¥ +2, ì†Œëª¨",front:[{op:"damageEnemy",target:"all",n:3}],back:[],onWinWhileInBack:[{op:"maxHp",n:2}],upgrades:[{frontText:"ëª¨ë“  ì ì—ê²Œ 4 í”¼í•´",backText:"ì´ ì¹´ë“œê°€ í›„ì—´ì— ìˆëŠ” í„´ì— ìŠ¹ë¦¬í•˜ë©´ ìµœëŒ€ ì²´ë ¥ +3, ì†Œëª¨",front:[{op:"damageEnemy",target:"all",n:4}],onWinWhileInBack:[{op:"maxHp",n:3}]}]},{id:"camp_prep",name:"ì•¼ì˜ ì¤€ë¹„",frontText:"ë°©ì–´ +4, S +1",backText:"S +3",front:[{op:"block",n:4},{op:"supplies",n:1}],back:[{op:"supplies",n:3}]},{id:"vital_shot",name:"ê¸‰ì†Œ ì‚¬ê²©",frontText:"ì„ íƒí•œ ì ì—ê²Œ 8 í”¼í•´",backText:"ì„ íƒí•œ ì ì—ê²Œ 5 í”¼í•´, ì¶œí˜ˆ 2 ë¶€ì—¬, S -1",front:[{op:"damageEnemy",target:"select",n:8}],back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:5},{op:"statusEnemy",target:"select",key:"bleed",n:2}]},{id:"taunt",name:"ë…ì„¤",frontText:"ì„ íƒí•œ ì ì—ê²Œ ì•½í™” +4",backText:"ëª¨ë“  ì ì—ê²Œ ì·¨ì•½ +2 ë° ì•½í™” +2",front:[{op:"statusEnemy",target:"select",key:"weak",n:4}],back:[{op:"statusEnemy",target:"all",key:"vuln",n:2},{op:"statusEnemy",target:"all",key:"weak",n:2}]},{id:"rapid_fire",name:"ì—°ì† ì‚¬ê²©",frontText:"ì„ íƒí•œ ì ì—ê²Œ 2 í”¼í•´, 3ë²ˆ ë°œë™",backText:"ì´ë²ˆ í„´ì— ì¹´ë“œë¥¼ ë½‘ì•˜ìœ¼ë©´ ë¬´ì‘ìœ„ ì ì—ê²Œ 8 í”¼í•´",front:[{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2}],back:[{op:"ifDrewThisTurn",then:[{op:"damageEnemy",target:"random",n:8}]}]}],Me=Object.fromEntries(Le.map(e=>[e.id,e])),Fe=[{id:"other_adventurer",name:"ë³´ë¬¼ì„ ë…¸ë¦¬ëŠ” ë‹¤ë¥¸ ëª¨í—˜ê°€",maxHp:40,intents:[{label:"10 í”¼í•´",acts:[{op:"damagePlayer",n:10}]},{label:"ì¶œí˜ˆ4/ì·¨ì•½4/ì•½í™”4",acts:[{op:"statusPlayer",key:"bleed",n:4},{op:"statusPlayer",key:"vuln",n:4},{op:"statusPlayer",key:"weak",n:4}]}]},{id:"goblin_raider",name:"ê³ ë¸”ë¦° ì•½íƒˆì",maxHp:15,intents:[{label:"(12-ì´ë²ˆ í„´ì— ì‚¬ìš©í•œ ì¹´ë“œì˜ ìˆ˜) í”¼í•´",acts:[{op:"damagePlayerFormula",kind:"goblin_raider"}]},{label:"S -4",acts:[{op:"supplies",n:-4}]}]},{id:"watching_statue",name:"ê°ì‹œí•˜ëŠ” ì„ìƒ",maxHp:25,intents:[{label:"4+(ì´ë²ˆ í„´ì— ì‚¬ìš©í•œ ì¹´ë“œì˜ ìˆ˜) í”¼í•´",acts:[{op:"damagePlayerFormula",kind:"watching_statue"}]}]},{id:"pebble_golem",name:"ì¡°ì•½ëŒ ê³¨ë ˜",maxHp:25,intents:[{label:"6 í”¼í•´",acts:[{op:"damagePlayer",n:6}]},{label:"ìì‹  HP 6 íšŒë³µ",acts:[{op:"enemyHealSelf",n:6}]}]},{id:"rock_golem",name:"ë°”ìœ„ ê³¨ë ˜",maxHp:50,intents:[{label:"7 í”¼í•´",acts:[{op:"damagePlayer",n:7}]},{label:"ìì‹  HP 10 íšŒë³µ",acts:[{op:"enemyHealSelf",n:10}]}]},{id:"slime",name:"ìŠ¬ë¼ì„",maxHp:30,intents:[{label:"ë‹¤ìŒ í„´ ë™ì•ˆ í”¼í•´ë¥¼ ì…ì§€ ì•ŠìŒ",acts:[{op:"enemyImmuneNextTurn"}]},{label:"ì•½í™” 4 ë¶€ì—¬ í›„ ìì‹  HP 3 íšŒë³µ",acts:[{op:"statusPlayer",key:"weak",n:4},{op:"enemyHealSelf",n:3}]},{label:"6 í”¼í•´",acts:[{op:"damagePlayer",n:6}]}]},{id:"boss_cursed_wall",name:"ì €ì£¼ë°›ì€ ë²½",maxHp:100,intents:[{label:"F += 1",acts:[{op:"fatiguePlayer",n:1}]},{label:"ì•„ë¬´ í–‰ë™ë„ í•˜ì§€ ì•ŠìŒ",acts:[]}]},{id:"boss_giant_orc",name:"ê±°ëŒ€í•œ ì˜¤í¬",maxHp:70,intents:[{label:"í”¼í•´ 15",acts:[{op:"damagePlayer",n:15}]},{label:"ë‹¤ìŒ í„´ ë™ì•ˆ í”¼í•´ë¥¼ ì…ì§€ ì•ŠìŒ",acts:[{op:"enemyImmuneNextTurn"}]},{label:"ìì‹  HP 15 íšŒë³µ",acts:[{op:"enemyHealSelf",n:15}]}]},{id:"boss_soul_stealer",name:"ì˜í˜¼ ê°•íƒˆì",maxHp:50,intents:[{label:"í”¼í•´ 7, S -2",acts:[{op:"damagePlayer",n:7},{op:"supplies",n:-2}]},{label:"í”¼í•´ 7, F +1",acts:[{op:"damagePlayer",n:7},{op:"fatiguePlayer",n:1}]},{label:"ì¤€ë¹„(ì¹´ìš´íŠ¸ ì§„í–‰)",acts:[]}]}],Ue=Object.fromEntries(Fe.map(e=>[e.id,e]));function Ke(e,n){n<=0||(e.player.block+=n,s(e,`ë°©ì–´(ë¸”ë¡) +${n} (í˜„ì¬ ${e.player.block})`))}function ze(e,n){e.player.supplies=ne(e.player.supplies+n,0),s(e,`ë³´ê¸‰ S ${n>=0?"+":""}${n} (í˜„ì¬ ${e.player.supplies})`)}function Z(e,n){e.player.fatigue=ne(e.player.fatigue+n,0),s(e,`í”¼ë¡œ F ${n>=0?"+":""}${n} (í˜„ì¬ ${e.player.fatigue})`)}function Ve(e,n){if(n<=0)return;const t=e.player.hp;e.player.hp=Math.min(e.player.maxHp,e.player.hp+n),s(e,`HP +${e.player.hp-t} (í˜„ì¬ ${e.player.hp}/${e.player.maxHp})`)}function Xe(e){H(e).length===0&&(e.pendingTarget=null,e.pendingTargetQueue=[])}function M(e,n,t){const a=e.enemies.indexOf(n);if(a>=0&&!e.attackedEnemyIndicesThisTurn.includes(a)&&e.attackedEnemyIndicesThisTurn.push(a),t<=0)return;const r=e.player.status.weak??0,o=n.status.vuln??0;if(n.immuneThisTurn){s(e,`ì (${n.name})ì€(ëŠ”) ì´ë²ˆ í„´ í”¼í•´ ë©´ì—­ â†’ ${t} í”¼í•´ ë¬´ì‹œ`);return}let l=t-r+o;l<0&&(l=0),n.hp-=l,n.hp<0&&(n.hp=0),s(e,`ì (${n.name})ì—ê²Œ ${l} í”¼í•´. (HP ${n.hp}/${n.maxHp})`),Xe(e)}function g(e,n,t=null){if(n<=0)return;if(e.player.nullifyDamageThisTurn){s(e,`ì´ë²ˆ í„´ í”¼í•´ ë¬´íš¨(ì—°ë§‰): ${n} í”¼í•´ê°€ ë¬´ì‹œë¨`);return}const a=t?.status.weak??0,r=e.player.status.vuln??0;let o=n-a+r;o<0&&(o=0);const l=Math.min(e.player.block,o);e.player.block-=l,o-=l,o>0&&(e.player.hp-=o),e.player.hp<0&&(e.player.hp=0),s(e,`í”Œë ˆì´ì–´ í”¼í•´ â†’ ë¸”ë¡ ${l} í¡ìˆ˜, ì‹¤ì œ ${o} í”¼í•´. (HP ${e.player.hp}/${e.player.maxHp}, ë¸”ë¡ ${e.player.block})`)}function je(){return pe[Math.floor(Math.random()*pe.length)]}const pe=[{id:"drop_bag",name:"ì§ ë²„ë¦¬ê¸°",prompt:"ì§ì„ ì¤„ì—¬ í”¼ë¡œë¥¼ ë‚®ì¶˜ë‹¤.",options:()=>[{key:"drop",label:"ì¹´ë“œ 1ì¥ ì œê±°, F -= 1",apply:e=>(Z(e,-1),s(e,"ì´ë²¤íŠ¸: ì§ ë²„ë¦¬ê¸° â†’ ì œê±°í•  ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”."),{kind:"REMOVE_PICK",title:"ì§ ë²„ë¦¬ê¸°",prompt:"ì œê±°í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",then:"NONE"})},{key:"skip",label:"ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠëŠ”ë‹¤",apply:e=>(s(e,"ì´ë²¤íŠ¸: ì§ ë²„ë¦¬ê¸°(ìƒëµ)"),"NONE")}]},{id:"hide_from_monster",name:"ëª¬ìŠ¤í„°ë¡œë¶€í„° ìˆ¨ê¸°",prompt:"ì „íˆ¬í•˜ê±°ë‚˜, ëŒ€ê°€ë¥¼ ì¹˜ë¥´ê³  ìˆ¨ì„ ìˆ˜ ìˆë‹¤.",options:()=>[{key:"fight",label:"ì „íˆ¬",apply:e=>(s(e,"ì´ë²¤íŠ¸: ëª¬ìŠ¤í„°ë¡œë¶€í„° ìˆ¨ê¸° â†’ ì „íˆ¬ ì„ íƒ"),"BATTLE")},{key:"remove_and_fatigue",label:"ì¹´ë“œ 1ì¥ ì œê±° í›„ F += 1",apply:e=>(Z(e,1),s(e,"ì´ë²¤íŠ¸: ëª¬ìŠ¤í„°ë¡œë¶€í„° ìˆ¨ê¸° â†’ ì¹´ë“œ ì œê±° í›„ F+1"),{kind:"REMOVE_PICK",title:"ì§ ë²„ë¦¬ê¸°",prompt:"ì œê±°í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",then:"NONE"})}]},{id:"overweight",name:"ê³¼ì¤‘ëŸ‰",prompt:"ë„ˆë¬´ ë§ì€ ì§ì´ í”¼ë¡œë¥¼ ë¶€ë¥¸ë‹¤.",options:()=>[{key:"accept",label:"F += (ë± ë§¤ìˆ˜)/5 (ë²„ë¦¼)",apply:e=>{const n=Object.values(e.cards).filter(a=>["deck","hand","discard"].includes(a.zone)).length,t=Math.floor(n/5);return Z(e,t),s(e,`ì´ë²¤íŠ¸: ê³¼ì¤‘ëŸ‰ (ë± ${n}ì¥ â†’ F +${t})`),"NONE"}}]},{id:"find_adventurer",name:"ë‹¤ë¥¸ ëª¨í—˜ê°€ ë°œê²¬",prompt:"ê±°ë˜í•œë‹¤.",options:e=>e.run.treasureObtained?[{key:"adventurer:forced_battle",label:"ëŒ€ì¹˜í•œë‹¤",detail:"ë³´ë¬¼ì„ ë…¸ë¦¬ê³  ë¤ë²¼ë“ ë‹¤.",apply:n=>({kind:"BATTLE_SPECIAL",enemyIds:["other_adventurer"],title:"ë³´ë¬¼ì„ ë…¸ë¦¬ëŠ” ëª¨í—˜ê°€"})}]:[{key:"trade",label:"ì¹´ë“œ 1ì¥ ì œê±° í›„ ì¹´ë“œ ë³´ìƒ(2ì¥ ì¤‘ 1ì¥)",apply:n=>(s(n,"ì´ë²¤íŠ¸: ë‹¤ë¥¸ ëª¨í—˜ê°€ ë°œê²¬ â†’ ì œê±°í•  ì¹´ë“œ ì„ íƒ í›„ ë³´ìƒ"),{kind:"REMOVE_PICK",title:"ë‹¤ë¥¸ ëª¨í—˜ê°€ ë°œê²¬",prompt:"ì œê±°í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",then:"REWARD_PICK"})},{key:"leave",label:"ì§€ë‚˜ì¹œë‹¤",apply:n=>(s(n,"ì´ë²¤íŠ¸: ë‹¤ë¥¸ ëª¨í—˜ê°€ ë°œê²¬(ìƒëµ)"),"NONE")}]},{id:"edible_mushroom",name:"ì‹ìš© ë²„ì„¯ ë°œê²¬",prompt:"ê¸°ìš´ì´ ë‚œë‹¤. ë‹¤ìŒ ì „íˆ¬ì˜ ì‹œì‘ ë³´ê¸‰ì´ ëŠ˜ì–´ë‚œë‹¤.",options:()=>[{key:"eat",label:"F -= 2, ë‹¤ìŒ ì „íˆ¬ ì‹œì‘ S +5",apply:e=>(e.player.fatigue=Math.max(0,e.player.fatigue-2),e.run.nextBattleSuppliesBonus+=5,s(e,"ì‹ìš© ë²„ì„¯: F -2, ë‹¤ìŒ ì „íˆ¬ ì‹œì‘ S +5"),"NONE")}]}],qe=[{id:"berserk",weight:20},{id:"bandage",weight:12},{id:"arrow_rain",weight:20},{id:"smoke",weight:0},{id:"redeploy",weight:12},{id:"secret_strike",weight:1},{id:"fire_scroll",weight:1},{id:"caltrops",weight:12},{id:"emergency_rations",weight:1},{id:"painkiller",weight:1},{id:"field_experience",weight:1},{id:"camp_prep",weight:20},{id:"vital_shot",weight:12},{id:"taunt",weight:20},{id:"rapid_fire",weight:12}];function Qe(e){const n=new Map;for(const t of e){const a=Math.max(0,t.weight??0);a<=0||n.set(t.id,(n.get(t.id)??0)+a)}return[...n.entries()].map(([t,a])=>({id:t,w:a}))}function fe(e){let n=0;for(const a of e)n+=a.w;if(n<=0)throw new Error("No positive weights to pick from.");let t=Math.random()*n;for(const a of e)if(t-=a.w,t<=0)return a.id;return e[e.length-1].id}function he(){return Math.random()<.1?1:0}function me(){const e=Qe(qe),n=fe(e),t=e.filter(r=>r.id!==n),a=fe(t);return[{defId:n,upgrade:he()},{defId:a,upgrade:he()}]}function Ye(e){return e.uidSeq+=1,`c_${e.uidSeq}`}function Te(e,n,t){const a=Ye(e);e.cards[a]={uid:a,defId:n,zone:"deck",upgrade:t?.upgrade??0},e.deck.push(a)}const Ge="goal_treasure";function Je(e,n){const t=e.cards[n];if(t){if(t.defId===Ge){s(e,"ì €ì£¼ë°›ì€ ë³´ë¬¼ì€ ë±ì—ì„œ ì œê±°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");return}e.deck=e.deck.filter(a=>a!==n),e.hand=e.hand.filter(a=>a!==n),e.discard=e.discard.filter(a=>a!==n),e.frontSlots=e.frontSlots.map(a=>a===n?null:a),e.backSlots=e.backSlots.map(a=>a===n?null:a),t.zone="vanished",e.vanished.push(n),s(e,`ì¹´ë“œ ì œê±°: [${I(e,t.uid).name} +${e.cards[t.uid].upgrade??0}]`)}}function He(e,n){const t=e.cards[n];if(!t)return!1;const r=e.content.cardsById[t.defId].upgrades?.length??0;return(t.upgrade??0)<r}function Ze(e,n){return He(e,n)?(e.cards[n].upgrade=(e.cards[n].upgrade??0)+1,!0):!1}function ge(){return{cardsById:Me,enemiesById:Ue}}function en(e,n){const t={kind:"damageSelect",amount:n};e.pendingTarget==null?e.pendingTarget=t:e.pendingTargetQueue.push(t);const a=(e.pendingTarget?1:0)+e.pendingTargetQueue.length;s(e,`ëŒ€ìƒ ì„ íƒ í•„ìš”: ì ì„ í´ë¦­í•˜ì„¸ìš”. (ë‚¨ì€ ì„ íƒ ${a})`)}function nn(e,n,t){const a={kind:"statusSelect",key:n,n:t};e.pendingTarget==null?e.pendingTarget=a:e.pendingTargetQueue.push(a);const r=(e.pendingTarget?1:0)+e.pendingTargetQueue.length;s(e,`ëŒ€ìƒ ì„ íƒ í•„ìš”: ì ì„ í´ë¦­í•˜ì„¸ìš”. (ë‚¨ì€ ì„ íƒ ${r})`)}function tn(e,n){const t=e.content.enemiesById[n.id];return t.intents[n.intentIndex%t.intents.length].acts.some(r=>r.op==="damagePlayer"||r.op==="damagePlayerFormula")}function V(e,n){const t=e.game;for(const a of n)switch(a.op){case"block":Ke(t,a.n);break;case"supplies":ze(t,a.n);break;case"fatigue":Z(t,a.n);break;case"heal":Ve(t,a.n);break;case"hp":t.player.hp=Math.max(0,Math.min(t.player.maxHp,t.player.hp+a.n)),s(t,`HP ${a.n>=0?"+":""}${a.n} (í˜„ì¬ ${t.player.hp}/${t.player.maxHp})`);break;case"maxHp":t.player.maxHp+=a.n,t.player.hp=Math.min(t.player.maxHp,t.player.hp+a.n),s(t,`ìµœëŒ€ HP +${a.n} (í˜„ì¬ ${t.player.hp}/${t.player.maxHp})`);break;case"setSupplies":t.player.supplies=Math.max(0,a.n),s(t,`ë³´ê¸‰ Së¥¼ ${t.player.supplies}ìœ¼ë¡œ ì„¤ì •`);break;case"draw":{const r=ce(t,a.n);t.drawCountThisTurn+=r;break}case"ifDrewThisTurn":{t.drawCountThisTurn>0&&V(e,a.then);break}case"damageEnemy":if(a.target==="random"){const r=H(t);if(r.length===0)break;M(t,_(r),a.n)}else if(a.target==="all")for(const r of H(t))M(t,r,a.n);else en(t,a.n);break;case"damageEnemyBy":{if(a.target!=="random")break;const r=H(t);if(r.length===0)break;let o=0;a.by==="frontCount"&&(o=t.frontSlots.filter(Boolean).length*a.nPer),M(t,_(r),o);break}case"damageEnemyByPlayerFatigue":{if(a.target!=="random")break;const r=H(t);if(r.length===0)break;const o=Math.max(0,t.player.fatigue*a.mult);M(t,_(r),o);break}case"statusPlayer":t.player.status[a.key]=Math.max(0,(t.player.status[a.key]??0)+a.n),s(t,`í”Œë ˆì´ì–´ ìƒíƒœ: ${a.key} ${a.n>=0?"+":""}${a.n}`);break;case"statusEnemy":if(a.target==="random"){const r=H(t);if(r.length===0)break;const o=_(r);ie(o,a.key,a.n),s(t,`ì (${o.name}) ìƒíƒœ: ${a.key} ${a.n>=0?"+":""}${a.n}`)}else if(a.target==="all"){const r=H(t);if(r.length===0)break;for(const o of r)ie(o,a.key,a.n);s(t,`ëª¨ë“  ì  ìƒíƒœ: ${a.key} ${a.n>=0?"+":""}${a.n}`)}else nn(t,a.key,a.n);break;case"statusEnemiesAttackingThisTurn":{const r=H(t).filter(o=>tn(t,o));if(r.length===0){s(t,`ì´ë²ˆ í„´ ê³µê²© ì˜ë„ ì  ì—†ìŒ â†’ ${a.key} ì ìš© ì—†ìŒ`);break}for(const o of r)o.status[a.key]=Math.max(0,(o.status[a.key]??0)+a.n);s(t,`ê³µê²© ì˜ë„ ì ì—ê²Œ ${a.key} ${a.n>=0?"+":""}${a.n} (ëŒ€ìƒ ${r.length})`);break}case"immuneDisruptThisTurn":t.player.immuneToDisruptThisTurn=!0,s(t,"ì´ë²ˆ í„´ êµë€ ë¬´ì‹œ");break;case"nullifyDamageThisTurn":t.player.nullifyDamageThisTurn=!0,s(t,"ì´ë²ˆ í„´ í”¼í•´ ë¬´íš¨");break;case"triggerFrontOfBackSlot":{const r=t.backSlots[a.index];if(!r){s(t,`ì¬ë°°ì¹˜: í›„ì—´ ${a.index+1}ë²ˆ ìŠ¬ë¡¯ì´ ë¹„ì–´ ìˆìŒ`);break}const o=I(t,r);s(t,`ì¬ë°°ì¹˜: [[${S(t,r)}]]ì˜ ì „ì—´ íš¨ê³¼ë¥¼ ì¶”ê°€ ë°œë™`),V({game:t},o.front);break}default:return a}}function oe(e,n){const t=e.content.enemiesById[n];return{id:t.id,name:t.name,hp:t.maxHp,maxHp:t.maxHp,intentIndex:0,status:{vuln:0,weak:0,bleed:0,disrupt:0},immuneThisTurn:!1,immuneNextTurn:!1,soulWarnCount:n==="boss_soul_stealer"?0:void 0,soulArmed:n==="boss_soul_stealer"?!1:void 0,soulWillNukeThisTurn:n==="boss_soul_stealer"?!1:void 0}}function an(e,n,t=5){const a=e.run.battleCount+1;for(const r of n){const o=e.run.enemyLastSeenBattle[r];if(o!=null&&a-o<t)return!1}return!0}function G(e,n){const t=n?.forceBoss??!1,a=e.run.nodePickCount;if(n?.forcePatternIds&&n.forcePatternIds.length>0){e.enemies=n.forcePatternIds.map(i=>oe(e,i)),s(e,`ì „íˆ¬ ì‹œì‘! (ë…¸ë“œ ${a}) ì : ${e.enemies.map(i=>i.name).join(", ")}`);return}if(t)if(e.run.bossPool.length===0)s(e,`ë³´ìŠ¤ í’€ì´ ë¹„ì—ˆìŠµë‹ˆë‹¤. ì¼ë°˜ ì „íˆ¬ë¡œ ì§„í–‰í•©ë‹ˆë‹¤. (ë…¸ë“œ ${a})`);else{const i=_(e.run.bossPool);e.run.bossPool=e.run.bossPool.filter(d=>d!==i),e.enemies=[oe(e,i)],s(e,`ë³´ìŠ¤ ë“±ì¥! (ë…¸ë“œ ${a}) ì : ${e.enemies[0].name}`);return}const r=[["goblin_raider"],["watching_statue"],["pebble_golem"],["slime"]],o=[["goblin_raider","goblin_raider","goblin_raider"],["rock_golem"],["pebble_golem","pebble_golem"],["slime","goblin_raider"]],l=a<=10?r:o,f=l.filter(i=>an(e,i,5)),c=f.length>0?f:l,p=_(c);e.run.battleCount+=1;for(const i of p)e.run.enemyLastSeenBattle[i]=e.run.battleCount;e.enemies=p.map(i=>oe(e,i)),s(e,`ì „íˆ¬ ì‹œì‘! (ë…¸ë“œ ${a}) ì : ${e.enemies.map(i=>i.name).join(", ")}`)}function J(e){e.phase="REVEAL",e.frontSlots=[null,null,null],e.backSlots=[null,null,null],e.backSlotDisabled=[!1,!1,!1],e.backUidsThisTurn=[],e.hand=[],e.selectedHandCardUid=null,e.pendingTarget=null,e.pendingTargetQueue=[],e.usedThisTurn=0,e.winHooksAppliedThisCombat=!1;const n=e.run.nextBattleSuppliesBonus??0;e.player.supplies=10+n,n>0&&(s(e,`ë‹¤ìŒ ì „íˆ¬ ë³´ë„ˆìŠ¤ ì ìš©: S +${n}`),e.run.nextBattleSuppliesBonus=0),e.player.immuneToDisruptThisTurn=!1,e.player.nullifyDamageThisTurn=!1,e.intentsRevealedThisTurn=!1,e.disruptIndexThisTurn=null,e.drawCountThisTurn=0,e.attackedEnemyIndicesThisTurn=[],e.frontPlacedThisTurn=0,e.usedThisTurn=0,ce(e,4),ue(e),e.phase="PLACE"}const rn=2,on=.6;function ue(e){if(e.intentsRevealedThisTurn)return;e.intentsRevealedThisTurn=!0,e.attackedEnemyIndicesThisTurn=[],e.backUidsThisTurn=[],e.drawCountThisTurn=0,e.phase="REVEAL",e.player.immuneToDisruptThisTurn=!1,e.player.nullifyDamageThisTurn=!1,e.disruptIndexThisTurn=null,e.backSlotDisabled=[!1,!1,!1],(e.player.status.disrupt??0)>0&&(e.disruptIndexThisTurn=Math.floor(Math.random()*3),e.backSlotDisabled[e.disruptIndexThisTurn]=!0);for(const t of e.enemies)t.immuneThisTurn=t.immuneNextTurn,t.immuneNextTurn=!1;for(const t of H(e)){const a=e.content.enemiesById[t.id],r=a.intents.length;if(r<=0)continue;if(t.intentIndex=Math.floor(Math.random()*r),t.id==="boss_soul_stealer"){t.soulWillNukeThisTurn=!1;const l=t.soulWarnCount??0;if(!!t.soulArmed){if(Math.random()<on){t.soulWillNukeThisTurn=!0,s(e,`ì  ì˜ë„: ${t.name} â†’ ì˜í˜¼ í­ë°œ (50 í”¼í•´!)`);continue}t.intentIndex=Math.floor(Math.random()*r);const p=a.intents[t.intentIndex];s(e,`ì  ì˜ë„: ${t.name} â†’ ${p.label} (âš  í­ë°œ ê°€ëŠ¥ ìƒíƒœ)`);continue}t.intentIndex=Math.floor(Math.random()*r);const c=a.intents[t.intentIndex];s(e,`ì  ì˜ë„: ${t.name} â†’ ${c.label} (ê²½ê³  ${l}/3)`);continue}const o=a.intents[t.intentIndex];s(e,`ì  ì˜ë„: ${t.name} â†’ ${o.label}`)}e.disruptIndexThisTurn!==null&&s(e,`êµë€: ì´ë²ˆ í„´ í›„ì—´ ${e.disruptIndexThisTurn} ë¬´íš¨`),e.phase="PLACE"}function sn(e,n,t,a){if(e.phase!=="PLACE"||!e.hand.includes(n))return;t==="back"&&(e.backUidsThisTurn.includes(n)||e.backUidsThisTurn.push(n));const r=t==="front"?e.frontSlots:e.backSlots;r[a]||(e.hand=e.hand.filter(o=>o!==n),r[a]=n,e.cards[n].zone=t,e.usedThisTurn+=1,s(e,`[${S(e,n)}]ë¥¼ ${t==="front"?"ì „ì—´":"í›„ì—´"} ${a}ë²ˆì— ë°°ì¹˜`),t==="front"&&(e.frontPlacedThisTurn+=1))}function be(e,n,t){return I(e,n).tags?.includes(t)??!1}function ln(e,n){e.frontSlots=e.frontSlots.map(t=>t===n?null:t),e.backSlots=e.backSlots.map(t=>t===n?null:t)}function ee(e,n,t){const a=I(e,n);ln(e,n),e.hand=e.hand.filter(l=>l!==n),e.deck=e.deck.filter(l=>l!==n),e.discard=e.discard.filter(l=>l!==n);const r=a.vanishWhen==="BOTH"||a.vanishWhen==="FRONT"&&t==="front"||a.vanishWhen==="BACK"&&t==="back",o=a.exhaustWhen==="BOTH"||a.exhaustWhen==="FRONT"&&t==="front"||a.exhaustWhen==="BACK"&&t==="back";if(a.vanishWhen&&r){e.vanished.push(n),e.cards[n].zone="vanished",s(e,`[${S(e,n)}] ì†Œì‹¤(ì˜êµ¬ ì œê±°)`);return}if(a.exhaustWhen&&o){e.exhausted.push(n),e.cards[n].zone="exhausted",s(e,`[${S(e,n)}] ì†Œëª¨(ì´ë²ˆ ì „íˆ¬ì—ì„œ ì œê±°)`);return}if(!a.vanishWhen&&be(e,n,"VANISH")){e.vanished.push(n),e.cards[n].zone="vanished",s(e,`[${S(e,n)}] ì†Œì‹¤(ì˜êµ¬ ì œê±°)`);return}if(!a.exhaustWhen&&be(e,n,"EXHAUST")){e.exhausted.push(n),e.cards[n].zone="exhausted",s(e,`[[${S(e,n)}]] ì†Œëª¨(ì´ë²ˆ ì „íˆ¬ì—ì„œ ì œê±°)`);return}e.discard.push(n),e.cards[n].zone="discard"}function dn(e){for(let n=0;n<3;n++){const t=e.frontSlots[n];t&&ee(e,t,"front"),e.frontSlots[n]=null;const a=e.backSlots[n];a&&ee(e,a,"back"),e.backSlots[n]=null}}function un(e){if(!(e.phase!=="PLACE"&&e.phase!=="BACK")){e.phase="BACK",s(e,"=== í›„ì—´ ë‹¨ê³„ ===");for(let n=0;n<3;n++){const t=e.backSlots[n];if(!t)continue;const a=I(e,t);if(!e.player.immuneToDisruptThisTurn&&e.backSlotDisabled[n]){s(e,`í›„ì—´ ${n}ë²ˆ [${a.name}] êµë€ìœ¼ë¡œ ë¬´íš¨`);continue}V({game:e},a.back),ee(e,t,"back")}e.phase="FRONT"}}function cn(e){if(e.phase==="FRONT"){s(e,"=== ì „ì—´ ë‹¨ê³„ ===");for(let n=0;n<3;n++){const t=e.frontSlots[n];if(!t)continue;const a=I(e,t);V({game:e},a.front),ee(e,t,"front")}e.phase="ENEMY"}}function pn(e){if(e.phase==="ENEMY"){s(e,"=== ì  í–‰ë™ ===");for(const n of H(e)){const t=e.content.enemiesById[n.id],a=t.intents[n.intentIndex%t.intents.length];if(n.id==="boss_soul_stealer"){if(n.soulWillNukeThisTurn){g(e,50,n),s(e,"ì˜í˜¼ ê°•íƒˆì: ì˜í˜¼ í­ë°œ â†’ 50 í”¼í•´!"),n.soulWillNukeThisTurn=!1,n.soulArmed=!1,n.soulWarnCount=0;continue}for(const r of a.acts)ke(e,n,r);n.intentIndex===rn&&(n.soulWarnCount=(n.soulWarnCount??0)+1,s(e,`ì˜í˜¼ ê°•íƒˆì: ê²½ê³  +1 (${n.soulWarnCount}/3)`),(n.soulWarnCount??0)>=3&&(n.soulArmed=!0,s(e,"ì˜í˜¼ ê°•íƒˆì: ê²½ê³  3íšŒ ì™„ë£Œ â†’ í­ë°œ ê°€ëŠ¥ ìƒíƒœ!")));continue}for(const r of a.acts)ke(e,n,r)}e.phase="UPKEEP"}}function ke(e,n,t){switch(t.op){case"damagePlayer":g(e,t.n,n);break;case"damagePlayerFormula":if(t.kind==="goblin_raider"){const a=Math.max(0,12-e.usedThisTurn);g(e,a,n),s(e,`ê³ ë¸”ë¦° ì•½íƒˆì: 12 - ì‚¬ìš© ${e.usedThisTurn}ì¥ = ${a} í”¼í•´`)}else{const a=4+e.usedThisTurn;g(e,a,n)}break;case"supplies":e.player.supplies=ne(e.player.supplies+t.n,0),s(e,`ì  íš¨ê³¼: ë³´ê¸‰ S ${t.n>=0?"+":""}${t.n} (í˜„ì¬ ${e.player.supplies})`);break;case"statusPlayer":De(e.player,t.key,t.n),s(e,`ì  íš¨ê³¼: í”Œë ˆì´ì–´ ìƒíƒœ ${t.key} ${t.n>=0?"+":""}${t.n}`);break;case"enemyHealSelf":n.hp=Math.min(n.maxHp,n.hp+t.n),s(e,`ì (${n.name})ì´(ê°€) ${t.n} íšŒë³µ (HP ${n.hp}/${n.maxHp})`);break;case"enemyImmuneThisTurn":n.immuneThisTurn=!0,s(e,`ì (${n.name})ì´(ê°€) í”¼í•´ ë©´ì—­ ìƒíƒœê°€ ë¨`);break;case"enemyImmuneNextTurn":n.immuneNextTurn=!0,s(e,`ì (${n.name})ì´(ê°€) ë‹¤ìŒ í„´ í”¼í•´ ë©´ì—­ ìƒíƒœê°€ ë¨`);break;case"fatiguePlayer":e.player.fatigue=Math.max(0,e.player.fatigue+t.n),s(e,`ì  íš¨ê³¼: í”¼ë¡œ F ${t.n>=0?"+":""}${t.n} (í˜„ì¬ ${e.player.fatigue})`);break;default:return t}}function fn(e){if(e.phase!=="UPKEEP")return;s(e,"=== ìœ ì§€ë¹„ / ìƒíƒœ ì²˜ë¦¬ ===");const n=e.frontPlacedThisTurn;n>0&&s(e,`ì „ì—´ ìœ ì§€ë¹„ ì²˜ë¦¬: ì „ì—´ ${n}ì¥`);for(let a=0;a<n;a++)e.player.supplies>0?e.player.supplies-=1:(e.player.hp-=3,e.player.hp<0&&(e.player.hp=0),e.player.fatigue+=1,s(e,`ì „ì—´ ìœ ì§€ë¹„ ë¶€ì¡±: HP -3, F +1 (HP ${e.player.hp}, F ${e.player.fatigue})`));if(e.player.supplies===0){e.player.zeroSupplyTurns+=1;const a=e.player.zeroSupplyTurns;e.player.hp-=a,e.player.hp<0&&(e.player.hp=0),s(e,`S=0 ì¢…ë£Œ íŒ¨ë„í‹°: ëˆ„ì  ${a}ë²ˆì§¸ â†’ HP -${a} (HP ${e.player.hp})`)}const t=e.player.status.bleed??0;t>0&&(e.player.hp-=t,e.player.hp<0&&(e.player.hp=0),s(e,`ì¶œí˜ˆë¡œ HP -${t} (í˜„ì¬ ${e.player.hp}/${e.player.maxHp})`));for(const a of H(e)){const r=a.status.bleed??0;r>0&&(a.immuneThisTurn?s(e,`ì (${a.name})ì€(ëŠ”) ì´ë²ˆ í„´ ë©´ì—­ì´ë¼ ì¶œí˜ˆ í”¼í•´ ë¬´ì‹œ`):(a.hp=Math.max(0,a.hp-r),s(e,`ì (${a.name}) ì¶œí˜ˆë¡œ HP -${r} (HP ${a.hp}/${a.maxHp})`)))}e.frontPlacedThisTurn=0,hn(e),dn(e),e.phase="DRAW"}function hn(e){const n=["vuln","weak","bleed","disrupt"];for(const t of n)e.player.status[t]>0&&(e.player.status[t]-=1);for(const t of e.enemies)for(const a of n)t.status[a]>0&&(t.status[a]-=1)}function mn(e){if(e.phase!=="DRAW"||(e.intentsRevealedThisTurn=!1,e.disruptIndexThisTurn=null,kn(e),e.run.finished))return;if(H(e).length===0){e.phase="NODE";return}const n=e.usedThisTurn;e.usedThisTurn=0,ce(e,n),e.player.block>0&&(e.player.block=0,s(e,"ë°©ì–´(ë¸”ë¡) ì†Œì‹¤")),ue(e)}function ce(e,n){let t=0;for(let a=0;a<n;a++){Tn(e);const r=e.deck.pop();if(!r)break;e.hand.push(r),t++}return s(e,`ë“œë¡œìš° ${t}/${n} (ì†íŒ¨ ${e.hand.length})`),t}function Tn(e){if(e.deck.length===0&&e.discard.length>0){e.deck=Se(e.discard),e.discard=[];const n=e.player.fatigue;n>0?(e.player.hp-=n,e.player.hp<0&&(e.player.hp=0),s(e,`ë¦¬ì…”í”Œ í”¼ë¡œ: HP -${n} (F=${n})`)):s(e,"ë¦¬ì…”í”Œ: í”¼ë¡œ í”¼í•´ ì—†ìŒ (F=0)"),e.player.fatigue+=1,s(e,`í”¼ë¡œ F +1 (í˜„ì¬ ${e.player.fatigue})`)}}function bn(e,n){if(!e.pendingTarget)return;if(H(e).length===0){e.pendingTarget=null,e.pendingTargetQueue=[];return}const t=e.enemies[n];if(!t||t.hp<=0)return;const a=e.pendingTarget;a.kind==="damageSelect"?M(e,t,a.amount):a.kind==="statusSelect"&&(ie(t,a.key,a.n),s(e,`ì (${t.name}) ìƒíƒœ: ${a.key} ${a.n>=0?"+":""}${a.n}`)),e.pendingTarget=e.pendingTargetQueue.shift()??null}function kn(e){if(e.player.hp<=0){e.run.finished=!0,s(e,"íŒ¨ë°°: í”Œë ˆì´ì–´ HPê°€ 0 ì´í•˜");return}H(e).length===0&&e.phase!=="NODE"&&(Cn(e),s(e,"ìŠ¹ë¦¬: ì ì„ ëª¨ë‘ ì²˜ì¹˜!"),yn(e),e.player.zeroSupplyTurns=0,e.phase="NODE",e.run.treasureObtained&&(e.run.afterTreasureNodePicks+=1),e.run.treasureObtained&&e.run.afterTreasureNodePicks>=10&&(e.run.finished=!0,s(e,"ìŠ¹ë¦¬! ì €ì£¼ë°›ì€ ë³´ë¬¼ì„ ì–»ì€ í›„ 10í„´ ë™ì•ˆ ì‚´ì•„ë‚¨ì•˜ìŠµë‹ˆë‹¤.")))}function yn(e){const n=[];for(const o of e.deck)n.push(o);for(const o of e.hand)n.push(o);for(const o of e.discard)n.push(o);for(const o of e.frontSlots)o&&n.push(o);for(const o of e.backSlots)o&&n.push(o);for(const o of e.exhausted)n.push(o);const t=new Set,r=n.filter(o=>t.has(o)?!1:(t.add(o),!0)).filter(o=>e.cards[o]?.zone!=="vanished");e.deck=r;for(const o of r)e.cards[o].zone="deck";e.hand=[],e.discard=[],e.frontSlots=[null,null,null],e.backSlots=[null,null,null],e.selectedHandCardUid=null,e.exhausted=[],e.pendingTarget=null,e.pendingTargetQueue=[],xn(e.deck)}function xn(e){for(let n=e.length-1;n>0;n--){const t=Math.floor(Math.random()*(n+1));[e[n],e[t]]=[e[t],e[n]]}}function Cn(e){if(!e.winHooksAppliedThisCombat){e.winHooksAppliedThisCombat=!0;for(const n of e.backUidsThisTurn){if(!e.cards[n])continue;const r=I(e,n).onWinWhileInBack;!r||r.length===0||V({game:e},r)}}}const En=`# Deck Rogue Prototype â€” ë£°ë¶ (í”Œë ˆì´ì–´ìš©)

ì´ ë¬¸ì„œëŠ” ìŠ¤í¬ì¼ëŸ¬ë¥¼ ìµœì†Œí™”í•©ë‹ˆë‹¤.

[1] ê°œìš”
ë…¸ë“œë¥¼ ì„ íƒí•˜ë©° ì§„í–‰í•˜ê³ , ì „íˆ¬ì—ì„œ ì‚´ì•„ë‚¨ì•„ ì„±ì¥í•©ë‹ˆë‹¤. ëª©í‘œëŠ” ë¬´ì—‡ì¼ê¹Œìš”?
ëª¨ë“  ì¹´ë“œëŠ” ì „ì—´ê³¼ í›„ì—´ì´ ìˆìŠµë‹ˆë‹¤. ë°°ì¹˜ì— ë”°ë¼ ì—­í• ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤.

[2] ë³´ê¸‰ê³¼ í”¼ë¡œë„

ë³´ê¸‰(S): ì „ì—´ ì¹´ë“œ ë° ì¼ë¶€ íš¨ê³¼ì˜ ë°œë™ì— ì‚¬ìš©ë©ë‹ˆë‹¤. ë³´í†µ 10ìœ¼ë¡œ ì‹œì‘í•©ë‹ˆë‹¤.
ë³´ê¸‰ì´ ë¶€ì¡±í•œ ìƒíƒœë¡œ í„´ ì¢…ë£Œ ì‹œ, HPë¥¼ ë³´ê¸‰ ì—†ì´ ì¢…ë£Œí•œ í„´ì˜ íšŸìˆ˜ë§Œí¼ ìƒìŠµë‹ˆë‹¤.

í”¼ë¡œë„(F): ë±ì„ ì„ì„ ë•Œ í”¼ë¡œë„ê°€ 1 ì˜¬ë¼ê°€ë©°, ì¼ë¶€ ì¹´ë“œì˜ íš¨ê³¼ë¡œë„ ë³€í•©ë‹ˆë‹¤.
ë±ì„ ì„ì„ ë•Œ í”¼ë¡œë„ë§Œí¼ í”¼í•´ë¥¼ ì…ìŠµë‹ˆë‹¤. í”¼ë¡œë„ëŠ” ì „íˆ¬ê°€ ëë‚˜ë„ ìœ ì§€ë©ë‹ˆë‹¤.

ë³´ê¸‰ì´ ë¶€ì¡±í•œ ì±„ë¡œ í„´ì„ ë§ˆì¹  ë•Œ, ì‚¬ìš©í•œ ì „ì—´ ì¹´ë“œ í•œ ì¥ ë‹¹ HPë¥¼ 3 ìƒìœ¼ë©°, Fê°€ 1 ì¦ê°€í•©ë‹ˆë‹¤.
ì´ íš¨ê³¼ëŠ” ë³´ê¸‰ ìì²´ì— ì˜í•œ HP ì†ì‹¤ê³¼ ë³„ê°œì…ë‹ˆë‹¤!

[3] ì „íˆ¬ íë¦„
ë°°ì¹˜ â†’ í›„ì—´ ë°œë™ â†’ ì „ì—´ ë°œë™ â†’ ì  í–‰ë™ â†’ ì •ë¦¬ â†’ ë“œë¡œìš°
â€» â€œëŒ€ìƒ ì„ íƒ í•„ìš”â€ê°€ ëœ¨ë©´ ì‚´ì•„ìˆëŠ” ì ì„ í´ë¦­í•´ ëŒ€ìƒì„ ì •í•˜ì„¸ìš”.
â€» í›„ì—´ ë°œë™ì„ ëˆ„ë¥´ë©´ í„´ì´ ì§„í–‰ë˜ì–´, ì¹´ë“œì˜ ë°°ì¹˜ë¥¼ ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
ë³´ê¸‰ ë° ê·¸ì— ë”°ë¥¸ ë³€í™”ëŠ” ì •ë¦¬ ë‹¨ê³„ì—ì„œ ì²˜ë¦¬í•©ë‹ˆë‹¤.

ì†íŒ¨ëŠ” í„´ì´ ì¢…ë£Œë˜ì–´ë„ ìœ ì§€ë©ë‹ˆë‹¤.
ì¹´ë“œëŠ” ë§¤ í„´ë§ˆë‹¤ ì‚¬ìš©í•œ ë§Œí¼ ë½‘ìŠµë‹ˆë‹¤. ì¦‰, ì¹´ë“œë¡œ ì¸í•œ ë“œë¡œìš°ëŠ” íŒ¨ì˜ ë§¤ìˆ˜ ìì²´ë¥¼ ëŠ˜ë¦¬ëŠ” íš¨ê³¼ê°€ ìˆìŠµë‹ˆë‹¤.

[4] ìš©ì–´
- ì†Œëª¨: ì´ë²ˆ ì „íˆ¬ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ì—†ê²Œ ë˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
- ì†Œì‹¤: ëŸ° ì „ì²´ì—ì„œ í•´ë‹¹ ì¹´ë“œê°€ ì‚¬ë¼ì§€ëŠ” ê²ƒì…ë‹ˆë‹¤.
- ì·¨ì•½: ë°›ëŠ” í”¼í•´ê°€ (ì·¨ì•½)ë§Œí¼ ì¦ê°€í•©ë‹ˆë‹¤.
- ì•½í™”: ì£¼ëŠ” í”¼í•´ê°€ (ì•½í™”)ë§Œí¼ ê°ì†Œí•©ë‹ˆë‹¤.
- ì¶œí˜ˆ: í„´ ì¢…ë£Œ ì‹œ (ì¶œí˜ˆ)ë§Œí¼ í”¼í•´ë¥¼ ì…ìŠµë‹ˆë‹¤.
- êµë€: ë‹¹ì‹ ì„ ë°©í•´í•©ë‹ˆë‹¤. ë¬´ì—‡ì¼ê¹Œìš”?

[6] ì¡°ì‘
- Esc: ì„ íƒ í•´ì œ
- Tab: ì†íŒ¨ ì„ íƒ ì´ë™
- 1~3: ì „ì—´ ë°°ì¹˜ / Shift+1~3: í›„ì—´ ë°°ì¹˜
- ë“œë˜ê·¸: ì†íŒ¨â†’ìŠ¬ë¡¯ ë°°ì¹˜, ìŠ¬ë¡¯â†”ìŠ¬ë¡¯ ìŠ¤ì™‘, ìŠ¬ë¡¯â†’ì†íŒ¨ íšŒìˆ˜
`;let F=!1,O=null,se=[],ye=!1,h=null,U=null;function Ie(e,n){let t=null;const a={rerender:()=>u(e,a),onToggleLog:()=>{F=!F,u(e,a)},onCloseOverlay:()=>{O=se.pop()??null,u(e,a)},onNewRun:()=>{const r=Pe(e.content);n(r)},onViewRulebook:()=>{O&&se.push(O),O={kind:"RULEBOOK"},u(e,a)},onReturnSlotToHand:(r,o)=>{if(e.run.finished||R(e)||e.phase!=="PLACE")return;const l=r==="front"?e.frontSlots:e.backSlots,f=l[o];f&&(l[o]=null,e.hand.push(f),e.cards[f].zone="hand",s(e,`[${S(e,f)}] íšŒìˆ˜: ${r}${o+1} â†’ ì†íŒ¨`),u(e,a))},onClearSelected:()=>{e.selectedHandCardUid=null,u(e,a)},onSelectHandCard:r=>{R(e)||(e.selectedHandCardUid=e.selectedHandCardUid===r?null:r,u(e,a))},onViewPile:r=>{O&&se.push(O),O={kind:"PILE",pile:r},u(e,a)},getNodeOffers:()=>(e.run.branchOffer||(e.run.branchOffer=z(e)),(e.run.nodePickCount+1)%30===0?[{id:"A",type:"BATTLE"},{id:"B",type:"BATTLE"}]:e.run.branchOffer.root),onChooseNode:r=>{if(e.run.finished)return;if(e.phase!=="NODE"){s(e,`ë¬´ì‹œ: ì „íˆ¬/ì§„í–‰ ì¤‘ ë…¸ë“œ ì„ íƒ ì‹œë„ (phase=${e.phase})`);return}e.run.branchOffer||(e.run.branchOffer=z(e));const o=e.run.nodePickCount+1,l=o%30===0,c=l?"BATTLE":r==="A"?e.run.branchOffer.root[0].type:e.run.branchOffer.root[1].type;if(e.run.nodePickCount=o,e.run.nodePickByType[c]=(e.run.nodePickByType[c]??0)+1,Re(e,r),e.run.treasureObtained&&c!=="TREASURE"&&(e.run.afterTreasureNodePicks+=1,e.run.afterTreasureNodePicks>=10)){e.run.finished=!0,s(e,"ìŠ¹ë¦¬! ì €ì£¼ë°›ì€ ë³´ë¬¼ì„ ì–»ì€ í›„ 10ë²ˆì˜ íƒí—˜ì„ ë²„í…¼ìŠµë‹ˆë‹¤."),u(e,a);return}if(c==="BATTLE"){l&&s(e,`=== ${o}ë²ˆì§¸ ë…¸ë“œ: ë³´ìŠ¤ ì „íˆ¬ ===`),G(e,{forceBoss:l}),J(e),u(e,a);return}if(c==="REST"){e.choice={kind:"EVENT",title:"íœ´ì‹",prompt:"ë¬´ì—‡ì„ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",options:[{key:"rest:heal",label:"HP +15"},{key:"rest:clear_f",label:"F -3"},{key:"rest:upgrade",label:"ì¹´ë“œ ê°•í™” (+1)"},{key:"rest:skip",label:"ìƒëµ"}]},t=p=>{if(p==="rest:heal")e.player.hp=Math.min(e.player.maxHp,e.player.hp+15),s(e,"íœ´ì‹: HP +15");else if(p==="rest:clear_f")e.player.fatigue=Math.max(0,e.player.fatigue-3),s(e,"íœ´ì‹: í”¼ë¡œ F-=3");else if(p==="rest:upgrade"){const i=Object.values(e.cards).filter(d=>d.zone==="deck"||d.zone==="hand"||d.zone==="discard").map(d=>d.uid).filter(d=>He(e,d));if(i.length===0){s(e,"ê°•í™”í•  ìˆ˜ ìˆëŠ” ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤."),e.choice=null,t=null,u(e,a);return}e.choice={kind:"PICK_CARD",title:"ì¹´ë“œ ê°•í™”",prompt:"ê°•í™”í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",options:[...i.map(d=>{const C=I(e,d);return{key:`upgrade:${d}`,label:S(e,d),detail:`ì „ì—´: ${C.frontText} / í›„ì—´: ${C.backText}`,cardUid:d}}),{key:"cancel",label:"ì·¨ì†Œ"}]},t=d=>{if(d==="cancel"){e.choice=null,t=null,u(e,a);return}if(!d.startsWith("upgrade:"))return;const C=d.slice(8);Ze(e,C)?s(e,`ê°•í™” ì™„ë£Œ: ${S(e,C)}`):s(e,"ê°•í™” ì‹¤íŒ¨(ìµœëŒ€ ê°•í™”/ëŒ€ìƒ ì—†ìŒ)"),e.choice=null,t=null,u(e,a)},u(e,a);return}else s(e,"íœ´ì‹: ìƒëµ");e.choice=null,t=null,u(e,a)},u(e,a);return}if(c==="TREASURE"){e.run.treasureObtained=!0,e.run.afterTreasureNodePicks=0,s(e,"ì €ì£¼ë°›ì€ ë³´ë¬¼ì„ ì–»ì—ˆìŠµë‹ˆë‹¤! ì´ì œë¶€í„° 10ë²ˆì˜ íƒí—˜ì„ ë²„í‹°ë©´ ìŠ¹ë¦¬í•©ë‹ˆë‹¤."),u(e,a);return}if(c==="EVENT"){const p=je(),i=p.options(e);e.choice={kind:"EVENT",title:p.name,prompt:p.prompt,options:i.map(d=>({key:d.key,label:d.label,detail:d.detail}))},t=d=>{const C=i.find($=>$.key===d);if(!C)return;const b=C.apply(e);if(typeof b=="object"&&b.kind==="REMOVE_PICK"){const $=Object.values(e.cards).filter(T=>T.zone==="deck"||T.zone==="hand"||T.zone==="discard").map(T=>T.uid);e.choice={kind:"PICK_CARD",title:b.title,prompt:b.prompt??"ì œê±°í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",options:[...$.map(T=>{const m=I(e,T);return{key:`remove:${T}`,label:S(e,T),detail:`ì „ì—´: ${m.frontText} / í›„ì—´: ${m.backText}`,cardUid:T}}),{key:"cancel",label:"ì·¨ì†Œ"}]},t=T=>{if(T==="cancel"){e.choice=null,t=null,u(e,a);return}if(!T.startsWith("remove:")){u(e,a);return}const m=T.slice(7);if(Je(e,m),b.then==="BATTLE"){e.choice=null,t=null,G(e),J(e),u(e,a);return}if(b.then==="REWARD_PICK"){const[y,x]=me(),B=Y(e.content,y.defId,y.upgrade),w=Y(e.content,x.defId,x.upgrade),W=y.upgrade>0?`${B.name} +${y.upgrade}`:B.name,A=x.upgrade>0?`${w.name} +${x.upgrade}`:w.name;e.choice={kind:"REWARD",title:"ì¹´ë“œ ë³´ìƒ",prompt:"ë‘ ì¥ ì¤‘ í•œ ì¥ì„ ì„ íƒí•˜ê±°ë‚˜ ìƒëµí•©ë‹ˆë‹¤.",options:[{key:`pick:${y.defId}:${y.upgrade}`,label:W,detail:`ì „ì—´: ${B.frontText} / í›„ì—´: ${B.backText}`},{key:`pick:${x.defId}:${x.upgrade}`,label:A,detail:`ì „ì—´: ${w.frontText} / í›„ì—´: ${w.backText}`},{key:"skip",label:"ìƒëµ"}]},t=N=>{if(N.startsWith("pick:")){const[,j,te]=N.split(":"),q=Number(te??"0")||0;Te(e,j,{upgrade:q})}else s(e,"ì¹´ë“œ ë³´ìƒ ìƒëµ");e.choice=null,t=null,u(e,a)},u(e,a);return}e.choice=null,t=null,u(e,a)},u(e,a);return}if(typeof b=="object"&&b.kind==="BATTLE_SPECIAL"){e.choice=null,t=null,s(e,b.title?`ì´ë²¤íŠ¸ ì „íˆ¬: ${b.title}`:"ì´ë²¤íŠ¸ ì „íˆ¬ ë°œìƒ!"),G(e,{forcePatternIds:b.enemyIds}),J(e),u(e,a);return}if(b==="BATTLE"){e.choice=null,t=null,G(e),J(e),u(e,a);return}if(b==="REWARD_PICK"){const[$,T]=me(),m=Y(e.content,$.defId,$.upgrade),y=Y(e.content,T.defId,T.upgrade),x=$.upgrade>0?`${m.name} +${$.upgrade}`:m.name,B=T.upgrade>0?`${y.name} +${T.upgrade}`:y.name;e.choice={kind:"REWARD",title:"ì¹´ë“œ ë³´ìƒ",prompt:"ë‘ ì¥ ì¤‘ í•œ ì¥ì„ ì„ íƒí•˜ê±°ë‚˜ ìƒëµí•©ë‹ˆë‹¤.",options:[{key:`pick:${$.defId}:${$.upgrade}`,label:x,detail:`ì „ì—´: ${m.frontText} / í›„ì—´: ${m.backText}`},{key:`pick:${T.defId}:${T.upgrade}`,label:B,detail:`ì „ì—´: ${y.frontText} / í›„ì—´: ${y.backText}`},{key:"skip",label:"ìƒëµ"}]},t=w=>{if(w.startsWith("pick:")){const[,W,A]=w.split(":"),N=Number(A??"0")||0;Te(e,W,{upgrade:N})}else s(e,"ì¹´ë“œ ë³´ìƒ ìƒëµ");e.choice=null,t=null,u(e,a)},u(e,a);return}e.choice=null,t=null,u(e,a)},u(e,a);return}},onChooseChoice:r=>{e.choice&&t&&t(r)},onRevealIntents:()=>{e.run.finished||e.enemies.length!==0&&(ue(e),u(e,a))},onSelectEnemy:r=>{bn(e,r),u(e,a)},onPlaceHandUidToSlot:(r,o,l)=>{e.run.finished||R(e)||e.phase==="PLACE"&&(o==="back"&&e.backSlotDisabled?.[l]||(sn(e,r,o,l),e.selectedHandCardUid=null,u(e,a)))},onPlaceSelected:(r,o)=>{e.selectedHandCardUid&&a.onPlaceHandUidToSlot(e.selectedHandCardUid,r,o)},onMoveSlotCard:(r,o,l,f)=>{if(e.run.finished||R(e)||e.phase!=="PLACE"||l==="back"&&e.backSlotDisabled?.[f])return;const c=r==="front"?e.frontSlots:e.backSlots,p=l==="front"?e.frontSlots:e.backSlots,i=c[o];if(!i)return;const d=p[f];c[o]=d??null,p[f]=i,e.cards[i].zone=l,d&&(e.cards[d].zone=r);const C=S(e,i),b=d?S(e,d):null;s(e,d?`[${C}] â†” [${b}] ìŠ¤ì™‘: ${r}${o+1} â†” ${l}${f+1}`:`[${C}] ì´ë™: ${r}${o+1} â†’ ${l}${f+1}`),u(e,a)},onResolveBack:()=>{un(e),u(e,a)},onResolveFront:()=>{cn(e),u(e,a)},onResolveEnemy:()=>{pn(e),u(e,a)},onUpkeep:()=>{fn(e),u(e,a)},onDrawNextTurn:()=>{mn(e),u(e,a)}};return a}function $n(){const e=document.querySelector("#app");return e.innerHTML="",e}function u(e,n){const t=$n();ye||(Pn(t,e,n),ye=!0);const a=k("row top"),r=k("panel"),o=k("panel");r.appendChild(le("ìƒíƒœ")),r.appendChild(Bn(e)),r.appendChild(X()),r.appendChild(D("í”Œë ˆì´ì–´ ìƒíƒœ")),r.appendChild(On(e.player.status));const l=k("controls");l.appendChild(E("ë±",()=>n.onViewPile("deck"),!1)),l.appendChild(E("ë²„ë¦¼",()=>n.onViewPile("discard"),!1)),l.appendChild(E("ì†Œëª¨",()=>n.onViewPile("exhausted"),!1)),l.appendChild(E("ì†Œì‹¤",()=>n.onViewPile("vanished"),!1)),l.appendChild(E("ì†íŒ¨",()=>n.onViewPile("hand"),!1)),l.appendChild(E("ë£°ë¶",n.onViewRulebook,!1)),l.appendChild(E("ìƒˆ ëŸ°",n.onNewRun,!1)),r.appendChild(l),r.appendChild(X()),r.appendChild(D("ì "));const f=R(e),c=(e.pendingTarget?1:0)+(e.pendingTargetQueue?.length??0);if(e.enemies.length===0)r.appendChild(v("í˜„ì¬ ì „íˆ¬ ì—†ìŒ"));else{if(f){const m=k("banner banner-left");m.textContent=`ëŒ€ìƒ ì„ íƒì´ í•„ìš”í•©ë‹ˆë‹¤. (ë‚¨ì€ ì„ íƒ ${c})`,r.appendChild(m)}const b=e.enemies.map((m,y)=>({e:m,i:y})).filter(({e:m})=>m.hp>0),$=e.enemies.map((m,y)=>({e:m,i:y})).filter(({e:m})=>m.hp<=0),T=[...b,...$];for(const{e:m,i:y}of T){const x=k("enemyBox");x.dataset.enemyIndex=String(y);const B=m.hp>0,w=f&&B;w&&x.classList.add("targetable"),B||x.classList.add("dead");const W=v(`${y+1}. ${m.name} (HP ${m.hp}/${m.maxHp})`);W.className="enemyTitle",x.appendChild(W);const A=k("badgesRow");m.immuneThisTurn&&A.appendChild(P("ë©´ì—­ âœ¨")),B||A.appendChild(P("DEAD"));const N=m.status;(N.vuln??0)>0&&A.appendChild(P(`ì·¨ì•½ ${N.vuln}`)),(N.weak??0)>0&&A.appendChild(P(`ì•½í™” ${N.weak}`)),(N.bleed??0)>0&&A.appendChild(P(`ì¶œí˜ˆ ${N.bleed}`)),(N.disrupt??0)>0&&A.appendChild(P(`êµë€ ${N.disrupt}`)),A.childNodes.length>0&&x.appendChild(A);const j=e.content.enemiesById[m.id],te=j.intents[m.intentIndex%j.intents.length],q=v(e.intentsRevealedThisTurn?`ì˜ë„: ${te.label}`:"ì˜ë„: (ë¯¸ê³µê°œ)");q.className=e.intentsRevealedThisTurn?"intentOn":"intentOff",x.appendChild(q);const Q=document.createElement("button");Q.textContent=w?"ì´ ì ì„ ì„ íƒ":"ëŒ€ìƒ ì„ íƒ",Q.disabled=!w,Q.onclick=()=>n.onSelectEnemy(y),x.appendChild(Q),r.appendChild(x)}}if(o.appendChild(le("ì§„í–‰")),f){const b=k("banner banner-target");b.textContent=`âš  ëŒ€ìƒ ì„ íƒ í•„ìš” (ë‚¨ì€ ì„ íƒ ${c}) â€” ì™¼ìª½ì—ì„œ ì‚´ì•„ìˆëŠ” ì ì„ ê³ ë¥´ì„¸ìš”.`,o.appendChild(b)}e.run.finished?o.appendChild(v("ëŸ° ì¢…ë£Œ")):O?Rn(o,e,n,O):e.choice?An(o,e,n):e.phase==="NODE"?wn(o,e,n):Sn(o,e,n,f),a.appendChild(r),a.appendChild(o);const p=k("panel logPanel"+(F?" collapsed":"")),i=k("row");i.style.gridTemplateColumns="1fr auto",i.style.alignItems="center",i.appendChild(le("ë¡œê·¸"));const C=E(F?"ë¡œê·¸ í¼ì¹˜ê¸°":"ë¡œê·¸ ì ‘ê¸°",n.onToggleLog,!1);C.classList.add("primary"),i.appendChild(C),p.appendChild(i),F||p.appendChild(_n(e.log.join(`
`))),t.appendChild(a),t.appendChild(p),Nn(t,e)}function Sn(e,n,t,a){const r=k("controls combatControls");r.appendChild(E("ì˜ë„ ê³µê°œ(ì •ì°°)",t.onRevealIntents,n.enemies.length===0||n.intentsRevealedThisTurn||n.phase!=="PLACE"||a)),r.appendChild(E("í›„ì—´ ë°œë™",t.onResolveBack,!(n.phase==="PLACE"||n.phase==="BACK")||a)),r.appendChild(E("ì „ì—´ ë°œë™",t.onResolveFront,n.phase!=="FRONT"||a)),r.appendChild(E("ì  í–‰ë™",t.onResolveEnemy,n.phase!=="ENEMY"||a)),r.appendChild(E("í„´ ì •ë¦¬",t.onUpkeep,n.phase!=="UPKEEP"||a)),r.appendChild(E("ë“œë¡œìš°",t.onDrawNextTurn,n.phase!=="DRAW"||a)),r.appendChild(E("ì„ íƒ í•´ì œ(Esc)",t.onClearSelected,!n.selectedHandCardUid)),e.appendChild(r),e.appendChild(X()),e.appendChild(D("ì „ì—´ ìŠ¬ë¡¯ (1~3)")),e.appendChild(xe(n,t,"front")),e.appendChild(D("í›„ì—´ ìŠ¬ë¡¯ (Shift+1~3)")),e.appendChild(xe(n,t,"back")),e.appendChild(X()),e.appendChild(D(`ì†íŒ¨ (${n.hand.length}) â€” Tabë¡œ ì„ íƒ ì´ë™`));const o=k("hand");o.dataset.dropHand="1";for(const f of n.hand)o.appendChild(Be(n,f,!0,t.onSelectHandCard));e.appendChild(o);const l=Oe("ë“œë˜ê·¸: ì†íŒ¨â†’ìŠ¬ë¡¯ ë°°ì¹˜ / ìŠ¬ë¡¯â†’ìŠ¬ë¡¯ ìŠ¤ì™‘. í‚¤ë³´ë“œ: 1~3 ì „ì—´, Shift+1~3 í›„ì—´, Tab ì´ë™, Esc í•´ì œ.");l.className="help",e.appendChild(l)}function xe(e,n,t){const a=k("grid6"),r=!!e.selectedHandCardUid,o=t==="front"?e.frontSlots:e.backSlots;for(let l=0;l<3;l++){const f=t==="back"?!!e.backSlotDisabled?.[l]:!1,c=k("slot"+(f?" disabled":""));c.dataset.slotSide=t,c.dataset.slotIndex=String(l),U&&U.side===t&&U.idx===l&&c.classList.add("dropHover"),r&&!f&&c.classList.add("placeable"),c.appendChild(Oe(`${t==="front"?"ì „ì—´":"í›„ì—´"} ${l+1}`));const p=o[l];if(p){c.appendChild(Be(e,p,!1));const i=c.querySelector(".card");i&&(i.onpointerdown=d=>{d.button!==0&&d.pointerType==="mouse"||R(e)||e.phase==="PLACE"&&Ne(d,{kind:"slot",cardUid:p,fromSide:t,fromIdx:l})},i.ondblclick=()=>{n.onReturnSlotToHand(t,l)})}c.onclick=()=>{f||n.onPlaceSelected(t,l)},a.appendChild(c)}return a}function Pn(e,n,t){e.onpointermove=a=>{if(!h||a.pointerId!==h.pointerId)return;h.x=a.clientX,h.y=a.clientY;const r=h.x-h.startX,o=h.y-h.startY;!h.dragging&&r*r+o*o>36&&(h.dragging=!0),U=h.dragging?Ce(a.clientX,a.clientY,n):null,u(n,t)},e.onpointerup=a=>{if(!(!h||a.pointerId!==h.pointerId)){if(h.dragging){const r=Ce(a.clientX,a.clientY,n);r?h.kind==="hand"?t.onPlaceHandUidToSlot(h.cardUid,r.side,r.idx):h.kind==="slot"&&h.fromSide!=null&&h.fromIdx!=null&&(h.fromSide===r.side&&h.fromIdx===r.idx||t.onMoveSlotCard(h.fromSide,h.fromIdx,r.side,r.idx)):h.kind==="slot"&&h.fromSide!=null&&h.fromIdx!=null&&In(a.clientX,a.clientY)&&t.onReturnSlotToHand(h.fromSide,h.fromIdx)}h=null,U=null,u(n,t)}},window.addEventListener("keydown",a=>{const r=a.target;if(r&&(r.tagName==="INPUT"||r.tagName==="TEXTAREA"))return;if(R(n)){a.key==="Escape"&&(a.preventDefault(),t.onClearSelected());return}if(a.key==="Escape"){a.preventDefault(),t.onClearSelected();return}if(a.key==="Tab"){if(a.preventDefault(),n.hand.length===0)return;const l=n.selectedHandCardUid,f=l?n.hand.indexOf(l):-1,c=a.shiftKey?-1:1,p=((f+c)%n.hand.length+n.hand.length)%n.hand.length;n.selectedHandCardUid=n.hand[p],u(n,t);return}const o=Hn(a.code);if(o!=null){if(!n.selectedHandCardUid||n.phase!=="PLACE")return;const l=o-1;a.shiftKey?t.onPlaceSelected("back",l):t.onPlaceSelected("front",l);return}})}function Hn(e){return e==="Digit1"?1:e==="Digit2"?2:e==="Digit3"?3:null}function Ne(e,n){e.currentTarget.setPointerCapture(e.pointerId),h={kind:n.kind,cardUid:n.cardUid,fromSide:n.fromSide,fromIdx:n.fromIdx,pointerId:e.pointerId,startX:e.clientX,startY:e.clientY,x:e.clientX,y:e.clientY,dragging:!1}}function Ce(e,n,t){const a=document.elementFromPoint(e,n);if(!a)return null;const r=Ae(a,["slotSide","slotIndex"]);if(!r)return null;const o=r.dataset.slotSide,l=Number(r.dataset.slotIndex);return o==="back"&&t.backSlotDisabled?.[l]?null:{side:o,idx:l}}function In(e,n){const t=document.elementFromPoint(e,n);return t?!!Ae(t,["dropHand"]):!1}function Ae(e,n){let t=e;for(;t;){const a=t.dataset;let r=!0;for(const o of n)if(a[o]==null){r=!1;break}if(r)return t;t=t.parentElement}return null}function Nn(e,n){if(!h||!h.dragging)return;const t=k("dragGhost");t.textContent=S(n,h.cardUid),t.style.position="fixed",t.style.left=`${h.x+12}px`,t.style.top=`${h.y+12}px`,t.style.pointerEvents="none",t.style.zIndex="9999",e.appendChild(t)}function An(e,n,t){if(e.appendChild(D(n.choice.title)),n.choice.prompt){const r=document.createElement("pre");r.className="rulebook",r.textContent=n.choice.prompt,e.appendChild(r)}const a=k("controls");for(const r of n.choice.options){const o=document.createElement("button");o.className="primary",o.textContent=r.detail?`${r.label} â€” ${r.detail}`:r.label,o.onclick=()=>t.onChooseChoice(r.key),a.appendChild(o)}e.appendChild(a)}function we(e,n){return e==="BATTLE"?n?"ë³´ìŠ¤":"ì „íˆ¬":e==="REST"?"íœ´ì‹":e==="EVENT"?"ì´ë²¤íŠ¸":"ì €ì£¼ë°›ì€ ë³´ë¬¼"}function Ee(e,n){return n?"ë³´ìŠ¤":e.map(t=>we(t.type,!1)).join(" / ")}function wn(e,n,t){const a=[`[ì„ íƒ ${n.run.nodePickCount}íšŒ]`];n.run.treasureObtained&&a.push(`[ë³´ë¬¼ í›„ ${n.run.afterTreasureNodePicks}/10]`),e.appendChild(v(a.join(" ")));const o=(n.run.nodePickCount+1)%30===0,l=(n.run.nodePickCount+2)%30===0,f=t.getNodeOffers(),c=n.run.branchOffer;c&&(e.appendChild(v(`ì „ì ì„ íƒ ì‹œ ë‹¤ìŒ ì„ íƒì§€: ${Ee(c.nextIfA,l)}`)),e.appendChild(v(`í›„ì ì„ íƒ ì‹œ ë‹¤ìŒ ì„ íƒì§€: ${Ee(c.nextIfB,l)}`)),e.appendChild(X()));const p=k("controls");for(const i of f){const d=document.createElement("button");d.className="primary",d.textContent=we(i.type,o),d.onclick=()=>t.onChooseNode(i.id),p.appendChild(d)}e.appendChild(p)}function R(e){return e.pendingTarget!=null||(e.pendingTargetQueue?.length??0)>0}function Bn(e){const n=k("stats");return n.appendChild(P(`HP â¤ï¸ ${e.player.hp}/${e.player.maxHp}`)),n.appendChild(P(`ë¸”ë¡ ğŸ›¡ï¸ ${e.player.block}`)),n.appendChild(P(`S ${e.player.supplies}`)),n.appendChild(P(`F ${e.player.fatigue}`)),n.appendChild(P(`${e.run.nodePickCount}ë²ˆ íƒí—˜`)),n.appendChild(P(`ë± ${e.deck.length}ì¥`)),n}function On(e){const n=k("badgesRow");for(const[t,a]of Object.entries(e))a&&n.appendChild(P(`${t} ${a}`));return n}function Be(e,n,t,a){const r=I(e,n),o=k("card");e.selectedHandCardUid===n&&o.classList.add("selected"),r.tags?.includes("EXHAUST")&&o.classList.add("exhaust"),r.tags?.includes("VANISH")&&o.classList.add("vanish"),o.appendChild($e("cardTitle",S(e,n)));const l=k("cardMeta");r.tags?.includes("EXHAUST")&&l.appendChild(P("ì†Œëª¨")),r.tags?.includes("VANISH")&&l.appendChild(P("ì†Œì‹¤")),o.appendChild(l);const f=$e("cardText",`ì „ì—´: ${r.frontText}
í›„ì—´: ${r.backText}`);return f.style.whiteSpace="pre-line",o.appendChild(f),t&&a&&(o.onclick=()=>a(n),o.onpointerdown=c=>{c.button!==0&&c.pointerType==="mouse"||R(e)||e.phase==="PLACE"&&Ne(c,{kind:"hand",cardUid:n})}),o}function k(e){const n=document.createElement("div");return n.className=e,n}function $e(e,n){const t=document.createElement("div");return t.className=e,t.textContent=n,t}function le(e){const n=document.createElement("h2");return n.textContent=e,n}function D(e){const n=document.createElement("h3");return n.textContent=e,n}function v(e){const n=document.createElement("p");return n.textContent=e,n}function Oe(e){const n=document.createElement("small");return n.textContent=e,n}function X(){return document.createElement("hr")}function P(e){const n=document.createElement("span");return n.className="badge",n.textContent=e,n}function E(e,n,t){const a=document.createElement("button");return a.textContent=e,a.disabled=t,a.onclick=n,a}function _n(e){const n=document.createElement("pre");return n.className="log",n.textContent=e,n}function Rn(e,n,t,a){const r=a.kind==="RULEBOOK"?"ë£°ë¶":a.pile==="deck"?"ë±":a.pile==="discard"?"ë²„ë¦¼ ë”ë¯¸":a.pile==="exhausted"?"ì†Œëª¨(ì´ë²ˆ ì „íˆ¬)":a.pile==="vanished"?"ì†Œì‹¤(ì˜êµ¬)":"ì†íŒ¨";if(e.appendChild(D(r)),a.kind==="RULEBOOK"){const l=document.createElement("pre");l.className="rulebook",l.textContent=En,e.appendChild(l)}else{const f=[...a.pile==="deck"?n.deck:a.pile==="discard"?n.discard:a.pile==="exhausted"?n.exhausted:a.pile==="vanished"?n.vanished:n.hand].sort((p,i)=>{const d=I(n,p),C=I(n,i),b=d.name.localeCompare(C.name,"ko");if(b!==0)return b;const $=n.cards[p].upgrade??0,T=n.cards[i].upgrade??0;return $!==T?T-$:p.localeCompare(i)}),c=k("controls");for(const p of f){const i=I(n,p),d=document.createElement("button");d.className="primary",d.textContent=`${S(n,p)} â€” ì „ì—´: ${i.frontText} / í›„ì—´: ${i.backText}`,d.onclick=()=>{},c.appendChild(d)}e.appendChild(c)}const o=k("controls");o.appendChild(E("ë‹«ê¸°",t.onCloseOverlay,!1)),e.appendChild(o)}const vn=ge();let K=Pe(vn);function _e(e){K=e,de=Ie(K,_e),u(K,de)}let de=Ie(K,_e);u(K,de);
