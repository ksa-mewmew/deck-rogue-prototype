(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();function po(){const e=document.documentElement,t=180,n=5,r=7,o=3;let a=0;const s=()=>{a=0;const l=getComputedStyle(e),c=window.innerWidth,m=window.innerHeight,u=parseFloat(l.getPropertyValue("--hudH"))||140,d=parseFloat(l.getPropertyValue("--dockH"))||210,b=parseFloat(l.getPropertyValue("--uiGap"))||16,E=parseFloat(l.getPropertyValue("--edgePad"))||14,p=parseFloat(l.getPropertyValue("--logW"))||360,f=parseFloat(l.getPropertyValue("--logGap"))||14,h=parseFloat(l.getPropertyValue("--playerW"))||320,x=parseFloat(l.getPropertyValue("--slotGapXBase"))||22,k=parseFloat(l.getPropertyValue("--slotGapYBase"))||6,N=Math.max(320,c-(h+p+f*2+E*2)),I=Math.max(260,m-(u+d+b)),C=o*t+(o-1)*x,K=t*(r/n),L=parseFloat(l.getPropertyValue("--battleChromeHBase"))||140,$=K*2+k+L,g=N/C,M=I/$,U=Math.min(g,M),V=Math.max(.55,Math.min(U,1.25));e.style.setProperty("--uiScale",String(V))},i=()=>{a||(a=requestAnimationFrame(s))};window.addEventListener("resize",i,{passive:!0}),s()}function fo(){let e=!1;const t=()=>{const o=window.innerWidth;!e&&o<1180&&(e=!0),e&&o>1220&&(e=!1),document.body.classList.toggle("compact",e)};let n=0;const r=()=>{n||(n=requestAnimationFrame(()=>{n=0,t()}))};window.addEventListener("resize",r,{passive:!0}),t()}function me(e,t,n,r=1600){const o=e;o.uiToasts||(o.uiToasts=[]);const a=o.uiToasts;a.push({kind:t,text:n,ms:r}),a.length>30&&(o.uiToasts=a.slice(-30))}function yt(e,t,n,r,o="SYSTEM"){let a=n;if(r&&o==="PLAYER"&&t==="bleed"){const s=Number(r._bleedBonusPerApply??0);s&&(a+=s)}if(r&&t==="vuln"&&a>0&&e===r.player){const s=r.run;(s?.relics??[]).includes("relic_ratskin_charm")&&s?.relicRuntime?.relic_ratskin_charm?.active!==!1&&(a=Math.max(0,a-1))}e.status[t]=Math.max(0,(e.status[t]??0)+a)}function wn(e,t=0){return e<t?t:e}function _n(e){const t=[...e];for(let n=t.length-1;n>0;n--){const r=Math.floor(Math.random()*(n+1));[t[n],t[r]]=[t[r],t[n]]}return t}function ce(e,t="pickOne"){if(e.length===0)throw new Error(`${t}: empty array`);return e[Math.floor(Math.random()*e.length)]}function y(e,t){e.log.unshift(t),e.log=e.log.slice(0,250)}function re(e){return e.enemies.filter(t=>t.hp>0)}function mo(e){return Math.max(0,Math.min(1,e))}function br(e,t=0){const n=e.player?.fatigue??0,r=mo(t+Math.max(0,n-5)*.12),o=n<=5?0:n<=8?1:n<=11?2:3;return{f:n,p:r,tier:o}}function Vn(e,t){e.includes(t)||e.push(t)}function Zt(e,t,n){e[t]??=[],e[n]??=[],Vn(e[t],n),Vn(e[n],t)}function ho(e,t,n){return(e[t]??[]).includes(n)}function Jt(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}function qn(e){return e[Math.floor(Math.random()*e.length)]}function yo(e){const t=Math.floor((e+1)/2),r=Math.round((Math.max(4,e)-1)/3.2)+1,o=12,a=Math.min(t,32),s=Math.max(o,Math.min(a,r));return Math.max(3,Math.min(t,s))}function bo(e){let n=yo(e);for(;n>2&&1+2*(n-1)>e;)n-=1;const r=Math.floor((e+1)/2);for(;n<r&&1+4*(n-1)<e;)n+=1;const o=4,a=new Array(n).fill(2);a[0]=1;let s=e-(1+2*(n-1));for(;s>0;){const i=1+Math.floor(Math.random()*(n-1));a[i]>=o||(a[i]+=1,s-=1)}for(let i=0;i<24;i++){const l=1+Math.floor(Math.random()*(n-1)),c=1+Math.floor(Math.random()*(n-1));l!==c&&(a[l]<=2||a[c]>=o||Math.random()<.5&&(a[l]-=1,a[c]+=1))}return a}function ko(e){const n=Math.max(18,Math.floor(8.64)),r=Math.max(2,Math.floor(72/15)),o={},a={},s=bo(72),i=[];let l=0;for(let T=0;T<s.length;T++){const _=s[T],w=[];for(let S=0;S<_;S++){const B=`n${l++}`;w.push(B)}i.push(w)}for(;l<72;)i[i.length-1].length>=4&&i.push([]),i[i.length-1].push(`n${l++}`);for(let T=0;T<i.length;T++){const _=i[T];for(let w=0;w<_.length;w++){const S=_[w];o[S]={id:S,kind:T===0&&w===0?"START":"BATTLE",depth:T,order:w,visited:T===0&&w===0,cleared:T===0&&w===0,reprocCount:0,lastProcTime:-999},a[S]=[]}}const c=i.slice(0,-1).map(()=>[]),m=(T,_)=>{if(ho(a,T,_))return!1;const w=o[T]?.depth??0,S=o[_]?.depth??0;if(Math.abs(w-S)!==1)return!1;const B=Math.min(w,S),P=w<S?T:_,O=w<S?_:T,D=o[P]?.order??0,F=o[O]?.order??0;for(const[X,H]of c[B])if(D<X&&F>H||D>X&&F<H)return!1;return Zt(a,P,O),c[B].push([D,F]),!0};for(let T=0;T<i.length-1;T++){const _=i[T],w=i[T+1];for(let B=0;B<w.length;B++){const P=Math.floor(B*_.length/w.length),O=(Math.random()<.5?-1:1)*(Math.random()<.35?1:0),D=Math.max(0,Math.min(_.length-1,P+O));m(_[D],w[B])}const S=.35;for(let B=0;B<_.length;B++){if(Math.random()>S)continue;const P=Math.floor(B*w.length/_.length),O=(Math.random()<.5?-1:1)*(Math.random()<.35?1:0),D=Math.max(0,Math.min(w.length-1,P+O));m(_[B],w[D])}}i.length>=2&&i[1].length>=2&&m(i[0][0],i[1][i[1].length-1]);const u=Math.max(0,Math.min(n,144));let d=0,b=0;for(;d<u&&b++<8e3;){const T=Math.floor(Math.random()*(i.length-1)),_=i[T],w=i[T+1],S=_[Math.floor(Math.random()*_.length)],B=w[Math.floor(Math.random()*w.length)];m(S,B)&&(d+=1)}const E=.25;for(let T=0;T<i.length;T++){const _=i[T];if(_.length<2)continue;const w=Math.floor(Math.random()*(_.length-1));Zt(a,_[w],_[w+1]);for(let S=0;S<_.length-1;S++)S!==w&&Math.random()<E&&Zt(a,_[S],_[S+1])}const p={nodes:o,edges:a,startId:i[0][0],pos:i[0][0],treasureId:null,visionNonce:0},f=[],h=Math.max(2,Math.floor(i.length*.85)),x=Math.max(h,Math.floor(i.length*1)-1);for(let T=h;T<=x&&T<i.length;T++)for(const _ of i[T])f.push(_);const k=f.length?qn(f):"n71";p.treasureId=k,o[k].kind="TREASURE";const N=Object.keys(o).filter(T=>T!==p.startId&&T!==k);Jt(N);const I=5,C=new Set;i.length>1&&C.add(1);const K=[];for(let T=2;T<i.length;T++)K.push(T);Jt(K);for(const T of K){if(C.size>=Math.min(I,Math.max(0,i.length-1)))break;C.add(T)}const L=N.filter(T=>(o[T]?.depth??0)>=2).filter(T=>!C.has(o[T]?.depth??0));Jt(L);const $=new Set(L.slice(0,Math.min(r,L.length))),g=4,M={battleMul:.25,eventMul:1.35,restMul:1.55},U=T=>a[T]?.length??0,V=new Set(Object.keys(o).filter(T=>T===p.startId||(o[T]?.depth??0)<g?!1:U(T)===1)),R=(T,_)=>{let w=.5,S=.25,B=.2,P=.05;T<=1?(w=.8,S=.14,B=.04,P=.02):T<=3?(w=.7,S=.16,B=.08,P=.06):(w=.6,S=.2,B=.12,P=.08),_&&(w*=M.battleMul??.25,S*=M.eventMul??1.35,B*=M.restMul??1.8,P*=.8);const O=w+S+B+P,D=Math.random()*O;return D<w?"BATTLE":D<w+S?"EVENT":D<w+S+B?"REST":"SHOP"};for(const T of N){const _=o[T]?.depth??0;if(C.has(_)){o[T].kind="BATTLE";continue}if($.has(T)){o[T].kind="ELITE";continue}o[T].kind=R(_,V.has(T))}if(!Object.values(o).some(_=>_.kind==="SHOP")){const _=Object.keys(o).filter(w=>w!==p.startId&&w!==k).filter(w=>(o[w]?.depth??0)>=2).filter(w=>o[w].kind!=="ELITE"&&o[w].kind!=="TREASURE").filter(w=>!C.has(o[w]?.depth??0));if(_.length){const w=qn(_);o[w].kind="SHOP"}}return p}function To(e){return e.uidSeq+=1,String(e.uidSeq)}function vo(){return{relicRuntime:{},pendingRelicActivations:[],unlock:{rest:0,eliteWins:0,tookBigHit10:0,kills:0,endedTurnWeak:0,eventPicks:0,hpLeq15:0,skippedTurn:0,bleedApplied:0,endedTurnSupplyZero:0},timeMove:0,map:ko(),pursuit:{heat:0},vision:{mode:"NORMAL",blind:!1,presenceR:2,typeR:2,detailR:0,noise:0},encounterCount:0,treasureObtained:!1,afterTreasureNodePicks:0,nodeOfferQueue:[],finished:!1,nodePickCount:0,nodePickByType:{BATTLE:0,ELITE:0,REST:0,EVENT:0,TREASURE:0,SHOP:0},currentNodeOffers:null,nextBattleSuppliesBonus:0,bossPool:["boss_gravity_master","boss_cursed_wall","boss_giant_orc","boss_soul_stealer"],branchOffer:null,battleCount:0,enemyLastSeenBattle:{},nextBossId:null,nextBossTime:40,forcedNext:null,bossOmenText:null,deckSizeAtTreasure:null,ominousProphecySeen:!1,relics:[],items:[],itemCap:2,lastBattleWasElite:!1,lastBattleWasBoss:!1,eliteRelicOfferedThisBattle:!1,itemOfferedThisBattle:!1,pendingElite:!1,rewardPityNonElite:0,gold:0,shops:{}}}function fn(e){const t={uidSeq:0,combatTurn:0,intentsRevealedThisTurn:!1,disruptIndexThisTurn:null,attackedEnemyIndicesThisTurn:[],phase:"NODE",log:[],run:vo(),player:{hp:60,maxHp:60,block:0,supplies:7,fatigue:0,zeroSupplyTurns:0,status:{vuln:0,weak:0,bleed:0,disrupt:0},immuneToDisruptThisTurn:!1,nullifyDamageThisTurn:!1},content:e,cards:{},deck:[],hand:[],discard:[],exhausted:[],vanished:[],frontSlots:[null,null,null],backSlots:[null,null,null],backSlotDisabled:[!1,!1,!1],enemies:[],usedThisTurn:0,frontPlacedThisTurn:0,selectedHandCardUid:null,winHooksAppliedThisCombat:!1,drawCountThisTurn:0,pendingTarget:null,pendingTargetQueue:[],backUidsThisTurn:[],placedUidsThisTurn:[],victoryResolvedThisCombat:!1,time:0,choice:null,choiceQueue:[],choiceStack:[],choiceCtx:null,selectedEnemyIndex:null,_justStartedCombat:!1};return xo(t),y(t,"ìƒˆ ëŸ° ì‹œìž‘."),t}function qe(e,t,n){for(let r=0;r<n;r++){const o=To(e),a={uid:o,defId:t,zone:"deck",upgrade:0};e.cards[o]=a,e.deck.push(o)}}function xo(e){qe(e,"field_ration",2),qe(e,"maintenance",2),qe(e,"scout",2),qe(e,"shield",2),qe(e,"power_arrow",1),qe(e,"arrow",3),e.deck=_n(e.deck)}function Ae(e,t){const n=e.cards[t],r=e.content.cardsById[n.defId],o=n.upgrade??0,a=r.upgrades?.[o-1];return a?{...r,...a}:r}function pe(e,t,n){const r=e.cardsById[t],o=Math.max(0,n|0);if(o<=0)return r;const a=r.upgrades?.[o-1];return a?{...r,...a}:r}function Ze(e,t){const r=e.cards[t].upgrade??0,o=Ae(e,t);return r>0?`${o.name} +${r}`:o.name}const Co=[{id:"field_ration",name:"ì•¼ì „ ì‹ëŸ‰",rarity:"BASIC",frontText:"ë°©ì–´ +3",backText:"S +2",front:[{op:"block",n:3}],back:[{op:"supplies",n:2}],upgrades:[{frontText:"ë°©ì–´ +5",front:[{op:"block",n:5}],backText:"S +3",back:[{op:"supplies",n:3}]}]},{id:"maintenance",name:"ì •ë¹„ ë„êµ¬",rarity:"BASIC",exhaustWhen:"BACK",frontText:"ë°©ì–´ +3",backText:"F -1, ì†Œëª¨",front:[{op:"block",n:3}],back:[{op:"fatigue",n:-1}],upgrades:[{frontText:"ë°©ì–´ +5",front:[{op:"block",n:5}],backText:"F -1, S +2, ì†Œëª¨",back:[{op:"fatigue",n:-1},{op:"supplies",n:2}]}]},{id:"scout",name:"ì •ì°°",rarity:"BASIC",frontText:"ì§€ì • í”¼í•´ 3, ë°©ì–´ +1",backText:"ë“œë¡œìš° 1, S +2",front:[{op:"damageEnemy",target:"select",n:3},{op:"block",n:1}],back:[{op:"draw",n:1},{op:"supplies",n:2}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 4, ë°©ì–´ +2",front:[{op:"damageEnemy",target:"select",n:4},{op:"block",n:2}],backText:"ë“œë¡œìš° 2, S +3",back:[{op:"draw",n:2},{op:"supplies",n:3}]}]},{id:"shield",name:"ë°©íŒ¨",rarity:"BASIC",frontText:"ë°©ì–´ +5",backText:"ë°©ì–´ +3",front:[{op:"block",n:5}],back:[{op:"block",n:3}],upgrades:[{frontText:"ë°©ì–´ +7",front:[{op:"block",n:7}],backText:"ë°©ì–´ +4",back:[{op:"block",n:4}]}]},{id:"power_arrow",name:"ê°•ë ¥í•œ í™”ì‚´",rarity:"BASIC",frontText:"ë¬´ìž‘ìœ„ í”¼í•´ 10, S -2",backText:"ë¬´ìž‘ìœ„ í”¼í•´ 7, S -2",front:[{op:"supplies",n:-2},{op:"damageEnemy",target:"random",n:10}],back:[{op:"supplies",n:-2},{op:"damageEnemy",target:"random",n:7}],upgrades:[{frontText:"ë¬´ìž‘ìœ„ í”¼í•´ 13, S -2",front:[{op:"supplies",n:-2},{op:"damageEnemy",target:"random",n:13}],backText:"ë¬´ìž‘ìœ„ í”¼í•´ 10, S -2",back:[{op:"supplies",n:-2},{op:"damageEnemy",target:"random",n:10}]}]},{id:"arrow",name:"í™”ì‚´",rarity:"BASIC",frontText:"ì§€ì • í”¼í•´ 5",backText:"ì§€ì • í”¼í•´ 5, S -1",front:[{op:"damageEnemy",target:"select",n:5}],back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:5}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 7",front:[{op:"damageEnemy",target:"select",n:7}],backText:"ì§€ì • í”¼í•´ 7, S -1",back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:7}]}]},{id:"goal_treasure",name:"ì €ì£¼ë°›ì€ ë³´ë¬¼",rarity:"BASIC",exhaustWhen:"BOTH",frontText:"F +1, ì†Œëª¨",backText:"S -1, F +1, ì†Œëª¨",front:[{op:"fatigue",n:1}],back:[{op:"supplies",n:-1},{op:"fatigue",n:1}]},{id:"berserk",name:"ê´‘í­í™”",rarity:"COMMON",frontText:"ë¬´ìž‘ìœ„ í”¼í•´ 15, S -3",backText:"S +4, F +1",front:[{op:"damageEnemy",target:"random",n:15},{op:"supplies",n:-3}],back:[{op:"supplies",n:4},{op:"fatigue",n:1}],upgrades:[{frontText:"ë¬´ìž‘ìœ„ í”¼í•´ 20, S -4",front:[{op:"damageEnemy",target:"random",n:20},{op:"supplies",n:-4}],backText:"S +6, F +2",back:[{op:"supplies",n:6},{op:"fatigue",n:2}]}]},{id:"bandage",name:"ë¶•ëŒ€",rarity:"SPECIAL",exhaustWhen:"BOTH",frontText:"HP +4, ì†Œëª¨",backText:"HP +4, S -1, ì†Œëª¨",front:[{op:"heal",n:4}],back:[{op:"supplies",n:-1},{op:"heal",n:4}],upgrades:[{frontText:"HP +4, ì¶œí˜ˆ ì œê±°, ì†Œëª¨",front:[{op:"heal",n:4},{op:"clearStatusSelf",key:"bleed"}],backText:"HP +4, ì¶œí˜ˆ ì œê±°, S -1, ì†Œëª¨",back:[{op:"supplies",n:-1},{op:"heal",n:4},{op:"clearStatusSelf",key:"bleed"}]}]},{id:"arrow_rain",name:"í™”ì‚´ì˜ ë¹„",rarity:"COMMON",exhaustWhen:"BOTH",frontText:"ì „ì²´ í”¼í•´ 10, S -2 ì†Œëª¨",backText:"ë“œë¡œìš° 2, S +2, F +1, ì†Œëª¨",front:[{op:"damageEnemy",target:"all",n:10},{op:"supplies",n:-2}],back:[{op:"draw",n:2},{op:"supplies",n:2},{op:"fatigue",n:1}],upgrades:[{frontText:"ì „ì²´ í”¼í•´ 13, S -2, ì†Œëª¨",front:[{op:"damageEnemy",target:"all",n:13},{op:"supplies",n:-2}],backText:"ë“œë¡œìš° 3, S +3, F +2, ì†Œëª¨",back:[{op:"draw",n:3},{op:"supplies",n:3},{op:"fatigue",n:2}]}]},{id:"smoke",name:"ì—°ë§‰",rarity:"SPECIAL",vanishWhen:"FRONT",frontText:"ì´ë²ˆ í„´ ì  ê³µê²© í”¼í•´ ë¬´íš¨, ì†Œì‹¤",backText:"F +1",front:[{op:"nullifyDamageThisTurn"}],back:[{op:"fatigue",n:1}]},{id:"redeploy",name:"ìž¬ë°°ì¹˜",rarity:"SPECIAL",frontText:"S +2",backText:"3ë²ˆ ìŠ¬ë¡¯ì— ìžˆëŠ” í›„ì—´ ì¹´ë“œì˜ ì „ì—´ íš¨ê³¼ ë°œë™",front:[{op:"supplies",n:2}],back:[{op:"triggerFrontOfBackSlot",index:2}],upgrades:[{frontText:"S +3",front:[{op:"supplies",n:3}],backText:"3ë²ˆ ìŠ¬ë¡¯ì— ìžˆëŠ” í›„ì—´ ì¹´ë“œì˜ ì „ì—´ íš¨ê³¼ ë°œë™, S +1",back:[{op:"triggerFrontOfBackSlot",index:2},{op:"supplies",n:1}]}]},{id:"secret_strike",name:"ë¹„ìž¥ì˜ ì¼ê²©",rarity:"RARE",exhaustWhen:"BOTH",frontText:"ë¬´ìž‘ìœ„ í”¼í•´ (Fì˜ 2ë°°), ì†Œëª¨",backText:"ì „ì²´ ì·¨ì•½ +3 ë° ì•½í™” +3, ì†Œëª¨",front:[{op:"damageEnemyByPlayerFatigue",target:"random",mult:2}],back:[{op:"statusEnemy",target:"all",key:"vuln",n:3},{op:"statusEnemy",target:"all",key:"weak",n:3}],upgrades:[{exhaustWhen:"FRONT",frontText:"ì§€ì • í”¼í•´ (Fì˜ 2ë°°), ì†Œëª¨",front:[{op:"damageEnemyByPlayerFatigue",target:"select",mult:2}],backText:"ì „ì²´ ì·¨ì•½ +4 ë° ì•½í™” +4",back:[{op:"statusEnemy",target:"all",key:"vuln",n:4},{op:"statusEnemy",target:"all",key:"weak",n:4}]}]},{id:"fire_scroll",name:"í™”ì—¼ ë‘ë£¨ë§ˆë¦¬",rarity:"RARE",exhaustWhen:"FRONT",vanishWhen:"BACK",frontText:"ì „ì²´ í”¼í•´ 6, ì†Œëª¨",backText:"ì „ì²´ í”¼í•´ 12, ì†Œì‹¤",front:[{op:"damageEnemy",target:"all",n:6}],back:[{op:"damageEnemy",target:"all",n:12}],upgrades:[{frontText:"ì „ì²´ í”¼í•´ 8, ì†Œëª¨",front:[{op:"damageEnemy",target:"all",n:8}],backText:"ì „ì²´ í”¼í•´ 15, ì†Œì‹¤",back:[{op:"damageEnemy",target:"all",n:15}]}]},{id:"caltrops",name:"ë§ˆë¦„ì‡ ",rarity:"SPECIAL",frontText:"ì „ì²´ ì¶œí˜ˆ 4 ë¶€ì—¬",backText:"ì´ë²ˆ í„´ì— ìžì‹ ì„ ê³µê²©í•˜ë ¤ëŠ” ì ì—ê²Œ ì¶œí˜ˆ 3 ë¶€ì—¬",front:[{op:"statusEnemy",target:"all",key:"bleed",n:4}],back:[{op:"statusEnemiesAttackingThisTurn",key:"bleed",n:3}],upgrades:[{frontText:"ì „ì²´ ì¶œí˜ˆ 5 ë¶€ì—¬",backText:"ì´ë²ˆ í„´ì— ìžì‹ ì„ ê³µê²©í•˜ë ¤ëŠ” ì ì—ê²Œ ì¶œí˜ˆ 4 ë¶€ì—¬",front:[{op:"statusEnemy",target:"all",key:"bleed",n:5}],back:[{op:"statusEnemiesAttackingThisTurn",key:"bleed",n:4}]}]},{id:"emergency_rations",name:"ë¹„ìƒì‹ëŸ‰",rarity:"RARE",vanishWhen:"BACK",frontText:"S +2",backText:"Së¥¼ 7ë¡œ ë§Œë“¦. ì†Œì‹¤",front:[{op:"supplies",n:2}],back:[{op:"setSupplies",n:7}],upgrades:[{frontText:"S +3",backText:"Së¥¼ 10ìœ¼ë¡œ ë§Œë“¦. ì†Œì‹¤",front:[{op:"supplies",n:3}],back:[{op:"setSupplies",n:10}]}]},{id:"painkiller",name:"ì§„í†µì œ",rarity:"SPECIAL",exhaustWhen:"FRONT",vanishWhen:"BACK",frontText:"HP -8, F -3, ì†Œëª¨",backText:"HP +8, F +1, ì†Œì‹¤",front:[{op:"hp",n:-8},{op:"fatigue",n:-3}],back:[{op:"hp",n:8},{op:"fatigue",n:1}],upgrades:[{frontText:"HP -6, F -3, ì†Œëª¨",backText:"HP +10, F +1, ì†Œì‹¤",front:[{op:"hp",n:-6},{op:"fatigue",n:-3}],back:[{op:"hp",n:10},{op:"fatigue",n:1}]}]},{id:"field_experience",name:"ì‹¤ì „ ê²½í—˜",rarity:"RARE",exhaustWhen:"BACK",frontText:"ì „ì²´ í”¼í•´ 3",backText:"ì´ ì¹´ë“œê°€ í›„ì—´ì— ìžˆëŠ” í„´ì— ìŠ¹ë¦¬í•˜ë©´ ìµœëŒ€ ì²´ë ¥ +2, ì†Œëª¨",front:[{op:"damageEnemy",target:"all",n:3}],back:[],onWinWhileInBack:[{op:"maxHp",n:2}],upgrades:[{frontText:"ì „ì²´ í”¼í•´ 4",backText:"ì´ ì¹´ë“œê°€ í›„ì—´ì— ìžˆëŠ” í„´ì— ìŠ¹ë¦¬í•˜ë©´ ìµœëŒ€ ì²´ë ¥ +3, ì†Œëª¨",front:[{op:"damageEnemy",target:"all",n:4}],back:[],onWinWhileInBack:[{op:"maxHp",n:3}]}]},{id:"camp_prep",name:"ì•¼ì˜ ì¤€ë¹„",rarity:"COMMON",frontText:"ë°©ì–´ +4, S +1",backText:"S +3",front:[{op:"block",n:4},{op:"supplies",n:1}],back:[{op:"supplies",n:3}],upgrades:[{frontText:"ë°©ì–´ +5, S +2",backText:"S +5",front:[{op:"block",n:5},{op:"supplies",n:2}],back:[{op:"supplies",n:5}]}]},{id:"vital_shot",name:"ê¸‰ì†Œ ì‚¬ê²©",rarity:"SPECIAL",frontText:"ì§€ì • í”¼í•´ 8",backText:"ì§€ì • í”¼í•´ 5, ì¶œí˜ˆ 2 ë¶€ì—¬, S -1",front:[{op:"damageEnemy",target:"select",n:8}],back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:5},{op:"statusEnemy",target:"select",key:"bleed",n:2}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 11",backText:"ì§€ì • í”¼í•´ 6, ì¶œí˜ˆ 3 ë¶€ì—¬, S -1",front:[{op:"damageEnemy",target:"select",n:11}],back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:6},{op:"statusEnemy",target:"select",key:"bleed",n:3}]}]},{id:"taunt",name:"ë…ì„¤",rarity:"SPECIAL",frontText:"ì§€ì • ì•½í™” +4",backText:"ì „ì²´ ì·¨ì•½ +2 ë° ì•½í™” +2",front:[{op:"statusEnemy",target:"select",key:"weak",n:4}],back:[{op:"statusEnemy",target:"all",key:"vuln",n:2},{op:"statusEnemy",target:"all",key:"weak",n:2}],upgrades:[{frontText:"ì§€ì • ì•½í™” +5",backText:"ì „ì²´ ì·¨ì•½ +2 ë° ì•½í™” +3",front:[{op:"statusEnemy",target:"select",key:"weak",n:5}],back:[{op:"statusEnemy",target:"all",key:"vuln",n:2},{op:"statusEnemy",target:"all",key:"weak",n:3}]}]},{id:"rapid_fire",name:"ì—°ì† ì‚¬ê²©",rarity:"COMMON",frontText:"ì§€ì • í”¼í•´ 2, 3ë²ˆ ë°œë™",backText:"ì´ë²ˆ í„´ì— ì¹´ë“œë¥¼ ë½‘ì•˜ìœ¼ë©´ ë¬´ìž‘ìœ„ í”¼í•´ 8",front:[{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2}],back:[{op:"ifDrewThisTurn",then:[{op:"damageEnemy",target:"random",n:8}]}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 2, 4ë²ˆ ë°œë™",backText:"ì´ë²ˆ í„´ì— ì¹´ë“œë¥¼ ë½‘ì•˜ìœ¼ë©´ ë¬´ìž‘ìœ„ í”¼í•´ 10",front:[{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2}],back:[{op:"ifDrewThisTurn",then:[{op:"damageEnemy",target:"random",n:10}]}]}]},{id:"blood_contract",name:"í”¼ì˜ ê³„ì•½",rarity:"COMMON",frontText:"ì§€ì • í”¼í•´ 13, HP -3",backText:"S +4, F +1",front:[{op:"damageEnemy",target:"select",n:12},{op:"hp",n:-3}],back:[{op:"supplies",n:3},{op:"fatigue",n:1}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 16, HP -3",backText:"S +5, F +1",front:[{op:"damageEnemy",target:"select",n:15},{op:"hp",n:-3}],back:[{op:"supplies",n:4},{op:"fatigue",n:1}]}]},{id:"cloth_scrap_armor",name:"ì²œ ì¡°ê° ê°‘ì˜·",rarity:"SPECIAL",frontText:"ë°©ì–´ +8, S -1",backText:"ë°©ì–´ +4",front:[{op:"supplies",n:-1},{op:"block",n:8}],back:[{op:"block",n:4}],upgrades:[{frontText:"ë°©ì–´ +10, S -1",backText:"ë°©ì–´ +5",front:[{op:"supplies",n:-1},{op:"block",n:10}],back:[{op:"block",n:5}]}]},{id:"prey_mark",name:"ì‚¬ëƒ¥ê° í‘œì‹œ",rarity:"SPECIAL",frontText:"ì§€ì • í”¼í•´ 7, ëŒ€ìƒì˜ HPê°€ í”Œë ˆì´ì–´ë³´ë‹¤ ë†’ìœ¼ë©´ ëŒ€ì‹  í”¼í•´ 12",backText:"ì§€ì • ì·¨ì•½ +2",front:[{op:"damageEnemyFormula",target:"select",kind:"prey_mark"}],back:[{op:"statusEnemy",target:"select",key:"vuln",n:2}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 9, ëŒ€ìƒì˜ HPê°€ í”Œë ˆì´ì–´ë³´ë‹¤ ë†’ìœ¼ë©´ ëŒ€ì‹  í”¼í•´ 15",front:[{op:"damageEnemyFormula",target:"select",kind:"prey_mark_u1"}],backText:"ì§€ì • ì·¨ì•½ +3",back:[{op:"statusEnemy",target:"select",key:"vuln",n:3}]}]},{id:"brawl_cleaver",name:"ë‚œì „ ì •ë¦¬",rarity:"COMMON",frontText:"ì§€ì • í”¼í•´ 8, ë‚¨ì€ ì ì´ 3ëª…ì´ë©´ ëŒ€ì‹  í”¼í•´ 16",backText:"ë°©ì–´ +6",front:[{op:"damageEnemyFormula",target:"select",kind:"triple_bounty"}],back:[{op:"block",n:6}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 10, ë‚¨ì€ ì ì´ 3ëª…ì´ë©´ ëŒ€ì‹  20",front:[{op:"damageEnemyFormula",target:"select",kind:"triple_bounty_u1"}],backText:"ë°©ì–´ +7",back:[{op:"block",n:7}]}]},{id:"install_ballista",name:"ë°œë¦¬ìŠ¤íƒ€",rarity:"COMMON",tags:["INSTALL"],installWhen:"BOTH",frontText:"ì§€ì • í”¼í•´ 3 (ì„¤ì¹˜)",backText:"ë¬´ìž‘ìœ„ í”¼í•´ 2 (ì„¤ì¹˜)",front:[{op:"damageEnemy",target:"select",n:3}],back:[{op:"damageEnemy",target:"random",n:2}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 4 (ì„¤ì¹˜)",backText:"ë¬´ìž‘ìœ„ í”¼í•´ 3 (ì„¤ì¹˜)",front:[{op:"damageEnemy",target:"select",n:4}],back:[{op:"damageEnemy",target:"random",n:3}]}]},{id:"install_iron_bulwark",name:"ì² ê°‘ ë°©ë²½",rarity:"COMMON",tags:["INSTALL"],installWhen:"BOTH",frontText:"ë°©ì–´ +3 (ì„¤ì¹˜)",backText:"ë°©ì–´ +1 (ì„¤ì¹˜)",front:[{op:"block",n:3}],back:[{op:"block",n:1}],upgrades:[{frontText:"ë°©ì–´ +4 (ì„¤ì¹˜)",backText:"ë°©ì–´ +2 (ì„¤ì¹˜)",front:[{op:"block",n:4}],back:[{op:"block",n:2}]}]},{id:"install_cursed_banner",name:"ì €ì£¼ì˜ ê¹ƒë°œ",rarity:"SPECIAL",tags:["INSTALL"],installWhen:"BOTH",frontText:"ë¬´ìž‘ìœ„ ì ì—ê²Œ ì·¨ì•½ +1 (ì„¤ì¹˜)",backText:"ë°©ì–´ +1 (ì„¤ì¹˜)",front:[{op:"statusEnemy",target:"random",key:"vuln",n:1}],back:[{op:"block",n:1}],upgrades:[{frontText:"ë¬´ìž‘ìœ„ ì ì—ê²Œ ì·¨ì•½ +2 (ì„¤ì¹˜)",backText:"ë°©ì–´ +2 (ì„¤ì¹˜)",front:[{op:"statusEnemy",target:"random",key:"vuln",n:2}],back:[{op:"block",n:2}]}]},{id:"token_moon_scroll",name:"ë‹¬ë¹› ë‘ë£¨ë§ˆë¦¬",rarity:"COMMON",tags:["TOKEN","EXHAUST"],frontText:"ì§€ì • ì ì—ê²Œ ì·¨ì•½ +1, ì†Œëª¨",backText:"ë°©ì–´ +2, ì†Œëª¨",front:[{op:"statusEnemy",target:"select",key:"vuln",n:1}],back:[{op:"block",n:2}]},{id:"scribe_hand",name:"í•„ê²½ì‚¬ì˜ ì†",rarity:"SPECIAL",frontText:"ë°©ì–´ +5",backText:"ë‹¬ë¹› ë‘ë£¨ë§ˆë¦¬ 2ìž¥ ìƒì„±",front:[{op:"block",n:5}],back:[{op:"addCardToHand",defId:"token_moon_scroll",n:2}],upgrades:[{frontText:"ë°©ì–´ +7",backText:"ë‹¬ë¹› ë‘ë£¨ë§ˆë¦¬ 3ìž¥ ìƒì„±",front:[{op:"block",n:7}],back:[{op:"addCardToHand",defId:"token_moon_scroll",n:3}]}]},{id:"install_scriptorium",name:"í”¼ ë¬»ì€ í•„ì‚¬ëŒ€",rarity:"RARE",tags:["INSTALL"],installWhen:"BOTH",frontText:"ë°©ì–´ +1 (ì„¤ì¹˜)",backText:"S -1, ë‹¬ë¹› ë‘ë£¨ë§ˆë¦¬ 1ìž¥ ìƒì„± (ì„¤ì¹˜)",front:[{op:"block",n:1}],back:[{op:"supplies",n:-1},{op:"addCardToHand",defId:"token_moon_scroll",n:1}],upgrades:[{frontText:"ë°©ì–´ +2 (ì„¤ì¹˜)",backText:"S -1, ë‹¬ë¹› ë‘ë£¨ë§ˆë¦¬ 2ìž¥ ìƒì„± (ì„¤ì¹˜)",front:[{op:"block",n:2}],back:[{op:"supplies",n:-1},{op:"addCardToHand",defId:"token_moon_scroll",n:2}]}]},{id:"mad_echo",name:"ë©”ì•„ë¦¬",rarity:"MADNESS",frontText:"ë¬´ìž‘ìœ„ í”¼í•´ (Fì˜ ì ˆë°˜ (ë²„ë¦¼))",backText:"ë“œë¡œìš° 1, S +2, F +1",front:[{op:"damageEnemyByPlayerFatigue",target:"random",mult:.5}],back:[{op:"draw",n:1},{op:"supplies",n:2},{op:"fatigue",n:1}],upgrades:[{frontText:"ë¬´ìž‘ìœ„ í”¼í•´ (F)",front:[{op:"damageEnemyByPlayerFatigue",target:"random",mult:1}],backText:"ë“œë¡œìš° 2, S +2, F +1",back:[{op:"draw",n:2},{op:"supplies",n:2},{op:"fatigue",n:1}]}]},{id:"mad_insight",name:"ê¸ˆë‹¨ì˜ í†µì°°",rarity:"MADNESS",exhaustWhen:"BOTH",frontText:"ë°©ì–´ +8, ë“œë¡œìš° 1, F +1, ì†Œëª¨",backText:"ë“œë¡œìš° 3, S +2, F +2, ì†Œëª¨",front:[{op:"block",n:8},{op:"draw",n:1},{op:"fatigue",n:1}],back:[{op:"draw",n:3},{op:"supplies",n:2},{op:"fatigue",n:2}],upgrades:[{frontText:"ë°©ì–´ +10, ë“œë¡œìš° 2, F +1, ì†Œëª¨",front:[{op:"block",n:10},{op:"draw",n:2},{op:"fatigue",n:1}],backText:"ë“œë¡œìš° 4, S +3, F +2, ì†Œëª¨",back:[{op:"draw",n:4},{op:"supplies",n:3},{op:"fatigue",n:2}]}]},{id:"mad_bargain",name:"ê±°ëž˜ì˜ ìž”ìž¬",rarity:"MADNESS",exhaustWhen:"BOTH",frontText:"ì§€ì • 12 í”¼í•´, S -1, F +1, ì†Œëª¨",backText:"HP +5, F +2, ì†Œëª¨",front:[{op:"damageEnemy",target:"select",n:12},{op:"supplies",n:-1},{op:"fatigue",n:1}],back:[{op:"heal",n:5},{op:"fatigue",n:2}],upgrades:[{frontText:"ì§€ì • 20 í”¼í•´, S -1, F +2, ì†Œëª¨",front:[{op:"damageEnemy",target:"select",n:20},{op:"supplies",n:-1},{op:"fatigue",n:2}],backText:"HP +7, F +2, ì†Œëª¨",back:[{op:"heal",n:7},{op:"fatigue",n:2}]}]}],kr=Object.fromEntries(Co.map(e=>[e.id,e])),Eo=[{id:"other_adventurer",name:"ë³´ë¬¼ì„ ë…¸ë¦¬ëŠ” ë‹¤ë¥¸ ëª¨í—˜ê°€",maxHp:60,intents:[{label:"ì°½ ì°Œë¥´ê¸°: 5 í”¼í•´, 3ë²ˆ ë°œë™",acts:[{op:"damagePlayer",n:5},{op:"damagePlayer",n:5},{op:"damagePlayer",n:5}]},{label:"ë…ì•½ ë¿Œë¦¬ê¸°: ì¶œí˜ˆ +4, ì·¨ì•½ +4, ì•½í™” +4 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"bleed",n:4},{op:"statusPlayer",key:"vuln",n:4},{op:"statusPlayer",key:"weak",n:4}]}]},{id:"goblin_raider",name:"ê³ ë¸”ë¦° ì•½íƒˆìž",maxHp:15,intents:[{label:"ê¸°ìŠµ: 12 - ì´ë²ˆ í„´ì— ì‚¬ìš©í•œ ì¹´ë“œì˜ ìˆ˜ë§Œí¼ í”¼í•´",acts:[{op:"damagePlayerFormula",kind:"goblin_raider"}]},{label:"í›”ì¹˜ê¸°: ì¶œí˜ˆ +2 ë¶€ì—¬, S -3",acts:[{op:"supplies",n:-3},{op:"statusPlayer",key:"bleed",n:2}]}]},{id:"watching_statue",name:"ê°ì‹œí•˜ëŠ” ì„ìƒ",maxHp:25,intents:[{label:"ê°ì‹œ: 4 + ì´ë²ˆ í„´ì— ì‚¬ìš©í•œ ì¹´ë“œì˜ ìˆ˜ë§Œí¼ í”¼í•´",acts:[{op:"damagePlayerFormula",kind:"watching_statue"}]}]},{id:"pebble_golem",name:"ì¡°ì•½ëŒ ê³¨ë ˜",maxHp:30,intents:[{label:"ì¡°ì•½ëŒ ë˜ì§€ê¸°: 8 í”¼í•´",acts:[{op:"damagePlayer",n:8}]},{label:"ëª¨ëž˜ ëª¨ìœ¼ê¸°: ìžì‹  HP 6 íšŒë³µ",acts:[{op:"enemyHealSelf",n:6}]}]},{id:"rock_golem",name:"ë°”ìœ„ ê³¨ë ˜",maxHp:50,intents:[{label:"ë°”ìœ„ ë˜ì§€ê¸°: 10 í”¼í•´",acts:[{op:"damagePlayer",n:10}]},{label:"ë•… ëª¨ìœ¼ê¸°: ìžì‹  HP 8 íšŒë³µ",acts:[{op:"enemyHealSelf",n:8}]}]},{id:"slime",name:"ìŠ¬ë¼ìž„",maxHp:30,intents:[{label:"ì‚°ì„±ì•¡: ì¶œí˜ˆ +3 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"bleed",n:3}]},{label:"ì ì•¡: ì•½í™” +3 ë¶€ì—¬ í›„ ìžì‹  HP 3 íšŒë³µ",acts:[{op:"statusPlayer",key:"weak",n:3},{op:"enemyHealSelf",n:3}]},{label:"ë•Œë¦¬ê¸°: 6 í”¼í•´",acts:[{op:"damagePlayer",n:6}]}]},{id:"poison_spider",name:"ë…ê±°ë¯¸",maxHp:28,intents:[{label:"ë…ë‹ˆë¡œ ë¬¼ê¸°: ì¶œí˜ˆ +4 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"bleed",n:4}]},{label:"ì†¡ê³³ë‹ˆë¡œ ë¬¼ê¸°: 7 í”¼í•´",acts:[{op:"damagePlayer",n:7}]},{label:"ë‹¨ë²ˆì— ë¬¼ê¸°: ì¶œí˜ˆ +2 ë¶€ì—¬, 6 í”¼í•´",acts:[{op:"statusPlayer",key:"bleed",n:2},{op:"damagePlayer",n:6}]}]},{id:"gravity_echo",name:"ì¤‘ë ¥ì˜ ìž”í–¥",maxHp:35,intents:[{label:"í•˜ì¤‘ ì¸ìž¥",acts:[{op:"damagePlayerByDeckSize",base:5,per:2,div:6,cap:18}]},{label:"ì••ì¶•: 7 í”¼í•´",acts:[{op:"damagePlayer",n:7}]},{label:"ë†“ì¹˜ê²Œ ë§Œë“¤ê¸°: S -3",acts:[{op:"supplies",n:-3}]}]},{id:"rat_swarm",name:"ì¥ë–¼",maxHp:20,intents:[{label:"ëœ¯ê¸°: 4 í”¼í•´, 2ë²ˆ ë°œë™",acts:[{op:"damagePlayer",n:4},{op:"damagePlayer",n:4}]},{label:"ê¸°ìŠµí•˜ê¸°: ì·¨ì•½ +2 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"vuln",n:2}]},{label:"ê´‘ëž€: 2 í”¼í•´ (íƒ€ìˆ˜ê°€ ì¦ê°€í•©ë‹ˆë‹¤!) ",acts:[{op:"damagePlayerRampHits",n:2,baseHits:1,everyTurns:1,capHits:6}]}]},{id:"goblin_commander",name:"ê³ ë¸”ë¦° ì§€íœ˜ê´€",maxHp:30,intents:[{label:"í˜¸ë ¹: ì·¨ì•½ +2 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"vuln",n:2}]},{label:"ë°œë¡œ ì°¨ê¸°: 7 í”¼í•´",acts:[{op:"damagePlayer",n:7}]},{label:"ì „ìˆ  ì§€ì‹œ: ì•½í™” +2 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"weak",n:2}]}]},{id:"goblin_archer",name:"ê³ ë¸”ë¦° ê¶ìˆ˜",maxHp:15,intents:[{label:"ì¡°ì¤€: 2 í”¼í•´, 3ë²ˆ",acts:[{op:"damagePlayer",n:2},{op:"damagePlayer",n:2},{op:"damagePlayer",n:2}]},{label:"ì—°ì‚¬: 1 í”¼í•´ (íƒ€ìˆ˜ê°€ ì¦ê°€í•©ë‹ˆë‹¤!)",acts:[{op:"damagePlayerRampHits",n:1,baseHits:1,everyTurns:1,capHits:10}]}]},{id:"gloved_hunter",name:"ìž¥ê°‘ ë‚€ ì‚¬ëƒ¥ê¾¼",maxHp:52,intents:[{label:"ê°€ëŠ : ì·¨ì•½ +3 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"vuln",n:3}]},{label:"ì‚¬ëƒ¥: 6 í”¼í•´, ë°©ì–´ê°€ 4 ì´ìƒì´ë©´ ëŒ€ì‹  12 í”¼í•´",acts:[{op:"damagePlayerFormula",kind:"gloved_hunter"}]},{label:"ì‚¬ì‚´: 9 í”¼í•´",acts:[{op:"damagePlayer",n:9}]}]},{id:"debt_collector",name:"ìž¥ë¶€ ìˆ˜ê¸ˆê´€",maxHp:55,intents:[{label:"ìˆ˜ê¸ˆ: S -3",acts:[{op:"supplies",n:-4}]},{label:"ì••ë¥˜: (Sê°€ 0ì´ë©´) 15 í”¼í•´",acts:[{op:"damagePlayerIfSuppliesZero",n:15}]},{label:"ìž¬ì ê²€: ì•„ë¬´ í–‰ë™ë„ í•˜ì§€ ì•ŠìŒ",acts:[]}]},{id:"supply_hound",name:"ë³´ê¸‰ ì‚¬ëƒ¥ê°œ",maxHp:26,intents:[{label:"ëƒ„ìƒˆ ë§¡ê¸°: ì·¨ì•½ +2 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"vuln",n:2}]},{label:"ë®ì¹˜ê¸°: (Sê°€ 0ì´ ì•„ë‹ˆë©´) 7 í”¼í•´",acts:[{op:"damagePlayerIfSuppliesPositive",n:7}]},{label:"ëœ¯ì–´ë‚´ê¸°: S -2",acts:[{op:"supplies",n:-2}]}]},{id:"archive_censor",name:"ì„œê³ ì˜ ê²€ì—´ê´€",maxHp:34,intents:[{label:"ê²€ì—´ ì£¼ë¬¸: êµëž€ +2 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"disrupt",n:2}]},{label:"ì••ìˆ˜: S -2",acts:[{op:"supplies",n:-2}]},{label:"ê¹ƒíŽœ ì°Œë¥´ê¸°: 7 í”¼í•´, ì•½í™” +2 ë¶€ì—¬",acts:[{op:"damagePlayer",n:7},{op:"statusPlayer",key:"weak",n:2}]}]},{id:"boss_gravity_master",name:"ì¤‘ë ¥ í†µë‹¬ìž",omen:"ëª¸ì´ ì ì  ë¬´ê²ë‹¤. ì§ì„ ë¹„ì›Œë¼.",maxHp:90,intents:[{label:"ì¤‘ë ¥ ìˆ˜ì¶•: ì•½í™” +3 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"weak",n:3}]},{label:"íŠ¹ì´ì  ìƒì„±",acts:[{op:"damagePlayerByDeckSize",base:8,per:3,div:5,cap:30}]},{label:"ì²œìž¥ ë¶•ê´´: 11 í”¼í•´",acts:[{op:"damagePlayer",n:11}]}]},{id:"boss_cursed_wall",name:"ì €ì£¼ë°›ì€ ë²½",omen:"ì›€ì§ì´ì§€ ì•ŠëŠ”ë‹¤. ë‹³ì•„ê°„ë‹¤.",maxHp:160,intents:[{label:"ì €ì£¼ì˜ ê¸°ìš´: ì¶œí˜ˆ +3 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"bleed",n:3}]},{label:"ì €ì£¼ì˜ ê¸°ìš´: F +1",acts:[{op:"fatiguePlayer",n:1}]},{label:"ì•„ë¬´ í–‰ë™ë„ í•˜ì§€ ì•ŠìŒ",acts:[]}]},{id:"boss_giant_orc",name:"ê±°ëŒ€í•œ ì˜¤í¬",omen:"ê±°ëŒ€í•œ ì§ìŠ¹ì´ ê¸°ë‹¤ë¦°ë‹¤. íž˜ì„ ê¹Žì•„ì•¼ í•œë‹¤.",maxHp:95,intents:[{label:"ë‚´ë ¤ì¹˜ê¸°: ì·¨ì•½ +2 ë¶€ì—¬, 10 í”¼í•´",acts:[{op:"statusPlayer",key:"vuln",n:2},{op:"damagePlayer",n:15}]},{label:"ë‹¨ë‹¨í•œ í”¼ë¶€: ë‹¤ìŒ í„´ ë™ì•ˆ í”¼í•´ë¥¼ ìž…ì§€ ì•ŠìŒ",acts:[{op:"enemyImmuneNextTurn"}]},{label:"íƒ€ê³ ë‚œ íšŒë³µ: ìžì‹  HP 15 íšŒë³µ",acts:[{op:"enemyHealSelf",n:15}]},{label:"ê´‘ë¶„: 6 í”¼í•´ (íƒ€ìˆ˜ê°€ ì¦ê°€í•©ë‹ˆë‹¤!)",acts:[{op:"damagePlayerRampHits",n:6,baseHits:1,everyTurns:1,capHits:6}],meta:{cat:"ATTACK"}}]},{id:"boss_soul_stealer",name:"ì˜í˜¼ ê°•íƒˆìž",omen:"í–‰ë™í•˜ì§€ ì•Šìœ¼ë©´ ì¢…ë§ì´ ì˜¨ë‹¤.",maxHp:80,intents:[{label:"í—ˆê¸°: 7 í”¼í•´, S -2",acts:[{op:"damagePlayer",n:7},{op:"supplies",n:-2}]},{label:"ë‚˜íƒœ: 7 í”¼í•´, F +1",acts:[{op:"damagePlayer",n:7},{op:"fatiguePlayer",n:1}]},{label:"ì˜ˆì–¸: ì¹´ìš´íŠ¸ ì§„í–‰",acts:[]}]}],go=Object.fromEntries(Eo.map(e=>[e.id,e])),mt=[{id:"item_balm",name:"ì•½ì´ˆ ì—°ê³ ",text:"HPë¥¼ 8 íšŒë³µí•©ë‹ˆë‹¤. (ì†Œëª¨)",art:"assets/items/item_balm.png",effects:[{op:"heal",n:8}],priceGold:16,consumable:!0},{id:"item_talisman",name:"ë‹¨ë‹¨í•œ ë¶€ì ",text:"ë°©ì–´(ë¸”ë¡) 10ì„ ì–»ìŠµë‹ˆë‹¤. (ì†Œëª¨)",art:"assets/items/item_talisman.png",effects:[{op:"block",n:10}],priceGold:18,consumable:!0},{id:"item_dust",name:"ì €ì£¼ ê°€ë£¨",text:"ëª¨ë“  ì ì—ê²Œ ì·¨ì•½ 2ë¥¼ ë¶€ì—¬í•©ë‹ˆë‹¤. (ì†Œëª¨)",art:"assets/items/item_dust.png",effects:[{op:"statusEnemy",target:"all",key:"vuln",n:2}],priceGold:22,consumable:!0}],Tr=Object.fromEntries(mt.map(e=>[e.id,e]));function Te(e){return Tr[e]??null}function So(){return mt.length===0?null:mt[Math.floor(Math.random()*mt.length)]?.id??null}function en(e,t){const n=e.content.enemiesById[t];return{id:n.id,name:n.name,hp:n.maxHp,maxHp:n.maxHp,intentIndex:0,status:{vuln:0,weak:0,bleed:0,disrupt:0},immuneThisTurn:!1,immuneNextTurn:!1,lastIntentKey:null,lastIntentStreak:0,soulWarnCount:t==="boss_soul_stealer"?0:void 0,soulArmed:t==="boss_soul_stealer"?!1:void 0,soulWillNukeThisTurn:t==="boss_soul_stealer"?!1:void 0}}function wo(e,t,n,r=5){for(const o of t){const a=e.run.enemyLastSeenBattle?.[o];if(a!=null&&n-a<r)return!1}return!0}function Ge(e,t){const n=t?.forceBoss??!1,r=e.run,o=(t?.forceElite??r.pendingElite??!1)===!0;r.pendingElite=!1,e.run.enemyLastSeenBattle??={},e.run.battleCount??=0;const a=e.run.nodePickCount??0,s=(e.run.battleCount??0)+1;if(t?.forcePatternIds&&t.forcePatternIds.length>0){const k=t.forcePatternIds;e.run.battleCount=s;for(const N of k)e.run.enemyLastSeenBattle[N]=s;e.enemies=k.map(N=>en(e,N)),e.run.lastBattleWasElite=!1,e.run.lastBattleWasBoss=!1,y(e,`ì „íˆ¬ ì‹œìž‘! (ë…¸ë“œ ${a}, ì „íˆ¬ ${s}íšŒì°¨) ì : ${e.enemies.map(N=>N.name).join(", ")}`);return}if(n)if(e.run.lastBattleWasElite=!1,e.run.lastBattleWasBoss=!0,e.run.bossPool??=["boss_gravity_master","boss_cursed_wall","boss_giant_orc","boss_soul_stealer"],e.run.bossPool.length===0&&!e.run.nextBossId)y(e,`ë³´ìŠ¤ í’€ì´ ë¹„ì—ˆìŠµë‹ˆë‹¤. ì¼ë°˜ ì „íˆ¬ë¡œ ì§„í–‰í•©ë‹ˆë‹¤. (ë…¸ë“œ ${a})`);else{let k=e.run.nextBossId??null;if(k!=null){const N=e.content.enemiesById[k];e.run.bossOmenText=Br[k]??N.omen??null}k?(e.run.nextBossId=null,e.run.bossPool=e.run.bossPool.filter(N=>N!==k)):(k=ce(e.run.bossPool),e.run.bossPool=e.run.bossPool.filter(N=>N!==k)),e.enemies=[en(e,k)],e.run.ominousProphecySeen=!1,y(e,`ë³´ìŠ¤ ë“±ìž¥! (ë…¸ë“œ ${a}) ì : ${e.enemies[0].name}`),e.run.battleCount=s,e.run.enemyLastSeenBattle[k]=s;return}const i=[[["goblin_raider"],["watching_statue"],["pebble_golem"],["slime"],["rat_swarm"],["supply_hound"]],[["goblin_raider","slime"],["pebble_golem","pebble_golem"],["rock_golem"],["poison_spider"],["rat_swarm","rat_swarm"],["goblin_archer","goblin_raider"],["supply_hound","goblin_raider"],["archive_censor"]],[["goblin_raider","goblin_raider","goblin_raider"],["rock_golem","pebble_golem"],["slime","slime"],["poison_spider","slime"],["gravity_echo"],["gloved_hunter"],["debt_collector"],["archive_censor","slime"]]],l=[["gravity_echo","poison_spider"],["poison_spider","slime"],["watching_statue","slime"],["watching_statue","watching_statue"],["poison_spider","poison_spider"],["rock_golem","gravity_echo"],["goblin_raider","goblin_raider","watching_statue"],["rat_swarm","rat_swarm","rat_swarm"],["archive_censor","slime"]],c=[[["goblin_raider","watching_statue"],["rat_swarm","goblin_archer"]],[["goblin_commander","goblin_archer","goblin_archer"],["watching_statue","watching_statue"],["gloved_hunter","rat_swarm"]],[["rock_golem","gravity_echo"],["poison_spider","poison_spider","poison_spider"]]],m=[["gravity_echo","gravity_echo"],["rock_golem","poison_spider"],["watching_statue","gravity_echo"],["debt_collector","supply_hound","supply_hound"]],u=Number(e.run.timeMove??0)+(e.time??0),d=Math.min(i.length-1,Math.floor(Math.max(0,u)/15)),b=o?e.run.treasureObtained?m:c[d]:e.run.treasureObtained?l:i[d],E=5,p=b.filter(k=>wo(e,k,s,E)),f=p.length>0?p:b,h=ce(f);e.run.battleCount=s;for(const k of h)e.run.enemyLastSeenBattle[k]=s;e.enemies=h.map(k=>en(e,k)),e.run.lastBattleWasElite=o,e.run.lastBattleWasBoss=!1,y(e,`ì „íˆ¬ ì‹œìž‘!${o?" [ì •ì˜ˆ]":""} (ë…¸ë“œ ${a}, ì „íˆ¬ ${s}íšŒì°¨) ì : ${e.enemies.map(k=>k.name).join(", ")}`)}function _o(){return Object.keys(oe).sort((e,t)=>e.localeCompare(t))}const $o=[{id:"relic_ratskin_charm",name:"ì¥ê°€ì£½ ë¶€ì ",text:"ì·¨ì•½ì„ ë°›ì„ ë•Œ 1 ëœ ë°›ìŠµë‹ˆë‹¤.",unlockFlavor:"ì‚´ê°€ì£½. ì–‡ê²Œ, ì•„ì£¼ ì–‡ê²Œ.",tags:["EVENT_ONLY"],art:"assets/relics/relic_ratskin_charm.png"}],oe={relic_unknown_square:{id:"relic_unknown_square",dormantName:"ì –ì€ ì‚¬ê°í˜•",dormantText:"ê³°íŒ¡ì´ì¼ê¹Œ? ë¨¹ì„ ìˆ˜ ìžˆì„ê¹Œ?",unlockHint:"ì¡°ê±´: íœ´ì‹ 1íšŒ",art:"assets/relics/relic_unknown_square.png",unlock:(e,t)=>e.run.unlock?.rest>=t.unlock.rest+1,name:"ë¨¹ì„ ìˆ˜ ìžˆëŠ” ì‚¬ê°í˜•",text:"ì „íˆ¬ ì‹œìž‘ ì‹œ ðŸž S +2",unlockFlavor:"ë¨¹ì„ ìˆ˜ëŠ” ìžˆë‹¤. ì¼ë‹¨ì€.",onCombatStart(e){e.player.supplies+=2,y(e,"ìœ ë¬¼[ë¨¹ì„ ìˆ˜ ìžˆëŠ” ì‚¬ê°í˜•]: S +2")}},relic_monster_leather_helm:{id:"relic_monster_leather_helm",dormantName:"ë“¤ëŸ¬ë¶™ëŠ” ê°€ì£½",dormantText:"í„¸ê³¼ í”¼ê°€ ë’¤ì„žì¸ ê°€ì£½ì´ ì†ì— ë“¤ëŸ¬ë¶™ëŠ”ë‹¤.",unlockHint:"ì¡°ê±´: ì—˜ë¦¬íŠ¸ ì „íˆ¬ ìŠ¹ë¦¬ 1íšŒ",art:"assets/relics/relic_monster_leather_helm.png",unlock:(e,t)=>e.run.unlock?.eliteWins>=t.unlock.eliteWins+1,name:"ëª¬ìŠ¤í„° ê°€ì£½ íˆ¬êµ¬",text:"ì²« í„´ì— ðŸ›¡ï¸ ë°©ì–´ +4",unlockFlavor:"ë¨¸ë¦¬ì— ë“¤ëŸ¬ë¶™ì–´ ë–¨ì–´ì§€ì§€ ì•Šì§€ë§Œ ë‹¹ìž¥ì˜ ë¬¸ì œëŠ” ì•„ë‹ˆë‹¤.",onCombatStart(e){e.player.block+=4,y(e,"ìœ ë¬¼[ëª¬ìŠ¤í„° ê°€ì£½ íˆ¬êµ¬]: ë°©ì–´ +4")}},relic_smoke_bomb:{id:"relic_smoke_bomb",dormantName:"ì†ì´ ë¹„ì–´ ìžˆëŠ” íƒ„í™˜",dormantText:"í”ë“¤ë©´ ìž‘ì€ ì•Œê°±ì´ê°€ êµ´ëŸ¬ë‹¤ë‹Œë‹¤. ì—°ê¸°ê°€ ì¡°ê¸ˆì”© ìƒŒë‹¤.",unlockHint:"ì¡°ê±´: í•œ ë²ˆì— 10 ì´ìƒì˜ ðŸ—¡ï¸ í”¼í•´ 1íšŒ ë°›ê¸°",art:"assets/relics/relic_smoke_bomb.png",unlock:(e,t)=>(e.run.unlock?.tookBigHit10??0)>=t.unlock.tookBigHit10+1,name:"ì—°ë§‰íƒ„",text:"í™œì„±í™” ì‹œ ì—°ë§‰ ì¹´ë“œ(ì†Œì‹¤) 1ìž¥ íšë“",unlockFlavor:"ë¹„ìƒ íƒˆì¶œ!",onActivate(e){const t="smoke";e.uidSeq+=1;const n=String(e.uidSeq);e.cards[n]={uid:n,defId:t,zone:"deck",upgrade:0},e.deck.push(n),y(e,"ìœ ë¬¼[ì—°ë§‰íƒ„]: ì—°ë§‰ ì¹´ë“œ 1ìž¥ íšë“")}},relic_bone_compass:{id:"relic_bone_compass",dormantName:"ê¸¸ì„ ìžƒëŠ” ë°”ëŠ˜",dormantText:"ë°©í–¥ì„ ê°€ë¦¬í‚¤ì§€ ëª»í•˜ëŠ” ë°”ëŠ˜ì´ ì£¼ë¨¸ë‹ˆ ë°”ê¹¥ìœ¼ë¡œ ë‚˜ì˜¨ë‹¤.",unlockHint:"ì¡°ê±´: íƒí—˜ 5íšŒ",art:"assets/relics/relic_bone_compass.png",unlock:(e,t)=>{const n=e.run;return(Number(n.timeMove??e.run?.nodePickCount??0)||0)>=t.moves+5},name:"ë¼ˆê°€ ë§Œë“  ë‚˜ì¹¨ë°˜",text:"ì „íˆ¬ ì‹œìž‘ ì‹œ ðŸƒ ë“œë¡œìš° +1",unlockFlavor:"ì–´ë””ë¥¼ ê°€ë¦¬í‚¤ëŠ” ê²ƒì´ì§€?",onCombatStart(e){e._combatStartExtraDraw=(e._combatStartExtraDraw??0)+1,y(e,"ìœ ë¬¼[ë¼ˆê°€ ë§Œë“  ë‚˜ì¹¨ë°˜]: ì „íˆ¬ ì‹œìž‘ ë“œë¡œìš° +1")}},relic_flesh_whetstone:{id:"relic_flesh_whetstone",dormantName:"ì´ê°€ ë¹ ì§„ ì¹¼ë‚ ",dormantText:"ì–´ë””ì— ì“°ë¼ê³  ìžˆëŠ”ì§€ ëª¨ë¥´ê² ë‹¤.",unlockHint:"ì¡°ê±´: ì  ì²˜ì¹˜ 3íšŒ",art:"assets/relics/relic_flesh_whetstone.png",unlock:(e,t)=>(e.run.unlock?.kills??0)>=t.unlock.kills+3,name:"ì†ì‚´ì„ ì°¾ëŠ” ìˆ«ëŒ",text:"ì „íˆ¬ì—ì„œ ì²« ê³µê²©ì´ ì£¼ëŠ” ðŸ—¡ï¸ í”¼í•´ +3",unlockFlavor:"ë°¤ë§ˆë‹¤ ë¬´ì–¸ê°€ ê°ˆê³  ìžˆë‹¤.",onCombatStart(e){e._firstPlayerAttackDoneThisCombat=!1},modifyDamage(e,t){if(t.phase!=="PRE_STATUS")return t.current;if(t.target==="ENEMY"&&t.source==="PLAYER_ATTACK"){const n=e;if(!n._firstPlayerAttackDoneThisCombat)return n._firstPlayerAttackDoneThisCombat=!0,t.current+3}return t.current}},relic_weak_bell:{id:"relic_weak_bell",dormantName:"ìƒˆê¹Œë§Œ ì¢…",dormantText:"ë§Œì§€ë©´ ì†ëì´ ë¬´ê²ë‹¤. ë‹¹ìž¥ì—” ì•„ë¬´ ì¼ë„ ì—†ë‹¤.",unlockHint:"ì¡°ê±´: ðŸ¥€ ì•½í™”ë¥¼ ë°›ì€ ìƒíƒœë¡œ í„´ ì¢…ë£Œ 1íšŒ",art:"assets/relics/relic_weak_bell.png",unlock:(e,t)=>(e.run.unlock?.endedTurnWeak??0)>=t.unlock.endedTurnWeak+1,name:"í—ˆì•½ì˜ ì¢…ì†Œë¦¬",text:"ì „íˆ¬ ì‹œìž‘ ì‹œ ëª¨ë“  ì ì—ê²Œ ðŸ¥€ ì•½í™” +2",unlockFlavor:"ì™ ì§€ ë“¤ìœ¼ë©´ ë§ˆìŒì´ í‰ì˜¨í•´ì§„ë‹¤.",onCombatStart(e){const t=re(e);for(const n of t)yt(n,"weak",2,e,"SYSTEM");t.length&&y(e,"ìœ ë¬¼[í—ˆì•½ì˜ ì¢…ì†Œë¦¬]: ëª¨ë“  ì  ì•½í™” +2")}},relic_return_path_memory:{id:"relic_return_path_memory",dormantName:"ì°¢ì–´ì§„ ì§€ë„ ì¡°ê°",dormantText:"ì½ì„ ìˆ˜ ì—†ëŠ” ê¸¸ì´ ê·¸ë ¤ì ¸ ìžˆë‹¤. ê°€ë³´ê³  ì‹¶ë‹¤.",unlockHint:"ì¡°ê±´: ì´ë²¤íŠ¸ 2íšŒ ì„ íƒ",art:"assets/relics/relic_return_path_memory.png",unlock:(e,t)=>(e.run.unlock?.eventPicks??0)>=t.unlock.eventPicks+2,name:"ëŒì•„ì˜¨ ê¸¸ì˜ ê¸°ì–µ",text:"ì „íˆ¬ ìŠ¹ë¦¬ ì‹œ HP +3",unlockFlavor:"ì™”ê¸°ì— ê°ˆ ìˆ˜ ì—†ë‹¤.",onVictory(e){Tt(e,3),y(e,"ìœ ë¬¼[ëŒì•„ì˜¨ ê¸¸ì˜ ê¸°ì–µ]: ìŠ¹ë¦¬ íšŒë³µ +3")}},relic_wound_vial:{id:"relic_wound_vial",dormantName:"ë°˜ì´ë‚˜ ë‚¨ì€ ë¶‰ì€ ì•¡ì²´",dormantText:"ë§ˆê°œë¥¼ ì—´ì§€ ì•Šì•˜ëŠ”ë°ë„ í”¼ ëƒ„ìƒˆê°€ ë‚œë‹¤.",unlockHint:"ì¡°ê±´: HPê°€ 15 ì´í•˜ë¡œ ë–¨ì–´ì§„ ì  1íšŒ",art:"assets/relics/relic_wound_vial.png",unlock:(e,t)=>(e.run.unlock?.hpLeq15??0)>=t.unlock.hpLeq15+1,name:"ìƒì²˜ë¡œ ê¸°ì–´ê°€ëŠ” ì•½ë³‘",text:"ì „íˆ¬ ì‹œìž‘ ì‹œ HP +3",unlockFlavor:"ì”¨ì•—ì´ ìžˆì—ˆë‚˜?",onCombatStart(e){Tt(e,3),y(e,"ìœ ë¬¼[ìƒì²˜ë¡œ ê¸°ì–´ê°€ëŠ” ì•½ë³‘]: ì „íˆ¬ ì‹œìž‘ íšŒë³µ +3")}},relic_counting_needle:{id:"relic_counting_needle",dormantName:"ë©ˆì¶˜ ë°”ëŠ˜",dormantText:"ì‹œê³„ì¼ê¹Œ? ì‹œê³„ê°€ ì•„ë‹ê¹Œ? ë‘˜ ë‹¤ ì•„ë‹ˆë‹¤.",unlockHint:"ì¡°ê±´: ì•„ë¬´ í–‰ë™ë„ í•˜ì§€ ì•Šê³  í„´ ì¢…ë£Œ 1íšŒ",art:"assets/relics/relic_counting_needle.png",unlock:(e,t)=>(e.run.unlock?.skippedTurn??0)>=t.unlock.skippedTurn+1,name:"ìˆ¨ì„ ì„¸ëŠ” ë°”ëŠ˜",text:"í„´ ì¢…ë£Œ ì‹œ ë‹¤ìŒ í„´ ðŸƒ ë“œë¡œìš° +1",unlockFlavor:"ë°”ëŠ˜ì´ ëˆë‹¤. ì•„ë¬´ê²ƒë„ ì—†ì´.",onUpkeepEnd(e){e._extraDrawNextTurn=Number(e._extraDrawNextTurn??0)+1,y(e,"ìœ ë¬¼[ìˆ¨ì„ ì„¸ëŠ” ë°”ëŠ˜]: ë‹¤ìŒ í„´ ë“œë¡œìš° +1")}},relic_deeper_needle:{id:"relic_deeper_needle",dormantName:"ë¼ˆë¡œ ë§Œë“  ë°”ëŠ˜",dormantText:"ë”°ë”í•¨ì— ìµìˆ™í•œ ì§€ ì˜¤ëž˜ë‹¤.",unlockHint:"ì¡°ê±´: ì ì—ê²Œ ðŸ©¸ ì¶œí˜ˆ ë¶€ì—¬ 3íšŒ",art:"assets/relics/relic_deeper_needle.png",unlock:(e,t)=>(e.run.unlock?.bleedApplied??0)>=t.unlock.bleedApplied+3,name:"ë” ê¹Šì€ ë°”ëŠ˜",text:"ðŸ©¸ ì¶œí˜ˆì„ ë¶€ì—¬í•  ë•Œë§ˆë‹¤ +1 ì¶”ê°€",unlockFlavor:"ë°”ëŠ˜ì´ í”¼ë¥¼ ë¨¹ê³  ê¸¸ì–´ì§„ ê²ƒ ê°™ë‹¤.",onCombatStart(e){e._bleedBonusPerApply=1},onVictory(e){delete e._bleedBonusPerApply}},relic_broken_millstone:{id:"relic_broken_millstone",dormantName:"ê¸ˆ ê°„ ë§·ëŒ",dormantText:"ê°ˆê³  ìžˆìœ¼ë©´ ì‹œê°„ ê°€ëŠ” ì¤„ ëª¨ë¥´ê² ë‹¤.",unlockHint:"ì¡°ê±´: ì‹œê°„ 10 í˜ë ¤ë³´ë‚´ê¸°",art:"assets/relics/relic_broken_millstone.png",unlock:(e,t)=>{const n=e.run,r=Number(n.timeMove??0)||0,o=Number(e.time??0)||0;return r+o>=t.timeTotal+10},name:"ê¹¨ì§„ ë§·ëŒ",text:"ë§¤ í„´ ëª¨ë“  ì ì—ê²Œ ðŸ—¡ï¸ 2 í”¼í•´",unlockFlavor:"ëŒì´ ë‹³ëŠ”ë‹¤. ì ë„ ë‹³ëŠ”ë‹¤.",onUpkeepEnd(e){const t=re(e);if(t?.length){for(const n of t){let r=2;const o=Number(n.block??0);if(o>0){const a=Math.min(o,r);n.block=o-a,r-=a}if(r>0){const a=Number(n.hp??0);n.hp=Math.max(0,a-r)}}y(e,"ìœ ë¬¼[ê¹¨ì§„ ë§·ëŒ]: ëª¨ë“  ì ì—ê²Œ 2 í”¼í•´")}}},relic_bloody_spoon:{id:"relic_bloody_spoon",dormantName:"ë¶‰ì€ ìˆŸê°€ë½",dormantText:"ì‡  ëƒ„ìƒˆê°€ ì§„í•˜ë‹¤.",unlockHint:"ì¡°ê±´: ðŸ’¤ F 10 ì´ìƒ",art:"assets/relics/relic_bloody_spoon.png",unlock:(e,t)=>{const n=Number(e.player.fatigue??0)||0,r=Math.max(10,(Number(t.fatigue??0)||0)+1);return n>=r},name:"í”¼ ë¬»ì€ ìˆŸê°€ë½",text:"íšŒë³µ ì‹œ 1 ì¶”ê°€ íšŒë³µ",unlockFlavor:"ì´ëŸ°, í”¼ì˜€ë‹¤."},relic_black_ledger_shard:{id:"relic_black_ledger_shard",dormantName:"ê²€ëŒ• ë¬»ì€ ì¢…ì´",dormantText:"ê²€ì€ ì¢…ì´ë‹¤. íƒ€ê³  ë‚¨ì€ ì¡°ê°ì¼ì§€ë„ ëª¨ë¥´ê² ë‹¤.",unlockHint:"ì¡°ê±´: ðŸžS = 0ìœ¼ë¡œ í„´ ì¢…ë£Œ 1íšŒ",art:"assets/relics/relic_black_ledger_shard.png",unlock:(e,t)=>(e.run.unlock?.endedTurnSupplyZero??0)>=t.unlock.endedTurnSupplyZero+1,name:"ê²€ì€ ìž¥ë¶€ ì¡°ê°",text:"ðŸžS = 0ìœ¼ë¡œ í„´ì„ ì¢…ë£Œí•˜ë©´, ðŸžS +2, ðŸ’¤ F +1",unlockFlavor:"ìž¥ë¶€. ë¬´ì—‡ì˜?",onUpkeepEnd(e){const t=re(e);if(t?.length){for(const n of t){let r=2;const o=Number(n.block??0);if(o>0){const a=Math.min(o,r);n.block=o-a,r-=a}if(r>0){const a=Number(n.hp??0);n.hp=Math.max(0,a-r)}}y(e,"ìœ ë¬¼[ê²€ì€ ìž¥ë¶€ ì¡°ê°]: S +2, F +1")}}},relic_ink_bottle:{id:"relic_ink_bottle",dormantName:"ê²€ì€ ìž‰í¬ ì–¼ë£©",dormantText:"ì†ê°€ë½ ëì´ ê²€ê²Œ ë¬¼ë“ ë‹¤. ì”»ì–´ë„ ì§€ì›Œì§€ì§€ ì•ŠëŠ”ë‹¤.",unlockHint:"ì¡°ê±´: ðŸžS = 0ìœ¼ë¡œ í„´ ì¢…ë£Œ 1íšŒ",art:"assets/relics/relic_ink_bottle.png",unlock:(e,t)=>(e.run.unlock?.endedTurnSupplyZero??0)>=t.unlock.endedTurnSupplyZero+1,name:"ê²€ì€ ìž‰í¬ë³‘",text:"ì „íˆ¬ ì‹œìž‘ ì‹œ ë‹¬ë¹› ë‘ë£¨ë§ˆë¦¬ 1ìž¥ì„ ì†íŒ¨ì— ì¶”ê°€",unlockFlavor:"ê¸€ìžëŠ” ë§ˆì¹˜ ë²Œë ˆì²˜ëŸ¼ ê¸°ì–´ë‹¤ë‹Œë‹¤.",onCombatStart(e){const t="token_moon_scroll";e.uidSeq+=1;const n=String(e.uidSeq);e.cards[n]={uid:n,defId:t,zone:"hand",upgrade:0},e.hand.push(n),y(e,"ìœ ë¬¼[ê²€ì€ ìž‰í¬ë³‘]: ë‹¬ë¹› ë‘ë£¨ë§ˆë¦¬ +1")}},relic_ratskin_charm:{id:"relic_ratskin_charm",name:"ì¥ê°€ì£½ ë¶€ì ",text:"ì·¨ì•½ì„ ë°›ì„ ë•Œ 1 ëœ ë°›ìŠµë‹ˆë‹¤.",unlockFlavor:"ì‚´ê°€ì£½. ì–‡ê²Œ, ì•„ì£¼ ì–‡ê²Œ.",tags:["EVENT_ONLY"],art:"assets/relics/relic_ratskin_charm.png"}};function No(e,t){return(e.run?.relics??[]).includes(t)}const Ao=new Set($o.map(e=>e.id));function Io(e){return Ao.has(e)}const Mo={rest:0,eliteWins:0,tookBigHit10:0,kills:0,endedTurnWeak:0,eventPicks:0,hpLeq15:0,skippedTurn:0,bleedApplied:0,endedTurnSupplyZero:0};function He(e){e.run.relics??=[];const t=e.run;t.relicRuntime??={},t.pendingRelicActivations??=[],t.unlock={...Mo,...t.unlock??{}},t.relicUnlocked??={}}function vr(e){return He(e),e.run.relicRuntime}function xr(e){return He(e),e.run.pendingRelicActivations}function ve(e){return He(e),e.run.unlock}function Cr(e){const t=ve(e),n=e.run,r=Number(n.timeMove??e.run?.nodePickCount??0)||0,o=(Number(n.timeMove??0)||0)+(Number(e.time??0)||0);return{unlock:{...t},moves:r,timeTotal:o,fatigue:Number(e.player?.fatigue??0)||0,supplies:Number(e.player?.supplies??0)||0}}function Ct(e,t){const n=vr(e);if(n[t])return n[t];const o=!oe[t]?.unlock;return n[t]={active:o,pending:!1,obtainedAtNode:e.run.nodePickCount},n[t]}function $n(e,t){return!!Ct(e,t).active}function Po(e,t){const n=e.run;return n.forceLockedRelics?.[t]===!0?!1:!!(n.forceUnlockedRelics?.[t]===!0||n.relicUnlocked?.[t]===!0||Array.isArray(n.unlockedRelics)&&n.unlockedRelics.includes(t)||n.unlockProgress?.relics?.[t]===!0||n.unlocks?.relics?.[t]===!0)}function It(e,t){He(e);const n=oe[t],r=n?.name??t,o=n?.text??"",a=n?.art,i=e.run.relicRuntime?.[t]??null,l=!!n?.unlock,c=Po(e,t),m=i?.active===!0?"ACTIVE":i?.pending===!0?"PENDING":"DORMANT",u=(()=>{const d=n?.unlockFlavor;if(!d||l&&!c)return"";const b=typeof d=="function"?d(e):d;return b?`

${b}`:""})();if(m==="ACTIVE")return{id:t,state:m,name:r,text:`${o}${u}`,art:a};if(m==="PENDING")return l&&!c?{id:t,state:m,name:r,text:`${o}

(ë‹¤ìŒ ë…¸ë“œë¶€í„° í™œì„±)`,art:a}:{id:t,state:m,name:r,text:`${o}${u}`,art:a};if(l&&!c){const d=n?.dormantName??r,b=[];n?.dormantText&&b.push(n.dormantText),n?.unlockHint&&b.push(n.unlockHint);const E=b.length?b.join(`
 
`):o;return{id:t,state:m,name:d,text:E,art:a}}return{id:t,state:m,name:r,text:`${o}${u}`,art:a}}function Mt(e,t,n="NORMAL"){if(He(e),Io(t)&&n!=="EVENT"){const s=oe[t];y(e,`ì´ ìœ ë¬¼ì€ ì´ë²¤íŠ¸ë¡œë§Œ íšë“í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤: ${s?.name??t}`);return}e.run.relics.includes(t)||e.run.relics.push(t);const r=oe[t],o=Ct(e,t);if(!r?.unlock){o.active=!0,o.pending=!1,e.run.relicUnlocked[t]=!0,y(e,`ìœ ë¬¼ íšë“: ${r?.name??t}`),me(e,"RELIC",`ìœ ë¬¼ íšë“: ${r?.name??t}`,2e3);return}o.active=!1,o.unlockBase||(o.unlockBase=Cr(e));const a=It(e,t);y(e,`ìœ ë¬¼ íšë“: ${a.name}`),me(e,"RELIC",`ìœ ë¬¼ íšë“: ${a.name}`,2e3)}function Ro(e,t){const n=Ct(e,t);if(n.active||n.pending)return;n.pending=!0;const r=xr(e);r.includes(t)||r.push(t);const o=oe[t];y(e,`ìœ ë¬¼ ì¡°ê±´ ë‹¬ì„±: ${o?.name??t} (ë‹¤ìŒ ë…¸ë“œë¶€í„° í™œì„±)`)}function ge(e){He(e);for(const t of e.run.relics){const n=oe[t];if(!n?.unlock)continue;const r=Ct(e,t);if(!(r.active||r.pending)){if(!r.unlockBase){r.unlockBase=Cr(e);continue}n.unlock(e,r.unlockBase)&&Ro(e,t)}}}function fe(e){He(e);const t=xr(e);if(!t.length)return;e.run.pendingRelicActivations=[];const n=vr(e);for(const r of t){const o=n[r]??Ct(e,r);if(!o.pending)continue;o.pending=!1,o.active=!0,o.activatedAtNode=e.run.nodePickCount,e.run.relicUnlocked[r]=!0;const a=oe[r];a?.onActivate?.(e),y(e,`ìœ ë¬¼ í™œì„±í™”: ${a?.name??r}`)}}function Lo(e){return He(e),e.run.relics??[]}function Nn(e){return Lo(e).filter(t=>$n(e,t))}function Et(e,t,...n){for(const r of Nn(e)){const o=oe[r];if(!o)continue;const a=o[t];a?.(e,...n)}}function Ie(e,t){let n=t.current;for(const r of Nn(e)){const a=oe[r]?.modifyDamage;if(!a)continue;const s=a(e,{...t,current:n});n=Number.isFinite(s)?s:n,n<0&&(n=0)}return n}function Er(e,t,n){for(const r of Nn(e))oe[r]?.onDamageApplied?.(e,t,n)}function Bo(e){return e<0?0:e}function Oo(e,t,n){const r=t.player.status?.vuln??0,o=n.status?.weak??0;return Bo(e+r-o)}function Ho(e,t){let n=Math.max(0,Number(t)||0);const r=[];for(const o of e){const a=Math.min(n,o);n-=a,r.push(o-a)}return r}function Ye(e,t){e.push(t)}function Do(e){const t=(e.dmgTotal??0)>0||(e.hits??0)>0||(e.perHit??0)>0,n=(e.applies??[]).some(o=>o.target==="player"&&["vuln","weak","bleed","disrupt","supplies","fatigue"].includes(String(o.kind))),r=(e.applies??[]).some(o=>o.target==="enemy"&&["vuln","weak","bleed","disrupt","immune"].includes(String(o.kind)));return t&&n?"ATTACK_DEBUFF":t&&r?"ATTACK_BUFF":t?"ATTACK":n?"DEBUFF":r?"BUFF":"OTHER"}function Fo(e,t,n){const r=t.usedThisTurn??0;return e==="goblin_raider"?{raw:Math.max(0,12-r),hits:1}:e==="watching_statue"?{raw:4+r,hits:1}:e==="gloved_hunter"?{raw:Number(t.player.block??0)>=4?12:6,hits:1}:{raw:0,hits:1}}function Wo(e,t){const n=Number(t.base??0),r=Number(t.per??0),o=Math.max(1,Number(t.div??1)),a=t.cap==null?1/0:Number(t.cap),s=(e.deck?.length??0)+(e.hand?.length??0)+(e.discard?.length??0)+(e.frontSlots?.filter(Boolean).length??0)+(e.backSlots?.filter(Boolean).length??0)+(e.exhausted?.length??0),i=Math.ceil(s/o),l=n+r*i;return Math.min(a,Math.max(0,l))}function gr(e,t,n,r={}){if(n.meta?.preview){const d=n.meta.preview(e,t);if(d)return d}const o=[],a=[],s=[];if(n.meta?.applies)for(const d of n.meta.applies)Ye(o,d);for(const d of n.acts)switch(d.op){case"damagePlayer":{s.push(Math.max(0,Number(d.n)||0));break}case"damagePlayerFormula":{const{raw:b,hits:E}=Fo(d.kind,e),p=Math.max(1,Number(E??1)||1),f=Math.max(0,Number(b)||0);for(let h=0;h<p;h++)s.push(f);break}case"statusPlayer":{Ye(o,{target:"player",kind:d.key,amount:d.n});break}case"supplies":{Ye(o,{target:"player",kind:"supplies",amount:d.n});break}case"fatiguePlayer":{Ye(o,{target:"player",kind:"fatigue",amount:d.n});break}case"enemyHealSelf":{Ye(o,{target:"enemy",kind:"heal",amount:d.n});break}case"enemyImmuneNextTurn":{Ye(o,{target:"enemy",kind:"immune",amount:1});break}case"damagePlayerRampHits":{const b=Math.max(1,Number(e.combatTurn??1)),E=Math.max(1,Number(d.baseHits??1)),p=Math.max(1,Number(d.everyTurns??1));let f=E+Math.floor((b-1)/p);d.capHits!=null&&(f=Math.min(f,Math.max(1,Number(d.capHits))));const h=Math.max(0,Number(d.n)||0);for(let x=0;x<f;x++)s.push(h);break}case"damagePlayerIfSuppliesPositive":{e.player.supplies>0&&s.push(Math.max(0,Number(d.n)||0));break}case"damagePlayerIfSuppliesZero":{e.player.supplies==0&&s.push(Math.max(0,Number(d.n)||0));break}case"damagePlayerByDeckSize":{s.push(Wo(e,d));break}}if(!s.length){const d=Math.max(0,Number(n.meta?.hits??0)||0),b=Math.max(0,Number(n.meta?.baseDmg??0)||0);if(d>0&&b>0)for(let E=0;E<d;E++)s.push(b)}let i=s.map(d=>Oo(d,e,t));r.includeBlock&&i.length&&(i=Ho(i,e.player.block??0));const l=i.length,c=l?i.reduce((d,b)=>d+b,0):void 0,m=l&&i.every(d=>d===i[0])?i[0]:void 0,u={cat:n.meta?.cat??"OTHER",dmgTotal:c,hits:l>0?l:n.meta?.hits,perHit:m??n.meta?.baseDmg,applies:o.length?o:void 0,notes:a.length?a:void 0};return u.cat=n.meta?.cat??Do(u),u.shortText||(u.dmgTotal!=null&&(u.hits??0)>1?u.shortText=`${u.dmgTotal} (${u.hits}íƒ€)`:u.dmgTotal!=null&&(u.shortText=`${u.dmgTotal}`)),u}const Uo={other_adventurer:new Set([1]),slime:new Set([0,1]),pebble_golem:new Set([1]),rock_golem:new Set([1]),poison_spider:new Set([0,2]),boss_cursed_wall:new Set([0]),boss_giant_orc:new Set([1])};function Ko(e,t){const n=Uo[e];return!!n&&n.has(t)}function mn(e){if(e===null)return"null";const t=typeof e;return t==="number"||t==="boolean"?String(e):t==="string"?JSON.stringify(e):Array.isArray(e)?"["+e.map(mn).join(",")+"]":t==="object"?"{"+Object.keys(e).sort().map(r=>JSON.stringify(r)+":"+mn(e[r])).join(",")+"}":JSON.stringify(String(e))}function Sr(e){if(!e)return"NONE";const t={};for(const n of Object.keys(e))n==="label"||n==="text"||n==="desc"||n==="name"||(t[n]=e[n]);return t.effects&&Array.isArray(t.effects)&&(t.effects=t.effects.map(n=>{const r={};for(const o of Object.keys(n??{}))o==="label"||o==="text"||o==="desc"||o==="name"||(r[o]=n[o]);return r})),mn(t)}function zo(e,t){const n=e.lastIntentKey??null,r=e.lastIntentStreak??0;n===t?e.lastIntentStreak=Math.min(3,r+1):(e.lastIntentKey=t,e.lastIntentStreak=1)}function jo(e,t,n,r,o){const a=e.length;if(a<=1)return 0;const s=Array.from({length:a},(d,b)=>b),i=d=>d===t&&Ko(n,d),l=d=>!!r&&o>=2&&Sr(e[d])===r,c=s.filter(d=>!i(d)&&!l(d));if(c.length>0)return ce(c);const m=s.filter(d=>!l(d));if(m.length>0)return ce(m);const u=s.filter(d=>!i(d));return u.length>0?ce(u):ce(s)}const Vo=2,qo=.6;function An(e){if(e.intentsRevealedThisTurn)return;e.intentsRevealedThisTurn=!0,e.attackedEnemyIndicesThisTurn=[],e.backUidsThisTurn=[],e.placedUidsThisTurn=[],e.drawCountThisTurn=0,e.phase="REVEAL",e.player.immuneToDisruptThisTurn=!1,e.player.nullifyDamageThisTurn=!1,e.disruptIndexThisTurn=null,e.backSlotDisabled=[!1,!1,!1],(e.player.status.disrupt??0)>0&&(e.disruptIndexThisTurn=Math.floor(Math.random()*3),e.backSlotDisabled[e.disruptIndexThisTurn]=!0);for(const n of e.enemies)n.immuneThisTurn=n.immuneNextTurn,n.immuneNextTurn=!1;for(const n of re(e)){n.intentLabelOverride=void 0;const o=e.content.enemiesById[n.id].intents;if(!o||o.length===0)continue;const a=jo(o,n.intentIndex??0,n.id,n.lastIntentKey??null,n.lastIntentStreak??0);n.intentIndex=a;const s=o[a%o.length];if(zo(n,Sr(s)),n.id==="boss_soul_stealer"){n.soulWillNukeThisTurn=!1;const u=n.soulWarnCount??0;if(!!n.soulArmed){if(Math.random()<qo){n.soulWillNukeThisTurn=!0,n.intentLabelOverride="ì¢…ë§: 50 í”¼í•´",y(e,`ì  ì˜ë„: ${n.name} â†’ ${n.intentLabelOverride}`);continue}const E=o[n.intentIndex%o.length];n.intentLabelOverride=`${E.label} (í­ë°œ ê°€ëŠ¥ ìƒíƒœ)`,y(e,`ì  ì˜ë„: ${n.name} â†’ ${n.intentLabelOverride}`);continue}const b=o[n.intentIndex%o.length];n.intentLabelOverride=`${b.label} (ê²½ê³  ${u}/3)`,y(e,`ì  ì˜ë„: ${n.name} â†’ ${n.intentLabelOverride}`);continue}const i=o[n.intentIndex%o.length],l=gr(e,n,i);let c="";l.dmgTotal!=null?c=(l.hits??1)>1?` (${l.dmgTotal}, ${l.hits}íƒ€)`:` (${l.dmgTotal})`:(l.hits??0)>1&&(c=` (${l.hits}íƒ€)`);const m=`${i.label}${c}`;n.intentLabelOverride=m,y(e,`ì  ì˜ë„: ${n.name} â†’ ${m}`)}e.disruptIndexThisTurn!==null&&y(e,`êµëž€: ì´ë²ˆ í„´ í›„ì—´ ${e.disruptIndexThisTurn} ë¬´íš¨`),Et(e,"onReveal"),e.phase="PLACE"}const Go=Vo;function tn(e,t,n){const r=e.game,o={kind:"damageSelect",amount:t,formulaKind:n,aliveCountSnap:re(r).length,sourceCardUid:e.cardUid||void 0,sourceLabel:e.sourceLabel,reason:e.reason??(e.side==="front"?"FRONT":"BACK")};r.pendingTargetQueue??=[],r.pendingTarget==null?r.pendingTarget=o:r.pendingTargetQueue.push(o),y(r,`ëŒ€ìƒ ì„ íƒ í•„ìš”: ì ì„ í´ë¦­í•˜ì„¸ìš”. (${1+r.pendingTargetQueue.length}ê°œ ë‚¨ìŒ)`)}function Yo(e,t,n){const r=e.game,o={kind:"statusSelect",key:t,n,sourceCardUid:e.cardUid||void 0,sourceLabel:e.sourceLabel,reason:e.reason??(e.side==="front"?"FRONT":"BACK")};r.pendingTargetQueue??=[],r.pendingTarget==null?r.pendingTarget=o:r.pendingTargetQueue.push(o),y(r,"ëŒ€ìƒ ì„ íƒ í•„ìš”: ì ì„ í´ë¦­í•˜ì„¸ìš”.")}function Xo(e,t){if(t.id==="boss_soul_stealer"&&t.soulWillNukeThisTurn)return!0;const n=e.content.enemiesById[t.id];return n.intents[t.intentIndex%n.intents.length].acts.some(o=>o.op==="damagePlayer"||o.op==="damagePlayerFormula"||o.op==="damagePlayerByDeckSize")}function Qo(e,t){switch(t){case"prey_mark":return 7;case"prey_mark_u1":return 9;case"triple_bounty":return 8;case"triple_bounty_u1":return 10;default:return 0}}function Gn(e,t,n,r,o){switch(t){case"prey_mark":return n.hp>e.player.hp?r+5:r;case"prey_mark_u1":return n.hp>e.player.hp?r+6:r;case"triple_bounty":return(o??re(e).length)>=3?r+8:r;case"triple_bounty_u1":return(o??re(e).length)>=3?r+10:r;default:return r}}function at(e,t){const n=e.game;for(const r of t)switch(r.op){case"block":Oa(n,r.n);break;case"supplies":Ha(n,r.n);break;case"fatigue":je(n,r.n);break;case"heal":Tt(n,r.n);break;case"hp":n.player.hp=Math.max(0,Math.min(n.player.maxHp,n.player.hp+r.n)),y(n,`HP ${r.n>=0?"+":""}${r.n} (í˜„ìž¬ ${n.player.hp}/${n.player.maxHp})`);break;case"maxHp":n.player.maxHp+=r.n,n.player.hp=Math.min(n.player.maxHp,n.player.hp+r.n),y(n,`ìµœëŒ€ HP +${r.n} (í˜„ìž¬ ${n.player.hp}/${n.player.maxHp})`);break;case"setSupplies":n.player.supplies=Math.max(0,r.n),y(n,`ë³´ê¸‰ Së¥¼ ${n.player.supplies}ìœ¼ë¡œ ì„¤ì •`);break;case"draw":{const o=Lt(n,r.n);n.drawCountThisTurn+=o;break}case"ifDrewThisTurn":{n.drawCountThisTurn>0&&at(e,r.then);break}case"damageEnemy":if(r.target==="random"){const o=re(n);if(o.length===0)break;De(n,ce(o),r.n)}else if(r.target==="all")for(const o of re(n))De(n,o,r.n);else tn(e,r.n);break;case"clearStatusSelf":{const o=r.key;n.player.status[o]=0,y(n,`ìƒíƒœ í•´ì œ: ${o} = 0`);break}case"damageEnemyBy":{if(r.target!=="random")break;const o=re(n);if(o.length===0)break;let a=0;r.by==="frontCount"&&(a=n.frontSlots.filter(Boolean).length*r.nPer),De(n,ce(o),a);break}case"damageEnemyByPlayerFatigue":{const o=Math.max(0,Math.floor(n.player.fatigue*r.mult));if(r.target==="random"){const a=re(n);if(a.length===0)break;De(n,ce(a),o);break}if(r.target==="select"){if(o<=0)break;tn(e,o);break}break}case"damageEnemyFormula":{const o=Qo(e,r.kind);if(o<=0)break;if(r.target==="select"){tn(e,o,r.kind);break}if(r.target==="random"){const a=re(n);if(a.length===0)break;const s=ce(a),i=Gn(n,r.kind,s,o,a.length);De(n,s,i);break}if(r.target==="all"){const a=re(n),s=a.length;for(const i of a){const l=Gn(n,r.kind,i,o,s);De(n,i,l)}break}break}case"statusPlayer":n.player.status[r.key]=Math.max(0,(n.player.status[r.key]??0)+r.n),y(n,`í”Œë ˆì´ì–´ ìƒíƒœ: ${r.key} ${r.n>=0?"+":""}${r.n}`);break;case"statusEnemy":if(r.target==="random"){const o=re(n);if(o.length===0)break;const a=ce(o);if(yt(a,r.key,r.n,n,"PLAYER"),y(n,`ì (${a.name}) ìƒíƒœ: ${r.key} ${r.n>=0?"+":""}${r.n}`),r.key==="bleed"&&r.n>0){const s=ve(n);s.bleedApplied+=1,ge(n)}}else if(r.target==="all"){const o=re(n);if(o.length===0)break;for(const a of o)yt(a,r.key,r.n,n,"PLAYER");if(y(n,`ëª¨ë“  ì  ìƒíƒœ: ${r.key} ${r.n>=0?"+":""}${r.n}`),r.key==="bleed"&&r.n>0){const a=ve(n);a.bleedApplied+=o.length,ge(n)}}else Yo(e,r.key,r.n);break;case"statusEnemiesAttackingThisTurn":{const o=re(n).filter(a=>Xo(n,a));if(o.length===0){y(n,`ì´ë²ˆ í„´ ê³µê²© ì˜ë„ ì  ì—†ìŒ â†’ ${r.key} ì ìš© ì—†ìŒ`);break}for(const a of o)a.status[r.key]=Math.max(0,(a.status[r.key]??0)+r.n);y(n,`ê³µê²© ì˜ë„ ì ì—ê²Œ ${r.key} ${r.n>=0?"+":""}${r.n} (ëŒ€ìƒ ${o.length})`);break}case"immuneDisruptThisTurn":n.player.immuneToDisruptThisTurn=!0,y(n,"ì´ë²ˆ í„´ êµëž€ ë¬´ì‹œ");break;case"nullifyDamageThisTurn":n.player.nullifyDamageThisTurn=!0,y(n,"ì´ë²ˆ í„´ ì  ê³µê²© í”¼í•´ ë¬´íš¨");break;case"triggerFrontOfBackSlot":{const o=n.backSlots[r.index];if(!o){y(n,`ìž¬ë°°ì¹˜: í›„ì—´ ${r.index+1}ë²ˆ ìŠ¬ë¡¯ì´ ë¹„ì–´ ìžˆìŒ`);break}const a=Ae(n,o);y(n,`ìž¬ë°°ì¹˜: [[${Ze(n,o)}]]ì˜ ì „ì—´ íš¨ê³¼ë¥¼ ì¶”ê°€ ë°œë™`),at({game:n,side:"front",cardUid:o},a.front);break}case"addCardToHand":{const o=r.defId,a=n.content.cardsById[o];if(!a){y(n,`WARN: addCardToHand unknown defId: ${o}`);break}const s=Math.max(1,Number(r.n??1)|0),i=Math.max(0,Number(r.upgrade??0)|0);for(let l=0;l<s;l++){n.uidSeq+=1;const c=String(n.uidSeq);n.cards[c]={uid:c,defId:o,zone:"hand",upgrade:i},n.hand.push(c)}y(n,`ì†íŒ¨ì— [${a.name}${i>0?" +"+i:""}] ${s}ìž¥ ì¶”ê°€`);break}default:return r}}function Zo(e){if(e.run.treasureObtained)return;e.run.treasureObtained=!0,e.run.afterTreasureNodePicks=0,e.run.deckSizeAtTreasure=Pr(e);const t=$r(e);e.cards[t]={uid:t,defId:"goal_treasure",zone:"deck",upgrade:0},e.deck.push(t),e.deck=_n(e.deck),y(e,"ì €ì£¼ë°›ì€ ë³´ë¬¼ì„ íšë“í–ˆìŠµë‹ˆë‹¤! ë±ì— [ì €ì£¼ë°›ì€ ë³´ë¬¼] ì¶”ê°€. ì´ì œ ìž…êµ¬(START)ë¡œ ëŒì•„ê°€ íƒˆì¶œí•˜ì„¸ìš”!"),Jo(e),y(e,"ë³´ë¬¼ì´ ìš¸ë¶€ì§–ìž, ë˜ì „ì˜ ëª¨ë“  ë°©ì´ ë‹¤ì‹œ ì±„ì›Œì§‘ë‹ˆë‹¤...")}function Jo(e){const t=e.run?.map;if(!t||!t.nodes)return;const n=t.startId,r=t.treasureId,o=Object.keys(t.nodes);for(const a of o){if(a===n||a===r)continue;const s=t.nodes[a];if(!s)continue;s.cleared=!1,delete s.noRespawn,delete s.lastClearedMove,s.reprocCount=Number(s.reprocCount??0)+1;const i=Number(s.depth??0);if(s.kind==="ELITE"||s.kind==="START"||s.kind==="TREASURE")continue;const l=Math.min(.8,.68+i*.01),c=.18,m=Math.random();s.kind=m<l?"BATTLE":m<l+c?"EVENT":"REST"}}const wr=["arrow","shield","scout","field_ration"],$e=[{id:"mad_echo",weight:12},{id:"mad_insight",weight:12},{id:"mad_bargain",weight:3}],We=[{id:"berserk",weight:20},{id:"bandage",weight:12},{id:"arrow_rain",weight:20},{id:"smoke",weight:0},{id:"redeploy",weight:12},{id:"secret_strike",weight:3},{id:"fire_scroll",weight:3},{id:"caltrops",weight:12},{id:"emergency_rations",weight:3},{id:"painkiller",weight:12},{id:"field_experience",weight:3},{id:"camp_prep",weight:20},{id:"vital_shot",weight:12},{id:"taunt",weight:12},{id:"rapid_fire",weight:20},{id:"blood_contract",weight:20},{id:"cloth_scrap_armor",weight:12},{id:"prey_mark",weight:12},{id:"brawl_cleaver",weight:20},{id:"install_ballista",weight:20},{id:"install_iron_bulwark",weight:20},{id:"install_cursed_banner",weight:12},{id:"scribe_hand",weight:12},{id:"install_scriptorium",weight:3}];function Be(e,t,n){const r=n?Mn(t,n):In(t);return{defId:Pt(r),upgrade:t===$e?0:Rt(e)}}function gt(e,t,n){const r=n?Mn(t,n):In(t),o=Pt(r),a=r.filter(m=>m.id!==o),s=Pt(a),i=t===$e,l=i?0:Rt(e),c=i?0:Rt(e);return[{defId:o,upgrade:l},{defId:s,upgrade:c}]}function _r(e){const{tier:t}=br(e);return Math.random()<(t===0?0:t===1?.15:t===2?.35:.6)}function In(e){const t=new Map;for(const n of e){const r=Math.max(0,n.weight??0);r<=0||t.set(n.id,(t.get(n.id)??0)+r)}return[...t.entries()].map(([n,r])=>({id:n,w:r}))}function Mn(e,t={}){const n=t.mult3??1,r=t.mult12??1,o=t.mult20??1,a=new Map;for(const s of e){const i=Math.max(0,s.weight??0);if(i<=0||i===3&&t.drop3||i===12&&t.drop12||i===20&&t.drop20)continue;let l=null;i===3?l=i*n:i===12?l=i*r:i===20?l=i*o:l=i,!(l<=0)&&a.set(s.id,(a.get(s.id)??0)+l)}return[...a.entries()].map(([s,i])=>({id:s,w:i}))}function Pt(e){let t=0;for(const r of e)t+=r.w;if(t<=0)throw new Error("No positive weights to pick from.");let n=Math.random()*t;for(const r of e)if(n-=r.w,n<=0)return r.id;return e[e.length-1].id}function Rt(e){const t=e?.player?.fatigue??0;if((e?.run.nodePickCount??999)<=6)return 0;const r=.1,o=t>=12?0:t>=9?.25:t>=6?.5:1;return Math.random()<r*o?1:0}function ea(e){const t=e.player?.fatigue??0,n={defId:ce(wr),upgrade:0},r=()=>t<=3?gt(e,We):t<=6?gt(e,We,{mult3:.25,mult12:.75,mult20:1}):t<=8?gt(e,We,{mult3:.1,mult12:.55,mult20:1}):gt(e,We,{drop3:!0,mult12:.45,mult20:1}),o=i=>_r(e)?Be(e,$e):i;if(t<=8){if(t<=6){const[m,u]=r();return[o(m),o(u)]}const i=t===7?.3:.55;if(Math.random()<i){const[m]=r(),u=o(m);return Math.random()<.5?[n,u]:[u,n]}const[l,c]=r();return[o(l),o(c)]}if(t<=11){const i=o(Be(e,We,{drop3:!0,mult12:.45,mult20:1}));return Math.random()<.5?[n,i]:[i,n]}const a=Be(e,$e),s=Math.random()<.65?Be(e,$e):n;return Math.random()<.5?[a,s]:[s,a]}function ta(e,t,n,r){const o=[];let a=r?Mn(t,r):In(t);const s=t===$e;for(let i=0;i<n&&!(a.length<=0);i++){const l=Pt(a);o.push({defId:l,upgrade:s?0:Rt(e)}),a=a.filter(c=>c.id!==l)}return o}function na(e,t){const n=e.content.cardsById[t]?.rarity;return n==="SPECIAL"||n==="RARE"}function ra(e,t){if(t==="BOSS")return{drop12:!0,drop20:!0};if(t==="ELITE")return{mult3:2.7,mult12:1.8,mult20:.8};const n=Math.max(0,Math.min(10,Number(e.run.rewardPityNonElite??0)||0)),r=1+n*.18,o=1+n*.3,a=Math.max(.65,1-n*.04);return{mult3:o,mult12:r,mult20:a}}function oa(e,t){const n=e.player?.fatigue??0,r={defId:ce(wr),upgrade:0},o=()=>{const l=ra(e,t);return ta(e,We,3,l)},a=l=>t==="BOSS"||!_r(e)?l:Be(e,$e);let s=o();for(;s.length<3;)s.push({defId:"arrow",upgrade:0});if(n>=12){const l=Be(e,$e),c=Be(e,$e),m=Math.random()<.55?Be(e,$e):r;s=[l,c,m]}else if(n>=9){const l=Math.floor(Math.random()*3);s[l]=r,s=s.map(a)}else if(n>=7){const l=n===7?.25:.45;if(Math.random()<l){const c=Math.floor(Math.random()*3);s[c]=r}s=s.map(a)}else s=s.map(a);return s.some(l=>na(e,l.defId))?e.run.rewardPityNonElite=0:t==="BATTLE"&&(e.run.rewardPityNonElite=(Number(e.run.rewardPityNonElite??0)||0)+1),[s[0],s[1],s[2]]}function $r(e){return e.uidSeq+=1,`c_${e.uidSeq}`}function bt(e,t,n){const r=$r(e);e.cards[r]={uid:r,defId:t,zone:"deck",upgrade:n?.upgrade??0},e.deck.push(r)}function aa(e){const t=Object.values(e.cards).filter(r=>r.zone==="deck"||r.zone==="hand"||r.zone==="discard");if(t.length===0)return;const n=ce(t);e.cards[n.uid].zone="vanished",e.vanished.push(n.uid),e.deck=e.deck.filter(r=>r!==n.uid),e.hand=e.hand.filter(r=>r!==n.uid),e.discard=e.discard.filter(r=>r!==n.uid),y(e,`ì¹´ë“œ ì œê±°: [${Ae(e,n.uid).name} +${e.cards[n.uid].upgrade??0}]`)}const sa="goal_treasure";function kt(e,t){const n=e.cards[t];return n?n.defId===sa?(y(e,"ì €ì£¼ë°›ì€ ë³´ë¬¼ì€ ë±ì—ì„œ ì œê±°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."),!1):(e.deck=e.deck.filter(r=>r!==t),e.hand=e.hand.filter(r=>r!==t),e.discard=e.discard.filter(r=>r!==t),e.frontSlots=e.frontSlots.map(r=>r===t?null:r),e.backSlots=e.backSlots.map(r=>r===t?null:r),n.zone="vanished",e.vanished.push(t),y(e,`ì¹´ë“œ ì œê±°: [${Ae(e,n.uid).name} +${e.cards[n.uid].upgrade??0}]`),!0):!1}function jt(e,t){const n=e.cards[t];if(!n)return!1;const o=e.content.cardsById[n.defId].upgrades?.length??0;return(n.upgrade??0)<o}function hn(e,t){return jt(e,t)?(e.cards[t].upgrade=(e.cards[t].upgrade??0)+1,!0):!1}function Pn(e,t,n=null){if(e.choiceQueue??=[],!e.choice){e.choice=t,e.choiceCtx=n;return}e.choiceQueue.push({choice:t,ctx:n})}function st(e,t,n=null){e.choiceQueue=[],e.choice=t,e.choiceCtx=n}function Nr(e){e.choice=null,e.choiceCtx=null}function ke(e){e.choiceQueue=[],Nr(e),e.phase==="NODE"&&fe(e)}function ye(e){const t=e.choiceQueue??[];if(t.length>0){const n=t.shift()??null;if(n){e.choice=n.choice,e.choiceCtx=n.ctx,e.choiceQueue=t;return}}Nr(e),e.phase==="NODE"&&fe(e)}function ia(e){const t=new Set(e.run.relics??[]);return Object.keys(oe).filter(n=>{const r=oe[n];return!(!r||r.debugOnly||(Array.isArray(r.tags)?r.tags:[]).includes("EVENT_ONLY")||t.has(n))})}function Ar(e,t=1){const n=ia(e);if(n.length===0)return null;const r=[],o=n.slice(),a=Math.min(t,o.length);for(let s=0;s<a;s++){const i=ce(o),l=o.indexOf(i);l>=0&&o.splice(l,1);const c=oe[i]??{};r.push({id:i,name:c.name??String(i),desc:c.desc??c.description??c.text,art:c.art})}return{choices:r}}const Ir=2;function ct(e){const t=e.run;t.items||(t.items=[]),t.itemCap==null&&(t.itemCap=Ir)}function la(e){return ct(e),e.run.items??[]}function Rn(e){ct(e);const t=Number(e.run.itemCap);return Number.isFinite(t)?Math.max(0,Math.floor(t)):Ir}function Yn(e){return la(e).length>=Rn(e)}function yn(e,t,n=""){ct(e);const r=Te(t);if(!r)return y(e,`ì•„ì´í…œ íšë“ ì‹¤íŒ¨(ì •ì˜ ì—†ìŒ): ${t}`),!1;const o=Rn(e),a=e.run.items;return a.length>=o?(y(e,`ì•„ì´í…œ íšë“ ì‹¤íŒ¨(ê°€ë°© ê°€ë“ ì°¸ ${a.length}/${o}): ${r.name}`),me(e,"WARN",`ì•„ì´í…œ ê°€ë°©ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤. (${a.length}/${o})`,1600),!1):(a.push(t),y(e,`ì•„ì´í…œ íšë“${n?`(${n})`:""}: ${r.name}`),me(e,"INFO",`${r.name} íšë“`,1600),!0)}function Mr(e,t){ct(e);const n=e.run.items;if(!Array.isArray(n)||t<0||t>=n.length)return null;const[r]=n.splice(t,1);return r??null}function ca(e,t,n=""){ct(e);const r=e.run.items;if(!Array.isArray(r)||r.length===0||t<0||t>=r.length)return!1;const o=String(r[t]),a=Te(o);return Mr(e,t),y(e,`ì•„ì´í…œ ë²„ë¦¼${n?`(${n})`:""}: ${a?.name??o}`),me(e,"WARN",`${a?.name??o} ë²„ë¦¼`,1400),!0}function da(e,t){ct(e);const n=e.run.items;if(!Array.isArray(n)||n.length===0||t<0||t>=n.length)return!1;if(!(e.enemies.length>0&&e.phase!=="NODE"))return me(e,"WARN","ì „íˆ¬ ì¤‘ì—ë§Œ ì•„ì´í…œì„ ì‚¬ìš©í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.",1400),!1;const o=n[t],a=Te(o);return a?(at({game:e,side:"front",cardUid:"",sourceLabel:`ì•„ì´í…œ: ${a.name}`,reason:"OTHER"},a.effects??[]),Mr(e,t)&&(y(e,`ì•„ì´í…œ ì‚¬ìš©: ${a.name} (ì†Œëª¨)`),me(e,"INFO",`${a.name} ì‚¬ìš©`,1400)),!0):(me(e,"WARN",`ì•„ì´í…œ ì •ì˜ ì—†ìŒ: ${o}`,1400),!1)}function ua(e,t){const n=e.run;if(n.itemOfferedThisBattle||t.boss)return null;const r=t.elite?.4:.3;if(Math.random()>=r)return null;const o=So();return o?(n.itemOfferedThisBattle=!0,o):null}function pa(e,t){const n=e.run.lastBattleWasBoss?"BOSS":e.run.lastBattleWasElite?"ELITE":"BATTLE",r=oa(e,n);if(!r)return;const[o,a,s]=r,i=pe(e.content,o.defId,o.upgrade),l=pe(e.content,a.defId,a.upgrade),c=pe(e.content,s.defId,s.upgrade),m=`${i.name}${o.upgrade>0?` +${o.upgrade}`:""}`,u=`${l.name}${a.upgrade>0?` +${a.upgrade}`:""}`,d=`${c.name}${s.upgrade>0?` +${s.upgrade}`:""}`,b={kind:"REWARD",title:"ì „íˆ¬ ë³´ìƒ",prompt:"ì¹´ë“œ 1ìž¥ì„ ì„ íƒí•˜ê±°ë‚˜ ìƒëžµí•©ë‹ˆë‹¤.",options:[{key:`pick:${o.defId}:${o.upgrade}`,label:m,detail:`ì „ì—´: ${i.frontText} / í›„ì—´: ${i.backText}`},{key:`pick:${a.defId}:${a.upgrade}`,label:u,detail:`ì „ì—´: ${l.frontText} / í›„ì—´: ${l.backText}`},{key:`pick:${s.defId}:${s.upgrade}`,label:d,detail:`ì „ì—´: ${c.frontText} / í›„ì—´: ${c.backText}`},{key:"skip",label:"ìƒëžµ",detail:""}]},E=t?.itemOfferId,p=t?.itemSource??"BATTLE";Pn(e,b,{kind:"BATTLE_REWARD",offers:[o,a,s],itemOfferId:E,itemSource:p,cardDecision:void 0,itemDecision:void 0})}function fa(e){if(!e.run.lastBattleWasElite||e.run.eliteRelicOfferedThisBattle)return;const t=Ar(e,1);if(!t)return;e.run.eliteRelicOfferedThisBattle=!0;const n=t.choices[0];if(!n)return;const r=n.id,o=oe[r],a=!!o?.unlock,s=a?o?.dormantName??o?.name??r:o?.name??r,i=a?[o?.dormantText,o?.unlockHint].filter(Boolean).join(`
 
`):o?.text??"",c={kind:"REWARD",title:"ì •ì˜ˆ ë³´ìƒ: ìœ ë¬¼",prompt:"ìœ ë¬¼ì„ ë°›ê±°ë‚˜ ìƒëžµí•©ë‹ˆë‹¤.",options:[{key:"take",label:"ë°›ê¸°",detail:`${s}

${i}`},{key:"skip",label:"ìƒëžµ",detail:""}]};c.art=o?.art??void 0,Pn(e,c,{kind:"ELITE_RELIC",offerIds:[r]})}function ma(e,t){if(!e.choice)return!1;{const r=e.choiceCtx;if(r?.kind==="BATTLE_REWARD"||r?.kind==="BATTLE_CARD_REWARD"){const o=String(r.itemOfferId??"");if(t==="take_item")return!o||r.itemDecision||!yn(e,o,String(r.itemSource??"BATTLE"))||(r.itemDecision="TAKEN",r.cardDecision&&ye(e)),!0;if(t==="skip_item")return!o||r.itemDecision||(y(e,"ì•„ì´í…œ ë³´ìƒì„ ìƒëžµí–ˆìŠµë‹ˆë‹¤."),r.itemDecision="SKIPPED",r.cardDecision&&ye(e)),!0}}if(t==="take"){const r=e.choiceCtx;if(r?.kind==="ELITE_RELIC"){const o=r.offerIds?.[0];return o?(e.run.relics??=[],e.run.relics.includes(o)||Mt(e,o),y(e,`ìœ ë¬¼ íšë“: ${oe[o]?.name??o}`),ye(e),!0):!1}if(r?.kind==="ITEM_REWARD"){const o=String(r.offerId??"");return o?(yn(e,o,String(r.source??"BATTLE"))&&ye(e),!0):!1}return!1}if(t==="skip"){const r=e.choiceCtx,o=r?.kind==="BATTLE_REWARD"||r?.kind==="BATTLE_CARD_REWARD",a=String(r?.itemOfferId??"");return o&&a?(r.cardDecision||(y(e,"ì¹´ë“œ ë³´ìƒì„ ìƒëžµí–ˆìŠµë‹ˆë‹¤."),r.cardDecision="SKIPPED",r.itemDecision&&ye(e)),!0):(y(e,"ë³´ìƒì„ ìƒëžµí–ˆìŠµë‹ˆë‹¤."),ye(e),!0)}if(t.startsWith("pick:")){const r=t.split(":"),o=r[1]??"",a=Number(r[2]??0);if(!o)return!1;const s=e.choiceCtx,i=s?.kind==="BATTLE_REWARD"||s?.kind==="BATTLE_CARD_REWARD",l=String(s?.itemOfferId??"");return i&&l?(s.cardDecision||(bt(e,o,{upgrade:Number.isFinite(a)?a:0}),y(e,"ì¹´ë“œ íšë“: "+o+(a>0?" +"+a:"")),s.cardDecision=t,s.itemDecision&&ye(e)),!0):(bt(e,o,{upgrade:Number.isFinite(a)?a:0}),y(e,"ì¹´ë“œ íšë“: "+o+(a>0?" +"+a:"")),ye(e),!0)}if(t.startsWith("up:")){const r=t.slice(3);if(!r)return!1;const o=e.cards[r];if(!o)return!1;const s=e.content.cardsById[o.defId]?.upgrades??[],i=o.upgrade??0;if(i>=s.length)return y(e,"ì´ë¯¸ ìµœëŒ€ ê°•í™”ìž…ë‹ˆë‹¤."),ye(e),!0;o.upgrade=i+1;const l=pe(e.content,o.defId,o.upgrade);return y(e,`ì¹´ë“œ ê°•í™”: ${l.name} +${o.upgrade}`),ye(e),!0}if(t.startsWith("remove:")){const r=t.slice(7);return!r||!kt(e,r)?!1:(ye(e),!0)}if(t.startsWith("relic:")){const r=t.slice(6);if(!r)return!1;const o=e.choiceCtx?.offerIds;return o&&o.length>0&&!o.includes(r)?!1:(e.run.relics??=[],e.run.relics.includes(r)||Mt(e,r),y(e,`ìœ ë¬¼ íšë“: ${oe[r]?.name??r}`),ye(e),!0)}return!1}function ha(e,t){const n=Ar(e,t.count);if(!n||n.choices.length===0)return null;const r=n.choices.map(s=>s.id),o=n.choices.map(s=>{const i=oe[s.id],l=!!i?.unlock,c=l?i?.dormantName??i?.name??s.id:i?.name??s.id,m=l?[i?.dormantText,i?.unlockHint].filter(Boolean).join(`
 
`):i?.text??"";return{key:`relic:${s.id}`,label:c,detail:`${c}

${m}`}}),a={kind:"REWARD",title:t.title,prompt:t.prompt,options:o};{const s=String(t.artKeyOrPath),i=s.includes("/")||s.includes("\\")||s.includes(".")?s:`assets/ui/${s}.png`;a.art=i}return Pn(e,a,{kind:"RELIC_OFFER",offerIds:r,source:t.source}),r}function ya(e){return ha(e,{count:3,title:"ë³´ìŠ¤ ë³´ìƒ: ìœ ë¬¼",prompt:"ìœ ë¬¼ 1ê°œë¥¼ ì„ íƒí•©ë‹ˆë‹¤.",source:"BOSS",artKeyOrPath:"what_to_do"})}const Xn=(e,t)=>e+Math.floor(Math.random()*(t-e+1)),ba=e=>{switch(e){case"SPECIAL":return 20;case"RARE":return 30;default:return 10}};function ka(e,t){const n=e.run;n.shops??={};const r=n.shops[t];if(r)return r;const o=We.filter(d=>(d.weight??0)>0).map(d=>d.id),a=(o.length>0?o:Object.keys(e.content.cardsById)).filter(d=>{const E=e.content.cardsById[d]?.rarity??"COMMON";return E!=="BASIC"&&E!=="MADNESS"}),s=[],i=6;let l=0;for(;s.length<i&&l++<200;){const d=a[Math.floor(Math.random()*a.length)];d&&(s.includes(d)&&Math.random()<.8||s.push(d))}const c=s.map(d=>{const E=e.content.cardsById[d]?.rarity??"COMMON",p=Math.max(1,ba(E)+Xn(-2,2));return{defId:d,upgrade:0,priceGold:p,sold:!1}}),m=(()=>{const d=mt.map(f=>f.id),b=2,E=[];let p=0;for(;E.length<b&&p++<80&&d.length>0;){const f=d[Math.floor(Math.random()*d.length)];f&&(E.includes(f)&&Math.random()<.85||E.push(f))}return E.map(f=>{const h=Te(f),x=Number(h?.priceGold??18)||18,k=Math.max(1,x+Xn(-2,2));return{itemId:f,priceGold:k,sold:!1}})})(),u={nodeId:t,cards:c,items:m,usedUpgrade:!1,usedRemove:!1,createdAtMove:Number(e.run.timeMove??0)||0,art:"assets/ui/background/shop_bg.png"};return n.shops[t]=u,u}function ee(e,t){const n=ka(e,t),r=[];let o=0;for(let l=0;l<n.cards.length;l++){const c=n.cards[l],u=e.content.cardsById[c.defId]?.name??c.defId,d=(c.upgrade??0)>0?` +${c.upgrade}`:"";if(c.sold){r.push({key:`shop:card:${l}`,label:`${u}${d} (í’ˆì ˆ)`,detail:""});continue}const b=pe(e.content,c.defId,c.upgrade??0),E=`ê°€ê²©: ðŸª™${c.priceGold}

ì „ì—´: ${b.frontText}
í›„ì—´: ${b.backText}`;r.push({key:`shop:card:${l}`,label:`${u}${d} (ðŸª™${c.priceGold})`,detail:E})}if(r.push({key:`shop:sep:${o++}`,label:"â€”",detail:""}),n.items&&n.items.length>0){for(let l=0;l<n.items.length;l++){const c=n.items[l],m=Te(c.itemId),u=m?.name??c.itemId;if(c.sold){r.push({key:`shop:item:${l}`,label:`${u} (í’ˆì ˆ)`,detail:""});continue}const d=`ê°€ê²©: ðŸª™${c.priceGold}

${m?.text??""}`;r.push({key:`shop:item:${l}`,label:`${u} (ðŸª™${c.priceGold})`,detail:d})}r.push({key:`shop:sep:${o++}`,label:"â€”",detail:""})}const a=n.usedUpgrade?"ì¹´ë“œ ê°•í™” (ì‚¬ìš© ì™„ë£Œ)":"ì¹´ë“œ ê°•í™”",s=n.usedRemove?"ì¹´ë“œ ì œê±° (ì‚¬ìš© ì™„ë£Œ)":"ì¹´ë“œ ì œê±°";r.push({key:"shop:service:upgrade",label:a,detail:n.usedUpgrade?"":"ê°€ê²©: ðŸª™25 ì¹´ë“œ 1ìž¥ì„ ê°•í™”í•©ë‹ˆë‹¤."}),r.push({key:"shop:service:remove",label:s,detail:n.usedRemove?"":"ê°€ê²©: ðŸª™25 ë±ì—ì„œ ì¹´ë“œ 1ìž¥ì„ ì œê±°í•©ë‹ˆë‹¤."}),r.push({key:"shop:supply:buy",label:"ë³´ê¸‰ êµ¬ë§¤",detail:"-ðŸª™6, ë‹¤ìŒ ì „íˆ¬ ë³´ê¸‰ ðŸž +3"}),r.push({key:"shop:supply:sell",label:"ë³´ê¸‰ íŒë§¤",detail:"ë‹¤ìŒ ì „íˆ¬ ë³´ê¸‰ ðŸž -3, +ðŸª™4"}),r.push({key:"shop:leave",label:"ë‚˜ê°€ê¸°",detail:""});{const l=new Set,c=[];for(const m of r)l.has(m.key)&&c.push(m.key),l.add(m.key);c.length&&y(e,`ê²½ê³ : ìƒì  ì„ íƒí‚¤ ì¤‘ë³µ: ${c.join(", ")}`)}const i={kind:"EVENT",title:"ê³ ë¸”ë¦°ì˜ ìƒì ",prompt:"ì˜¨ê±´íŒŒ ê³ ë¸”ë¦°ì˜ ìƒì ìž…ë‹ˆë‹¤.",options:r};n.art&&(i.art=n.art),e.choiceQueue=[],e.choiceStack=[],e.choice=i,e.choiceCtx={kind:"SHOP",nodeId:t},n.art&&(i.art=n.art)}function Ta(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}function va(e){const t=[];for(const s of e.deck)t.push(s);for(const s of e.hand)t.push(s);for(const s of e.discard)t.push(s);for(const s of e.frontSlots)s&&t.push(s);for(const s of e.backSlots)s&&t.push(s);for(const s of e.exhausted)t.push(s);const n=new Set;let r=t.filter(s=>n.has(s)?!1:(n.add(s),!0));const o=r.filter(s=>{const i=e.cards[s];return i?!!e.content.cardsById[i.defId]?.tags?.includes("TOKEN"):!1});if(o.length>0){const s=new Set(o);r=r.filter(i=>!s.has(i));for(const i of o)delete e.cards[i]}const a=r.filter(s=>e.cards[s]?.zone!=="vanished");e.deck=a;for(const s of a)e.cards[s].zone="deck";e.hand=[],e.discard=[],e.frontSlots=[null,null,null],e.backSlots=[null,null,null],e.selectedHandCardUid=null,e.exhausted=[],e.pendingTarget=null,e.pendingTargetQueue=[],Ta(e.deck)}function xa(e){if(!e.winHooksAppliedThisCombat){e.winHooksAppliedThisCombat=!0;for(const t of e.backUidsThisTurn){if(!e.cards[t])continue;const o=Ae(e,t).onWinWhileInBack;!o||o.length===0||at({game:e,side:"back",cardUid:t},o)}}}function it(e){if(e.player.hp<=0){nr(e),e.run.finished=!0,y(e,"íŒ¨ë°°: ì£½ì—ˆìŠµë‹ˆë‹¤.");return}if(!e.victoryResolvedThisCombat&&re(e).length===0&&e.phase!=="NODE"){e.victoryResolvedThisCombat=!0;const t=!!e.run.lastBattleWasBoss;nr(e),xa(e),y(e,"ì ì„ ëª¨ë‘ ì²˜ì¹˜!");{const o=e.run.map;o&&o.nodes&&o.pos&&o.nodes[o.pos]&&(o.nodes[o.pos].cleared=!0,o.nodes[o.pos].visited=!0)}if(e.run.lastBattleWasElite){const o=ve(e);o.eliteWins+=1,ge(e)}{const o=e.run,a=Number(o.gold??0)||0,s=Number(o.timeMove??0)+(e.time??0);let l=3+Math.min(3,Math.floor(Math.max(0,s)/15))*2;e.run.lastBattleWasElite&&(l+=10),t&&(l+=30);const c=Number(o.pendingEventWinGold??0)||0;c!==0&&(l+=c,o.pendingEventWinGold=0),l!==0&&(o.gold=a+l,y(e,`ì „íˆ¬ ë³´ìƒ: ðŸª™${l}`),me(e,"GOLD",`ðŸª™ +${l}`,1600))}va(e),e.enemies=[],e.player.zeroSupplyTurns=0;{const o=e.run,a=o.pendingEventWinRelicId;a&&(o.pendingEventWinRelicId=null,Mt(e,a,"EVENT"))}Et(e,"onVictory"),t&&(e.run.ominousProphecyLockedUntilBossKill=!1,e.run.ominousProphecySeen=!1,e.player.hp=e.player.maxHp,y(e,"ë³´ìŠ¤ ê²©íŒŒ! ì²´ë ¥ì´ ì™„ì „ížˆ íšŒë³µë˜ì—ˆìŠµë‹ˆë‹¤."),ya(e)),fa(e);const n=t?"BOSS":e.run.lastBattleWasElite?"ELITE":"BATTLE",r=ua(e,{elite:!!e.run.lastBattleWasElite,boss:!!t});pa(e,{itemOfferId:r??void 0,itemSource:n}),e.phase="NODE";return}}function Pr(e){return e.deck.length+e.hand.length+e.discard.length+e.frontSlots.filter(Boolean).length+e.backSlots.filter(Boolean).length+e.exhausted.length}function ut(e){e.combatTurn=1,e.time=(e.time??0)+1,y(e,"ì „íˆ¬: ì‹œê°„ +1"),e.player.block=0,e.player.status.vuln=0,e.player.status.weak=0,e.player.status.bleed=0,e.player.status.disrupt=0,e.player.zeroSupplyTurns=0,e.phase="REVEAL",e.frontSlots=[null,null,null],e.backSlots=[null,null,null],e.backSlotDisabled=[!1,!1,!1],e.backUidsThisTurn=[],e.hand=[],e.selectedHandCardUid=null,e.pendingTarget=null,e.pendingTargetQueue=[],e.usedThisTurn=0,e.frontPlacedThisTurn=0,e.winHooksAppliedThisCombat=!1,e.victoryResolvedThisCombat=!1,e.run.eliteRelicOfferedThisBattle=!1,e.run.itemOfferedThisBattle=!1;const t=e.run.nextBattleSuppliesBonus??0;e.player.supplies=Math.max(0,7+t),t!==0&&(y(e,`ë‹¤ìŒ ì „íˆ¬ S ë³€ë™: ${t}`),e.run.nextBattleSuppliesBonus=0),e.player.immuneToDisruptThisTurn=!1,e.player.nullifyDamageThisTurn=!1,e.intentsRevealedThisTurn=!1,e.disruptIndexThisTurn=null,e.drawCountThisTurn=0,e.attackedEnemyIndicesThisTurn=[],Lt(e,4),An(e),e.phase="PLACE",Et(e,"onCombatStart");{const n=Number(e._combatStartExtraDraw??0);e._combatStartExtraDraw=0,n>0&&Lt(e,n)}}function Qn(e,t,n,r){if(e.phase!=="PLACE"||!e.hand.includes(t))return;n==="back"&&(e.backUidsThisTurn.includes(t)||e.backUidsThisTurn.push(t));const o=n==="front"?e.frontSlots:e.backSlots;o[r]||(e.hand=e.hand.filter(a=>a!==t),o[r]=t,e.cards[t].zone=n,e.usedThisTurn+=1,n==="front"&&(e.frontPlacedThisTurn+=1),e.placedUidsThisTurn??=[],e.placedUidsThisTurn.includes(t)||e.placedUidsThisTurn.push(t),y(e,`[${Ze(e,t)}]ë¥¼ ${n==="front"?"ì „ì—´":"í›„ì—´"} ${r}ë²ˆì— ë°°ì¹˜`),Et(e,"onPlaceCard",{side:n,idx:r,cardUid:t}))}function Zn(e,t,n){return Ae(e,t).tags?.includes(n)??!1}function Ca(e,t){e.frontSlots=e.frontSlots.map(n=>n===t?null:n),e.backSlots=e.backSlots.map(n=>n===t?null:n)}function Jn(e,t,n){const r=Ae(e,t);Ca(e,t),e.hand=e.hand.filter(l=>l!==t),e.deck=e.deck.filter(l=>l!==t),e.discard=e.discard.filter(l=>l!==t);const o=r.vanishWhen,a=r.exhaustWhen,s=o==="BOTH"||o==="FRONT"&&n==="front"||o==="BACK"&&n==="back",i=a==="BOTH"||a==="FRONT"&&n==="front"||a==="BACK"&&n==="back";if(o&&o!=="NONE"&&s){e.vanished.push(t),e.cards[t].zone="vanished",y(e,`[${Ze(e,t)}] ì†Œì‹¤(ì˜êµ¬ ì œê±°)`);return}if(a&&a!=="NONE"&&i){e.exhausted.push(t),e.cards[t].zone="exhausted",y(e,`[${Ze(e,t)}] ì†Œëª¨(ì´ë²ˆ ì „íˆ¬ì—ì„œ ì œê±°)`);return}if(!o&&Zn(e,t,"VANISH")){e.vanished.push(t),e.cards[t].zone="vanished",y(e,`[${Ze(e,t)}] ì†Œì‹¤(ì˜êµ¬ ì œê±°)`);return}if(!a&&Zn(e,t,"EXHAUST")){e.exhausted.push(t),e.cards[t].zone="exhausted",y(e,`[${Ze(e,t)}] ì†Œëª¨(ì´ë²ˆ ì „íˆ¬ì—ì„œ ì œê±°)`);return}e.discard.push(t),e.cards[t].zone="discard"}function er(e,t,n){const r=Ae(e,t);if(!r.tags?.includes("INSTALL"))return!1;const o=r.installWhen;return!o||o==="BOTH"?!0:o==="FRONT"?n==="front":o==="BACK"?n==="back":!1}function Ea(e,t=!1){for(let n=0;n<3;n++){const r=e.frontSlots[n];r?!t&&er(e,r,"front")||(Jn(e,r,"front"),e.frontSlots[n]=null):e.frontSlots[n]=null;const o=e.backSlots[n];o?!t&&er(e,o,"back")||(Jn(e,o,"back"),e.backSlots[n]=null):e.backSlots[n]=null}}function ga(e){if(!(e.phase!=="PLACE"&&e.phase!=="BACK")){e.phase="BACK",y(e,"=== í›„ì—´ ë‹¨ê³„ ===");for(let t=0;t<3;t++){const n=e.backSlots[t];if(!n)continue;const r=Ae(e,n);if(!e.player.immuneToDisruptThisTurn&&e.backSlotDisabled[t]){y(e,`í›„ì—´ ${t}ë²ˆ [${r.name}] êµëž€ìœ¼ë¡œ ë¬´íš¨`);continue}at({game:e,side:"back",cardUid:n},r.back)}e.phase="FRONT"}}function Sa(e){if(e.phase==="FRONT"){y(e,"=== ì „ì—´ ë‹¨ê³„ ===");for(let t=0;t<3;t++){const n=e.frontSlots[t];if(!n)continue;const r=Ae(e,n);at({game:e,side:"front",cardUid:n},r.front)}e.phase="ENEMY"}}const wa=.6;function _a(e){if(e.phase==="ENEMY"){y(e,"=== ì  í–‰ë™ ===");for(const t of re(e)){const n=e.content.enemiesById[t.id],r=n.intents[t.intentIndex%n.intents.length];if(t.id==="boss_soul_stealer"){if(t.soulWillNukeThisTurn){const o=t.status.weak??0;Ce(e,50,"ENEMY_ATTACK","ì˜í˜¼ ê°•íƒˆìž",o),y(e,"ì˜í˜¼ ê°•íƒˆìž: ì˜í˜¼ í­ë°œ â†’ 50 í”¼í•´!"),t.soulWillNukeThisTurn=!1,t.soulArmed=!1,t.soulWarnCount=0;continue}for(const o of r.acts)tr(e,t,o);t.intentIndex===Go&&(t.soulWarnCount=(t.soulWarnCount??0)+1,y(e,`ì˜í˜¼ ê°•íƒˆìž: ê²½ê³  +1 (${t.soulWarnCount}/3)`),(t.soulWarnCount??0)>=3&&(t.soulArmed=!0,y(e,"ì˜í˜¼ ê°•íƒˆìž: ê²½ê³  3íšŒ ì™„ë£Œ â†’ í­ë°œ ê°€ëŠ¥ ìƒíƒœ!"),Math.random()<wa&&(t.soulWillNukeThisTurn=!0)));continue}for(const o of r.acts)tr(e,t,o)}e.phase="UPKEEP"}}function $a(e){return e.deck.length+e.hand.length+e.discard.length+e.frontSlots.filter(Boolean).length+e.backSlots.filter(Boolean).length+e.exhausted.length}function Na(e,t){const n=Math.ceil(t/e.div);let r=e.base+e.per*n;return e.cap!=null&&(r=Math.min(r,e.cap)),{dmg:r,scale:n}}function tr(e,t,n){switch(n.op){case"damagePlayer":{const r=t.status.weak??0;Ce(e,n.n,"ENEMY_ATTACK",t.name,r);return}case"damagePlayerFormula":{if(n.kind==="goblin_raider"){const r=Math.max(0,12-e.usedThisTurn),o=t.status.weak??0;Ce(e,r,"ENEMY_ATTACK",t.name,o)}else if(n.kind==="gloved_hunter"){const o=(e.player.block??0)>=4?12:6,a=t.status.weak??0;Ce(e,o,"ENEMY_ATTACK",t.name,a)}else{const r=4+e.usedThisTurn,o=t.status.weak??0;Ce(e,r,"ENEMY_ATTACK",t.name,o)}return}case"supplies":{e.player.supplies=wn(e.player.supplies+n.n,0),y(e,`ì  íš¨ê³¼: ë³´ê¸‰ S ${n.n>=0?"+":""}${n.n} (í˜„ìž¬ ${e.player.supplies})`);return}case"statusPlayer":{let r=n.n;n.key==="vuln"&&r>0&&$n(e,"relic_ratskin_charm")&&(r=Math.max(0,r-1)),yt(e.player,n.key,r,e,"ENEMY"),y(e,`ì  íš¨ê³¼: í”Œë ˆì´ì–´ ìƒíƒœ ${n.key} ${r>=0?"+":""}${r}`);return}case"enemyHealSelf":{t.hp=Math.min(t.maxHp,t.hp+n.n),y(e,`ì (${t.name})ì´(ê°€) ${n.n} íšŒë³µ (HP ${t.hp}/${t.maxHp})`);return}case"enemyImmuneThisTurn":{t.immuneThisTurn=!0,y(e,`ì (${t.name})ì´(ê°€) í”¼í•´ ë©´ì—­ ìƒíƒœê°€ ë¨`);return}case"enemyImmuneNextTurn":{t.immuneNextTurn=!0,y(e,`ì (${t.name})ì´(ê°€) ë‹¤ìŒ í„´ í”¼í•´ ë©´ì—­ ìƒíƒœê°€ ë¨`);return}case"fatiguePlayer":{e.player.fatigue=Math.max(0,e.player.fatigue+n.n),y(e,`ì  íš¨ê³¼: í”¼ë¡œ F ${n.n>=0?"+":""}${n.n} (í˜„ìž¬ ${e.player.fatigue})`);return}case"damagePlayerByDeckSize":{const r=$a(e),{dmg:o,scale:a}=Na(n,r),s=t.status.weak??0,i=Ce(e,o,"ENEMY_ATTACK",t.name,s);y(e,`ì¤‘ë ¥ í”¼í•´(ê³µì‹): base ${n.base} + per ${n.per} * ceil(${r}/${n.div})=${a} => raw ${o}, ì ìš© ${i}`);return}case"damagePlayerRampHits":{const r=Math.max(1,Number(e.combatTurn??1)),o=Math.max(1,Number(n.baseHits??1)),a=Math.max(1,Number(n.everyTurns??1));let s=o+Math.floor((r-1)/a);n.capHits!=null&&(s=Math.min(s,Math.max(1,Number(n.capHits))));const i=t.status.weak??0,l=`${t.name} (${s}íƒ€)`;for(let c=0;c<s;c++)Ce(e,n.n,"ENEMY_ATTACK",l,i);return}case"damagePlayerIfSuppliesPositive":{if((e.player.supplies??0)>0){const o=t.status.weak??0;Ce(e,n.n,"ENEMY_ATTACK",t.name,o)}else y(e,"ë®ì¹˜ê¸°: S = 0 â†’ í”¼í•´ ì—†ìŒ");break}case"damagePlayerIfSuppliesZero":{const r=e.player.supplies??0;if(r===0){const o=t.status.weak??0;Ce(e,n.n,"ENEMY_ATTACK",t.name,o)}else y(e,`ì••ë¥˜: S = ${r} â†’ í”¼í•´ ì—†ìŒ`);break}default:return n}}function Aa(e){if(e.phase!=="UPKEEP")return;y(e,"=== ìœ ì§€ë¹„ / ìƒíƒœ ì²˜ë¦¬ ===");{const r=ve(e);let o=!1;(e.player.status.weak??0)>0&&(r.endedTurnWeak+=1,o=!0),(e.usedThisTurn??0)===0&&(e.frontPlacedThisTurn??0)===0&&(e.backUidsThisTurn?.length??0)===0&&(r.skippedTurn+=1,o=!0),o&&ge(e)}const t=e.frontSlots.filter(Boolean).length;t>0&&y(e,`ì „ì—´ ìœ ì§€ë¹„ ì²˜ë¦¬: ì „ì—´ ${t}ìž¥`);{const r=e.player.supplies??0,o=Math.min(r,t);e.player.supplies=r-o;const a=t-o;a>0&&(e.player.fatigue+=a,y(e,`ì „ì—´ ìœ ì§€ë¹„ ë¶€ì¡±! (ë¶€ì¡± ${a} â†’ F +${a})`))}if(e.player.supplies===0){e.player.zeroSupplyTurns+=1;{const o=ve(e);o.endedTurnSupplyZero+=1,ge(e)}const r=e.player.fatigue;Ce(e,r,"ZERO_SUPPLY","ë³´ê¸‰ ì—†ì´ í„´ ì¢…ë£Œ! í”¼í•´ "+r)}const n=e.player.status.bleed??0;n>0&&Ce(e,n,"BLEED","ì¶œí˜ˆ");for(const r of re(e)){const o=r.status.bleed??0;o>0&&(r.immuneThisTurn?y(e,`ì (${r.name})ì€(ëŠ”) ì´ë²ˆ í„´ ë©´ì—­ì´ë¼ ì¶œí˜ˆ í”¼í•´ ë¬´ì‹œ`):(r.hp=Math.max(0,r.hp-o),y(e,`ì (${r.name}) ì¶œí˜ˆë¡œ HP -${o} (HP ${r.hp}/${r.maxHp})`)))}e.frontPlacedThisTurn=0,Ia(e),Ea(e),Je(e),it(e),Et(e,"onUpkeepEnd"),e.phase="DRAW"}function Ia(e){const t=["vuln","weak","bleed","disrupt"];for(const n of t)e.player.status[n]>0&&(e.player.status[n]-=1);for(const n of e.enemies)for(const r of t)n.status[r]>0&&(n.status[r]-=1)}function Ma(e){if(e.phase!=="DRAW"||(e.intentsRevealedThisTurn=!1,e.disruptIndexThisTurn=null,it(e),e.run.finished))return;if(re(e).length===0){Rr(e),e.phase="NODE";return}const t=e.usedThisTurn;e.usedThisTurn=0;const n=Number(e._extraDrawNextTurn??0);e._extraDrawNextTurn=0,Lt(e,t+(n>0?n:0)),e.player.block>0&&(e.player.block=0,y(e,"ë°©ì–´(ë¸”ë¡) ì†Œì‹¤")),An(e),e.phase="PLACE",e.backUidsThisTurn=[],e.attackedEnemyIndicesThisTurn=[],e.drawCountThisTurn=0,e.combatTurn=(e.combatTurn??0)+1}function Lt(e,t){let n=0;for(let r=0;r<t&&(Pa(e),!e.run.finished);r++){const o=e.deck.pop();if(!o)break;e.hand.push(o),n++}return y(e,`ë“œë¡œìš° ${n}/${t} (ì†íŒ¨ ${e.hand.length})`),n}function Pa(e){e.deck.length===0&&e.discard.length>0&&(e.deck=_n(e.discard),e.discard=[],e.player.fatigue+=1,y(e,`í”¼ë¡œë„ F +1 (ì…”í”Œ, í˜„ìž¬ ${e.player.fatigue})`))}function Rr(e){e.player.block>0&&(e.player.block=0,y(e,"ë°©ì–´(ë¸”ë¡) ì†Œì‹¤")),e.intentsRevealedThisTurn=!1,e.disruptIndexThisTurn=null}function nr(e){Rr(e)}function ae(e){return e.pendingTarget!=null||(e.pendingTargetQueue?.length??0)>0}function Ra(e,t,n){const r=Number(t.amount??0)|0,o=t.formulaKind;if(!o)return r;const a=re(e).length,s=t.aliveCountSnap,i=Number.isFinite(Number(s))?Number(s):a;switch(o){case"prey_mark":return n.hp>e.player.hp?r+5:r;case"prey_mark_u1":return n.hp>e.player.hp?r+6:r;case"triple_bounty":return i>=3?r+8:r;case"triple_bounty_u1":return i>=3?r+10:r;default:return r}}function La(e,t){if(!e.pendingTarget)return!1;if(re(e).length===0)return e.pendingTarget=null,e.pendingTargetQueue=[],e.selectedEnemyIndex=null,it(e),!0;const n=e.enemies[t];if(!n||n.hp<=0)return!1;const r=e.pendingTarget;if(r.kind==="damageSelect"){const o=Ra(e,r,n);De(e,n,o)}else if(r.kind==="statusSelect"&&(yt(n,r.key,r.n,e,"PLAYER"),r.key==="bleed"&&r.n>0)){const o=ve(e);o.bleedApplied+=1,ge(e)}return Je(e),it(e),re(e).length===0?!0:(Ba(e),!e.pendingTarget&&(e.pendingTargetQueue?.length??0)===0)}function Ba(e){const t=e.pendingTargetQueue??[],n=t.shift()??null;e.pendingTarget=n,e.pendingTargetQueue=t,e.selectedEnemyIndex=null}function Oa(e,t){t<=0||(e.player.block+=t,y(e,`ë°©ì–´(ë¸”ë¡) +${t} (í˜„ìž¬ ${e.player.block})`))}function Ha(e,t){e.player.supplies=wn(e.player.supplies+t,0),y(e,`ë³´ê¸‰ S ${t>=0?"+":""}${t} (í˜„ìž¬ ${e.player.supplies})`)}function je(e,t){e.player.fatigue=wn(e.player.fatigue+t,0),y(e,`í”¼ë¡œ F ${t>=0?"+":""}${t} (í˜„ìž¬ ${e.player.fatigue})`)}function Tt(e,t){if(t<=0)return;let n=t;$n(e,"relic_bloody_spoon")&&n>0&&(n+=1,y(e,"í”¼ ë¬»ì€ ìˆŸê°€ë½, ì¶”ê°€ íšŒë³µ +1"));const r=e.player.hp;e.player.hp=Math.min(e.player.maxHp,e.player.hp+n),y(e,`HP +${e.player.hp-r} (í˜„ìž¬ ${e.player.hp}/${e.player.maxHp})`)}function Je(e){re(e).length===0&&(e.pendingTarget=null,e.pendingTargetQueue=[],e.selectedEnemyIndex=null)}function De(e,t,n){if(n<=0)return;const r=e.enemies.indexOf(t);if(r<0){y(e,`WARN: applyDamageToEnemy target not in g.enemies (${t?.id??"?"})`);return}if(e.attackedEnemyIndicesThisTurn.includes(r)||e.attackedEnemyIndicesThisTurn.push(r),t.immuneThisTurn){y(e,`ì (${t.name})ì€(ëŠ”) ì´ë²ˆ í„´ í”¼í•´ ë©´ì—­ â†’ ${n} í”¼í•´ ë¬´ì‹œ`),Je(e);return}let o={target:"ENEMY",source:"PLAYER_ATTACK",raw:n,enemyIndex:r,enemyId:t.id},a=Ie(e,{...o,phase:"PRE_STATUS",current:n,targetVuln:t.status.vuln??0,attackerWeak:e.player.status.weak??0});const s=e.player.status.weak??0,i=t.status.vuln??0;if(a=a-s+i,a<0&&(a=0),a=Ie(e,{...o,phase:"POST_STATUS",current:a,afterStatus:a,targetVuln:i,attackerWeak:s}),a=Ie(e,{...o,phase:"FINAL",current:a,afterStatus:a,targetVuln:i,attackerWeak:s}),a<=0){y(e,`ì (${t.name})ì—ê²Œ í”¼í•´ 0 (ìœ ë¬¼/ìƒíƒœë¡œ ìƒì‡„)`),Je(e);return}const l=t.hp;if(t.hp=Math.max(0,t.hp-a),y(e,`ì (${t.name})ì—ê²Œ ${a} í”¼í•´. (HP ${t.hp}/${t.maxHp})`),l>0&&t.hp===0){const c=ve(e);c.kills+=1,ge(e)}Er(e,{...o,phase:"FINAL",current:a,afterStatus:a,targetVuln:i,attackerWeak:s},a),Je(e),re(e).length===0&&(Je(e),it(e))}function Ce(e,t,n,r,o){if(n==="ENEMY_ATTACK"&&e.player.nullifyDamageThisTurn)return y(e,`ì  ê³µê²© í”¼í•´ ë¬´íš¨ (${r??n})`),0;if(t<=0)return 0;const s={target:"PLAYER",source:n==="ENEMY_ATTACK"?"ENEMY_ATTACK":n==="FATIGUE"?"FATIGUE":"OTHER",raw:t,reason:r};let i=Ie(e,{...s,phase:"PRE_STATUS",current:t,attackerWeak:o,targetVuln:e.player.status.vuln??0});if(n==="ENEMY_ATTACK"){const l=o??0,c=e.player.status.vuln??0;if(i=i-l+c,i<0&&(i=0),i=Ie(e,{...s,phase:"POST_STATUS",current:i,afterStatus:i,attackerWeak:l,targetVuln:c}),i=Ie(e,{...s,phase:"PRE_BLOCK",current:i,afterStatus:i,attackerWeak:l,targetVuln:c}),e.player.block>0){const m=Math.min(e.player.block,i);e.player.block-=m,i-=m}i=Ie(e,{...s,phase:"POST_BLOCK",current:i,afterStatus:i,afterBlock:i,attackerWeak:l,targetVuln:c})}else i=Ie(e,{...s,phase:"POST_STATUS",current:i,afterStatus:i});if(i=Ie(e,{...s,phase:"FINAL",current:i}),i<=0)return 0;e.player.hp=Math.max(0,e.player.hp-i),y(e,`í”Œë ˆì´ì–´ ${i} í”¼í•´ (${r??n}). (HP ${e.player.hp}/${e.player.maxHp})`);{const l=ve(e);let c=!1;i>=10&&(l.tookBigHit10+=1,c=!0),e.player.hp<=15&&(l.hpLeq15+=1,c=!0),c&&ge(e)}return Er(e,{...s,phase:"FINAL",current:i},i),i}const Da=new Set(["goblin_ambush_low_supplies","rat_circle"]);function Lr(e,t){if(e.length<=1)return e[0];if(!t)return e[Math.floor(Math.random()*e.length)];const n=e.filter(o=>o.id!==t),r=n.length>0?n:e;return r[Math.floor(Math.random()*r.length)]}function Fa(e){const t=e.run,n=t.eventsSeen??{},r=bn.filter(s=>Da.has(s.id)?(Number(n[s.id]??0)||0)<=0:!0),o=r.length>0?r:bn,a=t.lastEventId??null;return Lr(o,a)}function nn(e){const{tier:t}=br(e),n=t===0?0:t===1?.25:t===2?.55:.85;return Math.random()<n?Ua(e):Fa(e)}const Br={boss_cursed_wall:"ì›€ì§ì´ì§€ ì•ŠëŠ”ë‹¤. ë‹¹ì‹ ì´ ë‹³ì•„ê°„ë‹¤.",boss_giant_orc:"ê±°ëŒ€í•œ ë¬´ì–¸ê°€ê°€ ê¸°ë‹¤ë¦°ë‹¤.",boss_soul_stealer:"í–‰ë™í•˜ì§€ ì•Šìœ¼ë©´ ì¢…ë§ì´ ì˜¨ë‹¤.",boss_gravity_master:"ëª¸ì´ ì ì  ë¬´ê²ë‹¤. ëª¸ì„ ê°€ë³ê²Œ í•˜ë¼."},Wa=[{id:"mad_mirror",name:"ê±°ìš¸ì— ìž ê¸´ ë¬¼",prompt:"ë¬¼ ì†ì˜ ë‹¹ì‹ ì´ ë¨¼ì € ì›ƒìŠµë‹ˆë‹¤.",art:"assets/events/event_mad_mirror.png",options:e=>[{key:"mad_mirror:take",label:"ì†ì„ ë„£ëŠ”ë‹¤",detail:"ì¹´ë“œ ë³´ìƒ. F +2.",apply:t=>(je(t,2),y(t,"ê±°ìš¸: ë¬´ì–¸ê°€ë¥¼ ê±´ì ¸ ì˜¬ë ¸ë‹¤. (F +2)"),"REWARD")},{key:"mad_mirror:leave",label:"ì™¸ë©´í•œë‹¤",apply:t=>(y(t,"ê±°ìš¸: ë‹¹ì‹ ì€ ë¬¼ëŸ¬ë‚¬ë‹¤."),"NONE")}]},{id:"mad_contract",name:"ì –ì€ ê³„ì•½ì„œ",prompt:"ê³°íŒ¡ì´ ëƒ„ìƒˆê°€ ë‚©ë‹ˆë‹¤.",art:"assets/events/event_mad_contract.png",options:e=>[{key:"mad_contract:sign",label:"ì„œëª…í•œë‹¤",detail:"ìµœëŒ€ HP +2. ì¹´ë“œ 1ìž¥ ì œê±° í›„ ë³´ìƒ.",apply:t=>(t.player.maxHp+=2,t.player.hp=Math.min(t.player.maxHp,t.player.hp+2),y(t,"ê³„ì•½: ìµœëŒ€ HP +2"),{kind:"REMOVE_PICK",title:"ëŒ€ê°€",prompt:"ì œê±°í•  ì¹´ë“œ 1ìž¥ì„ ì„ íƒí•˜ì„¸ìš”.",then:"REWARD"})},{key:"mad_contract:burn",label:"ì°¢ì–´ë²„ë¦°ë‹¤",detail:"F +1",apply:t=>(je(t,1),y(t,"ë¶ˆê¸¸í•¨: F +1"),"NONE")}]},{id:"mad_lullaby",name:"ìžìž¥ê°€",prompt:"ìž ë“¤ë©´ íšŒë³µí•˜ì§€ë§Œ, ê¹¨ì–´ë‚˜ë©´ ìžŠìŠµë‹ˆë‹¤.",art:"assets/events/event_mad_lullaby.png",options:e=>[{key:"mad_lullaby:sleep",label:"ìž ë“ ë‹¤",detail:"HP +12. ë±ì—ì„œ ë¬´ìž‘ìœ„ 1ìž¥ ì†Œì‹¤.",apply:t=>(Tt(t,12),aa(t),y(t,"ìžìž¥ê°€: HP íšŒë³µ, ê·¸ëŸ¬ë‚˜ ìžŠì—ˆë‹¤â€¦ (ë¬´ìž‘ìœ„ 1ìž¥ ì†Œì‹¤)"),"NONE")},{key:"mad_lullaby:stay",label:"ë²„í‹´ë‹¤",detail:"F -1",apply:t=>(je(t,-1),y(t,"ë²„íŒ€: F -1"),"NONE")}]}];function Ua(e){const n=e.run.lastEventId??null;return Lr(Wa,n)}const bn=[{id:"drop_bag",name:"ì§ ë²„ë¦¬ê¸°",prompt:"ì§ì„ ì¤„ì—¬ í”¼ë¡œë¥¼ ë‚®ì¶”ìž.",art:"assets/events/event_drop_bag.png",options:()=>[{key:"drop",label:"ì¹´ë“œ 1ìž¥ ì œê±°, F -1",apply:e=>(je(e,-1),y(e,"ì´ë²¤íŠ¸: ì§ ë²„ë¦¬ê¸° â†’ ì œê±°í•  ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”."),{kind:"REMOVE_PICK",title:"ì§ ë²„ë¦¬ê¸°",prompt:"ì œê±°í•  ì¹´ë“œ 1ìž¥ì„ ì„ íƒí•˜ì„¸ìš”.",then:"NONE"})},{key:"skip",label:"ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠëŠ”ë‹¤",apply:e=>(y(e,"ì´ë²¤íŠ¸: ì§ ë²„ë¦¬ê¸°(ìƒëžµ)"),"NONE")}]},{id:"hide_from_monster",name:"ëª¬ìŠ¤í„°ë¡œë¶€í„° ìˆ¨ê¸°",prompt:"ì „íˆ¬í•˜ê±°ë‚˜, ëŒ€ê°€ë¥¼ ì¹˜ë¥´ê³  ìˆ¨ì„ ìˆ˜ ìžˆë‹¤.",art:"assets/events/event_hide_from_monster.png",options:()=>[{key:"fight",label:"ì „íˆ¬",apply:e=>(y(e,"ì´ë²¤íŠ¸: ëª¬ìŠ¤í„°ë¡œë¶€í„° ìˆ¨ê¸° â†’ ì „íˆ¬ ì„ íƒ"),"BATTLE")},{key:"remove_and_fatigue",label:"ì¹´ë“œ 1ìž¥ ì œê±° í›„ F +1",apply:e=>(je(e,1),y(e,"ì´ë²¤íŠ¸: ëª¬ìŠ¤í„°ë¡œë¶€í„° ìˆ¨ê¸° â†’ ì¹´ë“œ ì œê±° í›„ F+1"),{kind:"REMOVE_PICK",title:"ìˆ¨ê¸°",prompt:"ì œê±°í•  ì¹´ë“œ 1ìž¥ì„ ì„ íƒí•˜ì„¸ìš”.",then:"NONE"})}]},{id:"goblin_ambush_low_supplies",name:"ë§¤ë³µí•œ ì•½íƒˆìžë“¤",prompt:"ê³ ë¸”ë¦°ë“¤ì´ ë³´ê¸‰ì„ ì•½íƒˆí–ˆë‹¤.",art:"assets/events/event_goblin_ambush_low_supplies.png",options:()=>[{key:"fight",label:"ë§žì„œ ì‹¸ìš´ë‹¤",detail:`ê³ ë¸”ë¦° ì•½íƒˆìž 2ë§ˆë¦¬ ì „íˆ¬ (Sê°€ 5 ê°ì†Œí•œ ì±„ë¡œ ì‹œìž‘)
ìŠ¹ë¦¬ ì‹œ ðŸª™50`,apply:e=>(e.run.nextBattleSuppliesBonus=-5,{kind:"BATTLE_SPECIAL",title:"ê³ ë¸”ë¦° ë§¤ë³µ",enemyIds:["goblin_raider","goblin_raider"],onWinGrantGold:50})}]},{id:"find_adventurer",name:"ë‹¤ë¥¸ ëª¨í—˜ê°€ ë°œê²¬",prompt:"ê±°ëž˜í•œë‹¤.",art:"assets/events/event_find_adventurer.png",options:e=>e.run.treasureObtained?[{key:"adventurer:forced_battle",label:"ëŒ€ì¹˜í•œë‹¤",detail:"ë³´ë¬¼ì„ ë…¸ë¦¬ê³  ë¤ë²¼ë“ ë‹¤.",apply:t=>({kind:"BATTLE_SPECIAL",enemyIds:["other_adventurer"],title:"ë³´ë¬¼ì„ ë…¸ë¦¬ëŠ” ëª¨í—˜ê°€"})}]:[{key:"trade",label:"ì¹´ë“œ 1ìž¥ ì œê±° í›„ ì¹´ë“œ ë³´ìƒ(2ìž¥ ì¤‘ 1ìž¥)",apply:t=>(y(t,"ì´ë²¤íŠ¸: ë‹¤ë¥¸ ëª¨í—˜ê°€ ë°œê²¬ â†’ ì œê±°í•  ì¹´ë“œ ì„ íƒ í›„ ë³´ìƒ"),{kind:"REMOVE_PICK",title:"ë‹¤ë¥¸ ëª¨í—˜ê°€ ë°œê²¬",prompt:"ì œê±°í•  ì¹´ë“œ 1ìž¥ì„ ì„ íƒí•˜ì„¸ìš”.",then:"REWARD"})},{key:"leave",label:"ì§€ë‚˜ì¹œë‹¤",apply:t=>(y(t,"ì´ë²¤íŠ¸: ë‹¤ë¥¸ ëª¨í—˜ê°€ ë°œê²¬(ìƒëžµ)"),"NONE")}]},{id:"ominous_prophecy",name:"ë¶ˆê¸¸í•œ ì˜ˆì–¸",prompt:"ë¶ˆê¸¸í•œ ì†ì‚­ìž„ì´ ê·“ê°€ë¥¼ ë§´ëˆë‹¤. ëŒ€ê°€ë¥¼ ì¹˜ë¥´ê³  ë¯¸ëž˜ë¥¼ ì—¿ë³¼ê¹Œ?",art:"assets/events/event_ominous_prophecy.png",options:e=>[{key:"omen:listen",label:"ì˜ˆì–¸ì„ ë“£ëŠ”ë‹¤",detail:"F +1. ë‹¤ìŒ ë³´ìŠ¤ë¥¼ í™•ì •í•˜ê³  ê³µê°œí•©ë‹ˆë‹¤.",apply:t=>{if(je(t,1),y(t,"ë¶ˆê¸¸í•œ ì˜ˆì–¸: F +1"),t.run.nextBossId||(t.run.bossPool.length>0?t.run.nextBossId=ce(t.run.bossPool):t.run.nextBossId=null),!t.run.nextBossId)return y(t,"ì˜ˆì–¸: ë¯¸ëž˜ê°€ íë¦¿í•˜ë‹¤. (ë³´ìŠ¤ê°€ ë‚¨ì•„ìžˆì§€ ì•ŠìŒ)"),"NONE";t.content.enemiesById[t.run.nextBossId];const n=Br[t.run.nextBossId]??"ì •ì²´ë¶ˆëª…ì˜ ìœ„í˜‘ì´ ë‹¤ê°€ì˜¨ë‹¤.";return t.run.bossOmenText=`${n}`,y(t,`ì˜ˆì–¸: ${n}`),"NONE"}},{key:"omen:ignore",label:"ë¬´ì‹œí•œë‹¤",detail:"ì•„ë¬´ ì¼ë„ ì¼ì–´ë‚˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",apply:t=>(y(t,"ë¶ˆê¸¸í•œ ì˜ˆì–¸(ë¬´ì‹œ)"),"NONE")}]},{id:"rat_circle",name:"ì¥ë“¤ì˜ ì›",prompt:`ì¥ë“¤ì´ ëŒë°”ë‹¥ì— ì›ì„ ë§Œë“ ë‹¤.
ë‹¹ì‹ ì„ ë³´ìž ì›ì´ ì»¤ì§„ë‹¤.`,art:"assets/events/event_rat_circle.png",options:e=>{const t=!No(e,"relic_ratskin_charm"),n=[{key:"rat_circle:one",label:"ì¥ë–¼ í•œ ë§ˆë¦¬ì™€ ì‹¸ìš´ë‹¤",detail:"ì „íˆ¬",apply:r=>(y(r,"ì´ë²¤íŠ¸: ì¥ë“¤ì˜ íŒ â†’ ì¥ë–¼ 1"),{kind:"BATTLE_SPECIAL",title:"ì¥ë“¤ì˜ ì›",enemyIds:["rat_swarm"]})}];return t&&n.splice(1,0,{key:"rat_circle:three_for_relic",label:"ìœ ë¬¼ì„ ê±¸ê³  ì¥ë–¼ ì…‹ê³¼ ì‹¸ìš´ë‹¤",detail:"ìŠ¹ë¦¬ ì‹œ ê³ ìœ  ìœ ë¬¼ íšë“",apply:r=>(y(r,"ì´ë²¤íŠ¸: ì¥ë“¤ì˜ íŒ â†’ ì¥ë–¼ 3 (ê³ ìœ  ìœ ë¬¼)"),{kind:"BATTLE_SPECIAL",title:"ì¥ë“¤ì˜ ì›",enemyIds:["rat_swarm","rat_swarm","rat_swarm"],onWinGrantRelicId:"relic_ratskin_charm"})}),n}}];function Or(e){return bn.find(t=>t.id===e)??null}function Ka(){return Object.keys(kr).sort((e,t)=>e.localeCompare(t))}function za(){return{cardsById:kr,enemiesById:go,itemsById:Tr}}let ot=!1,Ln=null,et=[],pt=[],Re=-1;function ja(e){return Array.from(new Set(e)).sort((t,n)=>t.localeCompare(n))}function rr(e,t){return e.toLowerCase().startsWith(t.toLowerCase())}function Va(e){const t=e.content?.itemsById??e.content?.ITEMS_BY_ID??{};return Object.keys(t).sort((n,r)=>n.localeCompare(r))}function qa(e,t){return!!(e.content?.itemsById??e.content?.ITEMS_BY_ID??{})[t]}function Ga(){return[{name:"help",desc:"show commands"},{name:"state",desc:"print game state"},{name:"newrun",desc:"start new run"},{name:"hp",args:"<n>",desc:"set current hp"},{name:"maxhp",args:"<n>",desc:"set max hp"},{name:"supplies",args:"<n>",desc:"set supplies"},{name:"fatigue",args:"<n>",desc:"set fatigue"},{name:"phase",args:"<PLACE|BACK|FRONT|ENEMY|UPKEEP|DRAW|NODE>",desc:"set phase",suggest:()=>["PLACE","BACK","FRONT","ENEMY","UPKEEP","DRAW","NODE"]},{name:"addcard",args:"<defId> [upgrade=0] [zone=deck|hand|discard]",desc:"add card",suggest:(e,t)=>t.length<=2?Ka():t.length===4?["deck","hand","discard"]:[]},{name:"removecard",args:"<uid>",desc:"remove card",suggest:e=>ja(Object.keys(e.cards??{}))},{name:"win",desc:"force victory"},{name:"lose",desc:"force defeat"},{name:"log",args:"<text...>",desc:"log message"},{name:"addrelic",args:"<relicId> [now|locked|unlocked]",desc:"grant relic",suggest:(e,t)=>t.length<=2?_o():t.length===3?["now","locked","unlocked"]:[]},{name:"relicapply",desc:"apply pending relic activations"},{name:"gold",args:"<n>",desc:"set gold"},{name:"additem",args:"<itemId> [n=1]",desc:"add item(s) to inventory",suggest:(e,t)=>t.length<=2?Va(e):[]}]}function Bt(e,t){et.push({t:Date.now(),kind:e,text:t}),et.length>300&&(et=et.slice(-300))}function Ya(e){Ln=e}function Xa(){return ot}function Qa(e){ot=!ot,tt()}function tt(){if(document.querySelector(".devConsole")?.remove(),!ot)return;const e=document.createElement("div");e.className="devConsole",e.style.cssText=`
    position: fixed; inset: 0;
    z-index: 60000;
    pointer-events: auto;
    background: rgba(0,0,0,.35);
    backdrop-filter: blur(calc(4 * var(--u)));
    display:flex; align-items:flex-end; justify-content:center;
    padding: calc(12 * var(--u));
    box-sizing: border-box;
  `;const t=document.createElement("div");t.style.cssText=`
    width: min(calc(980 * var(--u)), 100%);
    height: min(calc(420 * var(--u)), 70vh);
    border-radius: calc(16 * var(--u));
    border: calc(1 * var(--u)) solid rgba(255,255,255,.14);
    background: rgba(10,12,14,.92);
    box-shadow: 0 calc(18 * var(--u)) calc(60 * var(--u)) rgba(0,0,0,.55);
    display:flex;
    flex-direction: column;
    overflow:hidden;
  `;const n=document.createElement("div");n.style.cssText=`
    padding: calc(10 * var(--u)) calc(12 * var(--u));
    display:flex; align-items:center; justify-content:space-between;
    border-bottom: calc(1 * var(--u)) solid rgba(255,255,255,.10);
  `;const r=document.createElement("div");r.textContent="Dev Console",r.style.cssText="font-weight:800; color:#fff; opacity:.95;";const o=document.createElement("div");o.style.cssText="display:flex; gap:calc(8 * var(--u));";const a=(h,x)=>{const k=document.createElement("button");return k.type="button",k.textContent=h,k.style.cssText=`
      padding: calc(6 * var(--u)) calc(10 * var(--u));
      border-radius: calc(10 * var(--u));
      border: calc(1 * var(--u)) solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: #fff;
      cursor: pointer;
      font-weight: 700;
    `,k.onclick=x,k};o.appendChild(a("Clear",()=>{et=[],tt()})),o.appendChild(a("Close",()=>{ot=!1,tt()})),n.appendChild(r),n.appendChild(o);const s=document.createElement("div");s.className="devConsoleOut",s.style.cssText=`
    flex: 1 1 auto;
    padding: calc(10 * var(--u)) calc(12 * var(--u));
    overflow: auto;
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: calc(12 * var(--u));
    line-height: 1.4;
    color: #ddd;
    white-space: pre-wrap;
  `;const i=h=>(h.kind==="in"?"> ":h.kind==="err"?"! ":"  ")+h.text;s.textContent=et.map(i).join(`
`),queueMicrotask(()=>{s.scrollTop=s.scrollHeight});const l=document.createElement("div");l.style.cssText=`
    border-top: calc(1 * var(--u)) solid rgba(255,255,255,.10);
    padding: calc(10 * var(--u)) calc(12 * var(--u));
    display:flex; gap:calc(10 * var(--u)); align-items:center;
  `;const c=document.createElement("div");c.className="devConsoleHint",c.style.cssText=`
    margin-left: calc(10 * var(--u));
    max-width: 45%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    color: rgba(255,255,255,.55);
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: calc(12 * var(--u));
  `;const m=document.createElement("div");m.textContent=">",m.style.cssText="color:#fff; font-weight:900; opacity:.9;";const u=document.createElement("input");u.type="text",u.placeholder="help / state / newrun ...",u.style.cssText=`
    flex: 1 1 auto;
    padding: calc(10 * var(--u)) calc(12 * var(--u));
    border-radius: calc(12 * var(--u));
    border: calc(1 * var(--u)) solid rgba(255,255,255,.14);
    background: rgba(255,255,255,.06);
    color: #fff;
    outline: none;
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: calc(13 * var(--u));
  `;const d=Ga();let b={base:"",items:[],idx:-1,lastApplied:""};const E=h=>{const x=Ln?.getG();if(!x)return[];const k=h.split(/\s+/).filter(Boolean),N=/\s$/.test(h);if(k.length===0)return d.map($=>$.name);if(k.length===1&&!N){const $=k[0];return d.map(g=>g.name).filter(g=>rr(g,$))}const I=(k[0]??"").toLowerCase(),C=d.find($=>$.name===I);if(!C?.suggest)return[];const K=N?"":k[k.length-1]??"";return C.suggest(x,k).filter($=>rr($,K))},p=(h,x)=>{const k=/\s$/.test(h);if(!h.trim())return x+" ";const N=h.split(/\s+/);return k?h+x+" ":(N[N.length-1]=x,N.join(" ")+" ")},f=()=>{const h=E(u.value);if(!h.length){c.textContent="";return}const x=h.slice(0,6);c.textContent=x.join("  ")};u.onkeydown=h=>{if(h.key==="Escape"){ot=!1,tt();return}if(h.key==="Enter"){const x=u.value.trim();if(!x)return;u.value="",pt.unshift(x),Re=-1,Bt("in",x);try{Za(x)}catch(k){Bt("err",String(k?.message??k))}tt();return}if(h.key==="ArrowUp"){h.preventDefault();const x=pt.length;if(x===0)return;Re=Math.min(x-1,Re+1),u.value=pt[Re]??"";return}if(h.key==="ArrowDown"){if(h.preventDefault(),pt.length===0)return;Re=Math.max(-1,Re-1),u.value=Re>=0?pt[Re]??"":"";return}if(h.key==="Tab"){h.preventDefault();const x=h.shiftKey===!0,k=u.value;if(!(b.items.length>0&&(k===b.lastApplied||k===b.base))){const K=E(k);b.base=k,b.items=K,b.idx=-1,b.lastApplied=k}if(!b.items.length){f();return}x?b.idx=(b.idx-1+b.items.length)%b.items.length:b.idx=(b.idx+1)%b.items.length;const I=b.items[b.idx],C=p(b.base,I);u.value=C,b.lastApplied=C,f();return}},u.oninput=()=>{b.items=[],b.base="",b.idx=0,f()},l.appendChild(m),l.appendChild(u),l.appendChild(c),t.appendChild(n),t.appendChild(s),t.appendChild(l),t.onclick=h=>h.stopPropagation(),e.appendChild(t),document.body.appendChild(e),f(),queueMicrotask(()=>u.focus())}function Za(e){const t=Ln;if(!t){Bt("err","Dev console context not set");return}const n=t.getG(),r=e.split(/\s+/).filter(Boolean),o=(r[0]??"").toLowerCase(),a=r[1],s=r[2],i=c=>Bt("out",c);if(o==="help"){i(["help","state","newrun","hp <n> | maxhp <n> | supplies <n> | fatigue <n>","phase <PLACE|BACK|FRONT|ENEMY|UPKEEP|DRAW|NODE>","addcard <defId> [upgrade=0] [zone=deck|hand|discard]","removecard <uid>","addrelic <relicId> [now|locked|unlocked]","relicapply  (apply pending relic activations)","win | lose","log <text...>","gold <n>","additem <itemId> [n=1]"].join(`
`));return}if(o==="state"){i(JSON.stringify({phase:n.phase,hp:`${n.player.hp}/${n.player.maxHp}`,supplies:n.player.supplies,fatigue:n.player.fatigue,deck:n.deck.length,hand:n.hand.length,discard:n.discard.length,enemies:n.enemies.map(c=>({id:c.id,hp:`${c.hp}/${c.maxHp}`,intent:c.intentIndex})),gold:n.run.gold??0,items:n.run.items??[]},null,2));return}if(o==="newrun"){t.actions.onNewRun(),i("OK: newrun");return}const l=(c,m)=>{const u=Number(a);if(!Number.isFinite(u)){i(`ERR: ${c} requires number`);return}m(u),t.rerender(),i(`OK: ${c} = ${u}`)};if(o==="hp")return l("hp",c=>n.player.hp=Math.max(0,Math.min(n.player.maxHp,c)));if(o==="maxhp")return l("maxHp",c=>{n.player.maxHp=Math.max(1,c),n.player.hp=Math.min(n.player.hp,n.player.maxHp)});if(o==="supplies")return l("supplies",c=>n.player.supplies=Math.max(0,c));if(o==="fatigue")return l("fatigue",c=>n.player.fatigue=Math.max(0,c));if(o==="phase"){const c=(a??"").toUpperCase();if(!new Set(["PLACE","BACK","FRONT","ENEMY","UPKEEP","DRAW","NODE"]).has(c)){i("ERR: phase invalid");return}n.phase=c,t.rerender(),i(`OK: phase=${c}`);return}if(o==="log"){const c=e.slice(e.indexOf(" ")+1);if(!c||c===e){i("ERR: log <text...>");return}t.log?.(`[DEV] ${c}`),i("OK: logged");return}if(o==="addcard"){const c=a;if(!c){i("ERR: addcard <defId> [upgrade=0] [zone=deck|hand|discard]");return}const m=Math.max(0,Number(s??"0")||0),u=r[3]??"deck";bt(n,c,{upgrade:m});const d=n.deck[n.deck.length-1];d&&u!=="deck"&&(n.deck=n.deck.filter(b=>b!==d),u==="hand"?n.hand.push(d):u==="discard"&&n.discard.push(d),n.cards[d].zone=u),t.log?.(`[DEV] addcard ${c} +${m} (${u}) uid=${d}`),t.rerender(),i(`OK: addcard uid=${d}`);return}if(o==="removecard"){const c=a;if(!c){i("ERR: removecard <uid>");return}if(!n.cards[c]){i(`ERR: uid not found: ${c}`);return}const m=n.deck.includes(c),u=n.hand.includes(c),d=n.discard.includes(c);!m&&!u&&!d&&i(`WARN: uid exists but not in piles (deck/hand/discard): ${c} (zone=${n.cards[c]?.zone??"?"})`),kt(n,c),t.log?.(`[DEV] removecard ${c}`),t.rerender(),i("OK: removecard");return}if(o==="addrelic"){const c=a,m=(s??"").toLowerCase();if(!c){i("ERR: addrelic <relicId> [now|locked|unlocked]");return}Mt(n,c);const u=n.run;if(u.forceLockedRelics??={},u.forceUnlockedRelics??={},m==="locked"){u.forceLockedRelics[c]=!0,delete u.forceUnlockedRelics[c],u.relicRuntime??={},u.relicRuntime[c]??={active:!1,pending:!1,obtainedAtNode:n.run.nodePickCount},u.relicRuntime[c].active=!1,u.relicRuntime[c].pending=!1,t.log?.(`[DEV] addrelic ${c} (locked)`),t.rerender(),i(`OK: addrelic ${c} (locked)`);return}if(m==="unlocked"){u.forceUnlockedRelics[c]=!0,delete u.forceLockedRelics[c],t.log?.(`[DEV] addrelic ${c} (unlocked)`),t.rerender(),i(`OK: addrelic ${c} (unlocked)`);return}m==="now"&&fe(n),t.log?.(`[DEV] addrelic ${c}${m?` (${m})`:""}`),t.rerender(),i(`OK: addrelic ${c}`);return}if(o==="relicapply"){fe(n),t.log?.("[DEV] relicapply"),t.rerender(),i("OK: relicapply");return}if(o==="gold")return l("gold",c=>{const m=n.run;m.gold=Math.max(0,c|0)});if(o==="additem"){const c=a,m=Math.max(1,Number(s??"1")||1);if(!c){i("ERR: additem <itemId> [n=1]");return}qa(n,c)||i(`WARN: unknown itemId (still adding): ${c}`);const u=n.run;u.items??=[];for(let d=0;d<m;d++)u.items.push(c);t.log?.(`[DEV] additem ${c} x${m}`),t.rerender(),i(`OK: additem ${c} x${m}`);return}if(o==="win"){if(!n.enemies||n.enemies.length===0){i("WARN: enemies=0");return}for(const c of n.enemies)c.hp=0;n.enemies=[],n.pendingTarget=null,n.pendingTargetQueue=[],n.selectedEnemyIndex=null,it(n),t.log?.("[DEV] win"),t.rerender(),i("OK: win");return}if(o==="lose"){n.run.finished=!0,t.log?.("[DEV] lose"),t.rerender(),i("OK: lose");return}i(`Unknown command: ${o} (try: help)`)}function Le(e){return Number(e.run.gold??0)||0}function Ue(e,t){const n=Number(t)||0;if(n===0)return;const r=Le(e);e.run.gold=r+n;const o=n>0?"+":"";me(e,"GOLD","ðŸª™ "+o+n,1400)}function Hr(e){return Number(e.run.nextBattleSuppliesBonus??0)||0}function or(e,t){let r=Hr(e)+(Number(t)||0);r<-7&&(r=-7),e.run.nextBattleSuppliesBonus=r}function Ja(e){return Math.max(0,7+Hr(e))}function rn(e,t){if(!t)return;const n=e.player.fatigue??0;n<10||(e.player.fatigue=Math.max(0,n-2),e.time=(e.time??0)+1,y(e,"í”¼ë¡œê°€ ë„ˆë¬´ ë†’ì•„ íœ´ì‹ì´ ë” ì˜¤ëž˜ ê±¸ë¦½ë‹ˆë‹¤. (F -2, ì‹œê°„ +1)"))}function Dr(e){let t=Object.values(e.cards).filter(s=>(s.zone==="deck"||s.zone==="hand"||s.zone==="discard")&&jt(e,s.uid)).map(s=>s.uid);const n=e.player.fatigue??0;let r=1/0;return n>=8?r=4:n>=5&&(r=8),r!==1/0&&t.length>r&&(t=[...t].sort(()=>Math.random()-.5).slice(0,r)),t.length===0?null:{kind:"UPGRADE_PICK",title:"ê°•í™”",prompt:"ê°•í™”í•  ì¹´ë“œ 1ìž¥ì„ ì„ íƒí•˜ì„¸ìš”.",options:[...[...t].sort((s,i)=>{const l=e.cards[s],c=e.cards[i],m=e.content.cardsById[l.defId]?.name??l.defId,u=e.content.cardsById[c.defId]?.name??c.defId,d=m.localeCompare(u,"ko");return d!==0?d:(l.upgrade??0)-(c.upgrade??0)}).map(s=>{const i=e.cards[s],l=pe(e.content,i.defId,i.upgrade??0),c=pe(e.content,i.defId,(i.upgrade??0)+1),m=e.content.cardsById[i.defId]?.name??i.defId,u=(i.upgrade??0)>0?`${m} +${i.upgrade}`:m,d=`í˜„ìž¬: ì „ì—´ ${l.frontText} / í›„ì—´ ${l.backText}
ê°•í™”: ì „ì—´ ${c.frontText} / í›„ì—´ ${c.backText}`;return{key:`up:${s}`,label:u,detail:d,cardUid:s}}),{key:"skip",label:"ì·¨ì†Œ"}]}}function es(e,t,n){const r="goal_treasure",o=Object.values(e.cards).filter(s=>(s.zone==="deck"||s.zone==="hand"||s.zone==="discard")&&s.defId!==r).map(s=>s.uid);if(o.length===0)return null;const a=[...o.map(s=>{const i=e.cards[s],l=pe(e.content,i.defId,i.upgrade??0),c=e.content.cardsById[i.defId]?.name??i.defId,m=(i.upgrade??0)>0?`${c} +${i.upgrade}`:c;return{key:`remove:${s}`,label:m,detail:`ì „ì—´: ${l.frontText} / í›„ì—´: ${l.backText}`,cardUid:s}}),{key:"skip",label:"ì·¨ì†Œ"}];return{kind:"REMOVE_PICK",title:t,prompt:n,options:a}}function ts(e,t){const n=e.choiceCtx&&e.choiceCtx.kind==="REST"&&typeof e.choiceCtx.highF=="boolean"?e.choiceCtx.highF:(e.player.fatigue??0)>=10;if(t.startsWith("rest:")){const r=ve(e);r.rest+=1,ge(e)}if(t==="rest:heal")return rn(e,n),Tt(e,15),y(e,"íœ´ì‹: HP +15"),ke(e),e.phase="NODE",fe(e),!0;if(t==="rest:clear_f")return rn(e,n),e.player.fatigue=Math.max(0,(e.player.fatigue??0)-3),y(e,"íœ´ì‹: í”¼ë¡œ F-=3"),ke(e),e.phase="NODE",fe(e),!0;if(t==="rest:upgrade"){const a=[...Object.values(e.cards).filter(l=>l.zone==="deck"||l.zone==="hand"||l.zone==="discard").filter(l=>jt(e,l.uid)).map(l=>{const c=pe(e.content,l.defId,l.upgrade??0),m=e.content.cardsById[l.defId]?.name??l.defId,u=(l.upgrade??0)>0?`${m} +${l.upgrade}`:m;return{key:`up:${l.uid}`,label:u,detail:`ì „ì—´: ${c.frontText} / í›„ì—´: ${c.backText}`,cardUid:l.uid}}),{key:"skip",label:"ì·¨ì†Œ"}],s=e.choice,i=e.choiceCtx;return st(e,{kind:"UPGRADE_PICK",title:"ê°•í™”",prompt:"ê°•í™”í•  ì¹´ë“œ 1ìž¥ì„ ì„ íƒí•˜ì„¸ìš”.",options:a},{kind:"UPGRADE_PICK",returnChoice:s,returnCtx:i}),!0}return t==="rest:skip"?(rn(e,n),y(e,"íœ´ì‹: ìƒëžµ"),ke(e),e.phase="NODE",fe(e),!0):!1}function ns(e,t){if(!e.choiceCtx||e.choiceCtx.kind!=="SHOP")return!1;const n=String(e.choiceCtx.nodeId??"");if(!n)return!1;const r=e.run;r.shops??={};const o=r.shops[n];if(!o)return ee(e,n),!0;if(t==="shop:leave")return y(e,"ìƒì : ë– ë‚œë‹¤."),ke(e),e.phase="NODE",!0;if(t==="shop:sep"||t.startsWith("shop:sep:"))return ee(e,n),!0;if(t.startsWith("shop:card:")){const a=Number(t.slice(10)),s=o.cards?.[a];if(!s)return y(e,"ìƒì : ì•Œ ìˆ˜ ì—†ëŠ” ì¹´ë“œ ì„ íƒìž…ë‹ˆë‹¤."),ee(e,n),!0;if(s.sold)return y(e,"ìƒì : í’ˆì ˆë˜ì—ˆìŠµë‹ˆë‹¤."),ee(e,n),!0;const i=Number(s.priceGold??0)||0;return Le(e)<i?(y(e,"ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."),ee(e,n),!0):(Ue(e,-i),bt(e,s.defId,{upgrade:Number(s.upgrade??0)||0}),s.sold=!0,y(e,`ìƒì : ì¹´ë“œ êµ¬ë§¤ (-ðŸª™${i})`),ee(e,n),!0)}if(t.startsWith("shop:item:")){const a=Number(t.slice(10)),s=o.items?.[a];if(!s)return y(e,"ìƒì : ì•Œ ìˆ˜ ì—†ëŠ” ì•„ì´í…œ ì„ íƒìž…ë‹ˆë‹¤."),ee(e,n),!0;if(s.sold)return y(e,"ìƒì : í’ˆì ˆë˜ì—ˆìŠµë‹ˆë‹¤."),ee(e,n),!0;if(Yn(e)||Yn(e))return y(e,"ì•„ì´í…œ ê°€ë°©ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤. ë¨¼ì € ë²„ë¦¬ê±°ë‚˜(ìš°í´ë¦­) ì‚¬ìš©í•˜ì„¸ìš”."),me(e,"WARN","ì•„ì´í…œ ê°€ë°©ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤.",1600),ee(e,n),!0;const i=Number(s.priceGold??0)||0;if(Le(e)<i)return y(e,"ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."),ee(e,n),!0;if(Ue(e,-i),!yn(e,String(s.itemId),"SHOP"))return Ue(e,i),y(e,"ìƒì : ì•„ì´í…œ êµ¬ë§¤ ì‹¤íŒ¨(í™˜ë¶ˆ)"),ee(e,n),!0;s.sold=!0;const c=Te(String(s.itemId))?.name??String(s.itemId);return y(e,`ìƒì : ì•„ì´í…œ êµ¬ë§¤ (${c}) (-ðŸª™${i})`),ee(e,n),!0}if(t==="shop:supply:buy")return Le(e)<6?(y(e,"ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."),ee(e,n),!0):(Ue(e,-6),or(e,3),y(e,"ìƒì : ë³´ê¸‰ êµ¬ë§¤ (-ðŸª™6, ë‹¤ìŒ ì „íˆ¬ ðŸž +3)"),ee(e,n),!0);if(t==="shop:supply:sell")return Ja(e)<3?(y(e,"ë‹¤ìŒ ì „íˆ¬ ë³´ê¸‰ì´ ë¶€ì¡±í•˜ì—¬ íŒë§¤í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."),ee(e,n),!0):(or(e,-3),Ue(e,4),y(e,"ìƒì : ë³´ê¸‰ íŒë§¤ (ë‹¤ìŒ ì „íˆ¬ ðŸž -3, ðŸª™ +4)"),ee(e,n),!0);if(t==="shop:service:upgrade"){if(o.usedUpgrade)return y(e,"ìƒì : ê°•í™”ëŠ” ì´ ìƒì ì—ì„œ ì´ë¯¸ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤."),ee(e,n),!0;const a=25;if(Le(e)<a)return y(e,"ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."),ee(e,n),!0;const s=Dr(e);return s?(st(e,s,{kind:"UPGRADE_PICK",returnTo:{kind:"SHOP",nodeId:n},priceGold:a}),!0):(y(e,"ê°•í™”í•  ìˆ˜ ìžˆëŠ” ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤."),ee(e,n),!0)}if(t==="shop:service:remove"){if(o.usedRemove)return y(e,"ìƒì : ì œê±°ëŠ” ì´ ìƒì ì—ì„œ ì´ë¯¸ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤."),ee(e,n),!0;const a=25;if(Le(e)<a)return y(e,"ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."),ee(e,n),!0;const s=es(e,"ìƒì : ì¹´ë“œ ì œê±°","ì œê±°í•  ì¹´ë“œ 1ìž¥ì„ ì„ íƒí•˜ì„¸ìš”.");return s?(st(e,s,{kind:"REMOVE_PICK",returnTo:{kind:"SHOP",nodeId:n},priceGold:a}),!0):(y(e,"ì œê±°í•  ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤."),ee(e,n),!0)}return t.startsWith("shop:")?(y(e,`ìƒì : ì•Œ ìˆ˜ ì—†ëŠ” ì„ íƒ (${t})`),ee(e,n),!0):!1}function rs(e,t){if(!e.choiceCtx||e.choiceCtx.kind!=="EVENT")return!1;const n=Or(e.choiceCtx.eventId);if(!n)return!1;const o=n.options(e).find(i=>i.key===t);if(!o)return!1;const a=ve(e);a.eventPicks+=1,ge(e);const s=o.apply(e);if(s&&typeof s=="object"&&s.kind==="UPGRADE_PICK"){const i=Dr(e);return i?(st(e,i,null),!0):(y(e,"ê°•í™”í•  ìˆ˜ ìžˆëŠ” ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤."),ke(e),e.phase="NODE",fe(e),!0)}if(s&&typeof s=="object"&&s.kind==="REMOVE_PICK"){const l=[...Object.values(e.cards).filter(c=>c.zone==="deck"||c.zone==="hand"||c.zone==="discard").map(c=>c.uid).map(c=>{const m=e.cards[c],u=pe(e.content,m.defId,m.upgrade??0),d=e.content.cardsById[m.defId]?.name??m.defId,b=(m.upgrade??0)>0?`${d} +${m.upgrade}`:d;return{key:`remove:${c}`,label:b,detail:`ì „ì—´: ${u.frontText} / í›„ì—´: ${u.backText}`,cardUid:c}}),{key:"skip",label:"ì·¨ì†Œ"}];return st(e,{kind:"REMOVE_PICK",title:s.title??"ì œê±°",prompt:s.prompt??"ì œê±°í•  ì¹´ë“œ 1ìž¥ì„ ì„ íƒí•˜ì„¸ìš”.",options:l},null),!0}return ke(e),e.phase="NODE",fe(e),!0}function os(e,t){const n=e.choice;if(!n)return!1;if(t==="close")return ke(e),!0;if(n.kind==="REWARD")return ma(e,t);if(n.kind==="UPGRADE_PICK"){if(t==="skip"){const r=e.choiceCtx;return r?.returnTo?.kind==="SHOP"&&r?.returnTo?.nodeId?(y(e,"ìƒì : ê°•í™” ì·¨ì†Œ"),ee(e,String(r.returnTo.nodeId)),!0):r?.returnChoice?(y(e,"ê°•í™” ì·¨ì†Œ"),st(e,r.returnChoice,r.returnCtx??null),!0):(y(e,"ê°•í™” ì·¨ì†Œ"),ke(e),e.phase="NODE",fe(e),!0)}if(t.startsWith("up:")){const r=t.slice(3),o=e.choiceCtx;if(o?.returnTo?.kind==="SHOP"&&o?.returnTo?.nodeId){const s=String(o.returnTo.nodeId),i=Number(o?.priceGold??0)||0;if(i>0){if(Le(e)<i)return y(e,"ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."),ee(e,s),!0;Ue(e,-i)}const l=hn(e,r),m=e.run.shops?.[s];return l&&m&&(m.usedUpgrade=!0),y(e,l?"ìƒì : ê°•í™” ì™„ë£Œ":"ìƒì : ê°•í™” ì‹¤íŒ¨"),ee(e,s),!0}const a=hn(e,r);return y(e,a?"ê°•í™” ì™„ë£Œ":"ê°•í™” ì‹¤íŒ¨"),ke(e),e.phase="NODE",fe(e),!0}return!1}if(n.kind==="REMOVE_PICK"){if(t==="skip"){const r=e.choiceCtx;return r?.returnTo?.kind==="SHOP"&&r?.returnTo?.nodeId?(y(e,"ìƒì : ì œê±° ì·¨ì†Œ"),ee(e,String(r.returnTo.nodeId)),!0):(y(e,"ì œê±° ì·¨ì†Œ"),ke(e),e.phase="NODE",fe(e),!0)}if(t.startsWith("remove:")){const r=t.slice(7),o=e.choiceCtx;if(o?.returnTo?.kind==="SHOP"&&o?.returnTo?.nodeId){const a=String(o.returnTo.nodeId),s=Number(o?.priceGold??0)||0;if(s>0){if(Le(e)<s)return y(e,"ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."),ee(e,a),!0;Ue(e,-s)}kt(e,r);const l=e.run.shops?.[a];return l&&(l.usedRemove=!0),y(e,"ìƒì : ì¹´ë“œë¥¼ ì œê±°í–ˆìŠµë‹ˆë‹¤."),ee(e,a),!0}return kt(e,r),y(e,"ì¹´ë“œë¥¼ ì œê±°í–ˆìŠµë‹ˆë‹¤."),ke(e),e.phase="NODE",fe(e),!0}return!1}if(n.kind==="EVENT"){if(e.choiceCtx?.kind==="REST")return ts(e,t);if(e.choiceCtx?.kind==="EVENT")return rs(e,t);if(e.choiceCtx?.kind==="SHOP")return ns(e,t)}return t==="skip"?(ke(e),!0):!1}const Vt="deck-rogue-save-v1",Fr=1;function as(e){try{return JSON.parse(e)}catch{return null}}function ss(){return!!localStorage.getItem(Vt)}function is(){localStorage.removeItem(Vt)}function ls(e,t){const n={ver:Fr,savedAt:Date.now(),build:t?.build,state:e};localStorage.setItem(Vt,JSON.stringify(n))}function cs(){const e=localStorage.getItem(Vt);if(!e)return null;const t=as(e);return!t||t.ver!==Fr||!t.state?null:{state:t.state,savedAt:t.savedAt}}let _e=null;function ds(){_e||(_e=document.createElement("div"),_e.id="hudSOnly",_e.style.display="none",document.body.appendChild(_e))}function us(e){if(_e||ds(),!!_e){if(e==null||Number.isNaN(e)){_e.style.display="none";return}_e.textContent=`ðŸž ${e}`,_e.style.display=""}}const ps=`# Deck Rogue Prototype â€” ë£°ë¶ (í”Œë ˆì´ì–´ìš©)

ì´ ë¬¸ì„œëŠ” ìŠ¤í¬ì¼ëŸ¬ë¥¼ ìµœì†Œí™”í•©ë‹ˆë‹¤.

[1] ê°œìš”
ë…¸ë“œë¥¼ ì„ íƒí•˜ë©° ì§„í–‰í•˜ê³ , ì „íˆ¬ì—ì„œ ì‚´ì•„ë‚¨ì•„ ì„±ìž¥í•©ë‹ˆë‹¤. ëª©í‘œëŠ” ë¬´ì—‡ì¼ê¹Œìš”?
â†’ ë˜ì „ ê¹Šìˆ™í•œ ê³³ì˜ [ì €ì£¼ë°›ì€ ë³´ë¬¼]ì„ ì–»ê³ , ìž…êµ¬(START)ë¡œ ë˜ëŒì•„ì˜¤ë©´ ìŠ¹ë¦¬í•©ë‹ˆë‹¤.
ëª¨ë“  ì¹´ë“œëŠ” ì „ì—´ê³¼ í›„ì—´ì´ ìžˆìŠµë‹ˆë‹¤. ë°°ì¹˜ì— ë”°ë¼ ì—­í• ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤.

[2] ë³´ê¸‰ê³¼ í”¼ë¡œë„

ë³´ê¸‰(S): ì „ì—´ ì¹´ë“œ ë° ì¼ë¶€ íš¨ê³¼ì˜ ë°œë™ì— ì‚¬ìš©ë©ë‹ˆë‹¤. ë³´í†µ 7ë¡œ ì‹œìž‘í•©ë‹ˆë‹¤.
ë³´ê¸‰ì´ ë¶€ì¡±í•œ ìƒíƒœë¡œ í„´ ì¢…ë£Œ ì‹œ í”¼ë¡œë„ë§Œí¼ í”¼í•´ë¥¼ ë°›ìŠµë‹ˆë‹¤.

í”¼ë¡œë„(F): ë±ì„ ì„žê±°ë‚˜ ì „ì—´ ì¹´ë“œì˜ ë³´ê¸‰ì´ ë¶€ì¡±í•œ ì±„ë¡œ í„´ì„ ë§ˆì¹  ë•Œ í”¼ë¡œë„ê°€ 1 ì˜¬ë¼ê°€ë©°, ì¼ë¶€ ì¹´ë“œì˜ íš¨ê³¼ë¡œë„ ë³€í•©ë‹ˆë‹¤.
í”¼ë¡œë„ëŠ” ì „íˆ¬ê°€ ëë‚˜ë„ ìœ ì§€ë©ë‹ˆë‹¤. ë„ˆë¬´ ìŒ“ì¸ í”¼ë¡œëŠ” ë•Œë•Œë¡œ ë‹¹ì‹ ì„ ë³€í•˜ê²Œ í•©ë‹ˆë‹¤.

[3] ì „íˆ¬ íë¦„
ë°°ì¹˜ â†’ í›„ì—´ ë°œë™ â†’ ì „ì—´ ë°œë™ â†’ ì  í–‰ë™ â†’ ì •ë¦¬ â†’ ë“œë¡œìš°
â€» â€œëŒ€ìƒ ì„ íƒ í•„ìš”â€ê°€ ëœ¨ë©´ ì‚´ì•„ìžˆëŠ” ì ì„ í´ë¦­í•´ ëŒ€ìƒì„ ì •í•˜ì„¸ìš”.
â€» í›„ì—´ ë°œë™ì„ ëˆ„ë¥´ë©´ í„´ì´ ì§„í–‰ë˜ì–´, ì¹´ë“œì˜ ë°°ì¹˜ë¥¼ ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
ë³´ê¸‰ ë° ê·¸ì— ë”°ë¥¸ ë³€í™”ëŠ” ì •ë¦¬ ë‹¨ê³„ì—ì„œ ì²˜ë¦¬í•©ë‹ˆë‹¤.

ì†íŒ¨ëŠ” í„´ì´ ì¢…ë£Œë˜ì–´ë„ ìœ ì§€ë©ë‹ˆë‹¤.
ì¹´ë“œëŠ” ë§¤ í„´ë§ˆë‹¤ ì‚¬ìš©í•œ ë§Œí¼ ë½‘ìŠµë‹ˆë‹¤. ì¦‰, ì¹´ë“œë¡œ ì¸í•œ ë“œë¡œìš°ëŠ” íŒ¨ì˜ ë§¤ìˆ˜ ìžì²´ë¥¼ ëŠ˜ë¦¬ëŠ” íš¨ê³¼ê°€ ìžˆìŠµë‹ˆë‹¤.

[4] ìš©ì–´
- ì†Œëª¨: ì´ë²ˆ ì „íˆ¬ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ì—†ê²Œ ë˜ëŠ” ê²ƒìž…ë‹ˆë‹¤.
- ì†Œì‹¤: ëŸ° ì „ì²´ì—ì„œ í•´ë‹¹ ì¹´ë“œê°€ ì‚¬ë¼ì§€ëŠ” ê²ƒìž…ë‹ˆë‹¤.
- ì·¨ì•½: ë°›ëŠ” í”¼í•´ê°€ (ì·¨ì•½)ë§Œí¼ ì¦ê°€í•©ë‹ˆë‹¤.
- ì•½í™”: ì£¼ëŠ” í”¼í•´ê°€ (ì•½í™”)ë§Œí¼ ê°ì†Œí•©ë‹ˆë‹¤.
- ì¶œí˜ˆ: í„´ ì¢…ë£Œ ì‹œ (ì¶œí˜ˆ)ë§Œí¼ í”¼í•´ë¥¼ ìž…ìŠµë‹ˆë‹¤.
- êµëž€: ë‹¹ì‹ ì„ ë°©í•´í•©ë‹ˆë‹¤. ë¬´ì—‡ì¼ê¹Œìš”?

[5] ì¡°ìž‘

(ì»´í“¨í„°)
- 4: ì„ íƒ í•´ì œ
- Tab: ì†íŒ¨ ì„ íƒ ì´ë™
- 1~3: ì „ì—´ ë°°ì¹˜ / q,w,e: í›„ì—´ ë°°ì¹˜
- ë“œëž˜ê·¸: ì†íŒ¨â†’ìŠ¬ë¡¯ ë°°ì¹˜, ìŠ¬ë¡¯â†”ìŠ¬ë¡¯ ìŠ¤ì™‘, ìŠ¬ë¡¯â†’ì†íŒ¨ íšŒìˆ˜
- Space: ë‹¤ìŒ í„´
- P: ìƒˆë¡œìš´ ëŸ°

(ëª¨ë°”ì¼)
- ì†íŒ¨: í´ë¦­ ì‹œ ì„ íƒ, ê¸¸ê²Œ ëˆ„ë¥¼ ì‹œ í™•ëŒ€
- ì¹´ë“œ ì„ íƒ ìƒíƒœì—ì„œ ìŠ¬ë¡¯ì„ ëˆŒëŸ¬ ë°°ì¹˜
- ìŠ¬ë¡¯: í´ë¦­ ì‹œ í™•ëŒ€, ê¸¸ê²Œ ëˆ„ë¥¼ ì‹œ íšŒìˆ˜
- ìŠ¬ë¡¯ì— ë„£ì€ ì¹´ë“œëŠ” ì´ë¦„ë§Œ ë³´ìž…ë‹ˆë‹¤.

[6] ë‹¹ì‹ ì„ ìœ„í•œ ì¡°ì–¸

ë±ì€ ë‹¹ì‹ ì˜ ë¹„í’ˆìž…ë‹ˆë‹¤. ë¹„í’ˆì´ ì ìœ¼ë©´, ëŠ˜ ìƒˆë¡œ ê¾¸ë¦¬ëŠë¼ íž˜ë“¤ ê²ë‹ˆë‹¤. ë¹„í’ˆì´ ë§Žìœ¼ë©´, ë“¤ê³  ë‹¤ë‹ˆê¸° íž˜ë“¤ê² ì§€ìš”. ê· í˜•ì„ ì°¾ìœ¼ì„¸ìš”.

[7] ì‹œê°„

ì‹œê°„ì€ ê¸ˆìž…ë‹ˆë‹¤. ëª¨ë“  í–‰ë™ì€ ì‹œê°„ì„ ì†Œëª¨í•©ë‹ˆë‹¤. ì‹¸ì›€ì€ ì¢€ ë” ì†Œëª¨í• ì§€ë„ ëª¨ë¥´ê² êµ°ìš”.
ì¤‘ìš”í•œ ê±´ ì´ê³³ì´ ë‹¹ì‹ ì—ê²Œ ë„‰ë„‰í•œ ì‹œê°„ì„ ì£¼ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒì´ê² ì§€ìš”.
`;let on=null;function qt(){if(on)return on;const e=document.createElement("div");return e.id="itemHoverTip",e.className="itemHoverTip relicHoverTip",e.style.pointerEvents="none",e.style.position="fixed",e.style.left="0",e.style.top="0",e.style.zIndex="70000",document.body.appendChild(e),on=e,e}function fs(e){const t=qt(),n=Te(e);t.innerHTML="";const r=document.createElement("div");r.className="relicTipTitle",r.textContent=n?.name??e;const o=document.createElement("div");o.className="relicTipBody",o.textContent=n?.text??"",t.appendChild(r),t.appendChild(o)}function kn(e,t){const n=qt(),r=Gt(),o=12,a=14,s=o*r,i=a*r;let l=e+i,c=t+i;n.style.left=Me(l),n.style.top=Me(c);const m=n.getBoundingClientRect();l+m.width+s>window.innerWidth&&(l=window.innerWidth-m.width-s),c+m.height+s>window.innerHeight&&(c=window.innerHeight-m.height-s),l<s&&(l=s),c<s&&(c=s),n.style.left=Me(Math.round(l)),n.style.top=Me(Math.round(c))}function ms(e,t){fs(e),qt().classList.add("show"),kn(t.clientX,t.clientY),requestAnimationFrame(()=>kn(t.clientX,t.clientY))}function hs(){qt().classList.remove("show")}function Tn(e,t){e.addEventListener("mouseenter",n=>ms(t,n)),e.addEventListener("mousemove",n=>kn(n.clientX,n.clientY)),e.addEventListener("mouseleave",()=>hs())}const ys=new URL("/deck-rogue-prototype/",window.location.origin).href;function se(e){if(!e||/^(https?:|data:|blob:)/i.test(e))return e;const t=e.replace(/^\/+/,"");return new URL(t,ys).href}let ar=!1;function bs(){if(ar)return;ar=!0;const e=document.documentElement;if(e.style.setProperty("--bgUrl",`url("${se("assets/ui/background/dungeon_bg.png")}")`),e.style.setProperty("--boardUrl",`url("${se("assets/ui/boards/battle_board.png")}")`),e.style.setProperty("--cardUrl",`url("${se("assets/ui/cards/card_parchment.png")}")`),e.style.setProperty("--mapBgUrl",`url("${se("assets/ui/background/map_bg.png")}")`),!document.getElementById("deck-fontfaces")){const t=document.createElement("style");t.id="deck-fontfaces";const n=se("assets/fonts/Mulmaru.woff2"),r=se("assets/fonts/Mulmaru.woff");t.textContent=`@font-face {  font-family: "Mulmaru";  src: url("${n}") format("woff2"), url("${r}") format("woff");  font-weight: 400;  font-style: normal;  font-display: swap;}:root { --gameFont: "Mulmaru", system-ui, -apple-system, "Segoe UI", Arial, sans-serif; }body { font-family: var(--gameFont); }`,document.head.appendChild(t)}}function ks(e){return new Promise(t=>window.setTimeout(t,e))}function Ts(e){switch(e){case"BACK":return 100;case"FRONT":return 100;case"ENEMY":return 100;case"UPKEEP":return 100;case"DRAW":return 100;case"PLACE":return 0;default:return 220}}let an=!1;function vs(){document.querySelectorAll(".slot").forEach(e=>{const t=e.querySelector(".slotCardScaler");t&&oo(e,t)})}function xs(e){an||(an=!0,requestAnimationFrame(()=>{an=!1,Fn(),zn(),Kn(),vs()}))}let Cs=1,Ot=[],Es=1,Ht=[];function gs(e){const t=e,n=t.uiToasts??[];if(!n||n.length===0)return;const r=performance.now();for(const o of n){const a=String(o.kind??"INFO"),s=String(o.text??""),i=Math.max(200,Number(o.ms??1600)||1600);Ht.push({id:Es++,kind:a,text:s,born:r,ms:i})}t.uiToasts=[]}function Ss(){const e=performance.now(),t=Se();Ht=Ht.filter(n=>e-n.born<n.ms*t)}function ws(e){gs(e),Ss();let t=document.querySelector(".toastLayer");t||(t=document.createElement("div"),t.className="toastLayer",document.body.appendChild(t)),t.innerHTML="";for(const n of Ht){const r=document.createElement("div");r.className=`toast toast-${n.kind.toLowerCase()}`,r.textContent=n.text,t.appendChild(r)}}let Wr=null;function vt(e,t,n,r){Ot.push({id:Cs++,kind:e,text:t,x:n,y:r,born:performance.now()})}function _s(){const e=performance.now();Ot=Ot.filter(t=>e-t.born<Yt(700))}let St=null,wt=null,sn=[];function $s(e){if(!(!e.run.finished&&e.enemies.length>0&&e.phase!=="NODE")){St=null,wt=null,sn=[];return}if(St!=null){const n=e.player.hp-St;n!==0&&Ns(n)}if(wt!=null){const n=e.player.block-wt;n!==0&&As(n)}for(let n=0;n<e.enemies.length;n++){const r=e.enemies[n].hp,o=sn[n];o!=null&&r!==o&&Is(n,r-o)}St=e.player.hp,wt=e.player.block,sn=e.enemies.map(n=>n.hp)}function Ns(e){const t=document.querySelector(".playerHudBox")??document.querySelector(".playerHudLeft");if(!t)return;const n=t.getBoundingClientRect(),r=(n.left+n.right)/2,o=n.top+14;e<0?vt("dmg",`${e}`,r,o):vt("heal",`+${e}`,r,o),t.classList.add("fxFlash"),setTimeout(()=>t.classList.remove("fxFlash"),Yt(240))}function As(e){const t=document.querySelector(".playerHudBox")??document.querySelector(".playerHudLeft");if(!t)return;const n=t.getBoundingClientRect(),r=(n.left+n.right)/2,o=n.top+34;vt("block",e>0?`+${e}`:`${e}`,r,o)}function Is(e,t){const r=Array.from(document.querySelectorAll(".enemyHudCenter .enemyBanner"))[e];if(!r)return;const o=r.getBoundingClientRect(),a=(o.left+o.right)/2,s=o.top+14;t<0?vt("dmg",`${t}`,a,s):vt("heal",`+${t}`,a,s),r.classList.add("fxFlash"),setTimeout(()=>r.classList.remove("fxFlash"),Yt(240))}const Ur="deckrogue_uiSettings_v1";function Ve(e,t,n){return Math.max(t,Math.min(n,e))}function Kr(){try{const e=localStorage.getItem(Ur);if(!e)return{uiScaleDesktop:1,uiScaleMobile:1,slotCardMode:"FULL",animMul:1};const t=JSON.parse(e),n=t.slotCardMode==="NAME_ONLY"?"NAME_ONLY":"FULL";return{uiScaleDesktop:Ve(Number(t.uiScaleDesktop??1)||1,.75,1.5),uiScaleMobile:Ve(Number(t.uiScaleMobile??1)||1,.75,1.5),slotCardMode:n,animMul:Ve(Number(t.animMul??1)||1,0,2)}}catch{return{uiScaleDesktop:1,uiScaleMobile:1,slotCardMode:"FULL",animMul:1}}}let le=Kr();function zr(){const e=Bn()?le.uiScaleMobile:le.uiScaleDesktop;return Ve(e,.65,1.5)}function Gt(){const e=getComputedStyle(document.documentElement).getPropertyValue("--u"),t=parseFloat(e);return Number.isFinite(t)&&t>0?t:1}function Me(e){const t=Gt(),n=e/t;return"calc("+(Number.isFinite(n)?n:0)+" * var(--u))"}function Se(){return Ve(Number(le.animMul??1)||1,0,2)}function Yt(e){return Math.max(0,Math.round(e*Se()))}function Bn(){const e=window.innerWidth,t=window.matchMedia("(pointer: coarse)").matches;return e<=900&&t}let Ke=!1;function Ms(){try{const e=localStorage.getItem("deckrogue_logCollapsed");if(e==null)return;Ke=e==="1"}catch{}}function Ps(){try{localStorage.setItem("deckrogue_logCollapsed",Ke?"1":"0")}catch{}}let _t=null;function Rs(e){_t!=null&&window.clearTimeout(_t),_t=window.setTimeout(()=>{_t=null,ls(e)},250)}let ln=!1;async function Ls(e,t){if(e._justStartedCombat){e._justStartedCombat=!1;return}if(!ln){ln=!0;try{if(e.run.finished||e.choice||ae(e)||te||e.phase==="NODE")return;let n=0;for(;n++<60&&!(e.run.finished||e.choice||te||ae(e));){const r=ro(e,t,!1);if(!r.fn||r.disabled)break;const o=e.phase;if(r.fn(),A(e,t),e.phase==="PLACE")break;const a=Ts(o);a>0&&await ks(Yt(a))}}finally{ln=!1}}}function jr(e){const t=e.run;t.timeMove==null&&(t.timeMove=e.run.nodePickCount??0),t.nextBossTime==null&&(t.nextBossTime=40),t.forcedNext==null&&(t.forcedNext=null)}function Bs(e,t){const n=e;return n.content=t,n.time??=0,n.run.relics??=[],n.run??={},n.run.timeMove??=n.run.nodePickCount??0,n.run.nextBossTime??=40,n.run.forcedNext??=null,n.run.bossOmenText??=null,n.run.enemyLastSeenBattle??={},n.run.nodePickByType??={BATTLE:0,ELITE:0,REST:0,EVENT:0,TREASURE:0},n.run.bossPool??=["boss_gravity_master","boss_cursed_wall","boss_giant_orc","boss_soul_stealer"],n.run.nextBossId??=null,n.run.lastBattleWasElite??=!1,n.run.lastBattleWasBoss??=!1,n.run.rewardPityNonElite??=0,n.run.gold??=0,n.run.pendingEventWinGold??=0,n.run.items??=[],n.run.itemOfferedThisBattle??=!1,n.run.afterTreasureNodePicks??=0,n.run.deckSizeAtTreasure??=null,n.run.treasureObtained&&n.run.deckSizeAtTreasure==null&&(n.run.deckSizeAtTreasure=Pr(n)),n.choiceStack??=[],n.pendingTargetQueue??=[],n.exhausted??=[],n.vanished??=[],n.choiceQueue??=[],n.choiceCtx??=null,n}function Os(e){if(!ss())return fn(e);const t=cs();return t?Bs(t.state,e):fn(e)}function Hs(){if(document.querySelector(".bgLayer"))return;const e=document.createElement("div");e.className="bgLayer",document.body.appendChild(e)}let sr=0,ir=0,we=null,Vr=0;function Xt(){try{qr.hide()}catch{}const e=document.querySelector(".cardHoverPreview");e&&e.classList.remove("on")}function On(e=250){Vr=performance.now()+e}const qr=Ds();function Ds(){let e=null,t=null,n=null,r=null;function o(i){if(e)return;e=v("cardHoverPreview"),t=v("cardHoverPreviewTitle");const l=v("cardHoverPreviewRow");n=v("cardHoverPreviewCard"),r=v("cardHoverPreviewDetail"),l.appendChild(n),l.appendChild(r),e.appendChild(t),e.appendChild(l),i.appendChild(e)}function a(i){!e||!t||!n||!r||(t.textContent=i.title,n.innerHTML="",i.cardEl&&n.appendChild(i.cardEl),r.textContent=i.detail,e.classList.add("on"))}function s(){e&&e.classList.remove("on")}return{ensure:o,show:a,hide:s}}function Dt(e,t){const n=e.cards[t];return pe(e.content,n.defId,n.upgrade??0)}function Ft(e,t){return e.content.cardsById[t]?.name??t}function Fs(e,t,n){const r=n??0,o=e.content.cardsById[t]?.name??t;return r>0?`${o} +${r}`:o}function be(e,t){const n=e.cards[t];return Fs(e,n.defId,n.upgrade??0)}function dt(e,t,n,r,o){const a=e.cards[t],s=pe(e.content,a.defId,a.upgrade??0),i=o?.draggable??!0,l=o?.mode??"FULL",c=v("card"),m=s.rarity??(String(a.defId).startsWith("mad_")?"MADNESS":void 0)??(["arrow","shield","scout","field_ration","maintenance","power_arrow","goal_treasure"].includes(String(a.defId))?"BASIC":"COMMON");c.classList.add(`rarity-${String(m).toLowerCase()}`),e.selectedHandCardUid===t&&c.classList.add("selected"),s.tags?.includes("EXHAUST")&&c.classList.add("exhaust"),s.tags?.includes("VANISH")&&c.classList.add("vanish"),l==="SLOT_NAME_ONLY"&&c.classList.add("slotNameOnly");const u=v("cardHeader"),d=Yr(e,t);if(u.appendChild(J("cardTitle",d)),l==="FULL"){const b=v("cardMeta");s.tags?.includes("EXHAUST")&&b.appendChild(xn("")),s.tags?.includes("VANISH")&&b.appendChild(xn("")),u.appendChild(b)}if(c.appendChild(u),l==="FULL"){const b=v("cardBody"),E=v("cardSection");E.classList.add("front"),E.appendChild(cr(s.frontText)),b.appendChild(E);const p=v("cardSection");p.classList.add("back"),p.appendChild(cr(s.backText)),b.appendChild(p),c.appendChild(b)}if(n&&r&&(c.onclick=()=>r(t)),n&&(c.onpointerdown=b=>{if(b.button!==0&&b.pointerType==="mouse"||ae(e)||e.phase!=="PLACE"||!i)return;const E=e.hand.indexOf(t);ao(b,{kind:"hand",cardUid:t,fromHandIndex:E})}),o?.hoverPreview){const{root:b,api:E,buildDetail:p}=o.hoverPreview;E.ensure(b);const f=p?.(e,t)??(()=>{const h=Wt(s.frontText),x=Wt(s.backText);return`ì „ì—´: ${h||"ì—†ìŒ"}
í›„ì—´: ${x||"ì—†ìŒ"}`})();c.addEventListener("pointerenter",h=>{if(performance.now()<Vr||W?.dragging)return;const x=dt(e,t,!1,void 0,{draggable:!1,mode:"FULL"});x.classList.add("isPreviewCard"),E.show({title:d,detail:f,cardEl:x})}),c.addEventListener("pointerleave",()=>{E.hide()}),c.addEventListener("pointerdown",()=>{On(250),Xt()},{capture:!0})}return c}function Wt(e){if(!e)return"";if(typeof e=="string")return e;if(Array.isArray(e))return e.map(Wt).join("");if(typeof e=="object"){if(e.text)return String(e.text);if(e.children)return Wt(e.children)}return""}function v(e){const t=document.createElement("div");return t.className=e,t}function J(e,t){const n=document.createElement("div");return n.className=e,n.textContent=t,n}function Ws(e){const t=document.createElement("h2");return t.textContent=e,t}function vn(e){const t=document.createElement("h3");return t.textContent=e,t}function Hn(e){const t=document.createElement("p");return t.textContent=e,t}function xn(e){const t=document.createElement("span");return t.className="badge",t.textContent=e,t}function Fe(e,t,n){const r=document.createElement("button");return r.textContent=e,r.disabled=n,r.onclick=t,r}function Us(e){const t=document.createElement("pre");return t.className="log",t.textContent=e,t}function Gr(e,t){const n=t??0;return n>0?`${e} +${n}`:e}function Yr(e,t){const n=e.cards[t],r=e.content.cardsById[n.defId].name;return Gr(r,n.upgrade)}function Ks(e,t){const n=e.content.cardsById[t.defId].name;return Gr(n,t.upgrade)}const zs={ì·¨ì•½:"ðŸŽ¯",ì•½í™”:"ðŸ¥€",ì¶œí˜ˆ:"ðŸ©¸",êµëž€:"ðŸŒ€",ë©´ì—­:"âœ¨",S:"ðŸž",F:"ðŸ’¤",ë“œë¡œìš°:"ðŸƒ",í”¼í•´:"ðŸ—¡ï¸",íšŒë³µ:"ðŸ’Š",ë°©ì–´:"ðŸ›¡ï¸",ë¸”ë¡:"ðŸ›¡ï¸",ì†Œëª¨:"ðŸ”¥",ì†Œì‹¤:"ðŸ•³ï¸"};function lr(e,t,n){const r=zs[e]??"",o=t!=null?`${e} ${t}`:e;return`<span class="kwBadge"><span class="kwIcon">${r}</span> <span class="kwLabel">${o}</span><span class="kwPunc">${n||""}</span></span>`}const Xr="[,ï¼Œã€]",js=new RegExp(`(ì·¨ì•½|ì•½í™”|ì¶œí˜ˆ|êµëž€|ë©´ì—­|S|F|ë“œë¡œìš°|í”¼í•´|ë°©ì–´|ë¸”ë¡|íšŒë³µ|ì†Œëª¨|ì†Œì‹¤)\\s*([+-]?\\d+)\\s*(${Xr})?`,"g"),Vs=new RegExp(`(^|[^ê°€-íž£A-Za-z0-9_])(ì†Œëª¨|ì†Œì‹¤)\\s*(${Xr})?`,"g");function qs(e){let t=e.replace(js,(n,r,o,a)=>lr(r,o,a));return t=t.replace(Vs,(n,r,o,a)=>`${r}${lr(o,void 0,a)}`),t=t.replace(/\n/g,"<br>"),t}function cr(e){const t=v("cardText");return t.innerHTML=qs(e),t}function Gs(e){return se(`assets/enemies/${e}.png`)}const dr={vuln:"ðŸŽ¯",weak:"ðŸ¥€",bleed:"ðŸ©¸",disrupt:"ðŸŒ€",immune:"âœ¨",supplies:"ðŸž",fatigue:"ðŸ’¤"};function Qr(e){return e==="ATTACK"||e==="ATTACK_BUFF"||e==="ATTACK_DEBUFF"}function Ys(e,t,n){if(!n||!Qr(n.cat))return"";const r=Math.max(1,Number(n.hits??1)||1),o=Math.max(0,Number(n.perHit??0)||0),a=Math.max(0,Number(n.dmgTotal??o*r)||0);if(r>1){if(o<=0)return`${a} (${r}íƒ€)`;const s=o*r;if(a===s)return`${a} (${o}x${r})`;const i=Math.max(0,Number(e.player?.block??0)||0);if(i>0){let l=i;const c=[];for(let u=0;u<r;u++){const d=Math.min(l,o);l-=d,c.push(o-d)}if(c.reduce((u,d)=>u+d,0)===a)return c.every(d=>d===c[0])?`${a} (${c[0]}x${r})`:`${a} (${c.join("+")})`}return`${a} (${o}x${r})`}return`${a}`}function Xs(e){if(!e)return"?";const t=Qr(e.cat),n=e.applies??[],r=n.some(s=>s.target==="player"),o=n.some(s=>s.target==="enemy");let a="";if(t&&(a+="ðŸ—¡ï¸"),r&&(a+="ðŸŒ€"),o&&(a+="âœ¨"),!a){const s=e.cat;return s==="DEFEND"?"ðŸ›¡ï¸":s==="BUFF"?"âœ¨":s==="DEBUFF"?"ðŸŒ€":"?"}return a}function Qs(e,t){const n=v("enemyStatusEmojiRow"),r=(o,a)=>{if(!a||a<=0)return;const s=document.createElement("span");s.className="stEmoji",s.textContent=`${dr[o]??"?"}${a}`,n.appendChild(s)};if(r("vuln",e?.vuln??0),r("weak",e?.weak??0),r("bleed",e?.bleed??0),r("disrupt",e?.disrupt??0),t){const o=document.createElement("span");o.className="stEmoji",o.textContent=`${dr.immune}1`,n.appendChild(o)}return n}let te=null,ur=!1,W=null,Ne=null,Cn=!1,Xe=!1,Ee=null,Oe=null;function Zs(){Ee=null,Oe=null,document.querySelector(".relicTooltip")?.remove()}function Zr(){Xt(),Zs(),document.querySelectorAll(".itemHoverTip").forEach(e=>{e.classList.remove("show"),e.innerHTML=""})}let ze=null;function pr(e,t,n){const r=e.cards[t];return $t(e,r.defId,n)}function nt(e,t,n){const o=dt(e,t,!!n,n,{draggable:!1});return o.classList.add("overlayCard"),o}function $t(e,t,n){const r=`__preview:${t}:${n}:${Math.random().toString(36).slice(2)}`,o=e.cards[r];e.cards[r]={uid:r,defId:t,upgrade:n,zone:"preview"};const a=dt(e,r,!1,void 0,{draggable:!1});return a.classList.add("overlayCard"),a.draggable=!1,a.style.pointerEvents="none",o?e.cards[r]=o:delete e.cards[r],a}const Qe="ï¸Ž";function xt(e,t){return e==="BATTLE"?t?{icon:"â˜ "+Qe,text:"ë³´ìŠ¤",kind:"boss"}:{icon:"âš”"+Qe,text:"ì „íˆ¬",kind:"battle"}:e==="ELITE"?{icon:"â˜ "+Qe,text:"ì •ì˜ˆ",kind:"elite"}:e==="REST"?{icon:"â›ºï¸Ž"+Qe,text:"íœ´ì‹",kind:"rest"}:e==="EVENT"?{icon:"â”ï¸Ž"+Qe,text:"ë¯¸ì§€",kind:"event"}:e==="SHOP"?{icon:"Â¤"+Qe,text:"ìƒì ",kind:"shop"}:{icon:"âœ¦",text:"ë³´ë¬¼",kind:"treasure"}}function Js(e,t,n){const r=xt(t,n),o=document.createElement("span");o.className=`nodeIcon ${r.kind}`,o.textContent=r.icon;const a=document.createElement("span");a.className="nodeText",a.textContent=`(${r.text})`,e.appendChild(o),e.appendChild(a)}function rt(e){return Math.max(0,Math.min(1,e))}function cn(e,t,n){return Math.max(t,Math.min(n,Math.floor(e)))}function Qt(e){const t=e.run;if(t.timeMove??=0,t.vision??={mode:"NORMAL",presenceR:2,typeR:1,detailR:0,noise:0},t.pursuit??={heat:0},!t.map)t.map=ni();else{const o=t.map;if(Array.isArray(o.nodes)){const a={};for(const s of o.nodes)a[String(s.id)]=s;o.nodes=a}}const n=t.map;if(!Object.keys(n?.nodes??{}).every(o=>typeof n.nodes[o]?.order=="number"))try{eo(n,2)}catch{}try{Dn(n)}catch{}return{map:t.map,vision:t.vision,pursuit:t.pursuit,timeMove:t.timeMove}}function Jr(e){const t=e.run,n=Number(t.timeMove??0)||0,r=Number(e.time??0)||0;return n+r}function Ut(e){return e>=14?3:e>=9?2:e>=5?1:0}function lt(e,t,n){const r={},o=[];for(r[t]=0,o.push(t);o.length;){const a=o.shift(),s=r[a]??0;if(s>=n)continue;const i=e.edges[a]??[];for(const l of i)r[l]==null&&(r[l]=s+1,o.push(l))}return r}function Dn(e){const t=e;return t.seen||(t.seen={}),t.seen[e.pos]=3,t.seen}function ei(e,t){const n=Dn(e),r=Math.max(0,t.presenceR|0),o=lt(e,e.pos,r);for(const a of Object.keys(o)){const s=o[a]??0,i=Kt(s,t),l=n[a]??0;i>l&&(n[a]=i)}n[e.pos]=3}function ti(e,t){return(e.seen??{})[t]??0}function eo(e,t=2){const n=Object.keys(e.nodes);if(n.length<=2)return;e.edges??={};for(const u of Object.keys(e.edges))for(const d of(e.edges[u]??[]).slice())e.edges[d]??=[],e.edges[d].includes(u)||e.edges[d].push(u);const r=u=>Number(e.nodes[u]?.depth??999),o=u=>Number(e.nodes[u]?.order??0),a=u=>(e.edges[u]??[]).length,s=n.every(u=>{const d=r(u);return d>=0&&d<900&&typeof e.nodes[u]?.order=="number"}),i=new Map;if(s){for(const u of n){const d=r(u);i.has(d)||i.set(d,[]),i.get(d).push(u)}for(const[u,d]of i)d.sort((b,E)=>o(b)-o(E)||b.localeCompare(E))}const l=u=>{const d=i.get(u)??[],b=i.get(u+1)??[],E=new Map,p=new Map;for(let h=0;h<d.length;h++)E.set(d[h],h);for(let h=0;h<b.length;h++)p.set(b[h],h);const f=[];for(const h of d)for(const x of e.edges[h]??[]){if(r(x)!==u+1)continue;const k=E.get(h),N=p.get(x);k==null||N==null||f.push([k,N])}return{left:d,right:b,li:E,ri:p,pairs:f}},c=(u,d)=>{const b=r(u);if(r(d)!==b+1)return!0;const{li:p,ri:f,pairs:h}=l(b),x=p.get(u),k=f.get(d);if(x==null||k==null)return!0;for(const[N,I]of h)if(x<N&&k>I||x>N&&k<I)return!0;return!1},m=u=>{e.edges[u]??=[];const d=new Set(e.edges[u]??[]),b=r(u);let E=n.filter(f=>f!==u&&!d.has(f));if(E.length===0||s&&(E=E.filter(f=>Math.abs(r(f)-b)===1),E.length===0||(E=E.filter(f=>{const h=r(u),x=r(f),k=h<x?u:f,N=h<x?f:u;return!c(k,N)}),E.length===0)))return!1;E.sort((f,h)=>a(h)-a(f));const p=E[0];return e.edges[u].push(p),e.edges[p]??=[],e.edges[p].push(u),!0};for(let u=0;u<200;u++){const d=n.filter(E=>a(E)<t);if(d.length===0)break;let b=!1;for(const E of d)for(;a(E)<t&&m(E);)b=!0;if(!b)break}}function ni(){const t={},n={},r=Array.from({length:18},(m,u)=>`n${u}`);n[r[0]]=[],t[r[0]]={id:r[0],kind:"START",visited:!0,cleared:!0,depth:0};for(let m=1;m<r.length;m++){const u=r[m],d=r[Math.floor(Math.random()*m)];n[u]??=[],n[d]??=[],n[u].push(d),n[d].push(u),t[u]={id:u,kind:"BATTLE",visited:!1,cleared:!1}}const o=10;for(let m=0;m<o;m++){const u=r[Math.floor(Math.random()*r.length)],d=r[Math.floor(Math.random()*r.length)];u!==d&&(n[u]??=[],n[d]??=[],!n[u].includes(d)&&(n[u].push(d),n[d].push(u)))}const a={pos:r[0],startId:r[0],nodes:t,edges:n,treasureId:r[r.length-1]};eo(a,2);const s=lt(a,r[0],999);let i=r[1],l=-1;for(const m of r){const u=s[m]??999;t[m].depth=u,m!==r[0]&&u>l&&(l=u,i=m)}for(const m of r)m!==r[0]&&(t[m].kind="BATTLE");const c=["BATTLE","BATTLE","BATTLE","EVENT","REST","ELITE"];for(const m of r){if(m===r[0]||m===i)continue;const u=c[Math.floor(Math.random()*c.length)];t[m].kind=u}return t[i].kind="TREASURE",{pos:r[0],startId:r[0],nodes:t,edges:n,visionNonce:1,treasureId:i}}function ri(e){const{vision:t,pursuit:n}=Qt(e),r=e.run,o=Number(r.timeMove??0)||0,a=t;a.forceModeUntilMove!=null&&o>=Number(a.forceModeUntilMove)&&(a.forceModeUntilMove=null,a.forceMode=null),a.switchLockedUntilMove!=null&&o>=Number(a.switchLockedUntilMove)&&(a.switchLockedUntilMove=null);let s=a.forceMode??t.mode??"NORMAL",i=Number(t.presenceR??2)||0,l=Number(t.typeR??1)||0,c=Number(t.detailR??0)||0,m=rt(Number(t.noise??.08)||0);if(s==="FOCUS"?(i-=1,l-=1,c+=1,m*=.6):s==="WIDE"&&(i+=1,l+=1,c+=0,m=rt(m*1.35)),e.run.treasureObtained){const d=Ut(n.heat??0);i+=d>=2?1:0,l-=d,c-=Math.max(0,d-1),m=rt(m+d*.07)}const u=Math.max(0,Number(e.player.fatigue??0)||0);if(u>0){const d=Math.floor(u/14),b=Math.floor(u/6),E=Math.floor(u/10);i-=d,l-=b,c-=E,m=rt(m+Math.min(.3,u*.015))}return i=cn(i,0,99),l=cn(l,0,i),c=cn(c,0,l),m=0,{mode:s,presenceR:i,typeR:l,detailR:c,noise:m}}function Kt(e,t){return e<=0||e<=t.detailR?3:e<=t.typeR?2:e<=t.presenceR?1:0}function zt(e,t,n,r,o){return r===0?{shown:null,label:"ë³´ì´ì§€ ì•ŠìŒ",certainty:"HIDDEN"}:r===1?{shown:null,label:"ë¬´ì–¸ê°€",certainty:"PRESENCE"}:n==="START"?{shown:null,label:"ìž…êµ¬",certainty:r===3?"DETAIL":"TYPE"}:n==="EMPTY"?{shown:null,label:"ì§€ë‚˜ê°„ ê³³",certainty:"PRESENCE"}:r===3?{shown:n,label:xt(n,!1).text,certainty:"DETAIL"}:{shown:n,label:xt(n,!1).text,certainty:"TYPE"}}function oi(e,t){const n=v("mapNodeLine");if(n.style.cssText="display:flex; gap:calc(8 * var(--u)); align-items:center;",t.shown)Js(n,t.shown,!1);else{const r=document.createElement("span");r.className="nodeText",r.textContent=`(${t.label})`,n.appendChild(r)}e.appendChild(n)}function ai(e){const t=Object.keys(e.nodes);if(t.length===0||t.every(a=>{const s=e.nodes[a]?.depth,i=Number(s);return s!=null&&Number.isFinite(i)&&i>=0&&i<900}))return;const r=Object.values(e.nodes).find(a=>a.kind==="START")?.id??e.pos??t[0],o=lt(e,r,999);for(const a of t){const s=e.nodes[a]?.depth;if(s!=null&&Number.isFinite(Number(s))&&Number(s)<900)continue;const i=o[a];e.nodes[a].depth=i??e.nodes[a].depth??999}}function si(e){ai(e);const t=Object.keys(e.nodes),n=t.every($=>typeof e.nodes[$]?.order=="number"),r=new Map;let o=0;for(const $ of t){const g=Number(e.nodes[$]?.depth??999),M=Number.isFinite(g)?g:999;o=Math.max(o,M),r.has(M)||r.set(M,[]),r.get(M).push($)}const a=Array.from(r.keys()).sort(($,g)=>$-g),s=a.filter($=>$<900).length?Math.max(...a.filter($=>$<900)):o,i=a.some($=>$>=900),l=s+(i?1:0),c=80,m=64,u=54,d=40,b=$=>{const g=Number(e.nodes[$]?.depth??999),M=Number.isFinite(g)?g:999;return M>=900?s+1:M},E=Array.from({length:l+1},($,g)=>g),p={};for(const $ of E)p[$]=[];for(const $ of t){const g=b($);p[g].push($)}for(const $ of E)p[$].sort((g,M)=>(e.nodes[g].order??0)-(e.nodes[M].order??0)||g.localeCompare(M));const f=$=>{const g=new Map,M=p[$]??[];for(let U=0;U<M.length;U++)g.set(M[U],U);return g},h=$=>e.edges[$]??[],x=$=>{if($==="LR")for(let g=1;g<=l;g++){const M=p[g-1];if(!M||M.length===0)continue;const U=f(g-1);p[g].sort((R,T)=>{const _=k(R,U,g-1),w=k(T,U,g-1);return _!==w?_-w:R.localeCompare(T)})}else for(let g=l-1;g>=0;g--){const M=p[g+1];if(!M||M.length===0)continue;const U=f(g+1);p[g].sort((R,T)=>{const _=k(R,U,g+1),w=k(T,U,g+1);return _!==w?_-w:R.localeCompare(T)})}},k=($,g,M)=>{const U=h($);let V=0,R=0;for(const T of U){if(b(T)!==M)continue;const _=g.get(T);_!=null&&(V+=_,R+=1)}if(R===0){const T=b($),_=(p[T]??[]).indexOf($);return _<0?9999:_}return V/R};if(!n)for(let $=0;$<4;$++)x("LR"),x("RL");let N=1;for(const $ of E)N=Math.max(N,p[$]?.length??0);const I=N*m,C=d*2+I,K=u*2+(l+1)*c,L={};for(const $ of E){const g=p[$]??[],M=g.length,U=M*m,V=(I-U)/2,R=u+$*c;for(let T=0;T<M;T++){const _=g[T],w=d+V+(T+.5)*m;L[_]={x:R,y:w,depth:Number(e.nodes[_]?.depth??999)}}}return{width:K,height:C,pos:L,maxDepth:l,maxCount:N}}function ii(e,t,n){return n?"â—Ž":t==="HIDDEN"?"":t==="PRESENCE"?"Â·":e?xt(e,!1).icon:"?"}function li(e,t,n,r,o,a){const s=si(r),i=Dn(r),l=lt(r,r.pos,Math.max(0,o.presenceR|0)),c=H=>H===r.pos||(i[H]??0)>0,m=Object.keys(r.nodes).filter(c);m.includes(r.pos)||m.push(r.pos);const u=70;let d=1/0,b=1/0,E=-1/0,p=-1/0;for(const H of m){const j=s.pos[H];j&&(d=Math.min(d,j.x),b=Math.min(b,j.y),E=Math.max(E,j.x),p=Math.max(p,j.y))}Number.isFinite(d)||(d=0,b=0,E=300,p=200);const f=d-u,h=b-u,x=E-d+u*2,k=p-b+u*2,N=1.4,I=460,C="#0B0B0B",K="#B34A46",L="rgba(242,241,234,.70)",$="rgba(242,241,234,.34)",g="rgba(179,74,70,.34)",M=C,U=v("mapMiniBox");U.style.cssText="margin-top:calc(12 * var(--u)); border:0 solid rgba(255,255,255,.12); border-radius:calc(12 * var(--u)); background:rgba(0,0,0,0); padding:calc(10 * var(--u));";const V=J("","");V.style.cssText="font-weight:700; margin-bottom:calc(8 * var(--u)); opacity:.95;",U.appendChild(V);const R=v("mapMiniScroller"),T=v("mapMiniViewport");R.appendChild(T),R.style.cssText=`position:relative; overflow:auto; max-height:calc(${I} * var(--u)); border-radius:calc(10 * var(--u)); background:rgba(255,255,255,.0);`,T.addEventListener("wheel",H=>{Math.abs(H.deltaY)>Math.abs(H.deltaX)&&(T.scrollLeft+=H.deltaY,H.preventDefault())},{passive:!1});const _=document.createElementNS("http://www.w3.org/2000/svg","svg");_.setAttribute("viewBox",`${f} ${h} ${x} ${k}`),_.style.width=`calc(${x*N} * var(--u))`,_.style.height=`calc(${k*N} * var(--u))`,_.setAttribute("preserveAspectRatio","xMidYMid meet"),_.style.display="block";const w=document.createElementNS("http://www.w3.org/2000/svg","g"),S=document.createElementNS("http://www.w3.org/2000/svg","g");_.appendChild(w),_.appendChild(S);const B=new Set(r.edges[r.pos]??[]),P=(H,j,z)=>{const q=Math.max(0,Math.min(3,z));return zt(t,H,j,q,{...o})},O=(H,j)=>{const z=H.x,q=H.y,Q=j.x,G=j.y,Y=Math.abs((H.depth??0)-(j.depth??0));if(Y===0)return`M ${z} ${q} L ${Q} ${G}`;if(Y>=2){const Pe=38+10*Y,ue=Math.max(z,Q)+Pe;return`M ${z} ${q} C ${ue} ${q}, ${ue} ${G}, ${Q} ${G}`}const Z=Q-z,ne=z+Z*.35,de=z+Z*.65;return`M ${z} ${q} C ${ne} ${q}, ${de} ${G}, ${Q} ${G}`},D=new Set(m);for(const H of m)for(const j of r.edges[H]??[]){if(H>=j||!D.has(j))continue;const z=r.nodes[H]?.depth,q=r.nodes[j]?.depth;if(z!=null&&q!=null&&Math.abs(Number(z)-Number(q))>1)continue;const Q=s.pos[H],G=s.pos[j];if(!Q||!G)continue;const Y=document.createElementNS("http://www.w3.org/2000/svg","path");Y.setAttribute("d",O(Q,G)),Y.setAttribute("fill","none"),Y.setAttribute("stroke",L),Y.setAttribute("stroke-width","2"),w.appendChild(Y)}const F=m.slice().sort((H,j)=>H.localeCompare(j));for(const H of F){const j=s.pos[H];if(!j)continue;const z=r.nodes[H],q=z?.kind??"BATTLE",Q=l[H],G=H===r.pos?3:Q==null?0:Kt(Q,o),Y=i[H]??0,Z=G>0?zt(t,H,q,G):P(H,q,Y),ne=H===r.pos,de=B.has(H),Pe=q==="START";if(ne){const he=document.createElementNS("http://www.w3.org/2000/svg","circle");he.setAttribute("cx",String(j.x)),he.setAttribute("cy",String(j.y)),he.setAttribute("r",String(22)),he.setAttribute("fill","none"),he.setAttribute("stroke",K),he.setAttribute("stroke-width",String(3.5)),he.setAttribute("opacity","0.55"),he.style.filter="drop-shadow(0 0 calc(6 * var(--u)) rgba(179,74,70,.65))",S.appendChild(he)}const ue=document.createElementNS("http://www.w3.org/2000/svg","circle");ue.setAttribute("cx",String(j.x)),ue.setAttribute("cy",String(j.y)),ue.setAttribute("r",String(ne?13:10));const lo=ne||de;ue.setAttribute("fill",lo?g:$),ue.setAttribute("stroke","none"),ue.setAttribute("stroke-width","0"),ue.style.cursor=de&&!ne?"pointer":"default",de&&!ne&&ue.addEventListener("click",he=>{he.preventDefault(),he.stopPropagation(),n.onMoveToNode?.(H)});const jn=document.createElementNS("http://www.w3.org/2000/svg","title"),co=(z?.cleared||z?.visited,"");jn.textContent=`${co}`,ue.appendChild(jn),S.appendChild(ue);const xe=document.createElementNS("http://www.w3.org/2000/svg","text");xe.setAttribute("x",String(j.x)),xe.setAttribute("y",String(j.y)),xe.setAttribute("dominant-baseline","central"),xe.setAttribute("text-anchor","middle"),xe.setAttribute("font-size","14"),xe.setAttribute("fill",M),xe.style.pointerEvents="none",xe.style.userSelect="none";const uo=ii(Z.shown,Z.certainty,Pe);xe.textContent=uo,xe.style.opacity="0.95",S.appendChild(xe)}T.appendChild(_),U.appendChild(R),requestAnimationFrame(()=>{const H=s.pos[r.pos];if(!H)return;const j=zr(),z=(H.x-f)*j*N,q=(H.y-h)*j*N,Q=Math.max(0,z-T.clientWidth*.45),G=Math.max(0,q-T.clientHeight*.45);T.scrollLeft=Q,T.scrollTop=G});const X=J("","");X.style.cssText="margin-top:calc(8 * var(--u)); font-size:calc(12 * var(--u)); opacity:.8; line-height:1.3;",U.appendChild(X),e.appendChild(U)}function ci(e,t,n){const{map:r,timeMove:o,pursuit:a}=Qt(t),s=ri(t);ei(r,s);const i=v("nodeSelectWrap");i.classList.add("mapNodeSelect");const l=v("nodeSelectHeader");l.style.cssText="display:flex; align-items:flex-end; justify-content:space-between; gap:calc(16 * var(--u));";const c=v("nodeSelectTitle"),m=Jr(t),u=t.run.nodePickCount??0;c.appendChild(J("",`ì´ ì‹œê°„ ${m} Â· íƒí—˜ ${u} Â· ì´ë™ ${o}`)),jr(t);const d=t.run,b=Number(d.nextBossTime??40)||40,E=Math.max(0,b-m),p=t.run.bossOmenText&&String(t.run.bossOmenText).trim()!==""?String(t.run.bossOmenText):"ì•„ì§ ì§•ì¡°ê°€ ì—†ë‹¤.";if(c.appendChild(J("",`ë‹¤ìŒ ë³´ìŠ¤ê¹Œì§€ ${E} Â· ${p}`)),E<=3){const x=t.run;(Number(x.bossApproachToastBossTime??-1)||-1)!==b&&(x.bossApproachToastBossTime=b,me(t,"WARN",`ë³´ìŠ¤ê°€ ë‹¤ê°€ì˜µë‹ˆë‹¤ (ë‚¨ì€ ì´ë™ ${E})`,2200))}if(t.run.treasureObtained){const x=lt(r,r.pos,9999)[r.startId],k=x==null?"?":String(x);c.appendChild(J("",`ì¶”ê²© ${a.heat??0} (tier ${Ut(a.heat??0)}) Â· ìž…êµ¬ê¹Œì§€ ${k}`))}const f=v("nodeSelectHeaderRight"),h=ie(Xe?"ìƒì„¸ ë‹«ê¸°":"ìƒì„¸",()=>{Xe=!Xe,A(t,n)});if(h.style.cssText="margin-left:calc(-30 * var(--u)); padding:calc(2 * var(--u)) calc(5 * var(--u)); opacity:.9;",f.appendChild(h),l.appendChild(c),l.appendChild(f),i.appendChild(l),li(i,t,n,r,s),Xe){const x=v("mapDetailPanel");x.style.cssText="position:fixed; right:calc(24 * var(--u)); top:calc(24 * var(--u)); width:min(calc(520 * var(--u)), calc(100vw - calc(64 * var(--u)))); max-height:calc(100vh - calc(64 * var(--u))); overflow-y:auto; overflow-x:hidden; z-index:70001; border:calc(1 * var(--u)) solid rgba(255,255,255,.14); border-radius:calc(14 * var(--u)); background:rgba(0,0,0,1); backdrop-filter:none; padding:calc(12 * var(--u));",x.addEventListener("click",g=>g.stopPropagation()),x.addEventListener("wheel",g=>g.stopPropagation(),{passive:!0});const k=g=>{const M=g.target;M&&x.contains(M)||(Xe=!1,document.removeEventListener("pointerdown",k,!0),A(t,n))},N=v("");N.style.cssText="display:flex; align-items:center; justify-content:space-between; gap:calc(10 * var(--u));";const I=J("","ì§€ë„ ìƒì„¸");I.style.cssText="font-weight:700; opacity:.95;",N.appendChild(I);const C=ie("ë‹«ê¸°",()=>{Xe=!1,A(t,n)});C.style.cssText="padding:calc(6 * var(--u)) calc(10 * var(--u)); opacity:.9;",N.appendChild(C),x.appendChild(N);const K=v("");K.style.cssText="margin-top:calc(10 * var(--u)); padding:calc(10 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.10); border-radius:calc(12 * var(--u)); background:rgba(255,255,255,.03);";const L=vn("ì´ë™ ê°€ëŠ¥í•œ ì´ì›ƒ");L.style.margin="0 0 calc(6 * var(--u)) 0",K.appendChild(L);const $=r.edges[r.pos]??[];$.length===0&&K.appendChild(Hn("ì´ì›ƒì´ ì—†ìŠµë‹ˆë‹¤."));for(let g=0;g<$.length;g++){const M=$[g],V=r.nodes[M]?.kind??"BATTLE",R=s.presenceR>=1?Kt(1,s):0,T=ti(r,M),_=R>0?zt(t,M,V,R):T>=2?V==="START"?{shown:null,label:"ìž…êµ¬"}:{shown:V,label:xt(V,!1).text}:T===1?{shown:null,label:"ë¬´ì–¸ê°€"}:{shown:null,label:"ë³´ì´ì§€ ì•ŠìŒ"},w=v("");w.style.cssText="display:flex; align-items:center; gap:calc(10 * var(--u)); padding:calc(8 * var(--u)) calc(10 * var(--u)); border-radius:calc(10 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.10); background:rgba(0,0,0,.20);margin-top:calc(6 * var(--u));";const S=J("",R>0||T>0?`${M}`:`ì¶œêµ¬ ${g+1}`);S.style.cssText="flex:0 0 auto; padding:calc(4 * var(--u)) calc(8 * var(--u)); border-radius:calc(10 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.14); background:rgba(0,0,0,.25); opacity:.9;",w.appendChild(S);const B=v("");B.style.cssText="flex:1 1 auto; min-width:0;",oi(B,_),w.appendChild(B),K.appendChild(w)}if(x.appendChild(K),s.presenceR>=2){const g=lt(r,r.pos,s.presenceR),M=Object.keys(g).filter(U=>(g[U]??999)>=2&&(g[U]??999)<=s.presenceR).sort((U,V)=>g[U]-g[V]||U.localeCompare(V));if(M.length){const U=v("");U.style.cssText="margin-top:calc(10 * var(--u)); padding:calc(10 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.10); border-radius:calc(12 * var(--u)); background:rgba(255,255,255,.03);";const V=vn("ë©€ë¦¬ ë³´ì´ëŠ” ê³³");V.style.margin="0 0 calc(6 * var(--u)) 0",U.appendChild(V);const R=new Map;for(const _ of M){const w=g[_]??0,B=r.nodes[_]?.kind??"BATTLE",P=Kt(w,s),O=zt(t,_,B,P),D=O.certainty==="PRESENCE"?"ë¬´ì–¸ê°€":O.label,F=R.get(w)??{};F[D]=(F[D]??0)+1,R.set(w,F)}const T=Array.from(R.keys()).sort((_,w)=>_-w);for(const _ of T){const w=R.get(_),S=Object.keys(w).map(B=>`${B}Ã—${w[B]}`);U.appendChild(J("",`ê±°ë¦¬ ${_}: ${S.join(" Â· ")}`))}x.appendChild(U)}}document.addEventListener("pointerdown",k,!0),e.appendChild(x)}e.appendChild(i)}function di(e,t,n){Qt(t),ci(e,t,n)}function to(e,t){let n=null,r=!1,o=!1;const a=[];function s(p){a.length=0,p.choice=null,n=null,document.querySelector(".choice-overlay")?.remove()}function i(p){a.push({choice:p.choice,handler:n})}function l(p){const f=a.pop();if(!f){c(p);return}p.choice=f.choice,n=f.handler}function c(p){if(a.length>0){l(p);return}p.choice=null,n=null,document.querySelector(".choice-overlay")?.remove()}function m(p,f,h){p.choice&&i(p),p.choice=f,n=h}const u=()=>we||e,d={onHotkeySlot:(p,f)=>{const h=u();if(h.run.finished||ae(h)||h.phase!=="PLACE"||p==="back"&&h.backSlotDisabled?.[f])return;const x=p==="front"?h.frontSlots:h.backSlots,k=x[f];if(!h.selectedHandCardUid){if(!k)return;d.onReturnSlotToHand(p,f);return}const N=h.selectedHandCardUid;if(!k){d.onPlaceHandUidToSlot(N,p,f);return}x[f]=null,(h.placedUidsThisTurn??[]).includes(k)&&(h.usedThisTurn=Math.max(0,h.usedThisTurn-1),p==="front"&&(h.frontPlacedThisTurn=Math.max(0,h.frontPlacedThisTurn-1)),h.placedUidsThisTurn=(h.placedUidsThisTurn??[]).filter(C=>C!==k)),h.hand.push(k),h.cards[k].zone="hand",Qn(h,N,p,f),h.selectedHandCardUid=null,y(h,`[${be(h,N)}] â†” [${be(h,k)}] ìŠ¤ì™‘: ì†íŒ¨ â†” ${p}${f+1}`),A(h,d)},rerender:()=>{const p=u();A(p,d)},onToggleLogOverlay:()=>{Cn=!Cn,A(u(),d)},onUseItem:p=>{const f=u();if(f.run.finished||f.choice||te||ae(f))return;da(f,p)&&A(f,d)},onDiscardItem:p=>{const f=u();if(f.run.finished||te||ae(f))return;ca(f,p,"UI")&&A(f,d)},onCloseOverlay:()=>{const p=u();te=null,A(p,d)},onNewRun:()=>{const p=u();Ne=null,te=null,W=null,c(p),is(),t(fn(p.content))},onViewRulebook:()=>{const p=u();te={kind:"RULEBOOK"},A(p,d)},onViewPile:p=>{const f=u();te={kind:"PILE",pile:p},A(f,d)},onViewSettings:()=>{const p=u();te={kind:"SETTINGS"},A(p,d)},onReturnSlotToHand:(p,f)=>{const h=u();if(h.run.finished||ae(h)||h.phase!=="PLACE")return;const x=p==="front"?h.frontSlots:h.backSlots,k=x[f];if(!k)return;x[f]=null,(h.placedUidsThisTurn??[]).includes(k)&&(h.usedThisTurn=Math.max(0,h.usedThisTurn-1),p==="front"&&(h.frontPlacedThisTurn=Math.max(0,h.frontPlacedThisTurn-1)),h.placedUidsThisTurn=(h.placedUidsThisTurn??[]).filter(I=>I!==k)),h.hand.push(k),h.cards[k].zone="hand",y(h,`[${be(h,k)}] íšŒìˆ˜: ${p}${f+1} â†’ ì†íŒ¨`),A(h,d)},onClearSelected:()=>{const p=u();p.selectedHandCardUid=null,A(p,d)},onSelectEnemy:p=>{const f=u();if(o)return;o=!0,requestAnimationFrame(()=>{o=!1});const h=La(f,p);A(f,d),h&&!f.choice&&!f.run.finished&&d.onAutoAdvance()},onSelectHandCard:p=>{const f=u();ae(f)||(f.selectedHandCardUid=f.selectedHandCardUid===p?null:p,A(f,d))},onMoveToNode:p=>{const f=u();if(f.run.finished||f.choice||f.phase!=="NODE"||r)return;r=!0,setTimeout(()=>r=!1,180);const h=f.run,{map:x,pursuit:k}=Qt(f),N=x.pos;if(!(x.edges[N]??[]).includes(p))return;h.timeMove=Number(h.timeMove??0)+1,x.visionNonce=Number(x.visionNonce??0)+1,x.pos=p;const C=x.nodes[p]??(x.nodes[p]={id:p,kind:"BATTLE"}),K=!C.visited;if(K&&(C.visited=!0,f.run.nodePickCount=(f.run.nodePickCount??0)+1),f.run.treasureObtained){if(k.heat=Number(k.heat??0)+1,Ut(k.heat),x.pos===x.startId){f.run.finished=!0,y(f,"ë³´ë¬¼ì„ ë“¤ê³  ìž…êµ¬ë¡œ ëŒì•„ì™”ë‹¤! íƒˆì¶œì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤!"),A(f,d);return}K&&C.kind!=="TREASURE"&&C.kind!=="START"&&(f.run.afterTreasureNodePicks=(f.run.afterTreasureNodePicks??0)+1)}jr(f);const L=Jr(f);if(Number(h.nextBossTime??0)>0&&L>=Number(h.nextBossTime??0)){h.forcedNext=null,h.nextBossTime=Number(h.nextBossTime??0)+40,f.run.bossOmenText=null,C.cleared=!0,C.kind="EMPTY",C.noRespawn=!0,C.lastClearedMove=Number(h.timeMove??0),y(f,"ì‹œê°„ì´ ë‹¤ ë˜ì–´ ë³´ìŠ¤ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. (ì‹œê°„ +1)"),Ge(f,{forceBoss:!0}),ut(f),A(f,d);return}const $=Number(h.timeMove??0)||0;C.cleared&&(C.kind==="BATTLE"||C.kind==="EVENT"||C.kind==="REST"||C.kind==="ELITE")&&(C.kind==="ELITE"&&(C.noRespawn=!0),C.kind="EMPTY",C.lastClearedMove=Number(C.lastClearedMove??$));let g=C.kind;if(g==="EMPTY"){const M=!!C.noRespawn,U=Number(C.lastClearedMove??-999),V=Number(h.respawnCooldownMoves??2)||2,R=$-U<=V;if(!M&&!R){const T=f.run.treasureObtained?Ut(k.heat):0,_=Math.max(0,Number(f.player.fatigue??0)||0),w=rt(_/25)*.18,S=f.run.treasureObtained?.22:.12,B=f.run.treasureObtained?.1:.08,P=rt(S+T*B+w);if(Math.random()<P){const O=Math.random(),D=f.run.treasureObtained?.72:.55,F=f.run.treasureObtained?.9:.85;g=O<D?"BATTLE":O<F?"EVENT":"REST",C.kind=g,C.cleared=!1,C.respawnCount=Number(C.respawnCount??0)+1,y(f,"ìž¬ë°œë™: ì´ê³³ì—ì„œ ë‹¤ì‹œ ë¬´ì–¸ê°€ê°€ ì¼ì–´ë‚©ë‹ˆë‹¤...")}}}if(g==="START"){A(f,d);return}if(g==="TREASURE"){C.cleared=!0,C.kind="EMPTY",C.noRespawn=!0,C.lastClearedMove=$,Zo(f),A(f,d);return}if(g==="REST"){C.cleared=!0,C.kind="EMPTY",C.lastClearedMove=$;const M=(f.player.fatigue??0)>=10;f.choice={kind:"EVENT",title:"íœ´ì‹",art:se("assets/events/event_rest.png"),prompt:M?"í”¼ë¡œê°€ ë„ˆë¬´ ë†’ì•„ ì‹œê°„ì´ ë” ê±¸ë¦´ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.":"ìº í”„ì— ìž ì‹œ ë¨¸ë¬¸ë‹¤.",options:[{key:"rest:heal",label:"íšŒë³µ",detail:"HP +15"},{key:"rest:clear_f",label:"ì •ë¹„",detail:"F -3"},{key:"rest:upgrade",label:"ê°•í™”",detail:"ì¹´ë“œ 1ìž¥ ê°•í™”"},{key:"rest:skip",label:"ë– ë‚˜ê¸°"}]},f.choiceCtx={kind:"REST",highF:M},A(f,d);return}if(g==="SHOP"){C.visited=!0,C.cleared=!0,C.noRespawn=!0,C.lastClearedMove=$,ee(f,p),A(f,d);return}if(g==="EVENT"){C.cleared=!0,C.kind="EMPTY",C.lastClearedMove=$;const M=f.run;M.ominousProphecySeen??=!1;const U=.3;let V=nn(f);if(M.ominousProphecySeen===!0)for(let T=0;T<50&&V.id==="ominous_prophecy";T++)V=nn(f);else Math.random()<U&&(V=Or("ominous_prophecy")??V);{const T=M.lastEventId??null;if(T&&V?.id===T)for(let _=0;_<60;_++){const w=nn(f),S=w?.id;if(S&&!(M.ominousProphecySeen===!0&&S==="ominous_prophecy")&&S!==T){V=w;break}}}if(V?.id==="ominous_prophecy"&&(M.ominousProphecySeen=!0),!V){A(f,d);return}{const T=f.run;T.eventsSeen??={};const _=Number(T.eventsSeen[V.id]??0)||0;T.eventsSeen[V.id]=_+1,T.lastEventId=V.id}let R=V.options(f);f.choice={kind:"EVENT",title:V.name,prompt:V.prompt,art:V.art??null,options:R.map(T=>({key:T.key,label:T.label,detail:T.detail}))},n=T=>{const _=R.find(B=>B.key===T);if(!_)return;const w=ve(f);w.eventPicks+=1,ge(f);const S=_.apply(f);if(typeof S=="object"&&S.kind==="UPGRADE_PICK"){E(f,d,S.title??"ê°•í™”",S.prompt??"ê°•í™”í•  ì¹´ë“œ 1ìž¥ì„ ì„ íƒí•˜ì„¸ìš”.");return}if(typeof S=="object"&&S.kind==="REMOVE_PICK"){const B=Object.values(f.cards).filter(P=>(P.zone==="deck"||P.zone==="hand"||P.zone==="discard")&&P.defId!=="goal_treasure").map(P=>P.uid);m(f,{kind:"PICK_CARD",title:S.title,prompt:S.prompt??"ì œê±°í•  ì¹´ë“œ 1ìž¥ì„ ì„ íƒí•˜ì„¸ìš”.",options:[...B.map(P=>{const O=Dt(f,P);return{key:`remove:${P}`,label:be(f,P),detail:`ì „ì—´: ${O.frontText} / í›„ì—´: ${O.backText}`,cardUid:P}}),{key:"cancel",label:"ì·¨ì†Œ"}]},P=>{if(P==="cancel"){y(f,"ì œê±° ì·¨ì†Œ"),c(f),A(f,d);return}if(!P.startsWith("remove:")){A(f,d);return}const O=P.slice(7);kt(f,O);const D=S.then,F=D==="REWARD"||D==="REWARD_PICK"?"REWARD_PICK":D==="BATTLE"?"BATTLE":D==="NONE"?"NONE":void 0;if(F==="BATTLE"){s(f),f.phase="NODE",Ge(f),ut(f),A(f,d);return}if(F==="REWARD_PICK"){s(f),b(f,d,"ì¹´ë“œ ë³´ìƒ","ë‘ ìž¥ ì¤‘ í•œ ìž¥ì„ ì„ íƒí•˜ê±°ë‚˜ ìƒëžµí•©ë‹ˆë‹¤."),A(f,d);return}s(f),f.phase="NODE",A(f,d)}),A(f,d);return}if(typeof S=="object"&&S.kind==="BATTLE_SPECIAL"){s(f),f.run.onWinGrantRelicId=S.onWinGrantRelicId??null,y(f,S.title?`ì´ë²¤íŠ¸ ì „íˆ¬: ${S.title}`:"ì´ë²¤íŠ¸ ì „íˆ¬ ë°œìƒ!");const B=f.run;B.pendingEventWinRelicId=S.onWinGrantRelicId??null,B.pendingEventWinGold=Number(S.onWinGrantGold??0)||0,f.phase="NODE",Ge(f,{forcePatternIds:S.enemyIds}),f._justStartedCombat=!0,ut(f),A(f,d);return}if(S==="BATTLE"){s(f),f.phase="NODE",Ge(f),f._justStartedCombat=!0,ut(f),A(f,d);return}if(S==="REWARD"){s(f),b(f,d,"ì¹´ë“œ ë³´ìƒ","ë‘ ìž¥ ì¤‘ í•œ ìž¥ì„ ì„ íƒí•˜ê±°ë‚˜ ìƒëžµí•©ë‹ˆë‹¤."),A(f,d);return}c(f),A(f,d)},A(f,d);return}if(g==="BATTLE"||g==="ELITE"){C.cleared=!0,C.kind="EMPTY",C.lastClearedMove=$,g==="ELITE"&&(C.noRespawn=!0),y(f,"ì´ë™ í›„ ì „íˆ¬ ì‹œìž‘ (ì‹œê°„ +1)"),g==="ELITE"?Ge(f,{forceBoss:!1,forceElite:!0}):Ge(f,{forceBoss:!1}),ut(f),A(f,d);return}A(f,d)},onChooseChoice:p=>{const f=u();if(!f.choice)return;const h=f.choice.kind;if(os(f,p)){const x=h==="EVENT"&&p==="startBattle";A(f,d),x||d.onAutoAdvance();return}if(n){n(p);const x=h==="EVENT"&&p==="startBattle";A(f,d),x||d.onAutoAdvance();return}y(f,`ì„ íƒ ì²˜ë¦¬ ë¶ˆê°€: handler ì—†ìŒ (kind=${h}, key=${p})`)},onAutoAdvance:()=>{const p=u();Ls(p,d)},onRevealIntents:()=>{const p=u();p.run.finished||p.enemies.length!==0&&(An(p),A(p,d))},onPlaceHandUidToSlot:(p,f,h)=>{const x=u();x.run.finished||ae(x)||x.phase==="PLACE"&&(f==="back"&&x.backSlotDisabled?.[h]||(Qn(x,p,f,h),x.selectedHandCardUid=null,A(x,d)))},onPlaceSelected:(p,f)=>{const h=u();h.selectedHandCardUid&&d.onPlaceHandUidToSlot(h.selectedHandCardUid,p,f)},onMoveSlotCard:(p,f,h,x)=>{const k=u();if(k.run.finished||ae(k)||k.phase!=="PLACE"||h==="back"&&k.backSlotDisabled?.[x])return;const N=p==="front"?k.frontSlots:k.backSlots,I=h==="front"?k.frontSlots:k.backSlots,C=N[f];if(!C)return;const K=I[x];N[f]=K??null,I[x]=C,k.cards[C].zone=h,K&&(k.cards[K].zone=p),p!==h&&(p==="front"&&(k.frontPlacedThisTurn=Math.max(0,k.frontPlacedThisTurn-1)),h==="front"&&(k.frontPlacedThisTurn+=1),K&&(h==="front"&&(k.frontPlacedThisTurn=Math.max(0,k.frontPlacedThisTurn-1)),p==="front"&&(k.frontPlacedThisTurn+=1))),y(k,K?`[${be(k,C)}] â†” [${be(k,K)}] ìŠ¤ì™‘: ${p}${f+1} â†” ${h}${x+1}`:`[${be(k,C)}] ì´ë™: ${p}${f+1} â†’ ${h}${x+1}`),En(k),A(k,d)},onResolveBack:()=>{const p=u();p.phase==="PLACE"&&En(p),ga(p),A(p,d)},onResolveFront:()=>{const p=u();Sa(p),A(p,d)},onResolveEnemy:()=>{const p=u();_a(p),A(p,d)},onUpkeep:()=>{const p=u();Aa(p),A(p,d)},onDrawNextTurn:()=>{const p=u();Ma(p),A(p,d)}};function b(p,f,h,x){const N=ea(p).map(I=>{const C=pe(p.content,I.defId,I.upgrade);return{key:`pick:${I.defId}:${I.upgrade}`,label:Ks(p,I),detail:`ì „ì—´: ${C.frontText} / í›„ì—´: ${C.backText}`}});p.choice={kind:"REWARD",title:h,prompt:x,options:[...N,{key:"skip",label:"ìƒëžµ"}]},n=I=>{if(n=null,I.startsWith("pick:")){const C=I.slice(5),[K,L]=C.split(":"),$=Number(L??"0")||0;bt(p,K,{upgrade:$})}else y(p,"ì¹´ë“œ ë³´ìƒ ìƒëžµ");c(p),p.choice=null,p.run.finished||(p.phase="NODE"),A(p,f)},A(p,f)}function E(p,f,h,x,k){let N=Object.values(p.cards).filter(L=>(L.zone==="deck"||L.zone==="hand"||L.zone==="discard")&&jt(p,L.uid)).map(L=>L.uid);const I=p.player.fatigue??0;let C=1/0;if(I>=8?C=4:I>=5&&(C=8),C!==1/0&&N.length>C&&(N=[...N].sort(()=>Math.random()-.5).slice(0,C)),N.length===0){y(p,"ê°•í™”í•  ìˆ˜ ìžˆëŠ” ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤."),p.choice=null,n=null,A(p,f);return}const K=[...N].sort((L,$)=>{const g=p.cards[L],M=p.cards[$],U=Ft(p,g.defId),V=Ft(p,M.defId),R=U.localeCompare(V,"ko");return R!==0?R:(g.upgrade??0)-(M.upgrade??0)});p.choice={kind:"UPGRADE_PICK",title:h,prompt:x,options:[...K.map(L=>{const $=p.cards[L],g=Dt(p,L),M=pe(p.content,$.defId,($.upgrade??0)+1),U=be(p,L),V=`í˜„ìž¬: ì „ì—´ ${g.frontText} / í›„ì—´ ${g.backText}
ê°•í™”: ì „ì—´ ${M.frontText} / í›„ì—´ ${M.backText}`;return{key:`up:${L}`,label:U,detail:V,cardUid:L}}),{key:"skip",label:"ì·¨ì†Œ"}]},n=L=>{if(L==="skip"){y(p,"ê°•í™” ì·¨ì†Œ"),c(p),A(p,f);return}if(L.startsWith("up:")){const $=L.slice(3),g=hn(p,$);y(p,g?`ê°•í™”: [${be(p,$)}]`:"ê°•í™” ì‹¤íŒ¨"),c(p),A(p,f);return}c(p),A(p,f)},A(p,f)}return d}function En(e){const t=(e.placedUidsThisTurn??[]).filter(r=>{const o=e.cards[r];return!!o&&(o.zone==="front"||o.zone==="back")});e.usedThisTurn=t.length;let n=0;for(const r of t)e.cards[r]?.zone==="front"&&(n+=1);e.frontPlacedThisTurn=n}function ui(){bs();const e=document.querySelector("#app");return e.innerHTML="",e}function ie(e,t,n=""){const r=document.createElement("button");return n&&(r.className=n),r.type="button",r.textContent=e,r.onclick=t,r}function Fn(){const e=Array.from(document.querySelectorAll(".enemyName"));if(e.length===0)return;let t=0;for(const o of e){const a=(o.textContent??"").trim();a.length>t&&(t=a.length)}const r=Math.max(6,Math.min(t,24));e.forEach(o=>{o.style.display="inline-block",o.style.width=`${r}ch`,o.style.whiteSpace="nowrap",o.style.overflow="hidden",o.style.textOverflow="ellipsis"})}function pi(){document.querySelector(".phaseBanner")?.remove(),performance.now()}function fi(){_s();let e=document.querySelector(".floatFxLayer");e||(e=document.createElement("div"),e.className="floatFxLayer",document.body.appendChild(e)),e.style.cssText="position:fixed; inset:0;pointer-events:none;z-index: var(--zChrome);";for(const t of Ot){const n=String(t.id);let r=e.querySelector(`.floatNum[data-fx-id="${n}"]`);if(r){const o=t.x/window.innerWidth*100,a=t.y/window.innerHeight*100;r.style.left=`${o.toFixed(4)}vw`,r.style.top=`${a.toFixed(4)}vh`}else{r=document.createElement("div"),r.className=`floatNum ${t.kind}`,r.dataset.fxId=n,r.textContent=t.text,r.style.position="absolute";const o=t.x/window.innerWidth*100,a=t.y/window.innerHeight*100;r.style.left=`${o.toFixed(4)}vw`,r.style.top=`${a.toFixed(4)}vh`,e.appendChild(r)}}}function mi(){if(document.querySelector(".floatingNewRun"))return;const e=document.createElement("button");e.className="floatingNewRun",e.type="button",e.textContent="ìƒˆë¡œìš´ ëŸ°",e.style.cssText=`
    position: fixed;
    top: calc(env(safe-area-inset-top, 0) + calc(10 * var(--u)));
    left: calc(env(safe-area-inset-left, 0) + calc(10 * var(--u)));
    pointer-events: auto;
    z-index: var(--zChrome);

    padding: calc(10 * var(--u)) calc(12 * var(--u));
    border-radius: calc(14 * var(--u));
    border: calc(1 * var(--u)) solid rgba(255,255,255,.16);
    background: rgba(0,0,0,.55);
    color: #fff;

    backdrop-filter: blur(calc(8 * var(--u)));
    -webkit-backdrop-filter: blur(calc(8 * var(--u)));
    cursor: pointer;
    touch-action: manipulation;
  `,e.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),Wr?.()}),document.body.appendChild(e)}function A(e,t){A._uiScaleInitDone||(A._uiScaleInitDone=!0,le=Kr(),Un()),we=e,Zr(),Ya({getG:()=>we??e,actions:{onNewRun:()=>t.onNewRun()},rerender:()=>A(we??e,t),log:m=>y(we??e,m)}),tt(),Wr=()=>t.onNewRun(),mi(),Hs(),A._logInitDone||(A._logInitDone=!0,Ms());const n=document.querySelector(".mainPanel");n&&(sr=n.scrollTop,ir=n.scrollLeft);const r=ui();ur||(window.addEventListener("resize",()=>{}),Li(()=>we??e,t),ur=!0),r.appendChild(gi(e,t)),Si(e,t);const o=v("mainRow"),a=v("stage"),s=v("stageInner"),i=v("panel mainPanel"),l=!e.run.finished&&e.enemies.length>0&&e.phase!=="NODE";i.classList.toggle("inCombat",l),i.scrollTop=sr,i.scrollLeft=ir,i.appendChild($i(e)),e.run.finished?i.appendChild(Hn("ëŸ° ì¢…ë£Œ. ìƒˆë¡œìš´ ëŸ°ì„ ì›í•˜ì‹œë©´ ë²„íŠ¼ì„ ëˆ„ë¥´ê±°ë‚˜ í‚¤ë³´ë“œ Pë¥¼ ìž…ë ¥í•˜ì‹­ì‹œì˜¤.")):e.phase==="NODE"?di(i,e,t):Ii(i,e,t),s.appendChild(i),a.appendChild(s);const c=v("panel logPanel");if(c.classList.toggle("collapsed",Ke),c.appendChild(Ni(Ke,()=>{Ke=!Ke,Ps(),A(e,t)})),c.classList.add("logScroll"),!Ke){const m=Us(e.log.join(`
`));m.classList.add("log"),c.appendChild(m)}o.appendChild(a),o.appendChild(c),r.appendChild(o),Fn(),bi(e),Mi(e,t,ae(e)),zn(),Kn(),so(),vi(e,{...t,onCloseOverlay:()=>{te=null,A(we??e,t)}}),Ei(e,t),ki(e,t),xi(e,t),Ci(e,t),Nt(e,t),$s(e),pi(),fi(),ws(e),yi(e,t),Rs(e),xs(),us(hi(e))}function hi(e){const t=e.player.supplies;return!e.run.finished&&e.enemies.length>0&&e.phase!=="NODE"&&typeof t=="number"?t:null}function Wn(e,t){const n=oe[t]??null,r=It(e,t),o=n?.art??n?.icon??null,a=o?se(String(o)):null,s=a;return{id:t,name:r.name,desc:r.text,state:r.state,icon:s,art:a}}function yi(e,t){document.querySelector(".relicHud")?.remove(),document.querySelector(".relicTooltip")?.remove(),Nt(e,t);const n=(e.run.relics??[]).slice();if(n.length===0)return;const r=document.createElement("div");r.className="relicHud";for(const o of n.slice().reverse()){const a=Wn(e,o),s=document.createElement("div");if(s.className="relicIcon",s.setAttribute("role","button"),s.tabIndex=0,a.icon){const l=document.createElement("img");l.className="relicIconImg",l.src=a.icon,l.alt=a.name??a.id??"relic",s.appendChild(l)}else{const l=document.createElement("div");l.textContent=a.name.slice(0,2),l.style.fontWeight="900",l.style.fontSize="calc(12 * var(--u))",l.style.opacity=".95",s.appendChild(l)}const i=(l,c)=>{Ee=o,Oe={x:l,y:c},dn(e)};s.onpointerenter=l=>i(l.clientX??0,l.clientY??0),s.onpointermove=l=>{Ee===o&&(Oe={x:l.clientX??0,y:l.clientY??0},dn(e))},s.onpointerleave=()=>{Ee===o&&(Ee=null,Oe=null,document.querySelector(".relicTooltip")?.remove())},s.onclick=l=>{l.preventDefault(),l.stopPropagation(),ze=o,Ee=null,Oe=null,document.querySelector(".relicTooltip")?.remove(),Nt(e,t)},s.onkeydown=l=>{(l.key==="Enter"||l.key===" ")&&(l.preventDefault(),ze=o,Nt(e,t))},r.appendChild(s)}document.body.appendChild(r),dn(e)}function dn(e){if(document.querySelector(".relicTooltip")?.remove(),!Ee||!Oe)return;const t=Wn(e,Ee);if(!t.desc&&!t.name)return;const n=document.createElement("div");n.className="relicTooltip";const r=document.createElement("div");if(r.className="relicTooltipTitle",r.textContent=t.name,n.appendChild(r),t.desc){const d=document.createElement("div");d.className="relicTooltipDesc",d.textContent=t.desc,n.appendChild(d)}document.body.appendChild(n);const o=Gt(),s=12*o,l=10*o,c=n.getBoundingClientRect();let m=Oe.x-c.width,u=Oe.y-c.height-l;m=Math.max(s,Math.min(window.innerWidth-c.width-s,m)),u=Math.max(s,Math.min(window.innerHeight-c.height-s,u)),n.style.left=Me(Math.round(m)),n.style.top=Me(Math.round(u))}function Nt(e,t){if(document.querySelector(".relicModal")?.remove(),!ze)return;const n=Wn(e,ze),r=document.createElement("div");r.className="relicModal",r.style.cssText=`
    position: fixed;
    inset: 0;
    z-index: var(--zRelicModal, 70000);
    pointer-events: auto;
    background: rgba(0,0,0,.55);
    backdrop-filter: blur(calc(6 * var(--u)));
    -webkit-backdrop-filter: blur(calc(6 * var(--u)));
    display: flex;
    align-items: center;
    justify-content: center;
    padding: calc(18 * var(--u));
    box-sizing: border-box;
  `,r.onclick=d=>{d.target===r&&(ze=null,A(e,t))};const o=document.createElement("div");o.className="relicModalPanel",o.onclick=d=>d.stopPropagation();const a=document.createElement("div");a.className="relicModalHeader";const s=document.createElement("h3");s.className="relicModalTitle",s.textContent=n.name,s.style.fontFamily='"ë¬¼ë§ˆë£¨", serif';const i=document.createElement("button");i.type="button",i.textContent="ë‹«ê¸°",i.className="overlayClose",i.onclick=()=>{ze=null,A(e,t)},a.appendChild(s),a.appendChild(i);const l=document.createElement("div");l.className="relicModalBody";const c=document.createElement("div");c.className="relicModalArt";const m=document.createElement("div");m.className="relicModalArtImg",n.art&&(m.style.backgroundImage=`url("${se(n.art)}")`),c.appendChild(m);const u=document.createElement("pre");u.className="relicModalDesc",u.textContent=n.desc||"",u.style.fontFamily='"ë¬¼ë§ˆë£¨", serif',l.appendChild(c),l.appendChild(u),o.appendChild(a),o.appendChild(l),r.appendChild(o),document.body.appendChild(r)}function bi(e){const t=document.querySelector(".stageInner");if(!t)return;document.querySelector(".stageCornerHud")?.remove();const n=document.createElement("div");n.className="stageCornerHud";const r=document.createElement("div");r.className="stageCornerHudTop",r.textContent=wi(e);const o=document.createElement("div");o.className="stageCornerHudBottom",o.textContent=_i(e),n.appendChild(r),n.appendChild(o),document.body.appendChild(n);const a=t.getBoundingClientRect(),l=-56*Gt(),c=(a.left+a.right)/2;n.style.right="",n.style.left=Me(Math.round(c)),n.style.top=Me(Math.round(a.top+l)),n.style.transform="translateX(-50%)"}function At(){try{localStorage.setItem(Ur,JSON.stringify(le))}catch{}}function un(e){const t=Ve(e,.75,1.5);Bn()?le.uiScaleMobile=t:le.uiScaleDesktop=t,At(),Un()}function ki(e,t){if(document.querySelector(".logOverlay")?.remove(),!Cn)return;const n=v("logOverlay");n.style.cssText=`
    position: fixed; inset: 0;
    pointer-events:auto;
    background: rgba(0,0,0,.55);
    backdrop-filter: blur(calc(6 * var(--u)));
    display: flex;
    align-items: flex-end;
    justify-content: center;
  `;const r=v("panel");r.style.cssText=`
    width: min(calc(720 * var(--u)), 100%);
    max-height: 70vh;
    border-radius: calc(18 * var(--u)) calc(18 * var(--u)) 0 0;
    padding: calc(12 * var(--u));
    margin: 0;
  `;const o=v("panelHeader"),a=document.createElement("h2");a.textContent="ë¡œê·¸",o.appendChild(a);const s=ie("ë‹«ê¸°",()=>t.onToggleLogOverlay());o.appendChild(s),r.appendChild(o);const i=document.createElement("pre");i.className="log",i.textContent=e.log.join(`
`),i.style.maxHeight="60vh",i.style.overflow="auto",r.appendChild(i),n.onclick=()=>t.onToggleLogOverlay(),r.onclick=l=>l.stopPropagation(),n.appendChild(r),document.body.appendChild(n)}function Ti(e,t){const n=v("settingsPanel");n.style.cssText="display:flex; flex-direction:column; gap:calc(12 * var(--u));";const r=v("settingsRow");r.style.cssText="display:flex; align-items:center; gap:calc(12 * var(--u)); flex-wrap:wrap;";const o=J("","UI ìŠ¤ì¼€ì¼");o.style.cssText="font-weight:800;";const a=()=>Bn()?le.uiScaleMobile:le.uiScaleDesktop,s=J("",`${Math.round(a()*100)}%`);s.style.cssText="opacity:.9; min-width:calc(64 * var(--u)); text-align:right;";const i=document.createElement("input");i.type="range",i.min="0.75",i.max="1.25",i.step="0.01",i.value=String(a()),i.style.cssText="flex:1 1 calc(260 * var(--u));",i.oninput=()=>{const g=Number(i.value);un(g),s.textContent=`${Math.round(a()*100)}%`,e()},r.appendChild(o),r.appendChild(i),r.appendChild(s),n.appendChild(r);const l=v("settingsPresets");l.style.cssText="display:flex; gap:calc(8 * var(--u)); flex-wrap:wrap;";const c=(g,M)=>{const U=ie(g,()=>{un(M),i.value=String(a()),s.textContent=`${Math.round(a()*100)}%`,e()});return U.style.cssText="padding:calc(8 * var(--u)) calc(12 * var(--u)); border-radius:calc(12 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.16);background:rgba(255,255,255,.06); color:#fff; cursor:pointer;",U};l.appendChild(c("ìž‘ê²Œ 90%",.9)),l.appendChild(c("ê¸°ë³¸ 100%",1)),l.appendChild(c("í¬ê²Œ 110%",1.1)),l.appendChild(c("ë” í¬ê²Œ 120%",1.2)),n.appendChild(l);const m=v("settingsResetRow");m.style.cssText="display:flex; justify-content:flex-end; margin-top:calc(6 * var(--u));";const u=ie("ìŠ¤ì¼€ì¼ ì´ˆê¸°í™”",()=>{un(1),i.value=String(a()),s.textContent=`${Math.round(a()*100)}%`,e()});u.style.cssText="padding:calc(8 * var(--u)) calc(12 * var(--u)); border-radius:calc(12 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.16);background:rgba(255,255,255,.06); color:#fff; cursor:pointer;",m.appendChild(u),n.appendChild(m);const d=v("settingsRow");d.style.cssText="display:flex; align-items:center; gap:calc(12 * var(--u)); flex-wrap:wrap;";const b=J("","ì• ë‹ˆë©”ì´ì…˜ ì†ë„");b.style.cssText="font-weight:800;";const E=J("",`x${Se().toFixed(2)}`);E.style.cssText="opacity:.9; min-width:calc(64 * var(--u)); text-align:right;";const p=document.createElement("input");p.type="range",p.min="0",p.max="2",p.step="0.05",p.value=String(Se()),p.style.cssText="flex:1 1 calc(260 * var(--u));";const f=g=>{le.animMul=Ve(g,0,2),At(),Un()};p.oninput=()=>{const g=Number(p.value);f(g),E.textContent=`x${Se().toFixed(2)}`,e()},d.appendChild(b),d.appendChild(p),d.appendChild(E),n.appendChild(d);const h=v("settingsPresets");h.style.cssText="display:flex; gap:calc(8 * var(--u)); flex-wrap:wrap;";const x=(g,M)=>{const U=ie(g,()=>{f(M),p.value=String(Se()),E.textContent=`x${Se().toFixed(2)}`,e()});return U.style.cssText="padding:calc(8 * var(--u)) calc(12 * var(--u)); border-radius:calc(12 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.16);background:rgba(255,255,255,.06); color:#fff; cursor:pointer;",U};h.appendChild(x("ì¦‰ì‹œ",0)),h.appendChild(x("ë¹ ë¦„",.7)),h.appendChild(x("ê¸°ë³¸",1)),h.appendChild(x("ëŠë¦¼",1.4)),h.appendChild(x("ì•„ì£¼ ëŠë¦¼",1.8)),n.appendChild(h);const k=v("settingsResetRow");k.style.cssText="display:flex; justify-content:flex-end; margin-top:calc(6 * var(--u));";const N=ie("ì• ë‹ˆ ì´ˆê¸°í™”",()=>{f(1),p.value=String(Se()),E.textContent=`x${Se().toFixed(2)}`,e()});N.style.cssText="padding:calc(8 * var(--u)) calc(12 * var(--u)); border-radius:calc(12 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.16);background:rgba(255,255,255,.06); color:#fff; cursor:pointer;",k.appendChild(N),n.appendChild(k);const I=v("settingsRow");I.style.cssText="display:flex; align-items:center; gap:calc(12 * var(--u)); flex-wrap:wrap;";const C=J("","ìŠ¬ë¡¯ ì¹´ë“œ í‘œì‹œ");C.style.cssText="font-weight:800;";const K=le.slotCardMode??"FULL",L=ie("ì „ì²´",()=>{le.slotCardMode="FULL",At(),e()}),$=ie("ì´ë¦„ë§Œ",()=>{le.slotCardMode="NAME_ONLY",At(),e()});return L.style.cssText=`padding:calc(8 * var(--u)) calc(12 * var(--u)); border-radius:calc(12 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.16);
    background:${K==="FULL"?"rgba(255,255,255,.16)":"rgba(255,255,255,.06)"}; color:#fff; cursor:pointer;`,$.style.cssText=`padding:calc(8 * var(--u)) calc(12 * var(--u)); border-radius:calc(12 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.16);
    background:${K==="NAME_ONLY"?"rgba(255,255,255,.16)":"rgba(255,255,255,.06)"}; color:#fff; cursor:pointer;`,I.appendChild(C),I.appendChild(L),I.appendChild($),n.appendChild(I),n}function Un(){const e=document.documentElement,t=zr();e.style.setProperty("--uiScale",String(t)),e.style.setProperty("--uiScaleDesktop",String(le.uiScaleDesktop)),e.style.setProperty("--uiScaleMobile",String(le.uiScaleMobile)),e.style.setProperty("--animMul",String(Se()))}function vi(e,t){if(document.querySelector(".overlay-layer")?.remove(),!te)return;const n=te.kind==="SETTINGS",r=v("overlay-layer");r.style.cssText=n?"position:fixed; inset:0;background:rgba(0,0,0,1);display:flex; justify-content:center; align-items:flex-start;padding:calc(24 * var(--u)); box-sizing:border-box;":"position:fixed; inset:0;background:rgba(0,0,0,.55);display:flex; justify-content:center; align-items:center;",r.onclick=c=>{c.target===r&&t.onCloseOverlay()};const o=v("overlay-panel");o.style.cssText=n?"width:min(calc(860 * var(--u)), 96vw); max-height:calc(100vh - calc(48 * var(--u))); overflow:auto;padding:calc(16 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.12); border-radius:calc(16 * var(--u));background:rgba(15,18,22,1); box-shadow:0 calc(18 * var(--u)) calc(60 * var(--u)) rgba(0,0,0,.45);":"width:min(calc(980 * var(--u)), 92vw); max-height:80vh; overflow:auto; padding:calc(16 * var(--u));border:calc(1 * var(--u)) solid rgba(255,255,255,.12); border-radius:calc(16 * var(--u));background:rgba(15,18,22,.92); box-shadow:0 calc(18 * var(--u)) calc(60 * var(--u)) rgba(0,0,0,.45);",o.onclick=c=>c.stopPropagation();const a=te.kind==="RULEBOOK"?"ë£°ë¶":te.kind==="SETTINGS"?"ì„¤ì •":te.pile==="deck"?"ë±":te.pile==="discard"?"ë²„ë¦¼ ë”ë¯¸":te.pile==="exhausted"?"ì†Œëª¨(ì´ë²ˆ ì „íˆ¬)":te.pile==="vanished"?"ì†Œì‹¤(ì˜êµ¬)":"ì†íŒ¨",s=v("overlayHeader");s.style.cssText="display:flex; align-items:center; justify-content:space-between; gap:calc(12 * var(--u)); position:sticky; top:0; padding-bottom:calc(12 * var(--u)); margin-bottom:calc(12 * var(--u)); background:rgba(15,18,22,.92);";const i=vn(a);i.classList.add("overlayTitle");const l=Fe("ë‹«ê¸°",t.onCloseOverlay,!1);if(l.classList.add("overlayClose"),l.style.cssText="padding:calc(8 * var(--u)) calc(12 * var(--u)); border-radius:calc(12 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.16); background:rgba(255,255,255,.06); color:#fff; cursor:pointer;",s.appendChild(i),s.appendChild(l),o.appendChild(s),te.kind==="RULEBOOK"){const c=document.createElement("pre");c.className="rulebook",c.textContent=ps,c.style.cssText="white-space:pre-wrap; line-height:1.45; font-size:calc(13 * var(--u)); margin:0; padding:calc(12 * var(--u)); border-radius:calc(12 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.10); background:rgba(0,0,0,.18);",o.appendChild(c)}else if(te.kind==="SETTINGS")o.appendChild(Ti(()=>{we&&(Fn(),zn(),Kn()),A(we??e,t)}));else{const m=[...te.pile==="deck"?e.deck:te.pile==="discard"?e.discard:te.pile==="exhausted"?e.exhausted:te.pile==="vanished"?e.vanished:e.hand].sort((k,N)=>{const I=e.cards[k],C=e.cards[N],K=Ft(e,I.defId),L=Ft(e,C.defId),$=K.localeCompare(L,"ko");return $!==0?$:(I.upgrade??0)-(C.upgrade??0)}),u=v("pileView");u.style.cssText="display:grid;grid-template-columns: 1fr calc(320 * var(--u));gap:calc(16 * var(--u));align-items:start;";const d=v("pileGrid");d.style.cssText="display:grid;grid-template-columns: repeat(auto-fill, minmax(var(--handCardW), 1fr));gap:calc(10 * var(--u));align-content:start;min-width:0;max-height: 62vh;overflow-y: auto;overflow-x: hidden;";const b=v("pileSide");b.style.cssText="position:sticky; top:calc(72 * var(--u));align-self:start;border:calc(1 * var(--u)) solid rgba(255,255,255,.10);border-radius:calc(14 * var(--u));padding:calc(12 * var(--u));background:rgba(0,0,0,.22);";const E=v("pileSideTitle");E.style.cssText="font-weight:800; margin:0 0 calc(10 * var(--u)) 0; opacity:.95;",b.appendChild(E);const p=v("pilePreviewBox");p.style.cssText="display:flex; justify-content:center; align-items:flex-start;padding:calc(8 * var(--u)) 0 calc(10 * var(--u)) 0;",b.appendChild(p);const f=document.createElement("pre");f.className="pileSideDetail",f.style.cssText="margin:0;padding:calc(10 * var(--u));white-space:pre-wrap;border-radius:calc(12 * var(--u));border:calc(1 * var(--u)) solid rgba(255,255,255,.10);background:rgba(0,0,0,.20);font-size:calc(12 * var(--u));line-height:1.45;",b.appendChild(f);let h=m[0]??null;const x=()=>{if(p.innerHTML="",!h){E.textContent="ì„ íƒëœ ì¹´ë“œ ì—†ìŒ",f.textContent="";return}const k=Dt(e,h),N=Yr(e,h);E.textContent=N;const I=nt(e,h);p.appendChild(I),f.textContent=`ì „ì—´: ${k.frontText}
í›„ì—´: ${k.backText}`};if(m.length===0){const k=v("overlayEmpty");k.textContent="ë¹„ì–´ ìžˆìŒ",k.style.cssText="padding:calc(12 * var(--u)); border-radius:calc(12 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.10); background:rgba(255,255,255,.03);",d.appendChild(k)}else for(const k of m){const N=nt(e,k,C=>{h=C,x()});N.style.width="var(--handCardW)",N.style.height="var(--handCardH)",N.style.boxSizing="border-box",N.style.cursor="pointer";const I=()=>{h=k,d.querySelectorAll(".pileSelected").forEach(C=>C.classList.remove("pileSelected")),N.classList.add("pileSelected"),x()};N.onclick=I,N.onmouseenter=I,d.appendChild(N)}if(u.appendChild(d),u.appendChild(b),o.appendChild(u),h){const k=d.firstElementChild;k&&k.classList.add("pileSelected")}x()}r.appendChild(o),document.body.appendChild(r)}function ft(e,t){const n=document.createElement(e);return t&&(n.className=t),n}function xi(e,t){document.querySelector(".itemTray")?.remove(),document.querySelector(".itemCapHud")?.remove();const n=e.run.items??[];if(!n||n.length===0)return;const r=e.enemies.length>0&&e.phase!=="NODE",o=document.createElement("div");o.className="itemTray";let a=null;const s=document.createElement("div");s.className="relicHoverTip itemHoverTip",o.appendChild(s);const i=Rn(e),l=document.createElement("div");l.className="itemCapHud";const c=document.createElement("div");c.className="itemCapBadge",c.textContent=n.length+"/"+i;const m=document.createElement("div");m.className="itemCapHint",m.textContent="ìš°í´ë¦­/Ã—: ë²„ë¦¬ê¸°",l.appendChild(c),l.appendChild(m),document.body.appendChild(l);const u=()=>{const d=a;if(!d){s.classList.remove("show"),s.innerHTML="";return}const b=Te(d);s.innerHTML="";const E=document.createElement("div");E.className="relicTipTitle",E.textContent=b?.name??d;const p=document.createElement("div");p.className="relicTipBody",p.textContent=b?.text??"",s.appendChild(E),s.appendChild(p),s.classList.add("show")};for(let d=0;d<n.length;d++){const b=String(n[d]),E=Te(b),p=document.createElement("div");p.className="itemSlot",Tn(p,b);const f=document.createElement("img");f.alt=E?.name??b,E?.art&&(f.src=se(E.art)),p.appendChild(f);const h=document.createElement("button");h.type="button",h.className="itemDropBtn",h.title="",h.textContent="Ã—",h.onclick=k=>{k.preventDefault(),k.stopPropagation(),t.onDiscardItem(d)},p.appendChild(h),p.oncontextmenu=k=>{k.preventDefault(),k.stopPropagation(),t.onDiscardItem(d)};const x=!r||!!e.choice||!!te||ae(e);x&&p.classList.add("disabled"),p.onclick=k=>{k.stopPropagation(),!x&&t.onUseItem(d)},p.onmouseenter=()=>{a=b,u()},p.onmouseleave=()=>{a=null,u()},o.appendChild(p)}document.body.appendChild(o);try{const d=parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--u"))||1,b=o.getBoundingClientRect();l.style.left=`${Math.round(b.left+6*d)}px`,l.style.top=`${Math.round(b.top-10*d)}px`}catch{}}function Ci(e,t){const n=document.getElementById("relicTray");n&&n.remove();const r=e.run.relics??[];if(r.length===0)return;const o=ft("div","relicTray");o.id="relicTray";const a=ft("div","relicHoverTip");o.appendChild(a);const s=ft("div","relicTrayList");o.appendChild(s);const i=()=>{const l=Ee;if(!l){a.style.display="none",a.textContent="";return}if(!oe[l]){a.style.display="none",a.textContent="";return}const m=It(e,l);a.style.display="block",a.innerHTML="";const u=ft("div","relicTipTitle");u.textContent=m.name;const d=ft("div","relicTipBody");d.textContent=m.text,a.appendChild(u),a.appendChild(d)};for(const l of r){const c=oe[l];if(!c)continue;const m=It(e,l),u=document.createElement("button");if(u.type="button",u.className="relicIcon",c.art){const d=document.createElement("img");d.className="relicIconImg",d.alt=m.name,d.src=se(c.art),u.appendChild(d)}else u.textContent=m.name.slice(0,1);u.onmouseenter=()=>{Ee=l,i()},u.onmouseleave=()=>{Ee=null,i()},u.onclick=()=>{ze=l,A(e,t)},s.appendChild(u)}i(),document.body.appendChild(o)}function Ei(e,t){document.querySelector(".choice-overlay")?.remove();const n=e.choice,r=document.querySelector(".mainPanel");if(!n){r?.classList.remove("choiceOpen");return}if(!r)return;r.classList.add("choiceOpen");const o=e.choiceCtx?.kind==="SHOP",s=20+70,i=36,l=16,c=16,m=o?12:18,u=10,d=o?220:260,b=o?170:200,E=14,p=12,f=10,h=12,x=220,k=22,N=14,I=v("choice-overlay");I.style.cssText="position:fixed; inset:0; z-index: var(--zChoice);display:flex; justify-content:center; align-items:flex-start;pointer-events:auto;";const C=v("choice-backdrop");C.style.cssText="position:absolute; inset:0;background: rgba(0,0,0,.72);backdrop-filter: blur(calc(4 * var(--u)));-webkit-backdrop-filter: blur(calc(4 * var(--u)));pointer-events:auto;",C.onclick=()=>{};const K=v("choice-padWrap");K.style.cssText=`position:relative; width:100%;padding:calc(${s} * var(--u)) calc(${i} * var(--u)) calc(${l} * var(--u)) calc(${c} * var(--u));box-sizing:border-box;display:flex; justify-content:center; align-items:flex-start;pointer-events:auto;`;const L=v("choice-panel");L.style.cssText="position:relative;pointer-events:auto;",L.onclick=R=>R.stopPropagation();const $=Ws(n.title);if($.style.cssText=`margin:0 0 calc(8 * var(--u)) 0; font-size:calc(${k} * var(--u)); font-weight:900;text-align:left;`,L.appendChild($),n.prompt){const R=Hn(n.prompt);R.style.cssText=`margin:0 0 calc(12 * var(--u)) 0; font-size:calc(${N} * var(--u)); line-height:1.25; opacity:.95;`,L.appendChild(R)}const g=(R,T=1)=>{const _=T===1?"var(--handCardW)":`calc(var(--handCardW) * ${T})`,w=T===1?"var(--handCardH)":`calc(var(--handCardH) * ${T})`;R.style.width=_,R.style.height=w,R.style.boxSizing="border-box"},M=R=>{const T=document.createElement("pre");return T.className="choice-detail",T.textContent=String(R),T.style.cssText=`margin:calc(10 * var(--u)) 0 0 0; padding:calc(${f} * var(--u));white-space:pre-wrap;border-radius: 0; border:calc(1 * var(--u)) solid rgba(255,255,255,.10);background:rgba(0,0,0,.22);font-size:calc(${h} * var(--u)); line-height:1.45;max-height:calc(${x} * var(--u)); overflow:auto;`,T},U=()=>{const R=v("choice-item");return R.style.cssText=`display:flex;gap:calc(12 * var(--u));align-items:flex-start;border:calc(1 * var(--u)) solid rgba(255,255,255,.10); border-radius:calc(${E} * var(--u));padding:calc(${p} * var(--u));background:rgba(255,255,255,.03);`,R};if(!n.options.some(R=>!!(R.cardUid||typeof R.key=="string"&&R.key.startsWith("pick:")||o&&typeof R.key=="string"&&R.key.startsWith("shop:card:")))){const R=v("choice-contentRow");R.style.cssText=`display:flex;gap:calc(${m} * var(--u)); margin-top:calc(12 * var(--u));justify-content:center; align-items:stretch;`;const T=v("choice-leftCol");T.style.cssText=`flex:1 1 calc(${o?560:640} * var(--u)); max-width:calc(${o?640:720} * var(--u)); min-width:0;display:flex; flex-direction:column;`;const _=v("choice-list");_.style.cssText=`display:flex; flex-direction:column; gap:calc(${u} * var(--u));`,n.options.forEach(P=>{const O=U(),D=Fe(P.label,()=>t.onChooseChoice(P.key),!1);D.classList.add("choiceOptBtn"),D.style.fontSize="calc(14 * var(--u))",D.style.padding="calc(10 * var(--u)) calc(12 * var(--u))",D.style.borderRadius="calc(10 * var(--u))",O.appendChild(D),P.detail&&O.appendChild(M(P.detail)),_.appendChild(O)}),T.appendChild(_);const w=v("choice-illuCol");w.style.cssText=`flex:0 0 calc(${d} * var(--u)); min-width:calc(${b} * var(--u));display:flex; align-items:center; justify-content:center;`;const S=v("choice-illuBox");S.style.cssText="width:100%; aspect-ratio:1/1;border-radius:calc(18 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.16);background:rgba(0,0,0,.35);position:relative; overflow:hidden;box-shadow: 0 calc(10 * var(--u)) calc(30 * var(--u)) rgba(0,0,0,.35);";const B=n.art;if(B){const P=document.createElement("img");P.src=se(B),P.alt=n.title??"illustration";const O=1.5;P.style.imageRendering="pixelated",P.style.cssText=`position:absolute; inset:0;width:${O*100}%; height:${O*100}%;left:${-.5*50}%; top:${-.5*50}%;object-fit:cover; object-position:50% 50%;image-rendering: pixelated; image-rendering: crisp-edges;`,S.appendChild(P)}w.appendChild(S),R.appendChild(T),R.appendChild(w),L.appendChild(R),K.appendChild(L),I.appendChild(C),I.appendChild(K),document.body.appendChild(I);return}if(o){L.classList.add("shopPanel"),L.style.overflow="hidden";const R=String(e.choiceCtx?.nodeId??""),T=e.run?.shops?.[R];if(T){const _=v("shopCardsGrid");for(let G=0;G<(T.cards?.length??0);G++){const Y=T.cards[G];if(!Y?.defId)continue;const Z=v("shopCardTile");Y.sold&&Z.classList.add("sold");const ne=$t(e,String(Y.defId),Number(Y.upgrade??0)||0);g(ne,1),Z.appendChild(ne);const de=J("shopTilePrice",Y.sold?"í’ˆì ˆ":`ðŸª™${Number(Y.priceGold??0)||0}`);Z.appendChild(de),Y.sold||(Z.onclick=()=>t.onChooseChoice(`shop:card:${G}`)),_.appendChild(Z)}const w=v("shopBottomRow"),S=v("shopItemsCol"),B=v("shopItemsGrid");for(let G=0;G<(T.items?.length??0);G++){const Y=T.items[G];if(!Y?.itemId)continue;const Z=v("shopItemTile");Y.sold&&Z.classList.add("sold"),Tn(Z,String(Y.itemId));const ne=Te(String(Y.itemId)),de=document.createElement("img");de.alt=ne?.name??String(Y.itemId),ne?.art&&(de.src=se(ne.art)),Z.appendChild(de);const Pe=J("shopTilePrice",Y.sold?"í’ˆì ˆ":`ðŸª™${Number(Y.priceGold??0)||0}`);Z.appendChild(Pe),Y.sold||(Z.onclick=()=>t.onChooseChoice(`shop:item:${G}`)),B.appendChild(Z)}S.appendChild(B);const P=v("shopSvcCol"),O=v("shopSvcGrid"),D=(G,Y,Z,ne)=>{const de=v("shopSvcTile"),Pe=Fe(Y,()=>t.onChooseChoice(G),ne);Pe.classList.add("primary"),de.appendChild(Pe);const ue=J("shopSvcNote",Z);return de.appendChild(ue),de};O.appendChild(D("shop:service:upgrade",(T.usedUpgrade,"ê°•í™”"),T.usedUpgrade?"ì‚¬ìš© ì™„ë£Œ":"ðŸª™25",!!T.usedUpgrade)),O.appendChild(D("shop:service:remove",(T.usedRemove,"ì œê±°"),T.usedRemove?"ì‚¬ìš© ì™„ë£Œ":"ðŸª™25",!!T.usedRemove)),O.appendChild(D("shop:supply:buy","ë³´ê¸‰ êµ¬ë§¤","-ðŸª™6 / ðŸž+3",!1)),O.appendChild(D("shop:supply:sell","ë³´ê¸‰ íŒë§¤","+ðŸª™4 / ðŸž-3",!1)),P.appendChild(O),w.appendChild(S),w.appendChild(P);const F=n.options.find(G=>G.key==="shop:leave")?.label??"ë‚˜ê°€ê¸°",X=Fe(F,()=>t.onChooseChoice("shop:leave"),!1);X.classList.add("shopLeaveBtn"),X.style.cssText="position:absolute;top:calc(16 * var(--u)); right:calc(16 * var(--u));z-index: 2;border-radius:0;padding:calc(10 * var(--u)) calc(14 * var(--u));font-size:calc(13 * var(--u)); font-weight:900;",L.appendChild(X);const H=v("choice-contentRow");H.classList.add("shopContentRow");const j=v("choice-leftCol");j.classList.add("shopLeftCol"),j.appendChild(_),j.appendChild(w);const z=v("choice-illuCol");z.style.cssText=`flex:0 0 calc(${d} * var(--u)); min-width:calc(${b} * var(--u));display:flex; align-items:center; justify-content:center;`;const q=v("choice-illuBox");q.style.cssText="width:100%; aspect-ratio:1/1;border-radius:calc(18 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.16);background:rgba(0,0,0,.35);position:relative; overflow:hidden;box-shadow: 0 calc(10 * var(--u)) calc(30 * var(--u)) rgba(0,0,0,.35);";const Q=n.art;if(Q){const G=document.createElement("img");G.src=se(Q),G.alt=n.title??"illustration";const Y=1.5;G.style.imageRendering="pixelated",G.style.cssText=`position:absolute; inset:0;width:${Y*100}%; height:${Y*100}%;left:${-.5*50}%; top:${-.5*50}%;object-fit:cover; object-position:50% 50%;image-rendering: pixelated; image-rendering: crisp-edges;`,q.appendChild(G)}z.appendChild(q),H.appendChild(j),H.appendChild(z),L.appendChild(H),K.appendChild(L),I.appendChild(C),I.appendChild(K),document.body.appendChild(I);return}}else{const R=e.choiceCtx?.kind,T=!o&&(R==="BATTLE_CARD_REWARD"||R==="BATTLE_REWARD"),_=(S,B,P)=>{const O=`__choice_preview:${S}:${B}:${Math.random().toString(36).slice(2)}`,D=e.cards[O];e.cards[O]={uid:O,defId:S,upgrade:B,zone:"preview"};const F=dt(e,O,!0,()=>P(),{draggable:!1});return F.classList.add("overlayCard","choicePickCard"),F.draggable=!1,F.style.cursor="pointer",D?e.cards[O]=D:delete e.cards[O],F};if(T){const S=n.options.filter(F=>typeof F.key=="string"&&F.key.startsWith("pick:")),B=n.options.find(F=>F.key==="skip")??null,P=e.choiceCtx,O=P?.cardDecision;{const F=String(P?.itemOfferId??""),X=P?.itemDecision;if(F){const H=Te(F),j=v("choice-rewardItemRow");j.style.cssText="display:flex; justify-content:center; align-items:flex-start;gap:calc(14 * var(--u)); margin-bottom:calc(16 * var(--u));";const z=v("itemOfferCard");z.style.cssText="width:calc(170 * var(--u)); aspect-ratio:3/4;border-radius: 0;border:calc(1 * var(--u)) solid rgba(255,255,255,.14);background:rgba(0,0,0,.35);box-shadow: 0 calc(10 * var(--u)) calc(30 * var(--u)) rgba(0,0,0,.35);display:flex; flex-direction:column; align-items:center; justify-content:flex-start;padding:calc(12 * var(--u)); gap:calc(10 * var(--u));cursor:pointer; user-select:none;",Tn(z,F),X?(z.style.opacity=".55",z.style.cursor="default"):z.onclick=()=>t.onChooseChoice("take_item");const q=J("itemOfferTitle","ì•„ì´í…œ ë³´ìƒ");if(q.style.cssText="font-weight:900; font-size:calc(14 * var(--u)); opacity:.92;",H?.art){const ne=document.createElement("img");ne.src=se(H.art),ne.alt=H.name,ne.style.imageRendering="pixelated",ne.style.cssText="width:calc(96 * var(--u)); height:calc(96 * var(--u));object-fit:contain;image-rendering: pixelated; image-rendering: crisp-edges;",z.appendChild(ne)}const Q=J("itemOfferName",H?.name??F);Q.style.cssText="font-weight:800; font-size:calc(14 * var(--u)); text-align:center;";const G=J("itemOfferHint",X==="TAKEN"?"íšë“í•¨":X==="SKIPPED"?"ìƒëžµí•¨":"í´ë¦­í•˜ë©´ ë°›ìŠµë‹ˆë‹¤");G.style.cssText="opacity:.75; font-size:calc(12 * var(--u)); text-align:center;";const Y=v("itemOfferWrap");Y.style.cssText="display:flex; flex-direction:column; align-items:center;",Y.appendChild(q),Y.appendChild(z);const Z=J("itemOfferDesc",H?.text??"");if(Z.style.cssText="opacity:.85; font-size:calc(12 * var(--u)); text-align:center; white-space:pre-wrap; line-height:1.35;",Z.style.maxHeight="calc(54 * var(--u))",Z.style.overflow="hidden",Z.style.textOverflow="ellipsis",z.appendChild(Q),z.appendChild(Z),z.appendChild(G),j.appendChild(Y),!X){const ne=Fe("ì•„ì´í…œ ìƒëžµ",()=>t.onChooseChoice("skip_item"),!1);ne.classList.add("ghost"),ne.style.fontSize="calc(13 * var(--u))",ne.style.padding="calc(10 * var(--u)) calc(14 * var(--u))",ne.style.borderRadius="calc(10 * var(--u))",j.appendChild(ne)}L.appendChild(j)}}const D=v("choice-rewardCardRow");D.style.cssText="display:flex;gap:calc(18 * var(--u));justify-content:center; align-items:flex-start;flex-wrap:nowrap;";for(const F of S){const X=F.key.slice(5),[H,j]=X.split(":"),z=Number(j??"0")||0,q=!O,Q=_(H,z,()=>{q&&t.onChooseChoice(F.key)});q||(Q.style.opacity=".55",Q.style.cursor="default"),g(Q,1),D.appendChild(Q)}if(L.appendChild(D),B&&!O){const F=v("choice-rewardSkipRow");F.style.cssText="margin-top:calc(18 * var(--u)); display:flex; justify-content:center;";const X=Fe(B.label||"ìƒëžµ",()=>t.onChooseChoice("skip"),!1);X.classList.add("primary"),X.style.fontSize="calc(14 * var(--u))",X.style.padding="calc(10 * var(--u)) calc(16 * var(--u))",X.style.borderRadius="calc(10 * var(--u))",F.appendChild(X),L.appendChild(F)}K.appendChild(L),I.appendChild(C),I.appendChild(K),document.body.appendChild(I);return}const w=v("choice-list");if(w.style.cssText=`display:flex; flex-direction:column;gap:calc(${u} * var(--u)); margin-top:calc(12 * var(--u));`,n.options.forEach(S=>{if(o&&(S.key==="shop:sep"||S.key.startsWith("shop:sep:"))){const X=v("choice-sep");X.style.cssText="height:calc(1 * var(--u));background:rgba(255,255,255,.12);margin:calc(6 * var(--u)) 0;",w.appendChild(X);return}const B=U(),P=v("choice-left");P.style.cssText="flex:0 0 auto;";const O=S.cardUid;if(O){const X=e.choice?.kind==="UPGRADE_PICK",j=(e.cards[O]?.upgrade??0)||0,z=j+1;if(X){const q=v("upgradePair");q.style.cssText="display:flex; gap:calc(10 * var(--u)); align-items:flex-start;";let Q,G;try{Q=pr(e,O,j)}catch{Q=nt(e,O)}try{G=pr(e,O,z)}catch{G=nt(e,O)}g(Q,1),g(G,1);const Y=J("upgradeArrow","â†’");Y.style.cssText="align-self:center; font-weight:900; opacity:.85; margin-top:calc(6 * var(--u));",q.appendChild(Q),q.appendChild(Y),q.appendChild(G),P.appendChild(q)}else{let q;try{q=nt(e,O)}catch{q=nt(e,O)}g(q),P.appendChild(q)}}else if(typeof S.key=="string"&&S.key.startsWith("pick:")){const X=S.key.slice(5),[H,j]=X.split(":"),z=Number(j??"0")||0,q=$t(e,H,z);g(q),P.appendChild(q)}else if(o&&typeof S.key=="string"&&S.key.startsWith("shop:card:")){const X=String(e.choiceCtx?.nodeId??""),H=e.run?.shops?.[X],j=Number(S.key.slice(10)),z=H?.cards?.[j];if(z?.defId){const q=$t(e,String(z.defId),Number(z.upgrade??0)||0);g(q),z.sold&&(q.style.opacity=".35"),P.appendChild(q)}}else if(o&&typeof S.key=="string"&&S.key.startsWith("shop:item:")){const X=String(e.choiceCtx?.nodeId??""),H=e.run?.shops?.[X],j=Number(S.key.slice(10)),z=H?.items?.[j];if(z?.itemId){const q=Te(String(z.itemId)),Q=v("shopItemCard");if(Q.style.cssText="width:calc(150 * var(--u)); aspect-ratio:3/4;border-radius: 0;border:calc(1 * var(--u)) solid rgba(255,255,255,.14);background:rgba(0,0,0,.30);box-shadow: 0 calc(10 * var(--u)) calc(30 * var(--u)) rgba(0,0,0,.25);display:flex; flex-direction:column; align-items:center; justify-content:flex-start;padding:calc(10 * var(--u)); gap:calc(8 * var(--u));user-select:none;"+(z.sold?"opacity:.35; cursor:default;":"cursor:pointer;"),z.sold||(Q.onclick=()=>t.onChooseChoice(S.key)),q?.art){const Z=document.createElement("img");Z.src=se(q.art),Z.alt=q?.name??String(z.itemId),Z.style.imageRendering="pixelated",Z.style.cssText="width:calc(84 * var(--u)); height:calc(84 * var(--u));object-fit:contain;image-rendering: pixelated; image-rendering: crisp-edges;",Q.appendChild(Z)}const G=J("shopItemName",q?.name??String(z.itemId));G.style.cssText="font-weight:900; font-size:calc(13 * var(--u)); text-align:center;";const Y=J("shopItemPrice",z.sold?"í’ˆì ˆ":`ðŸª™${Number(z.priceGold??0)||0}`);Y.style.cssText="opacity:.85; font-size:calc(12 * var(--u));",Q.appendChild(G),Q.appendChild(Y),P.appendChild(Q)}}const D=v("choice-right");D.style.cssText="flex:1 1 auto; min-width:calc(260 * var(--u));";const F=Fe(S.label,()=>t.onChooseChoice(S.key),!1);F.classList.add("primary"),F.style.fontSize="calc(14 * var(--u))",F.style.padding="calc(10 * var(--u)) calc(12 * var(--u))",F.style.borderRadius="calc(10 * var(--u))",D.appendChild(F),S.detail&&D.appendChild(M(S.detail)),B.appendChild(P),B.appendChild(D),w.appendChild(B)}),o){const S=v("choice-contentRow");S.style.cssText=`display:flex;gap:calc(${m} * var(--u)); margin-top:calc(12 * var(--u));justify-content:center; align-items:stretch;`;const B=v("choice-leftCol");B.style.cssText="flex:1 1 calc(560 * var(--u)); max-width:calc(640 * var(--u)); min-width:0;display:flex; flex-direction:column;",B.appendChild(w);const P=v("choice-illuCol");P.style.cssText=`flex:0 0 calc(${d} * var(--u)); min-width:calc(${b} * var(--u));display:flex; align-items:center; justify-content:center;`;const O=v("choice-illuBox");O.style.cssText="width:100%; aspect-ratio:1/1;border-radius:calc(18 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.16);background:rgba(0,0,0,.35);position:relative; overflow:hidden;box-shadow: 0 calc(10 * var(--u)) calc(30 * var(--u)) rgba(0,0,0,.35);";const D=n.art;if(D){const F=document.createElement("img");F.src=se(D),F.alt=n.title??"illustration";const X=1.5;F.style.imageRendering="pixelated",F.style.cssText=`position:absolute; inset:0;width:${X*100}%; height:${X*100}%;left:${-.5*50}%; top:${-.5*50}%;object-fit:cover; object-position:50% 50%;image-rendering: pixelated; image-rendering: crisp-edges;`,O.appendChild(F)}P.appendChild(O),S.appendChild(B),S.appendChild(P),L.appendChild(S)}else L.appendChild(w)}K.appendChild(L),I.appendChild(C),I.appendChild(K),document.body.appendChild(I)}function gi(e,t){document.querySelectorAll(".topHud").forEach(h=>h.remove()),document.querySelectorAll(".enemyHudCenter").forEach(h=>h.remove());const n=v("topHud");n.appendChild(v("topHudLeftSpacer"));const r=v("playerHudLeft"),o=v("playerTitleRow");o.appendChild(J("playerHudTitle","í”Œë ˆì´ì–´"));const a=v("pileButtons");a.appendChild(ie("ë±",()=>t.onViewPile("deck"))),a.appendChild(ie("ë²„ë¦¼",()=>t.onViewPile("discard"))),a.appendChild(ie("ì†íŒ¨",()=>t.onViewPile("hand"))),a.appendChild(ie("ì†Œëª¨",()=>t.onViewPile("exhausted"))),a.appendChild(ie("ì†Œì‹¤",()=>t.onViewPile("vanished"))),o.appendChild(a),r.appendChild(o);const s=v("enemyChip");s.classList.add("playerHudBox");const i=v("enemyChipTop");i.appendChild(J("","HP")),i.appendChild(J("",`${e.player.hp}/${e.player.maxHp}`)),s.appendChild(i);const l=v("enemyHPOuter"),c=v("enemyHPFill");c.style.width=`${Math.max(0,Math.min(100,e.player.hp/Math.max(1,e.player.maxHp)*100))}%`,l.appendChild(c),s.appendChild(l);const m=v("enemyChipTop");m.appendChild(J("","ë¸”ë¡")),m.appendChild(J("",`${e.player.block}`)),s.appendChild(m);const u=v("enemyHPOuter"),d=v("enemyHPFill");d.style.background="#2a7cff",d.style.width=`${Math.max(0,Math.min(100,e.player.block/Math.max(1,e.player.maxHp)*100))}%`,u.appendChild(d),s.appendChild(u);const b=e.player.status,E=v("enemyBadges");s.appendChild(E);const p=[];(b.vuln??0)>0&&p.push(`ì·¨ì•½ ${b.vuln}`),(b.weak??0)>0&&p.push(`ì•½í™” ${b.weak}`),(b.bleed??0)>0&&p.push(`ì¶œí˜ˆ ${b.bleed}`),(b.disrupt??0)>0&&p.push(`êµëž€ ${b.disrupt}`);for(const h of p)E.appendChild(xn(h));if(r.appendChild(s),!e.run.finished&&e.enemies.length>0&&e.phase!=="NODE"){const h=v("enemyHudCenter"),x=v("enemyHudCenterMover"),k=v("enemyHud");k.style.cssText=`
      display: flex;
      flex-direction: row;
      flex-wrap: nowrap;
      justify-content: center;
      align-items: stretch;
      gap: calc(14 * var(--u));
      overflow: visible;
      white-space: nowrap;
    `,h.style.overflow="visible",x.style.overflow="visible",x.style.width="max-content";const N=ae(e);x.appendChild(k),h.appendChild(x),document.body.appendChild(h);for(let I=0;I<e.enemies.length;I++){const C=e.enemies[I],K=v("enemyBanner enemyCardWrap");N&&C.hp>0&&K.classList.add("targetable"),K.onclick=()=>t.onSelectEnemy(I);const L=v("enemyArtWrap"),$=v("enemyArtCard");L.style.setProperty("--frameImg",`url("${se("assets/enemies/enemies_frame.png")}")`),L.style.setProperty("--artImg",`url("${Gs(C.id)}")`),L.appendChild($);const g=v("enemyMiniHud"),M=e.content.enemiesById[C.id],U=M.intents[C.intentIndex%M.intents.length],V=C.intentLabelOverride??U.label,R=e.intentsRevealedThisTurn?gr(e,C,U,{includeBlock:!1}):null,T=v("enemyIntentTopRow");let _="ï¼Ÿ",w="";e.intentsRevealedThisTurn&&R?(_=Xs(R),w=Ys(e,C,R)??""):(_="ï¼Ÿ",w=""),T.appendChild(J("enemyIntentIcon",_)),T.appendChild(J("enemyIntentDmg",w)),g.appendChild(T);const S=v("enemyHpLine");S.appendChild(J("enemyHpText",`HP ${C.hp}/${C.maxHp}`));const B=v("enemyHPOuter"),P=v("enemyHPFill");P.style.width=`${Math.max(0,Math.min(100,C.hp/Math.max(1,C.maxHp)*100))}%`,B.appendChild(P),S.appendChild(B),g.appendChild(S),g.appendChild(Qs(C.status,C.immuneThisTurn));const O=v("enemyHoverDetail"),D=C.status,F=[];(D.vuln??0)>0&&F.push(`ì·¨ì•½ ${D.vuln}`),(D.weak??0)>0&&F.push(`ì•½í™” ${D.weak}`),(D.bleed??0)>0&&F.push(`ì¶œí˜ˆ ${D.bleed}`),(D.disrupt??0)>0&&F.push(`êµëž€ ${D.disrupt}`),C.immuneThisTurn&&F.push("ë©´ì—­"),O.textContent=e.enemies[I].name+`
 
`+(e.intentsRevealedThisTurn?`${V}
 
`:"")+(F.length?`ìƒíƒœ: ${F.join(", ")}`:"ìƒíƒœ: ì—†ìŒ"),K.appendChild(L),K.appendChild(g),K.appendChild(O),k.appendChild(K)}}return n.appendChild(r),n}function Si(e,t){document.querySelector(".topHudRightChrome")?.remove();const n=v("topHudRight");n.classList.add("topHudRightChrome"),n.appendChild(ie("ë£°ë¶",()=>t.onViewRulebook())),n.appendChild(ie("ë¡œê·¸",()=>t.onToggleLogOverlay())),n.appendChild(ie("ì„¤ì •",()=>{te={kind:"SETTINGS"},A(e,t)})),document.body.appendChild(n)}function wi(e){const t=Number(e.run.nextBattleSuppliesBonus??0)||0,n=Number(e.run.gold??0)||0,r=[];if(r.push(`ðŸª™ G ${n}`),t!==0){const o=t>0?`+${t}`:`${t}`;r.push(`ë‹¤ìŒ ì „íˆ¬ ðŸž ${o}`)}return r.join(" | ")}function _i(e){e.enemies.length>0&&e.phase;const t=e.run,n=Number(t.timeMove??0)||0,r=Number(e.time??0)||0,o=n+r,a=[];return a.push(`â³ ì´ ${o}`),a.push(`ðŸƒ ë± ${e.deck.length}`),a.push(`ðŸ’¤ F ${e.player.fatigue}`),a.join(" | ")}function pn(e,t=""){const n=document.createElement("span");return n.className="chip"+(t?` ${t}`:""),n.textContent=e,n}function $i(e){const t=v("battleTitleRow");t.style.display="flex",t.style.alignItems="center",t.style.gap="calc(12 * var(--u))";const n=document.createElement("h2");n.textContent="",t.appendChild(n);const r=Ai(e),o=J("targetHintInline","");o.style.cssText="padding:calc(5 * var(--u)) calc(10 * var(--u)); border-radius:calc(12 * var(--u)); border:calc(1 * var(--u)) solid rgba(0,0,0,.55);background: rgb(255, 0, 0);opacity:1;font-weight:400; font-size:calc(12 * var(--u)); line-height:1.2;white-space:nowrap; overflow:hidden; text-overflow:ellipsis;width: min(calc(240 * var(--u)), 92vw);max-width: none;pointer-events:auto;",r?(o.textContent=r,o.style.visibility="visible",o.style.pointerEvents="auto"):(o.textContent="ëŒ€ìƒ ì„ íƒ í•„ìš”",o.style.visibility="hidden",o.style.pointerEvents="none");const a=v("battleTitleRight");a.style.cssText="margin-left:auto;display:flex; align-items:center; gap:calc(10 * var(--u));flex: 0 0 auto;white-space:nowrap;position:relative;";const s=v("resourceRow inline");return s.appendChild(pn("")),s.appendChild(pn("")),s.appendChild(pn("")),a.appendChild(s),o.style.position="absolute",o.style.right="calc(207 * var(--u))",o.style.top="calc(100% - calc(8 * var(--u)))",o.style.marginTop="0",o.style.zIndex="5",o.style.pointerEvents=r?"auto":"none",t.appendChild(o),t.appendChild(a),t}function Ni(e,t){const n=v("logHeaderRow");n.tabIndex=0;const r=document.createElement("h2");r.textContent="ë¡œê·¸";const o=document.createElement("span");return o.className="chev",o.textContent=e?"â–¸":"â–¾",n.appendChild(r),n.appendChild(o),n.onclick=()=>t(),n.onkeydown=a=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),t())},n}function Ai(e){if(!ae(e)||e.selectedEnemyIndex!=null)return null;const t=e.pendingTarget??null,n=t?.sourceCardUid?be(e,t.sourceCardUid):null,r=t?.sourceLabel??null,o=t?.reason??null,a=n?`ëŒ€ìƒ ì„ íƒ (${n})`:r?`ëŒ€ìƒ ì„ íƒ (${r})`:"ëŒ€ìƒ ì„ íƒ í•„ìš”",s=o==="FRONT"?"ì „ì—´":o==="BACK"?"í›„ì—´":o==="EVENT"?"ì´ë²¤íŠ¸":o==="RELIC"?"ìœ ë¬¼":null,i=s?` â€” ${s}`:"",l=e.pendingTargetQueue?.length??0,c=(e.pendingTarget?1:0)+l,m=c>1?` (ë‚¨ì€ ${c}ê°œ)`:" (ë‚¨ì€ 1ê°œ)";return`${a}${i}${m}`}function Ii(e,t,n){const r=v("combatRoot"),o=v("boardArea"),a=!t.run.finished&&t.enemies.length>0&&t.phase!=="NODE";o.classList.toggle("slabOn",a);const s=v("boardSlotsWrap");s.style.paddingTop="calc(6 * var(--u))",s.appendChild(mr(t,n,"front")),s.appendChild(mr(t,n,"back")),o.appendChild(s),r.appendChild(o),e.appendChild(r)}let gn=null,no=!0;function fr(e,t){gn=e,no=t}function ro(e,t,n){return e.run.finished?{label:"ì¢…ë£Œ",fn:null,disabled:!0,activePhase:e.phase}:e.choice||te?{label:"ì„ íƒ ì¤‘",fn:null,disabled:!0,activePhase:e.phase}:n?{label:"ëŒ€ìƒ ì„ íƒ",fn:null,disabled:!0,activePhase:e.phase}:e.phase==="NODE"?{label:"ë…¸ë“œ ì„ íƒ",fn:null,disabled:!0,activePhase:e.phase}:e.phase==="PLACE"?e.enemies.length>0&&!e.intentsRevealedThisTurn?{label:"ë‹¤ìŒ: ì •ì°°",fn:t.onRevealIntents,disabled:!1,activePhase:e.phase}:{label:"ë‹¤ìŒ: í›„ì—´",fn:t.onResolveBack,disabled:!1,activePhase:e.phase}:e.phase==="BACK"?{label:"ë‹¤ìŒ: í›„ì—´",fn:t.onResolveBack,disabled:!1,activePhase:e.phase}:e.phase==="FRONT"?{label:"ë‹¤ìŒ: ì „ì—´",fn:t.onResolveFront,disabled:!1,activePhase:e.phase}:e.phase==="ENEMY"?{label:"ë‹¤ìŒ: ì ",fn:t.onResolveEnemy,disabled:!1,activePhase:e.phase}:e.phase==="UPKEEP"?{label:"ë‹¤ìŒ: ì •ë¦¬",fn:t.onUpkeep,disabled:!1,activePhase:e.phase}:e.phase==="DRAW"?{label:"ë‹¤ìŒ í„´",fn:t.onDrawNextTurn,disabled:!1,activePhase:e.phase}:{label:"ë‹¤ìŒ",fn:null,disabled:!0,activePhase:e.phase}}function Mi(e,t,n){const r=document.querySelector(".handDock");r&&r.remove();const o=!e.run.finished&&e.enemies.length>0&&e.phase!=="NODE";document.querySelector(".combatControls")?.remove();const a=v("handDock"),s=ro(e,t,n);if(o){const c=v("combatControls"),m=document.createElement("button");m.textContent="ë‹¤ìŒ í„´",m.className="stepBtn primary",m.disabled=s.disabled||e.phase==="NODE",m.onclick=()=>t.onAutoAdvance(),c.appendChild(m),document.body.appendChild(c);const u=document.querySelector('.slot[data-slot-side="front"][data-slot-index="1"]')??document.querySelector(".stageInner");if(u){const d=u.getBoundingClientRect(),b=d.left+d.width/2;c.style.left=Me(Math.round(b))}fr(()=>t.onAutoAdvance(),m.disabled)}else fr(null,!0);const i=v("hand");i.dataset.dropHand="1";const l=v("handCardsRow");if(i.appendChild(l),e.hand.length===0){const c=v("handEmptyHint");c.textContent="",l.appendChild(c)}else for(const c of e.hand)l.appendChild(dt(e,c,!0,t.onSelectHandCard,{draggable:!0}));a.appendChild(i),document.body.appendChild(a),Pi(i)}function Pi(e){e.dataset?.wheelX!=="1"&&(e.dataset.wheelX="1",e.addEventListener("wheel",t=>{if(t.shiftKey)return;const n=Math.abs(t.deltaX)>Math.abs(t.deltaY)?t.deltaX:t.deltaY;e.scrollLeft+=n,t.preventDefault()},{passive:!1}))}function Kn(){const e=document.querySelector(".enemyHudCenter");if(!e)return;const t=e.querySelector(".enemyHudCenterMover")??e,n=e.querySelector(".enemyHud")??e.querySelector(".enemyStrip")??t;e.style.position="fixed";const r=document.querySelector(".topHud");if(r&&Math.round(r.getBoundingClientRect().bottom+10),e.style.top="calc(8 * var(--u))",e.style.left="50%",e.style.right="auto",e.style.transform="translateX(-50%)",e.style.overflow="visible",t.style.transform="",t.style.overflow="visible",Array.from(e.querySelectorAll(".enemyBanner")).length===0){e.style.width="";return}const l=14;n.style.display="flex",n.style.flexWrap="nowrap",n.style.justifyContent="center",n.style.alignItems="stretch",n.style.gap=`calc(${l} * var(--u))`,e.style.width="auto",e.style.maxWidth="calc(100vw - calc(16 * var(--u)))",n.style.maxWidth="100%",n.style.overflowX="auto",t.style.width="100%"}function zn(e){const t=document.querySelector(".hand"),n=document.querySelector(".handCardsRow");if(!t||!n)return;const r=document.querySelector('.slot[data-slot-side="front"][data-slot-index="1"]'),o=document.querySelector(".stageInner"),a=r?.getBoundingClientRect()??o?.getBoundingClientRect();if(!a)return;const s=a.left+a.width/2,i=Array.from(n.querySelectorAll(".card"));if(i.length===0)return;const l=i[0].getBoundingClientRect(),c=i[i.length-1].getBoundingClientRect(),m=l.left,u=c.right,d=(m+u)/2,b=s-d,E=n.scrollWidth,p=t.clientWidth;if(E<=p+1){const x=b/window.innerWidth*100;n.style.transform=`translateX(${x.toFixed(4)}vw)`,t.scrollLeft=0;return}let f=t.scrollLeft-b;const h=Math.max(0,E-p);f<0&&(f=0),f>h&&(f=h),t.scrollLeft=Math.round(f),n.style.transform=""}function oo(e,t){const n=getComputedStyle(document.documentElement),r=parseFloat(n.getPropertyValue("--handCardW"))||240,o=parseFloat(n.getPropertyValue("--handCardH"))||336,a=e.getBoundingClientRect();if(a.width<=0||a.height<=0)return;const s=6,i=Math.max(1,a.width-s*2),l=Math.max(1,a.height-s*2);let c=Math.min(i/r,l/o);c=Math.max(.8,Math.min(1,c)),t.style.setProperty("--slotCardScale",String(c))}function mr(e,t,n){const r=v("grid6"),o=!!e.selectedHandCardUid,a=n==="front"?e.frontSlots:e.backSlots;for(let s=0;s<3;s++){const i=n==="back"?!!e.backSlotDisabled?.[s]:!1,l=v("slot"+(i?" disabled":""));l.dataset.slotSide=n,l.dataset.slotIndex=String(s),Ne&&Ne.side===n&&Ne.idx===s&&l.classList.add("dropHover"),o&&!i&&l.classList.add("placeable");const c=a[s];if(c){const m=le.slotCardMode==="NAME_ONLY"?"SLOT_NAME_ONLY":"FULL",u=dt(e,c,!1,void 0,{draggable:!1,mode:m,hoverPreview:{root:document.body,api:qr,buildDetail:(b,E)=>{const p=Dt(b,E);return`ì „ì—´: ${p.frontText}
í›„ì—´: ${p.backText}`}}});u.classList.add("inSlot");const d=document.createElement("div");d.className="slotCardScaler",d.appendChild(u),l.appendChild(d),u.onpointerdown=b=>{b.button!==0&&b.pointerType==="mouse"||ae(e)||e.phase==="PLACE"&&ao(b,{kind:"slot",cardUid:c,fromSide:n,fromIdx:s})},u.ondblclick=()=>t.onReturnSlotToHand(n,s),requestAnimationFrame(()=>oo(l,d))}r.appendChild(l)}return r}function Ri(){if(document.querySelectorAll(".slot.dropHover").forEach(n=>n.classList.remove("dropHover")),!Ne)return;const e=`.slot[data-slot-side="${Ne.side}"][data-slot-index="${Ne.idx}"]`,t=document.querySelector(e);t&&t.classList.add("dropHover")}let hr=!1;function Li(e,t){hr||(hr=!0,window.addEventListener("pointermove",n=>{const r=e();if(r.choice||te||!W||n.pointerId!==W.pointerId)return;W.x=n.clientX,W.y=n.clientY;const o=W.x-W.startX,a=W.y-W.startY,s=W.dragging;!W.dragging&&o*o+a*a>36&&(W.dragging=!0),!s&&W.dragging&&(On(250),Xt()),Ne=W.dragging?yr(n.clientX,n.clientY,r):null,so(document.querySelector("#app")),Ri()},{passive:!0}),window.addEventListener("pointerup",n=>{n.pointerType==="mouse"&&Zr()},{capture:!0,passive:!0}),window.addEventListener("pointerup",n=>{const r=e();if(!(r.choice||te)&&!(!W||n.pointerId!==W.pointerId)){if(W.dragging){const o=Bi(n.clientX,n.clientY),a=yr(n.clientX,n.clientY,r);if(o&&W.kind==="slot"&&W.fromSide!=null&&W.fromIdx!=null){!r.run.finished&&!ae(r)&&r.phase==="PLACE"&&t.onReturnSlotToHand(W.fromSide,W.fromIdx),W=null,Ne=null,A(r,t);return}if(a)if(W.kind==="hand"){const s=e();if(!(s.run.finished||ae(s)||s.phase!=="PLACE")){const i=a.side,l=a.idx;if(!(i==="back"&&s.backSlotDisabled?.[l])){const c=i==="front"?s.frontSlots:s.backSlots,m=c[l];if(!m)t.onPlaceHandUidToSlot(W.cardUid,i,l);else{const u=W.fromHandIndex!=null&&W.fromHandIndex>=0?W.fromHandIndex:s.hand.indexOf(W.cardUid),d=s.hand.indexOf(W.cardUid);d>=0&&s.hand.splice(d,1),c[l]=W.cardUid,s.cards[W.cardUid].zone=i;const b=u!=null&&u>=0&&u<=s.hand.length?u:s.hand.length;s.hand.splice(b,0,m),s.cards[m].zone="hand",s.selectedHandCardUid=null,En(s),y(s,`[${be(s,W.cardUid)}] â†” [${be(s,m)}] ìŠ¤ì™‘: ì†íŒ¨ â†” ${i}${l+1}`),A(s,t)}}}}else W.kind==="slot"&&W.fromSide!=null&&W.fromIdx!=null&&(W.fromSide===a.side&&W.fromIdx===a.idx||t.onMoveSlotCard(W.fromSide,W.fromIdx,a.side,a.idx))}W?.sourceEl&&W.sourceEl.classList.remove("isDraggingSource"),W=null,Ne=null,A(r,t)}}),window.addEventListener("keydown",n=>{const r=n.target;if(r&&(r.tagName==="INPUT"||r.tagName==="TEXTAREA"))return;const o=e();if(!Xa()){if(n.ctrlKey&&n.shiftKey&&n.code==="KeyK"){n.preventDefault(),Qa();return}if(n.code==="KeyP"){n.preventDefault(),t.onNewRun();return}if(n.code==="Digit4"){if(n.preventDefault(),ae(o)){o.pendingTarget=null,o.pendingTargetQueue=[],o.selectedEnemyIndex=null,y(o,"ëŒ€ìƒ ì„ íƒ ì·¨ì†Œ"),A(o,t);return}t.onClearSelected();return}if(n.key==="Tab"){if(n.preventDefault(),o.hand.length===0)return;const a=o.selectedHandCardUid,s=a?o.hand.indexOf(a):-1,i=n.shiftKey?-1:1,l=((s+i)%o.hand.length+o.hand.length)%o.hand.length;o.selectedHandCardUid=o.hand[l],A(o,t);return}if(n.code==="Space"){n.preventDefault();const a=e();if(a.run.finished||a.choice||ae(a))return;t.onAutoAdvance();return}if(n.code==="Digit1"||n.code==="Digit2"||n.code==="Digit3"){n.preventDefault();const a=n.code==="Digit1"?0:n.code==="Digit2"?1:2;if(ae(o)){const s=o.enemies[a];if(!s||s.hp<=0){y(o,`ëŒ€ìƒ ì„ íƒ ì‹¤íŒ¨: ${a+1}ë²ˆ ì ì´ ì—†ìŠµë‹ˆë‹¤.`),A(o,t);return}t.onSelectEnemy(a);return}t.onHotkeySlot("front",a);return}if(n.code==="KeyQ"||n.code==="KeyW"||n.code==="KeyE"){n.preventDefault();const a=n.code==="KeyQ"?0:n.code==="KeyW"?1:2;t.onHotkeySlot("back",a);return}if(n.code==="Enter"){n.preventDefault(),!no&&gn&&gn();return}}}))}function ao(e,t){On(250),Xt();const n=e.currentTarget;try{n.setPointerCapture(e.pointerId)}catch{}const r=n.closest(".card");r&&r.classList.add("isDraggingSource");const o=r?.getBoundingClientRect(),a=o?e.clientX-o.left:20,s=o?e.clientY-o.top:20,i=getComputedStyle(document.documentElement),l=parseFloat(i.getPropertyValue("--handCardW"))||void 0,c=parseFloat(i.getPropertyValue("--handCardH"))||void 0;if(W={kind:t.kind,cardUid:t.cardUid,fromHandIndex:t.fromHandIndex,fromSide:t.fromSide,fromIdx:t.fromIdx,pointerId:e.pointerId,startX:e.clientX,startY:e.clientY,x:e.clientX,y:e.clientY,dragging:!1,previewEl:void 0,previewW:o?.width??l,previewH:o?.height??c,grabDX:a,grabDY:s},r){W.sourceEl=r;const m=r.cloneNode(!0);m.classList.remove("inSlot"),m.classList.remove("selected"),m.classList.remove("isDraggingSource"),m.style.position="static",m.style.inset="",m.style.width="100%",m.style.height="100%",m.style.margin="0",m.style.boxSizing="border-box",m.style.opacity="1",m.style.filter="none",m.style.transform="none",m.style.backgroundColor="transparent",W.previewEl=m}}function Bi(e,t){const n=document.elementFromPoint(e,t);if(!n)return!1;let r=n;for(;r;){if(r.dataset?.dropHand==="1")return!0;r=r.parentElement}return!1}function yr(e,t,n){const r=document.elementFromPoint(e,t);if(!r)return null;const o=Oi(r,["slotSide","slotIndex"]);if(!o)return null;const a=o.dataset.slotSide,s=Number(o.dataset.slotIndex);return a==="back"&&n.backSlotDisabled?.[s]?null:{side:a,idx:s}}function Oi(e,t){let n=e;for(;n;){const r=n.dataset;let o=!0;for(const a of t)if(r[a]==null){o=!1;break}if(o)return n;n=n.parentElement}return null}function so(e,t){if(!W||!W.dragging){document.querySelector(".dragLayer")?.remove();return}let n=document.querySelector(".dragLayer");if(n||(n=document.createElement("div"),n.className="dragLayer",n.style.position="fixed",n.style.inset="0",n.style.zIndex="21000",n.style.pointerEvents="none",document.body.appendChild(n)),n.innerHTML="",!W.previewEl)return;const r=document.createElement("div");r.className="dragCardPreview",r.style.position="fixed";const o=(W.x-(W.grabDX??20))/window.innerWidth*100,a=(W.y-(W.grabDY??20))/window.innerHeight*100;r.style.left=`${o.toFixed(4)}vw`,r.style.top=`${a.toFixed(4)}vh`;const s=W.previewW??0,i=W.previewH??0;if(s>0){const l=s/window.innerWidth*100;r.style.width=`${l.toFixed(4)}vw`}if(i>0){const l=i/window.innerHeight*100;r.style.height=`${l.toFixed(4)}vh`}r.style.transform="none",r.style.opacity="1",r.style.filter="none",r.style.boxShadow="0 calc(16 * var(--u)) calc(44 * var(--u)) rgba(0,0,0,.65)",r.style.backdropFilter="none",r.style.isolation="isolate",r.style.mixBlendMode="normal",r.style.overflow="hidden",r.style.borderRadius="0",r.style.background="transparent",r.style.clipPath="inset(0)",r.appendChild(W.previewEl),n.appendChild(r)}po();fo();const Hi=za();let ht=Os(Hi);function io(e){ht=e,Sn=to(ht,io),A(ht,Sn)}let Sn=to(ht,io);function Di(){let e="/deck-rogue-prototype/";e.endsWith("/")||(e+="/");const t=document.documentElement,n=(r,o)=>{t.style.setProperty(r,`url("${e}${o}")`)};n("--cardBgBasic","assets/ui/cards/card_basic.png"),n("--cardBgCommon","assets/ui/cards/card_common.png"),n("--cardBgSpecial","assets/ui/cards/card_special.png"),n("--cardBgRare","assets/ui/cards/card_rare.png"),n("--cardBgMadness","assets/ui/cards/card_madness.png")}Di();function Fi(){let e="/deck-rogue-prototype/";e.endsWith("/")||(e+="/");const t=`
@font-face{
  font-family: "Mulmaru";
  src:
    url("${e}assets/fonts/Mulmaru.woff2") format("woff2"),
    url("${e}assets/fonts/Mulmaru.woff") format("woff");
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}
  `.trim();let n=document.getElementById("fontFaces");n||(n=document.createElement("style"),n.id="fontFaces",document.head.appendChild(n)),n.textContent=t}Fi();A(ht,Sn);document.documentElement.style.setProperty("--base","/deck-rogue-prototype/");
