(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const $n=(e,t,n)=>Math.max(t,Math.min(n,e)),Mr=(e,t,n)=>{const r=parseFloat(e.getPropertyValue(t));return Number.isFinite(r)?r:n},fo=()=>{const e=window.visualViewport,t=e?.width??window.innerWidth,n=e?.height??window.innerHeight;return{vw:Math.max(1,t),vh:Math.max(1,n)}},ya=(e,t)=>Math.min(e/1440,t/900),mo=(e,t)=>t>=e*1.08?"portrait":e>=t*1.08?"landscape":"square",ho=()=>{try{const e=new URLSearchParams(window.location.search),t=e.get("mobile")??e.get("m"),n=e.get("desktop"),r=e.get("orient");return{forceDevice:(n==="1"?!0:null)?!1:t==="1"?!0:t==="0"?!1:null,forceOrient:r==="portrait"||r==="landscape"||r==="square"?r:null}}catch{return{forceDevice:null,forceOrient:null}}},ir=e=>(window.matchMedia?.("(pointer: coarse)")?.matches??!1)&&e<=980;function ka(){const e=document.documentElement,t=ho(),n=180,r=5,o=7,s=3,a=14,i=360,l=14,c=320,d=64,p=160,u=16,k=22,T=6,m=140;let f=0,b="";const x=()=>{f=0;const N=getComputedStyle(e),{vw:W,vh:C}=fo(),O=t.forceDevice??ir(W),$=O?Mr(N,"--uiScaleMobile",1):Mr(N,"--uiScaleDesktop",1),w=$n($,.65,1.5),E=s*n+(s-1)*k,D=n*(o/r)*2+T+m,V=t.forceOrient??mo(W,C),ee=O&&V==="portrait",H=ee?a*2+E:a*2+c+i+l*2+E,Z=ee?d+p+u+D+220:d+p+u+D,X=Math.min(W/H,C/Z),v=ya(W,C),_=X/Math.max(1e-6,v),M=$n(_,.55,1.25),z=$n(M*w,.55,2);e.style.setProperty("--uiScaleFit",String(M)),e.style.setProperty("--uiScale",String(z));const P=`${Math.round(W)}x${Math.round(C)}|${z.toFixed(4)}`;P!==b&&(b=P,window.dispatchEvent(new CustomEvent("deckrogue:layout")))},y=()=>{f||(f=requestAnimationFrame(x))};window.addEventListener("resize",y,{passive:!0}),window.visualViewport?.addEventListener("resize",y,{passive:!0}),window.visualViewport?.addEventListener("scroll",y,{passive:!0}),window.addEventListener("deckrogue:uiFit",y,{passive:!0}),x()}function Ta(){let e=!1,t=0,n="";const r=ho(),o=()=>{const{vw:a,vh:i}=fo(),l=r.forceOrient??mo(a,i),c=r.forceDevice??ir(a);!e&&a<1180&&(e=!0),e&&a>1220&&(e=!1);const d=document.body;d.classList.toggle("compact",e),d.classList.toggle("mobile",c),d.classList.toggle("desktop",!c),d.classList.toggle("portrait",l==="portrait"),d.classList.toggle("landscape",l==="landscape"),d.classList.toggle("square",l==="square");const p=[e?"c":"n",c?"m":"d",l,Math.round(a),Math.round(i)].join("|");p!==n&&(n=p,window.dispatchEvent(new CustomEvent("deckrogue:layout")))},s=()=>{t||(t=requestAnimationFrame(()=>{t=0,o()}))};window.addEventListener("resize",s,{passive:!0}),window.visualViewport?.addEventListener("resize",s,{passive:!0}),window.visualViewport?.addEventListener("scroll",s,{passive:!0}),o()}const va=(e,t)=>({op:"ifPlaced",side:e,then:t}),Yt=e=>va("back",e);function Ee(e,t){const n=e.cards[t],r=e.content.cardsById[n.defId],o=n.upgrade??0,s=r.upgrades?.[o-1];return s?{...r,...s}:r}function xe(e,t,n){const r=e.cardsById[t],o=Math.max(0,n|0);if(o<=0)return r;const s=r.upgrades?.[o-1];return s?{...r,...s}:r}function Ke(e,t){const r=e.cards[t].upgrade??0,o=Ee(e,t);return r>0?`${o.name} +${r}`:o.name}const xa=[{id:"field_ration",name:"ì•¼ì „ ì‹ëŸ‰",rarity:"BASIC",frontText:"ë°©ì–´ +3",backText:"S +2",front:[{op:"block",n:3}],back:[{op:"supplies",n:2}],upgrades:[{frontText:"ë°©ì–´ +5",front:[{op:"block",n:5}],backText:"S +3",back:[{op:"supplies",n:3}]}]},{id:"maintenance",name:"ì •ë¹„ ë„êµ¬",rarity:"BASIC",exhaustWhen:"BACK",frontText:"ë°©ì–´ +3",backText:"F -1, ì†Œëª¨",front:[{op:"block",n:3}],back:[{op:"fatigue",n:-1}],upgrades:[{frontText:"ë°©ì–´ +5",front:[{op:"block",n:5}],backText:"F -1, S +2, ì†Œëª¨",back:[{op:"fatigue",n:-1},{op:"supplies",n:2}]}]},{id:"scout",name:"ì •ì°°",rarity:"BASIC",frontText:"ì§€ì • í”¼í•´ 3, ë°©ì–´ +1",backText:"ë“œë¡œìš° 1, S +2",front:[{op:"damageEnemy",target:"select",n:3},{op:"block",n:1}],back:[{op:"draw",n:1},{op:"supplies",n:2}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 4, ë°©ì–´ +2",front:[{op:"damageEnemy",target:"select",n:4},{op:"block",n:2}],backText:"ë“œë¡œìš° 2, S +3",back:[{op:"draw",n:2},{op:"supplies",n:3}]}]},{id:"shield",name:"ë°©íŒ¨",rarity:"BASIC",frontText:"ë°©ì–´ +5",backText:"ë°©ì–´ +3",front:[{op:"block",n:5}],back:[{op:"block",n:3}],upgrades:[{frontText:"ë°©ì–´ +7",front:[{op:"block",n:7}],backText:"ë°©ì–´ +4",back:[{op:"block",n:4}]}]},{id:"power_arrow",name:"ê°•ë ¥í•œ í™”ì‚´",rarity:"BASIC",frontText:"ë¬´ì‘ìœ„ í”¼í•´ 10, S -2",backText:"ë¬´ì‘ìœ„ í”¼í•´ 7, S -2",front:[{op:"supplies",n:-2},{op:"damageEnemy",target:"random",n:10}],back:[{op:"supplies",n:-2},{op:"damageEnemy",target:"random",n:7}],upgrades:[{frontText:"ë¬´ì‘ìœ„ í”¼í•´ 13, S -2",front:[{op:"supplies",n:-2},{op:"damageEnemy",target:"random",n:13}],backText:"ë¬´ì‘ìœ„ í”¼í•´ 10, S -2",back:[{op:"supplies",n:-2},{op:"damageEnemy",target:"random",n:10}]}]},{id:"arrow",name:"í™”ì‚´",rarity:"BASIC",frontText:"ì§€ì • í”¼í•´ 5",backText:"ì§€ì • í”¼í•´ 5, S -1",front:[{op:"damageEnemy",target:"select",n:5}],back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:5}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 7",front:[{op:"damageEnemy",target:"select",n:7}],backText:"ì§€ì • í”¼í•´ 7, S -1",back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:7}]}]},{id:"goal_treasure",name:"ì €ì£¼ë°›ì€ ë³´ë¬¼",rarity:"MADNESS",exhaustWhen:"BOTH",frontText:"F +1, ì†Œëª¨",backText:"S -1, F +1, ì†Œëª¨",front:[{op:"fatigue",n:1}],back:[{op:"supplies",n:-1},{op:"fatigue",n:1}]},{id:"debt_paper",name:"ë¹š ë¬¸ì„œ",rarity:"BASIC",frontText:"ì•„ë¬´ ì¼ë„ ì¼ì–´ë‚˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",backText:"ì•„ë¬´ ì¼ë„ ì¼ì–´ë‚˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",front:[],back:[]},{id:"berserk",name:"ê´‘í­í™”",rarity:"COMMON",frontText:"ë¬´ì‘ìœ„ í”¼í•´ 15, S -3",backText:"S +4, F +1",front:[{op:"damageEnemy",target:"random",n:15},{op:"supplies",n:-3}],back:[{op:"supplies",n:4},{op:"fatigue",n:1}],upgrades:[{frontText:"ë¬´ì‘ìœ„ í”¼í•´ 20, S -4",front:[{op:"damageEnemy",target:"random",n:20},{op:"supplies",n:-4}],backText:"S +6, F +2",back:[{op:"supplies",n:6},{op:"fatigue",n:2}]}]},{id:"bandage",name:"ë¶•ëŒ€",rarity:"SPECIAL",exhaustWhen:"BOTH",frontText:"HP +4, ì†Œëª¨",backText:"HP +4, S -1, ì†Œëª¨",front:[{op:"heal",n:4}],back:[{op:"supplies",n:-1},{op:"heal",n:4}],upgrades:[{frontText:"HP +4, ì¶œí˜ˆ ì œê±°, ì†Œëª¨",front:[{op:"heal",n:4},{op:"clearStatusSelf",key:"bleed"}],backText:"HP +4, ì¶œí˜ˆ ì œê±°, S -1, ì†Œëª¨",back:[{op:"supplies",n:-1},{op:"heal",n:4},{op:"clearStatusSelf",key:"bleed"}]}]},{id:"arrow_rain",name:"í™”ì‚´ì˜ ë¹„",rarity:"COMMON",exhaustWhen:"BOTH",frontText:"ì „ì²´ í”¼í•´ 9, S -2 ì†Œëª¨",backText:"ë“œë¡œìš° 2, S +2, F +1, ì†Œëª¨",front:[{op:"damageEnemy",target:"all",n:9},{op:"supplies",n:-2}],back:[{op:"draw",n:2},{op:"supplies",n:2},{op:"fatigue",n:1}],upgrades:[{frontText:"ì „ì²´ í”¼í•´ 11, S -2, ì†Œëª¨",front:[{op:"damageEnemy",target:"all",n:11},{op:"supplies",n:-2}],backText:"ë“œë¡œìš° 3, S +3, F +2, ì†Œëª¨",back:[{op:"draw",n:3},{op:"supplies",n:3},{op:"fatigue",n:2}]}]},{id:"smoke",name:"ì—°ë§‰",rarity:"RARE",vanishWhen:"FRONT",frontText:"ì´ë²ˆ í„´ ì  ê³µê²© í”¼í•´ ë¬´íš¨, ì†Œì‹¤",backText:"F +1",front:[{op:"nullifyDamageThisTurn"}],back:[{op:"fatigue",n:1}]},{id:"redeploy",name:"ì¬ë°°ì¹˜",rarity:"RARE",frontText:"S +2",backText:"3ë²ˆ ìŠ¬ë¡¯ì— ìˆëŠ” í›„ì—´ ì¹´ë“œì˜ ì „ì—´ íš¨ê³¼ ë°œë™",front:[{op:"supplies",n:2}],back:[{op:"triggerFrontOfBackSlot",index:2}],upgrades:[{frontText:"S +3",front:[{op:"supplies",n:3}],backText:"3ë²ˆ ìŠ¬ë¡¯ì— ìˆëŠ” í›„ì—´ ì¹´ë“œì˜ ì „ì—´ íš¨ê³¼ ë°œë™, S +1",back:[{op:"triggerFrontOfBackSlot",index:2},{op:"supplies",n:1}]}]},{id:"secret_strike",name:"ë¹„ì¥ì˜ ì¼ê²©",rarity:"RARE",exhaustWhen:"BOTH",frontText:"ë¬´ì‘ìœ„ í”¼í•´ (Fì˜ 2ë°°), ì†Œëª¨",backText:"ì „ì²´ ì·¨ì•½ +3 ë° ì•½í™” +3, ì†Œëª¨",front:[{op:"damageEnemyByPlayerFatigue",target:"random",mult:2}],back:[{op:"statusEnemy",target:"all",key:"vuln",n:3},{op:"statusEnemy",target:"all",key:"weak",n:3}],upgrades:[{exhaustWhen:"BOTH",frontText:"ì§€ì • í”¼í•´ (Fì˜ 2ë°°), ì†Œëª¨",front:[{op:"damageEnemyByPlayerFatigue",target:"select",mult:2}],backText:"ì „ì²´ ì·¨ì•½ +4 ë° ì•½í™” +4, ì†Œëª¨",back:[{op:"statusEnemy",target:"all",key:"vuln",n:4},{op:"statusEnemy",target:"all",key:"weak",n:4}]}]},{id:"fire_scroll",name:"í™”ì—¼ ë‘ë£¨ë§ˆë¦¬",rarity:"RARE",exhaustWhen:"FRONT",vanishWhen:"BACK",frontText:"ì „ì²´ í”¼í•´ 8, ì†Œëª¨",backText:"ì „ì²´ í”¼í•´ 16, ì†Œì‹¤",front:[{op:"damageEnemy",target:"all",n:8}],back:[{op:"damageEnemy",target:"all",n:16}],upgrades:[{frontText:"ì „ì²´ í”¼í•´ 11, ì†Œëª¨",front:[{op:"damageEnemy",target:"all",n:11}],backText:"ì „ì²´ í”¼í•´ 20, ì†Œì‹¤",back:[{op:"damageEnemy",target:"all",n:20}]}]},{id:"caltrops",name:"ë§ˆë¦„ì‡ ",rarity:"SPECIAL",frontText:"ì „ì²´ ì¶œí˜ˆ 4 ë¶€ì—¬",backText:"ìì‹ ì„ ê³µê²©í•˜ë ¤ëŠ” ì ì—ê²Œ ì¶œí˜ˆ 3 ë¶€ì—¬",front:[{op:"statusEnemy",target:"all",key:"bleed",n:4}],back:[{op:"statusEnemiesAttackingThisTurn",key:"bleed",n:3}],upgrades:[{frontText:"ì „ì²´ ì¶œí˜ˆ 5 ë¶€ì—¬",backText:"ìì‹ ì„ ê³µê²©í•˜ë ¤ëŠ” ì ì—ê²Œ ì¶œí˜ˆ 4 ë¶€ì—¬",front:[{op:"statusEnemy",target:"all",key:"bleed",n:5}],back:[{op:"statusEnemiesAttackingThisTurn",key:"bleed",n:4}]}]},{id:"emergency_rations",name:"ë¹„ìƒì‹ëŸ‰",rarity:"RARE",vanishWhen:"BACK",frontText:"S +2",backText:"Së¥¼ 7ë¡œ ë§Œë“¦. ì†Œì‹¤",front:[{op:"supplies",n:2}],back:[{op:"setSupplies",n:7}],upgrades:[{frontText:"S +3",backText:"Së¥¼ 10ìœ¼ë¡œ ë§Œë“¦. ì†Œì‹¤",front:[{op:"supplies",n:3}],back:[{op:"setSupplies",n:10}]}]},{id:"painkiller",name:"ì§„í†µì œ",rarity:"SPECIAL",exhaustWhen:"FRONT",vanishWhen:"BACK",frontText:"HP -8, F -3, ì†Œëª¨",backText:"HP +8, F +1, ì†Œì‹¤",front:[{op:"hp",n:-8},{op:"fatigue",n:-3}],back:[{op:"hp",n:8},{op:"fatigue",n:1}],upgrades:[{frontText:"HP -6, F -3, ì†Œëª¨",backText:"HP +11, F +1, ì†Œì‹¤",front:[{op:"hp",n:-6},{op:"fatigue",n:-3}],back:[{op:"hp",n:11},{op:"fatigue",n:1}]}]},{id:"field_experience",name:"ì‹¤ì „ ê²½í—˜",rarity:"RARE",exhaustWhen:"BACK",frontText:"ì „ì²´ í”¼í•´ 3",backText:"ì´ ì¹´ë“œê°€ í›„ì—´ì— ìˆëŠ” í„´ì— ìŠ¹ë¦¬í•˜ë©´ ìµœëŒ€ ì²´ë ¥ +2, ì†Œëª¨",front:[{op:"damageEnemy",target:"all",n:3}],back:[],onWinWhileInBack:[{op:"maxHp",n:2}],upgrades:[{frontText:"ì „ì²´ í”¼í•´ 4",backText:"ì´ ì¹´ë“œê°€ í›„ì—´ì— ìˆëŠ” í„´ì— ìŠ¹ë¦¬í•˜ë©´ ìµœëŒ€ ì²´ë ¥ +3, ì†Œëª¨",front:[{op:"damageEnemy",target:"all",n:4}],back:[],onWinWhileInBack:[{op:"maxHp",n:3}]}]},{id:"camp_prep",name:"ì•¼ì˜ ì¤€ë¹„",rarity:"COMMON",frontText:"ë°©ì–´ +4, S +1",backText:"S +3",front:[{op:"block",n:4},{op:"supplies",n:1}],back:[{op:"supplies",n:3}],upgrades:[{frontText:"ë°©ì–´ +5, S +2",backText:"S +4",front:[{op:"block",n:5},{op:"supplies",n:2}],back:[{op:"supplies",n:4}]}]},{id:"vital_shot",name:"ê¸‰ì†Œ ì‚¬ê²©",rarity:"SPECIAL",frontText:"ì§€ì • í”¼í•´ 8",backText:"ì§€ì • í”¼í•´ 5, ì¶œí˜ˆ 2 ë¶€ì—¬, S -1",front:[{op:"damageEnemy",target:"select",n:8}],back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:5},{op:"statusEnemy",target:"select",key:"bleed",n:2}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 11",backText:"ì§€ì • í”¼í•´ 6, ì¶œí˜ˆ 3 ë¶€ì—¬, S -1",front:[{op:"damageEnemy",target:"select",n:11}],back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:6},{op:"statusEnemy",target:"select",key:"bleed",n:3}]}]},{id:"taunt",name:"ë…ì„¤",rarity:"SPECIAL",frontText:"ì§€ì • ì•½í™” +4",backText:"ì „ì²´ ì·¨ì•½ +2 ë° ì•½í™” +2",front:[{op:"statusEnemy",target:"select",key:"weak",n:4}],back:[{op:"statusEnemy",target:"all",key:"vuln",n:2},{op:"statusEnemy",target:"all",key:"weak",n:2}],upgrades:[{frontText:"ì§€ì • ì•½í™” +5",backText:"ì „ì²´ ì·¨ì•½ +2 ë° ì•½í™” +3",front:[{op:"statusEnemy",target:"select",key:"weak",n:5}],back:[{op:"statusEnemy",target:"all",key:"vuln",n:2},{op:"statusEnemy",target:"all",key:"weak",n:3}]}]},{id:"rapid_fire",name:"ì—°ì† ì‚¬ê²©",rarity:"COMMON",frontText:"ì§€ì • í”¼í•´ 2, 3ë²ˆ ë°œë™",backText:"ì´ë²ˆ í„´ì— ì¹´ë“œë¥¼ ë½‘ì•˜ìœ¼ë©´ ë¬´ì‘ìœ„ í”¼í•´ 8",front:[{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2}],back:[{op:"ifDrewThisTurn",then:[{op:"damageEnemy",target:"random",n:8}]}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 2, 4ë²ˆ ë°œë™",backText:"ì´ë²ˆ í„´ì— ì¹´ë“œë¥¼ ë½‘ì•˜ìœ¼ë©´ ë¬´ì‘ìœ„ í”¼í•´ 10",front:[{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2}],back:[{op:"ifDrewThisTurn",then:[{op:"damageEnemy",target:"random",n:10}]}]}]},{id:"blood_contract",name:"í”¼ì˜ ê³„ì•½",rarity:"COMMON",frontText:"ì§€ì • í”¼í•´ 15, HP -3",backText:"S +4, F +1",front:[{op:"damageEnemy",target:"select",n:15},{op:"hp",n:-3}],back:[{op:"supplies",n:4},{op:"fatigue",n:1}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 18, HP -3",backText:"S +5, F +1",front:[{op:"damageEnemy",target:"select",n:18},{op:"hp",n:-3}],back:[{op:"supplies",n:5},{op:"fatigue",n:1}]}]},{id:"cloth_scrap_armor",name:"ì²œ ì¡°ê° ê°‘ì˜·",rarity:"SPECIAL",frontText:"ë°©ì–´ +9, S -1",backText:"ë°©ì–´ +4",front:[{op:"supplies",n:-1},{op:"block",n:9}],back:[{op:"block",n:4}],upgrades:[{frontText:"ë°©ì–´ +11, S -1",backText:"ë°©ì–´ +5",front:[{op:"supplies",n:-1},{op:"block",n:11}],back:[{op:"block",n:5}]}]},{id:"prey_mark",name:"ì‚¬ëƒ¥ê° í‘œì‹œ",rarity:"SPECIAL",frontText:"ì§€ì • í”¼í•´ 10, HPê°€ í”Œë ˆì´ì–´ë³´ë‹¤ ë†’ìœ¼ë©´ í”¼í•´ 15",backText:"ì§€ì • ì·¨ì•½ +2",front:[{op:"damageEnemyFormula",target:"select",kind:"prey_mark"}],back:[{op:"statusEnemy",target:"select",key:"vuln",n:2}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 12, HPê°€ í”Œë ˆì´ì–´ë³´ë‹¤ ë†’ìœ¼ë©´ í”¼í•´ 18",front:[{op:"damageEnemyFormula",target:"select",kind:"prey_mark_u1"}],backText:"ì§€ì • ì·¨ì•½ +3",back:[{op:"statusEnemy",target:"select",key:"vuln",n:3}]}]},{id:"brawl_cleaver",name:"ë‚œì „ ì •ë¦¬",rarity:"COMMON",frontText:"ì§€ì • í”¼í•´ 10, ì ì´ 3ëª…ì´ë©´ ëŒ€ì‹  í”¼í•´ 16",backText:"ë°©ì–´ +5",front:[{op:"damageEnemyFormula",target:"select",kind:"triple_bounty"}],back:[{op:"block",n:5}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 10, ì ì´ 3ëª…ì´ë©´ ëŒ€ì‹  20",front:[{op:"damageEnemyFormula",target:"select",kind:"triple_bounty_u1"}],backText:"ë°©ì–´ +6",back:[{op:"block",n:6}]}]},{id:"hand_blade",name:"ì† ì•ˆì˜ ì¹¼ë‚ ",rarity:"RARE",frontText:"ì§€ì • í”¼í•´ 4, ì†íŒ¨ 1ì¥ë‹¹ í”¼í•´ +2",backText:"ì†íŒ¨ 1ì¥ë‹¹ ë°©ì–´ +1 (ìµœëŒ€ 6)",front:[{op:"damageEnemyFormula",target:"select",kind:"hand_blade"}],back:[{op:"blockFormula",kind:"hand_blade_back"}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 6, ì†íŒ¨ 1ì¥ë‹¹ í”¼í•´ +2",backText:"ì†íŒ¨ 1ì¥ë‹¹ ë°©ì–´ +2",front:[{op:"damageEnemyFormula",target:"select",kind:"hand_blade_u1"}],back:[{op:"blockFormula",kind:"hand_blade_back_u1"}]}]},{id:"gambler_glove",name:"ë„ë°•ì‚¬ì˜ ì¥ê°‘",rarity:"COMMON",tags:["INSTALL"],installWhen:"FRONT",frontText:"ì¹´ë“œë¥¼ ë½‘ì„ ë•Œë§ˆë‹¤ ë°©ì–´ +2 (ìµœëŒ€ 6) (ì„¤ì¹˜)",backText:"ì†íŒ¨ë¥¼ ëª¨ë‘ ë²„ë¦°ë‹¤. ë²„ë¦° ë§Œí¼ ë½‘ëŠ”ë‹¤.",front:[],back:[{op:"discardHandAllDraw"}],upgrades:[{frontText:"ì¹´ë“œë¥¼ ë½‘ì„ ë•Œë§ˆë‹¤ ë°©ì–´ +2 (ìµœëŒ€ 10) (ì„¤ì¹˜)",backText:"ì†íŒ¨ë¥¼ ëª¨ë‘ ë²„ë¦°ë‹¤. ë²„ë¦° ë§Œí¼ ë½‘ëŠ”ë‹¤. ë“œë¡œìš° 1",front:[],back:[{op:"discardHandAllDraw",extraDraw:1}]}]},{id:"lone_blow",name:"ê³ ë…í•œ ì¼ê²©",rarity:"SPECIAL",frontText:"ì´ë²ˆ í„´ ì´ ì¹´ë“œë§Œ ì‚¬ìš© ì‹œ, ì§€ì • í”¼í•´ 20",backText:"ì´ë²ˆ í„´ ì´ ì¹´ë“œë§Œ ì‚¬ìš© ì‹œ, ë°©ì–´ +10",front:[{op:"damageEnemyFormula",target:"select",kind:"lone_blow_20"}],back:[{op:"blockFormula",kind:"lone_blow_block_10"}],upgrades:[{frontText:"ì´ë²ˆ í„´ ì´ ì¹´ë“œë§Œ ì‚¬ìš© ì‹œ, ì§€ì • í”¼í•´ 26",backText:"ì´ë²ˆ í„´ ì´ ì¹´ë“œë§Œ ì‚¬ìš© ì‹œ, ë°©ì–´ +14",front:[{op:"damageEnemyFormula",target:"select",kind:"lone_blow_26"}],back:[{op:"blockFormula",kind:"lone_blow_block_14"}]}]},{id:"install_makeshift_wall",name:"ê°„ì´ ë°©ë²½",rarity:"RARE",tags:["INSTALL"],installWhen:"BOTH",frontText:"í„´ì´ ëë‚  ë•Œ ë°©ì–´ê°€ ì‚¬ë¼ì§€ì§€ ì•ŠìŒ (ì„¤ì¹˜)",backText:"S +1 (ì„¤ì¹˜)",front:[],back:[{op:"supplies",n:1}],upgrades:[{frontText:"í„´ì´ ëë‚  ë•Œ ë°©ì–´ê°€ ì‚¬ë¼ì§€ì§€ ì•ŠìŒ, ë°©ì–´ +2 (ì„¤ì¹˜)",backText:"S +1, ë°©ì–´ +2 (ì„¤ì¹˜)",front:[{op:"block",n:2}],back:[{op:"supplies",n:1},{op:"block",n:2}]}]},{id:"install_ballista",name:"ë°œë¦¬ìŠ¤íƒ€",rarity:"COMMON",tags:["INSTALL"],installWhen:"BOTH",frontText:"ì§€ì • í”¼í•´ 5 (ì„¤ì¹˜)",backText:"ë¬´ì‘ìœ„ í”¼í•´ 4 (ì„¤ì¹˜)",front:[{op:"damageEnemy",target:"select",n:5}],back:[{op:"damageEnemy",target:"random",n:4}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 7 (ì„¤ì¹˜)",backText:"ë¬´ì‘ìœ„ í”¼í•´ 5 (ì„¤ì¹˜)",front:[{op:"damageEnemy",target:"select",n:7}],back:[{op:"damageEnemy",target:"random",n:5}]}]},{id:"install_iron_bulwark",name:"ì² ê°‘ ë°©ë²½",rarity:"COMMON",tags:["INSTALL"],installWhen:"BOTH",frontText:"ë°©ì–´ +5 (ì„¤ì¹˜)",backText:"ë°©ì–´ +3 (ì„¤ì¹˜)",front:[{op:"block",n:5}],back:[{op:"block",n:3}],upgrades:[{frontText:"ë°©ì–´ +7 (ì„¤ì¹˜)",backText:"ë°©ì–´ +4 (ì„¤ì¹˜)",front:[{op:"block",n:7}],back:[{op:"block",n:4}]}]},{id:"install_cursed_banner",name:"ì €ì£¼ì˜ ê¹ƒë°œ",rarity:"SPECIAL",tags:["INSTALL"],installWhen:"BOTH",frontText:"ë¬´ì‘ìœ„ ì ì—ê²Œ ì·¨ì•½ +1 (ì„¤ì¹˜)",backText:"ë°©ì–´ +2 (ì„¤ì¹˜)",front:[{op:"statusEnemy",target:"random",key:"vuln",n:1}],back:[{op:"block",n:2}],upgrades:[{frontText:"ë¬´ì‘ìœ„ ì ì—ê²Œ ì·¨ì•½ +2 (ì„¤ì¹˜)",backText:"ë°©ì–´ +3 (ì„¤ì¹˜)",front:[{op:"statusEnemy",target:"random",key:"vuln",n:2}],back:[{op:"block",n:3}]}]},{id:"install_lead_observation",name:"ì„ ë‘ ê´€ì¸¡",rarity:"COMMON",tags:["INSTALL"],installWhen:"BOTH",frontText:"1ë²ˆ ì ì—ê²Œ ì£¼ëŠ” í”¼í•´ +2 (ì„¤ì¹˜)",backText:"3ë²ˆ ì ì—ê²Œ ì£¼ëŠ” í”¼í•´ +2 (ì„¤ì¹˜)",front:[],back:[],upgrades:[{frontText:"1ë²ˆ ì ì—ê²Œ ì£¼ëŠ” í”¼í•´ +2, ë°©ì–´ +2 (ì„¤ì¹˜)",backText:"3ë²ˆ ì ì—ê²Œ ì£¼ëŠ” í”¼í•´ +2, ë°©ì–´ +2 (ì„¤ì¹˜)",front:[{op:"block",n:2}],back:[{op:"block",n:2}]}]},{id:"innate_march_shield",name:"ê¸°ë™ ë°©íŒ¨",rarity:"COMMON",tags:["INNATE"],frontText:"ë°©ì–´ +7 (ì„ ì²œì„±)",backText:"ë°©ì–´ +4 (ì„ ì²œì„±)",front:[{op:"block",n:7}],back:[{op:"block",n:4}],upgrades:[{frontText:"ë°©ì–´ +9 (ì„ ì²œì„±)",backText:"ë°©ì–´ +6 (ì„ ì²œì„±)",front:[{op:"block",n:9}],back:[{op:"block",n:6}]}]},{id:"cut_second",name:"ì¤‘ì—´ ì ˆë‹¨",rarity:"RARE",exhaustWhen:"BOTH",frontText:"2ë²ˆ ì ì˜ í˜„ì¬ HPë¥¼ ì ˆë°˜ìœ¼ë¡œ, ì†Œëª¨",backText:"2ë²ˆ ì ì˜ í˜„ì¬ HPë¥¼ ì ˆë°˜ìœ¼ë¡œ, F +1, ì†Œëª¨",front:[{op:"halveEnemyHpAtIndex",index:1}],back:[{op:"fatigue",n:1},{op:"halveEnemyHpAtIndex",index:1}],upgrades:[{frontText:"2ë²ˆ ì ì˜ í˜„ì¬ HPë¥¼ ì ˆë°˜ìœ¼ë¡œ, S +2, ì†Œëª¨",backText:"2ë²ˆ ì ì˜ í˜„ì¬ HPë¥¼ ì ˆë°˜ìœ¼ë¡œ, ì†Œëª¨",front:[{op:"halveEnemyHpAtIndex",index:1},{op:"supplies",n:2}],back:[{op:"halveEnemyHpAtIndex",index:1}]}]},{id:"install_castle_ballista",name:"ì„±ê³½ ì‡ ë‡Œ",rarity:"COMMON",tags:["INSTALL"],installWhen:"BOTH",frontText:"ë¬´ì‘ìœ„ í”¼í•´ 1 + ì„¤ì¹˜í•œ í„´ ìˆ˜ (ì„¤ì¹˜)",backText:"ë°©ì–´ +2 (ì„¤ì¹˜)",front:[{op:"damageEnemyFormula",target:"random",kind:"castle_ballista_age"}],back:[{op:"block",n:2}],upgrades:[{frontText:"ë¬´ì‘ìœ„ í”¼í•´ 2 + ì„¤ì¹˜í•œ í„´ ìˆ˜ (ì„¤ì¹˜)",backText:"ë°©ì–´ +3 (ì„¤ì¹˜)",front:[{op:"damageEnemyFormula",target:"random",kind:"castle_ballista_age_u1"}],back:[{op:"block",n:3}]}]},{id:"token_moon_scroll",name:"ë‹¬ë¹› ë‘ë£¨ë§ˆë¦¬",rarity:"COMMON",tags:["TOKEN","EXHAUST"],frontText:"ì§€ì • ì ì—ê²Œ ì·¨ì•½ +1, ì†Œëª¨",backText:"ë°©ì–´ +2, ì†Œëª¨",front:[{op:"statusEnemy",target:"select",key:"vuln",n:1}],back:[{op:"block",n:2}]},{id:"scribe_hand",name:"í•„ê²½ì‚¬ì˜ ì†",rarity:"SPECIAL",frontText:"ë°©ì–´ +5",backText:"ë‹¬ë¹› ë‘ë£¨ë§ˆë¦¬ 2ì¥ ìƒì„±",front:[{op:"block",n:5}],back:[{op:"addCardToHand",defId:"token_moon_scroll",n:2}],upgrades:[{frontText:"ë°©ì–´ +7",backText:"ë‹¬ë¹› ë‘ë£¨ë§ˆë¦¬ 3ì¥ ìƒì„±",front:[{op:"block",n:7}],back:[{op:"addCardToHand",defId:"token_moon_scroll",n:3}]}]},{id:"install_scriptorium",name:"í”¼ ë¬»ì€ í•„ì‚¬ëŒ€",rarity:"RARE",tags:["INSTALL"],installWhen:"BOTH",frontText:"ë°©ì–´ +1 (ì„¤ì¹˜)",backText:"ë‹¬ë¹› ë‘ë£¨ë§ˆë¦¬ 1ì¥ ìƒì„±, S -1 (ì„¤ì¹˜)",front:[{op:"block",n:1}],back:[{op:"supplies",n:-1},{op:"addCardToHand",defId:"token_moon_scroll",n:1}],upgrades:[{frontText:"ë°©ì–´ +2 (ì„¤ì¹˜)",backText:"ë‹¬ë¹› ë‘ë£¨ë§ˆë¦¬ 2ì¥ ìƒì„±, S -1 (ì„¤ì¹˜)",front:[{op:"block",n:2}],back:[{op:"supplies",n:-1},{op:"addCardToHand",defId:"token_moon_scroll",n:2}]}]},{id:"fuel_kindling",name:"ë•”ê° ì‚¼ê¸°",rarity:"SPECIAL",frontText:"ì „ì—´ 1ë²ˆ ìŠ¬ë¡¯ ì¹´ë“œë¥¼ ì†Œëª¨, ì†Œëª¨í–ˆë‹¤ë©´ S +3",backText:"í›„ì—´ 3ë²ˆ ìŠ¬ë¡¯ ì¹´ë“œë¥¼ ì†Œëª¨, ì†Œëª¨í–ˆë‹¤ë©´ S +4",front:[{op:"exhaustSlot",side:"front",index:0,then:[{op:"supplies",n:3}]}],back:[{op:"exhaustSlot",side:"back",index:2,then:[{op:"supplies",n:4}]}],upgrades:[{frontText:"ì „ì—´ 1ë²ˆ ìŠ¬ë¡¯ ì¹´ë“œë¥¼ ì†Œëª¨, ì†Œëª¨í–ˆë‹¤ë©´ S +4",backText:"í›„ì—´ 3ë²ˆ ìŠ¬ë¡¯ ì¹´ë“œë¥¼ ì†Œëª¨, ì†Œëª¨í–ˆë‹¤ë©´ S +5",front:[{op:"exhaustSlot",side:"front",index:0,then:[{op:"supplies",n:4}]}],back:[{op:"exhaustSlot",side:"back",index:2,then:[{op:"supplies",n:5}]}]}]},{id:"impossible_plan",name:"ë¶ˆê°€ëŠ¥í•œ ê³„íš",rarity:"SPECIAL",frontText:"ì´ ì¹´ë“œê°€ í›„ì—´ì— ë°°ì¹˜ë˜ì–´ìˆë‹¤ë©´ ì „ì²´ í”¼í•´ 25",backText:"ì–´ë–»ê²Œ?",front:[Yt([{op:"damageEnemy",target:"all",n:25}])],back:[],upgrades:[{frontText:"ì´ ì¹´ë“œê°€ í›„ì—´ì— ë°°ì¹˜ë˜ì–´ìˆë‹¤ë©´ ì „ì²´ í”¼í•´ 30",backText:"ì–´ë–»ê²Œ?",front:[Yt([{op:"damageEnemy",target:"all",n:30}])],back:[]}]},{id:"slash_frenzy",name:"ì¹¼ë¶€ë¦¼",rarity:"SPECIAL",tags:["INSTALL"],installWhen:"BACK",frontText:"ë¬´ì‘ìœ„ í”¼í•´ 7, ğŸ—¡ï¸ ì¹¼ë¶€ë¦¼ë§Œí¼ ì¶”ê°€ ë°˜ë³µ, ğŸ—¡ï¸ ì¹¼ë¶€ë¦¼ì„ 0ìœ¼ë¡œ",backText:"[ì„¤ì¹˜] S -1, ğŸ—¡ï¸ ì¹¼ë¶€ë¦¼ +1",front:[{op:"damageEnemyRepeatByStatus",target:"random",n:7,key:"slash",reset:!0}],back:[{op:"supplies",n:-1},{op:"statusPlayer",key:"slash",n:1}],upgrades:[{frontText:"ë¬´ì‘ìœ„ í”¼í•´ 8, ğŸ—¡ï¸ ì¹¼ë¶€ë¦¼ë§Œí¼ ì¶”ê°€ ë°˜ë³µ, ğŸ—¡ï¸ ì¹¼ë¶€ë¦¼ì„ 0ìœ¼ë¡œ",front:[{op:"damageEnemyRepeatByStatus",target:"random",n:8,key:"slash",reset:!0}]}]},{id:"install_wedge_spike",name:"ìê¸° ë°•ê¸°",rarity:"COMMON",tags:["LOCKED"],frontText:"ì´ë²ˆ í„´ì— ì„¤ì¹˜ ì‹œ, ì²´ë ¥ì´ ê°€ì¥ ë‚®ì€ ì  í”¼í•´ 20 (ë¶€ë™) (ì„¤ì¹˜)",backText:"ì´ë²ˆ í„´ì— ì„¤ì¹˜ ì‹œ, ì²´ë ¥ì´ ê°€ì¥ ë‚®ì€ ì  í”¼í•´ 20 (ë¶€ë™) (ì„¤ì¹˜)",front:[{op:"ifPlacedThisTurn",then:[{op:"damageEnemyLowestHp",n:20}]}],back:[{op:"ifPlacedThisTurn",then:[{op:"damageEnemyLowestHp",n:20}]}],upgrades:[{frontText:"ì´ë²ˆ í„´ì— ì„¤ì¹˜ ì‹œ, ì²´ë ¥ì´ ê°€ì¥ ë‚®ì€ ì  í”¼í•´ 25 (ë¶€ë™) (ì„¤ì¹˜)",backText:"ì´ë²ˆ í„´ì— ì„¤ì¹˜ ì‹œ, ì²´ë ¥ì´ ê°€ì¥ ë‚®ì€ ì  í”¼í•´ 25 (ë¶€ë™) (ì„¤ì¹˜)",front:[{op:"ifPlacedThisTurn",then:[{op:"damageEnemyLowestHp",n:25}]}],back:[{op:"ifPlacedThisTurn",then:[{op:"damageEnemyLowestHp",n:25}]}]}]},{id:"coin_toss",name:"ë™ì „ ë˜ì§€ê¸°",rarity:"RARE",frontText:"í›„ì—´ì´ë©´ ì „ì²´ í”¼í•´ 20, ì´ ì¹´ë“œë¥¼ ë’¤ì§‘ìŒ",backText:"ì´ ì¹´ë“œë¥¼ ë’¤ì§‘ìŒ",front:[Yt([{op:"damageEnemy",target:"all",n:20}]),{op:"flipSelf"}],back:[{op:"flipSelf"}],upgrades:[{frontText:"í›„ì—´ì´ë©´ ì „ì²´ í”¼í•´ 25, ì´ ì¹´ë“œë¥¼ ë’¤ì§‘ìŒ",backText:"ì´ ì¹´ë“œë¥¼ ë’¤ì§‘ìŒ",front:[Yt([{op:"damageEnemy",target:"all",n:25}]),{op:"flipSelf"}],back:[{op:"flipSelf"}]}]},{id:"doppelganger",name:"ë„í”Œê°±ì–´",rarity:"SPECIAL",frontText:"ì „ì—´ íš¨ê³¼: í›„ì—´ì— ë„í”Œê°±ì–´ê°€ ìˆìœ¼ë©´ ë¬´ì‘ìœ„ í”¼í•´ 4, 4ë²ˆ",backText:"í›„ì—´ íš¨ê³¼: ì „ì—´ì— ë„í”Œê°±ì–´ê°€ ìˆìœ¼ë©´ ë“œë¡œìš° 4, S +4",front:[{op:"ifOtherRowHasDefId",defId:"doppelganger",then:[{op:"repeat",times:4,effects:[{op:"damageEnemy",target:"random",n:4}]}]}],back:[{op:"ifOtherRowHasDefId",defId:"doppelganger",then:[{op:"supplies",n:4},{op:"draw",n:4}]}],upgrades:[{frontText:"ì „ì—´ íš¨ê³¼: í›„ì—´ì— ë„í”Œê°±ì–´ê°€ ìˆìœ¼ë©´ ë¬´ì‘ìœ„ í”¼í•´ 5, 5ë²ˆ",backText:"í›„ì—´ íš¨ê³¼: ì „ì—´ì— ë„í”Œê°±ì–´ê°€ ìˆìœ¼ë©´ ë“œë¡œìš° 5, S +5",front:[{op:"ifOtherRowHasDefId",defId:"doppelganger",then:[{op:"repeat",times:5,effects:[{op:"damageEnemy",target:"random",n:5}]}]}],back:[{op:"ifOtherRowHasDefId",defId:"doppelganger",then:[{op:"supplies",n:5},{op:"draw",n:5}]}]}]},{id:"unforgettable_memory",name:"ìŠì„ ìˆ˜ ì—†ëŠ” ê¸°ì–µ",rarity:"RARE",frontText:"ë¬´ì‘ìœ„ ì†Œì‹¤ëœ ì¹´ë“œì˜ ì „ì—´ íš¨ê³¼ ë°œë™, ë‘ ë²ˆ ë°˜ë³µ",backText:"ë¬´ì‘ìœ„ ì†Œì‹¤ëœ ì¹´ë“œì˜ í›„ì—´ íš¨ê³¼ ë°œë™, ë‘ ë²ˆ ë°˜ë³µ",front:[{op:"triggerRandomVanished",side:"front",times:2}],back:[{op:"triggerRandomVanished",side:"back",times:2}],upgrades:[{frontText:"ë¬´ì‘ìœ„ ì†Œì‹¤ëœ ì¹´ë“œì˜ ì „ì—´ íš¨ê³¼ ë°œë™, ì„¸ ë²ˆ ë°˜ë³µ",backText:"ë¬´ì‘ìœ„ ì†Œì‹¤ëœ ì¹´ë“œì˜ í›„ì—´ íš¨ê³¼ ë°œë™, ì„¸ ë²ˆ ë°˜ë³µ",front:[{op:"triggerRandomVanished",side:"front",times:3}],back:[{op:"triggerRandomVanished",side:"back",times:3}]}]},{id:"mad_echo",name:"ë©”ì•„ë¦¬",rarity:"MADNESS",frontText:"ë¬´ì‘ìœ„ í”¼í•´ (Fì˜ ì ˆë°˜ (ë²„ë¦¼))",backText:"ë“œë¡œìš° 1, S +2, F +1",front:[{op:"damageEnemyByPlayerFatigue",target:"random",mult:.5}],back:[{op:"draw",n:1},{op:"supplies",n:2},{op:"fatigue",n:1}],upgrades:[{frontText:"ë¬´ì‘ìœ„ í”¼í•´ (F)",front:[{op:"damageEnemyByPlayerFatigue",target:"random",mult:1}],backText:"ë“œë¡œìš° 2, S +2, F +1",back:[{op:"draw",n:2},{op:"supplies",n:2},{op:"fatigue",n:1}]}]},{id:"mad_insight",name:"ê¸ˆë‹¨ì˜ í†µì°°",rarity:"MADNESS",exhaustWhen:"BOTH",frontText:"ë°©ì–´ +8, ë“œë¡œìš° 1, F +1, ì†Œëª¨",backText:"ë“œë¡œìš° 3, S +2, F +2, ì†Œëª¨",front:[{op:"block",n:8},{op:"draw",n:1},{op:"fatigue",n:1}],back:[{op:"draw",n:3},{op:"supplies",n:2},{op:"fatigue",n:2}],upgrades:[{frontText:"ë°©ì–´ +10, ë“œë¡œìš° 2, F +1, ì†Œëª¨",front:[{op:"block",n:10},{op:"draw",n:2},{op:"fatigue",n:1}],backText:"ë“œë¡œìš° 4, S +3, F +2, ì†Œëª¨",back:[{op:"draw",n:4},{op:"supplies",n:3},{op:"fatigue",n:2}]}]},{id:"mad_bargain",name:"ê±°ë˜ì˜ ì”ì¬",rarity:"MADNESS",exhaustWhen:"BOTH",frontText:"ì§€ì • í”¼í•´ 16, S -1, F +1, ì†Œëª¨",backText:"HP +6, F +2, ì†Œëª¨",front:[{op:"damageEnemy",target:"select",n:16},{op:"supplies",n:-1},{op:"fatigue",n:1}],back:[{op:"heal",n:6},{op:"fatigue",n:2}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 22, S -1, F +2, ì†Œëª¨",front:[{op:"damageEnemy",target:"select",n:22},{op:"supplies",n:-1},{op:"fatigue",n:2}],backText:"HP +9, F +2, ì†Œëª¨",back:[{op:"heal",n:9},{op:"fatigue",n:2}]}]},{id:"mad_no_impossible",name:"ë¶ˆê°€ëŠ¥ì€ ì—†ë‹¤",rarity:"MADNESS",frontText:"ë‚´ ë±ì˜ ëª¨ë“  ì¹´ë“œë¥¼ ë’¤ì§‘ìŒ, ì „íˆ¬ê°€ ëë‚  ë•Œ ì›ë˜ëŒ€ë¡œ ëŒì•„ì˜´, S -5",backText:"ì†Œì‹¤ ì¹´ë“œ í•œ ì¥ì„ ì„ íƒí•˜ì—¬ ê°€ì ¸ì˜´, ì†Œì‹¤",tags:["VANISH"],vanishWhen:"BACK",front:[{op:"flipAllPlayerCardsUntilCombatEnd"},{op:"supplies",n:-5}],back:[{op:"pickVanishedToHand"}]},{id:"mad_bed_of_thorns",name:"ê°€ì‹œë°©ì„",rarity:"MADNESS",tags:["INSTALL"],installWhen:"BOTH",frontText:"ìì‹ ì„ ê³µê²©í•˜ë ¤ëŠ” ì ì—ê²Œ ì¶œí˜ˆ 5 ë¶€ì—¬ (ì„¤ì¹˜)",backText:"í”Œë ˆì´ì–´ ë° ì „ì²´ ì·¨ì•½ 1 ë¶€ì—¬ (ì„¤ì¹˜)",front:[{op:"statusEnemiesAttackingThisTurn",key:"bleed",n:5}],back:[{op:"statusPlayer",key:"vuln",n:1},{op:"statusEnemy",target:"all",key:"vuln",n:1}],upgrades:[{frontText:"ìì‹ ì„ ê³µê²©í•˜ë ¤ëŠ” ì ì—ê²Œ ì¶œí˜ˆ 6 ë¶€ì—¬ (ì„¤ì¹˜)",backText:"í”Œë ˆì´ì–´ ë° ì „ì²´ ì·¨ì•½ 2 ë¶€ì—¬ (ì„¤ì¹˜)",front:[{op:"statusEnemiesAttackingThisTurn",key:"bleed",n:6}],back:[{op:"statusPlayer",key:"vuln",n:2},{op:"statusEnemy",target:"all",key:"vuln",n:2}]}]}],bo=Object.fromEntries(xa.map(e=>[e.id,e])),Ca=[{id:"other_adventurer",name:"ë³´ë¬¼ì„ ë…¸ë¦¬ëŠ” ë‹¤ë¥¸ ëª¨í—˜ê°€",maxHp:60,intents:[{label:"ì°½ ì°Œë¥´ê¸°: 5 í”¼í•´, 3ë²ˆ ë°œë™",acts:[{op:"damagePlayer",n:5},{op:"damagePlayer",n:5},{op:"damagePlayer",n:5}]},{label:"ë…ì•½ ë¿Œë¦¬ê¸°: ì¶œí˜ˆ +4, ì·¨ì•½ +4, ì•½í™” +4 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"bleed",n:4},{op:"statusPlayer",key:"vuln",n:4},{op:"statusPlayer",key:"weak",n:4}]}]},{id:"goblin_raider",name:"ê³ ë¸”ë¦° ì•½íƒˆì",maxHp:15,intents:[{label:"ê¸°ìŠµ: 12 - ì´ë²ˆ í„´ì— ì‚¬ìš©í•œ ì¹´ë“œì˜ ìˆ˜ë§Œí¼ í”¼í•´",acts:[{op:"damagePlayerFormula",kind:"goblin_raider"}]},{label:"í›”ì¹˜ê¸°: ì¶œí˜ˆ +2 ë¶€ì—¬, S -3",acts:[{op:"supplies",n:-3},{op:"statusPlayer",key:"bleed",n:2}]}]},{id:"watching_statue",name:"ê°ì‹œí•˜ëŠ” ì„ìƒ",maxHp:25,passives:[{id:"ramp_atk_1",icon:"ğŸ‘ï¸",name:"ê°ì‹œì˜ ì¶•ì ",text:"ë§¤ í„´ ê³µê²©ë ¥ì´ +1 ì¦ê°€í•©ë‹ˆë‹¤."}],intents:[{label:"ê°ì‹œ: 4 + ì´ë²ˆ í„´ì— ì‚¬ìš©í•œ ì¹´ë“œì˜ ìˆ˜ë§Œí¼ í”¼í•´",acts:[{op:"damagePlayerFormula",kind:"watching_statue"}]}]},{id:"pebble_golem",name:"ì¡°ì•½ëŒ ê³¨ë ˜",maxHp:30,passives:[{id:"ramp_atk_1",icon:"ğŸª¨",name:"ëŒì˜ ê²½í™”",text:"ë§¤ í„´ ê³µê²©ë ¥ì´ +1 ì¦ê°€í•©ë‹ˆë‹¤."}],intents:[{label:"ì¡°ì•½ëŒ ë˜ì§€ê¸°: 8 í”¼í•´",acts:[{op:"damagePlayer",n:8}]},{label:"ëª¨ë˜ ëª¨ìœ¼ê¸°: ìì‹  HP 6 íšŒë³µ",acts:[{op:"enemyHealSelf",n:6}]}]},{id:"rock_golem",name:"ë°”ìœ„ ê³¨ë ˜",maxHp:50,passives:[{id:"ramp_atk_2",icon:"â›°ï¸",name:"ê±°ëŒ€í™”",text:"ë§¤ í„´ ê³µê²©ë ¥ì´ +2 ì¦ê°€í•©ë‹ˆë‹¤."}],intents:[{label:"ë°”ìœ„ ë˜ì§€ê¸°: 10 í”¼í•´",acts:[{op:"damagePlayer",n:10}]},{label:"ë•… ëª¨ìœ¼ê¸°: ìì‹  HP 8 íšŒë³µ",acts:[{op:"enemyHealSelf",n:8}]}]},{id:"slime",name:"ìŠ¬ë¼ì„",maxHp:30,intents:[{label:"ì‚°ì„±ì•¡: ì¶œí˜ˆ +3 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"bleed",n:3}]},{label:"ì ì•¡: ì•½í™” +3 ë¶€ì—¬ í›„ ìì‹  HP 3 íšŒë³µ",acts:[{op:"statusPlayer",key:"weak",n:3},{op:"enemyHealSelf",n:3}]},{label:"ë•Œë¦¬ê¸°: 6 í”¼í•´",acts:[{op:"damagePlayer",n:6}]}]},{id:"poison_spider",name:"ë…ê±°ë¯¸",maxHp:28,intents:[{label:"ë…ë‹ˆë¡œ ë¬¼ê¸°: ì¶œí˜ˆ +4 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"bleed",n:4}]},{label:"ì†¡ê³³ë‹ˆë¡œ ë¬¼ê¸°: 7 í”¼í•´",acts:[{op:"damagePlayer",n:7}]},{label:"ë‹¨ë²ˆì— ë¬¼ê¸°: ì¶œí˜ˆ +2 ë¶€ì—¬, 6 í”¼í•´",acts:[{op:"statusPlayer",key:"bleed",n:2},{op:"damagePlayer",n:6}]}]},{id:"gravity_echo",name:"ì¤‘ë ¥ì˜ ì”í–¥",maxHp:35,intents:[{label:"í•˜ì¤‘ ì¸ì¥",acts:[{op:"damagePlayerByDeckSize",base:5,per:2,div:6,cap:18}]},{label:"ì••ì¶•: 7 í”¼í•´",acts:[{op:"damagePlayer",n:7}]},{label:"ë†“ì¹˜ê²Œ ë§Œë“¤ê¸°: S -3",acts:[{op:"supplies",n:-3}]}]},{id:"rat_swarm",name:"ì¥ë–¼",maxHp:20,intents:[{label:"ëœ¯ê¸°: 4 í”¼í•´, 2ë²ˆ ë°œë™",acts:[{op:"damagePlayer",n:4},{op:"damagePlayer",n:4}]},{label:"ê¸°ìŠµí•˜ê¸°: ì·¨ì•½ +2 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"vuln",n:2}]},{label:"ê´‘ë€: 2 í”¼í•´ (íƒ€ìˆ˜ê°€ ì¦ê°€í•©ë‹ˆë‹¤!) ",acts:[{op:"damagePlayerRampHits",n:2,baseHits:1,everyTurns:1,capHits:6}]}]},{id:"goblin_commander",name:"ê³ ë¸”ë¦° ì§€íœ˜ê´€",maxHp:30,intents:[{label:"í˜¸ë ¹: ì·¨ì•½ +2 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"vuln",n:2}]},{label:"ë°œë¡œ ì°¨ê¸°: 7 í”¼í•´",acts:[{op:"damagePlayer",n:7}]},{label:"ì „ìˆ  ì§€ì‹œ: ì•½í™” +2 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"weak",n:2}]}]},{id:"goblin_archer",name:"ê³ ë¸”ë¦° ê¶ìˆ˜",maxHp:15,intents:[{label:"ì¡°ì¤€: 2 í”¼í•´, 3ë²ˆ",acts:[{op:"damagePlayer",n:2},{op:"damagePlayer",n:2},{op:"damagePlayer",n:2}]},{label:"ì—°ì‚¬: 1 í”¼í•´ (íƒ€ìˆ˜ê°€ ì¦ê°€í•©ë‹ˆë‹¤!)",acts:[{op:"damagePlayerRampHits",n:1,baseHits:1,everyTurns:1,capHits:10}]}]},{id:"goblin_assassin",name:"ê³ ë¸”ë¦° ì•”ì‚´ì",maxHp:22,passives:[{id:"shadow_veil",icon:"ğŸ‘¥",name:"ê·¸ë¦¼ì ì¥ë§‰",text:"ì™¼ìª½ì— ì ì´ ìˆì„ ë•Œ, ê³µê²©(ëŒ€ìƒ ì§€ì •)ìœ¼ë¡œ ë•Œë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."}],intents:[{label:"ì¡°ì¤€: ì•”ì‚´ ìˆ˜ì¹˜ +1",acts:[{op:"enemySetAssassinAim",n:1}]},{label:"ì•”ì‚´: 8 + ì•”ì‚´ ìˆ˜ì¹˜Ã—2 í”¼í•´",acts:[{op:"damagePlayerFormula",kind:"goblin_assassin"}]},{label:"ì¬ì •ë¹„: ìì‹  HP 5 íšŒë³µ",acts:[{op:"enemyHealSelf",n:5}]}]},{id:"old_monster_corpse",name:"ì˜¤ë˜ëœ ê´´ë¬¼ ì‚¬ì²´",maxHp:30,passives:[{id:"rotten_rage",icon:"â˜ ï¸",name:"ì©ì€ ë¶„ë…¸",text:"ë‹¤ë¥¸ ì ì´ ì£½ì„ ë•Œë§ˆë‹¤ ë¶„ë…¸ +1 (ë¶„ë…¸ë‹¹ ê³µê²© +4)."}],intents:[{label:"íˆ¬ì²™: 9 + ë¶„ë…¸Ã—4 í”¼í•´",acts:[{op:"damagePlayerFormula",kind:"old_monster_corpse"}]},{label:"ì§ˆì²™ì„: ìì‹  HP 6 íšŒë³µ",acts:[{op:"enemyHealSelf",n:6}]}]},{id:"punishing_one",name:"ì§•ë²Œí•˜ëŠ” ì",maxHp:60,passives:[{id:"punish_hand",icon:"âš–ï¸",name:"ì§•ë²Œ",text:"í”Œë ˆì´ì–´ ì†íŒ¨ 1ì¥ë‹¹ ê³µê²© í”¼í•´ +2."}],intents:[{label:"ì‹¬íŒ: 6 + ì†íŒ¨Ã—2 í”¼í•´",acts:[{op:"damagePlayerFormula",kind:"punishing_one"}]},{label:"ì¶”ê¶: ì•½í™” +2 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"weak",n:2}]}]},{id:"gloved_hunter",name:"ì¥ê°‘ ë‚€ ì‚¬ëƒ¥ê¾¼",maxHp:52,intents:[{label:"ê°€ëŠ : ì·¨ì•½ +3 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"vuln",n:3}]},{label:"ì‚¬ëƒ¥: 6 í”¼í•´, ë°©ì–´ê°€ 4 ì´ìƒì´ë©´ ëŒ€ì‹  12 í”¼í•´",acts:[{op:"damagePlayerFormula",kind:"gloved_hunter"}]},{label:"ì‚¬ì‚´: 9 í”¼í•´",acts:[{op:"damagePlayer",n:9}]}]},{id:"debt_collector",name:"ì¥ë¶€ ìˆ˜ê¸ˆê´€",maxHp:55,intents:[{label:"ìˆ˜ê¸ˆ: S -3",acts:[{op:"supplies",n:-4}]},{label:"ì••ë¥˜: (Sê°€ 0ì´ë©´) 15 í”¼í•´",acts:[{op:"damagePlayerIfSuppliesZero",n:15}]},{label:"ì¬ì ê²€: ì•„ë¬´ í–‰ë™ë„ í•˜ì§€ ì•ŠìŒ",acts:[]}]},{id:"supply_hound",name:"ë³´ê¸‰ ì‚¬ëƒ¥ê°œ",maxHp:26,intents:[{label:"ëƒ„ìƒˆ ë§¡ê¸°: ì·¨ì•½ +2 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"vuln",n:2}]},{label:"ë®ì¹˜ê¸°: (Sê°€ 0ì´ ì•„ë‹ˆë©´) 7 í”¼í•´",acts:[{op:"damagePlayerIfSuppliesPositive",n:7}]},{label:"ëœ¯ì–´ë‚´ê¸°: S -2",acts:[{op:"supplies",n:-2}]}]},{id:"archive_censor",name:"ì„œê³ ì˜ ê²€ì—´ê´€",maxHp:34,intents:[{label:"ê²€ì—´ ì£¼ë¬¸: êµë€ +2 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"disrupt",n:2}]},{label:"ì••ìˆ˜: S -2",acts:[{op:"supplies",n:-2}]},{label:"ê¹ƒíœ ì°Œë¥´ê¸°: 7 í”¼í•´, ì•½í™” +2 ë¶€ì—¬",acts:[{op:"damagePlayer",n:7},{op:"statusPlayer",key:"weak",n:2}]}]},{id:"boss_gravity_master",name:"ì¤‘ë ¥ í†µë‹¬ì",omen:"ëª¸ì´ ì ì  ë¬´ê²ë‹¤. ì§ì„ ë¹„ì›Œë¼.",maxHp:90,intents:[{label:"ì¤‘ë ¥ ìˆ˜ì¶•: ì•½í™” +3 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"weak",n:3}]},{label:"íŠ¹ì´ì  ìƒì„±",acts:[{op:"damagePlayerByDeckSize",base:8,per:3,div:5,cap:30}]},{label:"ì²œì¥ ë¶•ê´´: 11 í”¼í•´",acts:[{op:"damagePlayer",n:11}]}]},{id:"boss_cursed_wall",name:"ì €ì£¼ë°›ì€ ë²½",omen:"ì›€ì§ì´ì§€ ì•ŠëŠ”ë‹¤. ë‹³ì•„ê°„ë‹¤.",maxHp:160,intents:[{label:"ì €ì£¼ì˜ ê¸°ìš´: ì¶œí˜ˆ +3 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"bleed",n:3}]},{label:"ì €ì£¼ì˜ ê¸°ìš´: F +1",acts:[{op:"fatiguePlayer",n:1}]},{label:"ì•„ë¬´ í–‰ë™ë„ í•˜ì§€ ì•ŠìŒ",acts:[]}]},{id:"boss_giant_orc",name:"ê±°ëŒ€í•œ ì˜¤í¬",omen:"ê±°ëŒ€í•œ ì§ìŠ¹ì´ ê¸°ë‹¤ë¦°ë‹¤. í˜ì„ ê¹ì•„ì•¼ í•œë‹¤.",maxHp:90,intents:[{label:"ë‚´ë ¤ì¹˜ê¸°: ì·¨ì•½ +2 ë¶€ì—¬, 10 í”¼í•´",acts:[{op:"statusPlayer",key:"vuln",n:2},{op:"damagePlayer",n:15}]},{label:"ë‹¨ë‹¨í•œ í”¼ë¶€: ë‹¤ìŒ í„´ ë™ì•ˆ í”¼í•´ë¥¼ ì…ì§€ ì•ŠìŒ",acts:[{op:"enemyImmuneNextTurn"}]},{label:"íƒ€ê³ ë‚œ íšŒë³µ: ìì‹  HP 15 íšŒë³µ",acts:[{op:"enemyHealSelf",n:15}]},{label:"ê´‘ë¶„: 4 í”¼í•´ (íƒ€ìˆ˜ê°€ ì¦ê°€í•©ë‹ˆë‹¤!)",acts:[{op:"damagePlayerRampHits",n:4,baseHits:1,everyTurns:1,capHits:6}],meta:{cat:"ATTACK"}}]},{id:"boss_soul_stealer",name:"ì˜í˜¼ ê°•íƒˆì",omen:"í–‰ë™í•˜ì§€ ì•Šìœ¼ë©´ ì¢…ë§ì´ ì˜¨ë‹¤.",maxHp:80,intents:[{label:"í—ˆê¸°: 7 í”¼í•´, S -3",acts:[{op:"damagePlayer",n:7},{op:"supplies",n:-3}]},{label:"ë‚˜íƒœ: 7 í”¼í•´, F +2",acts:[{op:"damagePlayer",n:7},{op:"fatiguePlayer",n:2}]},{label:"ì˜ˆì–¸: ì¹´ìš´íŠ¸ ì§„í–‰",acts:[]}]}],ga=Object.fromEntries(Ca.map(e=>[e.id,e])),It=[{id:"item_balm",name:"ì•½ì´ˆ ì—°ê³ ",text:"HPë¥¼ 8 íšŒë³µí•©ë‹ˆë‹¤. (ì†Œëª¨)",art:"assets/items/item_balm.png",effects:[{op:"heal",n:8}],priceGold:16,consumable:!0},{id:"item_talisman",name:"ë‹¨ë‹¨í•œ ë¶€ì ",text:"ë°©ì–´(ë¸”ë¡) 10ì„ ì–»ìŠµë‹ˆë‹¤. (ì†Œëª¨)",art:"assets/items/item_talisman.png",effects:[{op:"block",n:10}],priceGold:18,consumable:!0},{id:"item_dust",name:"ì €ì£¼ ê°€ë£¨",text:"ëª¨ë“  ì ì—ê²Œ ì·¨ì•½ 2ë¥¼ ë¶€ì—¬í•©ë‹ˆë‹¤. (ì†Œëª¨)",art:"assets/items/item_dust.png",effects:[{op:"statusEnemy",target:"all",key:"vuln",n:2}],priceGold:22,consumable:!0},{id:"item_moon_scroll",name:"ë‹¬ë¹› ë‘ë£¨ë§ˆë¦¬",text:"ë‹¬ë¹› ë‘ë£¨ë§ˆë¦¬ 1ì¥ì„ ì†íŒ¨ì— ì¶”ê°€í•©ë‹ˆë‹¤. (ì†Œëª¨)",art:"assets/items/item_moon_scroll.png",effects:[{op:"addCardToHand",defId:"token_moon_scroll",n:1}],priceGold:18,consumable:!0},{id:"item_triple_swap",name:"êµí™˜ê¶Œ",text:"ì†íŒ¨ì—ì„œ ë¬´ì‘ìœ„ 3ì¥ì„ ë²„ë¦¬ê³ , 3ì¥ì„ ë½‘ìŠµë‹ˆë‹¤. (ì†Œëª¨)",art:"assets/items/item_triple_swap.png",effects:[{op:"discardHandRandom",n:3},{op:"draw",n:3}],priceGold:20,consumable:!0}],yo=Object.fromEntries(It.map(e=>[e.id,e]));function He(e){return yo[e]??null}function wa(){return It.length===0?null:It[Math.floor(Math.random()*It.length)]?.id??null}function Y(e,t,n,r=1600){const o=e;o.uiToasts||(o.uiToasts=[]);const s=o.uiToasts;s.push({kind:t,text:n,ms:r}),s.length>30&&(o.uiToasts=s.slice(-30))}function Se(e,t,n,r,o="SYSTEM"){let s=n;if(r&&o==="PLAYER"&&t==="bleed"){const a=Number(r._bleedBonusPerApply??0);a&&(s+=a)}if(r&&t==="vuln"&&s>0&&e===r.player){const a=r.run;(a?.relics??[]).includes("relic_ratskin_charm")&&a?.relicRuntime?.relic_ratskin_charm?.active!==!1&&(s=Math.max(0,s-1))}e.status[t]=Math.max(0,(e.status[t]??0)+s)}function lr(e,t=0){return e<t?t:e}function cr(e){const t=[...e];for(let n=t.length-1;n>0;n--){const r=Math.floor(Math.random()*(n+1));[t[n],t[r]]=[t[r],t[n]]}return t}function fe(e,t="pickOne"){if(e.length===0)throw new Error(`${t}: empty array`);return e[Math.floor(Math.random()*e.length)]}function h(e,t){e.log.unshift(t),e.log=e.log.slice(0,250)}function ie(e){return e.enemies.filter(t=>t.hp>0)}function Ea(e){return Math.max(0,Math.min(1,e))}function ko(e,t=0){const n=e.player?.fatigue??0,r=Ea(t+Math.max(0,n-5)*.12),o=n<=5?0:n<=8?1:n<=11?2:3;return{f:n,p:r,tier:o}}function _a(){return Object.keys(ke).sort((e,t)=>e.localeCompare(t))}const Sa=[{id:"relic_ratskin_charm",name:"ì¥ê°€ì£½ ë¶€ì ",text:"ì·¨ì•½ì„ ë°›ì„ ë•Œ 1 ëœ ë°›ìŠµë‹ˆë‹¤.",unlockFlavor:"ì‚´ê°€ì£½. ì–‡ê²Œ, ì•„ì£¼ ì–‡ê²Œ.",tags:["EVENT_ONLY"],art:"assets/relics/relic_ratskin_charm.png"}],ke={relic_unknown_square:{id:"relic_unknown_square",dormantName:"ì –ì€ ì‚¬ê°í˜•",dormantText:"ê³°íŒ¡ì´ì¼ê¹Œ? ë¨¹ì„ ìˆ˜ ìˆì„ê¹Œ?",unlockHint:"ì¡°ê±´: íœ´ì‹ 1íšŒ",art:"assets/relics/relic_unknown_square.png",unlock:(e,t)=>e.run.unlock?.rest>=t.unlock.rest+1,name:"ë¨¹ì„ ìˆ˜ ìˆëŠ” ì‚¬ê°í˜•",text:"ì „íˆ¬ ì‹œì‘ ì‹œ ğŸ S +2",unlockFlavor:"ë¨¹ì„ ìˆ˜ëŠ” ìˆë‹¤. ì¼ë‹¨ì€.",onCombatStart(e){e.player.supplies+=2,h(e,"ìœ ë¬¼[ë¨¹ì„ ìˆ˜ ìˆëŠ” ì‚¬ê°í˜•]: S +2")}},relic_wrong_dice:{id:"relic_wrong_dice",name:"ì˜ëª»ëœ ì£¼ì‚¬ìœ„",text:"ì¹´ë“œì˜ ëª¨ë“  ìˆ«ìê°€ 1 ì¦ê°€í•©ë‹ˆë‹¤.",unlockFlavor:"ëˆˆê¸ˆì´ í•˜ë‚˜ì”© ì–´ê¸‹ë‚˜ ìˆë‹¤.",art:"assets/relics/relic_unknown_square.png"},relic_monster_leather_helm:{id:"relic_monster_leather_helm",dormantName:"ë“¤ëŸ¬ë¶™ëŠ” ê°€ì£½",dormantText:"í„¸ê³¼ í”¼ê°€ ë’¤ì„ì¸ ê°€ì£½ì´ ì†ì— ë“¤ëŸ¬ë¶™ëŠ”ë‹¤.",unlockHint:"ì¡°ê±´: ì—˜ë¦¬íŠ¸ ì „íˆ¬ ìŠ¹ë¦¬ 1íšŒ",art:"assets/relics/relic_monster_leather_helm.png",unlock:(e,t)=>e.run.unlock?.eliteWins>=t.unlock.eliteWins+1,name:"ëª¬ìŠ¤í„° ê°€ì£½ íˆ¬êµ¬",text:"ì²« í„´ì— ğŸ›¡ï¸ ë°©ì–´ +4",unlockFlavor:"ë¨¸ë¦¬ì— ë“¤ëŸ¬ë¶™ì–´ ë–¨ì–´ì§€ì§€ ì•Šì§€ë§Œ ë‹¹ì¥ì˜ ë¬¸ì œëŠ” ì•„ë‹ˆë‹¤.",onCombatStart(e){e.player.block+=4,h(e,"ìœ ë¬¼[ëª¬ìŠ¤í„° ê°€ì£½ íˆ¬êµ¬]: ë°©ì–´ +4")}},relic_smoke_bomb:{id:"relic_smoke_bomb",dormantName:"ì†ì´ ë¹„ì–´ ìˆëŠ” íƒ„í™˜",dormantText:"í”ë“¤ë©´ ì‘ì€ ì•Œê°±ì´ê°€ êµ´ëŸ¬ë‹¤ë‹Œë‹¤. ì—°ê¸°ê°€ ì¡°ê¸ˆì”© ìƒŒë‹¤.",unlockHint:"ì¡°ê±´: í•œ ë²ˆì— 10 ì´ìƒì˜ ğŸ—¡ï¸ í”¼í•´ 1íšŒ ë°›ê¸°",art:"assets/relics/relic_smoke_bomb.png",unlock:(e,t)=>(e.run.unlock?.tookBigHit10??0)>=t.unlock.tookBigHit10+1,name:"ì—°ë§‰íƒ„",text:"í™œì„±í™” ì‹œ ì—°ë§‰ ì¹´ë“œ(ì†Œì‹¤) 1ì¥ íšë“",unlockFlavor:"ë¹„ìƒ íƒˆì¶œ!",onActivate(e){const t="smoke";e.uidSeq+=1;const n=String(e.uidSeq);e.cards[n]={uid:n,defId:t,zone:"deck",upgrade:0},e.deck.push(n),h(e,"ìœ ë¬¼[ì—°ë§‰íƒ„]: ì—°ë§‰ ì¹´ë“œ 1ì¥ íšë“")}},relic_bone_compass:{id:"relic_bone_compass",dormantName:"ê¸¸ì„ ìƒëŠ” ë°”ëŠ˜",dormantText:"ë°©í–¥ì„ ê°€ë¦¬í‚¤ì§€ ëª»í•˜ëŠ” ë°”ëŠ˜ì´ ì£¼ë¨¸ë‹ˆ ë°”ê¹¥ìœ¼ë¡œ ë‚˜ì˜¨ë‹¤.",unlockHint:"ì¡°ê±´: íƒí—˜ 5íšŒ",art:"assets/relics/relic_bone_compass.png",unlock:(e,t)=>{const n=e.run;return(Number(n.timeMove??e.run?.nodePickCount??0)||0)>=t.moves+5},name:"ë¼ˆê°€ ë§Œë“  ë‚˜ì¹¨ë°˜",text:"ì „íˆ¬ ì‹œì‘ ì‹œ ğŸƒ ë“œë¡œìš° +1",unlockFlavor:"ì–´ë””ë¥¼ ê°€ë¦¬í‚¤ëŠ” ê²ƒì´ì§€?",onCombatStart(e){e._combatStartExtraDraw=(e._combatStartExtraDraw??0)+1,h(e,"ìœ ë¬¼[ë¼ˆê°€ ë§Œë“  ë‚˜ì¹¨ë°˜]: ì „íˆ¬ ì‹œì‘ ë“œë¡œìš° +1")}},relic_flesh_whetstone:{id:"relic_flesh_whetstone",dormantName:"ì´ê°€ ë¹ ì§„ ì¹¼ë‚ ",dormantText:"ì–´ë””ì— ì“°ë¼ê³  ìˆëŠ”ì§€ ëª¨ë¥´ê² ë‹¤.",unlockHint:"ì¡°ê±´: ì  ì²˜ì¹˜ 3íšŒ",art:"assets/relics/relic_flesh_whetstone.png",unlock:(e,t)=>(e.run.unlock?.kills??0)>=t.unlock.kills+3,name:"ì†ì‚´ì„ ì°¾ëŠ” ìˆ«ëŒ",text:"ì „íˆ¬ì—ì„œ ì²« ê³µê²©ì´ ì£¼ëŠ” ğŸ—¡ï¸ í”¼í•´ +3",unlockFlavor:"ë°¤ë§ˆë‹¤ ë¬´ì–¸ê°€ ê°ˆê³  ìˆë‹¤.",onCombatStart(e){e._firstPlayerAttackDoneThisCombat=!1},modifyDamage(e,t){if(t.phase!=="PRE_STATUS")return t.current;if(t.target==="ENEMY"&&t.source==="PLAYER_ATTACK"){const n=e;if(!n._firstPlayerAttackDoneThisCombat)return n._firstPlayerAttackDoneThisCombat=!0,t.current+3}return t.current}},relic_weak_bell:{id:"relic_weak_bell",dormantName:"ìƒˆê¹Œë§Œ ì¢…",dormantText:"ë§Œì§€ë©´ ì†ëì´ ë¬´ê²ë‹¤. ë‹¹ì¥ì—” ì•„ë¬´ ì¼ë„ ì—†ë‹¤.",unlockHint:"ì¡°ê±´: ğŸ¥€ ì•½í™”ë¥¼ ë°›ì€ ìƒíƒœë¡œ í„´ ì¢…ë£Œ 1íšŒ",art:"assets/relics/relic_weak_bell.png",unlock:(e,t)=>(e.run.unlock?.endedTurnWeak??0)>=t.unlock.endedTurnWeak+1,name:"í—ˆì•½ì˜ ì¢…ì†Œë¦¬",text:"ì „íˆ¬ ì‹œì‘ ì‹œ ëª¨ë“  ì ì—ê²Œ ğŸ¥€ ì•½í™” +2",unlockFlavor:"ì™ ì§€ ë“¤ìœ¼ë©´ ë§ˆìŒì´ í‰ì˜¨í•´ì§„ë‹¤.",onCombatStart(e){const t=ie(e);for(const n of t)Se(n,"weak",2,e,"SYSTEM");t.length&&h(e,"ìœ ë¬¼[í—ˆì•½ì˜ ì¢…ì†Œë¦¬]: ëª¨ë“  ì  ì•½í™” +2")}},relic_return_path_memory:{id:"relic_return_path_memory",dormantName:"ì°¢ì–´ì§„ ì§€ë„ ì¡°ê°",dormantText:"ì½ì„ ìˆ˜ ì—†ëŠ” ê¸¸ì´ ê·¸ë ¤ì ¸ ìˆë‹¤. ê°€ë³´ê³  ì‹¶ë‹¤.",unlockHint:"ì¡°ê±´: ì´ë²¤íŠ¸ 2íšŒ ì„ íƒ",art:"assets/relics/relic_return_path_memory.png",unlock:(e,t)=>(e.run.unlock?.eventPicks??0)>=t.unlock.eventPicks+2,name:"ëŒì•„ì˜¨ ê¸¸ì˜ ê¸°ì–µ",text:"ì „íˆ¬ ìŠ¹ë¦¬ ì‹œ HP +3",unlockFlavor:"ì™”ê¸°ì— ê°ˆ ìˆ˜ ì—†ë‹¤.",onVictory(e){ut(e,3),h(e,"ìœ ë¬¼[ëŒì•„ì˜¨ ê¸¸ì˜ ê¸°ì–µ]: ìŠ¹ë¦¬ íšŒë³µ +3")}},relic_wound_vial:{id:"relic_wound_vial",dormantName:"ë°˜ì´ë‚˜ ë‚¨ì€ ë¶‰ì€ ì•¡ì²´",dormantText:"ë§ˆê°œë¥¼ ì—´ì§€ ì•Šì•˜ëŠ”ë°ë„ í”¼ ëƒ„ìƒˆê°€ ë‚œë‹¤.",unlockHint:"ì¡°ê±´: HPê°€ 15 ì´í•˜ë¡œ ë–¨ì–´ì§„ ì  1íšŒ",art:"assets/relics/relic_wound_vial.png",unlock:(e,t)=>(e.run.unlock?.hpLeq15??0)>=t.unlock.hpLeq15+1,name:"ìƒì²˜ë¡œ ê¸°ì–´ê°€ëŠ” ì•½ë³‘",text:"ì „íˆ¬ ì‹œì‘ ì‹œ HP +3",unlockFlavor:"ì”¨ì•—ì´ ìˆì—ˆë‚˜?",onCombatStart(e){ut(e,3),h(e,"ìœ ë¬¼[ìƒì²˜ë¡œ ê¸°ì–´ê°€ëŠ” ì•½ë³‘]: ì „íˆ¬ ì‹œì‘ íšŒë³µ +3")}},relic_counting_needle:{id:"relic_counting_needle",dormantName:"ë©ˆì¶˜ ë°”ëŠ˜",dormantText:"ì‹œê³„ì¼ê¹Œ? ì‹œê³„ê°€ ì•„ë‹ê¹Œ? ë‘˜ ë‹¤ ì•„ë‹ˆë‹¤.",unlockHint:"ì¡°ê±´: ì•„ë¬´ í–‰ë™ë„ í•˜ì§€ ì•Šê³  í„´ ì¢…ë£Œ 1íšŒ",art:"assets/relics/relic_counting_needle.png",unlock:(e,t)=>(e.run.unlock?.skippedTurn??0)>=t.unlock.skippedTurn+1,name:"ìˆ¨ì„ ì„¸ëŠ” ë°”ëŠ˜",text:"í„´ ì¢…ë£Œ ì‹œ ë‹¤ìŒ í„´ ğŸƒ ë“œë¡œìš° +1",unlockFlavor:"ë°”ëŠ˜ì´ ëˆë‹¤. ì•„ë¬´ê²ƒë„ ì—†ì´.",onUpkeepEnd(e){e._extraDrawNextTurn=Number(e._extraDrawNextTurn??0)+1,h(e,"ìœ ë¬¼[ìˆ¨ì„ ì„¸ëŠ” ë°”ëŠ˜]: ë‹¤ìŒ í„´ ë“œë¡œìš° +1")}},relic_deeper_needle:{id:"relic_deeper_needle",dormantName:"ë¼ˆë¡œ ë§Œë“  ë°”ëŠ˜",dormantText:"ë”°ë”í•¨ì— ìµìˆ™í•œ ì§€ ì˜¤ë˜ë‹¤.",unlockHint:"ì¡°ê±´: ì ì—ê²Œ ğŸ©¸ ì¶œí˜ˆ ë¶€ì—¬ 3íšŒ",art:"assets/relics/relic_deeper_needle.png",unlock:(e,t)=>(e.run.unlock?.bleedApplied??0)>=t.unlock.bleedApplied+3,name:"ë” ê¹Šì€ ë°”ëŠ˜",text:"ğŸ©¸ ì¶œí˜ˆì„ ë¶€ì—¬í•  ë•Œë§ˆë‹¤ +1 ì¶”ê°€",unlockFlavor:"ë°”ëŠ˜ì´ í”¼ë¥¼ ë¨¹ê³  ê¸¸ì–´ì§„ ê²ƒ ê°™ë‹¤.",onCombatStart(e){e._bleedBonusPerApply=1},onVictory(e){delete e._bleedBonusPerApply}},relic_broken_millstone:{id:"relic_broken_millstone",dormantName:"ê¸ˆ ê°„ ë§·ëŒ",dormantText:"ê°ˆê³  ìˆìœ¼ë©´ ì‹œê°„ ê°€ëŠ” ì¤„ ëª¨ë¥´ê² ë‹¤.",unlockHint:"ì¡°ê±´: ì‹œê°„ 10 ì§€ë‚˜ê¸°",art:"assets/relics/relic_broken_millstone.png",unlock:(e,t)=>{const n=e.run,r=Number(n.timeMove??0)||0,o=Number(e.time??0)||0;return r+o>=t.timeTotal+10},name:"ê¹¨ì§„ ë§·ëŒ",text:"ë§¤ í„´ ëª¨ë“  ì ì—ê²Œ ğŸ—¡ï¸ 2 í”¼í•´",unlockFlavor:"ëŒì´ ë‹³ëŠ”ë‹¤. ì ë„ ë‹³ëŠ”ë‹¤.",onUpkeepEnd(e){const t=ie(e);if(t?.length){for(const n of t){let r=2;const o=Number(n.block??0);if(o>0){const s=Math.min(o,r);n.block=o-s,r-=s}if(r>0){const s=Number(n.hp??0);n.hp=Math.max(0,s-r)}}h(e,"ìœ ë¬¼[ê¹¨ì§„ ë§·ëŒ]: ëª¨ë“  ì ì—ê²Œ 2 í”¼í•´")}}},relic_bloody_spoon:{id:"relic_bloody_spoon",dormantName:"ë¶‰ì€ ìˆŸê°€ë½",dormantText:"ì‡  ëƒ„ìƒˆê°€ ì§„í•˜ë‹¤.",unlockHint:"ì¡°ê±´: ğŸ’¤ F 10 ì´ìƒ",art:"assets/relics/relic_bloody_spoon.png",unlock:(e,t)=>{const n=Number(e.player.fatigue??0)||0,r=Math.max(10,(Number(t.fatigue??0)||0)+1);return n>=r},name:"í”¼ ë¬»ì€ ìˆŸê°€ë½",text:"íšŒë³µ ì‹œ 1 ì¶”ê°€ íšŒë³µ",unlockFlavor:"ì´ëŸ°, í”¼ì˜€ë‹¤."},relic_black_ledger_shard:{id:"relic_black_ledger_shard",dormantName:"ê²€ëŒ• ë¬»ì€ ì¢…ì´",dormantText:"ê²€ì€ ì¢…ì´ë‹¤. íƒ€ê³  ë‚¨ì€ ì¡°ê°ì¼ì§€ë„ ëª¨ë¥´ê² ë‹¤.",unlockHint:"ì¡°ê±´: ğŸS = 0ìœ¼ë¡œ í„´ ì¢…ë£Œ 1íšŒ",art:"assets/relics/relic_black_ledger_shard.png",unlock:(e,t)=>(e.run.unlock?.endedTurnSupplyZero??0)>=t.unlock.endedTurnSupplyZero+1,name:"ê²€ì€ ì¥ë¶€ ì¡°ê°",text:"ğŸS = 0ìœ¼ë¡œ í„´ì„ ì¢…ë£Œí•˜ë©´, ğŸS +2, ğŸ’¤ F +1",unlockFlavor:"ì¥ë¶€. ë¬´ì—‡ì˜?",onUpkeepEnd(e){const t=ie(e);if(t?.length){for(const n of t){let r=2;const o=Number(n.block??0);if(o>0){const s=Math.min(o,r);n.block=o-s,r-=s}if(r>0){const s=Number(n.hp??0);n.hp=Math.max(0,s-r)}}h(e,"ìœ ë¬¼[ê²€ì€ ì¥ë¶€ ì¡°ê°]: S +2, F +1")}}},relic_ink_bottle:{id:"relic_ink_bottle",dormantName:"ê²€ì€ ì‰í¬ ì–¼ë£©",dormantText:"ì†ê°€ë½ ëì´ ê²€ê²Œ ë¬¼ë“ ë‹¤. ì”»ì–´ë„ ì§€ì›Œì§€ì§€ ì•ŠëŠ”ë‹¤.",unlockHint:"ì¡°ê±´: ğŸS = 0ìœ¼ë¡œ í„´ ì¢…ë£Œ 1íšŒ",art:"assets/relics/relic_ink_bottle.png",unlock:(e,t)=>(e.run.unlock?.endedTurnSupplyZero??0)>=t.unlock.endedTurnSupplyZero+1,name:"ê²€ì€ ì‰í¬ë³‘",text:"ì „íˆ¬ ì‹œì‘ ì‹œ ë‹¬ë¹› ë‘ë£¨ë§ˆë¦¬ 1ì¥ì„ ì†íŒ¨ì— ì¶”ê°€",unlockFlavor:"ê¸€ìëŠ” ë§ˆì¹˜ ë²Œë ˆì²˜ëŸ¼ ê¸°ì–´ë‹¤ë‹Œë‹¤.",onCombatStart(e){const t="token_moon_scroll";e.uidSeq+=1;const n=String(e.uidSeq);e.cards[n]={uid:n,defId:t,zone:"hand",upgrade:0},e.hand.push(n),h(e,"ìœ ë¬¼[ê²€ì€ ì‰í¬ë³‘]: ë‹¬ë¹› ë‘ë£¨ë§ˆë¦¬ +1")}},relic_moon_scroll_chisel:{id:"relic_moon_scroll_chisel",dormantName:"ë‹¬ë¹› ë¶€ìŠ¤ëŸ¬ê¸°",dormantText:"ì°¨ê°€ìš´ ë¹›ì´ ì†ëì— ë¬»ì–´ ìˆë‹¤.",unlockHint:"ì¡°ê±´: ë‹¬ë¹› ë‘ë£¨ë§ˆë¦¬ 3íšŒ ì‚¬ìš©",art:"assets/relics/relic_moon_scroll_chisel.png",unlock:(e,t)=>{const n=e.run.unlock?.moonScrollUses??0,r=t.unlock.moonScrollUses??0;return n>=r+3},name:"ë‹¬ë¹› ê¹ê°œ",text:"ë‹¬ë¹› ë‘ë£¨ë§ˆë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ ë¬´ì‘ìœ„ ğŸ—¡ï¸ í”¼í•´ 3",unlockFlavor:"ë¬¸ì¥ ì‚¬ì´ë¡œ ë¹›ì´ ìƒˆì–´ ë‚˜ì˜¨ë‹¤.",onPlaceCard(e,t){const n=t.cardUid,r=e.cards[n];if(!r||r.defId!=="token_moon_scroll")return;const o=ie(e);o.length!==0&&(Tr(e,fe(o),3),h(e,"ìœ ë¬¼[ë‹¬ë¹› ê¹ê°œ]: ë¬´ì‘ìœ„ ì ì—ê²Œ 3 í”¼í•´"))}},relic_order_whistle:{id:"relic_order_whistle",dormantName:"ë‹³ì•„ë¹ ì§„ í˜¸ë£¨ë¼ê¸°",dormantText:"ë¶ˆë©´ ì†Œë¦¬ê°€ ë‚˜ì§€ ì•ŠëŠ”ë‹¤. ê·¸ë˜ë„ ëª©ì— ê±´ë‹¤.",unlockHint:"ì¡°ê±´: ì ì´ 3ëª…ì¸ ì „íˆ¬ ìŠ¹ë¦¬",art:"assets/relics/relic_order_whistle.png",unlock:(e,t)=>(e.run.unlock?.threeEnemyWins??0)>=t.unlock.threeEnemyWins+1,name:"ëŒ€ì—´ ì •ë¦¬ì˜ í˜¸ë£¨ë¼ê¸°",text:"ì ì´ ì£½ì„ ë•Œë§ˆë‹¤ ğŸ›¡ï¸ ë°©ì–´ +6",unlockFlavor:"í˜¸ë£¨ë¼ê¸° ì†Œë¦¬ëŠ” ëŒ€ì—´ì„ ë‹¤ì‹œ ì„¸ìš´ë‹¤.",onCombatStart(e){e._orderWhistleKillSet=new Set},onDamageApplied(e,t){if(t.target!=="ENEMY")return;const n=t.enemyIndex;if(n==null||n<0)return;const r=e.enemies[n];if(!r||r.hp!==0)return;const o=`${n}:${t.enemyId??"?"}`,s=e._orderWhistleKillSet,a=s instanceof Set?s:new Set;a.has(o)||(a.add(o),e._orderWhistleKillSet=a,cn(e,6),h(e,"ìœ ë¬¼[ëŒ€ì—´ ì •ë¦¬ì˜ í˜¸ë£¨ë¼ê¸°]: ì  ì²˜ì¹˜ â†’ ë°©ì–´ +6"))}},relic_field_mechanic_glove:{id:"relic_field_mechanic_glove",dormantName:"ê¸°ë¦„ ëƒ„ìƒˆ ë‚˜ëŠ” ì¥ê°‘",dormantText:"ì†ë°”ë‹¥ì— ë‚¡ì€ ê°€ì£½ì´ ë“¤ëŸ¬ë¶™ëŠ”ë‹¤.",unlockHint:"ì¡°ê±´: ì„¤ì¹˜ë¬¼ì´ 3ê°œ ì´ìƒì¸ ì±„ë¡œ í„´ ì¢…ë£Œ",art:"assets/relics/relic_field_mechanic_glove.png",unlock:(e,t)=>(e.run.unlock?.endedTurnWith3Installs??0)>=t.unlock.endedTurnWith3Installs+1,name:"í˜„ì¥ ì •ë¹„ê³µì˜ ì¥ê°‘",text:"í„´ ì¢…ë£Œ ì‹œ ì„¤ì¹˜ë¬¼ì´ ìˆìœ¼ë©´ ğŸ S +1",unlockFlavor:"ì •ë¹„ëŠ” ê³§ ë³´ê¸‰ì´ë‹¤.",onUpkeepEnd(e){(e.frontSlots.filter(Boolean).length+e.backSlots.filter(Boolean).length|0)<=0||(Uo(e,1),h(e,"ìœ ë¬¼[í˜„ì¥ ì •ë¹„ê³µì˜ ì¥ê°‘]: í„´ ì¢…ë£Œ ì„¤ì¹˜ë¬¼ ë³´ìœ  â†’ S +1"))}},relic_castle_sight:{id:"relic_castle_sight",dormantName:"íë¦° ì¡°ì¤€ê¸°",dormantText:"ë²½ ë„ˆë¨¸ë¥¼ ë³´ë ¤ë©´, ë¨¼ì € ì´ˆì ì„ ë§ì¶°ì•¼ í•œë‹¤.",unlockHint:"ì¡°ê±´: ì„¤ì¹˜ë¬¼ë¡œ ì¤€ í”¼í•´ ë„í•© 15",art:"assets/relics/relic_castle_sight.png",unlock:(e,t)=>(e.run.unlock?.installDamageDealt??0)>=t.unlock.installDamageDealt+15,name:"ì„±ê³½ ì¡°ì¤€ê¸°",text:"ì„¤ì¹˜ë¬¼ì´ ì£¼ëŠ” ğŸ—¡ï¸ í”¼í•´ +1",unlockFlavor:"ê°€ê¹Œìš´ ì ë¶€í„° ì •í™•íˆ.",modifyDamage(e,t){return t.phase!=="PRE_STATUS"||t.target!=="ENEMY"||t.reason!=="INSTALL"?t.current:t.current+1}},relic_ratskin_charm:{id:"relic_ratskin_charm",name:"ì¥ê°€ì£½ ë¶€ì ",text:"ì·¨ì•½ì„ ë°›ì„ ë•Œ 1 ëœ ë°›ìŠµë‹ˆë‹¤.",unlockFlavor:"ì‚´ê°€ì£½. ì–‡ê²Œ, ì•„ì£¼ ì–‡ê²Œ.",tags:["EVENT_ONLY"],art:"assets/relics/relic_ratskin_charm.png"}};function To(e,t){return(e.run?.relics??[]).includes(t)}const Na=new Set(Sa.map(e=>e.id));function Aa(e){return Na.has(e)}const $a={rest:0,eliteWins:0,tookBigHit10:0,kills:0,endedTurnWeak:0,eventPicks:0,hpLeq15:0,skippedTurn:0,bleedApplied:0,endedTurnSupplyZero:0,moonScrollUses:0,threeEnemyWins:0,endedTurnWith3Installs:0,installDamageDealt:0};function Xe(e){e.run.relics??=[];const t=e.run;t.relicRuntime??={},t.pendingRelicActivations??=[],t.unlock={...$a,...t.unlock??{}},t.relicUnlocked??={}}function vo(e){return Xe(e),e.run.relicRuntime}function xo(e){return Xe(e),e.run.pendingRelicActivations}function _e(e){return Xe(e),e.run.unlock}function Co(e){const t=_e(e),n=e.run,r=Number(n.timeMove??e.run?.nodePickCount??0)||0,o=(Number(n.timeMove??0)||0)+(Number(e.time??0)||0);return{unlock:{...t},moves:r,timeTotal:o,fatigue:Number(e.player?.fatigue??0)||0,supplies:Number(e.player?.supplies??0)||0}}function Kt(e,t){const n=vo(e);if(n[t])return n[t];const o=!ke[t]?.unlock;return n[t]={active:o,pending:!1,obtainedAtNode:e.run.nodePickCount},n[t]}function gn(e,t){return Xe(e),To(e,t)?!!Kt(e,t).active:!1}function Ma(e,t){const n=e.run;return n.forceLockedRelics?.[t]===!0?!1:!!(n.forceUnlockedRelics?.[t]===!0||n.relicUnlocked?.[t]===!0||Array.isArray(n.unlockedRelics)&&n.unlockedRelics.includes(t)||n.unlockProgress?.relics?.[t]===!0||n.unlocks?.relics?.[t]===!0)}function nn(e,t){Xe(e);const n=ke[t],r=n?.name??t,o=n?.text??"",s=n?.art,i=e.run.relicRuntime?.[t]??null,l=!!n?.unlock,c=Ma(e,t),d=i?.active===!0?"ACTIVE":i?.pending===!0?"PENDING":"DORMANT",p=(()=>{const u=n?.unlockFlavor;if(!u||l&&!c)return"";const k=typeof u=="function"?u(e):u;return k?`

${k}`:""})();if(d==="ACTIVE")return{id:t,state:d,name:r,text:`${o}${p}`,art:s};if(d==="PENDING")return l&&!c?{id:t,state:d,name:r,text:`${o}

(ë‹¤ìŒ ë…¸ë“œë¶€í„° í™œì„±)`,art:s}:{id:t,state:d,name:r,text:`${o}${p}`,art:s};if(l&&!c){const u=n?.dormantName??r,k=[];n?.dormantText&&k.push(n.dormantText),n?.unlockHint&&k.push(n.unlockHint);const T=k.length?k.join(`
 
`):o;return{id:t,state:d,name:u,text:T,art:s}}return{id:t,state:d,name:r,text:`${o}${p}`,art:s}}function rn(e,t,n="NORMAL"){if(Xe(e),Aa(t)&&n!=="EVENT"){const a=ke[t];h(e,`ì´ ìœ ë¬¼ì€ ì´ë²¤íŠ¸ë¡œë§Œ íšë“í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: ${a?.name??t}`);return}e.run.relics.includes(t)||e.run.relics.push(t);const r=ke[t],o=Kt(e,t);if(!r?.unlock){o.active=!0,o.pending=!1,e.run.relicUnlocked[t]=!0,h(e,`ìœ ë¬¼ íšë“: ${r?.name??t}`),Y(e,"RELIC",`ìœ ë¬¼ íšë“: ${r?.name??t}`,2e3);return}o.active=!1,o.unlockBase||(o.unlockBase=Co(e));const s=nn(e,t);h(e,`ìœ ë¬¼ íšë“: ${s.name}`),Y(e,"RELIC",`ìœ ë¬¼ íšë“: ${s.name}`,2e3)}function Pa(e,t){const n=Kt(e,t);if(n.active||n.pending)return;n.pending=!0;const r=xo(e);r.includes(t)||r.push(t);const o=ke[t];h(e,`ìœ ë¬¼ ì¡°ê±´ ë‹¬ì„±: ${o?.name??t} (ë‹¤ìŒ ë…¸ë“œë¶€í„° í™œì„±)`)}function Ae(e){Xe(e);for(const t of e.run.relics){const n=ke[t];if(!n?.unlock)continue;const r=Kt(e,t);if(!(r.active||r.pending)){if(!r.unlockBase){r.unlockBase=Co(e);continue}n.unlock(e,r.unlockBase)&&Pa(e,t)}}}function be(e){Xe(e);const t=xo(e);if(!t.length)return;e.run.pendingRelicActivations=[];const n=vo(e);for(const r of t){const o=n[r]??Kt(e,r);if(!o.pending)continue;o.pending=!1,o.active=!0,o.activatedAtNode=e.run.nodePickCount,e.run.relicUnlocked[r]=!0;const s=ke[r];s?.onActivate?.(e),h(e,`ìœ ë¬¼ í™œì„±í™”: ${s?.name??r}`)}}function Ia(e){return Xe(e),e.run.relics??[]}function dr(e){return Ia(e).filter(t=>gn(e,t))}function zt(e,t,...n){for(const r of dr(e)){const o=ke[r];if(!o)continue;const s=o[t];s?.(e,...n)}}function Ge(e,t){let n=t.current;for(const r of dr(e)){const s=ke[r]?.modifyDamage;if(!s)continue;const a=s(e,{...t,current:n});n=Number.isFinite(a)?a:n,n<0&&(n=0)}return n}function go(e,t,n){for(const r of dr(e))ke[r]?.onDamageApplied?.(e,t,n)}function jt(e,t,n=null){if(e.choiceQueue??=[],!e.choice){e.choice=t,e.choiceCtx=n;return}e.choiceQueue.push({choice:t,ctx:n})}function qe(e,t,n=null){e.choiceQueue=[],e.choice=t,e.choiceCtx=n}function wo(e){e.choice=null,e.choiceCtx=null}function he(e){e.choiceQueue=[],wo(e),e.phase==="NODE"&&be(e)}function $e(e){const t=e.choiceQueue??[];if(t.length>0){const n=t.shift()??null;if(n){e.choice=n.choice,e.choiceCtx=n.ctx,e.choiceQueue=t;return}}wo(e),e.phase==="NODE"&&be(e)}function Ra(e){if(e.run.treasureObtained)return;e.run.treasureObtained=!0,e.run.afterTreasureNodePicks=0,e.run.deckSizeAtTreasure=Oo(e);const t=So(e);e.cards[t]={uid:t,defId:"goal_treasure",zone:"deck",upgrade:0},e.deck.push(t),e.deck=cr(e.deck),h(e,"ì €ì£¼ë°›ì€ ë³´ë¬¼ì„ íšë“í–ˆìŠµë‹ˆë‹¤! ë±ì— [ì €ì£¼ë°›ì€ ë³´ë¬¼] ì¶”ê°€. ì´ì œ ì…êµ¬(START)ë¡œ ëŒì•„ê°€ íƒˆì¶œí•˜ì„¸ìš”!"),La(e),h(e,"ë³´ë¬¼ì´ ìš¸ë¶€ì§–ì, ë˜ì „ì˜ ëª¨ë“  ë°©ì´ ë‹¤ì‹œ ì±„ì›Œì§‘ë‹ˆë‹¤..."),Ya(e),Xa(e)}function La(e){const t=e.run?.map;if(!t||!t.nodes)return;const n=t.startId,r=t.treasureId,o=Object.keys(t.nodes);for(const s of o){if(s===n||s===r)continue;const a=t.nodes[s];if(!a)continue;a.cleared=!1,delete a.noRespawn,delete a.lastClearedMove,a.reprocCount=Number(a.reprocCount??0)+1;const i=Number(a.depth??0);if(a.kind==="ELITE"||a.kind==="START"||a.kind==="TREASURE")continue;const l=Math.min(.8,.68+i*.01),c=.18,d=Math.random();a.kind=d<l?"BATTLE":d<l+c?"EVENT":"REST"}}const Eo=["arrow","shield","scout","field_ration"],Ye=[{id:"mad_echo",weight:12},{id:"mad_insight",weight:12},{id:"mad_bargain",weight:12},{id:"mad_no_impossible",weight:3},{id:"mad_bed_of_thorns",weight:3}],ot=[{id:"berserk",weight:0},{id:"arrow_rain",weight:0},{id:"smoke",weight:0},{id:"redeploy",weight:3},{id:"secret_strike",weight:3},{id:"fire_scroll",weight:3},{id:"emergency_rations",weight:3},{id:"field_experience",weight:3},{id:"install_makeshift_wall",weight:3},{id:"install_scriptorium",weight:3},{id:"cut_second",weight:3},{id:"coin_toss",weight:3},{id:"unforgettable_memory",weight:3},{id:"bandage",weight:12},{id:"caltrops",weight:12},{id:"painkiller",weight:12},{id:"vital_shot",weight:12},{id:"taunt",weight:12},{id:"cloth_scrap_armor",weight:12},{id:"prey_mark",weight:12},{id:"hand_blade",weight:12},{id:"lone_blow",weight:12},{id:"install_cursed_banner",weight:12},{id:"install_lead_observation",weight:12},{id:"scribe_hand",weight:12},{id:"innate_march_shield",weight:12},{id:"fuel_kindling",weight:12},{id:"impossible_plan",weight:12},{id:"slash_frenzy",weight:12},{id:"doppelganger",weight:12},{id:"camp_prep",weight:20},{id:"rapid_fire",weight:20},{id:"blood_contract",weight:20},{id:"brawl_cleaver",weight:20},{id:"gambler_glove",weight:20},{id:"install_ballista",weight:20},{id:"install_iron_bulwark",weight:20},{id:"install_castle_ballista",weight:20},{id:"install_wedge_spike",weight:20}];function it(e,t,n){const r=n?pr(t,n):ur(t);return{defId:on(r),upgrade:t===Ye?0:an(e)}}function Xt(e,t,n){const r=n?pr(t,n):ur(t),o=on(r),s=r.filter(d=>d.id!==o),a=on(s),i=t===Ye,l=i?0:an(e),c=i?0:an(e);return[{defId:o,upgrade:l},{defId:a,upgrade:c}]}function _o(e){const{tier:t}=ko(e);return Math.random()<(t===0?0:t===1?.15:t===2?.35:.6)}function ur(e){const t=new Map;for(const n of e){const r=Math.max(0,n.weight??0);r<=0||t.set(n.id,(t.get(n.id)??0)+r)}return[...t.entries()].map(([n,r])=>({id:n,w:r}))}function pr(e,t={}){const n=t.mult3??1,r=t.mult12??1,o=t.mult20??1,s=new Map;for(const a of e){const i=Math.max(0,a.weight??0);if(i<=0||i===3&&t.drop3||i===12&&t.drop12||i===20&&t.drop20)continue;let l=null;i===3?l=i*n:i===12?l=i*r:i===20?l=i*o:l=i,!(l<=0)&&s.set(a.id,(s.get(a.id)??0)+l)}return[...s.entries()].map(([a,i])=>({id:a,w:i}))}function on(e){let t=0;for(const r of e)t+=r.w;if(t<=0)throw new Error("No positive weights to pick from.");let n=Math.random()*t;for(const r of e)if(n-=r.w,n<=0)return r.id;return e[e.length-1].id}function an(e){const t=e?.player?.fatigue??0;if((e?.run.nodePickCount??999)<=6)return 0;const r=.1,o=t>=12?0:t>=9?.25:t>=6?.5:1;return Math.random()<r*o?1:0}function Ba(e){const t=e.player?.fatigue??0,n={defId:fe(Eo),upgrade:0},r=()=>t<=3?Xt(e,ot):t<=6?Xt(e,ot,{mult3:.25,mult12:.75,mult20:1}):t<=8?Xt(e,ot,{mult3:.1,mult12:.55,mult20:1}):Xt(e,ot,{drop3:!0,mult12:.45,mult20:1}),o=i=>_o(e)?it(e,Ye):i;if(t<=8){if(t<=6){const[d,p]=r();return[o(d),o(p)]}const i=t===7?.3:.55;if(Math.random()<i){const[d]=r(),p=o(d);return Math.random()<.5?[n,p]:[p,n]}const[l,c]=r();return[o(l),o(c)]}if(t<=11){const i=o(it(e,ot,{drop3:!0,mult12:.45,mult20:1}));return Math.random()<.5?[n,i]:[i,n]}const s=it(e,Ye),a=Math.random()<.65?it(e,Ye):n;return Math.random()<.5?[s,a]:[a,s]}function Ha(e,t,n,r){const o=[];let s=r?pr(t,r):ur(t);const a=t===Ye;for(let i=0;i<n&&!(s.length<=0);i++){const l=on(s);o.push({defId:l,upgrade:a?0:an(e)}),s=s.filter(c=>c.id!==l)}return o}function Oa(e,t){const n=e.content.cardsById[t]?.rarity;return n==="SPECIAL"||n==="RARE"}function Da(e,t){if(t==="BOSS")return{drop12:!0,drop20:!0};if(t==="ELITE")return{mult3:2.7,mult12:1.8,mult20:.8};const n=Math.max(0,Math.min(10,Number(e.run.rewardPityNonElite??0)||0)),r=1+n*.18,o=1+n*.3,s=Math.max(.65,1-n*.04);return{mult3:o,mult12:r,mult20:s}}function Fa(e,t,n){const r=Math.max(1,Math.min(6,Math.floor(Number(n)||0))),o=e.player?.fatigue??0,s={defId:fe(Eo),upgrade:0},a=()=>{const d=Da(e,t);return Ha(e,ot,r,d)},i=d=>t==="BOSS"||!_o(e)?d:it(e,Ye);let l=a();for(;l.length<r;)l.push({defId:"arrow",upgrade:0});if(o>=12){const d=[];for(let p=0;p<r;p++)p===r-1?d.push(Math.random()<.55?it(e,Ye):s):d.push(it(e,Ye));l=d}else if(o>=9){const d=Math.floor(Math.random()*r);l[d]=s,l=l.map(i)}else if(o>=7){const d=o===7?.25:.45;if(Math.random()<d){const p=Math.floor(Math.random()*r);l[p]=s}l=l.map(i)}else l=l.map(i);return l.some(d=>Oa(e,d.defId))?e.run.rewardPityNonElite=0:t==="BATTLE"&&(e.run.rewardPityNonElite=(Number(e.run.rewardPityNonElite??0)||0)+1),l.slice(0,r)}function So(e){return e.uidSeq+=1,`c_${e.uidSeq}`}function dt(e,t,n){const r=So(e);e.cards[r]={uid:r,defId:t,zone:"deck",upgrade:n?.upgrade??0},e.deck.push(r)}function fr(e){const t=Object.values(e.cards).filter(r=>r.zone==="deck"||r.zone==="hand"||r.zone==="discard");if(t.length===0)return;const n=fe(t);e.cards[n.uid].zone="vanished",e.vanished.push(n.uid),e.deck=e.deck.filter(r=>r!==n.uid),e.hand=e.hand.filter(r=>r!==n.uid),e.discard=e.discard.filter(r=>r!==n.uid),h(e,`ì¹´ë“œ ì œê±°: [${Ee(e,n.uid).name} +${e.cards[n.uid].upgrade??0}]`)}const Wa="goal_treasure";function Bt(e,t){const n=e.cards[t];return n?n.defId===Wa?(h(e,"ì €ì£¼ë°›ì€ ë³´ë¬¼ì€ ë±ì—ì„œ ì œê±°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."),!1):(e.deck=e.deck.filter(r=>r!==t),e.hand=e.hand.filter(r=>r!==t),e.discard=e.discard.filter(r=>r!==t),e.frontSlots=e.frontSlots.map(r=>r===t?null:r),e.backSlots=e.backSlots.map(r=>r===t?null:r),n.zone="vanished",e.vanished.push(t),h(e,`ì¹´ë“œ ì œê±°: [${Ee(e,n.uid).name} +${e.cards[n.uid].upgrade??0}]`),!0):!1}function qt(e,t){if(wn(e))return!1;const n=e.cards[t];if(!n)return!1;const o=e.content.cardsById[n.defId].upgrades?.length??0;return(n.upgrade??0)<o}function Ht(e,t){return qt(e,t)?(e.cards[t].upgrade=(e.cards[t].upgrade??0)+1,!0):!1}const Ua=[{id:"dream_shadow",name:"ê¿ˆê·¸ë¦¼ì",art:"assets/gods/dream_shadow.png",patronPlus:"íœ´ì‹-íšŒë³µ: í”¼ë¡œë„ +3 ëŒ€ì‹  í•­ìƒ ìµœëŒ€ ì²´ë ¥ì´ ë¨",patronMinus:"íœ´ì‹-ê°•í™”: í”¼ë¡œë„ë§Œí¼ í”¼í•´",temptation:"ì²´ë ¥ 10 íšŒë³µ, í”¼ë¡œë„ +3",hostile:"íœ´ì‹-íšŒë³µ: íšŒë³µëŸ‰ 0 / íœ´ì‹-ê°•í™”: í”¼ë¡œë„ë§Œí¼ í”¼í•´"},{id:"wing_artery",name:"ë‚ ê°œì˜ ë™ë§¥",art:"assets/gods/wing_artery.png",patronPlus:"ì´ë™: 30% í™•ë¥ ë¡œ ì‹œê°„ì´ íë¥´ì§€ ì•ŠìŒ / ì‹œì‘ ë³´ê¸‰ 10",patronMinus:"ì „íˆ¬: 5í„´ë§ˆë‹¤ í”¼ë¡œë„ +1",temptation:"ì‹œê°„ -7, í”¼ë¡œë„ +2",hostile:"ì´ë™ì— ê±¸ë¦¬ëŠ” ì‹œê°„ì´ 1 ëŠ˜ì–´ë‚¨"},{id:"bright_darkness",name:"ë°ì€ ì–´ë‘ ",art:"assets/gods/bright_darkness.png",patronPlus:"ì§€ë„: ì´ì›ƒ ë…¸ë“œ ì •ë³´ê°€ ë” ë©€ë¦¬ í‘œì‹œ(ì‹œì•¼ 3)",patronMinus:"ì „íˆ¬ ì‹œì‘: ìì‹  ì·¨ì•½ 1",temptation:"ë‹¤ìŒ 3ê°œ ë…¸ë“œ ë‚´ìš© ì¦‰ì‹œ ê³µê°œ, í”¼ë¡œë„ +1",hostile:"ì§€ë„: ë…¸ë“œ ì •ë³´ê°€ ì „ë¶€ ? / ì „íˆ¬ ì‹œì‘: ìì‹  ì·¨ì•½ 2"},{id:"indifferent_one",name:"ì•„ë¬´ë ‡ì§€ ì•Šì€ ì",art:"assets/gods/indifferent_one.png",patronPlus:"í„´ ì¢…ë£Œ: ì¹´ë“œ 0ì¥ ì‚¬ìš© ì‹œ HP +2, ë°©ì–´ +6",patronMinus:"í„´: 5ì¥ ì´ìƒ ì‚¬ìš© ì‹œ í”¼ë¡œë„ +1(1íšŒ)",temptation:"ì¦‰ì‹œ í”¼ë¡œë„ -5, ë‹¤ìŒ ì „íˆ¬ ë“œë¡œìš° -1",hostile:"í„´: 4ì¥ ì´ìƒ ì‚¬ìš© ì‹œ í”¼ë¡œë„ +1(1íšŒ)"},{id:"armored_tiger",name:"ì¤‘ê°‘ ì…ì€ í˜¸ë‘ì´",art:"assets/gods/armored_tiger.png",patronPlus:"ì „íˆ¬ ì‹œì‘: ë°©ì–´ 10",patronMinus:"í„´ ì¢…ë£Œ: ë°©ì–´ë¥¼ ì–»ì§€ ëª»í–ˆìœ¼ë©´ HP -2",temptation:"ìµœëŒ€ ì²´ë ¥ +5, í”¼ë¡œë„ +2",hostile:"ì „íˆ¬ ì‹œì‘: ì·¨ì•½ 2, ë“œë¡œìš° -1"},{id:"first_human",name:"ì²« ë²ˆì§¸ ì¸ê°„",art:"assets/gods/first_human.png",patronPlus:"ì „íˆ¬ ë³´ìƒ: ì¹´ë“œ ì œì‹œ +1",patronMinus:"ìƒì : ë¹„ìš© +50%",temptation:"ì¹´ë“œ 1ì¥ ì„ íƒ ë³µì œ, í”¼ë¡œë„ +3",hostile:"ì „íˆ¬ ë³´ìƒ: ì¹´ë“œ ì œì‹œ -1 / ìƒì : ë¹„ìš© +50%"},{id:"card_dealer",name:"ì¹´ë“œ ë”œëŸ¬",art:"assets/gods/card_dealer.png",patronPlus:"ì „íˆ¬ ì‹œì‘: ë“œë¡œìš° +1",patronMinus:"ì „íˆ¬ ì¢…ë£Œ: 30% í™•ë¥ ë¡œ ê³¨ë“œ 10 ìƒìŒ",temptation:"ê³¨ë“œ +40, ë±ì— ë¹š ë¬¸ì„œ(ì €ì£¼) 1ì¥ ì¶”ê°€",hostile:"ì „íˆ¬ ê³¨ë“œ ë³´ìƒ ì—†ìŒ"},{id:"rabbit_hunt",name:"í† ë¼ ì‚¬ëƒ¥",art:"assets/gods/rabbit_hunt.png",patronPlus:"ì „íˆ¬ ì‹œì‘: ëª¨ë“  ì  ì·¨ì•½ 2",patronMinus:"ë°©ì–´ë„ íšë“ëŸ‰ -25%",temptation:"ë‹¤ìŒ 3ì „íˆ¬ ë™ì•ˆ ì „íˆ¬ ì‹œì‘ ë“œë¡œìš° +1",hostile:"ë§¤ ì „íˆ¬ ì²« í„´: ìì‹  ì·¨ì•½ 3"},{id:"forge_master",name:"í™”ë¡œì˜ ì£¼ì¸",art:"assets/gods/forge_master.png",patronPlus:"ì‹œì‘: í™”ì‚´/ê°•ë ¥í•œ í™”ì‚´/ë°©íŒ¨ê°€ ê°•í™”ëœ ì±„ë¡œ ì‹œì‘",patronMinus:"ì—†ìŒ",temptation:"ë¬´ì‘ìœ„ ì¹´ë“œ 1ì¥ ì œê±° í›„ 2ì¥ ê°•í™”",hostile:"ê°•í™” ë¶ˆê°€ / íœ´ì‹ ì‹œ ì¹´ë“œ 1ì¥ ë¬´ì‘ìœ„ ì œê±°"}],q={dream_shadow:{restHeal:"ì•…ëª½ì„ ê¾¸ì—ˆìŠµë‹ˆê¹Œ?",restUpgrade:"ë§ì¹˜ë¥¼ ë“¤ ê¸°ìš´ì´ ë‚˜ì§€ ì•ŠëŠ”êµ°ìš”.",tempt:"ë‚®ì ì—ì„œë„ ì•…ëª½ì€ ì°¾ì•„ì˜µë‹ˆë‹¤.",hostileRest:"ê¿ˆê·¸ë¦¼ìê°€ ë‹¹ì‹ ì˜ íœ´ì‹ì„ ë°©í•´í•©ë‹ˆë‹¤."},wing_artery:{moveNoTime:"ë‹¹ì‹ ì€ ë–¨ì–´ì§€ëŠ” í•ë°©ìš¸ë³´ë‹¤ ë¹ ë¦…ë‹ˆë‹¤.",every5Turns:"ë‚ ê°œê°€ ì‹œë“¤ê³  ìˆìŠµë‹ˆë‹¤.",tempt:"ì •ì‹ ì„ ì°¨ë ¤ë³´ë‹ˆ ì´ê³³ì…ë‹ˆë‹¤.",apostasy:"ìƒˆê°€ ë‚ ê°œë¥¼ ìƒì—ˆêµ°ìš”."},forge_master:{firstBattle:"ë‹¹ì‹ ì˜ ì² ì€ ëˆ„êµ¬ë³´ë‹¤ ë‹¨ë‹¨í•©ë‹ˆë‹¤.",tempt:"í™”ë§ˆê°€ ì² ì„ êµ½ìŠµë‹ˆë‹¤.",hostileRestEnter:"ë¶ˆì´ ë¶™ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¹ì‹ ì„ ë”°ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."},bright_darkness:{nodeSelect:"ë¹›ì´ ë‹¹ì‹ ì„ ì¸ë„í•©ë‹ˆë‹¤.",combatStart:"ë„ˆë¬´ ë°ì•„ ìˆ¨ì„ ê³³ì´ ì—†ìŠµë‹ˆë‹¤.",tempt:"ë³´ì´ê²Œ í•´ì£¼ë§ˆ. ëŒ€ì‹  ëˆˆì„ ë‚´ì–´ë¼.",hostileMap:"ì–´ë‘ ì´ ë‹¹ì‹ ì˜ ëˆˆì„ ë¨¹ì—ˆìŠµë‹ˆë‹¤."},indifferent_one:{endTurnZero:"ì•„ë¬´ ì¼ë„ ì—†ì—ˆìŠµë‹ˆë‹¤.",at5Cards:"ì›€ì§ì„ì´ ê³¼í•©ë‹ˆë‹¤.",tempt:"ê°€ë§Œíˆ ìˆì–´ë„, êµ´ëŸ¬ê°‘ë‹ˆë‹¤.",hostileFirstUse:"ê´œíˆ ì›€ì§ì˜€êµ°ìš”."},armored_tiger:{combatStart:"ì´ë¹¨ì€ ë²¼ë ¤ì¡Œê³ , ê°‘ì˜·ì€ ë‹«í˜”ìŠµë‹ˆë‹¤.",endTurnNoBlock:"í˜¸ë‘ì´ëŠ” ë‹¹ì‹ ì„ ëŒ€ì‹  ì¡ì•„ë¨¹ìŠµë‹ˆë‹¤.",tempt:"ë¬´ê±°ì›Œì ¸ë¼. ì‚´ì•„ë‚¨ì•„ë¼.",hostileCombat:"í‹ˆì´ ë³´ì…ë‹ˆë‹¤."},first_human:{reward:"ë°°ì›ë‹ˆë‹¤. ë”°ë¼í•©ë‹ˆë‹¤.",shop:"ìˆœìˆ˜ì£¼ì˜ìì¸ ë‹¹ì‹ ì€ ê³ ë¸”ë¦°ì´ ë‹¬ê°‘ì§€ ì•ŠìŠµë‹ˆë‹¤.",tempt:"ì²« ë²ˆì§¸ëŠ” í•­ìƒ, ë‹¤ì‹œ íƒœì–´ë‚©ë‹ˆë‹¤.",hostileReward:"ì§€ì‹ì€ ìŠí™ë‹ˆë‹¤."},card_dealer:{combatStart:"íŒì„ ê¹”ì•„ë“œë¦¬ì£ .",victoryFee:"ìˆ˜ìˆ˜ë£ŒëŠ” ë‹¹ì—°íˆ ë°›ìŠµë‹ˆë‹¤.",tempt:"ì˜¤ëŠ˜ë§Œ ì™¸ìƒì…ë‹ˆë‹¤.",hostileShop:"ë”œëŸ¬ë¥¼ ë°°ì‹ í•˜ê³ ë„ ëˆì´ ë‚¨ì•„ìˆêµ°ìš”?."},rabbit_hunt:{combatStart:"ë¨¼ì € ì¡ìŠµë‹ˆë‹¤.",blockGain:"ê°€ë²¼ìš´ ë°©íŒ¨ëŠ” ì˜ ë¶€ëŸ¬ì§‘ë‹ˆë‹¤.",tempt:"ë” ë¹¨ë¦¬. ë” ê¹Šì´.",hostileCombatStart:"ì´ë²ˆì—” ë‹¹ì‹ ì´ ì«“ê¹ë‹ˆë‹¤."},madness:{accept:"ë‹¹ì‹ ì€ ê·¸ í˜ì„ ë°›ì•„ë“¤ì´ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.",reject:"ë‹¹ì‹ ì—ê²Œ ì£¼ì–´ì ¸ ë§ˆë•…í•œ í˜ì´ ë˜ì „ ê³³ê³³ì— í©ì–´ì¡ŒìŠµë‹ˆë‹¤."}};function No(){const e=["dream_shadow","wing_artery","forge_master","bright_darkness","indifferent_one","armored_tiger","first_human","card_dealer","rabbit_hunt"],t=[],n=[...e];for(;t.length<3&&n.length>0;){const r=Math.random()*n.length|0;t.push(n.splice(r,1)[0])}for(;t.length<3;)t.push("dream_shadow");return[t[0],t[1],t[2]]}function mr(e){const t=Ua.find(n=>n.id===e);if(!t)throw new Error(`Unknown god ${e}`);return t}function Te(e){return e==="madness"?"ê´‘ê¸°":mr(e).name}function qn(e){return e==="madness"?"assets/gods/madness.png":mr(e).art}function sn(e){const t=mr(e);return[`í›„ì›(+)  ${t.patronPlus}`,`í›„ì›(-)  ${t.patronMinus}`,`ìœ í˜¹     ${t.temptation}`,`ë°°êµ/ì ëŒ€ ${t.hostile}`].join(`
`)}function Ka(e){const t=e??No(),n={dream_shadow:0,wing_artery:0,forge_master:0,bright_darkness:0,indifferent_one:0,armored_tiger:0,first_human:0,card_dealer:0,rabbit_hunt:0,madness:0},r=t[0];return{offered:t,points:n,focus:r,lastFocus:r,chosen:!1,hostile:{}}}function pe(e){const t=e.run;t.faith||(t.faith=Ka());const n=t.faith;n.offered??=No(),n.points??={dream_shadow:0,wing_artery:0,forge_master:0,bright_darkness:0,indifferent_one:0,armored_tiger:0,first_human:0,card_dealer:0,rabbit_hunt:0,madness:0};const r=o=>{const s=Number(n.points[o]);Number.isFinite(s)||(n.points[o]=0)};for(const o of["dream_shadow","wing_artery","forge_master","bright_darkness","indifferent_one","armored_tiger","first_human","card_dealer","rabbit_hunt","madness"])r(o);return n.hostile??={},n.focus??=n.offered?.[0]??"dream_shadow",n.lastFocus??=n.focus,n.chosen??=!1,n.madnessAwakened??=!1,n.madnessTemptUsed??=!1,hr(n),n}function Ce(e,t){return!!pe(e).hostile?.[t]}function Ao(e,t,n){const r=pe(e);r.hostile??={},r.hostile[t]=!0,hr(r)}function ve(e){const t=pe(e),n=t.focus;return n==="madness"||t.hostile?.[n]?null:(t.points?.[n]??0)>=3?n:null}function hr(e,t){const n=e.offered,r=e.points,o=e.hostile??{},s=n.filter(c=>!o[c]),a=s.length>0?s:n;let i=-1,l=[];for(const c of a){const d=Number(r[c]??0)||0;d>i?(i=d,l=[c]):d===i&&l.push(c)}if(l.length===1){e.focus=l[0],e.lastFocus=e.focus;return}if(l.includes(e.lastFocus)){e.focus=e.lastFocus;return}if(t&&l.includes(t)){e.focus=t,e.lastFocus=t;return}e.focus=l[0],e.lastFocus=e.focus}function Pr(e){return e<0?0:e>5?5:e}function za(e){const t=pe(e);return t.offered.map(n=>`${Te(n)}:${t.points[n]??0}`).join(", ")}function ja(e,t){const n=pe(e);if(n.offered.includes(t)){for(const r of n.offered)n.points[r]=0;if(n.points[t]=5,n.focus=t,n.lastFocus=t,n.chosen=!0,n.hostile={},t==="forge_master"){const r=Object.values(e.cards).filter(o=>o.zone==="deck"&&["arrow","power_arrow","shield"].includes(o.defId)).map(o=>o.uid);for(const o of r)Ht(e,o);h(e,`í™”ë¡œì˜ ì£¼ì¸: ì‹œì‘ ì¹´ë“œ ê°•í™” (${r.length}ì¥)`)}h(e,`ì‹ ì•™ ì„ íƒ: ${Te(t)} (5ì )`)}}function $o(e){const n=pe(e).offered,o={kind:"FAITH",title:"ì‹ ì•™ ì„ íƒ",prompt:"ì„¸ ì‹  ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•©ë‹ˆë‹¤. (ì ìˆ˜ ì´í•© 5, ìœ í˜¹ ìˆ˜ë½ ì‹œ +1/-1, í›„ì› ìœ ì§€ ê¸°ì¤€: í¬ì»¤ìŠ¤ â‰¥3)",options:n.map(s=>{const a=s;return{key:`faith:choose:${s}`,label:Te(s),detail:sn(a)}})};qe(e,o,{kind:"FAITH_START",offered:n})}function qa(e){const t=pe(e);if(!t.chosen)return null;const n=t.focus,r=t.hostile??{},o=t.offered.filter(a=>a!==n&&!r[a]);if(o.length===0)return null;let s=o;return t.lastTempter&&o.length>=2&&(s=o.filter(a=>a!==t.lastTempter),s.length===0&&(s=o)),fe(s,"pickTemptingGod")}function Ir(e,t){const n=pe(e);if(!n.chosen||!n.offered.includes(t))return;const r=n.focus;t!==r&&(n.points[t]=Pr((n.points[t]??0)+1),n.points[r]=Pr((n.points[r]??0)-1),hr(n,t),h(e,`ìœ í˜¹ ìˆ˜ë½: ${Te(t)} +1 / ${Te(r)} -1  ->  (${za(e)}) / í¬ì»¤ìŠ¤=${Te(n.focus)}`))}function Mo(e,t){const n=pe(e);if(!n.chosen||!n.offered.includes(t)||t===n.focus||n.hostile?.[t])return;n.lastTempter=t;const r=`ìœ í˜¹: ${Te(t)}`,o=String(q[t]?.tempt??""),s=Va(t),a={kind:"GOD_TEMPT",title:r,prompt:o,art:qn(t),options:[{key:"tempt:accept",label:"ë°›ì•„ë“¤ì¸ë‹¤",detail:s},{key:"tempt:reject",label:"ê±°ë¶€í•œë‹¤"}]};o&&(Y(e,"INFO",o,1800),h(e,o)),qe(e,a,{kind:"GOD_TEMPT",tempter:t})}function Va(e){return e==="dream_shadow"?"ì²´ë ¥ 10 íšŒë³µ, í”¼ë¡œë„ +3":e==="wing_artery"?"ì‹œê°„ -7, í”¼ë¡œë„ +2":e==="forge_master"?"ë¬´ì‘ìœ„ ì¹´ë“œ 1ì¥ ì œê±° í›„ 2ì¥ ê°•í™”":e==="bright_darkness"?"ë‹¤ìŒ 3ê°œ ë…¸ë“œì˜ ë‚´ìš©ì´ ì¦‰ì‹œ ê³µê°œ, í”¼ë¡œë„ +1":e==="indifferent_one"?"ì¦‰ì‹œ í”¼ë¡œë„ -5, ëŒ€ì‹  ë‹¤ìŒ ì „íˆ¬ ë“œë¡œìš° -1":e==="armored_tiger"?"ìµœëŒ€ ì²´ë ¥ +5, í”¼ë¡œë„ +2":e==="first_human"?"ì¹´ë“œ 1ì¥ ì„ íƒ ë³µì œ, í”¼ë¡œë„ +3":e==="card_dealer"?"ê³¨ë“œ +40, ë±ì— â€˜ë¹š ë¬¸ì„œâ€™(ì €ì£¼) 1ì¥ ì¶”ê°€":e==="rabbit_hunt"?"ë‹¤ìŒ 3ì „íˆ¬ ë™ì•ˆ ì „íˆ¬ ì‹œì‘ ë“œë¡œìš° +1":""}function Ga(e,t){if(t==="dream_shadow"){ut(e,10),e.player.fatigue=(e.player.fatigue??0)+3,h(e,"ìœ í˜¹: HP +10, í”¼ë¡œ +3");return}if(t==="wing_artery"){e.time=Math.max(0,(e.time??0)-7),e.player.fatigue=(e.player.fatigue??0)+2,h(e,"ìœ í˜¹: ì‹œê°„ -7, í”¼ë¡œ +2");return}if(t==="forge_master"){fr(e);const n=Object.values(e.cards).filter(o=>(o.zone==="deck"||o.zone==="hand"||o.zone==="discard")&&qt(e,o.uid)).map(o=>o.uid);for(let o=n.length-1;o>0;o--){const s=Math.random()*(o+1)|0,a=n[o];n[o]=n[s],n[s]=a}const r=n.slice(0,2);for(const o of r)Ht(e,o);h(e,`ìœ í˜¹: ì¹´ë“œ 1ì¥ ì œê±°, ${r.length}ì¥ ê°•í™”`);return}if(t==="bright_darkness"){const n=e.run.map,r=String(n?.pos??""),o=n?.edges??{},s=n.seen??={},a=3,i={},l=[];for(r&&(i[r]=0,l.push(r));l.length;){const d=l.shift(),p=i[d]??0;if(!(p>=a))for(const u of o[d]??[])i[u]==null&&(i[u]=p+1,l.push(u))}let c=0;for(const d of Object.keys(i))d!==r&&((i[d]??999)>a||(s[d]??0)>=3||(s[d]=3,c+=1));e.player.fatigue=(e.player.fatigue??0)+1,h(e,`ìœ í˜¹: ê±°ë¦¬ ${a}ê¹Œì§€ ë…¸ë“œ ${c}ê°œ ê³µê°œ, í”¼ë¡œ +1`);return}if(t==="indifferent_one"){e.player.fatigue=Math.max(0,(e.player.fatigue??0)-5);const n=e.run;n.nextCombatDrawDelta=(Number(n.nextCombatDrawDelta??0)||0)-1,h(e,"ìœ í˜¹: í”¼ë¡œ -5, ë‹¤ìŒ ì „íˆ¬ ë“œë¡œìš° -1");return}if(t==="armored_tiger"){e.player.maxHp+=5,e.player.hp=Math.min(e.player.maxHp,e.player.hp+5),e.player.fatigue=(e.player.fatigue??0)+2,h(e,"ìœ í˜¹: ìµœëŒ€ HP +5, í”¼ë¡œ +2");return}if(t==="card_dealer"){const n=e.run,r=Number(n.gold??0)||0;n.gold=r+40,dt(e,"debt_paper",{upgrade:0}),h(e,"ìœ í˜¹: ğŸª™ +40, ë¹š ë¬¸ì„œ 1ì¥ ì¶”ê°€");return}if(t==="rabbit_hunt"){const n=e.run;n.rabbitHuntDrawBoostBattles=Math.max(0,Number(n.rabbitHuntDrawBoostBattles??0)||0)+3,h(e,"ìœ í˜¹: ë‹¤ìŒ 3ì „íˆ¬ ì „íˆ¬ ì‹œì‘ ë“œë¡œìš° +1");return}}function Rr(e){return e===1?"ì¦‰ì‹œ ì²´ë ¥ ì „ë¶€ íšŒë³µ, ì „íˆ¬ ëŒì… ì‹œ 30% í™•ë¥ ë¡œ ì²«ë²ˆì§¸ ì  ì¦‰ì‚¬ (ë³´ìŠ¤ ì œì™¸)":e===2?"ì•ìœ¼ë¡œì˜ ì „íˆ¬ì—ì„œ ì²«ë²ˆì§¸ ì ì´ ì·¨ì•½/ì•½í™” 4":"50% í™•ë¥ ë¡œ ì „íˆ¬ ë…¸ë“œì— ë“¤ì–´ê°€ë„ ì „íˆ¬ê°€ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. (ë³´ìŠ¤ ì œì™¸)"}function Lr(e){return e===1?"ëª¨ë“  ì ì˜ ì²´ë ¥ì´ 10 ì¦ê°€":e===2?"ì „íˆ¬ ì‹œì‘ ì‹œ ìì‹ ì€ ì·¨ì•½/ì•½í™”/ì¶œí˜ˆ 2":"50% í™•ë¥ ë¡œ ì „íˆ¬ê°€ ì•„ë‹Œ ë…¸ë“œì— ë“¤ì–´ê°€ë„ ì „íˆ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤."}function Ya(e){const t=pe(e);t.madnessAwakened=!0}function Xa(e){const t=pe(e);if(!t.chosen||(t.madnessAwakened||(t.madnessAwakened=!0),t.madnessTemptUsed))return;const n=fe([1,2,3],"madness boon"),r=fe([1,2,3],"madness bane"),o="ê´‘ê¸°ì˜ ì‹  0",s=`ê´‘ê¸°ì˜ ì‹ ì´ ê¹¨ì–´ë‚¬ìŠµë‹ˆë‹¤.

ìˆ˜ë½ ì‹œ(ë°°êµ): ${Rr(n)}
  - ë‹¨, ì¦‰ì‹œ F +10
ê±°ë¶€ ì‹œ(ì ëŒ€): ${Lr(r)}`,a={kind:"MADNESS_TEMPT",title:o,prompt:s,art:"assets/gods/madness.png",options:[{key:"madness:accept",label:"í˜ì„ ë°›ì•„ë“¤ì¸ë‹¤",detail:`ë°°êµ
${Rr(n)}
(ì¦‰ì‹œ F+10)`},{key:"madness:reject",label:"ê±°ë¶€í•œë‹¤",detail:`ì ëŒ€
${Lr(r)}`}]};qe(e,a,{kind:"MADNESS_TEMPT",offerBoon:n,offerBane:r})}function Qa(e,t){const n=pe(e);if(n.madnessTemptUsed)return;n.madnessTemptUsed=!0,n.madnessAccepted=!0,n.madnessBoon=t,e.player.fatigue=(e.player.fatigue??0)+10,t===1&&(e.player.hp=e.player.maxHp,h(e,"ê´‘ê¸°: ì¦‰ì‹œ ì²´ë ¥ ì „ë¶€ íšŒë³µ")),Y(e,"INFO",q.madness.accept,2200),h(e,q.madness.accept);const r=n.focus;Ao(e,r),r==="wing_artery"&&(Y(e,"WARN",q.wing_artery.apostasy,2200),h(e,q.wing_artery.apostasy)),h(e,`ë°°êµ: ${Te(r)} ì ëŒ€`)}function Za(e,t){const n=pe(e);n.madnessTemptUsed||(n.madnessTemptUsed=!0,n.madnessAccepted=!1,n.madnessBane=t,Ao(e,"madness"),Y(e,"WARN",q.madness.reject,2200),h(e,q.madness.reject))}function Po(e){const t=pe(e);return t.madnessAccepted?t.madnessBoon??null:null}function br(e){const t=pe(e);return t.hostile?.madness?t.madnessBane??null:null}function Ja(e){const t=Po(e);if(br(e)===2&&(Se(e.player,"vuln",2,e,"SYSTEM"),Se(e.player,"weak",2,e,"SYSTEM"),Se(e.player,"bleed",2,e,"SYSTEM"),h(e,"ê´‘ê¸°(ì ëŒ€): ì·¨ì•½/ì•½í™”/ì¶œí˜ˆ 2")),t===2){const r=e.enemies?.[0];r&&r.hp>0&&!String(r.id??"").startsWith("boss_")&&(Se(r,"vuln",4,e,"SYSTEM"),Se(r,"weak",4,e,"SYSTEM"),h(e,"ê´‘ê¸°: ì²«ë²ˆì§¸ ì  ì·¨ì•½/ì•½í™” 4"))}if(t===1){const r=e.enemies?.[0];r&&r.hp>0&&!String(r.id??"").startsWith("boss_")&&Math.random()<.3&&(r.hp=0,h(e,"ê´‘ê¸°: ì²«ë²ˆì§¸ ì  ì¦‰ì‚¬!"),Y(e,"INFO","ê´‘ê¸°ì˜ í˜ì´ ì ì„ ì‚¼ì¼°ìŠµë‹ˆë‹¤.",1600))}}function es(e){const t=ve(e),n=Ce(e,"wing_artery");let r=1;return t==="wing_artery"&&Math.random()<.3&&(r=0,Y(e,"INFO",q.wing_artery.moveNoTime,1800),h(e,q.wing_artery.moveNoTime)),n&&(r+=1),r}function ts(e){return ve(e)==="wing_artery"?3:0}function ns(e){if(ve(e)!=="wing_artery")return;const n=e.combatTurn??0;n>0&&n%5===0&&(e.player.fatigue=(e.player.fatigue??0)+1,Y(e,"WARN",q.wing_artery.every5Turns,1800),h(e,q.wing_artery.every5Turns))}function rs(e){const t=ve(e);return Ce(e,"dream_shadow")?(Y(e,"WARN",q.dream_shadow.hostileRest,1800),h(e,q.dream_shadow.hostileRest),{healed:!0}):t==="dream_shadow"?(e.player.hp=e.player.maxHp,e.player.fatigue=(e.player.fatigue??0)+3,Y(e,"INFO",q.dream_shadow.restHeal,1800),h(e,q.dream_shadow.restHeal),h(e,"íœ´ì‹: ìµœëŒ€ ì²´ë ¥ íšŒë³µ (F +3)"),{healed:!0}):{healed:!1}}function os(e){const t=ve(e),n=Ce(e,"dream_shadow");if(t!=="dream_shadow"&&!n)return;const r=e.player.fatigue??0;r>0?(we(e,r,"OTHER","ê¿ˆê·¸ë¦¼ì"),Y(e,"WARN",q.dream_shadow.restUpgrade,1800),h(e,q.dream_shadow.restUpgrade),h(e,`íœ´ì‹: ê°•í™” ëŒ€ê°€ë¡œ í”¼í•´ ${r}`)):(Y(e,"WARN",q.dream_shadow.restUpgrade,1400),h(e,q.dream_shadow.restUpgrade))}function wn(e){return Ce(e,"forge_master")}function as(e){wn(e)&&(Y(e,"WARN",q.forge_master.hostileRestEnter,2200),h(e,q.forge_master.hostileRestEnter),fr(e)),Ce(e,"dream_shadow")&&(Y(e,"WARN",q.dream_shadow.hostileRest,2200),h(e,q.dream_shadow.hostileRest))}function ss(e){let t=3;return ve(e)==="first_human"&&(t+=1),Ce(e,"first_human")&&(t-=1),Math.max(1,Math.min(6,t))}function is(e){return ve(e)==="first_human"||Ce(e,"first_human")?1.5:1}function We(e,t){const n=Math.max(0,Number(t)||0),r=is(e),o=r===1?n:Math.ceil(n*r);return Math.max(1,o)}function ls(e){let t=0;return ve(e)==="card_dealer"&&(t+=1),Ce(e,"armored_tiger")&&(t-=1),t}function cs(e){const t=ve(e);if(t==="bright_darkness"&&(Se(e.player,"vuln",1,e,"SYSTEM"),Y(e,"WARN",q.bright_darkness.combatStart,1800),h(e,q.bright_darkness.combatStart)),Ce(e,"bright_darkness")&&(Se(e.player,"vuln",2,e,"SYSTEM"),h(e,"ë°ì€ ì–´ë‘ (ì ëŒ€): ì „íˆ¬ ì‹œì‘ ì·¨ì•½ 2")),t==="armored_tiger"&&(e.player.block=(e.player.block??0)+10,e._gainedBlockThisTurn=!0,Y(e,"INFO",q.armored_tiger.combatStart,1800),h(e,q.armored_tiger.combatStart),h(e,"ì¤‘ê°‘ ì…ì€ í˜¸ë‘ì´: ì „íˆ¬ ì‹œì‘ ë°©ì–´ +10")),Ce(e,"armored_tiger")&&(Se(e.player,"vuln",2,e,"SYSTEM"),Y(e,"WARN",q.armored_tiger.hostileCombat,1800),h(e,q.armored_tiger.hostileCombat),h(e,"ì¤‘ê°‘ ì…ì€ í˜¸ë‘ì´(ì ëŒ€): ì „íˆ¬ ì‹œì‘ ì·¨ì•½ 2 / ë“œë¡œìš° -1")),t==="card_dealer"&&(Y(e,"INFO",q.card_dealer.combatStart,1800),h(e,q.card_dealer.combatStart)),t==="rabbit_hunt"){for(const n of e.enemies??[])n&&n.hp>0&&Se(n,"vuln",2,e,"SYSTEM");Y(e,"INFO",q.rabbit_hunt.combatStart,1800),h(e,q.rabbit_hunt.combatStart),h(e,"í† ë¼ ì‚¬ëƒ¥: ëª¨ë“  ì  ì·¨ì•½ 2")}Ce(e,"rabbit_hunt")&&(Se(e.player,"vuln",3,e,"SYSTEM"),Y(e,"WARN",q.rabbit_hunt.hostileCombatStart,1800),h(e,q.rabbit_hunt.hostileCombatStart),h(e,"í† ë¼ ì‚¬ëƒ¥(ì ëŒ€): ì „íˆ¬ ì‹œì‘ ì·¨ì•½ 3"))}function ds(e){const t=ve(e),n=Number(e.usedThisTurn??0)||0;t==="indifferent_one"&&n===5&&(e.player.fatigue=(e.player.fatigue??0)+1,Y(e,"WARN",q.indifferent_one.at5Cards,1800),h(e,q.indifferent_one.at5Cards),h(e,"ì•„ë¬´ë ‡ì§€ ì•Šì€ ì: 5ì¥ì§¸ ì‚¬ìš© â†’ í”¼ë¡œ +1")),Ce(e,"indifferent_one")&&(n===1&&!e._indifferentHostileWarnedThisTurn&&(e._indifferentHostileWarnedThisTurn=!0,Y(e,"WARN",q.indifferent_one.hostileFirstUse,1800),h(e,q.indifferent_one.hostileFirstUse)),n===4&&(e.player.fatigue=(e.player.fatigue??0)+1,h(e,"ì•„ë¬´ë ‡ì§€ ì•Šì€ ì(ì ëŒ€): 4ì¥ì§¸ ì‚¬ìš© â†’ í”¼ë¡œ +1")))}function us(e){const t=ve(e);t==="indifferent_one"&&(Number(e.usedThisTurn??0)||0)===0&&(ut(e,2),e.player.block=(e.player.block??0)+6,e._gainedBlockThisTurn=!0,Y(e,"INFO",q.indifferent_one.endTurnZero,1800),h(e,q.indifferent_one.endTurnZero),h(e,"ì•„ë¬´ë ‡ì§€ ì•Šì€ ì: 0ì¥ ì‚¬ìš© â†’ HP +2, ë°©ì–´ +6")),t==="armored_tiger"&&(e._gainedBlockThisTurn||(we(e,2,"OTHER","ì¤‘ê°‘ ì…ì€ í˜¸ë‘ì´"),Y(e,"WARN",q.armored_tiger.endTurnNoBlock,1800),h(e,q.armored_tiger.endTurnNoBlock)))}function Mn(e,t){const n=e.content.enemiesById[t],r={id:n.id,name:n.name,hp:n.maxHp,maxHp:n.maxHp,intentIndex:0,status:{vuln:0,weak:0,bleed:0,disrupt:0,slash:0},immuneThisTurn:!1,immuneNextTurn:!1,lastIntentKey:null,lastIntentStreak:0,soulWarnCount:t==="boss_soul_stealer"?0:void 0,soulArmed:t==="boss_soul_stealer"?!1:void 0,soulWillNukeThisTurn:t==="boss_soul_stealer"?!1:void 0};return br(e)===1&&(r.maxHp+=10,r.hp+=10),r}function ps(e,t,n,r=5){for(const o of t){const s=e.run.enemyLastSeenBattle?.[o];if(s!=null&&n-s<r)return!1}return!0}function pt(e,t){const n=t?.forceBoss??!1,r=e.run,o=(t?.forceElite??r.pendingElite??!1)===!0;r.pendingElite=!1,e.run.enemyLastSeenBattle??={},e.run.battleCount??=0;const s=e.run.nodePickCount??0,a=(e.run.battleCount??0)+1;if(t?.forcePatternIds&&t.forcePatternIds.length>0){const y=t.forcePatternIds;e.run.battleCount=a;for(const N of y)e.run.enemyLastSeenBattle[N]=a;e.enemies=y.map(N=>Mn(e,N)),r.lastBattleEnemyCount=e.enemies.length,e.run.lastBattleWasElite=!1,e.run.lastBattleWasBoss=!1,h(e,`ì „íˆ¬ ì‹œì‘! (ë…¸ë“œ ${s}, ì „íˆ¬ ${a}íšŒì°¨) ì : ${e.enemies.map(N=>N.name).join(", ")}`);return}if(n)if(e.run.lastBattleWasElite=!1,e.run.lastBattleWasBoss=!0,e.run.bossPool??=["boss_gravity_master","boss_cursed_wall","boss_giant_orc","boss_soul_stealer"],e.run.bossPool.length===0&&!e.run.nextBossId)h(e,`ë³´ìŠ¤ í’€ì´ ë¹„ì—ˆìŠµë‹ˆë‹¤. ì¼ë°˜ ì „íˆ¬ë¡œ ì§„í–‰í•©ë‹ˆë‹¤. (ë…¸ë“œ ${s})`);else{let y=e.run.nextBossId??null;if(y!=null){const N=e.content.enemiesById[y];e.run.bossOmenText=zo[y]??N.omen??null}y?(e.run.nextBossId=null,e.run.bossPool=e.run.bossPool.filter(N=>N!==y)):(y=fe(e.run.bossPool),e.run.bossPool=e.run.bossPool.filter(N=>N!==y)),e.enemies=[Mn(e,y)],r.lastBattleEnemyCount=e.enemies.length,e.run.ominousProphecySeen=!1,h(e,`ë³´ìŠ¤ ë“±ì¥! (ë…¸ë“œ ${s}) ì : ${e.enemies[0].name}`),e.run.battleCount=a,e.run.enemyLastSeenBattle[y]=a;return}const i=[[["goblin_raider"],["watching_statue"],["pebble_golem"],["slime"],["rat_swarm"],["supply_hound"],["goblin_assassin"]],[["goblin_commander","goblin_archer"],["supply_hound","rat_swarm"],["goblin_commander","goblin_assassin"],["goblin_raider","watching_statue"],["archive_censor"],["poison_spider"],["goblin_archer","goblin_raider"],["pebble_golem","slime"]],[["rock_golem"],["gravity_echo"],["gloved_hunter"],["debt_collector"],["archive_censor","debt_collector"],["archive_censor","slime"],["poison_spider","slime"],["old_monster_corpse","rat_swarm"],["punishing_one"]]],l=[["gravity_echo","poison_spider"],["poison_spider","poison_spider","slime"],["goblin_raider","watching_statue"],["watching_statue","watching_statue"],["poison_spider","poison_spider"],["rock_golem","gravity_echo"],["goblin_raider","goblin_raider","watching_statue"],["rat_swarm","rat_swarm","rat_swarm"],["archive_censor","debt_collector"]],c=[[["goblin_raider","watching_statue"],["supply_hound","rat_swarm"],["pebble_golem","goblin_archer"]],[["goblin_commander","goblin_archer","goblin_archer"],["archive_censor","goblin_archer","goblin_raider"],["poison_spider","poison_spider","slime"]],[["rock_golem","gravity_echo"],["archive_censor","debt_collector","supply_hound"],["punishing_one","gloved_hunter"]]],d=[["gravity_echo","gravity_echo"],["watching_statue","gravity_echo","rock_golem"],["debt_collector","supply_hound","supply_hound"]],p=Number(e.run.timeMove??0)+(e.time??0),u=Math.min(i.length-1,Math.floor(Math.max(0,p)/15)),k=o?e.run.treasureObtained?d:c[u]:e.run.treasureObtained?l:i[u],T=5,m=k.filter(y=>ps(e,y,a,T)),f=m.length>0?m:k,b=fe(f);e.run.battleCount=a;for(const y of b)e.run.enemyLastSeenBattle[y]=a;e.enemies=b.map(y=>Mn(e,y)),r.lastBattleEnemyCount=e.enemies.length,e.run.lastBattleWasElite=o,e.run.lastBattleWasBoss=!1,h(e,`ì „íˆ¬ ì‹œì‘!${o?" [ì •ì˜ˆ]":""} (ë…¸ë“œ ${s}, ì „íˆ¬ ${a}íšŒì°¨) ì : ${e.enemies.map(y=>y.name).join(", ")}`)}function fs(e){return e<0?0:e}function ms(e,t,n){const r=t.player.status?.vuln??0,o=n.status?.weak??0;return fs(e+r-o)}function hs(e,t){let n=Math.max(0,Number(t)||0);const r=[];for(const o of e){const s=Math.min(n,o);n-=s,r.push(o-s)}return r}function ft(e,t){e.push(t)}function bs(e){const t=(e.dmgTotal??0)>0||(e.hits??0)>0||(e.perHit??0)>0,n=(e.applies??[]).some(o=>o.target==="player"&&["vuln","weak","bleed","disrupt","supplies","fatigue"].includes(String(o.kind))),r=(e.applies??[]).some(o=>o.target==="enemy"&&["vuln","weak","bleed","disrupt","immune"].includes(String(o.kind)));return t&&n?"ATTACK_DEBUFF":t&&r?"ATTACK_BUFF":t?"ATTACK":n?"DEBUFF":r?"BUFF":"OTHER"}function ys(e,t,n){const r=t.usedThisTurn??0;if(e==="goblin_raider")return{raw:Math.max(0,12-r),hits:1};if(e==="watching_statue")return{raw:4+r,hits:1};if(e==="gloved_hunter")return{raw:Number(t.player.block??0)>=4?12:6,hits:1};if(e==="goblin_assassin")return{raw:8+4*Math.max(0,Number(n.assassinAim??0)||0),hits:1};if(e==="old_monster_corpse")return{raw:9+4*Math.max(0,Number(n.corpseRage??0)||0),hits:1};if(e==="punishing_one"){const o=Math.max(0,Number(t.hand?.length??0)||0);return{raw:Math.min(30,6+2*o),hits:1}}return{raw:0,hits:1}}function ks(e,t){const n=Number(t.base??0),r=Number(t.per??0),o=Math.max(1,Number(t.div??1)),s=t.cap==null?1/0:Number(t.cap),a=(e.deck?.length??0)+(e.hand?.length??0)+(e.discard?.length??0)+(e.frontSlots?.filter(Boolean).length??0)+(e.backSlots?.filter(Boolean).length??0)+(e.exhausted?.length??0),i=Math.ceil(a/o),l=n+r*i;return Math.min(s,Math.max(0,l))}function Io(e,t,n,r={}){if(n.meta?.preview){const k=n.meta.preview(e,t);if(k)return k}const o=[],s=[],a=[],i=Math.max(0,Number(t.atkRamp??0)||0);if(n.meta?.applies)for(const k of n.meta.applies)ft(o,k);for(const k of n.acts)switch(k.op){case"damagePlayer":{a.push(Math.max(0,(Number(k.n)||0)+i));break}case"damagePlayerFormula":{const{raw:T,hits:m}=ys(k.kind,e,t),f=Math.max(1,Number(m??1)||1),b=Math.max(0,(Number(T)||0)+i);for(let x=0;x<f;x++)a.push(b);break}case"statusPlayer":{ft(o,{target:"player",kind:k.key,amount:k.n});break}case"supplies":{ft(o,{target:"player",kind:"supplies",amount:k.n});break}case"fatiguePlayer":{ft(o,{target:"player",kind:"fatigue",amount:k.n});break}case"enemyHealSelf":{ft(o,{target:"enemy",kind:"heal",amount:k.n});break}case"enemyImmuneNextTurn":{ft(o,{target:"enemy",kind:"immune",amount:1});break}case"damagePlayerRampHits":{const T=Math.max(1,Number(e.combatTurn??1)),m=Math.max(1,Number(k.baseHits??1)),f=Math.max(1,Number(k.everyTurns??1));let b=m+Math.floor((T-1)/f);k.capHits!=null&&(b=Math.min(b,Math.max(1,Number(k.capHits))));const x=Math.max(0,(Number(k.n)||0)+i);for(let y=0;y<b;y++)a.push(x);break}case"damagePlayerIfSuppliesPositive":{e.player.supplies>0&&a.push(Math.max(0,(Number(k.n)||0)+i));break}case"damagePlayerIfSuppliesZero":{e.player.supplies==0&&a.push(Math.max(0,(Number(k.n)||0)+i));break}case"damagePlayerByDeckSize":{a.push(Math.max(0,ks(e,k)+i));break}}if(!a.length){const k=Math.max(0,Number(n.meta?.hits??0)||0),T=Math.max(0,Number(n.meta?.baseDmg??0)||0);if(k>0&&T>0)for(let m=0;m<k;m++)a.push(T)}let l=a.map(k=>ms(k,e,t));r.includeBlock&&l.length&&(l=hs(l,e.player.block??0));const c=l.length,d=c?l.reduce((k,T)=>k+T,0):void 0,p=c&&l.every(k=>k===l[0])?l[0]:void 0,u={cat:n.meta?.cat??"OTHER",dmgTotal:d,hits:c>0?c:n.meta?.hits,perHit:p??n.meta?.baseDmg,applies:o.length?o:void 0,notes:s.length?s:void 0};return u.cat=n.meta?.cat??bs(u),u.shortText||(u.dmgTotal!=null&&(u.hits??0)>1?u.shortText=`${u.dmgTotal} (${u.hits}íƒ€)`:u.dmgTotal!=null&&(u.shortText=`${u.dmgTotal}`)),u}const Ts={other_adventurer:new Set([1]),slime:new Set([0,1]),pebble_golem:new Set([1]),rock_golem:new Set([1]),poison_spider:new Set([0,2]),boss_cursed_wall:new Set([0]),boss_giant_orc:new Set([1])};function vs(e,t){const n=Ts[e];return!!n&&n.has(t)}function Vn(e){if(e===null)return"null";const t=typeof e;return t==="number"||t==="boolean"?String(e):t==="string"?JSON.stringify(e):Array.isArray(e)?"["+e.map(Vn).join(",")+"]":t==="object"?"{"+Object.keys(e).sort().map(r=>JSON.stringify(r)+":"+Vn(e[r])).join(",")+"}":JSON.stringify(String(e))}function Ro(e){if(!e)return"NONE";const t={};for(const n of Object.keys(e))n==="label"||n==="text"||n==="desc"||n==="name"||(t[n]=e[n]);return t.effects&&Array.isArray(t.effects)&&(t.effects=t.effects.map(n=>{const r={};for(const o of Object.keys(n??{}))o==="label"||o==="text"||o==="desc"||o==="name"||(r[o]=n[o]);return r})),Vn(t)}function xs(e,t){const n=e.lastIntentKey??null,r=e.lastIntentStreak??0;n===t?e.lastIntentStreak=Math.min(3,r+1):(e.lastIntentKey=t,e.lastIntentStreak=1)}function Cs(e,t,n,r,o){const s=e.length;if(s<=1)return 0;const a=Array.from({length:s},(u,k)=>k),i=u=>u===t&&vs(n,u),l=u=>!!r&&o>=2&&Ro(e[u])===r,c=a.filter(u=>!i(u)&&!l(u));if(c.length>0)return fe(c);const d=a.filter(u=>!l(u));if(d.length>0)return fe(d);const p=a.filter(u=>!i(u));return p.length>0?fe(p):fe(a)}const gs=2,ws=.6;function yr(e){if(!e.intentsRevealedThisTurn){e.intentsRevealedThisTurn=!0,e.attackedEnemyIndicesThisTurn=[],e.backUidsThisTurn=[],e.placedUidsThisTurn=[],e.drawCountThisTurn=0,e.phase="REVEAL",e.player.immuneToDisruptThisTurn=!1,e.player.nullifyDamageThisTurn=!1,e.disruptIndexThisTurn=null;{const t=Math.max(1,e.backSlots?.length??3);e.backSlotDisabled=Array.from({length:t},()=>!1);const n=e.run,r=Number(n.slotCapBack??3),o=Math.max(3,Math.min(4,Math.floor(r)));(e.player.status.disrupt??0)>0&&(e.disruptIndexThisTurn=Math.floor(Math.random()*o),e.backSlotDisabled[e.disruptIndexThisTurn]=!0)}for(const t of e.enemies)t.immuneThisTurn=t.immuneNextTurn,t.immuneNextTurn=!1;for(const t of ie(e)){t.intentLabelOverride=void 0;const r=e.content.enemiesById[t.id].intents;if(!r||r.length===0)continue;const o=Cs(r,t.intentIndex??0,t.id,t.lastIntentKey??null,t.lastIntentStreak??0);t.intentIndex=o;const s=r[o%r.length];if(xs(t,Ro(s)),t.id==="boss_soul_stealer"){t.soulWillNukeThisTurn=!1;const d=t.soulWarnCount??0;if(!!t.soulArmed){if(Math.random()<ws){t.soulWillNukeThisTurn=!0,t.intentLabelOverride="ì¢…ë§: 50 í”¼í•´",h(e,`ì  ì˜ë„: ${t.name} â†’ ${t.intentLabelOverride}`);continue}const k=r[t.intentIndex%r.length];t.intentLabelOverride=`${k.label} (í­ë°œ ê°€ëŠ¥ ìƒíƒœ)`,h(e,`ì  ì˜ë„: ${t.name} â†’ ${t.intentLabelOverride}`);continue}const u=r[t.intentIndex%r.length];t.intentLabelOverride=`${u.label} (ê²½ê³  ${d}/3)`,h(e,`ì  ì˜ë„: ${t.name} â†’ ${t.intentLabelOverride}`);continue}const a=r[t.intentIndex%r.length],i=Io(e,t,a);let l="";i.dmgTotal!=null?l=(i.hits??1)>1?` (${i.dmgTotal}, ${i.hits}íƒ€)`:` (${i.dmgTotal})`:(i.hits??0)>1&&(l=` (${i.hits}íƒ€)`);const c=`${a.label}${l}`;t.intentLabelOverride=c,h(e,`ì  ì˜ë„: ${t.name} â†’ ${c}`)}e.disruptIndexThisTurn!==null&&h(e,`êµë€: ì´ë²ˆ í„´ í›„ì—´ ${e.disruptIndexThisTurn} ë¬´íš¨`),zt(e,"onReveal"),e.phase="PLACE"}}const Es=gs;function _s(e,t,n){const r=e.cards[t];return r?r.zone===n:!1}function Ss(e){const t="_flipAllCombatOriginal";e[t]||(e[t]={});const n=e[t];for(const[r,o]of Object.entries(e.cards))o&&o.zone!=="vanished"&&(n[r]===void 0&&(n[r]=!!o.flipped),o.flipped=!n[r])}function Pn(e,t,n){const r=e.game,o={kind:"damageSelect",amount:t,formulaKind:n,aliveCountSnap:ie(r).length,sourceCardUid:e.cardUid||void 0,sourceLabel:e.sourceLabel,reason:e.reason??(e.side==="front"?"FRONT":"BACK")};r.pendingTargetQueue??=[],r.pendingTarget==null?r.pendingTarget=o:r.pendingTargetQueue.push(o),h(r,`ëŒ€ìƒ ì„ íƒ í•„ìš”: ì ì„ í´ë¦­í•˜ì„¸ìš”. (${1+r.pendingTargetQueue.length}ê°œ ë‚¨ìŒ)`)}function Ns(e,t,n){const r=e.game,o={kind:"statusSelect",key:t,n,sourceCardUid:e.cardUid||void 0,sourceLabel:e.sourceLabel,reason:e.reason??(e.side==="front"?"FRONT":"BACK")};r.pendingTargetQueue??=[],r.pendingTarget==null?r.pendingTarget=o:r.pendingTargetQueue.push(o),h(r,"ëŒ€ìƒ ì„ íƒ í•„ìš”: ì ì„ í´ë¦­í•˜ì„¸ìš”.")}function As(e,t){if(t.id==="boss_soul_stealer"&&t.soulWillNukeThisTurn)return!0;const n=e.content.enemiesById[t.id];return n.intents[t.intentIndex%n.intents.length].acts.some(o=>o.op==="damagePlayer"||o.op==="damagePlayerFormula"||o.op==="damagePlayerByDeckSize")}function ln(e){const t=e.game;if((Number(t.usedThisTurn??0)||0)!==1)return!1;const r=(t.placedUidsThisTurn??[]).filter(Boolean);return r.length!==1?!1:r[0]===e.cardUid}function $s(e,t,n=""){for(let r=0;r<e.frontSlots.length;r++)e.frontSlots[r]===t&&(e.frontSlots[r]=null);for(let r=0;r<e.backSlots.length;r++)e.backSlots[r]===t&&(e.backSlots[r]=null);e.hand=e.hand.filter(r=>r!==t),e.deck=e.deck.filter(r=>r!==t),e.discard=e.discard.filter(r=>r!==t),e.exhausted=e.exhausted.filter(r=>r!==t),e.vanished=e.vanished.filter(r=>r!==t),e.exhausted.push(t),e.cards[t].zone="exhausted",h(e,`[${Ke(e,t)}] ì†Œëª¨(ê°•ì œ)${n?" â€” "+n:""}`)}function Ms(e,t){switch(t){case"prey_mark":return 10;case"prey_mark_u1":return 12;case"triple_bounty":return 10;case"triple_bounty_u1":return 10;case"hand_blade":return 4+2*e.game.hand.length;case"hand_blade_u1":return 6+2*e.game.hand.length;case"lone_blow_20":return ln(e)?20:0;case"lone_blow_26":return ln(e)?26:0;case"castle_ballista_age":{const n=e.cardUid??"",r=(e.game.installAgeByUid?.[n]??0)|0;return 1+Math.max(0,r)}case"castle_ballista_age_u1":{const n=e.cardUid??"",r=(e.game.installAgeByUid?.[n]??0)|0;return 2+Math.max(0,r)}default:return 0}}function Ps(e,t){const n=e.game,r=Object.values(n.cards).filter(o=>o.zone==="hand"&&o.uid!==e.cardUid).length;switch(t){case"hand_blade_back":{const o=1*r;return Math.min(6,o)}case"hand_blade_back_u1":return 1*r;case"lone_blow_block_10":return ln(e)?10:0;case"lone_blow_block_14":return ln(e)?14:0;default:return 0}}function Br(e,t,n,r,o){switch(t){case"prey_mark":return n.hp>e.player.hp?r+5:r;case"prey_mark_u1":return n.hp>e.player.hp?r+6:r;case"triple_bounty":return(o??ie(e).length)>=3?r+6:r;case"triple_bounty_u1":return(o??ie(e).length)>=3?r+10:r;default:return r}}function Be(e,t){const n=e.game,r=(()=>{try{const a=Ee(n,e.cardUid);if(!a?.tags?.includes("INSTALL"))return!1;const i=a.installWhen;return!i||i==="BOTH"?!0:i==="FRONT"?e.side==="front":i==="BACK"?e.side==="back":!1}catch{return!1}})(),o=(a,i)=>{const l="_playerDamageFromInstall",c=n[l];n[l]=r;try{Tr(n,a,i)}finally{n[l]=c}},s=gn(n,"relic_wrong_dice")?1:0;for(const a of t)switch(a.op){case"block":cn(n,a.n+s);break;case"blockFormula":{const i=Ps(e,a.kind);i>0&&cn(n,i);break}case"supplies":Uo(n,a.n+s);break;case"fatigue":ct(n,a.n+s);break;case"heal":ut(n,a.n+s);break;case"hp":n.player.hp=Math.max(0,Math.min(n.player.maxHp,n.player.hp+a.n)),h(n,`HP ${a.n>=0?"+":""}${a.n} (í˜„ì¬ ${n.player.hp}/${n.player.maxHp})`);break;case"maxHp":n.player.maxHp+=a.n,n.player.hp=Math.min(n.player.maxHp,n.player.hp+a.n+s),h(n,`ìµœëŒ€ HP +${a.n} (í˜„ì¬ ${n.player.hp}/${n.player.maxHp})`);break;case"setSupplies":n.player.supplies=Math.max(0,a.n),h(n,`ë³´ê¸‰ Së¥¼ ${n.player.supplies}ìœ¼ë¡œ ì„¤ì •`);break;case"draw":{const i=Dt(n,a.n+s);n.drawCountThisTurn+=i;break}case"discardHandAllDraw":{const i=Number(a.extraDraw??0)||0,l=n.hand.slice();if(l.length>0){n.hand=[];for(const d of l)n.discard.push(d),n.cards[d].zone="discard";h(n,`ì†íŒ¨ ${l.length}ì¥ ë²„ë¦¼`)}else h(n,"ì†íŒ¨ ë²„ë¦¼: 0ì¥");const c=l.length+i;if(c>0){const d=Dt(n,c);n.drawCountThisTurn+=d}break}case"discardHandRandom":{let i=(Number(a.n??0)||0)+s;if(i=Math.max(0,Math.min(i,n.hand.length)),i<=0){h(n,"ì†íŒ¨ ë¬´ì‘ìœ„ ë²„ë¦¼: 0ì¥");break}const l=n.hand.slice(),c=[];for(let d=0;d<i;d++){const p=fe(l),u=l.indexOf(p);u>=0&&l.splice(u,1),c.push(p)}n.hand=n.hand.filter(d=>!c.includes(d));for(const d of c)n.discard.push(d),n.cards[d].zone="discard";h(n,`ì†íŒ¨ ë¬´ì‘ìœ„ ë²„ë¦¼: ${c.length}ì¥`);break}case"ifPlaced":{_s(n,e.cardUid,a.side)&&Be(e,a.then);break}case"flipAllPlayerCardsUntilCombatEnd":{Ss(n);break}case"pickVanishedToHand":{const i=n.vanished.map(l=>{const c=Ee(n,l);return{key:`pickVanished:${l}`,label:Ke(n,l),detail:`ì „ì—´: ${c.frontText} / í›„ì—´: ${c.backText}`,cardUid:l}});jt(n,{kind:"PICK_CARD",title:a.title??"ì†Œì‹¤ ì¹´ë“œ íšŒìˆ˜",prompt:a.prompt??"ê°€ì ¸ì˜¬ ì†Œì‹¤ ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",options:[...i,{key:"cancel",label:"ì·¨ì†Œ"}]},{kind:"PICK_VANISHED_TO_HAND",sourceCardUid:e.cardUid});break}case"ifDrewThisTurn":{n.drawCountThisTurn>0&&Be(e,a.then);break}case"damageEnemy":if(a.target==="random"){const i=ie(n);if(i.length===0)break;o(fe(i),a.n+s)}else if(a.target==="all")for(const i of ie(n))o(i,a.n+s);else Pn(e,a.n+s);break;case"halveEnemyHpAtIndex":{const i=(a.index??-1)|0,l=n.enemies[i];if(!l||l.hp<=0)break;const c=l.hp,d=Math.max(1,Math.floor(c/2));if(d>=c)break;l.hp=d,h(n,`ì (${l.name})ì˜ HPë¥¼ ì ˆë°˜ìœ¼ë¡œ: ${c} â†’ ${d}`);break}case"clearStatusSelf":{const i=a.key;n.player.status[i]=0,h(n,`ìƒíƒœ í•´ì œ: ${i} = 0`);break}case"damageEnemyBy":{if(a.target!=="random")break;const i=ie(n);if(i.length===0)break;let l=0;a.by==="frontCount"&&(l=n.frontSlots.filter(Boolean).length*a.nPer),o(fe(i),l);break}case"damageEnemyByPlayerFatigue":{const i=Math.max(0,Math.floor(n.player.fatigue*a.mult));if(a.target==="random"){const l=ie(n);if(l.length===0)break;o(fe(l),i);break}if(a.target==="select"){if(i<=0)break;Pn(e,i);break}break}case"damageEnemyFormula":{const i=Ms(e,a.kind);if(i<=0)break;if(a.target==="select"){Pn(e,i,a.kind);break}if(a.target==="random"){const l=ie(n);if(l.length===0)break;const c=fe(l),d=Br(n,a.kind,c,i,l.length);o(c,d);break}if(a.target==="all"){const l=ie(n),c=l.length;for(const d of l){const p=Br(n,a.kind,d,i,c);o(d,p)}break}break}case"statusPlayer":n.player.status[a.key]=Math.max(0,(n.player.status[a.key]??0)+a.n+s),h(n,`í”Œë ˆì´ì–´ ìƒíƒœ: ${a.key} ${a.n>=0?"+":""}${a.n}`);break;case"statusEnemy":if(a.target==="random"){const i=ie(n);if(i.length===0)break;const l=fe(i);if(Se(l,a.key,a.n+s,n,"PLAYER"),h(n,`ì (${l.name}) ìƒíƒœ: ${a.key} ${a.n>=0?"+":""}${a.n}`),a.key==="bleed"&&a.n>0){const c=_e(n);c.bleedApplied+=1,Ae(n)}}else if(a.target==="all"){const i=ie(n);if(i.length===0)break;for(const l of i)Se(l,a.key,a.n+s,n,"PLAYER");if(h(n,`ëª¨ë“  ì  ìƒíƒœ: ${a.key} ${a.n>=0?"+":""}${a.n}`),a.key==="bleed"&&a.n>0){const l=_e(n);l.bleedApplied+=i.length,Ae(n)}}else Ns(e,a.key,a.n+s);break;case"statusEnemiesAttackingThisTurn":{const i=ie(n).filter(l=>As(n,l));if(i.length===0){h(n,`ì´ë²ˆ í„´ ê³µê²© ì˜ë„ ì  ì—†ìŒ â†’ ${a.key} ì ìš© ì—†ìŒ`);break}for(const l of i)l.status[a.key]=Math.max(0,(l.status[a.key]??0)+a.n);h(n,`ê³µê²© ì˜ë„ ì ì—ê²Œ ${a.key} ${a.n>=0?"+":""}${a.n} (ëŒ€ìƒ ${i.length})`);break}case"immuneDisruptThisTurn":n.player.immuneToDisruptThisTurn=!0,h(n,"ì´ë²ˆ í„´ êµë€ ë¬´ì‹œ");break;case"nullifyDamageThisTurn":n.player.nullifyDamageThisTurn=!0,h(n,"ì´ë²ˆ í„´ ì  ê³µê²© í”¼í•´ ë¬´íš¨");break;case"triggerFrontOfBackSlot":{const i=n.backSlots[a.index];if(!i){h(n,`ì¬ë°°ì¹˜: í›„ì—´ ${a.index+1}ë²ˆ ìŠ¬ë¡¯ì´ ë¹„ì–´ ìˆìŒ`);break}const l=Ee(n,i),d=!!n.cards[i]?.flipped,p=d?l.back:l.front;h(n,`ì¬ë°°ì¹˜: [[${Ke(n,i)}]]ì˜ ì „ì—´ íš¨ê³¼ë¥¼ ì¶”ê°€ ë°œë™${d?"(ë’¤ì§‘í˜)":""}`),Be({game:n,side:"front",cardUid:i},p);break}case"addCardToHand":{const i=a.defId,l=n.content.cardsById[i];if(!l){h(n,`WARN: addCardToHand unknown defId: ${i}`);break}const c=Math.max(1,Number(a.n??1)|0),d=Math.max(0,Number(a.upgrade??0)|0);for(let p=0;p<c;p++){n.uidSeq+=1;const u=String(n.uidSeq);n.cards[u]={uid:u,defId:i,zone:"hand",upgrade:d},n.hand.push(u)}h(n,`ì†íŒ¨ì— [${l.name}${d>0?" +"+d:""}] ${c}ì¥ ì¶”ê°€`);break}case"repeat":{const i=Math.max(0,(a.times??0)|0)+s;for(let l=0;l<i;l++)Be(e,a.effects??[]);break}case"ifPlacedThisTurn":{(n.placedUidsThisTurn??[]).includes(e.cardUid)&&Be(e,a.then??[]);break}case"ifOtherRowHasDefId":{const i=String(a.defId??"");(e.side==="front"?n.backSlots:n.frontSlots).some(d=>d?n.cards[d]?.defId===i:!1)&&Be(e,a.then??[]);break}case"triggerRandomVanished":{const i=Math.max(0,(a.times??0)|0)+s,l=(n.vanished??[]).filter(c=>c&&c!==e.cardUid);if(l.length===0){h(n,"ì†Œì‹¤ëœ ì¹´ë“œê°€ ì—†ì–´ ë°œë™ ì—†ìŒ");break}for(let c=0;c<i;c++){const d=fe(l,"triggerRandomVanished"),p=Ee(n,d);h(n,`ì†Œì‹¤ëœ ì¹´ë“œ ë°œë™: [[${Ke(n,d)}]] (${a.side==="front"?"ì „ì—´":"í›„ì—´"})`),Be({game:n,side:a.side,cardUid:d},a.side==="front"?p.front:p.back)}break}case"exhaustSlot":{const i=a.side,l=(a.index??-1)|0,c=i==="front"?n.frontSlots:n.backSlots,d=c[l];if(!d){h(n,`ì†Œëª¨ ì‹¤íŒ¨: ${i}${l+1}ë²ˆ ìŠ¬ë¡¯ì´ ë¹„ì–´ ìˆìŒ`);break}$s(n,d,`${i}${l+1} ìŠ¬ë¡¯`),c[l]=null,a.then&&Be(e,a.then);break}case"flipSelf":{const i=n.cards[e.cardUid];i&&(i.flipped=!i.flipped,h(n,`ë’¤ì§‘ìŒ: [[${Ke(n,e.cardUid)}]] (${i.flipped?"ON":"OFF"})`));break}case"damageEnemyLowestHp":{const i=ie(n);if(i.length===0)break;let l=1/0;for(const p of i)l=Math.min(l,p.hp);const c=i.filter(p=>p.hp===l),d=fe(c,"damageEnemyLowestHp");o(d,Math.max(0,(a.n??0)+s));break}case"damageEnemyRepeatByStatus":{const l=1+Math.max(0,n.player.status[a.key]??0)+s,c=ie(n);if(c.length===0)break;const d=Math.max(0,(a.n??0)+s);for(let p=0;p<l;p++)o(fe(c),d);a.reset&&(n.player.status[a.key]=0,h(n,`ìƒíƒœ ì†Œëª¨: ${String(a.key)} = 0`));break}default:return a}}function Is(e){const t=new Set(e.run.relics??[]);return Object.keys(ke).filter(n=>{const r=ke[n];return!(!r||r.debugOnly||(Array.isArray(r.tags)?r.tags:[]).includes("EVENT_ONLY")||t.has(n))})}function Lo(e,t=1){const n=Is(e);if(n.length===0)return null;const r=[],o=n.slice(),s=Math.min(t,o.length);for(let a=0;a<s;a++){const i=fe(o),l=o.indexOf(i);l>=0&&o.splice(l,1);const c=ke[i]??{};r.push({id:i,name:c.name??String(i),desc:c.desc??c.description??c.text,art:c.art})}return{choices:r}}const Bo=2;function St(e){const t=e.run;t.items||(t.items=[]),t.itemCap==null&&(t.itemCap=Bo)}function Rs(e){return St(e),e.run.items??[]}function kr(e){St(e);const t=Number(e.run.itemCap);return Number.isFinite(t)?Math.max(0,Math.floor(t)):Bo}function Hr(e){return Rs(e).length>=kr(e)}function Gn(e,t,n=""){St(e);const r=He(t);if(!r)return h(e,`ì•„ì´í…œ íšë“ ì‹¤íŒ¨(ì •ì˜ ì—†ìŒ): ${t}`),!1;const o=kr(e),s=e.run.items;return s.length>=o?(h(e,`ì•„ì´í…œ íšë“ ì‹¤íŒ¨(ê°€ë°© ê°€ë“ ì°¸ ${s.length}/${o}): ${r.name}`),Y(e,"WARN",`ì•„ì´í…œ ê°€ë°©ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤. (${s.length}/${o})`,1600),!1):(s.push(t),h(e,`ì•„ì´í…œ íšë“${n?`(${n})`:""}: ${r.name}`),Y(e,"INFO",`${r.name} íšë“`,1600),!0)}function Ho(e,t){St(e);const n=e.run.items;if(!Array.isArray(n)||t<0||t>=n.length)return null;const[r]=n.splice(t,1);return r??null}function Ls(e,t,n=""){St(e);const r=e.run.items;if(!Array.isArray(r)||r.length===0||t<0||t>=r.length)return!1;const o=String(r[t]),s=He(o);return Ho(e,t),h(e,`ì•„ì´í…œ ë²„ë¦¼${n?`(${n})`:""}: ${s?.name??o}`),Y(e,"WARN",`${s?.name??o} ë²„ë¦¼`,1400),!0}function Bs(e,t){St(e);const n=e.run.items;if(!Array.isArray(n)||n.length===0||t<0||t>=n.length)return!1;if(!(e.enemies.length>0&&e.phase!=="NODE"))return Y(e,"WARN","ì „íˆ¬ ì¤‘ì—ë§Œ ì•„ì´í…œì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",1400),!1;const o=n[t],s=He(o);return s?(Be({game:e,side:"front",cardUid:"",sourceLabel:`ì•„ì´í…œ: ${s.name}`,reason:"OTHER"},s.effects??[]),Ho(e,t)&&(h(e,`ì•„ì´í…œ ì‚¬ìš©: ${s.name} (ì†Œëª¨)`),Y(e,"INFO",`${s.name} ì‚¬ìš©`,1400)),!0):(Y(e,"WARN",`ì•„ì´í…œ ì •ì˜ ì—†ìŒ: ${o}`,1400),!1)}function Hs(e,t){const n=e.run;if(n.itemOfferedThisBattle||t.boss)return null;const r=t.elite?.4:.3;if(Math.random()>=r)return null;const o=wa();return o?(n.itemOfferedThisBattle=!0,o):null}function Os(e,t){const n=e.run.lastBattleWasBoss?"BOSS":e.run.lastBattleWasElite?"ELITE":"BATTLE",r=ss(e),o=Fa(e,n,r);if(!o||o.length===0)return;ve(e)==="first_human"?(Y(e,"INFO",q.first_human.reward,1800),h(e,q.first_human.reward)):Ce(e,"first_human")&&(Y(e,"WARN",q.first_human.hostileReward,1800),h(e,q.first_human.hostileReward));const s=o.map(c=>{const d=xe(e.content,c.defId,c.upgrade),p=`${d.name}${c.upgrade>0?` +${c.upgrade}`:""}`;return{key:`pick:${c.defId}:${c.upgrade}`,label:p,detail:`ì „ì—´: ${d.frontText} / í›„ì—´: ${d.backText}`}});s.push({key:"skip",label:"ìƒëµ",detail:""});const a={kind:"REWARD",title:"ì „íˆ¬ ë³´ìƒ",prompt:"ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ê±°ë‚˜ ìƒëµí•©ë‹ˆë‹¤.",options:s},i=t?.itemOfferId,l=t?.itemSource??"BATTLE";jt(e,a,{kind:"BATTLE_REWARD",offers:o,itemOfferId:i,itemSource:l,cardDecision:void 0,itemDecision:void 0})}function Ds(e){if(!e.run.lastBattleWasElite||e.run.eliteRelicOfferedThisBattle)return;const t=Lo(e,1);if(!t)return;e.run.eliteRelicOfferedThisBattle=!0;const n=t.choices[0];if(!n)return;const r=n.id,o=ke[r],s=!!o?.unlock,a=s?o?.dormantName??o?.name??r:o?.name??r,i=s?[o?.dormantText,o?.unlockHint].filter(Boolean).join(`
 
`):o?.text??"",c={kind:"REWARD",title:"ì •ì˜ˆ ë³´ìƒ: ìœ ë¬¼",prompt:"ìœ ë¬¼ì„ ë°›ê±°ë‚˜ ìƒëµí•©ë‹ˆë‹¤.",options:[{key:"take",label:"ë°›ê¸°",detail:`${a}

${i}`},{key:"skip",label:"ìƒëµ",detail:""}]};c.art=o?.art??void 0,jt(e,c,{kind:"ELITE_RELIC",offerIds:[r]})}function Fs(e,t){if(!e.choice)return!1;{const r=e.choiceCtx;if(r?.kind==="BATTLE_REWARD"||r?.kind==="BATTLE_CARD_REWARD"){const o=String(r.itemOfferId??"");if(t==="take_item")return!o||r.itemDecision||!Gn(e,o,String(r.itemSource??"BATTLE"))||(r.itemDecision="TAKEN",r.cardDecision&&$e(e)),!0;if(t==="skip_item")return!o||r.itemDecision||(h(e,"ì•„ì´í…œ ë³´ìƒì„ ìƒëµí–ˆìŠµë‹ˆë‹¤."),r.itemDecision="SKIPPED",r.cardDecision&&$e(e)),!0}}if(t==="take"){const r=e.choiceCtx;if(r?.kind==="ELITE_RELIC"){const o=r.offerIds?.[0];return o?(e.run.relics??=[],e.run.relics.includes(o)||rn(e,o),h(e,`ìœ ë¬¼ íšë“: ${ke[o]?.name??o}`),$e(e),!0):!1}if(r?.kind==="ITEM_REWARD"){const o=String(r.offerId??"");return o?(Gn(e,o,String(r.source??"BATTLE"))&&$e(e),!0):!1}return!1}if(t==="skip"){const r=e.choiceCtx,o=r?.kind==="BATTLE_REWARD"||r?.kind==="BATTLE_CARD_REWARD",s=String(r?.itemOfferId??"");return o&&s?(r.cardDecision||(h(e,"ì¹´ë“œ ë³´ìƒì„ ìƒëµí–ˆìŠµë‹ˆë‹¤."),r.cardDecision="SKIPPED",r.itemDecision&&$e(e)),!0):(h(e,"ë³´ìƒì„ ìƒëµí–ˆìŠµë‹ˆë‹¤."),$e(e),!0)}if(t.startsWith("pick:")){const r=t.split(":"),o=r[1]??"",s=Number(r[2]??0);if(!o)return!1;const a=e.choiceCtx,i=a?.kind==="BATTLE_REWARD"||a?.kind==="BATTLE_CARD_REWARD",l=String(a?.itemOfferId??"");return i&&l?(a.cardDecision||(dt(e,o,{upgrade:Number.isFinite(s)?s:0}),h(e,"ì¹´ë“œ íšë“: "+o+(s>0?" +"+s:"")),a.cardDecision=t,a.itemDecision&&$e(e)),!0):(dt(e,o,{upgrade:Number.isFinite(s)?s:0}),h(e,"ì¹´ë“œ íšë“: "+o+(s>0?" +"+s:"")),$e(e),!0)}if(t.startsWith("up:")){const r=t.slice(3);if(!r)return!1;const o=e.cards[r];if(!o)return!1;const a=e.content.cardsById[o.defId]?.upgrades??[],i=o.upgrade??0;if(i>=a.length)return h(e,"ì´ë¯¸ ìµœëŒ€ ê°•í™”ì…ë‹ˆë‹¤."),$e(e),!0;o.upgrade=i+1;const l=xe(e.content,o.defId,o.upgrade);return h(e,`ì¹´ë“œ ê°•í™”: ${l.name} +${o.upgrade}`),$e(e),!0}if(t.startsWith("remove:")){const r=t.slice(7);return!r||!Bt(e,r)?!1:($e(e),!0)}if(t.startsWith("relic:")){const r=t.slice(6);if(!r)return!1;const o=e.choiceCtx?.offerIds;return o&&o.length>0&&!o.includes(r)?!1:(e.run.relics??=[],e.run.relics.includes(r)||rn(e,r),h(e,`ìœ ë¬¼ íšë“: ${ke[r]?.name??r}`),$e(e),!0)}if(t.startsWith("slot:")){if(e.choiceCtx?.kind!=="BOSS_SLOT_UPGRADE")return!1;const o=t.slice(5),s=e.run;return s.slotCapFront=Math.max(3,Math.min(4,Math.floor(Number(s.slotCapFront??3)))),s.slotCapBack=Math.max(3,Math.min(4,Math.floor(Number(s.slotCapBack??3)))),o==="front"?(s.slotCapFront<4&&(s.slotCapFront+=1),s.bossSlotFirstPick="front",Y(e,"INFO","ë³´ìŠ¤ ë³´ìƒ: ì „ì—´ ìŠ¬ë¡¯ +1",2e3),h(e,"ë³´ìŠ¤ ë³´ìƒ: ì „ì—´ ìŠ¬ë¡¯ +1"),$e(e),!0):o==="back"?(s.slotCapBack<4&&(s.slotCapBack+=1),s.bossSlotFirstPick="back",Y(e,"INFO","ë³´ìŠ¤ ë³´ìƒ: í›„ì—´ ìŠ¬ë¡¯ +1",2e3),h(e,"ë³´ìŠ¤ ë³´ìƒ: í›„ì—´ ìŠ¬ë¡¯ +1"),$e(e),!0):!1}return!1}function Ws(e,t){const n=Lo(e,t.count);if(!n||n.choices.length===0)return null;const r=n.choices.map(a=>a.id),o=n.choices.map(a=>{const i=ke[a.id],l=!!i?.unlock,c=l?i?.dormantName??i?.name??a.id:i?.name??a.id,d=l?[i?.dormantText,i?.unlockHint].filter(Boolean).join(`
 
`):i?.text??"";return{key:`relic:${a.id}`,label:c,detail:`${c}

${d}`}}),s={kind:"REWARD",title:t.title,prompt:t.prompt,options:o};{const a=String(t.artKeyOrPath),i=a.includes("/")||a.includes("\\")||a.includes(".")?a:`assets/ui/${a}.png`;s.art=i}return jt(e,s,{kind:"RELIC_OFFER",offerIds:r,source:t.source}),r}function Us(e){const t=e.run,n=Math.max(3,Math.min(4,Math.floor(Number(t.slotCapFront??3)))),r=Math.max(3,Math.min(4,Math.floor(Number(t.slotCapBack??3))));if(n>=4&&r>=4)return;jt(e,{kind:"REWARD",title:"ë³´ìŠ¤ ë³´ìƒ: ì§„í˜• í™•ì¥",prompt:"ì „ì—´ ë˜ëŠ” í›„ì—´ ìŠ¬ë¡¯ì„ 1ì¹¸ í™•ì¥í•©ë‹ˆë‹¤.",options:[{key:"slot:front",label:"ì „ì—´ ìŠ¬ë¡¯ +1",detail:"ì „ì—´ ìŠ¬ë¡¯ì´ 1ì¹¸ ì¦ê°€í•©ë‹ˆë‹¤. (ìµœëŒ€ 4) ì „ì—´ì€ ìœ ì§€ë¹„(S)ë¥¼ ì†Œëª¨í•©ë‹ˆë‹¤."},{key:"slot:back",label:"í›„ì—´ ìŠ¬ë¡¯ +1",detail:"í›„ì—´ ìŠ¬ë¡¯ì´ 1ì¹¸ ì¦ê°€í•©ë‹ˆë‹¤. (ìµœëŒ€ 4) í›„ì—´ì€ êµë€(disrupt)ì˜ ì˜í–¥ì„ ë°›ìŠµë‹ˆë‹¤."}]},{kind:"BOSS_SLOT_UPGRADE"})}function Ks(e){return Ws(e,{count:3,title:"ë³´ìŠ¤ ë³´ìƒ: ìœ ë¬¼",prompt:"ìœ ë¬¼ 1ê°œë¥¼ ì„ íƒí•©ë‹ˆë‹¤.",source:"BOSS",artKeyOrPath:"what_to_do"})}const Or=(e,t)=>e+Math.floor(Math.random()*(t-e+1)),zs=e=>{switch(e){case"SPECIAL":return 20;case"RARE":return 30;default:return 10}};function js(e,t){const n=e.run;n.shops??={};const r=n.shops[t];if(r)return r;const o=ot.filter(u=>(u.weight??0)>0).map(u=>u.id),s=(o.length>0?o:Object.keys(e.content.cardsById)).filter(u=>{const T=e.content.cardsById[u]?.rarity??"COMMON";return T!=="BASIC"&&T!=="MADNESS"}),a=[],i=6;let l=0;for(;a.length<i&&l++<200;){const u=s[Math.floor(Math.random()*s.length)];u&&(a.includes(u)&&Math.random()<.8||a.push(u))}const c=a.map(u=>{const T=e.content.cardsById[u]?.rarity??"COMMON",m=Math.max(1,zs(T)+Or(-2,2));return{defId:u,upgrade:0,priceGold:m,sold:!1}}),d=(()=>{const u=It.map(f=>f.id),k=2,T=[];let m=0;for(;T.length<k&&m++<80&&u.length>0;){const f=u[Math.floor(Math.random()*u.length)];f&&(T.includes(f)&&Math.random()<.85||T.push(f))}return T.map(f=>{const b=He(f),x=Number(b?.priceGold??18)||18,y=Math.max(1,x+Or(-2,2));return{itemId:f,priceGold:y,sold:!1}})})(),p={nodeId:t,cards:c,items:d,usedUpgrade:!1,usedRemove:!1,createdAtMove:Number(e.run.timeMove??0)||0,art:"assets/ui/background/shop_bg.png"};return n.shops[t]=p,p}function se(e,t){const n=js(e,t);ve(e)==="first_human"&&!n._firstHumanShopToastShown&&(n._firstHumanShopToastShown=!0,Y(e,"WARN",q.first_human.shop,2200),h(e,q.first_human.shop)),Ce(e,"card_dealer")&&!n._cardDealerHostileShopToastShown&&(n._cardDealerHostileShopToastShown=!0,Y(e,"WARN",q.card_dealer.hostileShop,2200),h(e,q.card_dealer.hostileShop));const r=[];let o=0;for(let p=0;p<n.cards.length;p++){const u=n.cards[p],T=e.content.cardsById[u.defId]?.name??u.defId,m=(u.upgrade??0)>0?` +${u.upgrade}`:"";if(u.sold){r.push({key:`shop:card:${p}`,label:`${T}${m} (í’ˆì ˆ)`,detail:""});continue}const f=We(e,u.priceGold),b=xe(e.content,u.defId,u.upgrade??0),x=`ê°€ê²©: ğŸª™${f}

ì „ì—´: ${b.frontText}
í›„ì—´: ${b.backText}`;r.push({key:`shop:card:${p}`,label:`${T}${m} (ğŸª™${f})`,detail:x})}if(r.push({key:`shop:sep:${o++}`,label:"â€”",detail:""}),n.items&&n.items.length>0){for(let p=0;p<n.items.length;p++){const u=n.items[p],k=He(u.itemId),T=k?.name??u.itemId;if(u.sold){r.push({key:`shop:item:${p}`,label:`${T} (í’ˆì ˆ)`,detail:""});continue}const m=We(e,u.priceGold),f=`ê°€ê²©: ğŸª™${m}

${k?.text??""}`;r.push({key:`shop:item:${p}`,label:`${T} (ğŸª™${m})`,detail:f})}r.push({key:`shop:sep:${o++}`,label:"â€”",detail:""})}const s=n.usedUpgrade?"ì¹´ë“œ ê°•í™” (ì‚¬ìš© ì™„ë£Œ)":"ì¹´ë“œ ê°•í™”",a=n.usedRemove?"ì¹´ë“œ ì œê±° (ì‚¬ìš© ì™„ë£Œ)":"ì¹´ë“œ ì œê±°",i=We(e,25),l=We(e,25),c=We(e,6);r.push({key:"shop:service:upgrade",label:s,detail:n.usedUpgrade?"":`ê°€ê²©: ğŸª™${i} ì¹´ë“œ 1ì¥ì„ ê°•í™”í•©ë‹ˆë‹¤.`}),r.push({key:"shop:service:remove",label:a,detail:n.usedRemove?"":`ê°€ê²©: ğŸª™${l} ë±ì—ì„œ ì¹´ë“œ 1ì¥ì„ ì œê±°í•©ë‹ˆë‹¤.`}),r.push({key:"shop:supply:buy",label:"ë³´ê¸‰ êµ¬ë§¤",detail:`-ğŸª™${c}, ë‹¤ìŒ ì „íˆ¬ ë³´ê¸‰ ğŸ +3`}),r.push({key:"shop:supply:sell",label:"ë³´ê¸‰ íŒë§¤",detail:"ë‹¤ìŒ ì „íˆ¬ ë³´ê¸‰ ğŸ -3, +ğŸª™4"}),r.push({key:"shop:leave",label:"ë‚˜ê°€ê¸°",detail:""});{const p=new Set,u=[];for(const k of r)p.has(k.key)&&u.push(k.key),p.add(k.key);u.length&&h(e,`ê²½ê³ : ìƒì  ì„ íƒí‚¤ ì¤‘ë³µ: ${u.join(", ")}`)}const d={kind:"EVENT",title:"ê³ ë¸”ë¦°ì˜ ìƒì ",prompt:"ì˜¨ê±´íŒŒ ê³ ë¸”ë¦°ì˜ ìƒì ì…ë‹ˆë‹¤.",options:r};n.art&&(d.art=n.art),e.choiceQueue=[],e.choiceStack=[],e.choice=d,e.choiceCtx={kind:"SHOP",nodeId:t},n.art&&(d.art=n.art)}function qs(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}function Vs(e){const t=e._flipAllCombatOriginal;if(t){for(const[n,r]of Object.entries(t)){const o=e.cards[n];o&&(r===void 0?delete o.flipped:o.flipped=r)}delete e._flipAllCombatOriginal}}function Gs(e){const t=[];for(const a of e.deck)t.push(a);for(const a of e.hand)t.push(a);for(const a of e.discard)t.push(a);for(const a of e.frontSlots)a&&t.push(a);for(const a of e.backSlots)a&&t.push(a);for(const a of e.exhausted)t.push(a);const n=new Set;let r=t.filter(a=>n.has(a)?!1:(n.add(a),!0));const o=r.filter(a=>{const i=e.cards[a];return i?!!e.content.cardsById[i.defId]?.tags?.includes("TOKEN"):!1});if(o.length>0){const a=new Set(o);r=r.filter(i=>!a.has(i));for(const i of o)delete e.cards[i]}const s=r.filter(a=>e.cards[a]?.zone!=="vanished");e.deck=s;for(const a of s)e.cards[a].zone="deck";e.hand=[],e.discard=[],e.frontSlots=[null,null,null],e.backSlots=[null,null,null],e.selectedHandCardUid=null,e.exhausted=[],e.pendingTarget=null,e.pendingTargetQueue=[],qs(e.deck)}function Ys(e){if(!e.winHooksAppliedThisCombat){e.winHooksAppliedThisCombat=!0;for(const t of e.backUidsThisTurn){if(!e.cards[t])continue;const o=Ee(e,t).onWinWhileInBack;!o||o.length===0||Be({game:e,side:"back",cardUid:t},o)}}}function wt(e){if(e.player.hp<=0){Kr(e),e.run.finished=!0,h(e,"íŒ¨ë°°: ì£½ì—ˆìŠµë‹ˆë‹¤.");return}if(!e.victoryResolvedThisCombat&&ie(e).length===0&&e.phase!=="NODE"){e.victoryResolvedThisCombat=!0;const t=!!e.run.lastBattleWasBoss;Kr(e),Ys(e),h(e,"ì ì„ ëª¨ë‘ ì²˜ì¹˜!"),t&&(e.run.bossOmenText=null);{const o=e.run.map;o&&o.nodes&&o.pos&&o.nodes[o.pos]&&(o.nodes[o.pos].cleared=!0,o.nodes[o.pos].visited=!0)}if(e.run.lastBattleWasElite){const o=_e(e);o.eliteWins+=1,Ae(e)}{const o=e.run,s=Number(o.lastBattleEnemyCount??0)||0;if(!t&&s===3){const a=_e(e);a.threeEnemyWins=(Number(a.threeEnemyWins??0)||0)+1,Ae(e)}}{const o=e.run,s=Number(o.gold??0)||0,a=Number(o.timeMove??0)+(e.time??0);let l=3+Math.min(3,Math.floor(Math.max(0,a)/15))*2;e.run.lastBattleWasElite&&(l+=10),t&&(l+=30);const c=Number(o.pendingEventWinGold??0)||0;if(c!==0&&(l+=c,o.pendingEventWinGold=0),Ce(e,"card_dealer")&&(l=0,o.pendingEventWinGold=0),l!==0&&(o.gold=s+l,h(e,`ì „íˆ¬ ë³´ìƒ: ğŸª™${l}`),Y(e,"GOLD",`ğŸª™ +${l}`,1600)),ve(e)==="card_dealer"&&Math.random()<.3){const d=Number(o.gold??0)||0,p=Math.min(10,d);o.gold=d-p,Y(e,"WARN",q.card_dealer.victoryFee,1800),h(e,q.card_dealer.victoryFee),p>0&&Y(e,"GOLD",`ğŸª™ -${p}`,1600),h(e,`ì¹´ë“œ ë”œëŸ¬: ìˆ˜ìˆ˜ë£Œ ğŸª™ -${p}`)}}Vs(e),Gs(e),e.enemies=[],e.player.zeroSupplyTurns=0;{const o=e.run,s=o.pendingEventWinRelicId;s&&(o.pendingEventWinRelicId=null,rn(e,s,"EVENT"))}if(zt(e,"onVictory"),t){e.run.ominousProphecyLockedUntilBossKill=!1,e.run.ominousProphecySeen=!1,e.player.hp=e.player.maxHp,h(e,"ë³´ìŠ¤ ê²©íŒŒ! ì²´ë ¥ì´ ì™„ì „íˆ íšŒë³µë˜ì—ˆìŠµë‹ˆë‹¤.");{const o=e.run;o.slotCapFront=Math.max(3,Math.min(4,Math.floor(Number(o.slotCapFront??3)))),o.slotCapBack=Math.max(3,Math.min(4,Math.floor(Number(o.slotCapBack??3)))),o.bossKillCount=(Number(o.bossKillCount??0)||0)+1;const s=Number(o.bossKillCount)||0;s===1?Us(e):s===2&&(String(o.bossSlotFirstPick??"")==="front"?(o.slotCapBack<4&&(o.slotCapBack+=1),Y(e,"INFO","ë³´ìŠ¤ ë³´ìƒ: í›„ì—´ ìŠ¬ë¡¯ +1",2e3),h(e,"ë³´ìŠ¤ ë³´ìƒ: í›„ì—´ ìŠ¬ë¡¯ +1")):(o.slotCapFront<4&&(o.slotCapFront+=1),Y(e,"INFO","ë³´ìŠ¤ ë³´ìƒ: ì „ì—´ ìŠ¬ë¡¯ +1",2e3),h(e,"ë³´ìŠ¤ ë³´ìƒ: ì „ì—´ ìŠ¬ë¡¯ +1")))}Ks(e)}Ds(e);const n=t?"BOSS":e.run.lastBattleWasElite?"ELITE":"BATTLE",r=Hs(e,{elite:!!e.run.lastBattleWasElite,boss:!!t});Os(e,{itemOfferId:r??void 0,itemSource:n}),e.phase="NODE";return}}function Oo(e){return e.deck.length+e.hand.length+e.discard.length+e.frontSlots.filter(Boolean).length+e.backSlots.filter(Boolean).length+e.exhausted.length}function Xs(e){const t=Number(e);return Number.isFinite(t)?Math.max(3,Math.min(4,Math.floor(t))):3}function Yn(e,t){const n=e.run;return Xs(t==="front"?n.slotCapFront:n.slotCapBack)}function Qs(e){return Math.max(Yn(e,"front"),Yn(e,"back"))}function Zs(e){const t=Qs(e);e.frontSlots=Array.from({length:t},()=>null),e.backSlots=Array.from({length:t},()=>null),e.backSlotDisabled=Array.from({length:t},()=>!1)}function At(e){e.combatTurn=1,e.time=(e.time??0)+1,h(e,"ì „íˆ¬: ì‹œê°„ +1"),e.installAgeByUid={},e._gamblerGloveGainedThisTurn={},e.player.block=0,e.player.status.vuln=0,e.player.status.weak=0,e.player.status.bleed=0,e.player.status.disrupt=0,e.player.status.slash=0,e.player.zeroSupplyTurns=0,e.phase="REVEAL",Zs(e),e.backUidsThisTurn=[],e.hand=[],e.selectedHandCardUid=null,e.pendingTarget=null,e.pendingTargetQueue=[],e.usedThisTurn=0;for(const r of e.enemies)Fo(r.id)>0&&(r.atkRamp=0);e.frontPlacedThisTurn=0,e._gainedBlockThisTurn=!1,e._indifferentHostileWarnedThisTurn=!1,e._rabbitHuntBlockToastShownThisCombat=!1,e.winHooksAppliedThisCombat=!1,e.victoryResolvedThisCombat=!1,e.run.eliteRelicOfferedThisBattle=!1,e.run.itemOfferedThisBattle=!1;const t=e.run.nextBattleSuppliesBonus??0,n=ts(e);if(e.player.supplies=Math.max(0,7+t+n),t!==0&&(h(e,`ë‹¤ìŒ ì „íˆ¬ S ë³€ë™: ${t}`),e.run.nextBattleSuppliesBonus=0),n!==0&&h(e,`í›„ì› íš¨ê³¼: ì‹œì‘ ë³´ê¸‰ +${n} (í˜„ì¬ ${e.player.supplies})`),ve(e)==="forge_master"){const o=pe(e);o.forgeIntroShown||(o.forgeIntroShown=!0,Y(e,"INFO",q.forge_master.firstBattle,2e3),h(e,q.forge_master.firstBattle))}e.player.immuneToDisruptThisTurn=!1,e.player.nullifyDamageThisTurn=!1,e.intentsRevealedThisTurn=!1,e.disruptIndexThisTurn=null,e.drawCountThisTurn=0,e.attackedEnemyIndicesThisTurn=[],Ja(e),cs(e);{const r=e.run;let o=4;o+=ls(e);const s=Number(r.nextCombatDrawDelta??0)||0;s!==0&&(o+=s,r.nextCombatDrawDelta=0);const a=Number(r.rabbitHuntDrawBoostBattles??0)||0;a>0&&(o+=1,r.rabbitHuntDrawBoostBattles=a-1),o=Math.max(0,o);const i=[],l=c=>{const d=c==="deck"?e.deck:e.discard;for(const p of d)Ee(e,p).tags?.includes("INNATE")&&i.push(p)};if(l("deck"),l("discard"),i.length){const c=Array.from(new Set(i));e.deck=e.deck.filter(d=>!c.includes(d)),e.discard=e.discard.filter(d=>!c.includes(d));for(const d of c)e.hand.push(d),e.cards[d].zone="hand";h(e,`ì„ ì²œì„±: ${c.length}ì¥ ì‹œì‘ ì†íŒ¨ì— ë°°ì¹˜`),o=Math.max(0,o-c.length)}Dt(e,o)}yr(e),e.phase="PLACE",zt(e,"onCombatStart");{const r=Number(e._combatStartExtraDraw??0);e._combatStartExtraDraw=0,r>0&&Dt(e,r)}}function Dr(e,t,n,r){if(e.phase!=="PLACE"||!e.hand.includes(t))return;n==="back"&&(e.backUidsThisTurn.includes(t)||e.backUidsThisTurn.push(t));const o=n==="front"?e.frontSlots:e.backSlots,s=Yn(e,n);if(!(r<0||r>=s)&&!(r>=o.length)&&!o[r]){e.hand=e.hand.filter(a=>a!==t),o[r]=t,e.cards[t].zone=n,Ot(e,t,n)&&(e.installAgeByUid??={},e.installAgeByUid[t]??=0),e.usedThisTurn+=1,n==="front"&&(e.frontPlacedThisTurn+=1),e.placedUidsThisTurn??=[],e.placedUidsThisTurn.includes(t)||e.placedUidsThisTurn.push(t),ds(e);try{if(Ee(e,t)?.id==="token_moon_scroll"){const i=_e(e);i.moonScrollUses=(Number(i.moonScrollUses??0)||0)+1,Ae(e)}}catch{}h(e,`[${Ke(e,t)}]ë¥¼ ${n==="front"?"ì „ì—´":"í›„ì—´"} ${r}ë²ˆì— ë°°ì¹˜`),zt(e,"onPlaceCard",{side:n,idx:r,cardUid:t})}}function Fr(e,t,n){return Ee(e,t).tags?.includes(n)??!1}function Js(e,t){e.frontSlots=e.frontSlots.map(r=>r===t?null:r),e.backSlots=e.backSlots.map(r=>r===t?null:r);const n=e.installAgeByUid;n&&t in n&&delete n[t]}function Wr(e,t,n){const r=Ee(e,t);Js(e,t),e.hand=e.hand.filter(l=>l!==t),e.deck=e.deck.filter(l=>l!==t),e.discard=e.discard.filter(l=>l!==t);const o=r.vanishWhen,s=r.exhaustWhen,a=o==="BOTH"||o==="FRONT"&&n==="front"||o==="BACK"&&n==="back",i=s==="BOTH"||s==="FRONT"&&n==="front"||s==="BACK"&&n==="back";if(o&&o!=="NONE"&&a){e.vanished.push(t),e.cards[t].zone="vanished",h(e,`[${Ke(e,t)}] ì†Œì‹¤(ì˜êµ¬ ì œê±°)`);return}if(s&&s!=="NONE"&&i){e.exhausted.push(t),e.cards[t].zone="exhausted",h(e,`[${Ke(e,t)}] ì†Œëª¨(ì´ë²ˆ ì „íˆ¬ì—ì„œ ì œê±°)`);return}if(!o&&Fr(e,t,"VANISH")){e.vanished.push(t),e.cards[t].zone="vanished",h(e,`[${Ke(e,t)}] ì†Œì‹¤(ì˜êµ¬ ì œê±°)`);return}if(!s&&Fr(e,t,"EXHAUST")){e.exhausted.push(t),e.cards[t].zone="exhausted",h(e,`[${Ke(e,t)}] ì†Œëª¨(ì´ë²ˆ ì „íˆ¬ì—ì„œ ì œê±°)`);return}e.discard.push(t),e.cards[t].zone="discard"}function Ot(e,t,n){const r=Ee(e,t);if(!r.tags?.includes("INSTALL"))return!1;const o=r.vanishWhen,s=r.exhaustWhen,a=o==="BOTH"||o==="FRONT"&&n==="front"||o==="BACK"&&n==="back",i=s==="BOTH"||s==="FRONT"&&n==="front"||s==="BACK"&&n==="back";if(o&&o!=="NONE"&&a||!o&&r.tags?.includes("VANISH")||s&&s!=="NONE"&&i||!s&&r.tags?.includes("EXHAUST"))return!1;const l=r.installWhen;return!l||l==="BOTH"?!0:l==="FRONT"?n==="front":l==="BACK"?n==="back":!1}function ei(e,t=!1){for(let n=0;n<e.frontSlots.length;n++){const r=e.frontSlots[n];r?!t&&Ot(e,r,"front")||(Wr(e,r,"front"),e.frontSlots[n]=null):e.frontSlots[n]=null;const o=e.backSlots[n];o?!t&&Ot(e,o,"back")||(Wr(e,o,"back"),e.backSlots[n]=null):e.backSlots[n]=null}}function ti(e){e.installAgeByUid??={};for(let t=0;t<e.frontSlots.length;t++){const n=e.frontSlots[t];n&&Ot(e,n,"front")&&(e.installAgeByUid[n]=(e.installAgeByUid[n]??0)+1);const r=e.backSlots[t];r&&Ot(e,r,"back")&&(e.installAgeByUid[r]=(e.installAgeByUid[r]??0)+1)}}function Do(e,t,n){const r=e.cards[t],o=Ee(e,t);return!r?.flipped?n==="front"?o.front:o.back:n==="front"?o.back:o.front}function ni(e){if(!(e.phase!=="PLACE"&&e.phase!=="BACK")){e.phase="BACK",h(e,"=== í›„ì—´ ë‹¨ê³„ ===");for(let t=0;t<e.backSlots.length;t++){const n=e.backSlots[t];if(!n)continue;const r=Ee(e,n);if(!e.player.immuneToDisruptThisTurn&&e.backSlotDisabled[t]){h(e,`í›„ì—´ ${t}ë²ˆ [${r.name}] êµë€ìœ¼ë¡œ ë¬´íš¨`);continue}Be({game:e,side:"back",cardUid:n},Do(e,n,"back"))}e.phase="FRONT"}}function ri(e){if(e.phase==="FRONT"){h(e,"=== ì „ì—´ ë‹¨ê³„ ===");for(let t=0;t<e.frontSlots.length;t++){const n=e.frontSlots[t];n&&(Ee(e,n),Be({game:e,side:"front",cardUid:n},Do(e,n,"front")))}e.phase="ENEMY"}}const oi=.6;function ai(e){if(e.phase==="ENEMY"){h(e,"=== ì  í–‰ë™ ===");for(const t of ie(e)){const n=e.content.enemiesById[t.id],r=n.intents[t.intentIndex%n.intents.length];if(t.id==="boss_soul_stealer"){if(t.soulWillNukeThisTurn){const o=t.status.weak??0;we(e,50,"ENEMY_ATTACK","ì˜í˜¼ ê°•íƒˆì",o),h(e,"ì˜í˜¼ ê°•íƒˆì: ì˜í˜¼ í­ë°œ â†’ 50 í”¼í•´!"),t.soulWillNukeThisTurn=!1,t.soulArmed=!1,t.soulWarnCount=0;continue}for(const o of r.acts)Ur(e,t,o);t.intentIndex===Es&&(t.soulWarnCount=(t.soulWarnCount??0)+1,h(e,`ì˜í˜¼ ê°•íƒˆì: ê²½ê³  +1 (${t.soulWarnCount}/3)`),(t.soulWarnCount??0)>=3&&(t.soulArmed=!0,h(e,"ì˜í˜¼ ê°•íƒˆì: ê²½ê³  3íšŒ ì™„ë£Œ â†’ í­ë°œ ê°€ëŠ¥ ìƒíƒœ!"),Math.random()<oi&&(t.soulWillNukeThisTurn=!0)));continue}for(const o of r.acts)Ur(e,t,o)}e.phase="UPKEEP"}}function si(e){return e.deck.length+e.hand.length+e.discard.length+e.frontSlots.filter(Boolean).length+e.backSlots.filter(Boolean).length+e.exhausted.length}function ii(e,t){const n=Math.ceil(t/e.div);let r=e.base+e.per*n;return e.cap!=null&&(r=Math.min(r,e.cap)),{dmg:r,scale:n}}function Fo(e){return e==="watching_statue"||e==="pebble_golem"?1:e==="rock_golem"?2:0}function Re(e){const t=Number(e.atkRamp??0)||0;return t>0?t:0}function Ur(e,t,n){switch(n.op){case"damagePlayer":{const r=t.status.weak??0;we(e,n.n+Re(t),"ENEMY_ATTACK",t.name,r);return}case"damagePlayerFormula":{const r=t.status.weak??0;if(n.kind==="goblin_raider"){const o=Math.max(0,12-e.usedThisTurn);we(e,o+Re(t),"ENEMY_ATTACK",t.name,r);return}if(n.kind==="gloved_hunter"){const s=(e.player.block??0)>=4?12:6;we(e,s+Re(t),"ENEMY_ATTACK",t.name,r);return}if(n.kind==="goblin_assassin"){const s=8+4*Math.max(0,Number(t.assassinAim??0)||0);we(e,s+Re(t),"ENEMY_ATTACK",t.name,r),t.assassinAim=0;return}if(n.kind==="old_monster_corpse"){const s=9+4*Math.max(0,Number(t.corpseRage??0)||0);we(e,s+Re(t),"ENEMY_ATTACK",t.name,r);return}if(n.kind==="punishing_one"){const o=Math.max(0,Number(e.hand?.length??0)||0),s=Math.min(30,6+2*o);we(e,s+Re(t),"ENEMY_ATTACK",t.name,r);return}{const o=4+e.usedThisTurn;we(e,o+Re(t),"ENEMY_ATTACK",t.name,r);return}}case"supplies":{e.player.supplies=lr(e.player.supplies+n.n,0),h(e,`ì  íš¨ê³¼: ë³´ê¸‰ S ${n.n>=0?"+":""}${n.n} (í˜„ì¬ ${e.player.supplies})`);return}case"statusPlayer":{const r=n.n;Se(e.player,n.key,r,e,"ENEMY");let o=r;n.key==="vuln"&&o>0&&gn(e,"relic_ratskin_charm")&&(o=Math.max(0,o-1)),h(e,`ì  íš¨ê³¼: í”Œë ˆì´ì–´ ìƒíƒœ ${n.key} ${o>=0?"+":""}${o}`);return}case"enemyHealSelf":{t.hp=Math.min(t.maxHp,t.hp+n.n),h(e,`ì (${t.name})ì´(ê°€) ${n.n} íšŒë³µ (HP ${t.hp}/${t.maxHp})`);return}case"enemySetAssassinAim":{t.assassinAim=Math.max(0,Number(t.assassinAim??0)||0)+(Number(n.n??0)||0),h(e,`ì (${t.name})ì´(ê°€) ì¡°ì¤€ ìƒíƒœê°€ ë¨`);return}case"enemyImmuneThisTurn":{t.immuneThisTurn=!0,h(e,`ì (${t.name})ì´(ê°€) í”¼í•´ ë©´ì—­ ìƒíƒœê°€ ë¨`);return}case"enemyImmuneNextTurn":{t.immuneNextTurn=!0,h(e,`ì (${t.name})ì´(ê°€) ë‹¤ìŒ í„´ í”¼í•´ ë©´ì—­ ìƒíƒœê°€ ë¨`);return}case"fatiguePlayer":{e.player.fatigue=Math.max(0,e.player.fatigue+n.n),h(e,`ì  íš¨ê³¼: í”¼ë¡œ F ${n.n>=0?"+":""}${n.n} (í˜„ì¬ ${e.player.fatigue})`);return}case"damagePlayerByDeckSize":{const r=si(e),{dmg:o,scale:s}=ii(n,r),a=t.status.weak??0,i=we(e,o+Re(t),"ENEMY_ATTACK",t.name,a);h(e,`ì¤‘ë ¥ í”¼í•´(ê³µì‹): base ${n.base} + per ${n.per} * ceil(${r}/${n.div})=${s} => raw ${o}, ì ìš© ${i}`);return}case"damagePlayerRampHits":{const r=Math.max(1,Number(e.combatTurn??1)),o=Math.max(1,Number(n.baseHits??1)),s=Math.max(1,Number(n.everyTurns??1));let a=o+Math.floor((r-1)/s);n.capHits!=null&&(a=Math.min(a,Math.max(1,Number(n.capHits))));const i=t.status.weak??0,l=`${t.name} (${a}íƒ€)`;for(let c=0;c<a;c++)we(e,n.n+Re(t),"ENEMY_ATTACK",l,i);return}case"damagePlayerIfSuppliesPositive":{if((e.player.supplies??0)>0){const o=t.status.weak??0;we(e,n.n+Re(t),"ENEMY_ATTACK",t.name,o)}else h(e,"ë®ì¹˜ê¸°: S = 0 â†’ í”¼í•´ ì—†ìŒ");break}case"damagePlayerIfSuppliesZero":{const r=e.player.supplies??0;if(r===0){const o=t.status.weak??0;we(e,n.n+Re(t),"ENEMY_ATTACK",t.name,o)}else h(e,`ì••ë¥˜: S = ${r} â†’ í”¼í•´ ì—†ìŒ`);break}default:return n}}function li(e){if(e.phase!=="UPKEEP")return;us(e),h(e,"=== ìœ ì§€ë¹„ / ìƒíƒœ ì²˜ë¦¬ ===");{const r=_e(e);let o=!1;(e.player.status.weak??0)>0&&(r.endedTurnWeak=(r.endedTurnWeak??0)+1,o=!0),(e.usedThisTurn??0)===0&&(e.frontPlacedThisTurn??0)===0&&(e.backUidsThisTurn?.length??0)===0&&(r.skippedTurn+=1,o=!0),o&&Ae(e)}const t=e.frontSlots.filter(Boolean).length;t>0&&h(e,`ì „ì—´ ìœ ì§€ë¹„ ì²˜ë¦¬: ì „ì—´ ${t}ì¥`);{const r=e.player.supplies??0,o=Math.min(r,t);e.player.supplies=r-o;const s=t-o;s>0&&(e.player.fatigue+=s,h(e,`ì „ì—´ ìœ ì§€ë¹„ ë¶€ì¡±! (ë¶€ì¡± ${s} â†’ F +${s})`))}if(e.player.supplies===0){e.player.zeroSupplyTurns+=1;{const o=_e(e);o.endedTurnSupplyZero=(o.endedTurnSupplyZero??0)+1,Ae(e)}const r=e.player.fatigue;we(e,r,"ZERO_SUPPLY","ë³´ê¸‰ ì—†ì´ í„´ ì¢…ë£Œ! í”¼í•´ "+r)}const n=e.player.status.bleed??0;n>0&&we(e,n,"BLEED","ì¶œí˜ˆ");for(const r of ie(e)){const o=r.status.bleed??0;o>0&&(r.immuneThisTurn?h(e,`ì (${r.name})ì€(ëŠ”) ì´ë²ˆ í„´ ë©´ì—­ì´ë¼ ì¶œí˜ˆ í”¼í•´ ë¬´ì‹œ`):(r.hp=Math.max(0,r.hp-o),h(e,`ì (${r.name}) ì¶œí˜ˆë¡œ HP -${o} (HP ${r.hp}/${r.maxHp})`)))}for(const r of ie(e)){const o=Fo(r.id);o<=0||(r.atkRamp=Re(r)+o,h(e,`ì  íŒ¨ì‹œë¸Œ: ${r.name} ê³µê²©ë ¥ +${o} (ëˆ„ì  +${r.atkRamp})`))}if(e.frontPlacedThisTurn=0,ci(e),ei(e),ti(e),bt(e),wt(e),(e.frontSlots.filter(Boolean).length+e.backSlots.filter(Boolean).length|0)>=3){const o=_e(e);o.endedTurnWith3Installs=(Number(o.endedTurnWith3Installs??0)||0)+1,Ae(e)}zt(e,"onUpkeepEnd"),e.phase="DRAW"}function ci(e){const t=["vuln","weak","bleed","disrupt"];for(const n of t)e.player.status[n]>0&&(e.player.status[n]-=1);for(const n of e.enemies)for(const r of t)n.status[r]>0&&(n.status[r]-=1)}function di(e){if(e.phase!=="DRAW"||(e.intentsRevealedThisTurn=!1,e.disruptIndexThisTurn=null,wt(e),e.run.finished))return;if(ie(e).length===0){Wo(e),e.phase="NODE";return}const t=e.usedThisTurn;e.usedThisTurn=0;const n=Number(e._extraDrawNextTurn??0);e._extraDrawNextTurn=0,e._gamblerGloveGainedThisTurn={};const r=e.player.block??0;Dt(e,t+(n>0?n:0)),!ui(e)&&r>0&&(e.player.block=Math.max(0,(e.player.block??0)-r),h(e,"ë°©ì–´(ë¸”ë¡) ì†Œì‹¤")),yr(e),e.phase="PLACE",e.backUidsThisTurn=[],e.attackedEnemyIndicesThisTurn=[],e.drawCountThisTurn=0,e.combatTurn=(e.combatTurn??0)+1,e._gainedBlockThisTurn=!1,e._indifferentHostileWarnedThisTurn=!1,ns(e)}function ui(e){for(const t of e.frontSlots){if(!t)continue;if(e.cards[t]?.defId==="install_makeshift_wall")return!0}return!1}function pi(e){const t=e._gamblerGloveGainedThisTurn??={};for(const n of e.frontSlots){if(!n)continue;const r=e.cards[n];if(!r||r.defId!=="gambler_glove")continue;const o=(r.upgrade??0)>0?10:6,s=Number(t[n]??0)||0;if(s>=o)continue;const a=Math.min(2,o-s);a>0&&(cn(e,a),t[n]=s+a)}}function Dt(e,t){let n=0;for(let r=0;r<t&&(fi(e),!e.run.finished);r++){const o=e.deck.pop();if(!o)break;e.hand.push(o),n++,pi(e)}return h(e,`ë“œë¡œìš° ${n}/${t} (ì†íŒ¨ ${e.hand.length})`),n}function fi(e){e.deck.length===0&&e.discard.length>0&&(e.deck=cr(e.discard),e.discard=[],e.player.fatigue+=1,h(e,`í”¼ë¡œë„ F +1 (ì…”í”Œ, í˜„ì¬ ${e.player.fatigue})`))}function Wo(e){e.player.block>0&&(e.player.block=0,h(e,"ë°©ì–´(ë¸”ë¡) ì†Œì‹¤")),e.intentsRevealedThisTurn=!1,e.disruptIndexThisTurn=null}function Kr(e){Wo(e)}function ye(e){return e.pendingTarget!=null||(e.pendingTargetQueue?.length??0)>0}function mi(e,t,n){const r=Number(t.amount??0)|0,o=t.formulaKind;if(!o)return r;const s=ie(e).length,a=t.aliveCountSnap,i=Number.isFinite(Number(a))?Number(a):s;switch(o){case"prey_mark":return n.hp>e.player.hp?r+5:r;case"prey_mark_u1":return n.hp>e.player.hp?r+6:r;case"triple_bounty":return i>=3?r+8:r;case"triple_bounty_u1":return i>=3?r+10:r;default:return r}}function hi(e,t){if(!e.pendingTarget)return!1;if(ie(e).length===0)return e.pendingTarget=null,e.pendingTargetQueue=[],e.selectedEnemyIndex=null,wt(e),!0;const n=e.enemies[t];if(!n||n.hp<=0)return!1;const r=e.pendingTarget;if(r.kind==="damageSelect"&&n.id==="goblin_assassin"){const s=ie(e).indexOf(n)+1;if(s===2||s===3)return Y(e,"WARN","ê³µê²© ëŒ€ìƒìœ¼ë¡œ ì§€ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."),h(e,"ê³ ë¸”ë¦° ì•”ì‚´ì: ì í–‰ â†’ ëŒ€ìƒ ì§€ì • ê³µê²© ë¬´íš¨"),!1}if(r.kind==="damageSelect"){const o=mi(e,r,n);Tr(e,n,o)}else if(r.kind==="statusSelect"&&(Se(n,r.key,r.n,e,"PLAYER"),r.key==="bleed"&&r.n>0)){const o=_e(e);o.bleedApplied+=1,Ae(e)}return bt(e),wt(e),ie(e).length===0?!0:(bi(e),!e.pendingTarget&&(e.pendingTargetQueue?.length??0)===0)}function bi(e){const t=e.pendingTargetQueue??[],n=t.shift()??null;e.pendingTarget=n,e.pendingTargetQueue=t,e.selectedEnemyIndex=null}function cn(e,t){if(t<=0)return;let n=t;try{const o=e.run?.faith,s=String(o?.focus??""),a=!!o?.hostile?.[s],i=Number(o?.points?.[s]??0)||0;(s&&s!=="madness"&&!a&&i>=3?s:null)==="rabbit_hunt"&&(n=Math.floor(n*.75),n>0&&!e._rabbitHuntBlockToastShownThisCombat&&(e._rabbitHuntBlockToastShownThisCombat=!0,Y(e,"WARN","ê°€ë²¼ìš´ ë°©íŒ¨ëŠ” ì˜ ë¶€ëŸ¬ì§‘ë‹ˆë‹¤.",1600),h(e,"í† ë¼ ì‚¬ëƒ¥: ë°©ì–´ íšë“ëŸ‰ -25% (ë‚´ë¦¼)")))}catch{}n<=0||(e.player.block+=n,e._gainedBlockThisTurn=!0,h(e,`ë°©ì–´(ë¸”ë¡) +${n} (í˜„ì¬ ${e.player.block})`))}function Uo(e,t){e.player.supplies=lr(e.player.supplies+t,0),h(e,`ë³´ê¸‰ S ${t>=0?"+":""}${t} (í˜„ì¬ ${e.player.supplies})`)}function ct(e,t){e.player.fatigue=lr(e.player.fatigue+t,0),h(e,`í”¼ë¡œ F ${t>=0?"+":""}${t} (í˜„ì¬ ${e.player.fatigue})`)}function ut(e,t){if(t<=0)return;let n=t;gn(e,"relic_bloody_spoon")&&n>0&&(n+=1,h(e,"í”¼ ë¬»ì€ ìˆŸê°€ë½, ì¶”ê°€ íšŒë³µ +1"));const r=e.player.hp;e.player.hp=Math.min(e.player.maxHp,e.player.hp+n),h(e,`HP +${e.player.hp-r} (í˜„ì¬ ${e.player.hp}/${e.player.maxHp})`)}function bt(e){ie(e).length===0&&(e.pendingTarget=null,e.pendingTargetQueue=[],e.selectedEnemyIndex=null)}function Tr(e,t,n){if(n<=0)return;const r=!!e._playerDamageFromInstall,o=e.enemies.indexOf(t);if(o<0){h(e,`WARN: applyDamageToEnemy target not in g.enemies (${t?.id??"?"})`);return}if(e.attackedEnemyIndicesThisTurn.includes(o)||e.attackedEnemyIndicesThisTurn.push(o),t.immuneThisTurn){h(e,`ì (${t.name})ì€(ëŠ”) ì´ë²ˆ í„´ í”¼í•´ ë©´ì—­ â†’ ${n} í”¼í•´ ë¬´ì‹œ`),bt(e);return}{const d="install_lead_observation",p=(k,T)=>{let m=0;for(const f of k){if(!f)continue;const b=e.cards[f];b&&b.defId===T&&(m+=1)}return m};let u=0;o===0&&(u+=2*p(e.frontSlots,d)),o===2&&(u+=2*p(e.backSlots,d)),u>0&&(n+=u)}let s={target:"ENEMY",source:"PLAYER_ATTACK",raw:n,reason:r?"INSTALL":void 0,enemyIndex:o,enemyId:t.id},a=Ge(e,{...s,phase:"PRE_STATUS",current:n,targetVuln:t.status.vuln??0,attackerWeak:e.player.status.weak??0});const i=e.player.status.weak??0,l=t.status.vuln??0;if(a=a-i+l,a<0&&(a=0),a=Ge(e,{...s,phase:"POST_STATUS",current:a,afterStatus:a,targetVuln:l,attackerWeak:i}),a=Ge(e,{...s,phase:"FINAL",current:a,afterStatus:a,targetVuln:l,attackerWeak:i}),a<=0){h(e,`ì (${t.name})ì—ê²Œ í”¼í•´ 0 (ìœ ë¬¼/ìƒíƒœë¡œ ìƒì‡„)`),bt(e);return}const c=t.hp;if(t.hp=Math.max(0,t.hp-a),h(e,`ì (${t.name})ì—ê²Œ ${a} í”¼í•´. (HP ${t.hp}/${t.maxHp})`),r&&a>0){const d=_e(e);d.installDamageDealt=(Number(d.installDamageDealt??0)||0)+a,Ae(e)}if(c>0&&t.hp===0){const d=_e(e);d.kills+=1,Ae(e)}if(c>0&&t.hp===0)for(const d of ie(e))!d||d.hp<=0||d.id==="old_monster_corpse"&&(d.corpseRage=Math.max(0,Number(d.corpseRage??0)||0)+1,h(e,`ì (${d.name}) íŒ¨ì‹œë¸Œ: ì©ì€ ë¶„ë…¸ +1 (í˜„ì¬ ${d.corpseRage})`));go(e,{...s,phase:"FINAL",current:a,afterStatus:a,targetVuln:l,attackerWeak:i},a),bt(e),ie(e).length===0&&(bt(e),wt(e))}function we(e,t,n,r,o){if(n==="ENEMY_ATTACK"&&e.player.nullifyDamageThisTurn)return h(e,`ì  ê³µê²© í”¼í•´ ë¬´íš¨ (${r??n})`),0;if(t<=0)return 0;const a={target:"PLAYER",source:n==="ENEMY_ATTACK"?"ENEMY_ATTACK":n==="FATIGUE"?"FATIGUE":"OTHER",raw:t,reason:r};let i=Ge(e,{...a,phase:"PRE_STATUS",current:t,attackerWeak:o,targetVuln:e.player.status.vuln??0});if(n==="ENEMY_ATTACK"){const l=o??0,c=e.player.status.vuln??0;if(i=i-l+c,i<0&&(i=0),i=Ge(e,{...a,phase:"POST_STATUS",current:i,afterStatus:i,attackerWeak:l,targetVuln:c}),i=Ge(e,{...a,phase:"PRE_BLOCK",current:i,afterStatus:i,attackerWeak:l,targetVuln:c}),e.player.block>0){const d=Math.min(e.player.block,i);e.player.block-=d,i-=d}i=Ge(e,{...a,phase:"POST_BLOCK",current:i,afterStatus:i,afterBlock:i,attackerWeak:l,targetVuln:c})}else i=Ge(e,{...a,phase:"POST_STATUS",current:i,afterStatus:i});if(i=Ge(e,{...a,phase:"FINAL",current:i}),i<=0)return 0;e.player.hp=Math.max(0,e.player.hp-i),h(e,`í”Œë ˆì´ì–´ ${i} í”¼í•´ (${r??n}). (HP ${e.player.hp}/${e.player.maxHp})`);{const l=_e(e);let c=!1;i>=10&&(l.tookBigHit10+=1,c=!0),e.player.hp<=15&&(l.hpLeq15+=1,c=!0),c&&Ae(e)}return go(e,{...a,phase:"FINAL",current:i},i),i}const yi=new Set(["goblin_ambush_low_supplies","rat_circle"]);function Ko(e,t){if(e.length<=1)return e[0];if(!t)return e[Math.floor(Math.random()*e.length)];const n=e.filter(o=>o.id!==t),r=n.length>0?n:e;return r[Math.floor(Math.random()*r.length)]}function ki(e){const t=e.run,n=t.eventsSeen??{},r=Xn.filter(a=>yi.has(a.id)?(Number(n[a.id]??0)||0)<=0:!0),o=r.length>0?r:Xn,s=t.lastEventId??null;return Ko(o,s)}function In(e){const{tier:t}=ko(e),n=t===0?0:t===1?.25:t===2?.55:.85;return Math.random()<n?vi(e):ki(e)}const zo={boss_cursed_wall:"ì›€ì§ì´ì§€ ì•ŠëŠ”ë‹¤. ë‹¹ì‹ ì´ ë‹³ì•„ê°„ë‹¤.",boss_giant_orc:"ê±°ëŒ€í•œ ë¬´ì–¸ê°€ê°€ ê¸°ë‹¤ë¦°ë‹¤.",boss_soul_stealer:"í–‰ë™í•˜ì§€ ì•Šìœ¼ë©´ ì¢…ë§ì´ ì˜¨ë‹¤.",boss_gravity_master:"ëª¸ì´ ì ì  ë¬´ê²ë‹¤. ëª¸ì„ ê°€ë³ê²Œ í•˜ë¼."},Ti=[{id:"mad_mirror",name:"ê±°ìš¸ì— ì ê¸´ ë¬¼",prompt:"ë¬¼ ì†ì˜ ë‹¹ì‹ ì´ ë¨¼ì € ì›ƒìŠµë‹ˆë‹¤.",art:"assets/events/event_mad_mirror.png",options:e=>[{key:"mad_mirror:take",label:"ì†ì„ ë„£ëŠ”ë‹¤",detail:"ì¹´ë“œ ë³´ìƒ. F +2.",apply:t=>(ct(t,2),h(t,"ê±°ìš¸: ë¬´ì–¸ê°€ë¥¼ ê±´ì ¸ ì˜¬ë ¸ë‹¤. (F +2)"),"REWARD")},{key:"mad_mirror:leave",label:"ì™¸ë©´í•œë‹¤",apply:t=>(h(t,"ê±°ìš¸: ë‹¹ì‹ ì€ ë¬¼ëŸ¬ë‚¬ë‹¤."),"NONE")}]},{id:"mad_contract",name:"ì –ì€ ê³„ì•½ì„œ",prompt:"ê³°íŒ¡ì´ ëƒ„ìƒˆê°€ ë‚©ë‹ˆë‹¤.",art:"assets/events/event_mad_contract.png",options:e=>[{key:"mad_contract:sign",label:"ì„œëª…í•œë‹¤",detail:"ìµœëŒ€ HP +2. ì¹´ë“œ 1ì¥ ì œê±° í›„ ë³´ìƒ.",apply:t=>(t.player.maxHp+=2,t.player.hp=Math.min(t.player.maxHp,t.player.hp+2),h(t,"ê³„ì•½: ìµœëŒ€ HP +2"),{kind:"REMOVE_PICK",title:"ëŒ€ê°€",prompt:"ì œê±°í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",then:"REWARD"})},{key:"mad_contract:burn",label:"ì°¢ì–´ë²„ë¦°ë‹¤",detail:"F +1",apply:t=>(ct(t,1),h(t,"ë¶ˆê¸¸í•¨: F +1"),"NONE")}]},{id:"mad_lullaby",name:"ìì¥ê°€",prompt:"ì ë“¤ë©´ íšŒë³µí•˜ì§€ë§Œ, ê¹¨ì–´ë‚˜ë©´ ìŠìŠµë‹ˆë‹¤.",art:"assets/events/event_mad_lullaby.png",options:e=>[{key:"mad_lullaby:sleep",label:"ì ë“ ë‹¤",detail:"HP +12. ë±ì—ì„œ ë¬´ì‘ìœ„ 1ì¥ ì†Œì‹¤.",apply:t=>(ut(t,12),fr(t),h(t,"ìì¥ê°€: HP íšŒë³µ, ê·¸ëŸ¬ë‚˜ ìŠì—ˆë‹¤â€¦ (ë¬´ì‘ìœ„ 1ì¥ ì†Œì‹¤)"),"NONE")},{key:"mad_lullaby:stay",label:"ë²„í‹´ë‹¤",detail:"F -1",apply:t=>(ct(t,-1),h(t,"ë²„íŒ€: F -1"),"NONE")}]}];function vi(e){const n=e.run.lastEventId??null;return Ko(Ti,n)}const Xn=[{id:"drop_bag",name:"ì§ ë²„ë¦¬ê¸°",prompt:"ì§ì„ ì¤„ì—¬ í”¼ë¡œë¥¼ ë‚®ì¶”ì.",art:"assets/events/event_drop_bag.png",options:()=>[{key:"drop",label:"ì¹´ë“œ 1ì¥ ì œê±°, F -1",apply:e=>(ct(e,-1),h(e,"ì´ë²¤íŠ¸: ì§ ë²„ë¦¬ê¸° â†’ ì œê±°í•  ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”."),{kind:"REMOVE_PICK",title:"ì§ ë²„ë¦¬ê¸°",prompt:"ì œê±°í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",then:"NONE"})},{key:"skip",label:"ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠëŠ”ë‹¤",apply:e=>(h(e,"ì´ë²¤íŠ¸: ì§ ë²„ë¦¬ê¸°(ìƒëµ)"),"NONE")}]},{id:"hide_from_monster",name:"ëª¬ìŠ¤í„°ë¡œë¶€í„° ìˆ¨ê¸°",prompt:"ì „íˆ¬í•˜ê±°ë‚˜, ëŒ€ê°€ë¥¼ ì¹˜ë¥´ê³  ìˆ¨ì„ ìˆ˜ ìˆë‹¤.",art:"assets/events/event_hide_from_monster.png",options:()=>[{key:"fight",label:"ì „íˆ¬",apply:e=>(h(e,"ì´ë²¤íŠ¸: ëª¬ìŠ¤í„°ë¡œë¶€í„° ìˆ¨ê¸° â†’ ì „íˆ¬ ì„ íƒ"),"BATTLE")},{key:"remove_and_fatigue",label:"ì¹´ë“œ 1ì¥ ì œê±° í›„ F +1",apply:e=>(ct(e,1),h(e,"ì´ë²¤íŠ¸: ëª¬ìŠ¤í„°ë¡œë¶€í„° ìˆ¨ê¸° â†’ ì¹´ë“œ ì œê±° í›„ F+1"),{kind:"REMOVE_PICK",title:"ìˆ¨ê¸°",prompt:"ì œê±°í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",then:"NONE"})}]},{id:"goblin_ambush_low_supplies",name:"ë§¤ë³µí•œ ì•½íƒˆìë“¤",prompt:"ê³ ë¸”ë¦°ë“¤ì´ ë³´ê¸‰ì„ ì•½íƒˆí–ˆë‹¤.",art:"assets/events/event_goblin_ambush_low_supplies.png",options:()=>[{key:"fight",label:"ë§ì„œ ì‹¸ìš´ë‹¤",detail:`ê³ ë¸”ë¦° ì•½íƒˆì 2ë§ˆë¦¬ ì „íˆ¬ (Sê°€ 5 ê°ì†Œí•œ ì±„ë¡œ ì‹œì‘)
ìŠ¹ë¦¬ ì‹œ ğŸª™50`,apply:e=>(e.run.nextBattleSuppliesBonus=-5,{kind:"BATTLE_SPECIAL",title:"ê³ ë¸”ë¦° ë§¤ë³µ",enemyIds:["goblin_raider","goblin_raider"],onWinGrantGold:50})}]},{id:"find_adventurer",name:"ë‹¤ë¥¸ ëª¨í—˜ê°€ ë°œê²¬",prompt:"ê±°ë˜í•œë‹¤.",art:"assets/events/event_find_adventurer.png",options:e=>e.run.treasureObtained?[{key:"adventurer:forced_battle",label:"ëŒ€ì¹˜í•œë‹¤",detail:"ë³´ë¬¼ì„ ë…¸ë¦¬ê³  ë¤ë²¼ë“ ë‹¤.",apply:t=>({kind:"BATTLE_SPECIAL",enemyIds:["other_adventurer"],title:"ë³´ë¬¼ì„ ë…¸ë¦¬ëŠ” ëª¨í—˜ê°€"})}]:[{key:"trade",label:"ì¹´ë“œ 1ì¥ ì œê±° í›„ ì¹´ë“œ ë³´ìƒ(2ì¥ ì¤‘ 1ì¥)",apply:t=>(h(t,"ì´ë²¤íŠ¸: ë‹¤ë¥¸ ëª¨í—˜ê°€ ë°œê²¬ â†’ ì œê±°í•  ì¹´ë“œ ì„ íƒ í›„ ë³´ìƒ"),{kind:"REMOVE_PICK",title:"ë‹¤ë¥¸ ëª¨í—˜ê°€ ë°œê²¬",prompt:"ì œê±°í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",then:"REWARD"})},{key:"leave",label:"ì§€ë‚˜ì¹œë‹¤",apply:t=>(h(t,"ì´ë²¤íŠ¸: ë‹¤ë¥¸ ëª¨í—˜ê°€ ë°œê²¬(ìƒëµ)"),"NONE")}]},{id:"ominous_prophecy",name:"ë¶ˆê¸¸í•œ ì˜ˆì–¸",prompt:"ë¶ˆê¸¸í•œ ì†ì‚­ì„ì´ ê·“ê°€ë¥¼ ë§´ëˆë‹¤. ëŒ€ê°€ë¥¼ ì¹˜ë¥´ê³  ë¯¸ë˜ë¥¼ ì—¿ë³¼ê¹Œ?",art:"assets/events/event_ominous_prophecy.png",options:e=>[{key:"omen:listen",label:"ì˜ˆì–¸ì„ ë“£ëŠ”ë‹¤",detail:"F +1. ë‹¤ìŒ ë³´ìŠ¤ë¥¼ í™•ì •í•˜ê³  ê³µê°œí•©ë‹ˆë‹¤.",apply:t=>{if(ct(t,1),h(t,"ë¶ˆê¸¸í•œ ì˜ˆì–¸: F +1"),t.run.nextBossId||(t.run.bossPool.length>0?t.run.nextBossId=fe(t.run.bossPool):t.run.nextBossId=null),!t.run.nextBossId)return h(t,"ì˜ˆì–¸: ë¯¸ë˜ê°€ íë¦¿í•˜ë‹¤. (ë³´ìŠ¤ê°€ ë‚¨ì•„ìˆì§€ ì•ŠìŒ)"),"NONE";t.content.enemiesById[t.run.nextBossId];const n=zo[t.run.nextBossId]??"ì •ì²´ë¶ˆëª…ì˜ ìœ„í˜‘ì´ ë‹¤ê°€ì˜¨ë‹¤.";return t.run.bossOmenText=`${n}`,h(t,`ì˜ˆì–¸: ${n}`),"NONE"}},{key:"omen:ignore",label:"ë¬´ì‹œí•œë‹¤",detail:"ì•„ë¬´ ì¼ë„ ì¼ì–´ë‚˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",apply:t=>(h(t,"ë¶ˆê¸¸í•œ ì˜ˆì–¸(ë¬´ì‹œ)"),"NONE")}]},{id:"rat_circle",name:"ì¥ë“¤ì˜ ì›",prompt:`ì¥ë“¤ì´ ëŒë°”ë‹¥ì— ì›ì„ ë§Œë“ ë‹¤.
ë‹¹ì‹ ì„ ë³´ì ì›ì´ ì»¤ì§„ë‹¤.`,art:"assets/events/event_rat_circle.png",options:e=>{const t=!To(e,"relic_ratskin_charm"),n=[{key:"rat_circle:one",label:"ì¥ë–¼ í•œ ë§ˆë¦¬ì™€ ì‹¸ìš´ë‹¤",detail:"ì „íˆ¬",apply:r=>(h(r,"ì´ë²¤íŠ¸: ì¥ë“¤ì˜ íŒ â†’ ì¥ë–¼ 1"),{kind:"BATTLE_SPECIAL",title:"ì¥ë“¤ì˜ ì›",enemyIds:["rat_swarm"]})}];return t&&n.splice(1,0,{key:"rat_circle:three_for_relic",label:"ìœ ë¬¼ì„ ê±¸ê³  ì¥ë–¼ ì…‹ê³¼ ì‹¸ìš´ë‹¤",detail:"ìŠ¹ë¦¬ ì‹œ ê³ ìœ  ìœ ë¬¼ íšë“",apply:r=>(h(r,"ì´ë²¤íŠ¸: ì¥ë“¤ì˜ íŒ â†’ ì¥ë–¼ 3 (ê³ ìœ  ìœ ë¬¼)"),{kind:"BATTLE_SPECIAL",title:"ì¥ë“¤ì˜ ì›",enemyIds:["rat_swarm","rat_swarm","rat_swarm"],onWinGrantRelicId:"relic_ratskin_charm"})}),n}}];function jo(e){return Xn.find(t=>t.id===e)??null}function xi(){return Object.keys(bo).sort((e,t)=>e.localeCompare(t))}function Ci(){return{cardsById:bo,enemiesById:ga,itemsById:yo}}let vt=!1,vr=null,yt=[],$t=[],Qe=-1;function gi(e){return Array.from(new Set(e)).sort((t,n)=>t.localeCompare(n))}function zr(e,t){return e.toLowerCase().startsWith(t.toLowerCase())}function wi(e){const t=e.content?.itemsById??e.content?.ITEMS_BY_ID??{};return Object.keys(t).sort((n,r)=>n.localeCompare(r))}function Ei(e,t){return!!(e.content?.itemsById??e.content?.ITEMS_BY_ID??{})[t]}function _i(){return[{name:"help",desc:"show commands"},{name:"state",desc:"print game state"},{name:"newrun",desc:"start new run"},{name:"hp",args:"<n>",desc:"set current hp"},{name:"maxhp",args:"<n>",desc:"set max hp"},{name:"supplies",args:"<n>",desc:"set supplies"},{name:"fatigue",args:"<n>",desc:"set fatigue"},{name:"phase",args:"<PLACE|BACK|FRONT|ENEMY|UPKEEP|DRAW|NODE>",desc:"set phase",suggest:()=>["PLACE","BACK","FRONT","ENEMY","UPKEEP","DRAW","NODE"]},{name:"addcard",args:"<defId> [upgrade=0] [zone=deck|hand|discard]",desc:"add card",suggest:(e,t)=>t.length<=2?xi():t.length===4?["deck","hand","discard"]:[]},{name:"removecard",args:"<uid>",desc:"remove card",suggest:e=>gi(Object.keys(e.cards??{}))},{name:"win",desc:"force victory"},{name:"lose",desc:"force defeat"},{name:"log",args:"<text...>",desc:"log message"},{name:"addrelic",args:"<relicId> [now|locked|unlocked]",desc:"grant relic",suggest:(e,t)=>t.length<=2?_a():t.length===3?["now","locked","unlocked"]:[]},{name:"relicapply",desc:"apply pending relic activations"},{name:"gold",args:"<n>",desc:"set gold"},{name:"additem",args:"<itemId> [n=1]",desc:"add item(s) to inventory",suggest:(e,t)=>t.length<=2?wi(e):[]},{name:"faith",desc:"print faith state"},{name:"tempt",args:"<dream_shadow|wing_artery|forge_master>",desc:"open a god temptation choice",suggest:()=>["dream_shadow","wing_artery","forge_master"]}]}function dn(e,t){yt.push({t:Date.now(),kind:e,text:t}),yt.length>300&&(yt=yt.slice(-300))}function Si(e){vr=e}function Ni(){return vt}function Ai(e){vt=!vt,kt()}function kt(){if(document.querySelector(".devConsole")?.remove(),!vt)return;const e=document.createElement("div");e.className="devConsole",e.style.cssText=`
    position: fixed; inset: 0;
    z-index: 60000;
    pointer-events: auto;
    background: rgba(0,0,0,.35);
    backdrop-filter: blur(calc(4 * var(--u)));
    display:flex; align-items:flex-end; justify-content:center;
    padding: calc(12 * var(--u));
    box-sizing: border-box;
  `;const t=document.createElement("div");t.style.cssText=`
    width: min(calc(980 * var(--u)), 100%);
    height: min(calc(420 * var(--u)), 70vh);
    border-radius: calc(16 * var(--u));
    border: calc(1 * var(--u)) solid rgba(255,255,255,.14);
    background: rgba(10,12,14,.92);
    box-shadow: 0 calc(18 * var(--u)) calc(60 * var(--u)) rgba(0,0,0,.55);
    display:flex;
    flex-direction: column;
    overflow:hidden;
  `;const n=document.createElement("div");n.style.cssText=`
    padding: calc(10 * var(--u)) calc(12 * var(--u));
    display:flex; align-items:center; justify-content:space-between;
    border-bottom: calc(1 * var(--u)) solid rgba(255,255,255,.10);
  `;const r=document.createElement("div");r.textContent="Dev Console",r.style.cssText="font-weight:800; color:#fff; opacity:.95;";const o=document.createElement("div");o.style.cssText="display:flex; gap:calc(8 * var(--u));";const s=(b,x)=>{const y=document.createElement("button");return y.type="button",y.textContent=b,y.style.cssText=`
      padding: calc(6 * var(--u)) calc(10 * var(--u));
      border-radius: calc(10 * var(--u));
      border: calc(1 * var(--u)) solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: #fff;
      cursor: pointer;
      font-weight: 700;
    `,y.onclick=x,y};o.appendChild(s("Clear",()=>{yt=[],kt()})),o.appendChild(s("Close",()=>{vt=!1,kt()})),n.appendChild(r),n.appendChild(o);const a=document.createElement("div");a.className="devConsoleOut",a.style.cssText=`
    flex: 1 1 auto;
    padding: calc(10 * var(--u)) calc(12 * var(--u));
    overflow: auto;
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: calc(12 * var(--u));
    line-height: 1.4;
    color: #ddd;
    white-space: pre-wrap;
  `;const i=b=>(b.kind==="in"?"> ":b.kind==="err"?"! ":"  ")+b.text;a.textContent=yt.map(i).join(`
`),queueMicrotask(()=>{a.scrollTop=a.scrollHeight});const l=document.createElement("div");l.style.cssText=`
    border-top: calc(1 * var(--u)) solid rgba(255,255,255,.10);
    padding: calc(10 * var(--u)) calc(12 * var(--u));
    display:flex; gap:calc(10 * var(--u)); align-items:center;
  `;const c=document.createElement("div");c.className="devConsoleHint",c.style.cssText=`
    margin-left: calc(10 * var(--u));
    max-width: 45%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    color: rgba(255,255,255,.55);
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: calc(12 * var(--u));
  `;const d=document.createElement("div");d.textContent=">",d.style.cssText="color:#fff; font-weight:900; opacity:.9;";const p=document.createElement("input");p.type="text",p.placeholder="help / state / newrun ...",p.style.cssText=`
    flex: 1 1 auto;
    padding: calc(10 * var(--u)) calc(12 * var(--u));
    border-radius: calc(12 * var(--u));
    border: calc(1 * var(--u)) solid rgba(255,255,255,.14);
    background: rgba(255,255,255,.06);
    color: #fff;
    outline: none;
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: calc(13 * var(--u));
  `;const u=_i();let k={base:"",items:[],idx:-1,lastApplied:""};const T=b=>{const x=vr?.getG();if(!x)return[];const y=b.split(/\s+/).filter(Boolean),N=/\s$/.test(b);if(y.length===0)return u.map(w=>w.name);if(y.length===1&&!N){const w=y[0];return u.map(E=>E.name).filter(E=>zr(E,w))}const W=(y[0]??"").toLowerCase(),C=u.find(w=>w.name===W);if(!C?.suggest)return[];const O=N?"":y[y.length-1]??"";return C.suggest(x,y).filter(w=>zr(w,O))},m=(b,x)=>{const y=/\s$/.test(b);if(!b.trim())return x+" ";const N=b.split(/\s+/);return y?b+x+" ":(N[N.length-1]=x,N.join(" ")+" ")},f=()=>{const b=T(p.value);if(!b.length){c.textContent="";return}const x=b.slice(0,6);c.textContent=x.join("  ")};p.onkeydown=b=>{if(b.key==="Escape"){vt=!1,kt();return}if(b.key==="Enter"){const x=p.value.trim();if(!x)return;p.value="",$t.unshift(x),Qe=-1,dn("in",x);try{$i(x)}catch(y){dn("err",String(y?.message??y))}kt();return}if(b.key==="ArrowUp"){b.preventDefault();const x=$t.length;if(x===0)return;Qe=Math.min(x-1,Qe+1),p.value=$t[Qe]??"";return}if(b.key==="ArrowDown"){if(b.preventDefault(),$t.length===0)return;Qe=Math.max(-1,Qe-1),p.value=Qe>=0?$t[Qe]??"":"";return}if(b.key==="Tab"){b.preventDefault();const x=b.shiftKey===!0,y=p.value;if(!(k.items.length>0&&(y===k.lastApplied||y===k.base))){const O=T(y);k.base=y,k.items=O,k.idx=-1,k.lastApplied=y}if(!k.items.length){f();return}x?k.idx=(k.idx-1+k.items.length)%k.items.length:k.idx=(k.idx+1)%k.items.length;const W=k.items[k.idx],C=m(k.base,W);p.value=C,k.lastApplied=C,f();return}},p.oninput=()=>{k.items=[],k.base="",k.idx=0,f()},l.appendChild(d),l.appendChild(p),l.appendChild(c),t.appendChild(n),t.appendChild(a),t.appendChild(l),t.onclick=b=>b.stopPropagation(),e.appendChild(t),document.body.appendChild(e),f(),queueMicrotask(()=>p.focus())}function $i(e){const t=vr;if(!t){dn("err","Dev console context not set");return}const n=t.getG(),r=e.split(/\s+/).filter(Boolean),o=(r[0]??"").toLowerCase(),s=r[1],a=r[2],i=c=>dn("out",c);if(o==="help"){i(["help","state","newrun","hp <n> | maxhp <n> | supplies <n> | fatigue <n>","phase <PLACE|BACK|FRONT|ENEMY|UPKEEP|DRAW|NODE>","addcard <defId> [upgrade=0] [zone=deck|hand|discard]","removecard <uid>","addrelic <relicId> [now|locked|unlocked]","relicapply  (apply pending relic activations)","win | lose","log <text...>","gold <n>","additem <itemId> [n=1]","faith","tempt <dream_shadow|wing_artery|forge_master>"].join(`
`));return}if(o==="state"){i(JSON.stringify({phase:n.phase,hp:`${n.player.hp}/${n.player.maxHp}`,supplies:n.player.supplies,fatigue:n.player.fatigue,deck:n.deck.length,hand:n.hand.length,discard:n.discard.length,enemies:n.enemies.map(c=>({id:c.id,hp:`${c.hp}/${c.maxHp}`,intent:c.intentIndex})),gold:n.run.gold??0,items:n.run.items??[]},null,2));return}if(o==="faith"){const c=pe(n);i(JSON.stringify({chosen:c.chosen,offered:c.offered.map(Te),points:Object.fromEntries(c.offered.map(d=>[Te(d),c.points[d]??0])),focus:Te(c.focus),patron:(c.points[c.focus]??0)>=3?Te(c.focus):null},null,2));return}if(o==="tempt"){const c=s??"";if(!c){i("ERR: tempt <dream_shadow|wing_artery|forge_master>");return}Mo(n,c),t.rerender(),i(`OK: tempt ${c}`);return}if(o==="newrun"){t.actions.onNewRun(),i("OK: newrun");return}const l=(c,d)=>{const p=Number(s);if(!Number.isFinite(p)){i(`ERR: ${c} requires number`);return}d(p),t.rerender(),i(`OK: ${c} = ${p}`)};if(o==="hp")return l("hp",c=>n.player.hp=Math.max(0,Math.min(n.player.maxHp,c)));if(o==="maxhp")return l("maxHp",c=>{n.player.maxHp=Math.max(1,c),n.player.hp=Math.min(n.player.hp,n.player.maxHp)});if(o==="supplies")return l("supplies",c=>n.player.supplies=Math.max(0,c));if(o==="fatigue")return l("fatigue",c=>n.player.fatigue=Math.max(0,c));if(o==="phase"){const c=(s??"").toUpperCase();if(!new Set(["PLACE","BACK","FRONT","ENEMY","UPKEEP","DRAW","NODE"]).has(c)){i("ERR: phase invalid");return}n.phase=c,t.rerender(),i(`OK: phase=${c}`);return}if(o==="log"){const c=e.slice(e.indexOf(" ")+1);if(!c||c===e){i("ERR: log <text...>");return}t.log?.(`[DEV] ${c}`),i("OK: logged");return}if(o==="addcard"){const c=s;if(!c){i("ERR: addcard <defId> [upgrade=0] [zone=deck|hand|discard]");return}const d=Math.max(0,Number(a??"0")||0),p=r[3]??"deck";dt(n,c,{upgrade:d});const u=n.deck[n.deck.length-1];u&&p!=="deck"&&(n.deck=n.deck.filter(k=>k!==u),p==="hand"?n.hand.push(u):p==="discard"&&n.discard.push(u),n.cards[u].zone=p),t.log?.(`[DEV] addcard ${c} +${d} (${p}) uid=${u}`),t.rerender(),i(`OK: addcard uid=${u}`);return}if(o==="removecard"){const c=s;if(!c){i("ERR: removecard <uid>");return}if(!n.cards[c]){i(`ERR: uid not found: ${c}`);return}const d=n.deck.includes(c),p=n.hand.includes(c),u=n.discard.includes(c);!d&&!p&&!u&&i(`WARN: uid exists but not in piles (deck/hand/discard): ${c} (zone=${n.cards[c]?.zone??"?"})`),Bt(n,c),t.log?.(`[DEV] removecard ${c}`),t.rerender(),i("OK: removecard");return}if(o==="addrelic"){const c=s,d=(a??"").toLowerCase();if(!c){i("ERR: addrelic <relicId> [now|locked|unlocked]");return}rn(n,c);const p=n.run;if(p.forceLockedRelics??={},p.forceUnlockedRelics??={},d==="locked"){p.forceLockedRelics[c]=!0,delete p.forceUnlockedRelics[c],p.relicRuntime??={},p.relicRuntime[c]??={active:!1,pending:!1,obtainedAtNode:n.run.nodePickCount},p.relicRuntime[c].active=!1,p.relicRuntime[c].pending=!1,t.log?.(`[DEV] addrelic ${c} (locked)`),t.rerender(),i(`OK: addrelic ${c} (locked)`);return}if(d==="unlocked"){p.forceUnlockedRelics[c]=!0,delete p.forceLockedRelics[c],t.log?.(`[DEV] addrelic ${c} (unlocked)`),t.rerender(),i(`OK: addrelic ${c} (unlocked)`);return}d==="now"&&be(n),t.log?.(`[DEV] addrelic ${c}${d?` (${d})`:""}`),t.rerender(),i(`OK: addrelic ${c}`);return}if(o==="relicapply"){be(n),t.log?.("[DEV] relicapply"),t.rerender(),i("OK: relicapply");return}if(o==="gold")return l("gold",c=>{const d=n.run;d.gold=Math.max(0,c|0)});if(o==="additem"){const c=s,d=Math.max(1,Number(a??"1")||1);if(!c){i("ERR: additem <itemId> [n=1]");return}Ei(n,c)||i(`WARN: unknown itemId (still adding): ${c}`);const p=n.run;p.items??=[];for(let u=0;u<d;u++)p.items.push(c);t.log?.(`[DEV] additem ${c} x${d}`),t.rerender(),i(`OK: additem ${c} x${d}`);return}if(o==="win"){if(!n.enemies||n.enemies.length===0){i("WARN: enemies=0");return}for(const c of n.enemies)c.hp=0;n.enemies=[],n.pendingTarget=null,n.pendingTargetQueue=[],n.selectedEnemyIndex=null,wt(n),t.log?.("[DEV] win"),t.rerender(),i("OK: win");return}if(o==="lose"){n.run.finished=!0,t.log?.("[DEV] lose"),t.rerender(),i("OK: lose");return}i(`Unknown command: ${o} (try: help)`)}function jr(e,t){e.includes(t)||e.push(t)}function Rn(e,t,n){e[t]??=[],e[n]??=[],jr(e[t],n),jr(e[n],t)}function Mi(e,t,n){return(e[t]??[]).includes(n)}function Qt(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}function qr(e){return e[Math.floor(Math.random()*e.length)]}function Pi(e){const t=Math.floor((e+1)/2),r=Math.round((Math.max(4,e)-1)/3.2)+1,o=12,s=Math.min(t,32),a=Math.max(o,Math.min(s,r));return Math.max(3,Math.min(t,a))}function Ii(e){let n=Pi(e);for(;n>2&&1+2*(n-1)>e;)n-=1;const r=Math.floor((e+1)/2);for(;n<r&&1+4*(n-1)<e;)n+=1;const o=4,s=new Array(n).fill(2);s[0]=1;let a=e-(1+2*(n-1));for(;a>0;){const i=1+Math.floor(Math.random()*(n-1));s[i]>=o||(s[i]+=1,a-=1)}for(let i=0;i<24;i++){const l=1+Math.floor(Math.random()*(n-1)),c=1+Math.floor(Math.random()*(n-1));l!==c&&(s[l]<=2||s[c]>=o||Math.random()<.5&&(s[l]-=1,s[c]+=1))}return s}function Ri(e){const n=Math.max(18,Math.floor(8.64)),r=Math.max(2,Math.floor(72/15)),o={},s={},a=Ii(72),i=[];let l=0;for(let v=0;v<a.length;v++){const _=a[v],M=[];for(let z=0;z<_;z++){const P=`n${l++}`;M.push(P)}i.push(M)}for(;l<72;)i[i.length-1].length>=4&&i.push([]),i[i.length-1].push(`n${l++}`);for(let v=0;v<i.length;v++){const _=i[v];for(let M=0;M<_.length;M++){const z=_[M];o[z]={id:z,kind:v===0&&M===0?"START":"BATTLE",depth:v,order:M,visited:v===0&&M===0,cleared:v===0&&M===0,reprocCount:0,lastProcTime:-999},s[z]=[]}}const c=i.slice(0,-1).map(()=>[]),d=(v,_)=>{if(Mi(s,v,_))return!1;const M=o[v]?.depth??0,z=o[_]?.depth??0;if(Math.abs(M-z)!==1)return!1;const P=Math.min(M,z),ne=M<z?v:_,S=M<z?_:v,A=o[ne]?.order??0,j=o[S]?.order??0;for(const[I,U]of c[P])if(A<I&&j>U||A>I&&j<U)return!1;return Rn(s,ne,S),c[P].push([A,j]),!0};for(let v=0;v<i.length-1;v++){const _=i[v],M=i[v+1];for(let P=0;P<M.length;P++){const ne=Math.floor(P*_.length/M.length),S=(Math.random()<.5?-1:1)*(Math.random()<.35?1:0),A=Math.max(0,Math.min(_.length-1,ne+S));d(_[A],M[P])}const z=.35;for(let P=0;P<_.length;P++){if(Math.random()>z)continue;const ne=Math.floor(P*M.length/_.length),S=(Math.random()<.5?-1:1)*(Math.random()<.35?1:0),A=Math.max(0,Math.min(M.length-1,ne+S));d(_[P],M[A])}}i.length>=2&&i[1].length>=2&&d(i[0][0],i[1][i[1].length-1]);const p=Math.max(0,Math.min(n,144));let u=0,k=0;for(;u<p&&k++<8e3;){const v=Math.floor(Math.random()*(i.length-1)),_=i[v],M=i[v+1],z=_[Math.floor(Math.random()*_.length)],P=M[Math.floor(Math.random()*M.length)];d(z,P)&&(u+=1)}const T=.25;for(let v=0;v<i.length;v++){const _=i[v];if(_.length<2)continue;const M=Math.floor(Math.random()*(_.length-1));Rn(s,_[M],_[M+1]);for(let z=0;z<_.length-1;z++)z!==M&&Math.random()<T&&Rn(s,_[z],_[z+1])}const m={nodes:o,edges:s,startId:i[0][0],pos:i[0][0],treasureId:null,visionNonce:0},f=[],b=Math.max(2,Math.floor(i.length*.85)),x=Math.max(b,Math.floor(i.length*1)-1);for(let v=b;v<=x&&v<i.length;v++)for(const _ of i[v])f.push(_);const y=f.length?qr(f):"n71";m.treasureId=y,o[y].kind="TREASURE";const N=Object.keys(o).filter(v=>v!==m.startId&&v!==y);Qt(N);const W=5,C=new Set;i.length>1&&C.add(1);const O=[];for(let v=2;v<i.length;v++)O.push(v);Qt(O);for(const v of O){if(C.size>=Math.min(W,Math.max(0,i.length-1)))break;C.add(v)}const $=2,w=new Set,E=o[y]?.depth??-1,R=[];for(let v=2;v<i.length;v++)C.has(v)||v!==E&&R.push(v);Qt(R);for(const v of R){if(w.size>=Math.min($,R.length))break;w.add(v)}const D=N.filter(v=>(o[v]?.depth??0)>=2).filter(v=>!C.has(o[v]?.depth??0)).filter(v=>!w.has(o[v]?.depth??0));Qt(D);const V=new Set(D.slice(0,Math.min(r,D.length))),ee=4,H={battleMul:.25,eventMul:1.35,restMul:1.55},K=v=>s[v]?.length??0,Z=new Set(Object.keys(o).filter(v=>v===m.startId||(o[v]?.depth??0)<ee?!1:K(v)===1)),X=(v,_)=>{let M=.5,z=.25,P=.2,ne=.05;v<=1?(M=.8,z=.14,P=.04,ne=.02):v<=3?(M=.7,z=.16,P=.08,ne=.06):(M=.6,z=.2,P=.12,ne=.08),_&&(M*=H.battleMul??.25,z*=H.eventMul??1.35,P*=H.restMul??1.8,ne*=.8);const S=M+z+P+ne,A=Math.random()*S;return A<M?"BATTLE":A<M+z?"EVENT":A<M+z+P?"REST":"SHOP"};for(const v of N){const _=o[v]?.depth??0;if(w.has(_)){o[v].kind="REST";continue}if(C.has(_)){o[v].kind="BATTLE";continue}if(V.has(v)){o[v].kind="ELITE";continue}o[v].kind=X(_,Z.has(v))}if(!Object.values(o).some(_=>_.kind==="SHOP")){const _=Object.keys(o).filter(M=>M!==m.startId&&M!==y).filter(M=>(o[M]?.depth??0)>=2).filter(M=>o[M].kind!=="ELITE"&&o[M].kind!=="TREASURE").filter(M=>!C.has(o[M]?.depth??0));if(_.length){const M=qr(_);o[M].kind="SHOP"}}return m}function Li(e){return e.uidSeq+=1,String(e.uidSeq)}function Bi(){return{relicRuntime:{},pendingRelicActivations:[],unlock:{rest:0,eliteWins:0,tookBigHit10:0,kills:0,endedTurnWeak:0,eventPicks:0,hpLeq15:0,skippedTurn:0,bleedApplied:0,endedTurnSupplyZero:0},timeMove:0,slotCapFront:3,slotCapBack:3,bossKillCount:0,bossSlotFirstPick:null,map:Ri(),pursuit:{heat:0},vision:{mode:"NORMAL",blind:!1,presenceR:2,typeR:2,detailR:0,noise:0},encounterCount:0,treasureObtained:!1,afterTreasureNodePicks:0,nodeOfferQueue:[],finished:!1,nodePickCount:0,nodePickByType:{BATTLE:0,ELITE:0,REST:0,EVENT:0,TREASURE:0,SHOP:0},currentNodeOffers:null,nextBattleSuppliesBonus:0,bossPool:["boss_gravity_master","boss_cursed_wall","boss_giant_orc","boss_soul_stealer"],branchOffer:null,battleCount:0,enemyLastSeenBattle:{},nextBossId:null,nextBossTime:40,forcedNext:null,bossOmenText:null,deckSizeAtTreasure:null,ominousProphecySeen:!1,relics:[],items:[],itemCap:2,lastBattleWasElite:!1,lastBattleWasBoss:!1,eliteRelicOfferedThisBattle:!1,itemOfferedThisBattle:!1,pendingElite:!1,rewardPityNonElite:0,gold:0,shops:{}}}function Qn(e){const t={uidSeq:0,combatTurn:0,intentsRevealedThisTurn:!1,disruptIndexThisTurn:null,attackedEnemyIndicesThisTurn:[],phase:"NODE",log:[],run:Bi(),player:{hp:60,maxHp:60,block:0,supplies:7,fatigue:0,zeroSupplyTurns:0,status:{vuln:0,weak:0,bleed:0,disrupt:0},immuneToDisruptThisTurn:!1,nullifyDamageThisTurn:!1},content:e,cards:{},deck:[],hand:[],discard:[],exhausted:[],vanished:[],frontSlots:[null,null,null],backSlots:[null,null,null],backSlotDisabled:[!1,!1,!1],enemies:[],usedThisTurn:0,frontPlacedThisTurn:0,selectedHandCardUid:null,winHooksAppliedThisCombat:!1,drawCountThisTurn:0,pendingTarget:null,pendingTargetQueue:[],backUidsThisTurn:[],placedUidsThisTurn:[],installAgeByUid:{},victoryResolvedThisCombat:!1,time:0,choice:null,choiceQueue:[],choiceStack:[],choiceCtx:null,selectedEnemyIndex:null,_justStartedCombat:!1};return Hi(t),h(t,"ìƒˆ ëŸ° ì‹œì‘."),pe(t),$o(t),t}function mt(e,t,n){for(let r=0;r<n;r++){const o=Li(e),s={uid:o,defId:t,zone:"deck",upgrade:0};e.cards[o]=s,e.deck.push(o)}}function Hi(e){mt(e,"field_ration",2),mt(e,"maintenance",2),mt(e,"scout",2),mt(e,"shield",2),mt(e,"power_arrow",1),mt(e,"arrow",3),e.deck=cr(e.deck)}function et(e){return Number(e.run.gold??0)||0}function at(e,t){const n=Number(t)||0;if(n===0)return;const r=et(e);e.run.gold=r+n;const o=n>0?"+":"";Y(e,"GOLD","ğŸª™ "+o+n,1400)}function qo(e){return Number(e.run.nextBattleSuppliesBonus??0)||0}function Vr(e,t){let r=qo(e)+(Number(t)||0);r<-7&&(r=-7),e.run.nextBattleSuppliesBonus=r}function Oi(e){return Math.max(0,7+qo(e))}function Ln(e,t){if(!t)return;const n=e.player.fatigue??0;n<10||(e.player.fatigue=Math.max(0,n-2),e.time=(e.time??0)+1,h(e,"í”¼ë¡œê°€ ë„ˆë¬´ ë†’ì•„ íœ´ì‹ì´ ë” ì˜¤ë˜ ê±¸ë¦½ë‹ˆë‹¤. (F -2, ì‹œê°„ +1)"))}function Vo(e){let t=Object.values(e.cards).filter(a=>(a.zone==="deck"||a.zone==="hand"||a.zone==="discard")&&qt(e,a.uid)).map(a=>a.uid);const n=e.player.fatigue??0;let r=1/0;return n>=8?r=4:n>=5&&(r=8),r!==1/0&&t.length>r&&(t=[...t].sort(()=>Math.random()-.5).slice(0,r)),t.length===0?null:{kind:"UPGRADE_PICK",title:"ê°•í™”",prompt:"ê°•í™”í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",options:[...[...t].sort((a,i)=>{const l=e.cards[a],c=e.cards[i],d=e.content.cardsById[l.defId]?.name??l.defId,p=e.content.cardsById[c.defId]?.name??c.defId,u=d.localeCompare(p,"ko");return u!==0?u:(l.upgrade??0)-(c.upgrade??0)}).map(a=>{const i=e.cards[a],l=xe(e.content,i.defId,i.upgrade??0),c=xe(e.content,i.defId,(i.upgrade??0)+1),d=e.content.cardsById[i.defId]?.name??i.defId,p=(i.upgrade??0)>0?`${d} +${i.upgrade}`:d,u=`í˜„ì¬: ì „ì—´ ${l.frontText} / í›„ì—´ ${l.backText}
ê°•í™”: ì „ì—´ ${c.frontText} / í›„ì—´ ${c.backText}`;return{key:`up:${a}`,label:p,detail:u,cardUid:a}}),{key:"skip",label:"ì·¨ì†Œ"}]}}function Di(e,t,n){const r="goal_treasure",o=Object.values(e.cards).filter(a=>(a.zone==="deck"||a.zone==="hand"||a.zone==="discard")&&a.defId!==r).map(a=>a.uid);if(o.length===0)return null;const s=[...o.map(a=>{const i=e.cards[a],l=xe(e.content,i.defId,i.upgrade??0),c=e.content.cardsById[i.defId]?.name??i.defId,d=(i.upgrade??0)>0?`${c} +${i.upgrade}`:c;return{key:`remove:${a}`,label:d,detail:`ì „ì—´: ${l.frontText} / í›„ì—´: ${l.backText}`,cardUid:a}}),{key:"skip",label:"ì·¨ì†Œ"}];return{kind:"REMOVE_PICK",title:t,prompt:n,options:s}}function Fi(e,t){const n=e.choiceCtx&&e.choiceCtx.kind==="REST"&&typeof e.choiceCtx.highF=="boolean"?e.choiceCtx.highF:(e.player.fatigue??0)>=10;if(t.startsWith("rest:")){const r=_e(e);r.rest+=1,Ae(e)}if(t==="rest:heal")return Ln(e,n),rs(e).healed||(ut(e,15),h(e,"íœ´ì‹: HP +15")),he(e),e.phase="NODE",be(e),!0;if(t==="rest:clear_f")return Ln(e,n),e.player.fatigue=Math.max(0,(e.player.fatigue??0)-3),h(e,"íœ´ì‹: í”¼ë¡œ F-=3"),he(e),e.phase="NODE",be(e),!0;if(t==="rest:upgrade"){if(wn(e))return h(e,"ê°•í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."),he(e),e.phase="NODE",be(e),!0;os(e);const s=[...Object.values(e.cards).filter(l=>l.zone==="deck"||l.zone==="hand"||l.zone==="discard").filter(l=>qt(e,l.uid)).map(l=>{const c=xe(e.content,l.defId,l.upgrade??0),d=e.content.cardsById[l.defId]?.name??l.defId,p=(l.upgrade??0)>0?`${d} +${l.upgrade}`:d;return{key:`up:${l.uid}`,label:p,detail:`ì „ì—´: ${c.frontText} / í›„ì—´: ${c.backText}`,cardUid:l.uid}}),{key:"skip",label:"ì·¨ì†Œ"}],a=e.choice,i=e.choiceCtx;return qe(e,{kind:"UPGRADE_PICK",title:"ê°•í™”",prompt:"ê°•í™”í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",options:s},{kind:"UPGRADE_PICK",returnChoice:a,returnCtx:i}),!0}return t==="rest:skip"?(Ln(e,n),h(e,"íœ´ì‹: ìƒëµ"),he(e),e.phase="NODE",be(e),!0):!1}function Wi(e,t){if(!e.choiceCtx||e.choiceCtx.kind!=="SHOP")return!1;const n=String(e.choiceCtx.nodeId??"");if(!n)return!1;const r=e.run;r.shops??={};const o=r.shops[n];if(!o)return se(e,n),!0;if(t==="shop:leave")return h(e,"ìƒì : ë– ë‚œë‹¤."),he(e),e.phase="NODE",!0;if(t==="shop:sep"||t.startsWith("shop:sep:"))return se(e,n),!0;if(t.startsWith("shop:card:")){const s=Number(t.slice(10)),a=o.cards?.[s];if(!a)return h(e,"ìƒì : ì•Œ ìˆ˜ ì—†ëŠ” ì¹´ë“œ ì„ íƒì…ë‹ˆë‹¤."),se(e,n),!0;if(a.sold)return h(e,"ìƒì : í’ˆì ˆë˜ì—ˆìŠµë‹ˆë‹¤."),se(e,n),!0;const i=We(e,Number(a.priceGold??0)||0);return et(e)<i?(h(e,"ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."),se(e,n),!0):(at(e,-i),dt(e,a.defId,{upgrade:Number(a.upgrade??0)||0}),a.sold=!0,h(e,`ìƒì : ì¹´ë“œ êµ¬ë§¤ (-ğŸª™${i})`),se(e,n),!0)}if(t.startsWith("shop:item:")){const s=Number(t.slice(10)),a=o.items?.[s];if(!a)return h(e,"ìƒì : ì•Œ ìˆ˜ ì—†ëŠ” ì•„ì´í…œ ì„ íƒì…ë‹ˆë‹¤."),se(e,n),!0;if(a.sold)return h(e,"ìƒì : í’ˆì ˆë˜ì—ˆìŠµë‹ˆë‹¤."),se(e,n),!0;if(Hr(e)||Hr(e))return h(e,"ì•„ì´í…œ ê°€ë°©ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤. ë¨¼ì € ë²„ë¦¬ê±°ë‚˜(ìš°í´ë¦­) ì‚¬ìš©í•˜ì„¸ìš”."),Y(e,"WARN","ì•„ì´í…œ ê°€ë°©ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤.",1600),se(e,n),!0;const i=We(e,Number(a.priceGold??0)||0);if(et(e)<i)return h(e,"ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."),se(e,n),!0;if(at(e,-i),!Gn(e,String(a.itemId),"SHOP"))return at(e,i),h(e,"ìƒì : ì•„ì´í…œ êµ¬ë§¤ ì‹¤íŒ¨(í™˜ë¶ˆ)"),se(e,n),!0;a.sold=!0;const c=He(String(a.itemId))?.name??String(a.itemId);return h(e,`ìƒì : ì•„ì´í…œ êµ¬ë§¤ (${c}) (-ğŸª™${i})`),se(e,n),!0}if(t==="shop:supply:buy"){const s=We(e,6),a=3;return et(e)<s?(h(e,"ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."),se(e,n),!0):(at(e,-s),Vr(e,a),h(e,`ìƒì : ë³´ê¸‰ êµ¬ë§¤ (-ğŸª™${s}, ë‹¤ìŒ ì „íˆ¬ ğŸ +${a})`),se(e,n),!0)}if(t==="shop:supply:sell")return Oi(e)<3?(h(e,"ë‹¤ìŒ ì „íˆ¬ ë³´ê¸‰ì´ ë¶€ì¡±í•˜ì—¬ íŒë§¤í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."),se(e,n),!0):(Vr(e,-3),at(e,4),h(e,"ìƒì : ë³´ê¸‰ íŒë§¤ (ë‹¤ìŒ ì „íˆ¬ ğŸ -3, ğŸª™ +4)"),se(e,n),!0);if(t==="shop:service:upgrade"){if(o.usedUpgrade)return h(e,"ìƒì : ê°•í™”ëŠ” ì´ ìƒì ì—ì„œ ì´ë¯¸ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤."),se(e,n),!0;const s=We(e,25);if(et(e)<s)return h(e,"ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."),se(e,n),!0;const a=Vo(e);return a?(qe(e,a,{kind:"UPGRADE_PICK",returnTo:{kind:"SHOP",nodeId:n},priceGold:s}),!0):(h(e,"ê°•í™”í•  ìˆ˜ ìˆëŠ” ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤."),se(e,n),!0)}if(t==="shop:service:remove"){if(o.usedRemove)return h(e,"ìƒì : ì œê±°ëŠ” ì´ ìƒì ì—ì„œ ì´ë¯¸ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤."),se(e,n),!0;const s=We(e,25);if(et(e)<s)return h(e,"ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."),se(e,n),!0;const a=Di(e,"ìƒì : ì¹´ë“œ ì œê±°","ì œê±°í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.");return a?(qe(e,a,{kind:"REMOVE_PICK",returnTo:{kind:"SHOP",nodeId:n},priceGold:s}),!0):(h(e,"ì œê±°í•  ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤."),se(e,n),!0)}return t.startsWith("shop:")?(h(e,`ìƒì : ì•Œ ìˆ˜ ì—†ëŠ” ì„ íƒ (${t})`),se(e,n),!0):!1}function Ui(e,t){if(!e.choiceCtx||e.choiceCtx.kind!=="EVENT")return!1;const n=jo(e.choiceCtx.eventId);if(!n)return!1;const o=n.options(e).find(i=>i.key===t);if(!o)return!1;const s=_e(e);s.eventPicks+=1,Ae(e);const a=o.apply(e);if(a&&typeof a=="object"&&a.kind==="UPGRADE_PICK"){const i=Vo(e);return i?(qe(e,i,null),!0):(h(e,"ê°•í™”í•  ìˆ˜ ìˆëŠ” ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤."),he(e),e.phase="NODE",be(e),!0)}if(a&&typeof a=="object"&&a.kind==="REMOVE_PICK"){const l=[...Object.values(e.cards).filter(c=>c.zone==="deck"||c.zone==="hand"||c.zone==="discard").map(c=>c.uid).map(c=>{const d=e.cards[c],p=xe(e.content,d.defId,d.upgrade??0),u=e.content.cardsById[d.defId]?.name??d.defId,k=(d.upgrade??0)>0?`${u} +${d.upgrade}`:u;return{key:`remove:${c}`,label:k,detail:`ì „ì—´: ${p.frontText} / í›„ì—´: ${p.backText}`,cardUid:c}}),{key:"skip",label:"ì·¨ì†Œ"}];return qe(e,{kind:"REMOVE_PICK",title:a.title??"ì œê±°",prompt:a.prompt??"ì œê±°í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",options:l},null),!0}return he(e),e.phase="NODE",be(e),!0}function Ki(e,t){const n=e.choice;if(!n)return!1;if(t==="close")return he(e),!0;if(n.kind==="REWARD")return Fs(e,t);if(n.kind==="FAITH"){if(!e.choiceCtx||e.choiceCtx.kind!=="FAITH_START"||!t.startsWith("faith:choose:"))return!1;const o=t.slice(13);return ja(e,o),pe(e),he(e),e.phase="NODE",be(e),!0}if(n.kind==="GOD_TEMPT"){const o=e.choiceCtx;if(!o||o.kind!=="GOD_TEMPT")return!1;const s=o.tempter;if(t==="tempt:reject")return h(e,`ìœ í˜¹ ê±°ë¶€: ${Te(s)}`),he(e),e.phase="NODE",be(e),!0;if(t==="tempt:accept"){const a=o.tempter;if(a==="first_human"){e.player.fatigue=(e.player.fatigue??0)+3,h(e,"ìœ í˜¹: í”¼ë¡œ +3"),Ir(e,a);const l=[...Object.values(e.cards).filter(c=>(c.zone==="deck"||c.zone==="hand"||c.zone==="discard")&&c.defId!=="goal_treasure").map(c=>c.uid).map(c=>{const d=e.cards[c],p=xe(e.content,d.defId,d.upgrade??0),u=e.content.cardsById[d.defId]?.name??d.defId,k=(d.upgrade??0)>0?`${u} +${d.upgrade}`:u;return{key:`dup:${c}`,label:k,detail:`ì „ì—´: ${p.frontText} / í›„ì—´: ${p.backText}`,cardUid:c}}),{key:"skip",label:"ë³µì œí•˜ì§€ ì•ŠëŠ”ë‹¤"}];return qe(e,{kind:"PICK_CARD",title:"ë³µì œ",prompt:"ë³µì œí•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",options:l},{kind:"FIRST_HUMAN_DUP"}),!0}return Ir(e,a),Ga(e,a),he(e),e.phase="NODE",be(e),!0}return!1}if(e.choiceCtx?.kind==="PICK_VANISHED_TO_HAND"){if(t==="cancel")return he(e),!0;if(t.startsWith("pickVanished:")){const o=t.slice(13),s=e.cards[o];if(s&&s.zone==="vanished"){s.zone="hand",e.hand.includes(o)||e.hand.push(o),e.vanished=e.vanished.filter(l=>l!==o);const i=e.content.cardsById[s.defId]?.name??s.defId;h(e,`ì†Œì‹¤ ì¹´ë“œ íšŒìˆ˜: ${i}`)}return he(e),!0}return!1}if(n.kind==="PICK_CARD"){if(e.choiceCtx?.kind!=="FIRST_HUMAN_DUP")return!1;if(t==="skip")return h(e,"ë³µì œ ì·¨ì†Œ"),he(e),e.phase="NODE",be(e),!0;if(t.startsWith("dup:")){const s=t.slice(4),a=e.cards[s];if(!a)h(e,"ë³µì œ ì‹¤íŒ¨: ì¹´ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");else{dt(e,a.defId,{upgrade:Number(a.upgrade??0)||0});const i=e.content.cardsById[a.defId]?.name??a.defId,l=(a.upgrade??0)>0?`${i} +${a.upgrade}`:i;h(e,`ìœ í˜¹: ì¹´ë“œ ë³µì œ (${l})`)}return he(e),e.phase="NODE",be(e),!0}return!1}if(n.kind==="MADNESS_TEMPT"){const o=e.choiceCtx;return!o||o.kind!=="MADNESS_TEMPT"?!1:t==="madness:accept"?(Qa(e,o.offerBoon),he(e),e.phase="NODE",be(e),!0):t==="madness:reject"?(Za(e,o.offerBane),he(e),e.phase="NODE",be(e),!0):!1}if(n.kind==="UPGRADE_PICK"){if(t==="skip"){const o=e.choiceCtx;return o?.returnTo?.kind==="SHOP"&&o?.returnTo?.nodeId?(h(e,"ìƒì : ê°•í™” ì·¨ì†Œ"),se(e,String(o.returnTo.nodeId)),!0):o?.returnChoice?(h(e,"ê°•í™” ì·¨ì†Œ"),qe(e,o.returnChoice,o.returnCtx??null),!0):(h(e,"ê°•í™” ì·¨ì†Œ"),he(e),e.phase="NODE",be(e),!0)}if(t.startsWith("up:")){const o=t.slice(3),s=e.choiceCtx;if(s?.returnTo?.kind==="SHOP"&&s?.returnTo?.nodeId){const i=String(s.returnTo.nodeId),l=Number(s?.priceGold??0)||0;if(l>0){if(et(e)<l)return h(e,"ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."),se(e,i),!0;at(e,-l)}const c=Ht(e,o),p=e.run.shops?.[i];return c&&p&&(p.usedUpgrade=!0),h(e,c?"ìƒì : ê°•í™” ì™„ë£Œ":"ìƒì : ê°•í™” ì‹¤íŒ¨"),se(e,i),!0}const a=Ht(e,o);return h(e,a?"ê°•í™” ì™„ë£Œ":"ê°•í™” ì‹¤íŒ¨"),he(e),e.phase="NODE",be(e),!0}return!1}if(n.kind==="REMOVE_PICK"){if(t==="skip"){const o=e.choiceCtx;return o?.returnTo?.kind==="SHOP"&&o?.returnTo?.nodeId?(h(e,"ìƒì : ì œê±° ì·¨ì†Œ"),se(e,String(o.returnTo.nodeId)),!0):(h(e,"ì œê±° ì·¨ì†Œ"),he(e),e.phase="NODE",be(e),!0)}if(t.startsWith("remove:")){const o=t.slice(7),s=e.choiceCtx;if(s?.returnTo?.kind==="SHOP"&&s?.returnTo?.nodeId){const a=String(s.returnTo.nodeId),i=Number(s?.priceGold??0)||0;if(i>0){if(et(e)<i)return h(e,"ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."),se(e,a),!0;at(e,-i)}Bt(e,o);const c=e.run.shops?.[a];return c&&(c.usedRemove=!0),h(e,"ìƒì : ì¹´ë“œë¥¼ ì œê±°í–ˆìŠµë‹ˆë‹¤."),se(e,a),!0}return Bt(e,o),h(e,"ì¹´ë“œë¥¼ ì œê±°í–ˆìŠµë‹ˆë‹¤."),he(e),e.phase="NODE",be(e),!0}return!1}if(n.kind==="EVENT"){if(e.choiceCtx?.kind==="REST")return Fi(e,t);if(e.choiceCtx?.kind==="EVENT")return Ui(e,t);if(e.choiceCtx?.kind==="SHOP")return Wi(e,t)}return t==="skip"?(he(e),!0):!1}const En="deck-rogue-save-v1",Go=1;function zi(e){try{return JSON.parse(e)}catch{return null}}function ji(){return!!localStorage.getItem(En)}function qi(){localStorage.removeItem(En)}function Vi(e,t){const n={ver:Go,savedAt:Date.now(),build:t?.build,state:e};localStorage.setItem(En,JSON.stringify(n))}function Gi(){const e=localStorage.getItem(En);if(!e)return null;const t=zi(e);return!t||t.ver!==Go||!t.state?null:{state:t.state,savedAt:t.savedAt}}let Ue=null;function Yi(){Ue||(Ue=document.createElement("div"),Ue.id="hudSOnly",Ue.style.display="none",document.body.appendChild(Ue))}function Xi(e){if(Ue||Yi(),!!Ue){if(e==null||Number.isNaN(e)){Ue.style.display="none";return}Ue.textContent=`ğŸ ${e}`,Ue.style.display=""}}const Qi=`# Deck Rogue Prototype â€” ë£°ë¶ (í”Œë ˆì´ì–´ìš©)

ì´ ë¬¸ì„œëŠ” ìŠ¤í¬ì¼ëŸ¬ë¥¼ ìµœì†Œí™”í•©ë‹ˆë‹¤.

[1] ê°œìš”
ë…¸ë“œë¥¼ ì„ íƒí•˜ë©° ì§„í–‰í•˜ê³ , ì „íˆ¬ì—ì„œ ì‚´ì•„ë‚¨ì•„ ì„±ì¥í•©ë‹ˆë‹¤.
ë˜ì „ ê¹Šìˆ™í•œ ê³³ì˜ [ì €ì£¼ë°›ì€ ë³´ë¬¼]ì„ ì–»ê³ , ì…êµ¬ë¡œ ë˜ëŒì•„ì˜¤ë©´ ìŠ¹ë¦¬í•©ë‹ˆë‹¤.
ëª¨ë“  ì¹´ë“œëŠ” ì „ì—´ê³¼ í›„ì—´ì´ ìˆìŠµë‹ˆë‹¤. ë°°ì¹˜ì— ë”°ë¼ ì—­í• ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤.

[2] ë³´ê¸‰ê³¼ í”¼ë¡œë„

ë³´ê¸‰(S): ì „ì—´ ì¹´ë“œ ë° ì¼ë¶€ íš¨ê³¼ì˜ ë°œë™ì— ì‚¬ìš©ë©ë‹ˆë‹¤. ì „ì—´ ì¹´ë“œëŠ” ì‚¬ìš©ë§Œìœ¼ë¡œ 1ì˜ ë³´ê¸‰ì„ ì†Œë¹„í•©ë‹ˆë‹¤. ëŒ€ë¶€ë¶„ 7ë¡œ ì‹œì‘í•©ë‹ˆë‹¤.
ë³´ê¸‰ì´ 0ì¸ ìƒíƒœë¡œ í„´ ì¢…ë£Œ ì‹œ í”¼ë¡œë„ë§Œí¼ í”¼í•´ë¥¼ ë°›ìŠµë‹ˆë‹¤.

í”¼ë¡œë„(F): ë±ì„ ì„ì„ ë•Œ 1 ì˜¬ë¼ê°‘ë‹ˆë‹¤. ì „ì—´ ì¹´ë“œë¥¼ ìœ„í•œ ë³´ê¸‰ì´ ì—†ëŠ” ì±„ë¡œ í„´ì´ ì¢…ë£Œë˜ë©´ ë¶€ì¡±ë¶„ë§Œí¼ í”¼ë¡œë„ë¥¼ ì–»ìŠµë‹ˆë‹¤. ì¼ë¶€ ì¹´ë“œì˜ íš¨ê³¼ë¡œë„ ëŠ˜ì–´ë‚˜ê±°ë‚˜ ì¤„ì–´ë“­ë‹ˆë‹¤. í”¼ë¡œë„ëŠ” ì „íˆ¬ê°€ ëë‚˜ë„ ìœ ì§€ë©ë‹ˆë‹¤. ë„ˆë¬´ ìŒ“ì¸ í”¼ë¡œëŠ” ë•Œë•Œë¡œ ë‹¹ì‹ ì„ ë³€í•˜ê²Œ í•©ë‹ˆë‹¤.

[3] ì „íˆ¬ íë¦„
ë°°ì¹˜ â†’ í›„ì—´ ë°œë™ â†’ ì „ì—´ ë°œë™ â†’ ì  í–‰ë™ â†’ ì •ë¦¬ â†’ ë“œë¡œìš°
â€» â€œëŒ€ìƒ ì„ íƒ í•„ìš”â€ê°€ ëœ¨ë©´ ì‚´ì•„ìˆëŠ” ì ì„ í´ë¦­í•´ ëŒ€ìƒì„ ì •í•˜ì„¸ìš”.
â€» "ë‹¤ìŒ í„´"ì„ ëˆ„ë¥´ë©´ í„´ì´ ì§„í–‰ë˜ì–´, ì¹´ë“œì˜ ë°°ì¹˜ë¥¼ ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
ë³´ê¸‰ ë¹„ìš© ë° ê·¸ì— ë”°ë¥¸ í”¼ë¡œë„ ë“±ì˜ ë³€í™”ëŠ” ì •ë¦¬ ë‹¨ê³„ì—ì„œ ì²˜ë¦¬í•©ë‹ˆë‹¤.

ì†íŒ¨ëŠ” í„´ì´ ì¢…ë£Œë˜ì–´ë„ ìœ ì§€ë©ë‹ˆë‹¤.
ì¹´ë“œëŠ” ë§¤ í„´ë§ˆë‹¤ ì‚¬ìš©í•œ ë§Œí¼ ë½‘ìŠµë‹ˆë‹¤. ì¦‰, ì¹´ë“œë¡œ ì¸í•œ ë“œë¡œìš°ëŠ” íŒ¨ì˜ ë§¤ìˆ˜ ìì²´ë¥¼ ëŠ˜ë¦¬ëŠ” íš¨ê³¼ê°€ ìˆìŠµë‹ˆë‹¤.

[4] ìš©ì–´
- ì†Œëª¨: ì´ë²ˆ ì „íˆ¬ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ì—†ê²Œ ë˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
- ì†Œì‹¤: ëŸ° ì „ì²´ì—ì„œ í•´ë‹¹ ì¹´ë“œê°€ ì‚¬ë¼ì§€ëŠ” ê²ƒì…ë‹ˆë‹¤.
- ì·¨ì•½: ë°›ëŠ” í”¼í•´ê°€ (ì·¨ì•½)ë§Œí¼ ì¦ê°€í•©ë‹ˆë‹¤.
- ì•½í™”: ì£¼ëŠ” í”¼í•´ê°€ (ì•½í™”)ë§Œí¼ ê°ì†Œí•©ë‹ˆë‹¤.
- ì¶œí˜ˆ: í„´ ì¢…ë£Œ ì‹œ (ì¶œí˜ˆ)ë§Œí¼ í”¼í•´ë¥¼ ì…ìŠµë‹ˆë‹¤.
- êµë€: 0ë³´ë‹¤ ë†’ìœ¼ë©´, ë¬´ì‘ìœ„ í›„ì—´ ìŠ¬ë¡¯ í•˜ë‚˜ê°€ ë¹„í™œì„±í™”ë©ë‹ˆë‹¤.
- ì„¤ì¹˜: í„´ì´ ëë‚  ë•Œ íšŒìˆ˜í•˜ì§€ ì•ŠëŠ” ì¹´ë“œì…ë‹ˆë‹¤. ì „ì—´ì˜ ê²½ìš° SëŠ” ê·¸ëŒ€ë¡œ ì†Œëª¨í•©ë‹ˆë‹¤.
- ì„ ì²œì„±: ì²« í„´ì— í™•ì •ì ìœ¼ë¡œ ë½‘ìŠµë‹ˆë‹¤. ê¸°ì¡´ì˜ ì‹œì‘ ì†íŒ¨ë³´ë‹¤ ë§ì€ ì„ ì²œì„± ì¹´ë“œë¥¼ ì§€ë‹Œ ê²½ìš°, ê·¸ ìˆ˜ì™€ ë¬´ê´€í•˜ê²Œ ëª¨ë“  ì„ ì²œì„± ì¹´ë“œë¥¼ ë½‘ìŠµë‹ˆë‹¤.
- ë¶€ë™: ì´ë™í•˜ê±°ë‚˜ íšŒìˆ˜í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

[5] ì¡°ì‘

(ì»´í“¨í„°)
- 4: ì„ íƒ í•´ì œ
- Tab: ì†íŒ¨ ì„ íƒ ì´ë™
- 1~3: ì „ì—´ ë°°ì¹˜ / q,w,e: í›„ì—´ ë°°ì¹˜
- ë“œë˜ê·¸: ì†íŒ¨â†’ìŠ¬ë¡¯ ë°°ì¹˜, ìŠ¬ë¡¯â†”ìŠ¬ë¡¯ ìŠ¤ì™‘, ìŠ¬ë¡¯â†’ì†íŒ¨ íšŒìˆ˜
- Space: ë‹¤ìŒ í„´
- P: ìƒˆë¡œìš´ ëŸ°

[6]

ì‹œê°„ì€ ê¸ˆì…ë‹ˆë‹¤. ëª¨ë“  í–‰ë™ì€ ì‹œê°„ì„ ì†Œëª¨í•©ë‹ˆë‹¤. ì‹¸ì›€ì€ ì¢€ ë” ì†Œëª¨í•©ë‹ˆë‹¤.
ì¤‘ìš”í•œ ê±´ ì´ê³³ì´ ë‹¹ì‹ ì—ê²Œ ë„‰ë„‰í•œ ì‹œê°„ì„ ì£¼ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒì´ê² ì§€ìš”.
`;let Bn=null,Hn=null;function Et(){if(Bn)return Bn;const e=document.createElement("div");return e.id="itemHoverTip",e.className="itemHoverTip relicHoverTip",e.style.pointerEvents="none",e.style.position="fixed",e.style.left="0",e.style.top="0",e.style.zIndex="70000",document.body.appendChild(e),Bn=e,e}function Zi(e){const t=Et(),n=He(e);t.innerHTML="";const r=document.createElement("div");r.className="relicTipTitle",r.textContent=n?.name??e;const o=document.createElement("div");o.className="relicTipBody",o.textContent=n?.text??"",t.appendChild(r),t.appendChild(o)}function un(e,t){const n=Et(),r=rt(),o=12,s=14,a=o*r,i=s*r;let l=e+i,c=t+i;n.style.left=Pe(l),n.style.top=Pe(c);const d=n.getBoundingClientRect();l+d.width+a>window.innerWidth&&(l=window.innerWidth-d.width-a),c+d.height+a>window.innerHeight&&(c=window.innerHeight-d.height-a),l<a&&(l=a),c<a&&(c=a),n.style.left=Pe(Math.round(l)),n.style.top=Pe(Math.round(c))}function Gr(e,t,n){Zi(e),Et().classList.add("show"),un(t,n),requestAnimationFrame(()=>un(t,n))}function Yr(){Et().classList.remove("show")}function Zn(e,t){e.addEventListener("pointerenter",c=>{const d=c;d.pointerType!=="touch"&&Gr(t,d.clientX??0,d.clientY??0)}),e.addEventListener("pointermove",c=>{const d=c;d.pointerType!=="touch"&&un(d.clientX??0,d.clientY??0)},{passive:!0}),e.addEventListener("pointerleave",c=>{c.pointerType!=="touch"&&Yr()});let n=null,r=0,o=0,s=!1,a=0;const i=()=>{n!=null&&(window.clearTimeout(n),n=null)};e.addEventListener("pointerdown",c=>{const d=c;d.pointerType==="touch"&&(s=!1,r=d.clientX,o=d.clientY,i(),n=window.setTimeout(()=>{s=!0,a=performance.now()+700,e.__itemHoverSuppressClickUntil=a,Gr(t,r,o)},320))},{passive:!0}),e.addEventListener("pointermove",c=>{const d=c;if(d.pointerType!=="touch")return;if(Et().classList.contains("show")){un(d.clientX,d.clientY);return}if(n==null)return;const u=d.clientX-r,k=d.clientY-o;u*u+k*k>144&&i()},{passive:!0});const l=()=>{i(),Et().classList.contains("show")&&(a=Math.max(a,performance.now()+420),e.__itemHoverSuppressClickUntil=a,Yr())};e.addEventListener("pointerup",c=>{c.pointerType==="touch"&&l()},{passive:!0}),e.addEventListener("pointercancel",c=>{c.pointerType==="touch"&&l()},{passive:!0}),e.addEventListener("click",c=>{s&&(s=!1,c.preventDefault(),c.stopPropagation())},!0)}function Nt(){if(Hn)return Hn;const e=document.createElement("div");return e.id="faithHoverTip",e.className="itemHoverTip relicHoverTip",e.style.pointerEvents="none",e.style.position="fixed",e.style.left="0",e.style.top="0",e.style.zIndex="120000",document.body.appendChild(e),Hn=e,e}function Ji(e){const t=Nt(),n=pe(e);t.innerHTML="";const r=n.offered,o=document.createElement("div");o.className="relicTipTitle";const s=ve(e);o.textContent=`í›„ì›: ${s?Te(s):"ì—†ìŒ"} / í¬ì»¤ìŠ¤: ${Te(n.focus)}`;const a=document.createElement("div");a.className="relicTipBody",a.style.whiteSpace="pre-wrap";const i=r.map(l=>{const c=n.points[l]??0;return`${Te(l)}: ${c}ì 
${sn(l)}`});a.textContent=i.join(`

`),t.appendChild(o),t.appendChild(a)}function pn(e,t){const n=Nt(),r=rt(),o=12,s=14,a=o*r,i=s*r;let l=e+i,c=t+i;n.style.left=Pe(l),n.style.top=Pe(c);const d=n.getBoundingClientRect();l+d.width+a>window.innerWidth&&(l=window.innerWidth-d.width-a),c+d.height+a>window.innerHeight&&(c=window.innerHeight-d.height-a),l<a&&(l=a),c<a&&(c=a),n.style.left=Pe(Math.round(l)),n.style.top=Pe(Math.round(c))}function fn(e,t,n){Ji(e),Nt().classList.add("show"),pn(t,n),requestAnimationFrame(()=>pn(t,n))}function mn(){Nt().classList.remove("show")}function el(e){e.addEventListener("pointerenter",t=>{const n=t;n.pointerType!=="touch"&&Me&&fn(Me,n.clientX,n.clientY)}),e.addEventListener("pointermove",t=>{const n=t;n.pointerType!=="touch"&&pn(n.clientX,n.clientY)},{passive:!0}),e.addEventListener("pointerleave",t=>{t.pointerType!=="touch"&&mn()}),e.addEventListener("pointerup",t=>{const n=t;if(n.pointerType!=="touch"||!Me)return;if(Nt().classList.contains("show")){mn();return}fn(Me,n.clientX,n.clientY)},{passive:!0})}const tl=new URL("/deck-rogue-prototype/",window.location.origin).href;function de(e){if(!e||/^(https?:|data:|blob:)/i.test(e))return e;const t=e.replace(/^\/+/,"");return new URL(t,tl).href}let Xr=!1;function nl(){if(Xr)return;Xr=!0;const e=document.documentElement;if(e.style.setProperty("--bgUrl",`url("${de("assets/ui/background/dungeon_bg.png")}")`),e.style.setProperty("--boardUrl",`url("${de("assets/ui/boards/battle_board.png")}")`),e.style.setProperty("--cardBgBasic",`url("${de("assets/ui/cards/card_basic.png")}")`),e.style.setProperty("--cardBgCommon",`url("${de("assets/ui/cards/card_common.png")}")`),e.style.setProperty("--cardBgSpecial",`url("${de("assets/ui/cards/card_special.png")}")`),e.style.setProperty("--cardBgRare",`url("${de("assets/ui/cards/card_rare.png")}")`),e.style.setProperty("--cardBgMadness",`url("${de("assets/ui/cards/card_madness.png")}")`),e.style.setProperty("--cardUrl",`url("${de("assets/ui/cards/card_parchment.png")}")`),e.style.setProperty("--mapBgUrl",`url("${de("assets/ui/background/map_bg.png")}")`),!document.getElementById("deck-fontfaces")){const t=document.createElement("style");t.id="deck-fontfaces";const n=de("assets/fonts/Mulmaru.woff2"),r=de("assets/fonts/Mulmaru.woff");t.textContent=`@font-face {  font-family: "Mulmaru";  src: url("${n}") format("woff2"), url("${r}") format("woff");  font-weight: 400;  font-style: normal;  font-display: swap;}:root { --gameFont: "Mulmaru", system-ui, -apple-system, "Segoe UI", Arial, sans-serif; }body { font-family: var(--gameFont); }`,document.head.appendChild(t)}}function rl(e){return new Promise(t=>window.setTimeout(t,e))}function ol(e){switch(e){case"BACK":return 100;case"FRONT":return 100;case"ENEMY":return 100;case"UPKEEP":return 100;case"DRAW":return 100;case"PLACE":return 0;default:return 220}}let On=!1;function al(){document.querySelectorAll(".slot").forEach(e=>{const t=e.querySelector(".slotCardScaler");t&&fa(e,t)})}function sl(e){On||(On=!0,requestAnimationFrame(()=>{On=!1,_r(),Ar(),Nr(),al()}))}let il=1,hn=[],ll=1,bn=[];function cl(e){const t=e,n=t.uiToasts??[];if(!n||n.length===0)return;const r=performance.now();for(const o of n){const s=String(o.kind??"INFO"),a=String(o.text??""),i=Math.max(200,Number(o.ms??1600)||1600);bn.push({id:ll++,kind:s,text:a,born:r,ms:i})}t.uiToasts=[]}function dl(){const e=performance.now(),t=xr();bn=bn.filter(n=>e-n.born<n.ms*t)}function ul(e){cl(e),dl();let t=document.querySelector(".toastLayer");t||(t=document.createElement("div"),t.className="toastLayer",document.body.appendChild(t)),t.innerHTML="";for(const n of bn){const r=document.createElement("div");r.className=`toast toast-${n.kind.toLowerCase()}`,r.textContent=n.text,t.appendChild(r)}}let Yo=null;function Ft(e,t,n,r){hn.push({id:il++,kind:e,text:t,x:n,y:r,born:performance.now()})}function pl(){const e=performance.now();hn=hn.filter(t=>e-t.born<_n(700))}let Zt=null,Jt=null,Dn=[];function fl(e){if(!(!e.run.finished&&e.enemies.length>0&&e.phase!=="NODE")){Zt=null,Jt=null,Dn=[];return}if(Zt!=null){const n=e.player.hp-Zt;n!==0&&ml(n)}if(Jt!=null){const n=e.player.block-Jt;n!==0&&hl(n)}for(let n=0;n<e.enemies.length;n++){const r=e.enemies[n].hp,o=Dn[n];o!=null&&r!==o&&bl(n,r-o)}Zt=e.player.hp,Jt=e.player.block,Dn=e.enemies.map(n=>n.hp)}function ml(e){const t=rt(),n=document.querySelector(".playerHudBox")??document.querySelector(".playerHudLeft");if(!n)return;const r=n.getBoundingClientRect(),o=(r.left+r.right)/2,s=r.top+14*t;e<0?Ft("dmg",`${e}`,o,s):Ft("heal",`+${e}`,o,s),n.classList.add("fxFlash"),setTimeout(()=>n.classList.remove("fxFlash"),_n(240))}function hl(e){const t=rt(),n=document.querySelector(".playerHudBox")??document.querySelector(".playerHudLeft");if(!n)return;const r=n.getBoundingClientRect(),o=(r.left+r.right)/2,s=r.top+34*t;Ft("block",e>0?`+${e}`:`${e}`,o,s)}function bl(e,t){const r=Array.from(document.querySelectorAll(".enemyHudCenter .enemyBanner"))[e];if(!r)return;const o=r.getBoundingClientRect(),s=(o.left+o.right)/2,a=o.top+14;t<0?Ft("dmg",`${t}`,s,a):Ft("heal",`+${t}`,s,a),r.classList.add("fxFlash"),setTimeout(()=>r.classList.remove("fxFlash"),_n(240))}const Xo="deckrogue_uiSettings_v1";function xt(e,t,n){return Math.max(t,Math.min(n,e))}function Qo(){try{const e=localStorage.getItem(Xo);if(!e)return{uiScaleDesktop:1,uiScaleMobile:1,slotCardMode:"FULL",animMul:1};const t=JSON.parse(e),n=t.slotCardMode==="NAME_ONLY"?"NAME_ONLY":"FULL";return{uiScaleDesktop:xt(Number(t.uiScaleDesktop??1)||1,.75,1.5),uiScaleMobile:xt(Number(t.uiScaleMobile??1)||1,.75,1.5),slotCardMode:n,animMul:xt(Number(t.animMul??1)||1,0,2)}}catch{return{uiScaleDesktop:1,uiScaleMobile:1,slotCardMode:"FULL",animMul:1}}}let Ne=Qo();function yl(){const e=Cr()?Ne.uiScaleMobile:Ne.uiScaleDesktop;return xt(e,.65,1.5)}function rt(){const e=getComputedStyle(document.documentElement).getPropertyValue("--u"),t=parseFloat(e);return Number.isFinite(t)&&t>0?t:1}function Pe(e){const t=rt(),n=e/t;return"calc("+(Number.isFinite(n)?n:0)+" * var(--u))"}function xr(){return xt(Number(Ne.animMul??1)||1,0,2)}function _n(e){return Math.max(0,Math.round(e*xr()))}function Cr(){const e=window.innerWidth,t=window.matchMedia("(pointer: coarse)").matches;return e<=900&&t}let st=!1;function kl(){try{const e=localStorage.getItem("deckrogue_logCollapsed");if(e==null)return;st=e==="1"}catch{}}function Tl(){try{localStorage.setItem("deckrogue_logCollapsed",st?"1":"0")}catch{}}let en=null;function vl(e){en!=null&&window.clearTimeout(en),en=window.setTimeout(()=>{en=null,Vi(e)},250)}let Fn=!1;async function xl(e,t){if(e._justStartedCombat){e._justStartedCombat=!1;return}if(!Fn){Fn=!0;try{if(e.run.finished||e.choice||ye(e)||ce||e.phase==="NODE")return;let n=0;for(;n++<60&&!(e.run.finished||e.choice||ce||ye(e));){const r=ua(e,t,!1);if(!r.fn||r.disabled)break;const o=e.phase;if(r.fn(),B(e,t),e.phase==="PLACE")break;const s=ol(o);s>0&&await rl(_n(s))}}finally{Fn=!1}}}function Zo(e){const t=e.run;t.timeMove==null&&(t.timeMove=e.run.nodePickCount??0),t.nextBossTime==null&&(t.nextBossTime=40),t.forcedNext==null&&(t.forcedNext=null)}function Cl(e,t){const n=e;return n.content=t,n.time??=0,n.run.relics??=[],n.run??={},n.run.timeMove??=n.run.nodePickCount??0,n.run.nextBossTime??=40,n.run.forcedNext??=null,n.run.bossOmenText??=null,n.run.enemyLastSeenBattle??={},n.run.nodePickByType??={BATTLE:0,ELITE:0,REST:0,EVENT:0,TREASURE:0},n.run.bossPool??=["boss_gravity_master","boss_cursed_wall","boss_giant_orc","boss_soul_stealer"],n.run.nextBossId??=null,n.run.lastBattleWasElite??=!1,n.run.lastBattleWasBoss??=!1,n.run.rewardPityNonElite??=0,n.run.gold??=0,n.run.pendingEventWinGold??=0,n.run.items??=[],n.run.itemOfferedThisBattle??=!1,n.run.afterTreasureNodePicks??=0,n.run.deckSizeAtTreasure??=null,n.run.treasureObtained&&n.run.deckSizeAtTreasure==null&&(n.run.deckSizeAtTreasure=Oo(n)),n.choiceStack??=[],n.pendingTargetQueue??=[],n.exhausted??=[],n.vanished??=[],n.choiceQueue??=[],n.choiceCtx??=null,n}function gl(e){if(!ji())return Qn(e);const t=Gi();if(!t)return Qn(e);const n=Cl(t.state,e),r=pe(n);return!n.choice&&!r.chosen&&$o(n),n}function wl(){if(document.querySelector(".bgLayer"))return;const e=document.createElement("div");e.className="bgLayer",document.body.appendChild(e)}let Qr=0,Zr=0,Me=null,yn=0,Je=null;function Vt(){Je=null;try{je.hide()}catch{}const e=document.querySelector(".cardHoverPreview");e&&e.classList.remove("on","pinned")}function Sn(e=250){yn=performance.now()+e}const je=El();function El(){let e=null,t=null,n=null,r=null,o=!1,s=!1;function a(u){if(e)return;e=g("cardHoverPreview"),t=g("cardHoverPreviewTitle");const k=g("cardHoverPreviewRow");n=g("cardHoverPreviewCard"),r=g("cardHoverPreviewDetail"),k.appendChild(n),k.appendChild(r),e.appendChild(t),e.appendChild(k),u.appendChild(e),s||(s=!0,document.addEventListener("pointerdown",T=>{if(!o||!e)return;const m=T.target;m&&(e.contains(m)||(Je=null,d(),l()))},!0))}function i(u){!e||!t||!n||!r||(t.textContent=u.title,n.innerHTML="",u.cardEl&&n.appendChild(u.cardEl),r.textContent=u.detail,e.classList.add("on"))}function l(){e&&e.classList.remove("on")}function c(){e&&(o=!0,e.classList.add("pinned"),e.style.pointerEvents="auto")}function d(){e&&(o=!1,e.classList.remove("pinned"),e.style.pointerEvents="none")}function p(){return o}return{ensure:a,show:i,hide:l,pin:c,unpin:d,isPinned:p}}function Wt(e,t){const n=e.cards[t];return xe(e.content,n.defId,n.upgrade??0)}function kn(e,t){return e.content.cardsById[t]?.name??t}function _l(e,t,n){const r=n??0,o=e.content.cardsById[t]?.name??t;return r>0?`${o} +${r}`:o}function Le(e,t){const n=e.cards[t];return _l(e,n.defId,n.upgrade??0)}function Sl(){return!!(F&&F.dragging)}function nt(e,t,n,r,o){const s=e.cards[t],a=xe(e.content,s.defId,s.upgrade??0),i=o?.draggable??!0,l=o?.mode??"FULL",c=g("card"),d=a.rarity??(String(s.defId).startsWith("mad_")?"MADNESS":void 0)??(["arrow","shield","scout","field_ration","maintenance","power_arrow","goal_treasure"].includes(String(s.defId))?"BASIC":"COMMON");c.classList.add(`rarity-${String(d).toLowerCase()}`),e.selectedHandCardUid===t&&c.classList.add("selected"),a.tags?.includes("EXHAUST")&&c.classList.add("exhaust"),a.tags?.includes("VANISH")&&c.classList.add("vanish"),l==="SLOT_NAME_ONLY"&&c.classList.add("slotNameOnly");const p=g("cardHeader"),u=ea(e,t);if(p.appendChild(ae("cardTitle",u)),l==="FULL"){const k=g("cardMeta");a.tags?.includes("EXHAUST")&&k.appendChild(er("")),a.tags?.includes("VANISH")&&k.appendChild(er("")),p.appendChild(k)}if(c.appendChild(p),l==="FULL"){const k=g("cardBody"),m=!!e.cards[t]?.flipped,f=m?a.backText:a.frontText,b=m?a.frontText:a.backText,x=g("cardSection");x.classList.add("front"),x.appendChild(no(f)),k.appendChild(x);const y=g("cardSection");y.classList.add("back"),y.appendChild(no(b)),k.appendChild(y),c.appendChild(k)}if(n&&r&&(c.onclick=()=>r(t)),n){let k=null,T=0,m=0,f=!1,b=-1,x=!1;const y=()=>!(ye(e)||e.phase!=="PLACE"||!i),N=()=>{if(!o?.hoverPreview||F?.dragging)return;const{root:C,api:O,buildDetail:$}=o.hoverPreview;O.ensure(C);const w=$?.(e,t)??(()=>{const R=ze(a.frontText),D=ze(a.backText);return`ì „ì—´: ${R||"ì—†ìŒ"}
í›„ì—´: ${D||"ì—†ìŒ"}`})(),E=nt(e,t,!1,void 0,{draggable:!1,mode:"FULL"});E.classList.add("isPreviewCard"),Je=t,O.show({title:u,detail:w,cardEl:E}),O.pin?.()},W=()=>{k!=null&&(window.clearTimeout(k),k=null)};c.onpointerdown=C=>{if(C.button!==0&&C.pointerType==="mouse")return;const O=C;if(O.pointerType==="touch"){f=!1,b=O.pointerId,x=!0,T=O.clientX,m=O.clientY,W(),k=window.setTimeout(()=>{x&&N()},320);return}if(ye(e)||e.phase!=="PLACE"||!i)return;const $=e.hand.indexOf(t);ar(C,{kind:"hand",cardUid:t,fromHandIndex:$})},c.addEventListener("pointermove",C=>{const O=C;if(O.pointerType!=="touch")return;const $=O.clientX-T,w=O.clientY-m;if(!($*$+w*w>144)||(W(),F?.dragging)||!x||!y())return;f=!0,x=!1;const R=e.hand.indexOf(t),D={currentTarget:c,pointerId:b,clientX:O.clientX,clientY:O.clientY};ar(D,{kind:"hand",cardUid:t,fromHandIndex:R})},{passive:!0}),c.addEventListener("pointerup",C=>{C.pointerType==="touch"&&(x=!1,W())},{passive:!0}),c.addEventListener("pointercancel",C=>{C.pointerType==="touch"&&(x=!1,W())},{passive:!0}),c.addEventListener("click",C=>{f&&(f=!1,C.preventDefault(),C.stopPropagation())},!0)}if(o?.hoverPreview){const{root:k,api:T,buildDetail:m}=o.hoverPreview;T.ensure(k);const f=m?.(e,t)??(()=>{const b=ze(a.frontText),x=ze(a.backText);return`ì „ì—´: ${b||"ì—†ìŒ"}
í›„ì—´: ${x||"ì—†ìŒ"}`})();c.addEventListener("pointerenter",b=>{if(performance.now()<yn||F?.dragging||T.isPinned?.()&&Je)return;const x=nt(e,t,!1,void 0,{draggable:!1,mode:"FULL"});x.classList.add("isPreviewCard"),T.show({title:u,detail:f,cardEl:x})}),c.addEventListener("pointerleave",()=>{T.isPinned?.()||T.hide()}),c.addEventListener("pointerup",b=>{const x=b;if(x.pointerType==="mouse"||x.pointerType==="touch"||!document.body.classList.contains("mobile")||F?.dragging||F&&F.pointerId===x.pointerId||performance.now()<yn)return;if(Je===t&&T.isPinned?.()){Je=null,T.unpin?.(),T.hide();return}Je=t;const y=nt(e,t,!1,void 0,{draggable:!1,mode:"FULL"});y.classList.add("isPreviewCard"),T.show({title:u,detail:f,cardEl:y}),T.pin?.()},{passive:!0}),c.addEventListener("pointerdown",b=>{b.pointerType!=="touch"&&(Sn(250),!(T.isPinned?.()&&Je)&&Vt())},{capture:!0})}return c}function ze(e){if(!e)return"";if(typeof e=="string")return e;if(Array.isArray(e))return e.map(ze).join("");if(typeof e=="object"){if(e.text)return String(e.text);if(e.children)return ze(e.children)}return""}function gr(e,t,n){const o=e.content?.cardsById?.[t]?.upgrades,s=Number(n)||0;return!!o&&o.length>s}function Jo(e,t,n){const r=Number(n??0)||0,o=xe(e.content,t,r),s=xe(e.content,t,r+1),a=ze(o?.frontText),i=ze(o?.backText),l=ze(s?.frontText),c=ze(s?.backText);return`í˜„ì¬: ì „ì—´ ${a||"ì—†ìŒ"} / í›„ì—´ ${i||"ì—†ìŒ"}
ê°•í™”: ì „ì—´ ${l||"ì—†ìŒ"} / í›„ì—´ ${c||"ì—†ìŒ"}`}function Jr(e,t,n){if(!gr(e,t,n))return;je.ensure(document.body);const r=e.content?.cardsById?.[t]?.name??t,o=Number(n)||0,s=o+1,a=`${Nn(r,s)} (ê°•í™” ë¯¸ë¦¬ë³´ê¸°)`,i=Jo(e,t,o),l=Ct(e,t,s);l.classList.add("isPreviewCard");const c=document.querySelector(".cardHoverPreview");c&&c.classList.remove("previewAtBattlefield"),je.show({title:a,detail:i,cardEl:l})}function eo(e,t,n){if(!gr(e,t,n))return;je.ensure(document.body);const r=e.content?.cardsById?.[t]?.name??t,o=Number(n)||0,s=o+1,a=`${Nn(r,s)} (ê°•í™” ë¯¸ë¦¬ë³´ê¸°)`,i=Jo(e,t,o),l=Ct(e,t,s);l.classList.add("isPreviewCard");const c=document.querySelector(".cardHoverPreview");c&&c.classList.add("previewAtBattlefield"),je.show({title:a,detail:i,cardEl:l})}function Wn(e,t,n,r){if((Number(r??0)||0)!==0||!gr(t,n,0))return;const s=!!e.closest(".choice-rewardCardRow");e.addEventListener("pointerenter",u=>{u.pointerType==="mouse"&&(performance.now()<yn||F?.dragging||(s?eo(t,n,0):Jr(t,n,0)))}),e.addEventListener("pointerleave",u=>{u.pointerType==="mouse"&&je.hide()});let a=null,i=0,l=0,c=!1;const d=()=>{a!=null&&(window.clearTimeout(a),a=null)};e.addEventListener("pointerdown",u=>{const k=u;Sn(250),Vt(),je.hide(),k.pointerType==="touch"&&(c=!1,i=k.clientX,l=k.clientY,d(),a=window.setTimeout(()=>{c=!0,s?eo(t,n,0):Jr(t,n,0)},320))},{capture:!0,passive:!0}),e.addEventListener("pointermove",u=>{const k=u;if(k.pointerType!=="touch"||a==null)return;const T=k.clientX-i,m=k.clientY-l;T*T+m*m>144&&d()},{passive:!0});const p=()=>{d(),je.hide()};e.addEventListener("pointerup",u=>{u.pointerType==="touch"&&p()},{passive:!0}),e.addEventListener("pointercancel",u=>{u.pointerType==="touch"&&p()},{passive:!0}),e.addEventListener("click",u=>{c&&(c=!1,u.preventDefault(),u.stopPropagation())},!0)}function g(e){const t=document.createElement("div");return t.className=e,t}function ae(e,t){const n=document.createElement("div");return n.className=e,n.textContent=t,n}function Nl(e){const t=document.createElement("h2");return t.textContent=e,t}function Jn(e){const t=document.createElement("h3");return t.textContent=e,t}function wr(e){const t=document.createElement("p");return t.textContent=e,t}function er(e){const t=document.createElement("span");return t.className="badge",t.textContent=e,t}function Ve(e,t,n){const r=document.createElement("button");return r.textContent=e,r.disabled=n,r.onclick=t,r}function Al(e){const t=document.createElement("pre");return t.className="log",t.textContent=e,t}function Nn(e,t){const n=t??0;return n>0?`${e} +${n}`:e}function ea(e,t){const n=e.cards[t],r=e.content.cardsById[n.defId].name;return Nn(r,n.upgrade)}function $l(e,t){const n=e.content.cardsById[t.defId].name;return Nn(n,t.upgrade)}const Ml={ì·¨ì•½:"ğŸ¯",ì•½í™”:"ğŸ¥€",ì¶œí˜ˆ:"ğŸ©¸",êµë€:"ğŸŒ€",ë©´ì—­:"âœ¨",S:"ğŸ",F:"ğŸ’¤",ë“œë¡œìš°:"ğŸƒ",í”¼í•´:"ğŸ—¡ï¸",íšŒë³µ:"ğŸ’Š",ë°©ì–´:"ğŸ›¡ï¸",ë¸”ë¡:"ğŸ›¡ï¸",ì†Œëª¨:"ğŸ”¥",ì†Œì‹¤:"ğŸ•³ï¸"};function to(e,t,n){const r=Ml[e]??"",o=t!=null?`${e} ${t}`:e;return`<span class="kwBadge"><span class="kwIcon">${r}</span> <span class="kwLabel">${o}</span><span class="kwPunc">${n||""}</span></span>`}const ta="[,ï¼Œã€]",Pl=new RegExp(`(ì·¨ì•½|ì•½í™”|ì¶œí˜ˆ|êµë€|ë©´ì—­|S|F|ë“œë¡œìš°|í”¼í•´|ë°©ì–´|ë¸”ë¡|íšŒë³µ|ì†Œëª¨|ì†Œì‹¤)\\s*([+-]?\\d+)\\s*(${ta})?`,"g"),Il=new RegExp(`(^|[^ê°€-í£A-Za-z0-9_])(ì†Œëª¨|ì†Œì‹¤)\\s*(${ta})?`,"g");function Rl(e){let t=e.replace(Pl,(n,r,o,s)=>to(r,o,s));return t=t.replace(Il,(n,r,o,s)=>`${r}${to(o,void 0,s)}`),t=t.replace(/\n/g,"<br>"),t}function no(e){const t=g("cardText");return t.innerHTML=Rl(e),t}function Ll(e){return de(`assets/enemies/${e}.png`)}const ro={vuln:"ğŸ¯",weak:"ğŸ¥€",bleed:"ğŸ©¸",disrupt:"ğŸŒ€",immune:"âœ¨",supplies:"ğŸ",fatigue:"ğŸ’¤",slash:"ğŸ—¡ï¸"};function na(e){return e==="ATTACK"||e==="ATTACK_BUFF"||e==="ATTACK_DEBUFF"}function Bl(e,t,n){if(!n||!na(n.cat))return"";const r=Math.max(1,Number(n.hits??1)||1),o=Math.max(0,Number(n.perHit??0)||0),s=Math.max(0,Number(n.dmgTotal??o*r)||0);if(r>1){if(o<=0)return`${s} (${r}íƒ€)`;const a=o*r;if(s===a)return`${s} (${o}x${r})`;const i=Math.max(0,Number(e.player?.block??0)||0);if(i>0){let l=i;const c=[];for(let p=0;p<r;p++){const u=Math.min(l,o);l-=u,c.push(o-u)}if(c.reduce((p,u)=>p+u,0)===s)return c.every(u=>u===c[0])?`${s} (${c[0]}x${r})`:`${s} (${c.join("+")})`}return`${s} (${o}x${r})`}return`${s}`}function Hl(e){if(!e)return"?";const t=na(e.cat),n=e.applies??[],r=n.some(a=>a.target==="player"),o=n.some(a=>a.target==="enemy");let s="";if(t&&(s+="ğŸ—¡ï¸"),r&&(s+="ğŸŒ€"),o&&(s+="âœ¨"),!s){const a=e.cat;return a==="DEFEND"?"ğŸ›¡ï¸":a==="BUFF"?"âœ¨":a==="DEBUFF"?"ğŸŒ€":"?"}return s}function Ol(e,t){const n=g("enemyStatusEmojiRow"),r=(o,s)=>{if(!s||s<=0)return;const a=document.createElement("span");a.className="stEmoji",a.textContent=`${ro[o]??"?"}${s}`,n.appendChild(a)};if(r("vuln",e?.vuln??0),r("weak",e?.weak??0),r("bleed",e?.bleed??0),r("disrupt",e?.disrupt??0),r("slash",e?.slash??0),t){const o=document.createElement("span");o.className="stEmoji",o.textContent=`${ro.immune}1`,n.appendChild(o)}return n}let ce=null,oo=!1,F=null,Fe=null,tr=!1,Ze=!1,Rt=null;function Pt(){Rt&&(document.removeEventListener("pointerdown",Rt,!0),Rt=null)}let De=null,tt=null;function Dl(){De=null,tt=null,document.querySelector(".relicTooltip")?.remove()}function ra(){Vt(),Dl(),document.querySelectorAll(".itemHoverTip").forEach(e=>{e.classList.remove("show"),e.innerHTML=""})}let lt=null;function ao(e,t,n){const r=e.cards[t];return Ct(e,r.defId,n)}function Tt(e,t,n){const o=nt(e,t,!!n,n,{draggable:!1});return o.classList.add("overlayCard"),o}function Ct(e,t,n){const r=`__preview:${t}:${n}:${Math.random().toString(36).slice(2)}`,o=e.cards[r];e.cards[r]={uid:r,defId:t,upgrade:n,zone:"preview"};const s=nt(e,r,!1,void 0,{draggable:!1});return s.classList.add("overlayCard"),s.draggable=!1,s.style.pointerEvents="none",o?e.cards[r]=o:delete e.cards[r],s}const ht="ï¸";function Ut(e,t){return e==="BATTLE"?t?{icon:"â˜ "+ht,text:"ë³´ìŠ¤",kind:"boss"}:{icon:"âš”"+ht,text:"ì „íˆ¬",kind:"battle"}:e==="ELITE"?{icon:"â˜ "+ht,text:"ì •ì˜ˆ",kind:"elite"}:e==="REST"?{icon:"â›ºï¸"+ht,text:"íœ´ì‹",kind:"rest"}:e==="EVENT"?{icon:"â”ï¸"+ht,text:"ë¯¸ì§€",kind:"event"}:e==="SHOP"?{icon:"Â¤"+ht,text:"ìƒì ",kind:"shop"}:{icon:"âœ¦",text:"ë³´ë¬¼",kind:"treasure"}}function Fl(e,t,n){const r=Ut(t,n),o=document.createElement("span");o.className=`nodeIcon ${r.kind}`,o.textContent=r.icon;const s=document.createElement("span");s.className="nodeText",s.textContent=`(${r.text})`,e.appendChild(o),e.appendChild(s)}function Lt(e){return Math.max(0,Math.min(1,e))}function Un(e,t,n){return Math.max(t,Math.min(n,Math.floor(e)))}function An(e){const t=e.run;if(t.timeMove??=0,t.vision??={mode:"NORMAL",presenceR:2,typeR:1,detailR:0,noise:0},t.pursuit??={heat:0},!t.map)t.map=Kl();else{const o=t.map;if(Array.isArray(o.nodes)){const s={};for(const a of o.nodes)s[String(a.id)]=a;o.nodes=s}}const n=t.map;if(!Object.keys(n?.nodes??{}).every(o=>typeof n.nodes[o]?.order=="number"))try{aa(n,2)}catch{}try{Er(n)}catch{}return{map:t.map,vision:t.vision,pursuit:t.pursuit,timeMove:t.timeMove}}function oa(e){const t=e.run,n=Number(t.timeMove??0)||0,r=Number(e.time??0)||0;return n+r}function Tn(e){return e>=14?3:e>=9?2:e>=5?1:0}function _t(e,t,n){const r={},o=[];for(r[t]=0,o.push(t);o.length;){const s=o.shift(),a=r[s]??0;if(a>=n)continue;const i=e.edges[s]??[];for(const l of i)r[l]==null&&(r[l]=a+1,o.push(l))}return r}function Er(e){const t=e;return t.seen||(t.seen={}),t.seen[e.pos]=3,t.seen}function Wl(e,t){const n=Er(e),r=Math.max(0,t.presenceR|0),o=_t(e,e.pos,r);for(const s of Object.keys(o)){const a=o[s]??0,i=vn(a,t),l=n[s]??0;i>l&&(n[s]=i)}n[e.pos]=3}function Ul(e,t){return(e.seen??{})[t]??0}function aa(e,t=2){const n=Object.keys(e.nodes);if(n.length<=2)return;e.edges??={};for(const p of Object.keys(e.edges))for(const u of(e.edges[p]??[]).slice())e.edges[u]??=[],e.edges[u].includes(p)||e.edges[u].push(p);const r=p=>Number(e.nodes[p]?.depth??999),o=p=>Number(e.nodes[p]?.order??0),s=p=>(e.edges[p]??[]).length,a=n.every(p=>{const u=r(p);return u>=0&&u<900&&typeof e.nodes[p]?.order=="number"}),i=new Map;if(a){for(const p of n){const u=r(p);i.has(u)||i.set(u,[]),i.get(u).push(p)}for(const[p,u]of i)u.sort((k,T)=>o(k)-o(T)||k.localeCompare(T))}const l=p=>{const u=i.get(p)??[],k=i.get(p+1)??[],T=new Map,m=new Map;for(let b=0;b<u.length;b++)T.set(u[b],b);for(let b=0;b<k.length;b++)m.set(k[b],b);const f=[];for(const b of u)for(const x of e.edges[b]??[]){if(r(x)!==p+1)continue;const y=T.get(b),N=m.get(x);y==null||N==null||f.push([y,N])}return{left:u,right:k,li:T,ri:m,pairs:f}},c=(p,u)=>{const k=r(p);if(r(u)!==k+1)return!0;const{li:m,ri:f,pairs:b}=l(k),x=m.get(p),y=f.get(u);if(x==null||y==null)return!0;for(const[N,W]of b)if(x<N&&y>W||x>N&&y<W)return!0;return!1},d=p=>{e.edges[p]??=[];const u=new Set(e.edges[p]??[]),k=r(p);let T=n.filter(f=>f!==p&&!u.has(f));if(T.length===0||a&&(T=T.filter(f=>Math.abs(r(f)-k)===1),T.length===0||(T=T.filter(f=>{const b=r(p),x=r(f),y=b<x?p:f,N=b<x?f:p;return!c(y,N)}),T.length===0)))return!1;T.sort((f,b)=>s(b)-s(f));const m=T[0];return e.edges[p].push(m),e.edges[m]??=[],e.edges[m].push(p),!0};for(let p=0;p<200;p++){const u=n.filter(T=>s(T)<t);if(u.length===0)break;let k=!1;for(const T of u)for(;s(T)<t&&d(T);)k=!0;if(!k)break}}function Kl(){const t={},n={},r=Array.from({length:18},(d,p)=>`n${p}`);n[r[0]]=[],t[r[0]]={id:r[0],kind:"START",visited:!0,cleared:!0,depth:0};for(let d=1;d<r.length;d++){const p=r[d],u=r[Math.floor(Math.random()*d)];n[p]??=[],n[u]??=[],n[p].push(u),n[u].push(p),t[p]={id:p,kind:"BATTLE",visited:!1,cleared:!1}}const o=10;for(let d=0;d<o;d++){const p=r[Math.floor(Math.random()*r.length)],u=r[Math.floor(Math.random()*r.length)];p!==u&&(n[p]??=[],n[u]??=[],!n[p].includes(u)&&(n[p].push(u),n[u].push(p)))}const s={pos:r[0],startId:r[0],nodes:t,edges:n,treasureId:r[r.length-1]};aa(s,2);const a=_t(s,r[0],999);let i=r[1],l=-1;for(const d of r){const p=a[d]??999;t[d].depth=p,d!==r[0]&&p>l&&(l=p,i=d)}for(const d of r)d!==r[0]&&(t[d].kind="BATTLE");const c=["BATTLE","BATTLE","BATTLE","EVENT","REST","ELITE"];for(const d of r){if(d===r[0]||d===i)continue;const p=c[Math.floor(Math.random()*c.length)];t[d].kind=p}return t[i].kind="TREASURE",{pos:r[0],startId:r[0],nodes:t,edges:n,visionNonce:1,treasureId:i}}function zl(e){const{vision:t,pursuit:n}=An(e),r=e.run,o=Number(r.timeMove??0)||0,s=t;s.forceModeUntilMove!=null&&o>=Number(s.forceModeUntilMove)&&(s.forceModeUntilMove=null,s.forceMode=null),s.switchLockedUntilMove!=null&&o>=Number(s.switchLockedUntilMove)&&(s.switchLockedUntilMove=null);let a=s.forceMode??t.mode??"NORMAL",i=Number(t.presenceR??2)||0,l=Number(t.typeR??1)||0,c=Number(t.detailR??0)||0,d=Lt(Number(t.noise??.08)||0);if(a==="FOCUS"?(i-=1,l-=1,c+=1,d*=.6):a==="WIDE"&&(i+=1,l+=1,c+=0,d=Lt(d*1.35)),e.run.treasureObtained){const p=Tn(n.heat??0);i+=p>=2?1:0,l-=p,c-=Math.max(0,p-1),d=Lt(d+p*.07)}return ve(e)==="bright_darkness"&&(i=Math.max(i,3),l=Math.max(l,3)),i=Un(i,0,99),l=Un(l,0,i),c=Un(c,0,l),d=0,{mode:a,presenceR:i,typeR:l,detailR:c,noise:d}}function vn(e,t){return e<=0||e<=t.detailR?3:e<=t.typeR?2:e<=t.presenceR?1:0}function xn(e,t,n,r,o){return Ce(e,"bright_darkness")?{shown:null,label:"?",certainty:"HIDDEN"}:r===0?{shown:null,label:"ë³´ì´ì§€ ì•ŠìŒ",certainty:"HIDDEN"}:r===1?{shown:null,label:"ë¬´ì–¸ê°€",certainty:"PRESENCE"}:n==="START"?{shown:null,label:"ì…êµ¬",certainty:r===3?"DETAIL":"TYPE"}:n==="EMPTY"?{shown:null,label:"ì§€ë‚˜ê°„ ê³³",certainty:"PRESENCE"}:r===3?{shown:n,label:Ut(n,!1).text,certainty:"DETAIL"}:{shown:n,label:Ut(n,!1).text,certainty:"TYPE"}}function jl(e,t){const n=g("mapNodeLine");if(n.style.cssText="display:flex; gap:calc(8 * var(--u)); align-items:center;",t.shown)Fl(n,t.shown,!1);else{const r=document.createElement("span");r.className="nodeText",r.textContent=`(${t.label})`,n.appendChild(r)}e.appendChild(n)}function ql(e){const t=Object.keys(e.nodes);if(t.length===0||t.every(s=>{const a=e.nodes[s]?.depth,i=Number(a);return a!=null&&Number.isFinite(i)&&i>=0&&i<900}))return;const r=Object.values(e.nodes).find(s=>s.kind==="START")?.id??e.pos??t[0],o=_t(e,r,999);for(const s of t){const a=e.nodes[s]?.depth;if(a!=null&&Number.isFinite(Number(a))&&Number(a)<900)continue;const i=o[s];e.nodes[s].depth=i??e.nodes[s].depth??999}}function Vl(e){ql(e);const t=Object.keys(e.nodes),n=t.every(w=>typeof e.nodes[w]?.order=="number"),r=new Map;let o=0;for(const w of t){const E=Number(e.nodes[w]?.depth??999),R=Number.isFinite(E)?E:999;o=Math.max(o,R),r.has(R)||r.set(R,[]),r.get(R).push(w)}const s=Array.from(r.keys()).sort((w,E)=>w-E),a=s.filter(w=>w<900).length?Math.max(...s.filter(w=>w<900)):o,i=s.some(w=>w>=900),l=a+(i?1:0),c=80,d=64,p=54,u=40,k=w=>{const E=Number(e.nodes[w]?.depth??999),R=Number.isFinite(E)?E:999;return R>=900?a+1:R},T=Array.from({length:l+1},(w,E)=>E),m={};for(const w of T)m[w]=[];for(const w of t){const E=k(w);m[E].push(w)}for(const w of T)m[w].sort((E,R)=>(e.nodes[E].order??0)-(e.nodes[R].order??0)||E.localeCompare(R));const f=w=>{const E=new Map,R=m[w]??[];for(let D=0;D<R.length;D++)E.set(R[D],D);return E},b=w=>e.edges[w]??[],x=w=>{if(w==="LR")for(let E=1;E<=l;E++){const R=m[E-1];if(!R||R.length===0)continue;const D=f(E-1);m[E].sort((ee,H)=>{const K=y(ee,D,E-1),Z=y(H,D,E-1);return K!==Z?K-Z:ee.localeCompare(H)})}else for(let E=l-1;E>=0;E--){const R=m[E+1];if(!R||R.length===0)continue;const D=f(E+1);m[E].sort((ee,H)=>{const K=y(ee,D,E+1),Z=y(H,D,E+1);return K!==Z?K-Z:ee.localeCompare(H)})}},y=(w,E,R)=>{const D=b(w);let V=0,ee=0;for(const H of D){if(k(H)!==R)continue;const K=E.get(H);K!=null&&(V+=K,ee+=1)}if(ee===0){const H=k(w),K=(m[H]??[]).indexOf(w);return K<0?9999:K}return V/ee};if(!n)for(let w=0;w<4;w++)x("LR"),x("RL");let N=1;for(const w of T)N=Math.max(N,m[w]?.length??0);const W=N*d,C=u*2+W,O=p*2+(l+1)*c,$={};for(const w of T){const E=m[w]??[],R=E.length,D=R*d,V=(W-D)/2,ee=p+w*c;for(let H=0;H<R;H++){const K=E[H],Z=u+V+(H+.5)*d;$[K]={x:ee,y:Z,depth:Number(e.nodes[K]?.depth??999)}}}return{width:O,height:C,pos:$,maxDepth:l,maxCount:N}}function Gl(e,t,n){return n?"â—":t==="HIDDEN"?"":t==="PRESENCE"?"Â·":e?Ut(e,!1).icon:"?"}function Yl(e,t,n,r,o,s){const a=Vl(r),i=Er(r),l=_t(r,r.pos,Math.max(0,o.presenceR|0)),c=S=>S===r.pos||(i[S]??0)>0,d=Object.keys(r.nodes).filter(c);d.includes(r.pos)||d.push(r.pos);const p=70;let u=1/0,k=1/0,T=-1/0,m=-1/0;for(const S of d){const A=a.pos[S];A&&(u=Math.min(u,A.x),k=Math.min(k,A.y),T=Math.max(T,A.x),m=Math.max(m,A.y))}Number.isFinite(u)||(u=0,k=0,T=300,m=200);const f=u-p,b=k-p,x=T-u+p*2,y=m-k+p*2,N=1.4,W=460,C="#0B0B0B",O="#B34A46",$="rgba(242,241,234,.70)",w="rgba(242,241,234,.34)",E="rgba(179,74,70,.34)",R=C,D=g("mapMiniBox");D.style.cssText="margin-top:calc(12 * var(--u)); border:0 solid rgba(255,255,255,.12); border-radius:calc(12 * var(--u)); background:rgba(0,0,0,0); padding:calc(10 * var(--u));";const V=ae("","");V.style.cssText="font-weight:700; margin-bottom:calc(8 * var(--u)); opacity:.95;",D.appendChild(V);const ee=g("mapMiniScroller"),H=g("mapMiniViewport");ee.appendChild(H),ee.style.cssText=`position:relative; overflow:auto; max-height:calc(${W} * var(--u)); border-radius:calc(10 * var(--u)); background:rgba(255,255,255,.0);`,H.addEventListener("wheel",S=>{Math.abs(S.deltaY)>Math.abs(S.deltaX)&&(H.scrollLeft+=S.deltaY,S.preventDefault())},{passive:!1});const K=document.createElementNS("http://www.w3.org/2000/svg","svg");K.setAttribute("viewBox",`${f} ${b} ${x} ${y}`),K.style.width=`calc(${x*N} * var(--u))`,K.style.height=`calc(${y*N} * var(--u))`,K.setAttribute("preserveAspectRatio","xMidYMid meet"),K.style.display="block";const Z=document.createElementNS("http://www.w3.org/2000/svg","g"),X=document.createElementNS("http://www.w3.org/2000/svg","g");K.appendChild(Z),K.appendChild(X);const v=new Set(r.edges[r.pos]??[]),_=(S,A,j)=>{const I=Math.max(0,Math.min(3,j));return xn(t,S,A,I,{...o})},M=(S,A)=>{const j=S.x,I=S.y,U=A.x,J=A.y,te=Math.abs((S.depth??0)-(A.depth??0));if(te===0)return`M ${j} ${I} L ${U} ${J}`;if(te>=2){const re=38+10*te,Q=Math.max(j,U)+re;return`M ${j} ${I} C ${Q} ${I}, ${Q} ${J}, ${U} ${J}`}const L=U-j,G=j+L*.35,oe=j+L*.65;return`M ${j} ${I} C ${G} ${I}, ${oe} ${J}, ${U} ${J}`},z=new Set(d);for(const S of d)for(const A of r.edges[S]??[]){if(S>=A||!z.has(A))continue;const j=r.nodes[S]?.depth,I=r.nodes[A]?.depth;if(j!=null&&I!=null&&Math.abs(Number(j)-Number(I))>1)continue;const U=a.pos[S],J=a.pos[A];if(!U||!J)continue;const te=document.createElementNS("http://www.w3.org/2000/svg","path");te.setAttribute("d",M(U,J)),te.setAttribute("fill","none"),te.setAttribute("stroke",$),te.setAttribute("stroke-width","2"),Z.appendChild(te)}const P=d.slice().sort((S,A)=>S.localeCompare(A));for(const S of P){const A=a.pos[S];if(!A)continue;const j=r.nodes[S],I=j?.kind??"BATTLE",U=l[S],J=S===r.pos?3:U==null?0:vn(U,o),te=i[S]??0,L=J>0?xn(t,S,I,J):_(S,I,te),G=S===r.pos,oe=v.has(S),re=I==="START";if(G){const Ie=document.createElementNS("http://www.w3.org/2000/svg","circle");Ie.setAttribute("cx",String(A.x)),Ie.setAttribute("cy",String(A.y)),Ie.setAttribute("r",String(22)),Ie.setAttribute("fill","none"),Ie.setAttribute("stroke",O),Ie.setAttribute("stroke-width",String(3.5)),Ie.setAttribute("opacity","0.55"),Ie.style.filter="drop-shadow(0 0 calc(6 * var(--u)) rgba(179,74,70,.65))",X.appendChild(Ie)}const Q=document.createElementNS("http://www.w3.org/2000/svg","circle");Q.setAttribute("cx",String(A.x)),Q.setAttribute("cy",String(A.y)),Q.setAttribute("r",String(G?13:10));const le=G||oe;Q.setAttribute("fill",le?E:w),Q.setAttribute("stroke","none"),Q.setAttribute("stroke-width","0"),Q.style.cursor=oe&&!G?"pointer":"default",oe&&!G&&Q.addEventListener("click",Ie=>{Ie.preventDefault(),Ie.stopPropagation(),n.onMoveToNode?.(S)});const me=document.createElementNS("http://www.w3.org/2000/svg","title"),Oe=(j?.cleared||j?.visited,"");me.textContent=`${Oe}`,Q.appendChild(me),X.appendChild(Q);const ge=document.createElementNS("http://www.w3.org/2000/svg","text");ge.setAttribute("x",String(A.x)),ge.setAttribute("y",String(A.y)),ge.setAttribute("dominant-baseline","central"),ge.setAttribute("text-anchor","middle"),ge.setAttribute("font-size","14"),ge.style.fontSize="var(--mapNodeEmojiSize, calc(16 * var(--u)))",ge.setAttribute("fill",R),ge.style.pointerEvents="none",ge.style.userSelect="none";const Gt=Gl(L.shown,L.certainty,re);ge.textContent=Gt,ge.style.opacity="0.95",X.appendChild(ge)}H.appendChild(K),D.appendChild(ee),requestAnimationFrame(()=>{const S=a.pos[r.pos];if(!S)return;const A=yl(),j=(S.x-f)*A*N,I=(S.y-b)*A*N,U=Math.max(0,j-H.clientWidth*.45),J=Math.max(0,I-H.clientHeight*.45);H.scrollLeft=U,H.scrollTop=J});const ne=ae("","");ne.style.cssText="margin-top:calc(8 * var(--u)); font-size:calc(12 * var(--u)); opacity:.8; line-height:1.3;",D.appendChild(ne),e.appendChild(D)}function Xl(e,t,n){const{map:r,timeMove:o,pursuit:s}=An(t),a=zl(t);Wl(r,a);const i=g("nodeSelectWrap");i.classList.add("mapNodeSelect");const l=g("nodeSelectHeader");l.style.cssText="display:flex; align-items:flex-end; justify-content:space-between; gap:calc(16 * var(--u));";const c=g("nodeSelectTitle"),d=oa(t),p=t.run.nodePickCount??0;c.appendChild(ae("",`ì´ ì‹œê°„ ${d} Â· íƒí—˜ ${p} Â· ì´ë™ ${o}`)),Zo(t);const u=t.run,k=Number(u.nextBossTime??40)||40,T=Math.max(0,k-d),m=t.run.bossOmenText&&String(t.run.bossOmenText).trim()!==""?String(t.run.bossOmenText):"ì•„ì§ ì§•ì¡°ê°€ ì—†ë‹¤.";if(c.appendChild(ae("",`ë‹¤ìŒ ë³´ìŠ¤ê¹Œì§€ ${T} Â· ${m}`)),T<=3){const x=t.run;(Number(x.bossApproachToastBossTime??-1)||-1)!==k&&(x.bossApproachToastBossTime=k,Y(t,"WARN",`ë³´ìŠ¤ê°€ ë‹¤ê°€ì˜µë‹ˆë‹¤ (ë‚¨ì€ ì´ë™ ${T})`,2200))}if(t.run.treasureObtained){const x=_t(r,r.pos,9999)[r.startId],y=x==null?"?":String(x);c.appendChild(ae("",`ì¶”ê²© ${s.heat??0} (tier ${Tn(s.heat??0)}) Â· ì…êµ¬ê¹Œì§€ ${y}`))}const f=g("nodeSelectHeaderRight"),b=ue(Ze?"ìƒì„¸ ë‹«ê¸°":"ìƒì„¸",()=>{Ze=!Ze,Ze||Pt(),B(t,n)});if(b.classList.add("mapDetailToggleBtn"),b.style.cssText="margin-left:calc(-30 * var(--u)); padding:calc(2 * var(--u)) calc(5 * var(--u)); opacity:.9;",f.appendChild(b),l.appendChild(c),l.appendChild(f),i.appendChild(l),Yl(i,t,n,r,a),Ze){const x=g("mapDetailPanel");x.style.cssText="position:fixed; right:calc(24 * var(--u)); top:calc(24 * var(--u)); width:min(calc(520 * var(--u)), calc(100vw - calc(64 * var(--u)))); max-height:calc(100vh - calc(64 * var(--u))); overflow-y:auto; overflow-x:hidden; z-index:70001; border:calc(1 * var(--u)) solid rgba(255,255,255,.14); border-radius:calc(14 * var(--u)); background:rgba(0,0,0,1); backdrop-filter:none; padding:calc(12 * var(--u));",x.addEventListener("click",E=>E.stopPropagation()),x.addEventListener("wheel",E=>E.stopPropagation(),{passive:!0});const y=E=>{const R=E.target;if(R&&x.contains(R))return;Ze=!1,Pt();try{x.remove()}catch{}const D=document.querySelector(".mapDetailToggleBtn");D&&(D.textContent="ìƒì„¸")},N=g("");N.style.cssText="display:flex; align-items:center; justify-content:space-between; gap:calc(10 * var(--u));";const W=ae("","ì§€ë„ ìƒì„¸");W.style.cssText="font-weight:700; opacity:.95;",N.appendChild(W);const C=ue("ë‹«ê¸°",()=>{Ze=!1,Pt(),B(t,n)});C.style.cssText="padding:calc(6 * var(--u)) calc(10 * var(--u)); opacity:.9;",N.appendChild(C),x.appendChild(N);const O=g("");O.style.cssText="margin-top:calc(10 * var(--u)); padding:calc(10 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.10); border-radius:calc(12 * var(--u)); background:rgba(255,255,255,.03);";const $=Jn("ì´ë™ ê°€ëŠ¥í•œ ì´ì›ƒ");$.style.margin="0 0 calc(6 * var(--u)) 0",O.appendChild($);const w=r.edges[r.pos]??[];w.length===0&&O.appendChild(wr("ì´ì›ƒì´ ì—†ìŠµë‹ˆë‹¤."));for(let E=0;E<w.length;E++){const R=w[E],V=r.nodes[R]?.kind??"BATTLE",ee=a.presenceR>=1?vn(1,a):0,H=Ul(r,R),K=ee>0?xn(t,R,V,ee):H>=2?V==="START"?{shown:null,label:"ì…êµ¬"}:{shown:V,label:Ut(V,!1).text}:H===1?{shown:null,label:"ë¬´ì–¸ê°€"}:{shown:null,label:"ë³´ì´ì§€ ì•ŠìŒ"},Z=g("");Z.style.cssText="display:flex; align-items:center; gap:calc(10 * var(--u)); padding:calc(8 * var(--u)) calc(10 * var(--u)); border-radius:calc(10 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.10); background:rgba(0,0,0,.20);margin-top:calc(6 * var(--u));";const X=ae("",ee>0||H>0?`${R}`:`ì¶œêµ¬ ${E+1}`);X.style.cssText="flex:0 0 auto; padding:calc(4 * var(--u)) calc(8 * var(--u)); border-radius:calc(10 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.14); background:rgba(0,0,0,.25); opacity:.9;",Z.appendChild(X);const v=g("");v.style.cssText="flex:1 1 auto; min-width:0;",jl(v,K),Z.appendChild(v),O.appendChild(Z)}if(x.appendChild(O),a.presenceR>=2){const E=_t(r,r.pos,a.presenceR),R=Object.keys(E).filter(D=>(E[D]??999)>=2&&(E[D]??999)<=a.presenceR).sort((D,V)=>E[D]-E[V]||D.localeCompare(V));if(R.length){const D=g("");D.style.cssText="margin-top:calc(10 * var(--u)); padding:calc(10 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.10); border-radius:calc(12 * var(--u)); background:rgba(255,255,255,.03);";const V=Jn("ë©€ë¦¬ ë³´ì´ëŠ” ê³³");V.style.margin="0 0 calc(6 * var(--u)) 0",D.appendChild(V);const ee=new Map;for(const K of R){const Z=E[K]??0,v=r.nodes[K]?.kind??"BATTLE",_=vn(Z,a),M=xn(t,K,v,_),z=M.certainty==="PRESENCE"?"ë¬´ì–¸ê°€":M.label,P=ee.get(Z)??{};P[z]=(P[z]??0)+1,ee.set(Z,P)}const H=Array.from(ee.keys()).sort((K,Z)=>K-Z);for(const K of H){const Z=ee.get(K),X=Object.keys(Z).map(v=>`${v}Ã—${Z[v]}`);D.appendChild(ae("",`ê±°ë¦¬ ${K}: ${X.join(" Â· ")}`))}x.appendChild(D)}}Pt(),Rt=y,document.addEventListener("pointerdown",Rt,!0),e.appendChild(x)}e.appendChild(i)}function sa(e,t,n){const{map:r}=An(t);{const o=t.run,s=`${String(r.pos??"")}::${Number(o.timeMove??0)||0}`;o._bdNodeToastKey!==s&&(o._bdNodeToastKey=s,ve(t)==="bright_darkness"&&(Y(t,"INFO",q.bright_darkness.nodeSelect,1800),h(t,q.bright_darkness.nodeSelect)),Ce(t,"bright_darkness")&&(Y(t,"WARN",q.bright_darkness.hostileMap,2200),h(t,q.bright_darkness.hostileMap)))}Xl(e,t,n)}function ia(e,t){let n=null,r=!1,o=!1;const s=[];function a(m){s.length=0,m.choice=null,n=null,document.querySelector(".choice-overlay")?.remove()}function i(m){s.push({choice:m.choice,handler:n})}function l(m){const f=s.pop();if(!f){c(m);return}m.choice=f.choice,n=f.handler}function c(m){if(s.length>0){l(m);return}m.choice=null,n=null,document.querySelector(".choice-overlay")?.remove()}function d(m,f,b){m.choice&&i(m),m.choice=f,n=b}const p=()=>Me||e,u={onHotkeySlot:(m,f)=>{const b=p();if(b.run.finished||ye(b)||b.phase!=="PLACE"||m==="back"&&b.backSlotDisabled?.[f])return;const x=m==="front"?b.frontSlots:b.backSlots,y=x[f];if(!b.selectedHandCardUid){if(!y)return;u.onReturnSlotToHand(m,f);return}const N=b.selectedHandCardUid;if(!y){u.onPlaceHandUidToSlot(N,m,f);return}x[f]=null,(b.placedUidsThisTurn??[]).includes(y)&&(b.usedThisTurn=Math.max(0,b.usedThisTurn-1),m==="front"&&(b.frontPlacedThisTurn=Math.max(0,b.frontPlacedThisTurn-1)),b.placedUidsThisTurn=(b.placedUidsThisTurn??[]).filter(C=>C!==y)),b.hand.push(y),b.cards[y].zone="hand",Dr(b,N,m,f),b.selectedHandCardUid=null,h(b,`[${Le(b,N)}] â†” [${Le(b,y)}] ìŠ¤ì™‘: ì†íŒ¨ â†” ${m}${f+1}`),B(b,u)},rerender:()=>{const m=p();B(m,u)},onToggleLogOverlay:()=>{tr=!tr,B(p(),u)},onUseItem:m=>{const f=p();if(f.run.finished||f.choice||ce||ye(f))return;Bs(f,m)&&B(f,u)},onDiscardItem:m=>{const f=p();if(f.run.finished||ce||ye(f))return;Ls(f,m,"UI")&&B(f,u)},onCloseOverlay:()=>{const m=p();ce=null,B(m,u)},onNewRun:()=>{const m=p();Fe=null,ce=null,F=null,c(m),qi(),t(Qn(m.content))},onViewRulebook:()=>{const m=p();ce={kind:"RULEBOOK"},B(m,u)},onViewPile:m=>{const f=p();ce={kind:"PILE",pile:m},B(f,u)},onViewSettings:()=>{const m=p();ce={kind:"SETTINGS"},B(m,u)},onReturnSlotToHand:(m,f)=>{const b=p();if(b.run.finished||ye(b)||b.phase!=="PLACE")return;const x=m==="front"?b.frontSlots:b.backSlots,y=x[f];if(!y)return;{const W=b.cards[y];if(xe(b.content,W.defId,W.upgrade??0).tags?.includes("LOCKED")){Y(b,"WARN","ì´ ì¹´ë“œëŠ” íšŒìˆ˜í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",1600);return}}x[f]=null,(b.placedUidsThisTurn??[]).includes(y)&&(b.usedThisTurn=Math.max(0,b.usedThisTurn-1),m==="front"&&(b.frontPlacedThisTurn=Math.max(0,b.frontPlacedThisTurn-1)),b.placedUidsThisTurn=(b.placedUidsThisTurn??[]).filter(W=>W!==y)),b.hand.push(y),b.cards[y].zone="hand",h(b,`[${Le(b,y)}] íšŒìˆ˜: ${m}${f+1} â†’ ì†íŒ¨`),B(b,u)},onClearSelected:()=>{const m=p();m.selectedHandCardUid=null,B(m,u)},onSelectEnemy:m=>{const f=p();if(o)return;o=!0,requestAnimationFrame(()=>{o=!1});const b=hi(f,m);B(f,u),b&&!f.choice&&!f.run.finished&&u.onAutoAdvance()},onSelectHandCard:m=>{const f=p();ye(f)||(f.selectedHandCardUid=f.selectedHandCardUid===m?null:m,B(f,u))},onMoveToNode:m=>{const f=p();if(f.run.finished||f.choice||f.phase!=="NODE"||r)return;r=!0,setTimeout(()=>r=!1,180);const b=f.run,{map:x,pursuit:y}=An(f),N=x.pos;if(!(x.edges[N]??[]).includes(m))return;b.timeMove=Number(b.timeMove??0)+es(f),x.visionNonce=Number(x.visionNonce??0)+1,x.pos=m;const C=x.nodes[m]??(x.nodes[m]={id:m,kind:"BATTLE"}),O=!C.visited;if(O&&(C.visited=!0,f.run.nodePickCount=(f.run.nodePickCount??0)+1),f.run.treasureObtained){if(y.heat=Number(y.heat??0)+1,Tn(y.heat),x.pos===x.startId){f.run.finished=!0,h(f,"ë³´ë¬¼ì„ ë“¤ê³  ì…êµ¬ë¡œ ëŒì•„ì™”ë‹¤! íƒˆì¶œì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤!"),B(f,u);return}O&&C.kind!=="TREASURE"&&C.kind!=="START"&&(f.run.afterTreasureNodePicks=(f.run.afterTreasureNodePicks??0)+1)}Zo(f);const $=oa(f);if(Number(b.nextBossTime??0)>0&&$>=Number(b.nextBossTime??0)){b.forcedNext=null,b.nextBossTime=Number(b.nextBossTime??0)+40,f.run.bossOmenText=null,C.cleared=!0,C.kind="EMPTY",C.noRespawn=!0,C.lastClearedMove=Number(b.timeMove??0),h(f,"ì‹œê°„ì´ ë‹¤ ë˜ì–´ ë³´ìŠ¤ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. (ì‹œê°„ +1)"),pt(f,{forceBoss:!0}),At(f),B(f,u);return}const w=Number(b.timeMove??0)||0;C.cleared&&(C.kind==="BATTLE"||C.kind==="EVENT"||C.kind==="REST"||C.kind==="ELITE")&&(C.kind==="ELITE"&&(C.noRespawn=!0),C.kind="EMPTY",C.lastClearedMove=Number(C.lastClearedMove??w));let E=C.kind;if(E==="EMPTY"){const R=!!C.noRespawn,D=Number(C.lastClearedMove??-999),V=Number(b.respawnCooldownMoves??2)||2,ee=w-D<=V;if(!R&&!ee){const H=f.run.treasureObtained?Tn(y.heat):0,K=Math.max(0,Number(f.player.fatigue??0)||0),Z=Lt(K/25)*.18,X=f.run.treasureObtained?.22:.12,v=f.run.treasureObtained?.1:.08,_=Lt(X+H*v+Z);if(Math.random()<_){const M=Math.random(),z=f.run.treasureObtained?.72:.55,P=f.run.treasureObtained?.9:.85;E=M<z?"BATTLE":M<P?"EVENT":"REST",C.kind=E,C.cleared=!1,C.respawnCount=Number(C.respawnCount??0)+1,h(f,"ì¬ë°œë™: ì´ê³³ì—ì„œ ë‹¤ì‹œ ë¬´ì–¸ê°€ê°€ ì¼ì–´ë‚©ë‹ˆë‹¤...")}}}if(br(f)===3&&(E==="EVENT"||E==="REST"||E==="SHOP")&&Math.random()<.5&&(E="BATTLE",h(f,"ê´‘ê¸°(ì ëŒ€): ë˜ì „ì´ ë’¤í‹€ë ¤ ì „íˆ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤..."),Y(f,"WARN","ê´‘ê¸°ì˜ í˜ì´ ê¸¸ì„ ë§‰ì•„ì„­ë‹ˆë‹¤.",1800)),E==="START"){B(f,u);return}if(E==="TREASURE"){C.cleared=!0,C.kind="EMPTY",C.noRespawn=!0,C.lastClearedMove=w,Ra(f),B(f,u);return}if(E==="REST"){C.cleared=!0,C.kind="EMPTY",C.lastClearedMove=w;const R=(f.player.fatigue??0)>=10;as(f);const D=ve(f),V=Ce(f,"dream_shadow"),ee=wn(f),Z=[{key:"rest:heal",label:"íšŒë³µ",detail:V?"íšŒë³µëŸ‰ 0":D==="dream_shadow"?"í•­ìƒ ìµœëŒ€ ì²´ë ¥ (F +3)":"HP +15"},{key:"rest:clear_f",label:"ì •ë¹„",detail:"F -3"},{key:"rest:upgrade",label:"ê°•í™”",detail:ee?"(ë¶ˆê°€)":D==="dream_shadow"||V?"ì¹´ë“œ 1ì¥ ê°•í™” (í”¼ë¡œë§Œí¼ í”¼í•´)":"ì¹´ë“œ 1ì¥ ê°•í™”"},{key:"rest:skip",label:"ë– ë‚˜ê¸°"}],X=ee?Z.filter(v=>v.key!=="rest:upgrade"):Z;f.choice={kind:"EVENT",title:"íœ´ì‹",art:de("assets/events/event_rest.png"),prompt:R?"í”¼ë¡œê°€ ë„ˆë¬´ ë†’ì•„ ì‹œê°„ì´ ë” ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.":"ìº í”„ì— ì ì‹œ ë¨¸ë¬¸ë‹¤.",options:X},f.choiceCtx={kind:"REST",highF:R},B(f,u);return}if(E==="SHOP"){C.visited=!0,C.cleared=!0,C.noRespawn=!0,C.lastClearedMove=w,se(f,m),B(f,u);return}if(E==="EVENT"){C.cleared=!0,C.kind="EMPTY",C.lastClearedMove=w;const R=f.run;if(R.ominousProphecySeen??=!1,pe(f).chosen){const K=qa(f);if(K&&Math.random()<.25){Mo(f,K),B(f,u);return}}const D=.3;let V=In(f);if(R.ominousProphecySeen===!0)for(let H=0;H<50&&V.id==="ominous_prophecy";H++)V=In(f);else Math.random()<D&&(V=jo("ominous_prophecy")??V);{const H=R.lastEventId??null;if(H&&V?.id===H)for(let K=0;K<60;K++){const Z=In(f),X=Z?.id;if(X&&!(R.ominousProphecySeen===!0&&X==="ominous_prophecy")&&X!==H){V=Z;break}}}if(V?.id==="ominous_prophecy"&&(R.ominousProphecySeen=!0),!V){B(f,u);return}{const H=f.run;H.eventsSeen??={};const K=Number(H.eventsSeen[V.id]??0)||0;H.eventsSeen[V.id]=K+1,H.lastEventId=V.id}let ee=V.options(f);f.choice={kind:"EVENT",title:V.name,prompt:V.prompt,art:V.art??null,options:ee.map(H=>({key:H.key,label:H.label,detail:H.detail}))},n=H=>{const K=ee.find(v=>v.key===H);if(!K)return;const Z=_e(f);Z.eventPicks+=1,Ae(f);const X=K.apply(f);if(typeof X=="object"&&X.kind==="UPGRADE_PICK"){T(f,u,X.title??"ê°•í™”",X.prompt??"ê°•í™”í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.");return}if(typeof X=="object"&&X.kind==="REMOVE_PICK"){const v=Object.values(f.cards).filter(_=>(_.zone==="deck"||_.zone==="hand"||_.zone==="discard")&&_.defId!=="goal_treasure").map(_=>_.uid);d(f,{kind:"PICK_CARD",title:X.title,prompt:X.prompt??"ì œê±°í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",options:[...v.map(_=>{const M=Wt(f,_);return{key:`remove:${_}`,label:Le(f,_),detail:`ì „ì—´: ${M.frontText} / í›„ì—´: ${M.backText}`,cardUid:_}}),{key:"cancel",label:"ì·¨ì†Œ"}]},_=>{if(_==="cancel"){h(f,"ì œê±° ì·¨ì†Œ"),c(f),B(f,u);return}if(!_.startsWith("remove:")){B(f,u);return}const M=_.slice(7);Bt(f,M);const z=X.then,P=z==="REWARD"||z==="REWARD_PICK"?"REWARD_PICK":z==="BATTLE"?"BATTLE":z==="NONE"?"NONE":void 0;if(P==="BATTLE"){a(f),f.phase="NODE",pt(f),At(f),B(f,u);return}if(P==="REWARD_PICK"){a(f),k(f,u,"ì¹´ë“œ ë³´ìƒ","ë‘ ì¥ ì¤‘ í•œ ì¥ì„ ì„ íƒí•˜ê±°ë‚˜ ìƒëµí•©ë‹ˆë‹¤."),B(f,u);return}a(f),f.phase="NODE",B(f,u)}),B(f,u);return}if(typeof X=="object"&&X.kind==="BATTLE_SPECIAL"){a(f),f.run.onWinGrantRelicId=X.onWinGrantRelicId??null,h(f,X.title?`ì´ë²¤íŠ¸ ì „íˆ¬: ${X.title}`:"ì´ë²¤íŠ¸ ì „íˆ¬ ë°œìƒ!");const v=f.run;v.pendingEventWinRelicId=X.onWinGrantRelicId??null,v.pendingEventWinGold=Number(X.onWinGrantGold??0)||0,f.phase="NODE",pt(f,{forcePatternIds:X.enemyIds}),f._justStartedCombat=!0,At(f),B(f,u);return}if(X==="BATTLE"){a(f),f.phase="NODE",pt(f),f._justStartedCombat=!0,At(f),B(f,u);return}if(X==="REWARD"){a(f),k(f,u,"ì¹´ë“œ ë³´ìƒ","ë‘ ì¥ ì¤‘ í•œ ì¥ì„ ì„ íƒí•˜ê±°ë‚˜ ìƒëµí•©ë‹ˆë‹¤."),B(f,u);return}c(f),B(f,u)},B(f,u);return}if(E==="BATTLE"||E==="ELITE"){if(Po(f)===3&&Math.random()<.5){C.cleared=!0,C.kind="EMPTY",C.lastClearedMove=w,E==="ELITE"&&(C.noRespawn=!0),h(f,"ê´‘ê¸°: ì „íˆ¬ê°€ ì–´ë”˜ê°€ë¡œ ì‚¬ë¼ì¡Œë‹¤..."),Y(f,"INFO","ì „íˆ¬ê°€ ì¼ì–´ë‚˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.",1600),B(f,u);return}C.cleared=!0,C.kind="EMPTY",C.lastClearedMove=w,E==="ELITE"&&(C.noRespawn=!0),h(f,"ì´ë™ í›„ ì „íˆ¬ ì‹œì‘ (ì‹œê°„ +1)"),E==="ELITE"?pt(f,{forceBoss:!1,forceElite:!0}):pt(f,{forceBoss:!1}),At(f),B(f,u);return}B(f,u)},onChooseChoice:m=>{const f=p();if(!f.choice)return;const b=f.choice.kind;if(Ki(f,m)){const x=b==="EVENT"&&m==="startBattle";B(f,u),x||u.onAutoAdvance();return}if(n){n(m);const x=b==="EVENT"&&m==="startBattle";B(f,u),x||u.onAutoAdvance();return}h(f,`ì„ íƒ ì²˜ë¦¬ ë¶ˆê°€: handler ì—†ìŒ (kind=${b}, key=${m})`)},onAutoAdvance:()=>{const m=p();xl(m,u)},onRevealIntents:()=>{const m=p();m.run.finished||m.enemies.length!==0&&(yr(m),B(m,u))},onPlaceHandUidToSlot:(m,f,b)=>{const x=p();x.run.finished||ye(x)||x.phase==="PLACE"&&(f==="back"&&x.backSlotDisabled?.[b]||(Dr(x,m,f,b),x.selectedHandCardUid=null,B(x,u)))},onPlaceSelected:(m,f)=>{const b=p();b.selectedHandCardUid&&u.onPlaceHandUidToSlot(b.selectedHandCardUid,m,f)},onMoveSlotCard:(m,f,b,x)=>{const y=p();if(y.run.finished||ye(y)||y.phase!=="PLACE"||b==="back"&&y.backSlotDisabled?.[x])return;const N=m==="front"?y.frontSlots:y.backSlots,W=b==="front"?y.frontSlots:y.backSlots,C=N[f];if(!C)return;{const $=y.cards[C];if(xe(y.content,$.defId,$.upgrade??0).tags?.includes("LOCKED")){Y(y,"WARN","ì´ ì¹´ë“œëŠ” íšŒìˆ˜í•˜ê±°ë‚˜ ì´ë™í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",1600);return}}const O=W[x];if(O){const $=y.cards[O];if(xe(y.content,$.defId,$.upgrade??0).tags?.includes("LOCKED")){Y(y,"WARN","ì´ ì¹´ë“œëŠ” íšŒìˆ˜í•˜ê±°ë‚˜ ì´ë™í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",1600);return}}N[f]=O??null,W[x]=C,y.cards[C].zone=b,O&&(y.cards[O].zone=m),m!==b&&(m==="front"&&(y.frontPlacedThisTurn=Math.max(0,y.frontPlacedThisTurn-1)),b==="front"&&(y.frontPlacedThisTurn+=1),O&&(b==="front"&&(y.frontPlacedThisTurn=Math.max(0,y.frontPlacedThisTurn-1)),m==="front"&&(y.frontPlacedThisTurn+=1))),h(y,O?`[${Le(y,C)}] â†” [${Le(y,O)}] ìŠ¤ì™‘: ${m}${f+1} â†” ${b}${x+1}`:`[${Le(y,C)}] ì´ë™: ${m}${f+1} â†’ ${b}${x+1}`),nr(y),B(y,u)},onResolveBack:()=>{const m=p();m.phase==="PLACE"&&nr(m),ni(m),B(m,u)},onResolveFront:()=>{const m=p();ri(m),B(m,u)},onResolveEnemy:()=>{const m=p();ai(m),B(m,u)},onUpkeep:()=>{const m=p();li(m),B(m,u)},onDrawNextTurn:()=>{const m=p();di(m),B(m,u)}};function k(m,f,b,x){const N=Ba(m).map(W=>{const C=xe(m.content,W.defId,W.upgrade);return{key:`pick:${W.defId}:${W.upgrade}`,label:$l(m,W),detail:`ì „ì—´: ${C.frontText} / í›„ì—´: ${C.backText}`}});m.choice={kind:"REWARD",title:b,prompt:x,options:[...N,{key:"skip",label:"ìƒëµ"}]},n=W=>{if(n=null,W.startsWith("pick:")){const C=W.slice(5),[O,$]=C.split(":"),w=Number($??"0")||0;dt(m,O,{upgrade:w})}else h(m,"ì¹´ë“œ ë³´ìƒ ìƒëµ");c(m),m.choice=null,m.run.finished||(m.phase="NODE"),B(m,f)},B(m,f)}function T(m,f,b,x,y){let N=Object.values(m.cards).filter($=>($.zone==="deck"||$.zone==="hand"||$.zone==="discard")&&qt(m,$.uid)).map($=>$.uid);const W=m.player.fatigue??0;let C=1/0;if(W>=8?C=4:W>=5&&(C=8),C!==1/0&&N.length>C&&(N=[...N].sort(()=>Math.random()-.5).slice(0,C)),N.length===0){h(m,"ê°•í™”í•  ìˆ˜ ìˆëŠ” ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤."),m.choice=null,n=null,B(m,f);return}const O=[...N].sort(($,w)=>{const E=m.cards[$],R=m.cards[w],D=kn(m,E.defId),V=kn(m,R.defId),ee=D.localeCompare(V,"ko");return ee!==0?ee:(E.upgrade??0)-(R.upgrade??0)});m.choice={kind:"UPGRADE_PICK",title:b,prompt:x,options:[...O.map($=>{const w=m.cards[$],E=Wt(m,$),R=xe(m.content,w.defId,(w.upgrade??0)+1),D=Le(m,$),V=`í˜„ì¬: ì „ì—´ ${E.frontText} / í›„ì—´ ${E.backText}
ê°•í™”: ì „ì—´ ${R.frontText} / í›„ì—´ ${R.backText}`;return{key:`up:${$}`,label:D,detail:V,cardUid:$}}),{key:"skip",label:"ì·¨ì†Œ"}]},n=$=>{if($==="skip"){h(m,"ê°•í™” ì·¨ì†Œ"),c(m),B(m,f);return}if($.startsWith("up:")){const w=$.slice(3),E=Ht(m,w);h(m,E?`ê°•í™”: [${Le(m,w)}]`:"ê°•í™” ì‹¤íŒ¨"),c(m),B(m,f);return}c(m),B(m,f)},B(m,f)}return u}function nr(e){const t=(e.placedUidsThisTurn??[]).filter(r=>{const o=e.cards[r];return!!o&&(o.zone==="front"||o.zone==="back")});e.usedThisTurn=t.length;let n=0;for(const r of t)e.cards[r]?.zone==="front"&&(n+=1);e.frontPlacedThisTurn=n}function Ql(){nl();const e=document.querySelector("#app");return e.innerHTML="",e}function ue(e,t,n=""){const r=document.createElement("button");return n&&(r.className=n),r.type="button",r.textContent=e,r.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation(),t()}),r}function _r(){const e=Array.from(document.querySelectorAll(".enemyName"));if(e.length===0)return;let t=0;for(const o of e){const s=(o.textContent??"").trim();s.length>t&&(t=s.length)}const r=Math.max(6,Math.min(t,24));e.forEach(o=>{o.style.display="inline-block",o.style.width=`${r}ch`,o.style.whiteSpace="nowrap",o.style.overflow="hidden",o.style.textOverflow="ellipsis"})}function Zl(){document.querySelector(".phaseBanner")?.remove(),performance.now()}function Jl(){pl();let e=document.querySelector(".floatFxLayer");e||(e=document.createElement("div"),e.className="floatFxLayer",document.body.appendChild(e)),e.style.cssText="position:fixed; inset:0;pointer-events:none;z-index: var(--zChrome);";for(const t of hn){const n=String(t.id);let r=e.querySelector(`.floatNum[data-fx-id="${n}"]`);if(r){const o=t.x/window.innerWidth*100,s=t.y/window.innerHeight*100;r.style.left=`${o.toFixed(4)}vw`,r.style.top=`${s.toFixed(4)}vh`}else{r=document.createElement("div"),r.className=`floatNum ${t.kind}`,r.dataset.fxId=n,r.textContent=t.text,r.style.position="absolute";const o=t.x/window.innerWidth*100,s=t.y/window.innerHeight*100;r.style.left=`${o.toFixed(4)}vw`,r.style.top=`${s.toFixed(4)}vh`,e.appendChild(r)}}}function ec(){if(document.querySelector(".floatingNewRun"))return;const e=document.createElement("button");e.className="floatingNewRun",e.type="button",e.textContent="";const t=document.createElement("span");t.className="floatingNewRunLabel",t.textContent="ìƒˆë¡œìš´ ëŸ°",e.appendChild(t),e.style.cssText=`
    position: fixed;
    top: calc(env(safe-area-inset-top, 0) + calc(10 * var(--u)));
    left: calc(env(safe-area-inset-left, 0) + calc(10 * var(--u)));
    pointer-events: auto;
    z-index: calc(var(--zChrome) + 10000);

    display: flex;
    align-items: center;
    gap: calc(10 * var(--u));

    padding: calc(10 * var(--u)) calc(12 * var(--u));
    border-radius: calc(14 * var(--u));
    border: calc(1 * var(--u)) solid rgba(255,255,255,.16);
    background: rgba(0,0,0,.55);
    color: #fff;

    backdrop-filter: blur(calc(8 * var(--u)));
    -webkit-backdrop-filter: blur(calc(8 * var(--u)));
    cursor: pointer;
    touch-action: manipulation;
  `,e.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),Yo?.()}),document.body.appendChild(e)}function tc(){if(document.querySelector(".floatingFaithBadge"))return;const e=document.createElement("div");e.className="floatingFaithBadge",e.textContent="",e.style.right="auto",e.style.bottom="auto",el(e),document.body.appendChild(e)}function nc(e){const t=document.querySelector(".floatingFaithBadge"),n=document.querySelector(".floatingNewRun");if(!t||!n)return;const r=pe(e),o=r.points[r.offered[0]]??0,s=r.points[r.offered[1]]??0,a=r.points[r.offered[2]]??0,i=rt(),l=n.getBoundingClientRect();t.style.left=`${Math.round(l.right+8*i)}px`,t.style.top=`${Math.round(l.top)}px`,t.style.right="auto",t.textContent=`ì‹ ì•™ ${o}Â·${s}Â·${a}`}function so(){const e=document.body;return!!e&&e.classList.contains("mobile")&&e.classList.contains("portrait")}function B(e,t){B._uiScaleInitDone||(B._uiScaleInitDone=!0,Ne=Qo(),la(),window.dispatchEvent(new CustomEvent("deckrogue:uiFit"))),Me=e,ra(),e.phase!=="NODE"&&(Ze=!1,Pt()),Si({getG:()=>Me??e,actions:{onNewRun:()=>t.onNewRun()},rerender:()=>B(Me??e,t),log:d=>h(Me??e,d)}),kt(),Yo=()=>t.onNewRun(),ec(),tc(),nc(e),wl(),B._logInitDone||(B._logInitDone=!0,kl());const n=document.querySelector(".mainPanel");n&&(Qr=n.scrollTop,Zr=n.scrollLeft);const r=Ql();oo||(window.addEventListener("resize",()=>{}),Cc(()=>Me??e,t),oo=!0),r.appendChild(pc(e,t)),fc(e,t);const o=g("mainRow"),s=g("stage"),a=g("stageInner"),i=g("panel mainPanel"),l=!e.run.finished&&e.enemies.length>0&&e.phase!=="NODE";i.classList.toggle("inCombat",l),i.scrollTop=Qr,i.scrollLeft=Zr,so()||i.appendChild(ca(e)),e.run.finished?i.appendChild(wr("ëŸ° ì¢…ë£Œ. ìƒˆë¡œìš´ ëŸ°ì„ ì›í•˜ì‹œë©´ ë²„íŠ¼ì„ ëˆ„ë¥´ê±°ë‚˜ í‚¤ë³´ë“œ Pë¥¼ ì…ë ¥í•˜ì‹­ì‹œì˜¤.")):e.phase==="NODE"&&!so()?sa(i,e,t):kc(i,e,t),a.appendChild(i),s.appendChild(a);const c=g("panel logPanel");if(c.classList.toggle("collapsed",st),c.appendChild(bc(st,()=>{st=!st,Tl(),B(e,t)})),c.classList.add("logScroll"),!st){const d=Al(e.log.join(`
`));d.classList.add("log"),c.appendChild(d)}o.appendChild(s),o.appendChild(c),r.appendChild(o),_r(),ac(e),Tc(e,t,ye(e)),Ar(),Nr(),ma(),lc(e,{...t,onCloseOverlay:()=>{ce=null,B(Me??e,t)}}),uc(e,t),sc(e,t),cc(e,t),dc(e,t),tn(e,t),fl(e),Zl(),Jl(),ul(e),oc(e,t),vl(e),sl(),Xi(rc(e))}function rc(e){const t=e.player.supplies;return!e.run.finished&&e.enemies.length>0&&e.phase!=="NODE"&&typeof t=="number"?t:null}function Sr(e,t){const n=ke[t]??null,r=nn(e,t),o=n?.art??n?.icon??null,s=o?de(String(o)):null,a=s;return{id:t,name:r.name,desc:r.text,state:r.state,icon:a,art:s}}function oc(e,t){document.querySelector(".relicHud")?.remove(),document.querySelector(".relicTooltip")?.remove(),tn(e,t);const n=(e.run.relics??[]).slice();if(n.length===0)return;const r=document.createElement("div");r.className="relicHud";for(const o of n.slice().reverse()){const s=Sr(e,o),a=document.createElement("div");if(a.className="relicIcon",a.setAttribute("role","button"),a.tabIndex=0,s.icon){const l=document.createElement("img");l.className="relicIconImg",l.src=s.icon,l.alt=s.name??s.id??"relic",a.appendChild(l)}else{const l=document.createElement("div");l.textContent=s.name.slice(0,2),l.style.fontWeight="900",l.style.fontSize="calc(12 * var(--u))",l.style.opacity=".95",a.appendChild(l)}const i=(l,c)=>{De=o,tt={x:l,y:c},Kn(e)};a.onpointerenter=l=>i(l.clientX??0,l.clientY??0),a.onpointermove=l=>{De===o&&(tt={x:l.clientX??0,y:l.clientY??0},Kn(e))},a.onpointerleave=()=>{De===o&&(De=null,tt=null,document.querySelector(".relicTooltip")?.remove())},a.onclick=l=>{l.preventDefault(),l.stopPropagation(),lt=o,De=null,tt=null,document.querySelector(".relicTooltip")?.remove(),tn(e,t)},a.onkeydown=l=>{(l.key==="Enter"||l.key===" ")&&(l.preventDefault(),lt=o,tn(e,t))},r.appendChild(a)}document.body.appendChild(r),Kn(e)}function Kn(e){if(document.querySelector(".relicTooltip")?.remove(),!De||!tt)return;const t=Sr(e,De);if(!t.desc&&!t.name)return;const n=document.createElement("div");n.className="relicTooltip";const r=document.createElement("div");if(r.className="relicTooltipTitle",r.textContent=t.name,n.appendChild(r),t.desc){const u=document.createElement("div");u.className="relicTooltipDesc",u.textContent=t.desc,n.appendChild(u)}document.body.appendChild(n);const o=rt(),a=12*o,l=10*o,c=n.getBoundingClientRect();let d=tt.x-c.width,p=tt.y-c.height-l;d=Math.max(a,Math.min(window.innerWidth-c.width-a,d)),p=Math.max(a,Math.min(window.innerHeight-c.height-a,p)),n.style.left=Pe(Math.round(d)),n.style.top=Pe(Math.round(p))}function tn(e,t){if(document.querySelector(".relicModal")?.remove(),!lt)return;const n=Sr(e,lt),r=document.createElement("div");r.className="relicModal",r.style.cssText=`
    position: fixed;
    inset: 0;
    z-index: var(--zRelicModal, 70000);
    pointer-events: auto;
    background: rgba(0,0,0,.55);
    backdrop-filter: blur(calc(6 * var(--u)));
    -webkit-backdrop-filter: blur(calc(6 * var(--u)));
    display: flex;
    align-items: center;
    justify-content: center;
    padding: calc(18 * var(--u));
    box-sizing: border-box;
  `,r.onclick=u=>{u.target===r&&(lt=null,B(e,t))};const o=document.createElement("div");o.className="relicModalPanel",o.onclick=u=>u.stopPropagation();const s=document.createElement("div");s.className="relicModalHeader";const a=document.createElement("h3");a.className="relicModalTitle",a.textContent=n.name,a.style.fontFamily='"ë¬¼ë§ˆë£¨", serif';const i=document.createElement("button");i.type="button",i.textContent="ë‹«ê¸°",i.className="overlayClose",i.onclick=()=>{lt=null,B(e,t)},s.appendChild(a),s.appendChild(i);const l=document.createElement("div");l.className="relicModalBody";const c=document.createElement("div");c.className="relicModalArt";const d=document.createElement("div");d.className="relicModalArtImg",n.art&&(d.style.backgroundImage=`url("${de(n.art)}")`),c.appendChild(d);const p=document.createElement("pre");p.className="relicModalDesc",p.textContent=n.desc||"",p.style.fontFamily='"ë¬¼ë§ˆë£¨", serif',l.appendChild(c),l.appendChild(p),o.appendChild(s),o.appendChild(l),r.appendChild(o),document.body.appendChild(r)}function ac(e){const t=document.querySelector(".stageInner");if(!t)return;document.querySelector(".stageCornerHud")?.remove();const n=document.createElement("div");n.className="stageCornerHud";const r=document.createElement("div");r.className="stageCornerHudTop",r.textContent=mc(e);const o=document.createElement("div");o.className="stageCornerHudBottom",o.textContent=hc(e),n.appendChild(r),n.appendChild(o),document.body.appendChild(n);const s=t.getBoundingClientRect(),l=-56*rt(),c=(s.left+s.right)/2;n.style.right="",n.style.left=Pe(Math.round(c)),n.style.top=Pe(Math.round(s.top+l)),n.style.transform="translateX(-50%)"}function rr(){try{localStorage.setItem(Xo,JSON.stringify(Ne))}catch{}}function zn(e){const t=xt(e,.75,1.5);Cr()?Ne.uiScaleMobile=t:Ne.uiScaleDesktop=t,rr(),la(),window.dispatchEvent(new CustomEvent("deckrogue:uiFit"))}function sc(e,t){if(document.querySelector(".logOverlay")?.remove(),!tr)return;const n=g("logOverlay");n.style.cssText=`
    position: fixed; inset: 0;
    pointer-events:auto;
    background: rgba(0,0,0,.55);
    backdrop-filter: blur(calc(6 * var(--u)));
    display: flex;
    align-items: flex-end;
    justify-content: center;
  `;const r=g("panel");r.style.cssText=`
    width: min(calc(720 * var(--u)), 100%);
    max-height: 70vh;
    border-radius: calc(18 * var(--u)) calc(18 * var(--u)) 0 0;
    padding: calc(12 * var(--u));
    margin: 0;
  `;const o=g("panelHeader"),s=document.createElement("h2");s.textContent="ë¡œê·¸",o.appendChild(s);const a=ue("ë‹«ê¸°",()=>t.onToggleLogOverlay());o.appendChild(a),r.appendChild(o);const i=document.createElement("pre");i.className="log",i.textContent=e.log.join(`
`),i.style.maxHeight="60vh",i.style.overflow="auto",r.appendChild(i),n.onclick=()=>t.onToggleLogOverlay(),r.onclick=l=>l.stopPropagation(),n.appendChild(r),document.body.appendChild(n)}function ic(e,t){const n=g("settingsPanel");n.style.cssText="display:flex; flex-direction:column; gap:calc(12 * var(--u));";const r=g("settingsRow");r.style.cssText="display:flex; align-items:center; gap:calc(12 * var(--u)); flex-wrap:wrap;";const o=ae("","UI ìŠ¤ì¼€ì¼");o.style.cssText="font-weight:800;";const s=()=>Cr()?Ne.uiScaleMobile:Ne.uiScaleDesktop,a=ae("",`${Math.round(s()*100)}%`);a.style.cssText="opacity:.9; min-width:calc(64 * var(--u)); text-align:right;";const i=document.createElement("input");i.type="range",i.min="0.75",i.max="1.25",i.step="0.01",i.value=String(s()),i.style.cssText="flex:1 1 calc(260 * var(--u));",i.oninput=()=>{const b=Number(i.value);zn(b),a.textContent=`${Math.round(s()*100)}%`,e()},r.appendChild(o),r.appendChild(i),r.appendChild(a),n.appendChild(r);const l=g("settingsPresets");l.style.cssText="display:flex; gap:calc(8 * var(--u)); flex-wrap:wrap;";const c=(b,x)=>{const y=ue(b,()=>{zn(x),i.value=String(s()),a.textContent=`${Math.round(s()*100)}%`,e()});return y.style.cssText="padding:calc(8 * var(--u)) calc(12 * var(--u)); border-radius:calc(12 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.16);background:rgba(255,255,255,.06); color:#fff; cursor:pointer;",y};l.appendChild(c("ì‘ê²Œ 90%",.9)),l.appendChild(c("ê¸°ë³¸ 100%",1)),l.appendChild(c("í¬ê²Œ 110%",1.1)),l.appendChild(c("ë” í¬ê²Œ 120%",1.2)),n.appendChild(l);const d=g("settingsResetRow");d.style.cssText="display:flex; justify-content:flex-end; margin-top:calc(6 * var(--u));";const p=ue("ìŠ¤ì¼€ì¼ ì´ˆê¸°í™”",()=>{zn(1),i.value=String(s()),a.textContent=`${Math.round(s()*100)}%`,e()});p.style.cssText="padding:calc(8 * var(--u)) calc(12 * var(--u)); border-radius:calc(12 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.16);background:rgba(255,255,255,.06); color:#fff; cursor:pointer;",d.appendChild(p),n.appendChild(d);const u=g("settingsRow");u.style.cssText="display:flex; align-items:center; gap:calc(12 * var(--u)); flex-wrap:wrap;";const k=ae("","ìŠ¬ë¡¯ ì¹´ë“œ í‘œì‹œ");k.style.cssText="font-weight:800;";const T=Ne.slotCardMode??"FULL",m=ue("ì „ì²´",()=>{Ne.slotCardMode="FULL",rr(),e()}),f=ue("ì´ë¦„ë§Œ",()=>{Ne.slotCardMode="NAME_ONLY",rr(),e()});return m.style.cssText=`padding:calc(8 * var(--u)) calc(12 * var(--u)); border-radius:calc(12 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.16);
    background:${T==="FULL"?"rgba(255,255,255,.16)":"rgba(255,255,255,.06)"}; color:#fff; cursor:pointer;`,f.style.cssText=`padding:calc(8 * var(--u)) calc(12 * var(--u)); border-radius:calc(12 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.16);
    background:${T==="NAME_ONLY"?"rgba(255,255,255,.16)":"rgba(255,255,255,.06)"}; color:#fff; cursor:pointer;`,u.appendChild(k),u.appendChild(m),u.appendChild(f),n.appendChild(u),n}function la(){const e=document.documentElement;e.style.setProperty("--uiScaleDesktop",String(Ne.uiScaleDesktop)),e.style.setProperty("--uiScaleMobile",String(Ne.uiScaleMobile)),e.style.setProperty("--animMul",String(xr()))}function lc(e,t){if(document.querySelector(".overlay-layer")?.remove(),!ce)return;const n=ce.kind==="SETTINGS",r=g("overlay-layer");r.style.cssText=n?"position:fixed; inset:0;background:rgba(0,0,0,1);display:flex; justify-content:center; align-items:flex-start;padding:calc(24 * var(--u)); box-sizing:border-box;":"position:fixed; inset:0;background:rgba(0,0,0,.55);display:flex; justify-content:center; align-items:center;",r.onclick=c=>{c.target===r&&t.onCloseOverlay()};const o=g("overlay-panel");o.style.cssText=n?"width:min(calc(860 * var(--u)), 96vw); max-height:calc(100vh - calc(48 * var(--u))); overflow:auto;padding:calc(16 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.12); border-radius:calc(16 * var(--u));background:rgba(15,18,22,1); box-shadow:0 calc(18 * var(--u)) calc(60 * var(--u)) rgba(0,0,0,.45);":"width:min(calc(980 * var(--u)), 92vw); max-height:80vh; overflow:auto; padding:calc(16 * var(--u));border:calc(1 * var(--u)) solid rgba(255,255,255,.12); border-radius:calc(16 * var(--u));background:rgba(15,18,22,.92); box-shadow:0 calc(18 * var(--u)) calc(60 * var(--u)) rgba(0,0,0,.45);",o.onclick=c=>c.stopPropagation();const s=ce.kind==="RULEBOOK"?"ë£°ë¶":ce.kind==="SETTINGS"?"ì„¤ì •":ce.pile==="deck"?"ë±":ce.pile==="discard"?"ë²„ë¦¼ ë”ë¯¸":ce.pile==="exhausted"?"ì†Œëª¨(ì´ë²ˆ ì „íˆ¬)":ce.pile==="vanished"?"ì†Œì‹¤(ì˜êµ¬)":"ì†íŒ¨",a=g("overlayHeader");a.style.cssText="display:flex; align-items:center; justify-content:space-between; gap:calc(12 * var(--u)); position:sticky; top:0; padding-bottom:calc(12 * var(--u)); margin-bottom:calc(12 * var(--u)); background:rgba(15,18,22,.92);";const i=Jn(s);i.classList.add("overlayTitle");const l=Ve("ë‹«ê¸°",t.onCloseOverlay,!1);if(l.classList.add("overlayClose"),l.style.cssText="padding:calc(8 * var(--u)) calc(12 * var(--u)); border-radius:calc(12 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.16); background:rgba(255,255,255,.06); color:#fff; cursor:pointer;",a.appendChild(i),a.appendChild(l),o.appendChild(a),ce.kind==="RULEBOOK"){const c=document.createElement("pre");c.className="rulebook",c.textContent=Qi,c.style.cssText="white-space:pre-wrap; line-height:1.45; font-size:calc(13 * var(--u)); margin:0; padding:calc(12 * var(--u)); border-radius:calc(12 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.10); background:rgba(0,0,0,.18);",o.appendChild(c)}else if(ce.kind==="SETTINGS")o.appendChild(ic(()=>{Me&&(_r(),Ar(),Nr()),B(Me??e,t)}));else{const d=[...ce.pile==="deck"?e.deck:ce.pile==="discard"?e.discard:ce.pile==="exhausted"?e.exhausted:ce.pile==="vanished"?e.vanished:e.hand].sort((y,N)=>{const W=e.cards[y],C=e.cards[N],O=kn(e,W.defId),$=kn(e,C.defId),w=O.localeCompare($,"ko");return w!==0?w:(W.upgrade??0)-(C.upgrade??0)}),p=g("pileView");p.style.cssText="display:grid;grid-template-columns: 1fr calc(320 * var(--u));gap:calc(16 * var(--u));align-items:start;";const u=g("pileGrid");u.style.cssText="display:grid;grid-template-columns: repeat(auto-fill, minmax(var(--handCardW), 1fr));gap:calc(10 * var(--u));align-content:start;min-width:0;max-height: 62vh;overflow-y: auto;overflow-x: hidden;";const k=g("pileSide");k.style.cssText="position:sticky; top:calc(72 * var(--u));align-self:start;border:calc(1 * var(--u)) solid rgba(255,255,255,.10);border-radius:calc(14 * var(--u));padding:calc(12 * var(--u));background:rgba(0,0,0,.22);";const T=g("pileSideTitle");T.style.cssText="font-weight:800; margin:0 0 calc(10 * var(--u)) 0; opacity:.95;",k.appendChild(T);const m=g("pilePreviewBox");m.style.cssText="display:flex; justify-content:center; align-items:flex-start;padding:calc(8 * var(--u)) 0 calc(10 * var(--u)) 0;",k.appendChild(m);const f=document.createElement("pre");f.className="pileSideDetail",f.style.cssText="margin:0;padding:calc(10 * var(--u));white-space:pre-wrap;border-radius:calc(12 * var(--u));border:calc(1 * var(--u)) solid rgba(255,255,255,.10);background:rgba(0,0,0,.20);font-size:calc(12 * var(--u));line-height:1.45;",k.appendChild(f);let b=d[0]??null;const x=()=>{if(m.innerHTML="",!b){T.textContent="ì„ íƒëœ ì¹´ë“œ ì—†ìŒ",f.textContent="";return}const y=Wt(e,b),N=ea(e,b);T.textContent=N;const W=Tt(e,b);m.appendChild(W),f.textContent=`ì „ì—´: ${y.frontText}
í›„ì—´: ${y.backText}`};if(d.length===0){const y=g("overlayEmpty");y.textContent="ë¹„ì–´ ìˆìŒ",y.style.cssText="padding:calc(12 * var(--u)); border-radius:calc(12 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.10); background:rgba(255,255,255,.03);",u.appendChild(y)}else for(const y of d){const N=Tt(e,y,C=>{b=C,x()});N.style.width="var(--handCardW)",N.style.height="var(--handCardH)",N.style.boxSizing="border-box",N.style.cursor="pointer";const W=()=>{b=y,u.querySelectorAll(".pileSelected").forEach(C=>C.classList.remove("pileSelected")),N.classList.add("pileSelected"),x()};N.onclick=W,N.onmouseenter=W,u.appendChild(N)}if(p.appendChild(u),p.appendChild(k),o.appendChild(p),b){const y=u.firstElementChild;y&&y.classList.add("pileSelected")}x()}r.appendChild(o),document.body.appendChild(r)}function Mt(e,t){const n=document.createElement(e);return t&&(n.className=t),n}function cc(e,t){document.querySelector(".itemTray")?.remove(),document.querySelector(".itemCapHud")?.remove();const n=e.run.items??[];if(!n||n.length===0)return;const r=e.enemies.length>0&&e.phase!=="NODE",o=document.createElement("div");o.className="itemTray",o.classList.add("noScrollbar");let s=null;const a=document.createElement("div");a.className="relicHoverTip itemHoverTip",o.appendChild(a);const i=kr(e),l=document.createElement("div");l.className="itemCapHud";const c=document.createElement("div");c.className="itemCapBadge",c.textContent=n.length+"/"+i;const d=document.createElement("div");d.className="itemCapHint",d.textContent="ìš°í´ë¦­/Ã—: ë²„ë¦¬ê¸°",l.appendChild(c),l.appendChild(d),document.body.appendChild(l);const p=()=>{const u=s;if(!u){a.classList.remove("show"),a.innerHTML="";return}const k=He(u);a.innerHTML="";const T=document.createElement("div");T.className="relicTipTitle",T.textContent=k?.name??u;const m=document.createElement("div");m.className="relicTipBody",m.textContent=k?.text??"",a.appendChild(T),a.appendChild(m),a.classList.add("show")};for(let u=0;u<n.length;u++){const k=String(n[u]),T=He(k),m=document.createElement("div");m.className="itemSlot",Zn(m,k);const f=document.createElement("img");f.alt=T?.name??k,T?.art&&(f.src=de(T.art)),m.appendChild(f);const b=document.createElement("button");b.type="button",b.className="itemDropBtn",b.title="",b.textContent="Ã—",b.onclick=y=>{y.preventDefault(),y.stopPropagation(),t.onDiscardItem(u)},m.appendChild(b),m.oncontextmenu=y=>{y.preventDefault(),y.stopPropagation(),t.onDiscardItem(u)};const x=!r||!!e.choice||!!ce||ye(e);x&&m.classList.add("disabled"),m.onclick=y=>{y.stopPropagation(),!x&&t.onUseItem(u)},m.onmouseenter=()=>{s=k,p()},m.onmouseleave=()=>{s=null,p()},o.appendChild(m)}document.body.appendChild(o);try{const u=parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--u"))||1,k=o.getBoundingClientRect();l.style.left=`${Math.round(k.left+6*u)}px`,l.style.top=`${Math.round(k.top-10*u)}px`}catch{}}function dc(e,t){const n=document.getElementById("relicTray");n&&n.remove();const r=e.run.relics??[];if(r.length===0)return;const o=Mt("div","relicTray");o.id="relicTray",o.classList.add("noScrollbar");const s=Mt("div","relicHoverTip");o.appendChild(s);const a=Mt("div","relicTrayList");a.classList.add("noScrollbar"),o.appendChild(a);const i=()=>{const l=De;if(!l){s.style.display="none",s.textContent="";return}if(!ke[l]){s.style.display="none",s.textContent="";return}const d=nn(e,l);s.style.display="block",s.innerHTML="";const p=Mt("div","relicTipTitle");p.textContent=d.name;const u=Mt("div","relicTipBody");u.textContent=d.text,s.appendChild(p),s.appendChild(u)};for(const l of r){const c=ke[l];if(!c)continue;const d=nn(e,l),p=document.createElement("button");if(p.type="button",p.className="relicIcon",c.art){const u=document.createElement("img");u.className="relicIconImg",u.alt=d.name,u.src=de(c.art),p.appendChild(u)}else p.textContent=d.name.slice(0,1);p.onmouseenter=()=>{De=l,i()},p.onmouseleave=()=>{De=null,i()},p.onclick=()=>{lt=l,B(e,t)},a.appendChild(p)}i(),document.body.appendChild(o)}function uc(e,t){const n="shopChoiceOpen";document.querySelector(".choice-overlay")?.remove();const r=e.choice,o=document.querySelector(".mainPanel");if(!r){o?.classList.remove("choiceOpen"),document.body.classList.remove(n);return}if(!o){document.body.classList.remove(n);return}o.classList.add("choiceOpen");const s=e.choiceCtx?.kind==="SHOP";document.body.classList.toggle(n,s);const i=20+70,l=36,c=16,d=16,p=s?12:18,u=10,k=s?220:260,T=s?170:200,m=14,f=12,b=10,x=12,y=220,N=22,W=14,C=g("choice-overlay");s&&C.classList.add("shopOverlay"),C.style.cssText="position:fixed; inset:0; z-index: var(--zChoice);display:flex; justify-content:center; align-items:flex-start;pointer-events:auto;";const O=g("choice-backdrop");O.style.cssText="position:absolute; inset:0;background: rgba(0,0,0,1);backdrop-filter: blur(calc(4 * var(--u)));-webkit-backdrop-filter: blur(calc(4 * var(--u)));pointer-events:auto;",O.onclick=()=>{};const $=g("choice-padWrap");$.style.cssText=`position:relative; width:100%;padding:calc(${i} * var(--u)) calc(${l} * var(--u)) calc(${c} * var(--u)) calc(${d} * var(--u));box-sizing:border-box;display:flex; justify-content:center; align-items:flex-start;pointer-events:auto;`;const w=g("choice-panel");w.style.cssText="position:relative;pointer-events:auto;",w.onclick=v=>v.stopPropagation();const E=Nl(r.title);if(E.style.cssText=`margin:0 0 calc(8 * var(--u)) 0; font-size:calc(${N} * var(--u)); font-weight:900;text-align:left;`,w.appendChild(E),r.prompt){const v=wr(r.prompt);v.style.cssText=`margin:0 0 calc(12 * var(--u)) 0; font-size:calc(${W} * var(--u)); line-height:1.25; opacity:.95;`,w.appendChild(v)}const R=e.choiceCtx,D=Array.isArray(r.options)?r.options:[],V=D.length===2&&D.some(v=>String(v?.text??v?.label??"").includes("ì „ì—´"))&&D.some(v=>String(v?.text??v?.label??"").includes("í›„ì—´")),ee=typeof R?.artPath=="string"?R.artPath:V?"assets/ui/choice/slot_pick.png":null;if(ee){const v=g("choice-art");v.style.cssText="margin:0 0 calc(12 * var(--u)) 0;border-radius:calc(14 * var(--u)); overflow:hidden;border:calc(1 * var(--u)) solid rgba(255,255,255,.14);background:rgba(255,255,255,.06);";const _=document.createElement("img");_.src=de(ee),_.alt="",_.style.cssText="display:block; width:100%; height:auto; max-height:calc(240 * var(--u)); object-fit:cover;",v.appendChild(_),w.appendChild(v)}if(r.kind==="FAITH"&&e.choiceCtx?.kind==="FAITH_START"){w.style.cssText+='width:min(100vw, calc(1800 * var(--u))); height:90vh;max-height:94vh; overflow:auto;padding:calc(18 * var(--u)) calc(18 * var(--u));border-radius:calc(18 * var(--u));border:calc(1 * var(--u)) solid rgba(255,255,255,.16);background:rgba(0,0,0,1);box-shadow: 0 calc(18 * var(--u)) calc(60 * var(--u)) rgba(0,0,0,1);font-family:"Mulmaru", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;';const _=pe(e).offered,M=g("faith-sub");if(M.style.cssText="margin:0 0 calc(16 * var(--u)) 0;font-size:calc(19 * var(--u)); opacity:.92; line-height:1.35;",M.textContent="ì„ íƒí•œ ì‹ ì€ ì‹ ì•™ 5ë¡œ ì‹œì‘í•©ë‹ˆë‹¤. ìœ í˜¹ ìˆ˜ë½ ì‹œ: ìœ í˜¹í•œ ì‹  +1 / í˜„ì¬ í¬ì»¤ìŠ¤ -1. í¬ì»¤ìŠ¤ ì ìˆ˜ â‰¥3ì´ë©´ í›„ì› íŒ¨ì‹œë¸Œê°€ í™œì„±í™”ë©ë‹ˆë‹¤.",w.appendChild(M),document.body.classList.contains("mobile")&&document.body.classList.contains("portrait")){const P=g("faith-list");P.style.cssText="display:flex; flex-direction:column; gap:calc(16 * var(--u));";const ne=S=>{const A=g("faith-godRow");A.style.cssText="display:flex; gap:calc(18 * var(--u)); align-items:stretch;min-height:calc(340 * var(--u));border-radius:calc(16 * var(--u));border:calc(1 * var(--u)) solid rgba(255,255,255,.14);background:#101010; overflow:hidden;";const j=g("faith-godArt");j.style.cssText="flex:0 0 clamp(calc(160 * var(--u)), 36vw, calc(260 * var(--u)));position:relative; overflow:hidden;border-right:calc(1 * var(--u)) solid rgba(255,255,255,.10);background:rgba(0,0,0,1);";const I=document.createElement("img");I.alt=Te(S),I.src=de(qn(S)),I.style.imageRendering="pixelated",I.style.cssText="position:absolute; inset:0; width:100%; height:100%; object-fit:cover; object-position:50% 35%;transform: scale(1.06); transform-origin: 50% 50%;image-rendering: pixelated; image-rendering: crisp-edges;",I.onerror=()=>{try{I.remove()}catch{}const oe=g("faith-imgPh");oe.textContent="(illustration)",oe.style.cssText="position:absolute; inset:0; display:flex; align-items:center; justify-content:center;opacity:.35; font-size:calc(18 * var(--u));",j.appendChild(oe)},j.appendChild(I),A.appendChild(j);const U=g("faith-godBody");U.style.cssText="flex:1 1 auto; min-width:0;display:flex; flex-direction:column; gap:calc(14 * var(--u));padding:calc(20 * var(--u));";const J=g("faith-godHead");J.style.cssText="display:flex; align-items:center; justify-content:space-between; gap:calc(10 * var(--u));";const te=g("faith-godName");te.textContent=Te(S),te.style.cssText="font-size:calc(34 * var(--u)); font-weight:900;",J.appendChild(te);const L=Ve("ì„ íƒ",()=>t.onChooseChoice(`faith:choose:${S}`),!1);L.style.cssText+="flex:0 0 auto;font-size:calc(22 * var(--u));padding:calc(14 * var(--u)) calc(16 * var(--u));border-radius:calc(12 * var(--u));",J.appendChild(L),U.appendChild(J);const G=document.createElement("pre");return G.textContent=sn(S),G.style.cssText='margin:0; padding:calc(14 * var(--u));white-space:pre-wrap; line-height:1.35;font-size:calc(20 * var(--u));border:calc(1 * var(--u)) solid rgba(255,255,255,.10);background:rgba(0,0,0,1);font-family:"Mulmaru", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;',U.appendChild(G),A.appendChild(U),A};for(const S of _)P.appendChild(ne(S));w.appendChild(P)}else{const P=g("faith-grid");P.style.cssText="display:grid; grid-template-columns:repeat(3, minmax(0, 1fr));gap:calc(14 * var(--u));";const ne=S=>{const A=g("faith-godCard");A.style.cssText="display:flex; flex-direction:column;border-radius:calc(16 * var(--u)); display:flex; align-items:center; justify-content:center;border:calc(1 * var(--u)) solid rgba(255,255,255,.14);background:#101010;overflow:hidden;min-height:calc(640 * var(--u));";const j=g("faith-imgWrap");j.style.cssText="width:70%; aspect-ratio: 1/1; height:auto;background:rgba(0,0,0,0);border-bottom:calc(1 * var(--u)) solid rgba(255,255,255,.10);position:relative; overflow:hidden;";const I=document.createElement("img");I.alt=Te(S),I.src=de(qn(S)),I.style.imageRendering="pixelated",I.style.cssText="position:absolute; inset:0; width:100%; height:100%; object-fit:cover; object-position:50% 35%;transform: scale(1.09); transform-origin: 50% 50%;image-rendering: pixelated; image-rendering: crisp-edges;",I.onerror=()=>{I.remove();const G=g("faith-imgPh");G.textContent="(illustration)",G.style.cssText="position:absolute; inset:0; display:flex; align-items:center; justify-content:center;opacity:.35; font-size:calc(14 * var(--u));",j.appendChild(G)},j.appendChild(I),A.appendChild(j);const U=g("faith-body");U.style.cssText="display:flex; flex-direction:column; gap:calc(10 * var(--u));padding:calc(12 * var(--u));";const J=document.createElement("div");J.textContent=Te(S),J.style.cssText="font-size:calc(20 * var(--u)); font-weight:900; letter-spacing: 0.3em;width:100%; text-align:center;",U.appendChild(J);const te=document.createElement("pre");te.textContent=sn(S),te.style.cssText='margin:0; padding:calc(10 * var(--u));white-space:pre-wrap; line-height:1.35;font-size:calc(13 * var(--u));border:calc(1 * var(--u)) solid rgba(255,255,255,.10);background:rgba(0,0,0,1);font-family:"Mulmaru", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;',U.appendChild(te);const L=Ve("ì„ íƒ",()=>t.onChooseChoice(`faith:choose:${S}`),!1);return L.style.cssText+="margin-top:auto; width:100%;font-size:calc(15 * var(--u));padding:calc(12 * var(--u)) calc(12 * var(--u));border-radius:calc(12 * var(--u));",U.appendChild(L),A.appendChild(U),A};for(const S of _)P.appendChild(ne(S));w.appendChild(P)}$.appendChild(w),C.appendChild(O),C.appendChild($),document.body.appendChild(C);return}const H=(v,_=1)=>{const M=_===1?"var(--handCardW)":`calc(var(--handCardW) * ${_})`,z=_===1?"var(--handCardH)":`calc(var(--handCardH) * ${_})`;v.style.width=M,v.style.height=z,v.style.boxSizing="border-box"},K=v=>{const _=document.createElement("pre");return _.className="choice-detail",_.textContent=String(v),_.style.cssText=`margin:calc(10 * var(--u)) 0 0 0; padding:calc(${b} * var(--u));white-space:pre-wrap;border-radius: 0; border:calc(1 * var(--u)) solid rgba(255,255,255,.10);background:rgba(0,0,0,.22);font-size:calc(${x} * var(--u)); line-height:1.45;max-height:calc(${y} * var(--u)); overflow:auto;`,_},Z=()=>{const v=g("choice-item");return v.style.cssText=`display:flex;gap:calc(12 * var(--u));align-items:flex-start;border:calc(1 * var(--u)) solid rgba(255,255,255,.10); border-radius:calc(${m} * var(--u));padding:calc(${f} * var(--u));background:rgba(255,255,255,.03);`,v};if(!r.options.some(v=>!!(v.cardUid||typeof v.key=="string"&&v.key.startsWith("pick:")||s&&typeof v.key=="string"&&v.key.startsWith("shop:card:")))){const v=g("choice-contentRow");v.style.cssText=`display:flex;gap:calc(${p} * var(--u)); margin-top:calc(12 * var(--u));justify-content:center; align-items:stretch;`;const _=g("choice-leftCol");_.style.cssText=`flex:1 1 calc(${s?560:640} * var(--u)); max-width:calc(${s?640:720} * var(--u)); min-width:0;display:flex; flex-direction:column;`;const M=g("choice-list");M.style.cssText=`display:flex; flex-direction:column; gap:calc(${u} * var(--u));`,r.options.forEach(S=>{const A=Z(),j=Ve(S.label,()=>t.onChooseChoice(S.key),!1);j.classList.add("choiceOptBtn"),j.style.fontSize="calc(14 * var(--u))",j.style.padding="calc(10 * var(--u)) calc(12 * var(--u))",j.style.borderRadius="calc(10 * var(--u))",A.appendChild(j),S.detail&&A.appendChild(K(S.detail)),M.appendChild(A)}),_.appendChild(M);const z=g("choice-illuCol");z.style.cssText=`flex:0 0 calc(${k} * var(--u)); min-width:calc(${T} * var(--u));display:flex; align-items:center; justify-content:center;`;const P=g("choice-illuBox");P.style.cssText="width:100%; aspect-ratio:1/1;border-radius:calc(18 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,1);background:rgba(0,0,0,1);position:relative; overflow:hidden;box-shadow: 0 calc(10 * var(--u)) calc(30 * var(--u)) rgba(0,0,0,.35);";const ne=r.art;if(ne){const S=document.createElement("img");S.src=de(ne),S.alt=r.title??"illustration";const A=1.5;S.style.imageRendering="pixelated",S.style.cssText=`position:absolute; inset:0;width:${A*100}%; height:${A*100}%;left:${-.5*50}%; top:${-.5*50}%;object-fit:cover; object-position:50% 50%;image-rendering: pixelated; image-rendering: crisp-edges;`,P.appendChild(S)}z.appendChild(P),v.appendChild(_),v.appendChild(z),w.appendChild(v),$.appendChild(w),C.appendChild(O),C.appendChild($),document.body.appendChild(C);return}if(s){w.classList.add("shopPanel"),w.style.overflow="hidden";const v=String(e.choiceCtx?.nodeId??""),_=e.run?.shops?.[v];if(_){const M=g("shopCardsGrid");for(let re=0;re<(_.cards?.length??0);re++){const Q=_.cards[re];if(!Q?.defId)continue;const le=g("shopCardTile");Q.sold&&le.classList.add("sold");const me=Ct(e,String(Q.defId),Number(Q.upgrade??0)||0);H(me,1),le.appendChild(me),Wn(le,e,String(Q.defId),Number(Q.upgrade??0)||0);const Oe=ae("shopTilePrice",Q.sold?"í’ˆì ˆ":`ğŸª™${Number(Q.priceGold??0)||0}`);le.appendChild(Oe),Q.sold||(le.onclick=()=>t.onChooseChoice(`shop:card:${re}`)),M.appendChild(le)}const z=g("shopBottomRow"),P=g("shopItemsCol"),ne=g("shopItemsGrid");for(let re=0;re<(_.items?.length??0);re++){const Q=_.items[re];if(!Q?.itemId)continue;const le=g("shopItemTile");Q.sold&&le.classList.add("sold"),Zn(le,String(Q.itemId));const me=He(String(Q.itemId)),Oe=document.createElement("img");Oe.alt=me?.name??String(Q.itemId),me?.art&&(Oe.src=de(me.art)),le.appendChild(Oe);const ge=ae("shopTilePrice",Q.sold?"í’ˆì ˆ":`ğŸª™${Number(Q.priceGold??0)||0}`);le.appendChild(ge),Q.sold||(le.onclick=()=>{Number(le.__itemHoverSuppressClickUntil??0)>performance.now()||t.onChooseChoice(`shop:item:${re}`)}),ne.appendChild(le)}P.appendChild(ne);const S=g("shopSvcCol"),A=g("shopSvcGrid"),j=(re,Q,le,me)=>{const Oe=g("shopSvcTile"),ge=Ve(Q,()=>t.onChooseChoice(re),me);ge.classList.add("primary"),Oe.appendChild(ge);const Gt=ae("shopSvcNote",le);return Oe.appendChild(Gt),Oe};A.appendChild(j("shop:service:upgrade",(_.usedUpgrade,"ê°•í™”"),_.usedUpgrade?"ì‚¬ìš© ì™„ë£Œ":"ğŸª™25",!!_.usedUpgrade)),A.appendChild(j("shop:service:remove",(_.usedRemove,"ì œê±°"),_.usedRemove?"ì‚¬ìš© ì™„ë£Œ":"ğŸª™25",!!_.usedRemove)),A.appendChild(j("shop:supply:buy","ë³´ê¸‰ êµ¬ë§¤","-ğŸª™6 / ğŸ+3",!1)),A.appendChild(j("shop:supply:sell","ë³´ê¸‰ íŒë§¤","+ğŸª™4 / ğŸ-3",!1)),S.appendChild(A),z.appendChild(P),z.appendChild(S);const I=r.options.find(re=>re.key==="shop:leave")?.label??"ë‚˜ê°€ê¸°",U=Ve(I,()=>t.onChooseChoice("shop:leave"),!1);U.classList.add("shopLeaveBtn"),U.style.cssText="position:absolute;top:calc(16 * var(--u)); right:calc(16 * var(--u));z-index: 2;border-radius:0;padding:calc(10 * var(--u)) calc(14 * var(--u));font-size:calc(13 * var(--u)); font-weight:900;",w.appendChild(U);const J=g("choice-contentRow");J.classList.add("shopContentRow");const te=g("choice-leftCol");te.classList.add("shopLeftCol"),te.appendChild(M),te.appendChild(z);const L=g("choice-illuCol");L.style.cssText=`flex:0 0 calc(${k} * var(--u)); min-width:calc(${T} * var(--u));display:flex; align-items:center; justify-content:center;`;const G=g("choice-illuBox");G.style.cssText="width:100%; aspect-ratio:1/1;border-radius:calc(18 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,1);background:rgba(0,0,0,1);position:relative; overflow:hidden;box-shadow: 0 calc(10 * var(--u)) calc(30 * var(--u)) rgba(0,0,0,.35);";const oe=r.art;if(oe){const re=document.createElement("img");re.src=de(oe),re.alt=r.title??"illustration";const Q=1.5;re.style.imageRendering="pixelated",re.style.cssText=`position:absolute; inset:0;width:${Q*100}%; height:${Q*100}%;left:${-.5*50}%; top:${-.5*50}%;object-fit:cover; object-position:50% 50%;image-rendering: pixelated; image-rendering: crisp-edges;`,G.appendChild(re)}L.appendChild(G),J.appendChild(te),J.appendChild(L),w.appendChild(J),$.appendChild(w),C.appendChild(O),C.appendChild($),document.body.appendChild(C);return}}else{const v=e.choiceCtx?.kind,_=!s&&(v==="BATTLE_CARD_REWARD"||v==="BATTLE_REWARD"),M=(P,ne,S)=>{const A=`__choice_preview:${P}:${ne}:${Math.random().toString(36).slice(2)}`,j=e.cards[A];e.cards[A]={uid:A,defId:P,upgrade:ne,zone:"preview"};const I=nt(e,A,!0,()=>S(),{draggable:!1});return I.classList.add("overlayCard","choicePickCard"),I.draggable=!1,I.style.cursor="pointer",j?e.cards[A]=j:delete e.cards[A],I};if(_){const P=r.options.filter(I=>typeof I.key=="string"&&I.key.startsWith("pick:")),ne=r.options.find(I=>I.key==="skip")??null,S=e.choiceCtx,A=S?.cardDecision;{const I=String(S?.itemOfferId??""),U=S?.itemDecision;if(I){const J=He(I),te=g("choice-rewardItemRow");te.style.cssText="display:flex; justify-content:center; align-items:flex-start;gap:calc(14 * var(--u)); margin-bottom:calc(16 * var(--u));";const L=g("itemOfferCard");L.style.cssText="width:calc(170 * var(--u)); aspect-ratio:3/4;border-radius: 0;border:calc(1 * var(--u)) solid rgba(255,255,255,.14);background:rgba(0,0,0,.35);box-shadow: 0 calc(10 * var(--u)) calc(30 * var(--u)) rgba(0,0,0,.35);display:flex; flex-direction:column; align-items:center; justify-content:flex-start;padding:calc(12 * var(--u)); gap:calc(10 * var(--u));cursor:pointer; user-select:none;",Zn(L,I),U?(L.style.opacity=".55",L.style.cursor="default"):L.onclick=()=>t.onChooseChoice("take_item");const G=ae("itemOfferTitle","ì•„ì´í…œ ë³´ìƒ");if(G.style.cssText="font-weight:900; font-size:calc(14 * var(--u)); opacity:.92;",J?.art){const me=document.createElement("img");me.src=de(J.art),me.alt=J.name,me.style.imageRendering="pixelated",me.style.cssText="width:calc(96 * var(--u)); height:calc(96 * var(--u));object-fit:contain;image-rendering: pixelated; image-rendering: crisp-edges;",L.appendChild(me)}const oe=ae("itemOfferName",J?.name??I);oe.style.cssText="font-weight:800; font-size:calc(14 * var(--u)); text-align:center;";const re=ae("itemOfferHint",U==="TAKEN"?"íšë“í•¨":U==="SKIPPED"?"ìƒëµí•¨":"í´ë¦­í•˜ë©´ ë°›ìŠµë‹ˆë‹¤");re.style.cssText="opacity:.75; font-size:calc(12 * var(--u)); text-align:center;";const Q=g("itemOfferWrap");Q.style.cssText="display:flex; flex-direction:column; align-items:center;",Q.appendChild(G),Q.appendChild(L);const le=ae("itemOfferDesc",J?.text??"");if(le.style.cssText="opacity:.85; font-size:calc(12 * var(--u)); text-align:center; white-space:pre-wrap; line-height:1.35;",le.style.maxHeight="calc(54 * var(--u))",le.style.overflow="hidden",le.style.textOverflow="ellipsis",L.appendChild(oe),L.appendChild(le),L.appendChild(re),te.appendChild(Q),!U){const me=Ve("ì•„ì´í…œ ìƒëµ",()=>t.onChooseChoice("skip_item"),!1);me.classList.add("ghost"),me.style.fontSize="calc(13 * var(--u))",me.style.padding="calc(10 * var(--u)) calc(14 * var(--u))",me.style.borderRadius="calc(10 * var(--u))",te.appendChild(me)}w.appendChild(te)}}const j=g("choice-rewardCardRow");j.style.cssText="display:flex; justify-content:center; align-items:flex-start;gap:calc(12 * var(--u)); flex-wrap:nowrap;";for(const I of P){const U=I.key.slice(5),[J,te]=U.split(":"),L=Number(te??"0")||0,G=!A,oe=M(J,L,()=>{G&&t.onChooseChoice(I.key)});Wn(oe,e,J,L),G||(oe.style.opacity=".55",oe.style.cursor="default"),H(oe,1),j.appendChild(oe)}if(w.appendChild(j),ne&&!A){const I=g("choice-rewardSkipRow");I.style.cssText="margin-top:calc(18 * var(--u)); display:flex; justify-content:center;";const U=Ve(ne.label||"ìƒëµ",()=>t.onChooseChoice("skip"),!1);U.classList.add("primary"),U.style.fontSize="calc(14 * var(--u))",U.style.padding="calc(10 * var(--u)) calc(16 * var(--u))",U.style.borderRadius="calc(10 * var(--u))",I.appendChild(U),w.appendChild(I)}$.appendChild(w),C.appendChild(O),C.appendChild($),document.body.appendChild(C);return}const z=g("choice-list");if(z.style.cssText=`display:flex; flex-direction:column;gap:calc(${u} * var(--u)); margin-top:calc(12 * var(--u));`,r.options.forEach(P=>{if(s&&(P.key==="shop:sep"||P.key.startsWith("shop:sep:"))){const U=g("choice-sep");U.style.cssText="height:calc(1 * var(--u));background:rgba(255,255,255,.12);margin:calc(6 * var(--u)) 0;",z.appendChild(U);return}const ne=Z(),S=g("choice-left");S.style.cssText="flex:0 0 auto;";const A=P.cardUid;if(A){const U=e.choice?.kind==="UPGRADE_PICK",te=(e.cards[A]?.upgrade??0)||0,L=te+1;if(U){const G=g("upgradePair");G.style.cssText="display:flex; gap:calc(10 * var(--u)); align-items:flex-start;";let oe,re;try{oe=ao(e,A,te)}catch{oe=Tt(e,A)}try{re=ao(e,A,L)}catch{re=Tt(e,A)}H(oe,1),H(re,1);const Q=ae("upgradeArrow","â†’");Q.style.cssText="align-self:center; font-weight:900; opacity:.85; margin-top:calc(6 * var(--u));",G.appendChild(oe),G.appendChild(Q),G.appendChild(re),S.appendChild(G)}else{let G;try{G=Tt(e,A)}catch{G=Tt(e,A)}H(G),S.appendChild(G)}}else if(typeof P.key=="string"&&P.key.startsWith("pick:")){const U=P.key.slice(5),[J,te]=U.split(":"),L=Number(te??"0")||0,G=Ct(e,J,L);H(G),S.appendChild(G),Wn(S,e,J,L)}else if(s&&typeof P.key=="string"&&P.key.startsWith("shop:card:")){const U=String(e.choiceCtx?.nodeId??""),J=e.run?.shops?.[U],te=Number(P.key.slice(10)),L=J?.cards?.[te];if(L?.defId){const G=Ct(e,String(L.defId),Number(L.upgrade??0)||0);H(G),L.sold&&(G.style.opacity=".35"),S.appendChild(G)}}else if(s&&typeof P.key=="string"&&P.key.startsWith("shop:item:")){const U=String(e.choiceCtx?.nodeId??""),J=e.run?.shops?.[U],te=Number(P.key.slice(10)),L=J?.items?.[te];if(L?.itemId){const G=He(String(L.itemId)),oe=g("shopItemCard");if(oe.style.cssText="width:calc(150 * var(--u)); aspect-ratio:3/4;border-radius: 0;border:calc(1 * var(--u)) solid rgba(255,255,255,.14);background:rgba(0,0,0,.30);box-shadow: 0 calc(10 * var(--u)) calc(30 * var(--u)) rgba(0,0,0,.25);display:flex; flex-direction:column; align-items:center; justify-content:flex-start;padding:calc(10 * var(--u)); gap:calc(8 * var(--u));user-select:none;"+(L.sold?"opacity:.35; cursor:default;":"cursor:pointer;"),L.sold||(oe.onclick=()=>t.onChooseChoice(P.key)),G?.art){const le=document.createElement("img");le.src=de(G.art),le.alt=G?.name??String(L.itemId),le.style.imageRendering="pixelated",le.style.cssText="width:calc(84 * var(--u)); height:calc(84 * var(--u));object-fit:contain;image-rendering: pixelated; image-rendering: crisp-edges;",oe.appendChild(le)}const re=ae("shopItemName",G?.name??String(L.itemId));re.style.cssText="font-weight:900; font-size:calc(13 * var(--u)); text-align:center;";const Q=ae("shopItemPrice",L.sold?"í’ˆì ˆ":`ğŸª™${Number(L.priceGold??0)||0}`);Q.style.cssText="opacity:.85; font-size:calc(12 * var(--u));",oe.appendChild(re),oe.appendChild(Q),S.appendChild(oe)}}const j=g("choice-right");j.style.cssText="flex:1 1 auto; min-width:calc(260 * var(--u));";const I=Ve(P.label,()=>t.onChooseChoice(P.key),!1);I.classList.add("primary"),I.style.fontSize="calc(14 * var(--u))",I.style.padding="calc(10 * var(--u)) calc(12 * var(--u))",I.style.borderRadius="calc(10 * var(--u))",j.appendChild(I),P.detail&&j.appendChild(K(P.detail)),ne.appendChild(S),ne.appendChild(j),z.appendChild(ne)}),s){const P=g("choice-contentRow");P.style.cssText=`display:flex;gap:calc(${p} * var(--u)); margin-top:calc(12 * var(--u));justify-content:center; align-items:stretch;`;const ne=g("choice-leftCol");ne.style.cssText="flex:1 1 calc(560 * var(--u)); max-width:calc(640 * var(--u)); min-width:0;display:flex; flex-direction:column;",ne.appendChild(z);const S=g("choice-illuCol");S.style.cssText=`flex:0 0 calc(${k} * var(--u)); min-width:calc(${T} * var(--u));display:flex; align-items:center; justify-content:center;`;const A=g("choice-illuBox");A.style.cssText="width:100%; aspect-ratio:1/1;border-radius:calc(18 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,1);background:rgba(0,0,0,1);position:relative; overflow:hidden;box-shadow: 0 calc(10 * var(--u)) calc(30 * var(--u)) rgba(0,0,0,.35);";const j=r.art;if(j){const I=document.createElement("img");I.src=de(j),I.alt=r.title??"illustration";const U=1.5;I.style.imageRendering="pixelated",I.style.cssText=`position:absolute; inset:0;width:${U*100}%; height:${U*100}%;left:${-.5*50}%; top:${-.5*50}%;object-fit:cover; object-position:50% 50%;image-rendering: pixelated; image-rendering: crisp-edges;`,A.appendChild(I)}S.appendChild(A),P.appendChild(ne),P.appendChild(S),w.appendChild(P)}else w.appendChild(z)}$.appendChild(w),C.appendChild(O),C.appendChild($),document.body.appendChild(C)}function pc(e,t){document.querySelectorAll(".topHud").forEach(y=>y.remove()),document.querySelectorAll(".enemyHudCenter").forEach(y=>y.remove());const n=document.body.classList.contains("mobile"),r=document.body.classList.contains("portrait"),o=n&&r,s=g("topHud");s.appendChild(g("topHudLeftSpacer"));const a=g("playerHudLeft"),i=g("playerTitleRow");if(i.appendChild(ae("playerHudTitle","í”Œë ˆì´ì–´")),!o){const y=g("pileButtons");y.appendChild(ue("ë±",()=>t.onViewPile("deck"))),y.appendChild(ue("ë²„ë¦¼",()=>t.onViewPile("discard"))),y.appendChild(ue("ì†íŒ¨",()=>t.onViewPile("hand"))),y.appendChild(ue("ì†Œëª¨",()=>t.onViewPile("exhausted"))),y.appendChild(ue("ì†Œì‹¤",()=>t.onViewPile("vanished"))),i.appendChild(y)}a.appendChild(i);const l=g("enemyChip");l.classList.add("playerHudBox");const c=g("enemyChipTop");c.appendChild(ae("","HP")),c.appendChild(ae("",`${e.player.hp}/${e.player.maxHp}`)),l.appendChild(c);const d=g("enemyHPOuter"),p=g("enemyHPFill");p.style.width=`${Math.max(0,Math.min(100,e.player.hp/Math.max(1,e.player.maxHp)*100))}%`,d.appendChild(p),l.appendChild(d);const u=g("enemyChipTop");u.appendChild(ae("","ë¸”ë¡")),u.appendChild(ae("",`${e.player.block}`)),l.appendChild(u);const k=g("enemyHPOuter"),T=g("enemyHPFill");T.style.background="#2a7cff",T.style.width=`${Math.max(0,Math.min(100,e.player.block/Math.max(1,e.player.maxHp)*100))}%`,k.appendChild(T),l.appendChild(k);const m=e.player.status,f=g("enemyBadges");l.appendChild(f);const b=[];(m.vuln??0)>0&&b.push(`ì·¨ì•½ ${m.vuln}`),(m.weak??0)>0&&b.push(`ì•½í™” ${m.weak}`),(m.bleed??0)>0&&b.push(`ì¶œí˜ˆ ${m.bleed}`),(m.disrupt??0)>0&&b.push(`êµë€ ${m.disrupt}`),(m.slash??0)>0&&b.push(`ì¹¼ë¶€ë¦¼ ${m.slash}`);for(const y of b)f.appendChild(er(y));if(a.appendChild(l),!e.run.finished&&e.enemies.length>0&&e.phase!=="NODE"){const y=g(o?"mobileEnemyStrip":"enemyHudCenter");y.dataset.enemyCount=String(e.enemies.length),e.enemies.length===2&&y.classList.add("enemyCount2"),e.enemies.length===3&&y.classList.add("enemyCount3");const N=g("enemyHudCenterMover"),W=g("enemyHud");W.style.cssText=`
      display: flex;
      flex-direction: row;
      flex-wrap: nowrap;
      justify-content: center;
      align-items: stretch;
      gap: calc(14 * var(--u));
      overflow: visible;
      white-space: nowrap;
    `,y.style.overflow="visible",N.style.overflow="visible",N.style.width="max-content";const C=ye(e);N.appendChild(W),y.appendChild(N),o?s.appendChild(y):document.body.appendChild(y);for(let O=0;O<e.enemies.length;O++){const $=e.enemies[O],w=g("enemyBanner enemyCardWrap");let E=!1;if(C&&$.hp>0&&(e.pendingTarget??null)?.kind==="damageSelect"&&$.id==="goblin_assassin"){const re=e.enemies.filter(Q=>Q.hp>0).indexOf($)+1;(re===2||re===3)&&(E=!0)}C&&$.hp>0&&!E&&w.classList.add("targetable"),E&&w.classList.add("untargetable");const R=()=>{const L=w.classList.contains("touchHover");document.querySelectorAll(".enemyBanner.touchHover").forEach(G=>G.classList.remove("touchHover")),L||w.classList.add("touchHover")};let D=!1;w.addEventListener("pointerdown",L=>{L.pointerType==="touch"&&(C||(R(),D=!0,L.preventDefault(),L.stopPropagation()))},{passive:!1}),w.addEventListener("pointerenter",L=>{L.pointerType!=="touch"&&w.classList.add("touchHover")}),w.addEventListener("pointerleave",L=>{L.pointerType!=="touch"&&w.classList.remove("touchHover")}),w.addEventListener("pointerup",L=>{if(L.pointerType==="touch"){if(C){t.onSelectEnemy(O);return}R(),D=!0,L.preventDefault(),L.stopPropagation()}},{passive:!1}),w.onclick=L=>{if(D){D=!1,L.preventDefault(),L.stopPropagation();return}if(C){t.onSelectEnemy(O);return}R(),L.preventDefault(),L.stopPropagation()};const V=g("enemyArtWrap"),ee=g("enemyArtCard");V.style.setProperty("--frameImg",`url("${de("assets/enemies/enemies_frame.png")}")`),V.style.setProperty("--artImg",`url("${Ll($.id)}")`),V.appendChild(ee);const H=g("enemyMiniHud"),K=e.content.enemiesById[$.id],Z=K.intents[$.intentIndex%K.intents.length],X=$.intentLabelOverride??Z.label,v=e.intentsRevealedThisTurn?Io(e,$,Z,{includeBlock:!1}):null,_=g("enemyIntentTopRow");let M="ï¼Ÿ",z="";e.intentsRevealedThisTurn&&v?(M=Hl(v),z=Bl(e,$,v)??""):(M="ï¼Ÿ",z=""),_.appendChild(ae("enemyIntentIcon",M)),_.appendChild(ae("enemyIntentDmg",z)),H.appendChild(_);const P=K.passives;if(P&&P.length){const L=g("enemyPassiveRow");for(const G of P.slice(0,4)){const oe=ae("enemyPassiveIcon",String(G.icon??"â“…"));L.appendChild(oe)}H.appendChild(L)}const ne=g("enemyHpLine");ne.appendChild(ae("enemyHpText",`HP ${$.hp}/${$.maxHp}`));const S=g("enemyHPOuter"),A=g("enemyHPFill");A.style.width=`${Math.max(0,Math.min(100,$.hp/Math.max(1,$.maxHp)*100))}%`,S.appendChild(A),ne.appendChild(S),H.appendChild(ne),H.appendChild(Ol($.status,$.immuneThisTurn));const j=g("enemyHoverDetail"),I=$.status,U=[];(I.vuln??0)>0&&U.push(`ì·¨ì•½ ${I.vuln}`),(I.weak??0)>0&&U.push(`ì•½í™” ${I.weak}`),(I.bleed??0)>0&&U.push(`ì¶œí˜ˆ ${I.bleed}`),(I.disrupt??0)>0&&U.push(`êµë€ ${I.disrupt}`),$.immuneThisTurn&&U.push("ë©´ì—­");const J=[],te=K.passives;if(te&&te.length)for(const L of te)J.push(`${String(L.icon??"â“…")} ${String(L.name??"íŒ¨ì‹œë¸Œ")}: ${String(L.text??"")}`);j.textContent=e.enemies[O].name+`

`+(J.length?`íŒ¨ì‹œë¸Œ:
${J.join(`
`)}

`:"")+`ì˜ë„: ${X}

`+(U.length?`ìƒíƒœ: ${U.join(", ")}`:"ìƒíƒœ: ì—†ìŒ"),w.appendChild(V),w.appendChild(H),w.appendChild(j),W.appendChild(w)}}if(s.appendChild(a),o){const y=g("mobileEnemyLeftBtn");y.appendChild(ue("ìƒˆ ëŸ°",()=>t.onNewRun())),s.appendChild(y);const N=g("mobileEnemyRightChrome");N.appendChild(ue("ë£°ë¶",()=>t.onViewRulebook())),N.appendChild(ue("ë¡œê·¸",()=>t.onToggleLogOverlay())),N.appendChild(ue("ì„¤ì •",()=>t.onViewSettings())),s.appendChild(N);const W=g("mobileActionPanel"),C=g("mobilePileButtons");C.appendChild(ue("ë±",()=>t.onViewPile("deck"))),C.appendChild(ue("ë²„ë¦¼",()=>t.onViewPile("discard"))),C.appendChild(ue("ì†íŒ¨",()=>t.onViewPile("hand"))),C.appendChild(ue("ì†Œëª¨",()=>t.onViewPile("exhausted"))),C.appendChild(ue("ì†Œì‹¤",()=>t.onViewPile("vanished"))),W.appendChild(C);const O=g("mobileRunButtons"),$=pe(e),w=$.offered?.[0],E=$.offered?.[1],R=$.offered?.[2],D=w?$.points[w]??0:0,V=E?$.points[E]??0:0,ee=R?$.points[R]??0:0,H=w&&E&&R?`ì‹ ì•™ ì ìˆ˜ ${D}Â·${V}Â·${ee}`:"ì‹ ì•™ ì ìˆ˜",K=ue(H,()=>{if(Nt().classList.contains("show")){mn();return}const v=K.getBoundingClientRect();fn(e,v.left+v.width/2,v.top+v.height/2)});K.addEventListener("pointerenter",X=>{const v=X;v.pointerType!=="touch"&&fn(e,v.clientX,v.clientY)}),K.addEventListener("pointermove",X=>{const v=X;v.pointerType!=="touch"&&pn(v.clientX,v.clientY)},{passive:!0}),K.addEventListener("pointerleave",X=>{X.pointerType!=="touch"&&mn()}),O.appendChild(K),W.appendChild(O);const Z=g("mobileHudRow");Z.appendChild(a),Z.appendChild(W),s.appendChild(Z)}return s}function fc(e,t){document.querySelector(".topHudRightChrome")?.remove();const n=g("topHudRight");n.classList.add("topHudRightChrome"),n.style.zIndex="var(--zDevConsole)",n.appendChild(ue("ë£°ë¶",()=>t.onViewRulebook())),n.appendChild(ue("ë¡œê·¸",()=>t.onToggleLogOverlay())),n.appendChild(ue("ì„¤ì •",()=>t.onViewSettings())),document.body.appendChild(n)}function mc(e){const t=Number(e.run.nextBattleSuppliesBonus??0)||0,n=Number(e.run.gold??0)||0,r=[];if(r.push(`ğŸª™ G ${n}`),t!==0){const o=t>0?`+${t}`:`${t}`;r.push(`ë‹¤ìŒ ì „íˆ¬ ğŸ ${o}`)}return r.join(" | ")}function hc(e){e.enemies.length>0&&e.phase;const t=e.run,n=Number(t.timeMove??0)||0,r=Number(e.time??0)||0,o=n+r,s=[];return s.push(`â³ ì´ ${o}`),s.push(`ğŸƒ ë± ${e.deck.length}`),s.push(`ğŸ’¤ F ${e.player.fatigue}`),s.join(" | ")}function jn(e,t=""){const n=document.createElement("span");return n.className="chip"+(t?` ${t}`:""),n.textContent=e,n}function ca(e){const t=g("battleTitleRow");t.style.display="flex",t.style.alignItems="center",t.style.gap="calc(12 * var(--u))";const n=document.createElement("h2");n.textContent="",t.appendChild(n);const r=yc(e),o=ae("targetHintInline","");o.style.cssText="padding:calc(8 * var(--u)) calc(12 * var(--u)); border-radius:calc(12 * var(--u)); border:calc(1 * var(--u)) solid rgba(0,0,0,.55);background: rgb(255, 0, 0);opacity:1;font-weight:700; font-size:calc(16 * var(--u)); line-height:1.25;white-space:nowrap; overflow:hidden; text-overflow:ellipsis;width: min(calc(320 * var(--u)), 92vw);max-width: none;pointer-events:auto;",r?(o.textContent=r,o.style.visibility="visible",o.style.pointerEvents="auto"):(o.textContent="ëŒ€ìƒ ì„ íƒ í•„ìš”",o.style.visibility="hidden",o.style.pointerEvents="none");const s=g("battleTitleRight");s.style.cssText="margin-left:auto;display:flex; align-items:center; gap:calc(10 * var(--u));flex: 0 0 auto;white-space:nowrap;position:relative;";const a=g("resourceRow inline");return a.appendChild(jn("")),a.appendChild(jn("")),a.appendChild(jn("")),s.appendChild(a),o.style.position="absolute",o.style.right="calc(207 * var(--u))",o.style.top="calc(100% - calc(34 * var(--u)))",o.style.marginTop="0",o.style.zIndex="5",o.style.pointerEvents=r?"auto":"none",t.appendChild(o),t.appendChild(s),t}function bc(e,t){const n=g("logHeaderRow");n.tabIndex=0;const r=document.createElement("h2");r.textContent="ë¡œê·¸";const o=document.createElement("span");return o.className="chev",o.textContent=e?"â–¸":"â–¾",n.appendChild(r),n.appendChild(o),n.onclick=()=>t(),n.onkeydown=s=>{(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),t())},n}function yc(e){if(!ye(e)||e.selectedEnemyIndex!=null)return null;const t=e.pendingTarget??null,n=t?.sourceCardUid?Le(e,t.sourceCardUid):null,r=t?.sourceLabel??null,o=t?.reason??null,s=n?`ëŒ€ìƒ ì„ íƒ (${n})`:r?`ëŒ€ìƒ ì„ íƒ (${r})`:"ëŒ€ìƒ ì„ íƒ í•„ìš”",a=o==="FRONT"?"ì „ì—´":o==="BACK"?"í›„ì—´":o==="EVENT"?"ì´ë²¤íŠ¸":o==="RELIC"?"ìœ ë¬¼":null,i=a?` - ${a}`:"",l=e.pendingTargetQueue?.length??0,c=(e.pendingTarget?1:0)+l,d=c>1?` (ë‚¨ì€ ${c}ê°œ)`:" (ë‚¨ì€ 1ê°œ)";return`${s}${i}${d}`}function kc(e,t,n){const r=g("combatRoot"),o=g("boardArea"),s=!t.run.finished&&t.enemies.length>0&&t.phase!=="NODE";o.classList.toggle("slabOn",s);const a=document.body.classList.contains("mobile")&&document.body.classList.contains("portrait");if(a&&o.appendChild(ca(t)),a&&t.phase==="NODE"){sa(o,t,n),r.appendChild(o),e.appendChild(r);return}const i=g("boardSlotsWrap");i.style.paddingTop="calc(6 * var(--u))",i.appendChild(lo(t,n,"front")),i.appendChild(lo(t,n,"back")),o.appendChild(i),r.appendChild(o),e.appendChild(r)}let or=null,da=!0;function io(e,t){or=e,da=t}function ua(e,t,n){return e.run.finished?{label:"ì¢…ë£Œ",fn:null,disabled:!0,activePhase:e.phase}:e.choice||ce?{label:"ì„ íƒ ì¤‘",fn:null,disabled:!0,activePhase:e.phase}:n?{label:"ëŒ€ìƒ ì„ íƒ",fn:null,disabled:!0,activePhase:e.phase}:e.phase==="NODE"?{label:"ë…¸ë“œ ì„ íƒ",fn:null,disabled:!0,activePhase:e.phase}:e.phase==="PLACE"?e.enemies.length>0&&!e.intentsRevealedThisTurn?{label:"ë‹¤ìŒ: ì •ì°°",fn:t.onRevealIntents,disabled:!1,activePhase:e.phase}:{label:"ë‹¤ìŒ: í›„ì—´",fn:t.onResolveBack,disabled:!1,activePhase:e.phase}:e.phase==="BACK"?{label:"ë‹¤ìŒ: í›„ì—´",fn:t.onResolveBack,disabled:!1,activePhase:e.phase}:e.phase==="FRONT"?{label:"ë‹¤ìŒ: ì „ì—´",fn:t.onResolveFront,disabled:!1,activePhase:e.phase}:e.phase==="ENEMY"?{label:"ë‹¤ìŒ: ì ",fn:t.onResolveEnemy,disabled:!1,activePhase:e.phase}:e.phase==="UPKEEP"?{label:"ë‹¤ìŒ: ì •ë¦¬",fn:t.onUpkeep,disabled:!1,activePhase:e.phase}:e.phase==="DRAW"?{label:"ë‹¤ìŒ í„´",fn:t.onDrawNextTurn,disabled:!1,activePhase:e.phase}:{label:"ë‹¤ìŒ",fn:null,disabled:!0,activePhase:e.phase}}function Tc(e,t,n){const r=document.querySelector(".handDock");r&&r.remove(),document.querySelectorAll(".mobileHandScrollBtn").forEach(m=>m.remove());const o=!e.run.finished&&e.enemies.length>0&&e.phase!=="NODE";document.querySelector(".combatControls")?.remove();const s=g("handDock"),a=ua(e,t,n);if(o){const m=g("combatControls"),f=document.createElement("button");f.textContent="ë‹¤ìŒ í„´",f.className="stepBtn primary",f.disabled=a.disabled||e.phase==="NODE",f.onclick=()=>t.onAutoAdvance(),m.appendChild(f),document.body.appendChild(m);const b=document.querySelector('.slot[data-slot-side="front"][data-slot-index="1"]')??document.querySelector(".stageInner");if(b){const x=b.getBoundingClientRect(),y=x.left+x.width/2;m.style.left=Pe(Math.round(y))}io(()=>t.onAutoAdvance(),f.disabled)}else io(null,!0);const i=g("hand");i.style.touchAction="pan-x",i.dataset.dropHand="1";const l=g("handCardsRow");if(i.appendChild(l),e.hand.length===0){const m=g("handEmptyHint");m.textContent="",l.appendChild(m)}else for(const m of e.hand)l.appendChild(nt(e,m,!0,t.onSelectHandCard,{draggable:!0,hoverPreview:{root:document.body,api:je,buildDetail:(f,b)=>{const x=Wt(f,b);return`ì „ì—´: ${x.frontText}
í›„ì—´: ${x.backText}`}}}));if(s.appendChild(i),document.body.appendChild(s),vc(i),!document.body.classList.contains("mobile"))return;const d=()=>{const m=i.querySelector(".card");if(m){const f=i.querySelector(".handCardsRow"),b=f&&parseFloat(getComputedStyle(f).columnGap||"0")||0;return Math.max(24,Math.round(m.getBoundingClientRect().width+b))}return Math.max(48,Math.round(i.clientWidth*.6))},p=m=>{const f=document.createElement("button");return f.type="button",f.className=`mobileHandScrollBtn mobileHandScrollBtn-${m}`,f.textContent=m==="left"?"â—€":"â–¶",f.onclick=b=>{b.preventDefault(),b.stopPropagation();const x=d(),y=m==="left"?-x:x;i.scrollBy({left:y,behavior:"smooth"}),window.setTimeout(T,120)},f},u=p("left"),k=p("right");document.body.appendChild(u),document.body.appendChild(k);const T=()=>{const m=Math.max(0,i.scrollWidth-i.clientWidth);if(m<=1){u.disabled=!0,k.disabled=!0;return}u.disabled=i.scrollLeft<=1,k.disabled=i.scrollLeft>=m-1};i.addEventListener("scroll",T,{passive:!0}),window.setTimeout(T,0)}function vc(e){e.dataset?.wheelX!=="1"&&(e.dataset.wheelX="1",e.addEventListener("wheel",t=>{if(document.body.classList.contains("handDragScrollLock")){t.preventDefault();return}if(t.shiftKey)return;const n=Math.abs(t.deltaX)>Math.abs(t.deltaY)?t.deltaX:t.deltaY;e.scrollLeft+=n,t.preventDefault()},{passive:!1}))}function pa(e){document.body.classList.toggle("handDragScrollLock",e);const t=document.querySelector(".hand");t&&(e?(t.style.overflowX="hidden",t.style.touchAction="none"):(t.style.overflowX="",t.style.touchAction=""))}function Nr(){if(document.body.classList.contains("mobile"))return;const e=document.querySelector(".enemyHudCenter");if(!e)return;const t=e.querySelector(".enemyHudCenterMover")??e,n=e.querySelector(".enemyHud")??e.querySelector(".enemyStrip")??t;e.style.position="fixed";const r=document.querySelector(".topHud");if(r&&Math.round(r.getBoundingClientRect().bottom+10),e.style.top="calc(8 * var(--u))",e.style.left="50%",e.style.right="auto",e.style.transform="translateX(-50%)",e.style.overflow="visible",t.style.transform="",t.style.overflow="visible",Array.from(e.querySelectorAll(".enemyBanner")).length===0){e.style.width="";return}const l=14;n.style.display="flex",n.style.flexWrap="nowrap",n.style.justifyContent="center",n.style.alignItems="stretch",n.style.gap=`calc(${l} * var(--u))`,e.style.width="auto",e.style.maxWidth="calc(100vw - calc(16 * var(--u)))",n.style.maxWidth="100%",n.style.overflowX="auto",t.style.width="100%"}function Ar(e){const t=document.querySelector(".hand"),n=document.querySelector(".handCardsRow");if(!t||!n)return;const r=document.querySelector('.slot[data-slot-side="front"][data-slot-index="1"]'),o=document.querySelector(".stageInner"),s=r?.getBoundingClientRect()??o?.getBoundingClientRect();if(!s)return;const a=s.left+s.width/2,i=Array.from(n.querySelectorAll(".card"));if(i.length===0)return;const l=i[0].getBoundingClientRect(),c=i[i.length-1].getBoundingClientRect(),d=l.left,p=c.right,u=(d+p)/2,k=a-u,T=n.scrollWidth,m=t.clientWidth;if(T<=m+1){const x=k/window.innerWidth*100;n.style.transform=`translateX(${x.toFixed(4)}vw)`,t.scrollLeft=0;return}let f=t.scrollLeft-k;const b=Math.max(0,T-m);f<0&&(f=0),f>b&&(f=b),t.scrollLeft=Math.round(f),n.style.transform=""}function fa(e,t){const n=getComputedStyle(document.documentElement),r=parseFloat(n.getPropertyValue("--handCardW"))||240,o=parseFloat(n.getPropertyValue("--handCardH"))||336,s=e.getBoundingClientRect();if(s.width<=0||s.height<=0)return;const a=6,i=Math.max(1,s.width-a*2),l=Math.max(1,s.height-a*2);let c=Math.min(i/r,l/o);c=Math.max(.8,Math.min(1,c)),t.style.setProperty("--slotCardScale",String(c))}function lo(e,t,n){const r=g("grid6"),o=!!e.selectedHandCardUid,s=n==="front"?e.frontSlots:e.backSlots,a=e.run,i=Number(n==="front"?a.slotCapFront:a.slotCapBack),l=Math.max(3,Math.min(4,Math.floor(Number.isFinite(i)?i:3)));for(let c=0;c<l;c++){const d=n==="back"?!!e.backSlotDisabled?.[c]:!1,p=g("slot"+(d?" disabled":""));p.dataset.slotSide=n,p.dataset.slotIndex=String(c),Fe&&Fe.side===n&&Fe.idx===c&&p.classList.add("dropHover"),o&&!d&&p.classList.add("placeable");const u=s[c];if(u){const k=Ne.slotCardMode==="NAME_ONLY"?"SLOT_NAME_ONLY":"FULL",T=nt(e,u,!1,void 0,{draggable:!1,mode:k,hoverPreview:{root:document.body,api:je,buildDetail:(f,b)=>{const x=Wt(f,b);return`ì „ì—´: ${x.frontText}
í›„ì—´: ${x.backText}`}}});T.classList.add("inSlot");const m=document.createElement("div");m.className="slotCardScaler",m.appendChild(T),p.appendChild(m),T.onpointerdown=f=>{f.button!==0&&f.pointerType==="mouse"||ye(e)||e.phase==="PLACE"&&ar(f,{kind:"slot",cardUid:u,fromSide:n,fromIdx:c})},T.ondblclick=()=>t.onReturnSlotToHand(n,c),requestAnimationFrame(()=>fa(p,m))}r.appendChild(p)}return r}function xc(){if(document.querySelectorAll(".slot.dropHover").forEach(n=>n.classList.remove("dropHover")),!Fe)return;const e=`.slot[data-slot-side="${Fe.side}"][data-slot-index="${Fe.idx}"]`,t=document.querySelector(e);t&&t.classList.add("dropHover")}let co=!1;function Cc(e,t){co||(co=!0,window.addEventListener("pointermove",n=>{const r=e();if(r.choice||ce||!F||n.pointerId!==F.pointerId)return;F.x=n.clientX,F.y=n.clientY;const o=F.x-F.startX,s=F.y-F.startY,a=F.dragging;!F.dragging&&o*o+s*s>36&&(F.dragging=!0),!a&&F.dragging&&(Sn(250),Vt()),Fe=F.dragging?uo(n.clientX,n.clientY,r):null,ma(document.querySelector("#app")),xc()},{passive:!0}),window.addEventListener("pointerup",n=>{n.pointerType==="mouse"&&ra()},{capture:!0,passive:!0}),window.addEventListener("pointerup",n=>{const r=e();if(!(!F||n.pointerId!==F.pointerId)){if(pa(!1),r.choice||ce){F?.sourceEl&&F.sourceEl.classList.remove("isDraggingSource"),F=null,Fe=null,B(r,t);return}if(F.dragging){const o=gc(n.clientX,n.clientY),s=uo(n.clientX,n.clientY,r);if(o&&F.kind==="slot"&&F.fromSide!=null&&F.fromIdx!=null){!r.run.finished&&!ye(r)&&r.phase==="PLACE"&&t.onReturnSlotToHand(F.fromSide,F.fromIdx),F=null,Fe=null,B(r,t);return}if(s)if(F.kind==="hand"){const a=e();if(!(a.run.finished||ye(a)||a.phase!=="PLACE")){const i=s.side,l=s.idx;if(!(i==="back"&&a.backSlotDisabled?.[l])){const c=i==="front"?a.frontSlots:a.backSlots,d=c[l];if(!d)t.onPlaceHandUidToSlot(F.cardUid,i,l);else{const p=F.fromHandIndex!=null&&F.fromHandIndex>=0?F.fromHandIndex:a.hand.indexOf(F.cardUid),u=a.hand.indexOf(F.cardUid);u>=0&&a.hand.splice(u,1),c[l]=F.cardUid,a.cards[F.cardUid].zone=i;const k=p!=null&&p>=0&&p<=a.hand.length?p:a.hand.length;a.hand.splice(k,0,d),a.cards[d].zone="hand",a.selectedHandCardUid=null,nr(a),h(a,`[${Le(a,F.cardUid)}] â†” [${Le(a,d)}] ìŠ¤ì™‘: ì†íŒ¨ â†” ${i}${l+1}`),B(a,t)}}}}else F.kind==="slot"&&F.fromSide!=null&&F.fromIdx!=null&&(F.fromSide===s.side&&F.fromIdx===s.idx||t.onMoveSlotCard(F.fromSide,F.fromIdx,s.side,s.idx))}F?.sourceEl&&F.sourceEl.classList.remove("isDraggingSource"),F=null,Fe=null,B(r,t)}}),window.addEventListener("keydown",n=>{const r=n.target;if(r&&(r.tagName==="INPUT"||r.tagName==="TEXTAREA"))return;const o=e();if(!Ni()){if(n.ctrlKey&&n.shiftKey&&n.code==="KeyK"){n.preventDefault(),Ai();return}if(n.code==="KeyP"){n.preventDefault(),t.onNewRun();return}if(n.code==="Digit4"){if(n.preventDefault(),ye(o)){o.pendingTarget=null,o.pendingTargetQueue=[],o.selectedEnemyIndex=null,h(o,"ëŒ€ìƒ ì„ íƒ ì·¨ì†Œ"),B(o,t);return}t.onClearSelected();return}if(n.key==="Tab"){if(n.preventDefault(),o.hand.length===0)return;const s=o.selectedHandCardUid,a=s?o.hand.indexOf(s):-1,i=n.shiftKey?-1:1,l=((a+i)%o.hand.length+o.hand.length)%o.hand.length;o.selectedHandCardUid=o.hand[l],B(o,t);return}if(n.code==="Space"){n.preventDefault();const s=e();if(s.run.finished||s.choice||ye(s))return;t.onAutoAdvance();return}if(n.code==="Digit1"||n.code==="Digit2"||n.code==="Digit3"){n.preventDefault();const s=n.code==="Digit1"?0:n.code==="Digit2"?1:2;if(ye(o)){const a=o.enemies[s];if(!a||a.hp<=0){h(o,`ëŒ€ìƒ ì„ íƒ ì‹¤íŒ¨: ${s+1}ë²ˆ ì ì´ ì—†ìŠµë‹ˆë‹¤.`),B(o,t);return}t.onSelectEnemy(s);return}t.onHotkeySlot("front",s);return}if(n.code==="KeyQ"||n.code==="KeyW"||n.code==="KeyE"){n.preventDefault();const s=n.code==="KeyQ"?0:n.code==="KeyW"?1:2;t.onHotkeySlot("back",s);return}if(n.code==="Enter"){n.preventDefault(),!da&&or&&or();return}}}))}function ar(e,t){Sn(250),Vt(),pa(!0);const n=e.currentTarget;try{n.setPointerCapture(e.pointerId)}catch{}const r=n.closest(".card");r&&r.classList.add("isDraggingSource");const o=r?.getBoundingClientRect(),s=o?e.clientX-o.left:20,a=o?e.clientY-o.top:20,i=getComputedStyle(document.documentElement),l=parseFloat(i.getPropertyValue("--handCardW"))||void 0,c=parseFloat(i.getPropertyValue("--handCardH"))||void 0,d=document.body.classList.contains("mobile");let p,u;const k=document.querySelector(".slot .slotCardInner")??document.querySelector(".slot > .card")??null;if(k){const T=k.getBoundingClientRect();T.width>0&&T.height>0&&(p=T.width,u=T.height)}if(F={kind:t.kind,cardUid:t.cardUid,fromHandIndex:t.fromHandIndex,fromSide:t.fromSide,fromIdx:t.fromIdx,pointerId:e.pointerId,startX:e.clientX,startY:e.clientY,x:e.clientX,y:e.clientY,dragging:!1,previewEl:void 0,previewW:d?o?.width??l??p:p??o?.width??l,previewH:d?o?.height??c??u:u??o?.height??c,grabDX:s,grabDY:a},r){F.sourceEl=r;const T=r.cloneNode(!0),m=getComputedStyle(r);T.classList.remove("inSlot"),T.classList.remove("selected"),T.classList.remove("isDraggingSource"),T.style.position="static",T.style.inset="",T.style.width="100%",T.style.height="100%",T.style.margin="0",T.style.boxSizing="border-box",T.style.opacity="1",T.style.filter="none",T.style.transform="none",T.style.backgroundColor="transparent";const f=m.getPropertyValue("--cardInnerMul").trim(),b=m.getPropertyValue("--slotTextScale").trim();f&&T.style.setProperty("--cardInnerMul",f),b&&T.style.setProperty("--slotTextScale",b),T.style.fontSize=m.fontSize,T.style.lineHeight=m.lineHeight,F.previewEl=T}}function gc(e,t){const n=document.elementFromPoint(e,t);if(!n)return!1;let r=n;for(;r;){if(r.dataset?.dropHand==="1")return!0;r=r.parentElement}return!1}function uo(e,t,n){const r=document.elementFromPoint(e,t);if(!r)return null;const o=wc(r,["slotSide","slotIndex"]);if(!o)return null;const s=o.dataset.slotSide,a=Number(o.dataset.slotIndex),i=n.run,l=Number(s==="front"?i.slotCapFront:i.slotCapBack),c=Math.max(3,Math.min(4,Math.floor(Number.isFinite(l)?l:3)));return a<0||a>=c||s==="back"&&n.backSlotDisabled?.[a]?null:{side:s,idx:a}}function wc(e,t){let n=e;for(;n;){const r=n.dataset;let o=!0;for(const s of t)if(r[s]==null){o=!1;break}if(o)return n;n=n.parentElement}return null}function ma(e,t){if(!F||!F.dragging){document.querySelector(".dragLayer")?.remove();return}let n=document.querySelector(".dragLayer");if(n||(n=document.createElement("div"),n.className="dragLayer",n.style.position="fixed",n.style.inset="0",n.style.zIndex="21000",n.style.pointerEvents="none",document.body.appendChild(n)),n.innerHTML="",!F.previewEl)return;const r=document.createElement("div");r.className="dragCardPreview",r.style.position="fixed";const o=(F.x-(F.grabDX??20))/window.innerWidth*100,s=(F.y-(F.grabDY??20))/window.innerHeight*100;r.style.left=`${o.toFixed(4)}vw`,r.style.top=`${s.toFixed(4)}vh`;const a=F.previewW??0,i=F.previewH??0;if(a>0){const l=a/window.innerWidth*100;r.style.width=`${l.toFixed(4)}vw`}if(i>0){const l=i/window.innerHeight*100;r.style.height=`${l.toFixed(4)}vh`}r.style.transform="none",r.style.opacity="1",r.style.filter="none",r.style.boxShadow="0 calc(16 * var(--u)) calc(44 * var(--u)) rgba(0,0,0,.65)",r.style.backdropFilter="none",r.style.isolation="isolate",r.style.mixBlendMode="normal",r.style.overflow="hidden",r.style.borderRadius="0",r.style.background="transparent",r.style.clipPath="inset(0)",r.appendChild(F.previewEl),n.appendChild(r)}const Ec=Ci();let gt=gl(Ec),Cn=ia(gt,ha);function ha(e){gt=e,Cn=ia(gt,ha),B(gt,Cn)}function _c(){let e="/deck-rogue-prototype/";e.endsWith("/")||(e+="/");const t=document.documentElement,n=(r,o)=>{t.style.setProperty(r,`url("${e}${o}")`)};n("--cardBgBasic","assets/ui/cards/card_basic.png"),n("--cardBgCommon","assets/ui/cards/card_common.png"),n("--cardBgSpecial","assets/ui/cards/card_special.png"),n("--cardBgRare","assets/ui/cards/card_rare.png"),n("--cardBgMadness","assets/ui/cards/card_madness.png")}function Sc(){let e="/deck-rogue-prototype/";e.endsWith("/")||(e+="/");const t=`
@font-face{
  font-family: "Mulmaru";
  src:
    url("${e}assets/fonts/Mulmaru.woff2") format("woff2"),
    url("${e}assets/fonts/Mulmaru.woff") format("woff");
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}
  `.trim();let n=document.getElementById("fontFaces");n||(n=document.createElement("style"),n.id="fontFaces",document.head.appendChild(n)),n.textContent=t}function Nc(){let e=0;const t=()=>{e=0;const r=document.querySelector(".handDock");if(!r)return;const o=document.documentElement,s=r.getBoundingClientRect();o.style.setProperty("--handDockTopPx",`${s.top}px`),o.style.setProperty("--handDockRightPx",`${s.right}px`),o.style.setProperty("--handDockBottomPx",`${s.bottom}px`),o.style.setProperty("--handDockLeftPx",`${s.left}px`)},n=()=>{e||(e=requestAnimationFrame(t))};window.addEventListener("deckrogue:layout",n,{passive:!0}),window.addEventListener("resize",n,{passive:!0}),window.visualViewport?.addEventListener("resize",n,{passive:!0}),window.visualViewport?.addEventListener("scroll",n,{passive:!0}),n()}function Ac(){let e=0,t=!1;const n=()=>{if(e=0,Sl()){t=!0,window.setTimeout(()=>{t&&r()},120);return}t=!1,B(gt,Cn)},r=()=>{e||(e=requestAnimationFrame(()=>requestAnimationFrame(n)))},o=()=>{window.dispatchEvent(new CustomEvent("deckrogue:uiFit"))};window.addEventListener("deckrogue:layout",r,{passive:!0}),window.addEventListener("resize",r,{passive:!0}),window.visualViewport?.addEventListener("resize",r,{passive:!0}),window.visualViewport?.addEventListener("scroll",r,{passive:!0}),document.addEventListener("visibilitychange",()=>{document.hidden||r()}),window.addEventListener("focus",()=>{o(),r()},{passive:!0}),new ResizeObserver(()=>r()).observe(document.documentElement),o(),r()}_c();Sc();ka();Ta();Nc();Ac();B(gt,Cn);document.documentElement.style.setProperty("--base","/deck-rogue-prototype/");const{vw:sr,vh:po}=(()=>{const e=window.visualViewport;return{vw:e?.width??window.innerWidth,vh:e?.height??window.innerHeight}})(),ba=ir(sr),$r=po>=sr*1.08?"portrait":sr>=po*1.08?"landscape":"square";document.body.classList.toggle("mobile",ba);document.body.classList.toggle("desktop",!ba);document.body.classList.toggle("portrait",$r==="portrait");document.body.classList.toggle("landscape",$r==="landscape");document.body.classList.toggle("square",$r==="square");
