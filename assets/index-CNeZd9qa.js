(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();function Hr(){const e=document.documentElement,t=180,n=5,r=7,o=3;let s=0;const a=()=>{s=0;const l=getComputedStyle(e),c=window.innerWidth,h=window.innerHeight,u=parseFloat(l.getPropertyValue("--hudH"))||140,d=parseFloat(l.getPropertyValue("--dockH"))||210,x=parseFloat(l.getPropertyValue("--uiGap"))||16,_=parseFloat(l.getPropertyValue("--edgePad"))||14,f=parseFloat(l.getPropertyValue("--logW"))||360,p=parseFloat(l.getPropertyValue("--logGap"))||14,b=parseFloat(l.getPropertyValue("--playerW"))||320,g=parseFloat(l.getPropertyValue("--slotGapXBase"))||22,m=parseFloat(l.getPropertyValue("--slotGapYBase"))||6,k=Math.max(320,c-(b+f+p*2+_*2)),M=Math.max(260,h-(u+d+x)),T=o*t+(o-1)*g,L=t*(r/n),R=parseFloat(l.getPropertyValue("--battleChromeHBase"))||140,E=L*2+m+R,$=k/T,N=M/E,C=Math.min($,N),I=Math.max(.55,Math.min(C,1.25));e.style.setProperty("--u",String(I))},i=()=>{s||(s=requestAnimationFrame(a))};window.addEventListener("resize",i,{passive:!0}),a()}function Or(){let e=!1;const t=()=>{const o=window.innerWidth;!e&&o<1180&&(e=!0),e&&o>1220&&(e=!1),document.body.classList.toggle("compact",e)};let n=0;const r=()=>{n||(n=requestAnimationFrame(()=>{n=0,t()}))};window.addEventListener("resize",r,{passive:!0}),t()}function Ze(e,t,n,r,o="SYSTEM"){let s=n;if(r&&o==="PLAYER"&&t==="bleed"){const a=Number(r._bleedBonusPerApply??0);a&&(s+=a)}if(r&&t==="vuln"&&s>0&&e===r.player){const a=r.run;(a?.relics??[]).includes("relic_ratskin_charm")&&a?.relicRuntime?.relic_ratskin_charm?.active!==!1&&(s=Math.max(0,s-1))}e.status[t]=Math.max(0,(e.status[t]??0)+s)}function on(e,t=0){return e<t?t:e}function sn(e){const t=[...e];for(let n=t.length-1;n>0;n--){const r=Math.floor(Math.random()*(n+1));[t[n],t[r]]=[t[r],t[n]]}return t}function re(e,t="pickOne"){if(e.length===0)throw new Error(`${t}: empty array`);return e[Math.floor(Math.random()*e.length)]}function y(e,t){e.log.unshift(t),e.log=e.log.slice(0,250)}function G(e){return e.enemies.filter(t=>t.hp>0)}function Dr(e){return Math.max(0,Math.min(1,e))}function Yn(e,t=0){const n=e.player?.fatigue??0,r=Dr(t+Math.max(0,n-5)*.12),o=n<=5?0:n<=8?1:n<=11?2:3;return{f:n,p:r,tier:o}}function wn(e,t){e.includes(t)||e.push(t)}function At(e,t,n){e[t]??=[],e[n]??=[],wn(e[t],n),wn(e[n],t)}function Br(e,t,n){return(e[t]??[]).includes(n)}function Sn(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}function Fr(e){return e[Math.floor(Math.random()*e.length)]}function Wr(e){const t=Math.floor((e+1)/2),r=Math.round((Math.max(4,e)-1)/3.2)+1,o=12,s=Math.min(t,32),a=Math.max(o,Math.min(s,r));return Math.max(3,Math.min(t,a))}function Ur(e){let n=Wr(e);for(;n>2&&1+2*(n-1)>e;)n-=1;const r=Math.floor((e+1)/2);for(;n<r&&1+4*(n-1)<e;)n+=1;const o=4,s=new Array(n).fill(2);s[0]=1;let a=e-(1+2*(n-1));for(;a>0;){const i=1+Math.floor(Math.random()*(n-1));s[i]>=o||(s[i]+=1,a-=1)}for(let i=0;i<24;i++){const l=1+Math.floor(Math.random()*(n-1)),c=1+Math.floor(Math.random()*(n-1));l!==c&&(s[l]<=2||s[c]>=o||Math.random()<.5&&(s[l]-=1,s[c]+=1))}return s}function Kr(e){const n=Math.max(18,Math.floor(8.64)),r=Math.max(2,Math.floor(72/15)),o={},s={},a=Ur(72),i=[];let l=0;for(let C=0;C<a.length;C++){const I=a[C],w=[];for(let S=0;S<I;S++){const O=`n${l++}`;w.push(O)}i.push(w)}for(;l<72;)i[i.length-1].length>=4&&i.push([]),i[i.length-1].push(`n${l++}`);for(let C=0;C<i.length;C++){const I=i[C];for(let w=0;w<I.length;w++){const S=I[w];o[S]={id:S,kind:C===0&&w===0?"START":"BATTLE",depth:C,order:w,visited:C===0&&w===0,cleared:C===0&&w===0,reprocCount:0,lastProcTime:-999},s[S]=[]}}const c=i.slice(0,-1).map(()=>[]),h=(C,I)=>{if(Br(s,C,I))return!1;const w=o[C]?.depth??0,S=o[I]?.depth??0;if(Math.abs(w-S)!==1)return!1;const O=Math.min(w,S),H=w<S?C:I,F=w<S?I:C,K=o[H]?.order??0,D=o[F]?.order??0;for(const[z,U]of c[O])if(K<z&&D>U||K>z&&D<U)return!1;return At(s,H,F),c[O].push([K,D]),!0};for(let C=0;C<i.length-1;C++){const I=i[C],w=i[C+1];for(let O=0;O<w.length;O++){const H=Math.floor(O*I.length/w.length),F=(Math.random()<.5?-1:1)*(Math.random()<.35?1:0),K=Math.max(0,Math.min(I.length-1,H+F));h(I[K],w[O])}const S=.35;for(let O=0;O<I.length;O++){if(Math.random()>S)continue;const H=Math.floor(O*w.length/I.length),F=(Math.random()<.5?-1:1)*(Math.random()<.35?1:0),K=Math.max(0,Math.min(w.length-1,H+F));h(I[O],w[K])}}i.length>=2&&i[1].length>=2&&h(i[0][0],i[1][i[1].length-1]);const u=Math.max(0,Math.min(n,144));let d=0,x=0;for(;d<u&&x++<8e3;){const C=Math.floor(Math.random()*(i.length-1)),I=i[C],w=i[C+1],S=I[Math.floor(Math.random()*I.length)],O=w[Math.floor(Math.random()*w.length)];h(S,O)&&(d+=1)}const _=.25;for(let C=0;C<i.length;C++){const I=i[C];if(I.length<2)continue;const w=Math.floor(Math.random()*(I.length-1));At(s,I[w],I[w+1]);for(let S=0;S<I.length-1;S++)S!==w&&Math.random()<_&&At(s,I[S],I[S+1])}const f={nodes:o,edges:s,startId:i[0][0],pos:i[0][0],treasureId:null,visionNonce:0},p=[],b=Math.max(2,Math.floor(i.length*.85)),g=Math.max(b,Math.floor(i.length*1)-1);for(let C=b;C<=g&&C<i.length;C++)for(const I of i[C])p.push(I);const m=p.length?Fr(p):"n71";f.treasureId=m,o[m].kind="TREASURE";const k=Object.keys(o).filter(C=>C!==f.startId&&C!==m);Sn(k);const M=k.filter(C=>(o[C]?.depth??0)>=2);Sn(M);const T=new Set(M.slice(0,Math.min(r,M.length))),L=4,R={battleMul:.25,eventMul:1.35,restMul:1.55},E=C=>s[C]?.length??0,$=new Set(Object.keys(o).filter(C=>C===f.startId||(o[C]?.depth??0)<L?!1:E(C)===1)),N=(C,I)=>{let w=.5,S=.25,O=.25;C<=1?(w=.72,S=.14,O=.14):C<=3&&(w=.6,S=.2,O=.2),I&&(w*=R.battleMul??.25,S*=R.eventMul??1.35,O*=R.restMul??1.55);const H=w+S+O,F=Math.random()*H;return F<w?"BATTLE":F<w+S?"EVENT":"REST"};for(const C of k){if(T.has(C)){o[C].kind="ELITE";continue}const I=o[C]?.depth??0;o[C].kind=N(I,$.has(C))}return f}function zr(e){return e.uidSeq+=1,String(e.uidSeq)}function jr(){return{relicRuntime:{},pendingRelicActivations:[],unlock:{rest:0,eliteWins:0,tookBigHit10:!1,kills:0,endedTurnWeak:!1,eventPicks:0,hpLeq15:!1,skippedTurn:!1,bleedApplied:0},timeMove:0,map:Kr(),pursuit:{heat:0},vision:{mode:"NORMAL",blind:!1,presenceR:2,typeR:2,detailR:0,noise:0},encounterCount:0,treasureObtained:!1,afterTreasureNodePicks:0,nodeOfferQueue:[],finished:!1,nodePickCount:0,nodePickByType:{BATTLE:0,ELITE:0,REST:0,EVENT:0,TREASURE:0},currentNodeOffers:null,nextBattleSuppliesBonus:0,bossPool:["boss_gravity_master","boss_cursed_wall","boss_giant_orc","boss_soul_stealer"],branchOffer:null,battleCount:0,enemyLastSeenBattle:{},nextBossId:null,nextBossTime:40,forcedNext:null,bossOmenText:null,deckSizeAtTreasure:null,ominousProphecySeen:!1,relics:[],lastBattleWasElite:!1,eliteRelicOfferedThisBattle:!1,pendingElite:!1}}function Kt(e){const t={uidSeq:0,combatTurn:0,intentsRevealedThisTurn:!1,disruptIndexThisTurn:null,attackedEnemyIndicesThisTurn:[],phase:"NODE",log:[],run:jr(),player:{hp:60,maxHp:60,block:0,supplies:7,fatigue:0,zeroSupplyTurns:0,status:{vuln:0,weak:0,bleed:0,disrupt:0},immuneToDisruptThisTurn:!1,nullifyDamageThisTurn:!1},content:e,cards:{},deck:[],hand:[],discard:[],exhausted:[],vanished:[],frontSlots:[null,null,null],backSlots:[null,null,null],backSlotDisabled:[!1,!1,!1],enemies:[],usedThisTurn:0,frontPlacedThisTurn:0,selectedHandCardUid:null,winHooksAppliedThisCombat:!1,drawCountThisTurn:0,pendingTarget:null,pendingTargetQueue:[],backUidsThisTurn:[],victoryResolvedThisCombat:!1,time:0,choice:null,choiceQueue:[],choiceStack:[],choiceCtx:null,selectedEnemyIndex:null,_justStartedCombat:!1};return qr(t),y(t,"ÏÉà Îü∞ ÏãúÏûë."),t}function Ie(e,t,n){for(let r=0;r<n;r++){const o=zr(e),s={uid:o,defId:t,zone:"deck",upgrade:0};e.cards[o]=s,e.deck.push(o)}}function qr(e){Ie(e,"field_ration",2),Ie(e,"maintenance",2),Ie(e,"scout",2),Ie(e,"shield",2),Ie(e,"power_arrow",1),Ie(e,"arrow",3),e.deck=sn(e.deck)}function ge(e,t){const n=e.cards[t],r=e.content.cardsById[n.defId],o=n.upgrade??0,s=r.upgrades?.[o-1];return s?{...r,...s}:r}function he(e,t,n){const r=e.cardsById[t],o=Math.max(0,n|0);if(o<=0)return r;const s=r.upgrades?.[o-1];return s?{...r,...s}:r}function De(e,t){const r=e.cards[t].upgrade??0,o=ge(e,t);return r>0?`${o.name} +${r}`:o.name}const Vr=[{id:"field_ration",name:"ÏïºÏ†Ñ ÏãùÎüâ",frontText:"Î∞©Ïñ¥ +3",backText:"S +2",front:[{op:"block",n:3}],back:[{op:"supplies",n:2}],upgrades:[{frontText:"Î∞©Ïñ¥ +5",front:[{op:"block",n:5}],backText:"S +3",back:[{op:"supplies",n:3}]}]},{id:"maintenance",name:"Ï†ïÎπÑ ÎèÑÍµ¨",exhaustWhen:"BACK",frontText:"Î∞©Ïñ¥ +3",backText:"F -1, ÏÜåÎ™®",front:[{op:"block",n:3}],back:[{op:"fatigue",n:-1}],upgrades:[{frontText:"Î∞©Ïñ¥ +5",front:[{op:"block",n:5}],backText:"F -1, S +2, ÏÜåÎ™®",back:[{op:"fatigue",n:-1},{op:"supplies",n:2}]}]},{id:"scout",name:"Ï†ïÏ∞∞",frontText:"ÏßÄÏ†ï ÌîºÌï¥ 3, Î∞©Ïñ¥ +1",backText:"ÎìúÎ°úÏö∞ 1, S +2",front:[{op:"damageEnemy",target:"select",n:3},{op:"block",n:1}],back:[{op:"draw",n:1},{op:"supplies",n:2}],upgrades:[{frontText:"ÏßÄÏ†ï ÌîºÌï¥ 4, Î∞©Ïñ¥ +2",front:[{op:"damageEnemy",target:"select",n:4},{op:"block",n:2}],backText:"ÎìúÎ°úÏö∞ 2, S +3",back:[{op:"draw",n:2},{op:"supplies",n:3}]}]},{id:"shield",name:"Î∞©Ìå®",frontText:"Î∞©Ïñ¥ +5",backText:"Î∞©Ïñ¥ +3",front:[{op:"block",n:5}],back:[{op:"block",n:3}],upgrades:[{frontText:"Î∞©Ïñ¥ +7",front:[{op:"block",n:7}],backText:"Î∞©Ïñ¥ +4",back:[{op:"block",n:4}]}]},{id:"power_arrow",name:"Í∞ïÎ†•Ìïú ÌôîÏÇ¥",frontText:"Î¨¥ÏûëÏúÑ ÌîºÌï¥ 10, S -2",backText:"Î¨¥ÏûëÏúÑ ÌîºÌï¥ 7, S -2",front:[{op:"supplies",n:-2},{op:"damageEnemy",target:"random",n:10}],back:[{op:"supplies",n:-2},{op:"damageEnemy",target:"random",n:7}],upgrades:[{frontText:"Î¨¥ÏûëÏúÑ ÌîºÌï¥ 13, S -2",front:[{op:"supplies",n:-2},{op:"damageEnemy",target:"random",n:13}],backText:"Î¨¥ÏûëÏúÑ ÌîºÌï¥ 10, S -2",back:[{op:"supplies",n:-2},{op:"damageEnemy",target:"random",n:10}]}]},{id:"arrow",name:"ÌôîÏÇ¥",frontText:"ÏßÄÏ†ï ÌîºÌï¥ 5",backText:"ÏßÄÏ†ï ÌîºÌï¥ 5, S -1",front:[{op:"damageEnemy",target:"select",n:5}],back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:5}],upgrades:[{frontText:"ÏßÄÏ†ï ÌîºÌï¥ 7",front:[{op:"damageEnemy",target:"select",n:7}],backText:"ÏßÄÏ†ï ÌîºÌï¥ 7, S -1",back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:7}]}]},{id:"goal_treasure",name:"Ï†ÄÏ£ºÎ∞õÏùÄ Î≥¥Î¨º",exhaustWhen:"BOTH",frontText:"F +1, ÏÜåÎ™®",backText:"S -1, F +1, ÏÜåÎ™®",front:[{op:"fatigue",n:1}],back:[{op:"supplies",n:-1},{op:"fatigue",n:1}]},{id:"berserk",name:"Í¥ëÌè≠Ìôî",frontText:"Î¨¥ÏûëÏúÑ ÌîºÌï¥ 15, S -3",backText:"S +4, F +1",front:[{op:"damageEnemy",target:"random",n:15},{op:"supplies",n:-3}],back:[{op:"supplies",n:4},{op:"fatigue",n:1}],upgrades:[{frontText:"Î¨¥ÏûëÏúÑ ÌîºÌï¥ 20, S -4",front:[{op:"damageEnemy",target:"random",n:20},{op:"supplies",n:-4}],backText:"S +6, F +2",back:[{op:"supplies",n:6},{op:"fatigue",n:2}]}]},{id:"bandage",name:"Î∂ïÎåÄ",exhaustWhen:"BOTH",frontText:"HP +4, ÏÜåÎ™®",backText:"HP +4, S -1, ÏÜåÎ™®",front:[{op:"heal",n:4}],back:[{op:"supplies",n:-1},{op:"heal",n:4}],upgrades:[{frontText:"HP +4, Ï∂úÌòà Ï†úÍ±∞, ÏÜåÎ™®",front:[{op:"heal",n:4},{op:"clearStatusSelf",key:"bleed"}],backText:"HP +4, Ï∂úÌòà Ï†úÍ±∞, S -1, ÏÜåÎ™®",back:[{op:"supplies",n:-1},{op:"heal",n:4},{op:"clearStatusSelf",key:"bleed"}]}]},{id:"arrow_rain",name:"ÌôîÏÇ¥Ïùò ÎπÑ",exhaustWhen:"BOTH",frontText:"Ï†ÑÏ≤¥ ÌîºÌï¥ 10, S -2 ÏÜåÎ™®",backText:"ÎìúÎ°úÏö∞ 2, S +2, F +1, ÏÜåÎ™®",front:[{op:"damageEnemy",target:"all",n:10},{op:"supplies",n:-2}],back:[{op:"draw",n:2},{op:"supplies",n:2},{op:"fatigue",n:1}],upgrades:[{frontText:"Ï†ÑÏ≤¥ ÌîºÌï¥ 13, S -2, ÏÜåÎ™®",front:[{op:"damageEnemy",target:"all",n:13},{op:"supplies",n:-2}],backText:"ÎìúÎ°úÏö∞ 3, S +3, F +2, ÏÜåÎ™®",back:[{op:"draw",n:3},{op:"supplies",n:3},{op:"fatigue",n:2}]}]},{id:"smoke",name:"Ïó∞Îßâ",vanishWhen:"FRONT",frontText:"Ïù¥Î≤à ÌÑ¥ Ï†Å Í≥µÍ≤© ÌîºÌï¥ Î¨¥Ìö®, ÏÜåÏã§",backText:"F +1",front:[{op:"nullifyDamageThisTurn"}],back:[{op:"fatigue",n:1}]},{id:"redeploy",name:"Ïû¨Î∞∞Ïπò",frontText:"S +2",backText:"3Î≤à Ïä¨Î°ØÏóê ÏûàÎäî ÌõÑÏó¥ Ïπ¥ÎìúÏùò Ï†ÑÏó¥ Ìö®Í≥º Î∞úÎèô",front:[{op:"supplies",n:2}],back:[{op:"triggerFrontOfBackSlot",index:2}],upgrades:[{frontText:"S +3",front:[{op:"supplies",n:3}],backText:"3Î≤à Ïä¨Î°ØÏóê ÏûàÎäî ÌõÑÏó¥ Ïπ¥ÎìúÏùò Ï†ÑÏó¥ Ìö®Í≥º Î∞úÎèô, S +1",back:[{op:"triggerFrontOfBackSlot",index:2},{op:"supplies",n:1}]}]},{id:"secret_strike",name:"ÎπÑÏû•Ïùò ÏùºÍ≤©",exhaustWhen:"BOTH",frontText:"Î¨¥ÏûëÏúÑ ÌîºÌï¥ (FÏùò 2Î∞∞), ÏÜåÎ™®",backText:"Ï†ÑÏ≤¥ Ï∑®ÏïΩ +3 Î∞è ÏïΩÌôî +3, ÏÜåÎ™®",front:[{op:"damageEnemyByPlayerFatigue",target:"random",mult:2}],back:[{op:"statusEnemy",target:"all",key:"vuln",n:3},{op:"statusEnemy",target:"all",key:"weak",n:3}],upgrades:[{exhaustWhen:"FRONT",frontText:"ÏßÄÏ†ï ÌîºÌï¥ (FÏùò 2Î∞∞), ÏÜåÎ™®",front:[{op:"damageEnemyByPlayerFatigue",target:"select",mult:2}],backText:"Ï†ÑÏ≤¥ Ï∑®ÏïΩ +4 Î∞è ÏïΩÌôî +4",back:[{op:"statusEnemy",target:"all",key:"vuln",n:4},{op:"statusEnemy",target:"all",key:"weak",n:4}]}]},{id:"fire_scroll",name:"ÌôîÏóº ÎëêÎ£®ÎßàÎ¶¨",exhaustWhen:"FRONT",vanishWhen:"BACK",frontText:"Ï†ÑÏ≤¥ ÌîºÌï¥ 6, ÏÜåÎ™®",backText:"Ï†ÑÏ≤¥ ÌîºÌï¥ 12, ÏÜåÏã§",front:[{op:"damageEnemy",target:"all",n:6}],back:[{op:"damageEnemy",target:"all",n:12}],upgrades:[{frontText:"Ï†ÑÏ≤¥ ÌîºÌï¥ 8, ÏÜåÎ™®",front:[{op:"damageEnemy",target:"all",n:8}],backText:"Ï†ÑÏ≤¥ ÌîºÌï¥ 15, ÏÜåÏã§",back:[{op:"damageEnemy",target:"all",n:15}]}]},{id:"caltrops",name:"ÎßàÎ¶ÑÏá†",frontText:"Ï†ÑÏ≤¥ Ï∂úÌòà 4 Î∂ÄÏó¨",backText:"Ïù¥Î≤à ÌÑ¥Ïóê ÏûêÏã†ÏùÑ Í≥µÍ≤©ÌïòÎ†§Îäî Ï†ÅÏóêÍ≤å Ï∂úÌòà 3 Î∂ÄÏó¨",front:[{op:"statusEnemy",target:"all",key:"bleed",n:4}],back:[{op:"statusEnemiesAttackingThisTurn",key:"bleed",n:3}],upgrades:[{frontText:"Ï†ÑÏ≤¥ Ï∂úÌòà 5 Î∂ÄÏó¨",backText:"Ïù¥Î≤à ÌÑ¥Ïóê ÏûêÏã†ÏùÑ Í≥µÍ≤©ÌïòÎ†§Îäî Ï†ÅÏóêÍ≤å Ï∂úÌòà 4 Î∂ÄÏó¨",front:[{op:"statusEnemy",target:"all",key:"bleed",n:5}],back:[{op:"statusEnemiesAttackingThisTurn",key:"bleed",n:4}]}]},{id:"emergency_rations",name:"ÎπÑÏÉÅÏãùÎüâ",vanishWhen:"BACK",frontText:"S +2",backText:"SÎ•º 7Î°ú ÎßåÎì¶. ÏÜåÏã§",front:[{op:"supplies",n:2}],back:[{op:"setSupplies",n:7}],upgrades:[{frontText:"S +3",backText:"SÎ•º 10ÏúºÎ°ú ÎßåÎì¶. ÏÜåÏã§",front:[{op:"supplies",n:3}],back:[{op:"setSupplies",n:10}]}]},{id:"painkiller",name:"ÏßÑÌÜµÏ†ú",exhaustWhen:"FRONT",vanishWhen:"BACK",frontText:"HP -8, F -3, ÏÜåÎ™®",backText:"HP +8, F +1, ÏÜåÏã§",front:[{op:"hp",n:-8},{op:"fatigue",n:-3}],back:[{op:"hp",n:8},{op:"fatigue",n:1}],upgrades:[{frontText:"HP -6, F -3, ÏÜåÎ™®",backText:"HP +10, F +1, ÏÜåÏã§",front:[{op:"hp",n:-6},{op:"fatigue",n:-3}],back:[{op:"hp",n:10},{op:"fatigue",n:1}]}]},{id:"field_experience",name:"Ïã§Ï†Ñ Í≤ΩÌóò",exhaustWhen:"BACK",frontText:"Ï†ÑÏ≤¥ ÌîºÌï¥ 3",backText:"Ïù¥ Ïπ¥ÎìúÍ∞Ä ÌõÑÏó¥Ïóê ÏûàÎäî ÌÑ¥Ïóê ÏäπÎ¶¨ÌïòÎ©¥ ÏµúÎåÄ Ï≤¥Î†• +2, ÏÜåÎ™®",front:[{op:"damageEnemy",target:"all",n:3}],back:[],onWinWhileInBack:[{op:"maxHp",n:2}],upgrades:[{frontText:"Ï†ÑÏ≤¥ ÌîºÌï¥ 4",backText:"Ïù¥ Ïπ¥ÎìúÍ∞Ä ÌõÑÏó¥Ïóê ÏûàÎäî ÌÑ¥Ïóê ÏäπÎ¶¨ÌïòÎ©¥ ÏµúÎåÄ Ï≤¥Î†• +3, ÏÜåÎ™®",front:[{op:"damageEnemy",target:"all",n:4}],back:[],onWinWhileInBack:[{op:"maxHp",n:3}]}]},{id:"camp_prep",name:"ÏïºÏòÅ Ï§ÄÎπÑ",frontText:"Î∞©Ïñ¥ +4, S +1",backText:"S +3",front:[{op:"block",n:4},{op:"supplies",n:1}],back:[{op:"supplies",n:3}],upgrades:[{frontText:"Î∞©Ïñ¥ +5, S +2",backText:"S +5",front:[{op:"block",n:5},{op:"supplies",n:2}],back:[{op:"supplies",n:5}]}]},{id:"vital_shot",name:"Í∏âÏÜå ÏÇ¨Í≤©",frontText:"ÏßÄÏ†ï ÌîºÌï¥ 8",backText:"ÏßÄÏ†ï ÌîºÌï¥ 5, Ï∂úÌòà 2 Î∂ÄÏó¨, S -1",front:[{op:"damageEnemy",target:"select",n:8}],back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:5},{op:"statusEnemy",target:"select",key:"bleed",n:2}],upgrades:[{frontText:"ÏßÄÏ†ï ÌîºÌï¥ 11",backText:"ÏßÄÏ†ï ÌîºÌï¥ 6, Ï∂úÌòà 3 Î∂ÄÏó¨, S -1",front:[{op:"damageEnemy",target:"select",n:11}],back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:6},{op:"statusEnemy",target:"select",key:"bleed",n:3}]}]},{id:"taunt",name:"ÎèÖÏÑ§",frontText:"ÏßÄÏ†ï ÏïΩÌôî +4",backText:"Ï†ÑÏ≤¥ Ï∑®ÏïΩ +2 Î∞è ÏïΩÌôî +2",front:[{op:"statusEnemy",target:"select",key:"weak",n:4}],back:[{op:"statusEnemy",target:"all",key:"vuln",n:2},{op:"statusEnemy",target:"all",key:"weak",n:2}],upgrades:[{frontText:"ÏßÄÏ†ï ÏïΩÌôî +5",backText:"Ï†ÑÏ≤¥ Ï∑®ÏïΩ +2 Î∞è ÏïΩÌôî +3",front:[{op:"statusEnemy",target:"select",key:"weak",n:5}],back:[{op:"statusEnemy",target:"all",key:"vuln",n:2},{op:"statusEnemy",target:"all",key:"weak",n:3}]}]},{id:"rapid_fire",name:"Ïó∞ÏÜç ÏÇ¨Í≤©",frontText:"ÏßÄÏ†ï ÌîºÌï¥ 2, 3Î≤à Î∞úÎèô",backText:"Ïù¥Î≤à ÌÑ¥Ïóê Ïπ¥ÎìúÎ•º ÎΩëÏïòÏúºÎ©¥ Î¨¥ÏûëÏúÑ ÌîºÌï¥ 8",front:[{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2}],back:[{op:"ifDrewThisTurn",then:[{op:"damageEnemy",target:"random",n:8}]}],upgrades:[{frontText:"ÏßÄÏ†ï ÌîºÌï¥ 2, 4Î≤à Î∞úÎèô",backText:"Ïù¥Î≤à ÌÑ¥Ïóê Ïπ¥ÎìúÎ•º ÎΩëÏïòÏúºÎ©¥ Î¨¥ÏûëÏúÑ ÌîºÌï¥ 10",front:[{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2}],back:[{op:"ifDrewThisTurn",then:[{op:"damageEnemy",target:"random",n:10}]}]}]},{id:"blood_contract",name:"ÌîºÏùò Í≥ÑÏïΩ",frontText:"ÏßÄÏ†ï ÌîºÌï¥ 12, HP -3",backText:"S +3, F +1",front:[{op:"damageEnemy",target:"select",n:12},{op:"hp",n:-3}],back:[{op:"supplies",n:3},{op:"fatigue",n:1}],upgrades:[{frontText:"ÏßÄÏ†ï ÌîºÌï¥ 15, HP -3",backText:"S +4, F +1",front:[{op:"damageEnemy",target:"select",n:15},{op:"hp",n:-3}],back:[{op:"supplies",n:4},{op:"fatigue",n:1}]}]},{id:"cloth_scrap_armor",name:"Ï≤ú Ï°∞Í∞Å Í∞ëÏò∑",frontText:"Î∞©Ïñ¥ +8, S -1",backText:"Î∞©Ïñ¥ +4",front:[{op:"supplies",n:-1},{op:"block",n:8}],back:[{op:"block",n:4}],upgrades:[{frontText:"Î∞©Ïñ¥ +10, S -1",backText:"Î∞©Ïñ¥ +5",front:[{op:"supplies",n:-1},{op:"block",n:10}],back:[{op:"block",n:5}]}]},{id:"prey_mark",name:"ÏÇ¨ÎÉ•Í∞ê ÌëúÏãú",frontText:"ÏßÄÏ†ï ÌîºÌï¥ 7, ÎåÄÏÉÅÏùò HPÍ∞Ä ÌîåÎ†àÏù¥Ïñ¥Î≥¥Îã§ ÎÜíÏúºÎ©¥ ÎåÄÏã† ÌîºÌï¥ 12",backText:"ÏßÄÏ†ï Ï∑®ÏïΩ +2",front:[{op:"damageEnemyFormula",target:"select",kind:"prey_mark"}],back:[{op:"statusEnemy",target:"select",key:"vuln",n:2}],upgrades:[{frontText:"ÏßÄÏ†ï ÌîºÌï¥ 9, ÎåÄÏÉÅÏùò HPÍ∞Ä ÌîåÎ†àÏù¥Ïñ¥Î≥¥Îã§ ÎÜíÏúºÎ©¥ ÎåÄÏã† ÌîºÌï¥ 15",front:[{op:"damageEnemyFormula",target:"select",kind:"prey_mark_u1"}],backText:"ÏßÄÏ†ï Ï∑®ÏïΩ +3",back:[{op:"statusEnemy",target:"select",key:"vuln",n:3}]}]},{id:"brawl_cleaver",name:"ÎÇúÏ†Ñ Ï†ïÎ¶¨",frontText:"ÏßÄÏ†ï ÌîºÌï¥ 8, ÎÇ®ÏùÄ Ï†ÅÏù¥ 3Î™ÖÏù¥Î©¥ ÎåÄÏã† ÌîºÌï¥ 16",backText:"Î∞©Ïñ¥ +6",front:[{op:"damageEnemyFormula",target:"select",kind:"triple_bounty"}],back:[{op:"block",n:6}],upgrades:[{frontText:"ÏßÄÏ†ï ÌîºÌï¥ 10, ÎÇ®ÏùÄ Ï†ÅÏù¥ 3Î™ÖÏù¥Î©¥ ÎåÄÏã† 20",front:[{op:"damageEnemyFormula",target:"select",kind:"triple_bounty_u1"}],backText:"Î∞©Ïñ¥ +7",back:[{op:"block",n:7}]}]},{id:"mad_echo",name:"Î©îÏïÑÎ¶¨",frontText:"Î¨¥ÏûëÏúÑ ÌîºÌï¥ (FÏùò Ï†àÎ∞ò (Î≤ÑÎ¶º))",backText:"ÎìúÎ°úÏö∞ 1, S +2, F +1",front:[{op:"damageEnemyByPlayerFatigue",target:"random",mult:.5}],back:[{op:"draw",n:1},{op:"supplies",n:2},{op:"fatigue",n:1}],upgrades:[{frontText:"Î¨¥ÏûëÏúÑ ÌîºÌï¥ (F)",front:[{op:"damageEnemyByPlayerFatigue",target:"random",mult:1}],backText:"ÎìúÎ°úÏö∞ 2, S +2, F +1",back:[{op:"draw",n:2},{op:"supplies",n:2},{op:"fatigue",n:1}]}]},{id:"mad_insight",name:"Í∏àÎã®Ïùò ÌÜµÏ∞∞",exhaustWhen:"BOTH",frontText:"Î∞©Ïñ¥ +8, ÎìúÎ°úÏö∞ 1, F +1, ÏÜåÎ™®",backText:"ÎìúÎ°úÏö∞ 3, S +2, F +2, ÏÜåÎ™®",front:[{op:"block",n:8},{op:"draw",n:1},{op:"fatigue",n:1}],back:[{op:"draw",n:3},{op:"supplies",n:2},{op:"fatigue",n:2}],upgrades:[{frontText:"Î∞©Ïñ¥ +10, ÎìúÎ°úÏö∞ 2, F +1, ÏÜåÎ™®",front:[{op:"block",n:10},{op:"draw",n:2},{op:"fatigue",n:1}],backText:"ÎìúÎ°úÏö∞ 4, S +3, F +2, ÏÜåÎ™®",back:[{op:"draw",n:4},{op:"supplies",n:3},{op:"fatigue",n:2}]}]},{id:"mad_bargain",name:"Í±∞ÎûòÏùò ÏûîÏû¨",exhaustWhen:"BOTH",frontText:"ÏßÄÏ†ï 12 ÌîºÌï¥, S -1, F +1, ÏÜåÎ™®",backText:"HP +5, F +2, ÏÜåÎ™®",front:[{op:"damageEnemy",target:"select",n:12},{op:"supplies",n:-1},{op:"fatigue",n:1}],back:[{op:"heal",n:5},{op:"fatigue",n:2}],upgrades:[{frontText:"ÏßÄÏ†ï 20 ÌîºÌï¥, S -1, F +2, ÏÜåÎ™®",front:[{op:"damageEnemy",target:"select",n:20},{op:"supplies",n:-1},{op:"fatigue",n:2}],backText:"HP +7, F +2, ÏÜåÎ™®",back:[{op:"heal",n:7},{op:"fatigue",n:2}]}]}],Gn=Object.fromEntries(Vr.map(e=>[e.id,e])),Yr=[{id:"other_adventurer",name:"Î≥¥Î¨ºÏùÑ ÎÖ∏Î¶¨Îäî Îã§Î•∏ Î™®ÌóòÍ∞Ä",maxHp:60,intents:[{label:"Ï∞Ω Ï∞åÎ•¥Í∏∞: 5 ÌîºÌï¥, 3Î≤à Î∞úÎèô",acts:[{op:"damagePlayer",n:5},{op:"damagePlayer",n:5},{op:"damagePlayer",n:5}]},{label:"ÎèÖÏïΩ ÎøåÎ¶¨Í∏∞: Ï∂úÌòà +4, Ï∑®ÏïΩ +4, ÏïΩÌôî +4 Î∂ÄÏó¨",acts:[{op:"statusPlayer",key:"bleed",n:4},{op:"statusPlayer",key:"vuln",n:4},{op:"statusPlayer",key:"weak",n:4}]}]},{id:"goblin_raider",name:"Í≥†Î∏îÎ¶∞ ÏïΩÌÉàÏûê",maxHp:15,intents:[{label:"Í∏∞Ïäµ: 12 - Ïù¥Î≤à ÌÑ¥Ïóê ÏÇ¨Ïö©Ìïú Ïπ¥ÎìúÏùò ÏàòÎßåÌÅº ÌîºÌï¥",acts:[{op:"damagePlayerFormula",kind:"goblin_raider"}]},{label:"ÌõîÏπòÍ∏∞: Ï∂úÌòà +2 Î∂ÄÏó¨, S -3",acts:[{op:"supplies",n:-3},{op:"statusPlayer",key:"bleed",n:2}]}]},{id:"watching_statue",name:"Í∞êÏãúÌïòÎäî ÏÑùÏÉÅ",maxHp:25,intents:[{label:"Í∞êÏãú: 4 + Ïù¥Î≤à ÌÑ¥Ïóê ÏÇ¨Ïö©Ìïú Ïπ¥ÎìúÏùò ÏàòÎßåÌÅº ÌîºÌï¥",acts:[{op:"damagePlayerFormula",kind:"watching_statue"}]}]},{id:"pebble_golem",name:"Ï°∞ÏïΩÎèå Í≥®Î†ò",maxHp:30,intents:[{label:"Ï°∞ÏïΩÎèå ÎçòÏßÄÍ∏∞: 8 ÌîºÌï¥",acts:[{op:"damagePlayer",n:8}]},{label:"Î™®Îûò Î™®ÏúºÍ∏∞: ÏûêÏã† HP 6 ÌöåÎ≥µ",acts:[{op:"enemyHealSelf",n:6}]}]},{id:"rock_golem",name:"Î∞îÏúÑ Í≥®Î†ò",maxHp:50,intents:[{label:"Î∞îÏúÑ ÎçòÏßÄÍ∏∞: 10 ÌîºÌï¥",acts:[{op:"damagePlayer",n:10}]},{label:"ÎïÖ Î™®ÏúºÍ∏∞: ÏûêÏã† HP 8 ÌöåÎ≥µ",acts:[{op:"enemyHealSelf",n:8}]}]},{id:"slime",name:"Ïä¨ÎùºÏûÑ",maxHp:30,intents:[{label:"ÏÇ∞ÏÑ±Ïï°: Ï∂úÌòà +3 Î∂ÄÏó¨",acts:[{op:"statusPlayer",key:"bleed",n:3}]},{label:"Ï†êÏï°: ÏïΩÌôî +3 Î∂ÄÏó¨ ÌõÑ ÏûêÏã† HP 3 ÌöåÎ≥µ",acts:[{op:"statusPlayer",key:"weak",n:3},{op:"enemyHealSelf",n:3}]},{label:"ÎïåÎ¶¨Í∏∞: 6 ÌîºÌï¥",acts:[{op:"damagePlayer",n:6}]}]},{id:"poison_spider",name:"ÎèÖÍ±∞ÎØ∏",maxHp:28,intents:[{label:"ÎèÖÎãàÎ°ú Î¨ºÍ∏∞: Ï∂úÌòà +4 Î∂ÄÏó¨",acts:[{op:"statusPlayer",key:"bleed",n:4}]},{label:"ÏÜ°Í≥≥ÎãàÎ°ú Î¨ºÍ∏∞: 7 ÌîºÌï¥",acts:[{op:"damagePlayer",n:7}]},{label:"Îã®Î≤àÏóê Î¨ºÍ∏∞: Ï∂úÌòà +2 Î∂ÄÏó¨, 6 ÌîºÌï¥",acts:[{op:"statusPlayer",key:"bleed",n:2},{op:"damagePlayer",n:6}]}]},{id:"gravity_echo",name:"Ï§ëÎ†•Ïùò ÏûîÌñ•",maxHp:35,intents:[{label:"ÌïòÏ§ë Ïù∏Ïû•",acts:[{op:"damagePlayerByDeckSize",base:5,per:2,div:6,cap:18}]},{label:"ÏïïÏ∂ï: 7 ÌîºÌï¥",acts:[{op:"damagePlayer",n:7}]},{label:"ÎÜìÏπòÍ≤å ÎßåÎì§Í∏∞: S -3",acts:[{op:"supplies",n:-3}]}]},{id:"rat_swarm",name:"Ï•êÎñº",maxHp:20,intents:[{label:"ÎúØÍ∏∞: 4 ÌîºÌï¥, 2Î≤à Î∞úÎèô",acts:[{op:"damagePlayer",n:4},{op:"damagePlayer",n:4}]},{label:"Í∏∞ÏäµÌïòÍ∏∞: Ï∑®ÏïΩ +2 Î∂ÄÏó¨",acts:[{op:"statusPlayer",key:"vuln",n:2}]},{label:"Í¥ëÎûÄ: 2 ÌîºÌï¥ (ÌÉÄÏàòÍ∞Ä Ï¶ùÍ∞ÄÌï©ÎãàÎã§!) ",acts:[{op:"damagePlayerRampHits",n:2,baseHits:1,everyTurns:1,capHits:6}]}]},{id:"goblin_commander",name:"Í≥†Î∏îÎ¶∞ ÏßÄÌúòÍ¥Ä",maxHp:30,intents:[{label:"Ìò∏Î†π: Ï∑®ÏïΩ +2 Î∂ÄÏó¨",acts:[{op:"statusPlayer",key:"vuln",n:2}]},{label:"Î∞úÎ°ú Ï∞®Í∏∞: 7 ÌîºÌï¥",acts:[{op:"damagePlayer",n:7}]},{label:"Ï†ÑÏà† ÏßÄÏãú: ÏïΩÌôî +2 Î∂ÄÏó¨",acts:[{op:"statusPlayer",key:"weak",n:2}]}]},{id:"goblin_archer",name:"Í≥†Î∏îÎ¶∞ Í∂ÅÏàò",maxHp:15,intents:[{label:"Ï°∞Ï§Ä: 2 ÌîºÌï¥, 3Î≤à",acts:[{op:"damagePlayer",n:2},{op:"damagePlayer",n:2},{op:"damagePlayer",n:2}]},{label:"Ïó∞ÏÇ¨: 1 ÌîºÌï¥ (ÌÉÄÏàòÍ∞Ä Ï¶ùÍ∞ÄÌï©ÎãàÎã§!)",acts:[{op:"damagePlayerRampHits",n:1,baseHits:1,everyTurns:1,capHits:10}]}]},{id:"gloved_hunter",name:"Ïû•Í∞ë ÎÇÄ ÏÇ¨ÎÉ•Íæº",maxHp:52,intents:[{label:"Í∞ÄÎä†: Ï∑®ÏïΩ +3 Î∂ÄÏó¨",acts:[{op:"statusPlayer",key:"vuln",n:3}]},{label:"ÏÇ¨ÎÉ•: 6 ÌîºÌï¥, Î∞©Ïñ¥Í∞Ä 4 Ïù¥ÏÉÅÏù¥Î©¥ ÎåÄÏã† 12 ÌîºÌï¥",acts:[{op:"damagePlayerFormula",kind:"gloved_hunter"}]},{label:"ÏÇ¨ÏÇ¥: 9 ÌîºÌï¥",acts:[{op:"damagePlayer",n:9}]}]},{id:"debt_collector",name:"Ïû•Î∂Ä ÏàòÍ∏àÍ¥Ä",maxHp:55,intents:[{label:"ÏàòÍ∏à: S -3",acts:[{op:"supplies",n:-4}]},{label:"ÏïïÎ•ò: (SÍ∞Ä 0Ïù¥Î©¥) 15 ÌîºÌï¥",acts:[{op:"damagePlayerIfSuppliesZero",n:15}]},{label:"Ïû¨Ï†êÍ≤Ä: ÏïÑÎ¨¥ ÌñâÎèôÎèÑ ÌïòÏßÄ ÏïäÏùå",acts:[]}]},{id:"supply_hound",name:"Î≥¥Í∏â ÏÇ¨ÎÉ•Í∞ú",maxHp:26,intents:[{label:"ÎÉÑÏÉà Îß°Í∏∞: Ï∑®ÏïΩ +2 Î∂ÄÏó¨",acts:[{op:"statusPlayer",key:"vuln",n:2}]},{label:"ÎçÆÏπòÍ∏∞: (SÍ∞Ä 0Ïù¥ ÏïÑÎãàÎ©¥) 10 ÌîºÌï¥",acts:[{op:"damagePlayerIfSuppliesPositive",n:7}]},{label:"ÎúØÏñ¥ÎÇ¥Í∏∞: S -2",acts:[{op:"supplies",n:-2}]}]},{id:"boss_gravity_master",name:"Ï§ëÎ†• ÌÜµÎã¨Ïûê",omen:"Î™∏Ïù¥ Ï†êÏ†ê Î¨¥Í≤ÅÎã§. ÏßêÏùÑ ÎπÑÏõåÎùº.",maxHp:90,intents:[{label:"Ï§ëÎ†• ÏàòÏ∂ï: ÏïΩÌôî +3 Î∂ÄÏó¨",acts:[{op:"statusPlayer",key:"weak",n:3}]},{label:"ÌäπÏù¥Ï†ê ÏÉùÏÑ±",acts:[{op:"damagePlayerByDeckSize",base:8,per:3,div:5,cap:30}]},{label:"Ï≤úÏû• Î∂ïÍ¥¥: 11 ÌîºÌï¥",acts:[{op:"damagePlayer",n:11}]}]},{id:"boss_cursed_wall",name:"Ï†ÄÏ£ºÎ∞õÏùÄ Î≤Ω",omen:"ÏõÄÏßÅÏù¥ÏßÄ ÏïäÎäîÎã§. Îã≥ÏïÑÍ∞ÑÎã§.",maxHp:160,intents:[{label:"Ï†ÄÏ£ºÏùò Í∏∞Ïö¥: Ï∂úÌòà +3 Î∂ÄÏó¨",acts:[{op:"statusPlayer",key:"bleed",n:3}]},{label:"Ï†ÄÏ£ºÏùò Í∏∞Ïö¥: F +1",acts:[{op:"fatiguePlayer",n:1}]},{label:"ÏïÑÎ¨¥ ÌñâÎèôÎèÑ ÌïòÏßÄ ÏïäÏùå",acts:[]}]},{id:"boss_giant_orc",name:"Í±∞ÎåÄÌïú Ïò§ÌÅ¨",omen:"Í±∞ÎåÄÌïú ÏßêÏäπÏù¥ Í∏∞Îã§Î¶∞Îã§. ÌûòÏùÑ ÍπéÏïÑÏïº ÌïúÎã§.",maxHp:95,intents:[{label:"ÎÇ¥Î†§ÏπòÍ∏∞: Ï∑®ÏïΩ +2 Î∂ÄÏó¨, 10 ÌîºÌï¥",acts:[{op:"statusPlayer",key:"vuln",n:2},{op:"damagePlayer",n:15}]},{label:"Îã®Îã®Ìïú ÌîºÎ∂Ä: Îã§Ïùå ÌÑ¥ ÎèôÏïà ÌîºÌï¥Î•º ÏûÖÏßÄ ÏïäÏùå",acts:[{op:"enemyImmuneNextTurn"}]},{label:"ÌÉÄÍ≥†ÎÇú ÌöåÎ≥µ: ÏûêÏã† HP 15 ÌöåÎ≥µ",acts:[{op:"enemyHealSelf",n:15}]},{label:"Í¥ëÎ∂Ñ: 6 ÌîºÌï¥ (ÌÉÄÏàòÍ∞Ä Ï¶ùÍ∞ÄÌï©ÎãàÎã§!)",acts:[{op:"damagePlayerRampHits",n:6,baseHits:1,everyTurns:1,capHits:6}],meta:{cat:"ATTACK"}}]},{id:"boss_soul_stealer",name:"ÏòÅÌòº Í∞ïÌÉàÏûê",omen:"ÌñâÎèôÌïòÏßÄ ÏïäÏúºÎ©¥ Ï¢ÖÎßêÏù¥ Ïò®Îã§.",maxHp:80,intents:[{label:"ÌóàÍ∏∞: 7 ÌîºÌï¥, S -2",acts:[{op:"damagePlayer",n:7},{op:"supplies",n:-2}]},{label:"ÎÇòÌÉú: 7 ÌîºÌï¥, F +1",acts:[{op:"damagePlayer",n:7},{op:"fatiguePlayer",n:1}]},{label:"ÏòàÏñ∏: Ïπ¥Ïö¥Ìä∏ ÏßÑÌñâ",acts:[]}]}],Gr=Object.fromEntries(Yr.map(e=>[e.id,e]));function Xr(e,t=10,n=16){const r=Math.max(0,e-n),o=Math.ceil(Math.sqrt(r));return t+o}function Rt(e,t){const n=e.content.enemiesById[t];return{id:n.id,name:n.name,hp:n.maxHp,maxHp:n.maxHp,intentIndex:0,status:{vuln:0,weak:0,bleed:0,disrupt:0},immuneThisTurn:!1,immuneNextTurn:!1,lastIntentKey:null,lastIntentStreak:0,soulWarnCount:t==="boss_soul_stealer"?0:void 0,soulArmed:t==="boss_soul_stealer"?!1:void 0,soulWillNukeThisTurn:t==="boss_soul_stealer"?!1:void 0}}function Qr(e,t,n,r=5){for(const o of t){const s=e.run.enemyLastSeenBattle?.[o];if(s!=null&&n-s<r)return!1}return!0}function Le(e,t){const n=t?.forceBoss??!1,r=e.run,o=(t?.forceElite??r.pendingElite??!1)===!0;r.pendingElite=!1,e.run.enemyLastSeenBattle??={},e.run.battleCount??=0;const s=e.run.nodePickCount??0,a=(e.run.battleCount??0)+1;if(t?.forcePatternIds&&t.forcePatternIds.length>0){const m=t.forcePatternIds;e.run.battleCount=a;for(const k of m)e.run.enemyLastSeenBattle[k]=a;e.enemies=m.map(k=>Rt(e,k)),e.run.lastBattleWasElite=!1,y(e,`Ï†ÑÌà¨ ÏãúÏûë! (ÎÖ∏Îìú ${s}, Ï†ÑÌà¨ ${a}ÌöåÏ∞®) Ï†Å: ${e.enemies.map(k=>k.name).join(", ")}`);return}if(n)if(e.run.lastBattleWasElite=!1,e.run.bossPool??=["boss_gravity_master","boss_cursed_wall","boss_giant_orc","boss_soul_stealer"],e.run.bossPool.length===0&&!e.run.nextBossId)y(e,`Î≥¥Ïä§ ÌíÄÏù¥ ÎπÑÏóàÏäµÎãàÎã§. ÏùºÎ∞ò Ï†ÑÌà¨Î°ú ÏßÑÌñâÌï©ÎãàÎã§. (ÎÖ∏Îìú ${s})`);else{let m=e.run.nextBossId??null;if(m!=null){const k=e.content.enemiesById[m];e.run.bossOmenText=dr[m]??k.omen??null}m?(e.run.nextBossId=null,e.run.bossPool=e.run.bossPool.filter(k=>k!==m)):(m=re(e.run.bossPool),e.run.bossPool=e.run.bossPool.filter(k=>k!==m)),e.enemies=[Rt(e,m)],e.run.ominousProphecySeen=!1,y(e,`Î≥¥Ïä§ Îì±Ïû•! (ÎÖ∏Îìú ${s}) Ï†Å: ${e.enemies[0].name}`),e.run.battleCount=a,e.run.enemyLastSeenBattle[m]=a;return}const i=[[["goblin_raider"],["watching_statue"],["pebble_golem"],["slime"],["rat_swarm"],["supply_hound"]],[["goblin_raider","slime"],["pebble_golem","pebble_golem"],["rock_golem"],["poison_spider"],["rat_swarm","rat_swarm"],["goblin_archer","goblin_raider"],["supply_hound","goblin_raider"]],[["goblin_raider","goblin_raider","goblin_raider"],["rock_golem","pebble_golem"],["slime","slime"],["poison_spider","slime"],["gravity_echo"],["gloved_hunter"],["debt_collector"]]],l=[["gravity_echo","poison_spider"],["poison_spider","slime"],["watching_statue","slime"],["watching_statue","watching_statue"],["poison_spider","poison_spider"],["rock_golem","gravity_echo"],["goblin_raider","goblin_raider","watching_statue"],["rat_swarm","rat_swarm","rat_swarm"]],c=[[["goblin_raider","watching_statue"],["rat_swarm","goblin_archer"]],[["goblin_commander","goblin_archer","goblin_archer"],["watching_statue","watching_statue"],["gloved_hunter","rat_swarm"]],[["rock_golem","gravity_echo"],["poison_spider","poison_spider","poison_spider"]]],h=[["gravity_echo","gravity_echo"],["rock_golem","poison_spider"],["watching_statue","gravity_echo"],["debt_collector","supply_hound","supply_hound"]],u=Number(e.run.timeMove??0)+(e.time??0),d=Math.min(i.length-1,Math.floor(Math.max(0,u)/15)),x=o?e.run.treasureObtained?h:c[d]:e.run.treasureObtained?l:i[d],_=5,f=x.filter(m=>Qr(e,m,a,_)),p=f.length>0?f:x,b=re(p);e.run.battleCount=a;for(const m of b)e.run.enemyLastSeenBattle[m]=a;e.enemies=b.map(m=>Rt(e,m)),e.run.lastBattleWasElite=o,y(e,`Ï†ÑÌà¨ ÏãúÏûë!${o?" [Ï†ïÏòà]":""} (ÎÖ∏Îìú ${s}, Ï†ÑÌà¨ ${a}ÌöåÏ∞®) Ï†Å: ${e.enemies.map(m=>m.name).join(", ")}`)}function Jr(){return Object.keys(Q).sort((e,t)=>e.localeCompare(t))}const Zr=[{id:"relic_ratskin_charm",name:"Ï•êÍ∞ÄÏ£Ω Î∂ÄÏ†Å",text:"Ï∑®ÏïΩÏùÑ Î∞õÏùÑ Îïå 1 Îçú Î∞õÏäµÎãàÎã§.",unlockFlavor:"ÏÇ¥Í∞ÄÏ£Ω. ÏñáÍ≤å, ÏïÑÏ£º ÏñáÍ≤å.",tags:["EVENT_ONLY"],art:"assets/relics/relic_ratskin_charm.png"}],Q={relic_unknown_square:{id:"relic_unknown_square",dormantName:"Ï†ñÏùÄ ÏÇ¨Í∞ÅÌòï",dormantText:"Í≥∞Ìå°Ïù¥ÏùºÍπå? Î®πÏùÑ Ïàò ÏûàÏùÑÍπå?",unlockHint:"Ï°∞Í±¥: Ìú¥Ïãù 1Ìöå",art:"assets/relics/relic_unknown_square.png",unlock:e=>e.run.unlock?.rest>=1,name:"Î®πÏùÑ Ïàò ÏûàÎäî ÏÇ¨Í∞ÅÌòï",text:"Ï†ÑÌà¨ ÏãúÏûë Ïãú üåæ S +2",unlockFlavor:"Î®πÏùÑ ÏàòÎäî ÏûàÎã§. ÏùºÎã®ÏùÄ.",onCombatStart(e){e.player.supplies+=2,y(e,"Ïú†Î¨º[Î®πÏùÑ Ïàò ÏûàÎäî ÏÇ¨Í∞ÅÌòï]: S +2")}},relic_monster_leather_helm:{id:"relic_monster_leather_helm",dormantName:"Îì§Îü¨Î∂ôÎäî Í∞ÄÏ£Ω",dormantText:"ÌÑ∏Í≥º ÌîºÍ∞Ä Îí§ÏÑûÏù∏ Í∞ÄÏ£ΩÏù¥ ÏÜêÏóê Îì§Îü¨Î∂ôÎäîÎã§.",unlockHint:"Ï°∞Í±¥: ÏóòÎ¶¨Ìä∏ Ï†ÑÌà¨ ÏäπÎ¶¨ 1Ìöå(ÌöçÎìù ÌõÑ)",art:"assets/relics/relic_monster_leather_helm.png",unlock:e=>{const t=e.run,n=Number(t?.unlock?.eliteWins??0)||0,r=t?.relicRuntime?.relic_monster_leather_helm;r&&r.eliteWinsAtObtain==null&&(r.eliteWinsAtObtain=n);const o=Number.isFinite(r?.eliteWinsAtObtain)?r.eliteWinsAtObtain:n;return n>=o+1},name:"Î™¨Ïä§ÌÑ∞ Í∞ÄÏ£Ω Ìà¨Íµ¨",text:"Ï≤´ ÌÑ¥Ïóê üõ°Ô∏è Î∞©Ïñ¥ +4",unlockFlavor:"Î®∏Î¶¨Ïóê Îì§Îü¨Î∂ôÏñ¥ Îñ®Ïñ¥ÏßÄÏßÄ ÏïäÏßÄÎßå ÎãπÏû•Ïùò Î¨∏Ï†úÎäî ÏïÑÎãàÎã§.",onCombatStart(e){e.player.block+=4,y(e,"Ïú†Î¨º[Î™¨Ïä§ÌÑ∞ Í∞ÄÏ£Ω Ìà¨Íµ¨]: Î∞©Ïñ¥ +4")}},relic_smoke_bomb:{id:"relic_smoke_bomb",dormantName:"ÏÜçÏù¥ ÎπÑÏñ¥ ÏûàÎäî ÌÉÑÌôò",dormantText:"ÌùîÎì§Î©¥ ÏûëÏùÄ ÏïåÍ∞±Ïù¥Í∞Ä Íµ¥Îü¨Îã§ÎãåÎã§. Ïó∞Í∏∞Í∞Ä Ï°∞Í∏àÏî© ÏÉåÎã§.",unlockHint:"Ï°∞Í±¥: Ìïú Î≤àÏóê 10 Ïù¥ÏÉÅÏùò üó°Ô∏è ÌîºÌï¥ 1Ìöå Î∞õÍ∏∞",art:"assets/relics/relic_smoke_bomb.png",unlock:e=>!!e.run.unlock?.tookBigHit10,name:"Ïó∞ÎßâÌÉÑ",text:"ÌôúÏÑ±Ìôî Ïãú Ïó∞Îßâ Ïπ¥Îìú(ÏÜåÏã§) 1Ïû• ÌöçÎìù",unlockFlavor:"ÎπÑÏÉÅ ÌÉàÏ∂ú!",onActivate(e){const t="smoke";e.uidSeq+=1;const n=String(e.uidSeq);e.cards[n]={uid:n,defId:t,zone:"deck",upgrade:0},e.deck.push(n),y(e,"Ïú†Î¨º[Ïó∞ÎßâÌÉÑ]: Ïó∞Îßâ Ïπ¥Îìú 1Ïû• ÌöçÎìù")}},relic_bone_compass:{id:"relic_bone_compass",dormantName:"Í∏∏ÏùÑ ÏûÉÎäî Î∞îÎäò",dormantText:"Î∞©Ìñ•ÏùÑ Í∞ÄÎ¶¨ÌÇ§ÏßÄ Î™ªÌïòÎäî Î∞îÎäòÏù¥ Ï£ºÎ®∏Îãà Î∞îÍπ•ÏúºÎ°ú ÎÇòÏò®Îã§.",unlockHint:"Ï°∞Í±¥: ÌÉêÌóò 5Ìöå",art:"assets/relics/relic_bone_compass.png",unlock:e=>(e.run?.nodePickCount??0)>=5,name:"ÎºàÍ∞Ä ÎßåÎì† ÎÇòÏπ®Î∞ò",text:"Ï†ÑÌà¨ ÏãúÏûë Ïãú üÉè ÎìúÎ°úÏö∞ +1",unlockFlavor:"Ïñ¥ÎîîÎ•º Í∞ÄÎ¶¨ÌÇ§Îäî Í≤ÉÏù¥ÏßÄ?",onCombatStart(e){e._combatStartExtraDraw=(e._combatStartExtraDraw??0)+1,y(e,"Ïú†Î¨º[ÎºàÍ∞Ä ÎßåÎì† ÎÇòÏπ®Î∞ò]: Ï†ÑÌà¨ ÏãúÏûë ÎìúÎ°úÏö∞ +1")}},relic_flesh_whetstone:{id:"relic_flesh_whetstone",dormantName:"Ïù¥Í∞Ä Îπ†ÏßÑ ÏπºÎÇ†",dormantText:"Ïñ¥ÎîîÏóê Ïì∞ÎùºÍ≥† ÏûàÎäîÏßÄ Î™®Î•¥Í≤†Îã§.",unlockHint:"Ï°∞Í±¥: Ï†Å Ï≤òÏπò 3Ìöå",art:"assets/relics/relic_flesh_whetstone.png",unlock:e=>(e.run.unlock?.kills??0)>=3,name:"ÏÜçÏÇ¥ÏùÑ Ï∞æÎäî Ïà´Îèå",text:"Ï†ÑÌà¨ÏóêÏÑú Ï≤´ Í≥µÍ≤©Ïù¥ Ï£ºÎäî üó°Ô∏è ÌîºÌï¥ +3",unlockFlavor:"Î∞§ÎßàÎã§ Î¨¥Ïñ∏Í∞Ä Í∞àÍ≥† ÏûàÎã§.",onCombatStart(e){e._firstPlayerAttackDoneThisCombat=!1},modifyDamage(e,t){if(t.phase!=="PRE_STATUS")return t.current;if(t.target==="ENEMY"&&t.source==="PLAYER_ATTACK"){const n=e;if(!n._firstPlayerAttackDoneThisCombat)return n._firstPlayerAttackDoneThisCombat=!0,t.current+3}return t.current}},relic_weak_bell:{id:"relic_weak_bell",dormantName:"ÏÉàÍπåÎßå Ï¢Ö",dormantText:"ÎßåÏßÄÎ©¥ ÏÜêÎÅùÏù¥ Î¨¥Í≤ÅÎã§. ÎãπÏû•Ïóî ÏïÑÎ¨¥ ÏùºÎèÑ ÏóÜÎã§.",unlockHint:"Ï°∞Í±¥: ü•Ä ÏïΩÌôîÎ•º Î∞õÏùÄ ÏÉÅÌÉúÎ°ú ÌÑ¥ Ï¢ÖÎ£å 1Ìöå",art:"assets/relics/relic_weak_bell.png",unlock:e=>!!e.run.unlock?.endedTurnWeak,name:"ÌóàÏïΩÏùò Ï¢ÖÏÜåÎ¶¨",text:"Ï†ÑÌà¨ ÏãúÏûë Ïãú Î™®Îì† Ï†ÅÏóêÍ≤å ü•Ä ÏïΩÌôî +2",unlockFlavor:"Ïô†ÏßÄ Îì§ÏúºÎ©¥ ÎßàÏùåÏù¥ ÌèâÏò®Ìï¥ÏßÑÎã§.",onCombatStart(e){const t=G(e);for(const n of t)Ze(n,"weak",2,e,"SYSTEM");t.length&&y(e,"Ïú†Î¨º[ÌóàÏïΩÏùò Ï¢ÖÏÜåÎ¶¨]: Î™®Îì† Ï†Å ÏïΩÌôî +2")}},relic_return_path_memory:{id:"relic_return_path_memory",dormantName:"Ï∞¢Ïñ¥ÏßÑ ÏßÄÎèÑ Ï°∞Í∞Å",dormantText:"ÏùΩÏùÑ Ïàò ÏóÜÎäî Í∏∏Ïù¥ Í∑∏Î†§Ï†∏ ÏûàÎã§. Í∞ÄÎ≥¥Í≥† Ïã∂Îã§.",unlockHint:"Ï°∞Í±¥: Ïù¥Î≤§Ìä∏ 2Ìöå ÏÑ†ÌÉù",art:"assets/relics/relic_return_path_memory.png",unlock:e=>(e.run.unlock?.eventPicks??0)>=2,name:"ÎèåÏïÑÏò® Í∏∏Ïùò Í∏∞Ïñµ",text:"Ï†ÑÌà¨ ÏäπÎ¶¨ Ïãú HP +3",unlockFlavor:"ÏôîÍ∏∞Ïóê Í∞à Ïàò ÏóÜÎã§.",onVictory(e){tt(e,3),y(e,"Ïú†Î¨º[ÎèåÏïÑÏò® Í∏∏Ïùò Í∏∞Ïñµ]: ÏäπÎ¶¨ ÌöåÎ≥µ +3")}},relic_wound_vial:{id:"relic_wound_vial",dormantName:"Î∞òÏù¥ÎÇò ÎÇ®ÏùÄ Î∂âÏùÄ Ïï°Ï≤¥",dormantText:"ÎßàÍ∞úÎ•º Ïó¥ÏßÄ ÏïäÏïòÎäîÎç∞ÎèÑ Ìîº ÎÉÑÏÉàÍ∞Ä ÎÇúÎã§.",unlockHint:"Ï°∞Í±¥: HPÍ∞Ä 15 Ïù¥ÌïòÎ°ú Îñ®Ïñ¥ÏßÑ Ï†Å 1Ìöå",art:"assets/relics/relic_wound_vial.png",unlock:e=>!!e.run.unlock?.hpLeq15,name:"ÏÉÅÏ≤òÎ°ú Í∏∞Ïñ¥Í∞ÄÎäî ÏïΩÎ≥ë",text:"Ï†ÑÌà¨ ÏãúÏûë Ïãú HP +3",unlockFlavor:"Ïî®ÏïóÏù¥ ÏûàÏóàÎÇò?",onCombatStart(e){tt(e,3),y(e,"Ïú†Î¨º[ÏÉÅÏ≤òÎ°ú Í∏∞Ïñ¥Í∞ÄÎäî ÏïΩÎ≥ë]: Ï†ÑÌà¨ ÏãúÏûë ÌöåÎ≥µ +3")}},relic_counting_needle:{id:"relic_counting_needle",dormantName:"Î©àÏ∂ò Î∞îÎäò",dormantText:"ÏãúÍ≥ÑÏùºÍπå? ÏãúÍ≥ÑÍ∞Ä ÏïÑÎãêÍπå? Îëò Îã§ ÏïÑÎãàÎã§.",unlockHint:"Ï°∞Í±¥: ÏïÑÎ¨¥ ÌñâÎèôÎèÑ ÌïòÏßÄ ÏïäÍ≥† ÌÑ¥ Ï¢ÖÎ£å 1Ìöå",art:"assets/relics/relic_counting_needle.png",unlock:e=>!!e.run.unlock?.skippedTurn,name:"Ïà®ÏùÑ ÏÑ∏Îäî Î∞îÎäò",text:"ÌÑ¥ Ï¢ÖÎ£å Ïãú Îã§Ïùå ÌÑ¥ üÉè ÎìúÎ°úÏö∞ +1",unlockFlavor:"Î∞îÎäòÏù¥ ÎèàÎã§. ÏïÑÎ¨¥Í≤ÉÎèÑ ÏóÜÏù¥.",onUpkeepEnd(e){e._extraDrawNextTurn=Number(e._extraDrawNextTurn??0)+1,y(e,"Ïú†Î¨º[Ïà®ÏùÑ ÏÑ∏Îäî Î∞îÎäò]: Îã§Ïùå ÌÑ¥ ÎìúÎ°úÏö∞ +1")}},relic_deeper_needle:{id:"relic_deeper_needle",dormantName:"ÎºàÎ°ú ÎßåÎì† Î∞îÎäò",dormantText:"Îî∞ÎÅîÌï®Ïóê ÏùµÏàôÌïú ÏßÄ Ïò§ÎûòÎã§.",unlockHint:"Ï°∞Í±¥: Ï†ÅÏóêÍ≤å ü©∏ Ï∂úÌòà Î∂ÄÏó¨ 3Ìöå",art:"assets/relics/relic_deeper_needle.png",unlock:e=>(e.run.unlock?.bleedApplied??0)>=3,name:"Îçî ÍπäÏùÄ Î∞îÎäò",text:"ü©∏ Ï∂úÌòàÏùÑ Î∂ÄÏó¨Ìï† ÎïåÎßàÎã§ +1 Ï∂îÍ∞Ä",unlockFlavor:"Î∞îÎäòÏù¥ ÌîºÎ•º Î®πÍ≥† Í∏∏Ïñ¥ÏßÑ Í≤É Í∞ôÎã§.",onCombatStart(e){e._bleedBonusPerApply=1},onVictory(e){delete e._bleedBonusPerApply}},relic_broken_millstone:{id:"relic_broken_millstone",dormantName:"Í∏à Í∞Ñ Îß∑Îèå",dormantText:"Í∞àÍ≥† ÏûàÏúºÎ©¥ ÏãúÍ∞Ñ Í∞ÄÎäî Ï§Ñ Î™®Î•¥Í≤†Îã§.",unlockHint:"Ï°∞Í±¥: ÏãúÍ∞Ñ 10 ÌùòÎ†§Î≥¥ÎÇ¥Í∏∞",art:"assets/relics/relic_broken_millstone.png",unlock:e=>{const t=e.run,n=Number(t.timeMove??0)||0,r=Number(e.time??0)||0;return n+r>=10},name:"Íπ®ÏßÑ Îß∑Îèå",text:"Îß§ ÌÑ¥ Î™®Îì† Ï†ÅÏóêÍ≤å üó°Ô∏è 2 ÌîºÌï¥",unlockFlavor:"ÎèåÏù¥ Îã≥ÎäîÎã§. Ï†ÅÎèÑ Îã≥ÎäîÎã§.",onUpkeepEnd(e){const t=G(e);if(t?.length){for(const n of t){let r=2;const o=Number(n.block??0);if(o>0){const s=Math.min(o,r);n.block=o-s,r-=s}if(r>0){const s=Number(n.hp??0);n.hp=Math.max(0,s-r)}}y(e,"Ïú†Î¨º[Íπ®ÏßÑ Îß∑Îèå]: Î™®Îì† Ï†ÅÏóêÍ≤å 2 ÌîºÌï¥")}}},relic_bloody_spoon:{id:"relic_bloody_spoon",dormantName:"Î∂âÏùÄ ÏàüÍ∞ÄÎùΩ",dormantText:"Ïá† ÎÉÑÏÉàÍ∞Ä ÏßÑÌïòÎã§.",unlockHint:"Ï°∞Í±¥: üí§ F 10 Ïù¥ÏÉÅ",art:"assets/relics/relic_bloody_spoon.png",unlock:e=>e.player.fatigue>9,name:"Ìîº Î¨ªÏùÄ ÏàüÍ∞ÄÎùΩ",text:"ÌöåÎ≥µ Ïãú 1 Ï∂îÍ∞Ä ÌöåÎ≥µ",unlockFlavor:"Ïù¥Îü∞, ÌîºÏòÄÎã§."},relic_black_ledger_shard:{id:"relic_black_ledger_shard",dormantName:"Í≤ÄÎåï Î¨ªÏùÄ Ï¢ÖÏù¥",dormantText:"Í≤ÄÏùÄ Ï¢ÖÏù¥Îã§. ÌÉÄÍ≥† ÎÇ®ÏùÄ Ï°∞Í∞ÅÏùºÏßÄÎèÑ Î™®Î•¥Í≤†Îã§.",unlockHint:"Ï°∞Í±¥: üåæS = 0",art:"assets/relics/relic_black_ledger_shard.png",unlock:e=>e.player.supplies===0,name:"Í≤ÄÏùÄ Ïû•Î∂Ä Ï°∞Í∞Å",text:"üåæS = 0ÏúºÎ°ú ÌÑ¥ÏùÑ Ï¢ÖÎ£åÌïòÎ©¥, üåæS +2, üí§ F +1",unlockFlavor:"Ïû•Î∂Ä. Î¨¥ÏóáÏùò?",onUpkeepEnd(e){(e.player.supplies??0)===0&&(e.player.supplies=(e.player.supplies??0)+2,e.player.fatigue=Math.max(0,(e.player.fatigue??0)+1),y(e,"Ïú†Î¨º[Í≤ÄÏùÄ Ïû•Î∂Ä Ï°∞Í∞Å]: S +2, F +1"))}},relic_ratskin_charm:{id:"relic_ratskin_charm",name:"Ï•êÍ∞ÄÏ£Ω Î∂ÄÏ†Å",text:"Ï∑®ÏïΩÏùÑ Î∞õÏùÑ Îïå 1 Îçú Î∞õÏäµÎãàÎã§.",unlockFlavor:"ÏÇ¥Í∞ÄÏ£Ω. ÏñáÍ≤å, ÏïÑÏ£º ÏñáÍ≤å.",tags:["EVENT_ONLY"],art:"assets/relics/relic_ratskin_charm.png"}};function eo(e,t){return(e.run?.relics??[]).includes(t)}const to=new Set(Zr.map(e=>e.id));function no(e){return to.has(e)}const ro={rest:0,eliteWins:0,tookBigHit10:!1,kills:0,endedTurnWeak:!1,eventPicks:0,hpLeq15:!1,skippedTurn:!1,bleedApplied:0};function Ce(e){e.run.relics??=[];const t=e.run;t.relicRuntime??={},t.pendingRelicActivations??=[],t.unlock??={...ro},t.relicUnlocked??={}}function Xn(e){return Ce(e),e.run.relicRuntime}function Qn(e){return Ce(e),e.run.pendingRelicActivations}function ke(e){return Ce(e),e.run.unlock}function st(e,t){const n=Xn(e);if(n[t])return n[t];const o=!Q[t]?.unlock;return n[t]={active:o,pending:!1,obtainedAtNode:e.run.nodePickCount},n[t]}function an(e,t){return!!st(e,t).active}function oo(e,t){const n=e.run;return n.forceLockedRelics?.[t]===!0?!1:!!(n.forceUnlockedRelics?.[t]===!0||n.relicUnlocked?.[t]===!0||Array.isArray(n.unlockedRelics)&&n.unlockedRelics.includes(t)||n.unlockProgress?.relics?.[t]===!0||n.unlocks?.relics?.[t]===!0)}function mt(e,t){Ce(e);const n=Q[t],r=n?.name??t,o=n?.text??"",s=n?.art,i=e.run.relicRuntime?.[t]??null,l=!!n?.unlock,c=oo(e,t),h=i?.active===!0?"ACTIVE":i?.pending===!0?"PENDING":"DORMANT",u=(()=>{const d=n?.unlockFlavor;if(!d||l&&!c)return"";const x=typeof d=="function"?d(e):d;return x?`

${x}`:""})();if(h==="ACTIVE")return{id:t,state:h,name:r,text:`${o}${u}`,art:s};if(h==="PENDING")return l&&!c?{id:t,state:h,name:r,text:`${o}

(Îã§Ïùå ÎÖ∏ÎìúÎ∂ÄÌÑ∞ ÌôúÏÑ±)`,art:s}:{id:t,state:h,name:r,text:`${o}${u}`,art:s};if(l&&!c){const d=n?.dormantName??r,x=[];n?.dormantText&&x.push(n.dormantText),n?.unlockHint&&x.push(n.unlockHint);const _=x.length?x.join(`
`):o;return{id:t,state:h,name:d,text:_,art:s}}return{id:t,state:h,name:r,text:`${o}${u}`,art:s}}function bt(e,t,n="NORMAL"){if(Ce(e),no(t)&&n!=="EVENT"){const a=Q[t];y(e,`Ïù¥ Ïú†Î¨ºÏùÄ Ïù¥Î≤§Ìä∏Î°úÎßå ÌöçÎìùÌï† Ïàò ÏûàÏäµÎãàÎã§: ${a?.name??t}`);return}e.run.relics.includes(t)||e.run.relics.push(t);const r=Q[t],o=st(e,t);if(!r?.unlock){o.active=!0,o.pending=!1,e.run.relicUnlocked[t]=!0,y(e,`Ïú†Î¨º ÌöçÎìù: ${r?.name??t}`);return}o.active=!1;const s=mt(e,t);y(e,`Ïú†Î¨º ÌöçÎìù: ${s.name}`),me(e)}function so(e,t){const n=st(e,t);if(n.active||n.pending)return;n.pending=!0;const r=Qn(e);r.includes(t)||r.push(t);const o=Q[t];y(e,`Ïú†Î¨º Ï°∞Í±¥ Îã¨ÏÑ±: ${o?.name??t} (Îã§Ïùå ÎÖ∏ÎìúÎ∂ÄÌÑ∞ ÌôúÏÑ±)`)}function me(e){Ce(e);for(const t of e.run.relics){const n=Q[t];if(!n?.unlock)continue;const r=st(e,t);r.active||r.pending||n.unlock(e)&&so(e,t)}}function ie(e){Ce(e);const t=Qn(e);if(!t.length)return;e.run.pendingRelicActivations=[];const n=Xn(e);for(const r of t){const o=n[r]??st(e,r);if(!o.pending)continue;o.pending=!1,o.active=!0,o.activatedAtNode=e.run.nodePickCount,e.run.relicUnlocked[r]=!0;const s=Q[r];s?.onActivate?.(e),y(e,`Ïú†Î¨º ÌôúÏÑ±Ìôî: ${s?.name??r}`)}}function ao(e){return Ce(e),e.run.relics??[]}function ln(e){return ao(e).filter(t=>an(e,t))}function at(e,t,...n){for(const r of ln(e)){const o=Q[r];if(!o)continue;const s=o[t];s?.(e,...n)}}function Te(e,t){let n=t.current;for(const r of ln(e)){const s=Q[r]?.modifyDamage;if(!s)continue;const a=s(e,{...t,current:n});n=Number.isFinite(a)?a:n,n<0&&(n=0)}return n}function Jn(e,t,n){for(const r of ln(e))Q[r]?.onDamageApplied?.(e,t,n)}function io(e){return e<0?0:e}function lo(e,t,n){const r=t.player.status?.vuln??0,o=n.status?.weak??0;return io(e+r-o)}function co(e,t){let n=Math.max(0,Number(t)||0);const r=[];for(const o of e){const s=Math.min(n,o);n-=s,r.push(o-s)}return r}function He(e,t){e.push(t)}function uo(e){const t=(e.dmgTotal??0)>0||(e.hits??0)>0||(e.perHit??0)>0,n=(e.applies??[]).some(o=>o.target==="player"&&["vuln","weak","bleed","disrupt","supplies","fatigue"].includes(String(o.kind))),r=(e.applies??[]).some(o=>o.target==="enemy"&&["vuln","weak","bleed","disrupt","immune"].includes(String(o.kind)));return t&&n?"ATTACK_DEBUFF":t&&r?"ATTACK_BUFF":t?"ATTACK":n?"DEBUFF":r?"BUFF":"OTHER"}function po(e,t,n){const r=t.usedThisTurn??0;return e==="goblin_raider"?{raw:Math.max(0,12-r),hits:1}:e==="watching_statue"?{raw:4+r,hits:1}:e==="gloved_hunter"?{raw:Number(t.player.block??0)>=4?12:6,hits:1}:{raw:0,hits:1}}function fo(e,t){const n=Number(t.base??0),r=Number(t.per??0),o=Math.max(1,Number(t.div??1)),s=t.cap==null?1/0:Number(t.cap),a=(e.deck?.length??0)+(e.discard?.length??0)+(e.hand?.length??0),i=Math.floor(a/o),l=n+r*i;return Math.min(s,Math.max(0,l))}function Zn(e,t,n,r={}){if(n.meta?.preview){const d=n.meta.preview(e,t);if(d)return d}const o=[],s=[],a=[];if(n.meta?.applies)for(const d of n.meta.applies)He(o,d);for(const d of n.acts)switch(d.op){case"damagePlayer":{a.push(Math.max(0,Number(d.n)||0));break}case"damagePlayerFormula":{const{raw:x,hits:_}=po(d.kind,e),f=Math.max(1,Number(_??1)||1),p=Math.max(0,Number(x)||0);for(let b=0;b<f;b++)a.push(p);break}case"statusPlayer":{He(o,{target:"player",kind:d.key,amount:d.n});break}case"supplies":{He(o,{target:"player",kind:"supplies",amount:d.n});break}case"fatiguePlayer":{He(o,{target:"player",kind:"fatigue",amount:d.n});break}case"enemyHealSelf":{He(o,{target:"enemy",kind:"heal",amount:d.n});break}case"enemyImmuneNextTurn":{He(o,{target:"enemy",kind:"immune",amount:1});break}case"damagePlayerRampHits":{const x=Math.max(1,Number(e.combatTurn??1)),_=Math.max(1,Number(d.baseHits??1)),f=Math.max(1,Number(d.everyTurns??1));let p=_+Math.floor((x-1)/f);d.capHits!=null&&(p=Math.min(p,Math.max(1,Number(d.capHits))));const b=Math.max(0,Number(d.n)||0);for(let g=0;g<p;g++)a.push(b);break}case"damagePlayerIfSuppliesPositive":{e.player.supplies>0&&a.push(Math.max(0,Number(d.n)||0));break}case"damagePlayerIfSuppliesZero":{e.player.supplies==0&&a.push(Math.max(0,Number(d.n)||0));break}case"damagePlayerByDeckSize":{a.push(fo(e,d));break}}if(!a.length){const d=Math.max(0,Number(n.meta?.hits??0)||0),x=Math.max(0,Number(n.meta?.baseDmg??0)||0);if(d>0&&x>0)for(let _=0;_<d;_++)a.push(x)}let i=a.map(d=>lo(d,e,t));r.includeBlock&&i.length&&(i=co(i,e.player.block??0));const l=i.length,c=l?i.reduce((d,x)=>d+x,0):void 0,h=l&&i.every(d=>d===i[0])?i[0]:void 0,u={cat:n.meta?.cat??"OTHER",dmgTotal:c,hits:l>0?l:n.meta?.hits,perHit:h??n.meta?.baseDmg,applies:o.length?o:void 0,notes:s.length?s:void 0};return u.cat=n.meta?.cat??uo(u),u.shortText||(u.dmgTotal!=null&&(u.hits??0)>1?u.shortText=`${u.dmgTotal} (${u.hits}ÌÉÄ)`:u.dmgTotal!=null&&(u.shortText=`${u.dmgTotal}`)),u}const ho={other_adventurer:new Set([1]),slime:new Set([0,1]),pebble_golem:new Set([1]),rock_golem:new Set([1]),poison_spider:new Set([0,2]),boss_cursed_wall:new Set([0]),boss_giant_orc:new Set([1])};function mo(e,t){const n=ho[e];return!!n&&n.has(t)}function zt(e){if(e===null)return"null";const t=typeof e;return t==="number"||t==="boolean"?String(e):t==="string"?JSON.stringify(e):Array.isArray(e)?"["+e.map(zt).join(",")+"]":t==="object"?"{"+Object.keys(e).sort().map(r=>JSON.stringify(r)+":"+zt(e[r])).join(",")+"}":JSON.stringify(String(e))}function er(e){if(!e)return"NONE";const t={};for(const n of Object.keys(e))n==="label"||n==="text"||n==="desc"||n==="name"||(t[n]=e[n]);return t.effects&&Array.isArray(t.effects)&&(t.effects=t.effects.map(n=>{const r={};for(const o of Object.keys(n??{}))o==="label"||o==="text"||o==="desc"||o==="name"||(r[o]=n[o]);return r})),zt(t)}function bo(e,t){const n=e.lastIntentKey??null,r=e.lastIntentStreak??0;n===t?e.lastIntentStreak=Math.min(3,r+1):(e.lastIntentKey=t,e.lastIntentStreak=1)}function yo(e,t,n,r,o){const s=e.length;if(s<=1)return 0;const a=Array.from({length:s},(d,x)=>x),i=d=>d===t&&mo(n,d),l=d=>!!r&&o>=2&&er(e[d])===r,c=a.filter(d=>!i(d)&&!l(d));if(c.length>0)return re(c);const h=a.filter(d=>!l(d));if(h.length>0)return re(h);const u=a.filter(d=>!i(d));return u.length>0?re(u):re(a)}const xo=2,ko=.6;function cn(e){if(e.intentsRevealedThisTurn)return;e.intentsRevealedThisTurn=!0,e.attackedEnemyIndicesThisTurn=[],e.backUidsThisTurn=[],e.drawCountThisTurn=0,e.phase="REVEAL",e.player.immuneToDisruptThisTurn=!1,e.player.nullifyDamageThisTurn=!1,e.disruptIndexThisTurn=null,e.backSlotDisabled=[!1,!1,!1],(e.player.status.disrupt??0)>0&&(e.disruptIndexThisTurn=Math.floor(Math.random()*3),e.backSlotDisabled[e.disruptIndexThisTurn]=!0);for(const n of e.enemies)n.immuneThisTurn=n.immuneNextTurn,n.immuneNextTurn=!1;for(const n of G(e)){n.intentLabelOverride=void 0;const o=e.content.enemiesById[n.id].intents;if(!o||o.length===0)continue;const s=yo(o,n.intentIndex??0,n.id,n.lastIntentKey??null,n.lastIntentStreak??0);n.intentIndex=s;const a=o[s%o.length];if(bo(n,er(a)),n.id==="boss_soul_stealer"){n.soulWillNukeThisTurn=!1;const u=n.soulWarnCount??0;if(!!n.soulArmed){if(Math.random()<ko){n.soulWillNukeThisTurn=!0,n.intentLabelOverride="Ï¢ÖÎßê: 50 ÌîºÌï¥",y(e,`Ï†Å ÏùòÎèÑ: ${n.name} ‚Üí ${n.intentLabelOverride}`);continue}const _=o[n.intentIndex%o.length];n.intentLabelOverride=`${_.label} (Ìè≠Î∞ú Í∞ÄÎä• ÏÉÅÌÉú)`,y(e,`Ï†Å ÏùòÎèÑ: ${n.name} ‚Üí ${n.intentLabelOverride}`);continue}const x=o[n.intentIndex%o.length];n.intentLabelOverride=`${x.label} (Í≤ΩÍ≥† ${u}/3)`,y(e,`Ï†Å ÏùòÎèÑ: ${n.name} ‚Üí ${n.intentLabelOverride}`);continue}const i=o[n.intentIndex%o.length],l=Zn(e,n,i);let c="";l.dmgTotal!=null?c=(l.hits??1)>1?` (${l.dmgTotal}, ${l.hits}ÌÉÄ)`:` (${l.dmgTotal})`:(l.hits??0)>1&&(c=` (${l.hits}ÌÉÄ)`);const h=`${i.label}${c}`;n.intentLabelOverride=h,y(e,`Ï†Å ÏùòÎèÑ: ${n.name} ‚Üí ${h}`)}e.disruptIndexThisTurn!==null&&y(e,`ÍµêÎûÄ: Ïù¥Î≤à ÌÑ¥ ÌõÑÏó¥ ${e.disruptIndexThisTurn} Î¨¥Ìö®`),at(e,"onReveal"),e.phase="PLACE"}const To=xo;function It(e,t,n){const r=e.game,o={kind:"damageSelect",amount:t,formulaKind:n,sourceCardUid:e.cardUid,reason:e.side==="front"?"FRONT":"BACK"};r.pendingTargetQueue??=[],r.pendingTarget==null?r.pendingTarget=o:r.pendingTargetQueue.push(o),y(r,`ÎåÄÏÉÅ ÏÑ†ÌÉù ÌïÑÏöî: Ï†ÅÏùÑ ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî. (${1+r.pendingTargetQueue.length}Í∞ú ÎÇ®Ïùå)`)}function go(e,t,n){const r=e.game,o={kind:"statusSelect",key:t,n,sourceCardUid:e.cardUid,reason:e.side==="front"?"FRONT":"BACK"};r.pendingTargetQueue??=[],r.pendingTarget==null?r.pendingTarget=o:r.pendingTargetQueue.push(o),y(r,"ÎåÄÏÉÅ ÏÑ†ÌÉù ÌïÑÏöî: Ï†ÅÏùÑ ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî.")}function Eo(e,t){if(t.id==="boss_soul_stealer"&&t.soulWillNukeThisTurn)return!0;const n=e.content.enemiesById[t.id];return n.intents[t.intentIndex%n.intents.length].acts.some(o=>o.op==="damagePlayer"||o.op==="damagePlayerFormula"||o.op==="damagePlayerByDeckSize")}function Co(e,t){switch(t){case"prey_mark":return 7;case"prey_mark_u1":return 9;case"triple_bounty":return 8;case"triple_bounty_u1":return 10;default:return 0}}function _n(e,t,n,r){switch(t){case"prey_mark":return n.hp>e.player.hp?r+5:r;case"prey_mark_u1":return n.hp>e.player.hp?r+6:r;case"triple_bounty":return G(e).length>=3?r+8:r;case"triple_bounty_u1":return G(e).length>=3?r+10:r;default:return r}}function et(e,t){const n=e.game;for(const r of t)switch(r.op){case"block":ns(n,r.n);break;case"supplies":rs(n,r.n);break;case"fatigue":Ae(n,r.n);break;case"heal":tt(n,r.n);break;case"hp":n.player.hp=Math.max(0,Math.min(n.player.maxHp,n.player.hp+r.n)),y(n,`HP ${r.n>=0?"+":""}${r.n} (ÌòÑÏû¨ ${n.player.hp}/${n.player.maxHp})`);break;case"maxHp":n.player.maxHp+=r.n,n.player.hp=Math.min(n.player.maxHp,n.player.hp+r.n),y(n,`ÏµúÎåÄ HP +${r.n} (ÌòÑÏû¨ ${n.player.hp}/${n.player.maxHp})`);break;case"setSupplies":n.player.supplies=Math.max(0,r.n),y(n,`Î≥¥Í∏â SÎ•º ${n.player.supplies}ÏúºÎ°ú ÏÑ§Ï†ï`);break;case"draw":{const o=xt(n,r.n);n.drawCountThisTurn+=o;break}case"ifDrewThisTurn":{n.drawCountThisTurn>0&&et(e,r.then);break}case"damageEnemy":if(r.target==="random"){const o=G(n);if(o.length===0)break;_e(n,re(o),r.n)}else if(r.target==="all")for(const o of G(n))_e(n,o,r.n);else It(e,r.n);break;case"clearStatusSelf":{const o=r.key;n.player.status[o]=0,y(n,`ÏÉÅÌÉú Ìï¥Ï†ú: ${o} = 0`);break}case"damageEnemyBy":{if(r.target!=="random")break;const o=G(n);if(o.length===0)break;let s=0;r.by==="frontCount"&&(s=n.frontSlots.filter(Boolean).length*r.nPer),_e(n,re(o),s);break}case"damageEnemyByPlayerFatigue":{const o=Math.max(0,Math.floor(n.player.fatigue*r.mult));if(r.target==="random"){const s=G(n);if(s.length===0)break;_e(n,re(s),o);break}if(r.target==="select"){if(o<=0)break;It(e,o);break}break}case"damageEnemyFormula":{const o=Co(e,r.kind);if(o<=0)break;if(r.target==="select"){It(e,o,r.kind);break}if(r.target==="random"){const s=G(n);if(s.length===0)break;const a=re(s),i=_n(n,r.kind,a,o);_e(n,a,i);break}if(r.target==="all"){for(const s of G(n)){const a=_n(n,r.kind,s,o);_e(n,s,a)}break}break}case"statusPlayer":n.player.status[r.key]=Math.max(0,(n.player.status[r.key]??0)+r.n),y(n,`ÌîåÎ†àÏù¥Ïñ¥ ÏÉÅÌÉú: ${r.key} ${r.n>=0?"+":""}${r.n}`);break;case"statusEnemy":if(r.target==="random"){const o=G(n);if(o.length===0)break;const s=re(o);if(Ze(s,r.key,r.n,n,"PLAYER"),y(n,`Ï†Å(${s.name}) ÏÉÅÌÉú: ${r.key} ${r.n>=0?"+":""}${r.n}`),r.key==="bleed"&&r.n>0){const a=ke(n);a.bleedApplied+=1,me(n)}}else if(r.target==="all"){const o=G(n);if(o.length===0)break;for(const s of o)Ze(s,r.key,r.n,n,"PLAYER");if(y(n,`Î™®Îì† Ï†Å ÏÉÅÌÉú: ${r.key} ${r.n>=0?"+":""}${r.n}`),r.key==="bleed"&&r.n>0){const s=ke(n);s.bleedApplied+=o.length,me(n)}}else go(e,r.key,r.n);break;case"statusEnemiesAttackingThisTurn":{const o=G(n).filter(s=>Eo(n,s));if(o.length===0){y(n,`Ïù¥Î≤à ÌÑ¥ Í≥µÍ≤© ÏùòÎèÑ Ï†Å ÏóÜÏùå ‚Üí ${r.key} Ï†ÅÏö© ÏóÜÏùå`);break}for(const s of o)s.status[r.key]=Math.max(0,(s.status[r.key]??0)+r.n);y(n,`Í≥µÍ≤© ÏùòÎèÑ Ï†ÅÏóêÍ≤å ${r.key} ${r.n>=0?"+":""}${r.n} (ÎåÄÏÉÅ ${o.length})`);break}case"immuneDisruptThisTurn":n.player.immuneToDisruptThisTurn=!0,y(n,"Ïù¥Î≤à ÌÑ¥ ÍµêÎûÄ Î¨¥Ïãú");break;case"nullifyDamageThisTurn":n.player.nullifyDamageThisTurn=!0,y(n,"Ïù¥Î≤à ÌÑ¥ Ï†Å Í≥µÍ≤© ÌîºÌï¥ Î¨¥Ìö®");break;case"triggerFrontOfBackSlot":{const o=n.backSlots[r.index];if(!o){y(n,`Ïû¨Î∞∞Ïπò: ÌõÑÏó¥ ${r.index+1}Î≤à Ïä¨Î°ØÏù¥ ÎπÑÏñ¥ ÏûàÏùå`);break}const s=ge(n,o);y(n,`Ïû¨Î∞∞Ïπò: [[${De(n,o)}]]Ïùò Ï†ÑÏó¥ Ìö®Í≥ºÎ•º Ï∂îÍ∞Ä Î∞úÎèô`),et({game:n,side:"front",cardUid:o},s.front);break}default:return r}}function vo(e){if(e.run.treasureObtained)return;e.run.treasureObtained=!0,e.run.afterTreasureNodePicks=0,e.run.deckSizeAtTreasure=lr(e);const t=or(e);e.cards[t]={uid:t,defId:"goal_treasure",zone:"deck",upgrade:0},e.deck.push(t),e.deck=sn(e.deck),y(e,"Ï†ÄÏ£ºÎ∞õÏùÄ Î≥¥Î¨ºÏùÑ ÌöçÎìùÌñàÏäµÎãàÎã§! Îç±Ïóê [Ï†ÄÏ£ºÎ∞õÏùÄ Î≥¥Î¨º] Ï∂îÍ∞Ä"),wo(e),y(e,"Î≥¥Î¨ºÏù¥ Ïö∏Î∂ÄÏßñÏûê, ÎçòÏ†ÑÏùò Î™®Îì† Î∞©Ïù¥ Îã§Ïãú Ï±ÑÏõåÏßëÎãàÎã§...")}function wo(e){const t=e.run?.map;if(!t||!t.nodes)return;const n=t.startId,r=t.treasureId,o=Object.keys(t.nodes);for(const s of o){if(s===n||s===r)continue;const a=t.nodes[s];if(!a)continue;a.cleared=!1,delete a.noRespawn,delete a.lastClearedMove,a.reprocCount=Number(a.reprocCount??0)+1;const i=Number(a.depth??0);if(a.kind==="ELITE"||a.kind==="START"||a.kind==="TREASURE")continue;const l=Math.min(.88,.72+i*.01),c=.18,h=Math.random();a.kind=h<l?"BATTLE":h<l+c?"EVENT":"REST"}}const So=["arrow","shield","scout","field_ration"],Qe=[{id:"mad_echo",weight:12},{id:"mad_insight",weight:12},{id:"mad_bargain",weight:3}],qe=[{id:"berserk",weight:20},{id:"bandage",weight:12},{id:"arrow_rain",weight:20},{id:"smoke",weight:0},{id:"redeploy",weight:12},{id:"secret_strike",weight:3},{id:"fire_scroll",weight:3},{id:"caltrops",weight:12},{id:"emergency_rations",weight:3},{id:"painkiller",weight:12},{id:"field_experience",weight:3},{id:"camp_prep",weight:20},{id:"vital_shot",weight:12},{id:"taunt",weight:12},{id:"rapid_fire",weight:20},{id:"blood_contract",weight:20},{id:"cloth_scrap_armor",weight:12},{id:"prey_mark",weight:12},{id:"brawl_cleaver",weight:20}];function ct(e,t,n){const r=n?nr(t,n):tr(t);return{defId:jt(r),upgrade:t===Qe?0:qt(e)}}function dt(e,t,n){const r=n?nr(t,n):tr(t),o=jt(r),s=r.filter(h=>h.id!==o),a=jt(s),i=t===Qe,l=i?0:qt(e),c=i?0:qt(e);return[{defId:o,upgrade:l},{defId:a,upgrade:c}]}function _o(e){const{tier:t}=Yn(e);return Math.random()<(t===0?0:t===1?.15:t===2?.35:.6)}function tr(e){const t=new Map;for(const n of e){const r=Math.max(0,n.weight??0);r<=0||t.set(n.id,(t.get(n.id)??0)+r)}return[...t.entries()].map(([n,r])=>({id:n,w:r}))}function nr(e,t={}){const n=t.mult3??1,r=t.mult12??1,o=t.mult20??1,s=new Map;for(const a of e){const i=Math.max(0,a.weight??0);if(i<=0||i===3&&t.drop3||i===12&&t.drop12||i===20&&t.drop20)continue;let l=null;i===3?l=i*n:i===12?l=i*r:i===20?l=i*o:l=i,!(l<=0)&&s.set(a.id,(s.get(a.id)??0)+l)}return[...s.entries()].map(([a,i])=>({id:a,w:i}))}function jt(e){let t=0;for(const r of e)t+=r.w;if(t<=0)throw new Error("No positive weights to pick from.");let n=Math.random()*t;for(const r of e)if(n-=r.w,n<=0)return r.id;return e[e.length-1].id}function qt(e){const t=e?.player?.fatigue??0;if((e?.run.nodePickCount??999)<=6)return 0;const r=.1,o=t>=12?0:t>=9?.25:t>=6?.5:1;return Math.random()<r*o?1:0}function rr(e){const t=e.player?.fatigue??0,n={defId:re(So),upgrade:0},r=()=>t<=3?dt(e,qe):t<=6?dt(e,qe,{mult3:.25,mult12:.75,mult20:1}):t<=8?dt(e,qe,{mult3:.1,mult12:.55,mult20:1}):dt(e,qe,{drop3:!0,mult12:.45,mult20:1}),o=i=>_o(e)?ct(e,Qe):i;if(t<=8){if(t<=6){const[h,u]=r();return[o(h),o(u)]}const i=t===7?.3:.55;if(Math.random()<i){const[h]=r(),u=o(h);return Math.random()<.5?[n,u]:[u,n]}const[l,c]=r();return[o(l),o(c)]}if(t<=11){const i=o(ct(e,qe,{drop3:!0,mult12:.45,mult20:1}));return Math.random()<.5?[n,i]:[i,n]}const s=ct(e,Qe),a=Math.random()<.65?ct(e,Qe):n;return Math.random()<.5?[s,a]:[a,s]}function $o(e){const t=rr(e),n=t[0]??{defId:"arrow",upgrade:0},r=t[1]??{defId:"shield",upgrade:0};return[n,r]}function or(e){return e.uidSeq+=1,`c_${e.uidSeq}`}function dn(e,t,n){const r=or(e);e.cards[r]={uid:r,defId:t,zone:"deck",upgrade:n?.upgrade??0},e.deck.push(r)}function Mo(e){const t=Object.values(e.cards).filter(r=>r.zone==="deck"||r.zone==="hand"||r.zone==="discard");if(t.length===0)return;const n=re(t);e.cards[n.uid].zone="vanished",e.vanished.push(n.uid),e.deck=e.deck.filter(r=>r!==n.uid),e.hand=e.hand.filter(r=>r!==n.uid),e.discard=e.discard.filter(r=>r!==n.uid),y(e,`Ïπ¥Îìú Ï†úÍ±∞: [${ge(e,n.uid).name} +${e.cards[n.uid].upgrade??0}]`)}const No="goal_treasure";function _t(e,t){const n=e.cards[t];return n?n.defId===No?(y(e,"Ï†ÄÏ£ºÎ∞õÏùÄ Î≥¥Î¨ºÏùÄ Îç±ÏóêÏÑú Ï†úÍ±∞Ìï† Ïàò ÏóÜÏäµÎãàÎã§."),!1):(e.deck=e.deck.filter(r=>r!==t),e.hand=e.hand.filter(r=>r!==t),e.discard=e.discard.filter(r=>r!==t),e.frontSlots=e.frontSlots.map(r=>r===t?null:r),e.backSlots=e.backSlots.map(r=>r===t?null:r),n.zone="vanished",e.vanished.push(t),y(e,`Ïπ¥Îìú Ï†úÍ±∞: [${ge(e,n.uid).name} +${e.cards[n.uid].upgrade??0}]`),!0):!1}function $t(e,t){const n=e.cards[t];if(!n)return!1;const o=e.content.cardsById[n.defId].upgrades?.length??0;return(n.upgrade??0)<o}function sr(e,t){return $t(e,t)?(e.cards[t].upgrade=(e.cards[t].upgrade??0)+1,!0):!1}function un(e,t,n=null){if(e.choiceQueue??=[],!e.choice){e.choice=t,e.choiceCtx=n;return}e.choiceQueue.push({choice:t,ctx:n})}function yt(e,t,n=null){e.choiceQueue=[],e.choice=t,e.choiceCtx=n}function ar(e){e.choice=null,e.choiceCtx=null}function pe(e){e.choiceQueue=[],ar(e),e.phase==="NODE"&&ie(e)}function Se(e){const t=e.choiceQueue??[];if(t.length>0){const n=t.shift()??null;if(n){e.choice=n.choice,e.choiceCtx=n.ctx,e.choiceQueue=t;return}}ar(e),e.phase==="NODE"&&ie(e)}function Po(e){const t=new Set(e.run.relics??[]);return Object.keys(Q).filter(n=>{const r=Q[n];return!(!r||r.debugOnly||t.has(n))})}function ir(e,t=1){const n=Po(e);if(n.length===0)return null;const r=[],o=n.slice(),s=Math.min(t,o.length);for(let a=0;a<s;a++){const i=re(o),l=o.indexOf(i);l>=0&&o.splice(l,1);const c=Q[i]??{};r.push({id:i,name:c.name??String(i),desc:c.desc??c.description??c.text,art:c.art})}return{choices:r}}function Ao(e){const t=$o(e);if(!t)return;const[n,r]=t,o=he(e.content,n.defId,n.upgrade),s=he(e.content,r.defId,r.upgrade),a=`${o.name}${n.upgrade>0?` +${n.upgrade}`:""}`,i=`${s.name}${r.upgrade>0?` +${r.upgrade}`:""}`,l={kind:"REWARD",title:"Ï†ÑÌà¨ Î≥¥ÏÉÅ",prompt:"Ïπ¥Îìú 1Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÍ±∞ÎÇò ÏÉùÎûµÌï©ÎãàÎã§.",options:[{key:`pick:${n.defId}:${n.upgrade}`,label:a,detail:`Ï†ÑÏó¥: ${o.frontText} / ÌõÑÏó¥: ${o.backText}`},{key:`pick:${r.defId}:${r.upgrade}`,label:i,detail:`Ï†ÑÏó¥: ${s.frontText} / ÌõÑÏó¥: ${s.backText}`},{key:"skip",label:"ÏÉùÎûµ",detail:""}]};un(e,l,{kind:"BATTLE_CARD_REWARD",offers:[n,r]})}function Ro(e){if(!e.run.lastBattleWasElite||e.run.eliteRelicOfferedThisBattle)return;const t=ir(e,1);if(!t)return;e.run.eliteRelicOfferedThisBattle=!0;const n=t.choices[0];if(!n)return;const r=n.id,o=Q[r],s=!!o?.unlock,a=s?o?.dormantName??o?.name??r:o?.name??r,i=s?[o?.dormantText,o?.unlockHint].filter(Boolean).join(`
`):o?.text??"",c={kind:"REWARD",title:"Ï†ïÏòà Î≥¥ÏÉÅ: Ïú†Î¨º",prompt:"Ïú†Î¨ºÏùÑ Î∞õÍ±∞ÎÇò ÏÉùÎûµÌï©ÎãàÎã§.",options:[{key:"take",label:"Î∞õÍ∏∞",detail:`${a}

${i}`},{key:"skip",label:"ÏÉùÎûµ",detail:""}]};c.art=o?.art??void 0,un(e,c,{kind:"ELITE_RELIC",offerIds:[r]})}function Io(e,t){if(!e.choice)return!1;if(t==="take"){if(e.choiceCtx?.kind!=="ELITE_RELIC")return!1;const r=e.choiceCtx.offerIds?.[0];return r?(e.run.relics??=[],e.run.relics.includes(r)||bt(e,r),y(e,`Ïú†Î¨º ÌöçÎìù: ${Q[r]?.name??r}`),Se(e),!0):!1}if(t==="skip")return y(e,"Î≥¥ÏÉÅÏùÑ ÏÉùÎûµÌñàÏäµÎãàÎã§."),Se(e),!0;if(t.startsWith("pick:")){const r=t.split(":"),o=r[1]??"",s=Number(r[2]??0);return o?(dn(e,o,{upgrade:Number.isFinite(s)?s:0}),y(e,`Ïπ¥Îìú ÌöçÎìù: ${o}${s>0?` +${s}`:""}`),Se(e),!0):!1}if(t.startsWith("up:")){const r=t.slice(3);if(!r)return!1;const o=e.cards[r];if(!o)return!1;const a=e.content.cardsById[o.defId]?.upgrades??[],i=o.upgrade??0;if(i>=a.length)return y(e,"Ïù¥ÎØ∏ ÏµúÎåÄ Í∞ïÌôîÏûÖÎãàÎã§."),Se(e),!0;o.upgrade=i+1;const l=he(e.content,o.defId,o.upgrade);return y(e,`Ïπ¥Îìú Í∞ïÌôî: ${l.name} +${o.upgrade}`),Se(e),!0}if(t.startsWith("remove:")){const r=t.slice(7);return!r||!_t(e,r)?!1:(Se(e),!0)}if(t.startsWith("relic:")){const r=t.slice(6);if(!r)return!1;const o=e.choiceCtx?.offerIds;return o&&o.length>0&&!o.includes(r)?!1:(e.run.relics??=[],e.run.relics.includes(r)||bt(e,r),y(e,`Ïú†Î¨º ÌöçÎìù: ${Q[r]?.name??r}`),Se(e),!0)}return!1}function Lo(e,t){const n=ir(e,t.count);if(!n||n.choices.length===0)return null;const r=n.choices.map(a=>a.id),o=n.choices.map(a=>{const i=Q[a.id],l=!!i?.unlock,c=l?i?.dormantName??i?.name??a.id:i?.name??a.id,h=l?[i?.dormantText,i?.unlockHint].filter(Boolean).join(`
`):i?.text??"";return{key:`relic:${a.id}`,label:c,detail:`${c}

${h}`}}),s={kind:"REWARD",title:t.title,prompt:t.prompt,options:o};return un(e,s,{kind:"RELIC_OFFER",offerIds:r,source:t.source}),r}function Ho(e){return Lo(e,{count:3,title:"Î≥¥Ïä§ Î≥¥ÏÉÅ: Ïú†Î¨º",prompt:"Ïú†Î¨º 1Í∞úÎ•º ÏÑ†ÌÉùÌï©ÎãàÎã§.",source:"BOSS"})}function Oo(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}function Do(e){const t=[];for(const s of e.deck)t.push(s);for(const s of e.hand)t.push(s);for(const s of e.discard)t.push(s);for(const s of e.frontSlots)s&&t.push(s);for(const s of e.backSlots)s&&t.push(s);for(const s of e.exhausted)t.push(s);const n=new Set,o=t.filter(s=>n.has(s)?!1:(n.add(s),!0)).filter(s=>e.cards[s]?.zone!=="vanished");e.deck=o;for(const s of o)e.cards[s].zone="deck";e.hand=[],e.discard=[],e.frontSlots=[null,null,null],e.backSlots=[null,null,null],e.selectedHandCardUid=null,e.exhausted=[],e.pendingTarget=null,e.pendingTargetQueue=[],Oo(e.deck)}function Bo(e){if(!e.winHooksAppliedThisCombat){e.winHooksAppliedThisCombat=!0;for(const t of e.backUidsThisTurn){if(!e.cards[t])continue;const o=ge(e,t).onWinWhileInBack;!o||o.length===0||et({game:e,side:"back",cardUid:t},o)}}}function Fo(e){const t=e.run.deckSizeAtTreasure??null;return t==null?10:Xr(t)}function Ke(e){if(e.player.hp<=0){An(e),e.run.finished=!0,y(e,"Ìå®Î∞∞: Ï£ΩÏóàÏäµÎãàÎã§.");return}if(!e.victoryResolvedThisCombat&&G(e).length===0&&e.phase!=="NODE"){e.victoryResolvedThisCombat=!0;const t=e.enemies.some(n=>String(n.id).startsWith("boss_"));An(e),Bo(e),y(e,"Ï†ÅÏùÑ Î™®Îëê Ï≤òÏπò!");{const n=e.run.map;n&&n.nodes&&n.pos&&n.nodes[n.pos]&&(n.nodes[n.pos].cleared=!0,n.nodes[n.pos].visited=!0)}if(e.run.lastBattleWasElite){const n=ke(e);n.eliteWins+=1,me(e)}Do(e),e.enemies=[],e.player.zeroSupplyTurns=0;{const n=e.run,r=n.pendingEventWinRelicId;r&&(n.pendingEventWinRelicId=null,bt(e,r,"EVENT"))}if(at(e,"onVictory"),t&&(e.run.ominousProphecyLockedUntilBossKill=!1,e.run.ominousProphecySeen=!1,e.player.hp=e.player.maxHp,y(e,"Î≥¥Ïä§ Í≤©Ìåå! Ï≤¥Î†•Ïù¥ ÏôÑÏ†ÑÌûà ÌöåÎ≥µÎêòÏóàÏäµÎãàÎã§."),Ho(e)),Ro(e),Ao(e),e.phase="NODE",e.run.treasureObtained){const n=Fo(e);if(e.run.afterTreasureNodePicks>=n){e.run.finished=!0,y(e,`ÏäπÎ¶¨! Ï†ÄÏ£ºÎ∞õÏùÄ Î≥¥Î¨ºÏùÑ ÏñªÏùÄ ÌõÑ ${n}Î≤àÏùò ÌÉêÌóò ÎèôÏïà ÏÇ¥ÏïÑÎÇ®ÏïòÏäµÎãàÎã§.`);return}}return}}function lr(e){return e.deck.length+e.hand.length+e.discard.length+e.frontSlots.filter(Boolean).length+e.backSlots.filter(Boolean).length+e.exhausted.length}function Ve(e){e.combatTurn=1,e.time=(e.time??0)+1,y(e,"Ï†ÑÌà¨: ÏãúÍ∞Ñ +1"),e.player.block=0,e.player.status.vuln=0,e.player.status.weak=0,e.player.status.bleed=0,e.player.status.disrupt=0,e.player.zeroSupplyTurns=0,e.phase="REVEAL",e.frontSlots=[null,null,null],e.backSlots=[null,null,null],e.backSlotDisabled=[!1,!1,!1],e.backUidsThisTurn=[],e.hand=[],e.selectedHandCardUid=null,e.pendingTarget=null,e.pendingTargetQueue=[],e.usedThisTurn=0,e.frontPlacedThisTurn=0,e.winHooksAppliedThisCombat=!1,e.victoryResolvedThisCombat=!1,e.run.eliteRelicOfferedThisBattle=!1;const t=e.run.nextBattleSuppliesBonus??0;e.player.supplies=7+t,t!==0&&(y(e,`Îã§Ïùå Ï†ÑÌà¨ S Î≥ÄÎèô: ${t}`),e.run.nextBattleSuppliesBonus=0),e.player.immuneToDisruptThisTurn=!1,e.player.nullifyDamageThisTurn=!1,e.intentsRevealedThisTurn=!1,e.disruptIndexThisTurn=null,e.drawCountThisTurn=0,e.attackedEnemyIndicesThisTurn=[],xt(e,4),cn(e),e.phase="PLACE",at(e,"onCombatStart");{const n=Number(e._combatStartExtraDraw??0);e._combatStartExtraDraw=0,n>0&&xt(e,n)}}function $n(e,t,n,r){if(e.phase!=="PLACE"||!e.hand.includes(t))return;n==="back"&&(e.backUidsThisTurn.includes(t)||e.backUidsThisTurn.push(t));const o=n==="front"?e.frontSlots:e.backSlots;o[r]||(e.hand=e.hand.filter(s=>s!==t),o[r]=t,e.cards[t].zone=n,e.usedThisTurn+=1,n==="front"&&(e.frontPlacedThisTurn+=1),y(e,`[${De(e,t)}]Î•º ${n==="front"?"Ï†ÑÏó¥":"ÌõÑÏó¥"} ${r}Î≤àÏóê Î∞∞Ïπò`),at(e,"onPlaceCard",{side:n,idx:r,cardUid:t}))}function Mn(e,t,n){return ge(e,t).tags?.includes(n)??!1}function Wo(e,t){e.frontSlots=e.frontSlots.map(n=>n===t?null:n),e.backSlots=e.backSlots.map(n=>n===t?null:n)}function Nn(e,t,n){const r=ge(e,t);Wo(e,t),e.hand=e.hand.filter(l=>l!==t),e.deck=e.deck.filter(l=>l!==t),e.discard=e.discard.filter(l=>l!==t);const o=r.vanishWhen,s=r.exhaustWhen,a=o==="BOTH"||o==="FRONT"&&n==="front"||o==="BACK"&&n==="back",i=s==="BOTH"||s==="FRONT"&&n==="front"||s==="BACK"&&n==="back";if(o&&o!=="NONE"&&a){e.vanished.push(t),e.cards[t].zone="vanished",y(e,`[${De(e,t)}] ÏÜåÏã§(ÏòÅÍµ¨ Ï†úÍ±∞)`);return}if(s&&s!=="NONE"&&i){e.exhausted.push(t),e.cards[t].zone="exhausted",y(e,`[${De(e,t)}] ÏÜåÎ™®(Ïù¥Î≤à Ï†ÑÌà¨ÏóêÏÑú Ï†úÍ±∞)`);return}if(!o&&Mn(e,t,"VANISH")){e.vanished.push(t),e.cards[t].zone="vanished",y(e,`[${De(e,t)}] ÏÜåÏã§(ÏòÅÍµ¨ Ï†úÍ±∞)`);return}if(!s&&Mn(e,t,"EXHAUST")){e.exhausted.push(t),e.cards[t].zone="exhausted",y(e,`[${De(e,t)}] ÏÜåÎ™®(Ïù¥Î≤à Ï†ÑÌà¨ÏóêÏÑú Ï†úÍ±∞)`);return}e.discard.push(t),e.cards[t].zone="discard"}function Uo(e){for(let t=0;t<3;t++){const n=e.frontSlots[t];n&&Nn(e,n,"front"),e.frontSlots[t]=null;const r=e.backSlots[t];r&&Nn(e,r,"back"),e.backSlots[t]=null}}function Ko(e){if(!(e.phase!=="PLACE"&&e.phase!=="BACK")){e.phase="BACK",y(e,"=== ÌõÑÏó¥ Îã®Í≥Ñ ===");for(let t=0;t<3;t++){const n=e.backSlots[t];if(!n)continue;const r=ge(e,n);if(!e.player.immuneToDisruptThisTurn&&e.backSlotDisabled[t]){y(e,`ÌõÑÏó¥ ${t}Î≤à [${r.name}] ÍµêÎûÄÏúºÎ°ú Î¨¥Ìö®`);continue}et({game:e,side:"back",cardUid:n},r.back)}e.phase="FRONT"}}function zo(e){if(e.phase==="FRONT"){y(e,"=== Ï†ÑÏó¥ Îã®Í≥Ñ ===");for(let t=0;t<3;t++){const n=e.frontSlots[t];if(!n)continue;const r=ge(e,n);et({game:e,side:"front",cardUid:n},r.front)}e.phase="ENEMY"}}const jo=.6;function qo(e){if(e.phase==="ENEMY"){y(e,"=== Ï†Å ÌñâÎèô ===");for(const t of G(e)){const n=e.content.enemiesById[t.id],r=n.intents[t.intentIndex%n.intents.length];if(t.id==="boss_soul_stealer"){if(t.soulWillNukeThisTurn){const o=t.status.weak??0;ue(e,50,"ENEMY_ATTACK","ÏòÅÌòº Í∞ïÌÉàÏûê",o),y(e,"ÏòÅÌòº Í∞ïÌÉàÏûê: ÏòÅÌòº Ìè≠Î∞ú ‚Üí 50 ÌîºÌï¥!"),t.soulWillNukeThisTurn=!1,t.soulArmed=!1,t.soulWarnCount=0;continue}for(const o of r.acts)Pn(e,t,o);t.intentIndex===To&&(t.soulWarnCount=(t.soulWarnCount??0)+1,y(e,`ÏòÅÌòº Í∞ïÌÉàÏûê: Í≤ΩÍ≥† +1 (${t.soulWarnCount}/3)`),(t.soulWarnCount??0)>=3&&(t.soulArmed=!0,y(e,"ÏòÅÌòº Í∞ïÌÉàÏûê: Í≤ΩÍ≥† 3Ìöå ÏôÑÎ£å ‚Üí Ìè≠Î∞ú Í∞ÄÎä• ÏÉÅÌÉú!"),Math.random()<jo&&(t.soulWillNukeThisTurn=!0)));continue}for(const o of r.acts)Pn(e,t,o)}e.phase="UPKEEP"}}function Vo(e){return e.deck.length+e.hand.length+e.discard.length+e.frontSlots.filter(Boolean).length+e.backSlots.filter(Boolean).length+e.exhausted.length}function Yo(e,t){const n=Math.ceil(t/e.div);let r=e.base+e.per*n;return e.cap!=null&&(r=Math.min(r,e.cap)),{dmg:r,scale:n}}function Pn(e,t,n){switch(n.op){case"damagePlayer":{const r=t.status.weak??0;ue(e,n.n,"ENEMY_ATTACK",t.name,r);return}case"damagePlayerFormula":{if(n.kind==="goblin_raider"){const r=Math.max(0,12-e.usedThisTurn),o=t.status.weak??0;ue(e,r,"ENEMY_ATTACK",t.name,o)}else if(n.kind==="gloved_hunter"){const o=(e.player.block??0)>=4?12:6,s=t.status.weak??0;ue(e,o,"ENEMY_ATTACK",t.name,s)}else{const r=4+e.usedThisTurn,o=t.status.weak??0;ue(e,r,"ENEMY_ATTACK",t.name,o)}return}case"supplies":{e.player.supplies=on(e.player.supplies+n.n,0),y(e,`Ï†Å Ìö®Í≥º: Î≥¥Í∏â S ${n.n>=0?"+":""}${n.n} (ÌòÑÏû¨ ${e.player.supplies})`);return}case"statusPlayer":{let r=n.n;n.key==="vuln"&&r>0&&an(e,"relic_ratskin_charm")&&(r=Math.max(0,r-1)),Ze(e.player,n.key,r,e,"ENEMY"),y(e,`Ï†Å Ìö®Í≥º: ÌîåÎ†àÏù¥Ïñ¥ ÏÉÅÌÉú ${n.key} ${r>=0?"+":""}${r}`);return}case"enemyHealSelf":{t.hp=Math.min(t.maxHp,t.hp+n.n),y(e,`Ï†Å(${t.name})Ïù¥(Í∞Ä) ${n.n} ÌöåÎ≥µ (HP ${t.hp}/${t.maxHp})`);return}case"enemyImmuneThisTurn":{t.immuneThisTurn=!0,y(e,`Ï†Å(${t.name})Ïù¥(Í∞Ä) ÌîºÌï¥ Î©¥Ïó≠ ÏÉÅÌÉúÍ∞Ä Îê®`);return}case"enemyImmuneNextTurn":{t.immuneNextTurn=!0,y(e,`Ï†Å(${t.name})Ïù¥(Í∞Ä) Îã§Ïùå ÌÑ¥ ÌîºÌï¥ Î©¥Ïó≠ ÏÉÅÌÉúÍ∞Ä Îê®`);return}case"fatiguePlayer":{e.player.fatigue=Math.max(0,e.player.fatigue+n.n),y(e,`Ï†Å Ìö®Í≥º: ÌîºÎ°ú F ${n.n>=0?"+":""}${n.n} (ÌòÑÏû¨ ${e.player.fatigue})`);return}case"damagePlayerByDeckSize":{const r=Vo(e),{dmg:o,scale:s}=Yo(n,r),a=t.status.weak??0;ue(e,o,"ENEMY_ATTACK",t.name,a),y(e,`Ï§ëÎ†• ÌîºÌï¥: base ${n.base} + per ${n.per} * ceil(${r}/${n.div})=${s} => ${o}`);return}case"damagePlayerRampHits":{const r=Math.max(1,Number(e.combatTurn??1)),o=Math.max(1,Number(n.baseHits??1)),s=Math.max(1,Number(n.everyTurns??1));let a=o+Math.floor((r-1)/s);n.capHits!=null&&(a=Math.min(a,Math.max(1,Number(n.capHits))));const i=t.status.weak??0,l=`${t.name} (${a}ÌÉÄ)`;for(let c=0;c<a;c++)ue(e,n.n,"ENEMY_ATTACK",l,i);return}case"damagePlayerIfSuppliesPositive":{if((e.player.supplies??0)>0){const o=t.status.weak??0;ue(e,n.n,"ENEMY_ATTACK",t.name,o)}else y(e,"ÎçÆÏπòÍ∏∞: S = 0 ‚Üí ÌîºÌï¥ ÏóÜÏùå");break}case"damagePlayerIfSuppliesZero":{const r=e.player.supplies??0;if(r===0){const o=t.status.weak??0;ue(e,n.n,"ENEMY_ATTACK",t.name,o)}else y(e,`ÏïïÎ•ò: S = ${r} ‚Üí ÌîºÌï¥ ÏóÜÏùå`);break}default:return n}}function Go(e){if(e.phase!=="UPKEEP")return;y(e,"=== Ïú†ÏßÄÎπÑ / ÏÉÅÌÉú Ï≤òÎ¶¨ ===");{const o=ke(e);let s=!1;(e.player.status.weak??0)>0&&!o.endedTurnWeak&&(o.endedTurnWeak=!0,s=!0),(e.usedThisTurn??0)===0&&(e.frontPlacedThisTurn??0)===0&&(e.backUidsThisTurn?.length??0)===0&&!o.skippedTurn&&(o.skippedTurn=!0,s=!0),s&&me(e)}const t=e.frontPlacedThisTurn;t>0&&y(e,`Ï†ÑÏó¥ Ïú†ÏßÄÎπÑ Ï≤òÎ¶¨: Ï†ÑÏó¥ ${t}Ïû•`);let n=!1;for(let o=0;o<t;o++)e.player.supplies>0?e.player.supplies-=1:n=!0;if(n&&(e.player.fatigue+=1,y(e,"Ï†ÑÏó¥ Ïú†ÏßÄÎπÑ Î∂ÄÏ°±! (F +1)")),e.player.supplies===0){e.player.zeroSupplyTurns+=1;const o=e.player.fatigue;ue(e,o,"ZERO_SUPPLY",`Î≥¥Í∏â ÏóÜÏù¥ ÌÑ¥ Ï¢ÖÎ£å! ÌîºÌï¥ ${o}`)}const r=e.player.status.bleed??0;r>0&&ue(e,r,"BLEED","Ï∂úÌòà");for(const o of G(e)){const s=o.status.bleed??0;s>0&&(o.immuneThisTurn?y(e,`Ï†Å(${o.name})ÏùÄ(Îäî) Ïù¥Î≤à ÌÑ¥ Î©¥Ïó≠Ïù¥Îùº Ï∂úÌòà ÌîºÌï¥ Î¨¥Ïãú`):(o.hp=Math.max(0,o.hp-s),y(e,`Ï†Å(${o.name}) Ï∂úÌòàÎ°ú HP -${s} (HP ${o.hp}/${o.maxHp})`)))}e.frontPlacedThisTurn=0,Xo(e),Uo(e),Be(e),Ke(e),at(e,"onUpkeepEnd"),e.phase="DRAW"}function Xo(e){const t=["vuln","weak","bleed","disrupt"];for(const n of t)e.player.status[n]>0&&(e.player.status[n]-=1);for(const n of e.enemies)for(const r of t)n.status[r]>0&&(n.status[r]-=1)}function Qo(e){if(e.phase!=="DRAW"||(e.intentsRevealedThisTurn=!1,e.disruptIndexThisTurn=null,Ke(e),e.run.finished))return;if(G(e).length===0){cr(e),e.phase="NODE";return}const t=e.usedThisTurn;e.usedThisTurn=0;const n=Number(e._extraDrawNextTurn??0);e._extraDrawNextTurn=0,xt(e,t+(n>0?n:0)),e.player.block>0&&(e.player.block=0,y(e,"Î∞©Ïñ¥(Î∏îÎ°ù) ÏÜåÏã§")),cn(e),e.phase="PLACE",e.backUidsThisTurn=[],e.attackedEnemyIndicesThisTurn=[],e.drawCountThisTurn=0,e.combatTurn=(e.combatTurn??0)+1}function xt(e,t){let n=0;for(let r=0;r<t&&(Jo(e),!e.run.finished);r++){const o=e.deck.pop();if(!o)break;e.hand.push(o),n++}return y(e,`ÎìúÎ°úÏö∞ ${n}/${t} (ÏÜêÌå® ${e.hand.length})`),n}function Jo(e){e.deck.length===0&&e.discard.length>0&&(e.deck=sn(e.discard),e.discard=[],e.player.fatigue+=1,y(e,`ÌîºÎ°úÎèÑ F +1 (ÏÖîÌîå, ÌòÑÏû¨ ${e.player.fatigue})`))}function cr(e){e.player.block>0&&(e.player.block=0,y(e,"Î∞©Ïñ¥(Î∏îÎ°ù) ÏÜåÏã§")),e.intentsRevealedThisTurn=!1,e.disruptIndexThisTurn=null}function An(e){cr(e)}function Z(e){return e.pendingTarget!=null||(e.pendingTargetQueue?.length??0)>0}function Zo(e,t,n){const r=Number(t.amount??0)|0,o=t.formulaKind;if(!o)return r;switch(o){case"prey_mark":return n.hp>e.player.hp?r+5:r;case"triple_bounty":return G(e).length>=3?r+4:r;default:return r}}function es(e,t){if(!e.pendingTarget)return!1;if(G(e).length===0)return e.pendingTarget=null,e.pendingTargetQueue=[],e.selectedEnemyIndex=null,Ke(e),!0;const n=e.enemies[t];if(!n||n.hp<=0)return!1;const r=e.pendingTarget;if(r.kind==="damageSelect"){const o=Zo(e,r,n);_e(e,n,o)}else if(r.kind==="statusSelect"&&(Ze(n,r.key,r.n,e,"PLAYER"),r.key==="bleed"&&r.n>0)){const o=ke(e);o.bleedApplied+=1,me(e)}return Be(e),Ke(e),G(e).length===0?!0:(ts(e),!e.pendingTarget&&(e.pendingTargetQueue?.length??0)===0)}function ts(e){const t=e.pendingTargetQueue??[],n=t.shift()??null;e.pendingTarget=n,e.pendingTargetQueue=t,e.selectedEnemyIndex=null}function ns(e,t){t<=0||(e.player.block+=t,y(e,`Î∞©Ïñ¥(Î∏îÎ°ù) +${t} (ÌòÑÏû¨ ${e.player.block})`))}function rs(e,t){e.player.supplies=on(e.player.supplies+t,0),y(e,`Î≥¥Í∏â S ${t>=0?"+":""}${t} (ÌòÑÏû¨ ${e.player.supplies})`)}function Ae(e,t){e.player.fatigue=on(e.player.fatigue+t,0),y(e,`ÌîºÎ°ú F ${t>=0?"+":""}${t} (ÌòÑÏû¨ ${e.player.fatigue})`)}function tt(e,t){if(t<=0)return;let n=t;an(e,"relic_bloody_spoon")&&n>0&&(n+=1,y(e,"Ìîº Î¨ªÏùÄ ÏàüÍ∞ÄÎùΩ, Ï∂îÍ∞Ä ÌöåÎ≥µ +1"));const r=e.player.hp;e.player.hp=Math.min(e.player.maxHp,e.player.hp+n),y(e,`HP +${e.player.hp-r} (ÌòÑÏû¨ ${e.player.hp}/${e.player.maxHp})`)}function Be(e){G(e).length===0&&(e.pendingTarget=null,e.pendingTargetQueue=[],e.selectedEnemyIndex=null)}function _e(e,t,n){if(n<=0)return;const r=e.enemies.indexOf(t);if(r<0){y(e,`WARN: applyDamageToEnemy target not in g.enemies (${t?.id??"?"})`);return}if(e.attackedEnemyIndicesThisTurn.includes(r)||e.attackedEnemyIndicesThisTurn.push(r),t.immuneThisTurn){y(e,`Ï†Å(${t.name})ÏùÄ(Îäî) Ïù¥Î≤à ÌÑ¥ ÌîºÌï¥ Î©¥Ïó≠ ‚Üí ${n} ÌîºÌï¥ Î¨¥Ïãú`),Be(e);return}let o={target:"ENEMY",source:"PLAYER_ATTACK",raw:n,enemyIndex:r,enemyId:t.id},s=Te(e,{...o,phase:"PRE_STATUS",current:n,targetVuln:t.status.vuln??0,attackerWeak:e.player.status.weak??0});const a=e.player.status.weak??0,i=t.status.vuln??0;if(s=s-a+i,s<0&&(s=0),s=Te(e,{...o,phase:"POST_STATUS",current:s,afterStatus:s,targetVuln:i,attackerWeak:a}),s=Te(e,{...o,phase:"FINAL",current:s,afterStatus:s,targetVuln:i,attackerWeak:a}),s<=0){y(e,`Ï†Å(${t.name})ÏóêÍ≤å ÌîºÌï¥ 0 (Ïú†Î¨º/ÏÉÅÌÉúÎ°ú ÏÉÅÏáÑ)`),Be(e);return}const l=t.hp;if(t.hp=Math.max(0,t.hp-s),y(e,`Ï†Å(${t.name})ÏóêÍ≤å ${s} ÌîºÌï¥. (HP ${t.hp}/${t.maxHp})`),l>0&&t.hp===0){const c=ke(e);c.kills+=1,me(e)}Jn(e,{...o,phase:"FINAL",current:s,afterStatus:s,targetVuln:i,attackerWeak:a},s),Be(e),G(e).length===0&&(Be(e),Ke(e))}function ue(e,t,n,r,o){if(n==="ENEMY_ATTACK"&&e.player.nullifyDamageThisTurn)return y(e,`Ï†Å Í≥µÍ≤© ÌîºÌï¥ Î¨¥Ìö® (${r??n})`),0;if(t<=0)return 0;const a={target:"PLAYER",source:n==="ENEMY_ATTACK"?"ENEMY_ATTACK":n==="FATIGUE"?"FATIGUE":"OTHER",raw:t,reason:r};let i=Te(e,{...a,phase:"PRE_STATUS",current:t,attackerWeak:o,targetVuln:e.player.status.vuln??0});if(n==="ENEMY_ATTACK"){const l=o??0,c=e.player.status.vuln??0;if(i=i-l+c,i<0&&(i=0),i=Te(e,{...a,phase:"POST_STATUS",current:i,afterStatus:i,attackerWeak:l,targetVuln:c}),i=Te(e,{...a,phase:"PRE_BLOCK",current:i,afterStatus:i,attackerWeak:l,targetVuln:c}),e.player.block>0){const h=Math.min(e.player.block,i);e.player.block-=h,i-=h}i=Te(e,{...a,phase:"POST_BLOCK",current:i,afterStatus:i,afterBlock:i,attackerWeak:l,targetVuln:c})}else i=Te(e,{...a,phase:"POST_STATUS",current:i,afterStatus:i});if(i=Te(e,{...a,phase:"FINAL",current:i}),i<=0)return 0;e.player.hp=Math.max(0,e.player.hp-i),y(e,`ÌîåÎ†àÏù¥Ïñ¥ ${i} ÌîºÌï¥ (${r??n}). (HP ${e.player.hp}/${e.player.maxHp})`);{const l=ke(e);let c=!1;i>=10&&!l.tookBigHit10&&(l.tookBigHit10=!0,c=!0),e.player.hp<=15&&!l.hpLeq15&&(l.hpLeq15=!0,c=!0),c&&me(e)}return Jn(e,{...a,phase:"FINAL",current:i},i),i}function os(){return Vt[Math.floor(Math.random()*Vt.length)]}function Rn(e){const{tier:t}=Yn(e),n=t===0?0:t===1?.25:t===2?.55:.85;return Math.random()<n?ss():os()}const dr={boss_cursed_wall:"ÏõÄÏßÅÏù¥ÏßÄ ÏïäÎäîÎã§. ÎãπÏã†Ïù¥ Îã≥ÏïÑÍ∞ÑÎã§.",boss_giant_orc:"Í±∞ÎåÄÌïú Î¨¥Ïñ∏Í∞ÄÍ∞Ä Í∏∞Îã§Î¶∞Îã§.",boss_soul_stealer:"ÌñâÎèôÌïòÏßÄ ÏïäÏúºÎ©¥ Ï¢ÖÎßêÏù¥ Ïò®Îã§.",boss_gravity_master:"Î™∏Ïù¥ Ï†êÏ†ê Î¨¥Í≤ÅÎã§. Î™∏ÏùÑ Í∞ÄÎ≥çÍ≤å ÌïòÎùº."},In=[{id:"mad_mirror",name:"Í±∞Ïö∏Ïóê Ïû†Í∏¥ Î¨º",prompt:"Î¨º ÏÜçÏùò ÎãπÏã†Ïù¥ Î®ºÏ†Ä ÏõÉÏäµÎãàÎã§.",art:"assets/events/event_mad_mirror.png",options:e=>[{key:"mad_mirror:take",label:"ÏÜêÏùÑ ÎÑ£ÎäîÎã§",detail:"Ïπ¥Îìú Î≥¥ÏÉÅ. F +2.",apply:t=>(Ae(t,2),y(t,"Í±∞Ïö∏: Î¨¥Ïñ∏Í∞ÄÎ•º Í±¥Ï†∏ Ïò¨Î†∏Îã§. (F +2)"),"REWARD")},{key:"mad_mirror:leave",label:"Ïô∏Î©¥ÌïúÎã§",apply:t=>(y(t,"Í±∞Ïö∏: ÎãπÏã†ÏùÄ Î¨ºÎü¨ÎÇ¨Îã§."),"NONE")}]},{id:"mad_contract",name:"Ï†ñÏùÄ Í≥ÑÏïΩÏÑú",prompt:"Í≥∞Ìå°Ïù¥ ÎÉÑÏÉàÍ∞Ä ÎÇ©ÎãàÎã§.",art:"assets/events/event_mad_contract.png",options:e=>[{key:"mad_contract:sign",label:"ÏÑúÎ™ÖÌïúÎã§",detail:"ÏµúÎåÄ HP +2. Ïπ¥Îìú 1Ïû• Ï†úÍ±∞ ÌõÑ Î≥¥ÏÉÅ.",apply:t=>(t.player.maxHp+=2,t.player.hp=Math.min(t.player.maxHp,t.player.hp+2),y(t,"Í≥ÑÏïΩ: ÏµúÎåÄ HP +2"),{kind:"REMOVE_PICK",title:"ÎåÄÍ∞Ä",prompt:"Ï†úÍ±∞Ìï† Ïπ¥Îìú 1Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.",then:"REWARD"})},{key:"mad_contract:burn",label:"Ï∞¢Ïñ¥Î≤ÑÎ¶∞Îã§",detail:"F +1",apply:t=>(Ae(t,1),y(t,"Î∂àÍ∏∏Ìï®: F +1"),"NONE")}]},{id:"mad_lullaby",name:"ÏûêÏû•Í∞Ä",prompt:"Ïû†Îì§Î©¥ ÌöåÎ≥µÌïòÏßÄÎßå, Íπ®Ïñ¥ÎÇòÎ©¥ ÏûäÏäµÎãàÎã§.",art:"assets/events/event_mad_lullaby.png",options:e=>[{key:"mad_lullaby:sleep",label:"Ïû†Îì†Îã§",detail:"HP +12. Îç±ÏóêÏÑú Î¨¥ÏûëÏúÑ 1Ïû• ÏÜåÏã§.",apply:t=>(tt(t,12),Mo(t),y(t,"ÏûêÏû•Í∞Ä: HP ÌöåÎ≥µ, Í∑∏Îü¨ÎÇò ÏûäÏóàÎã§‚Ä¶ (Î¨¥ÏûëÏúÑ 1Ïû• ÏÜåÏã§)"),"NONE")},{key:"mad_lullaby:stay",label:"Î≤ÑÌã¥Îã§",detail:"F -1",apply:t=>(Ae(t,-1),y(t,"Î≤ÑÌåÄ: F -1"),"NONE")}]}];function ss(e){return In[Math.floor(Math.random()*In.length)]}const Vt=[{id:"drop_bag",name:"Ïßê Î≤ÑÎ¶¨Í∏∞",prompt:"ÏßêÏùÑ Ï§ÑÏó¨ ÌîºÎ°úÎ•º ÎÇÆÏ∂îÏûê.",art:"assets/events/event_drop_bag.png",options:()=>[{key:"drop",label:"Ïπ¥Îìú 1Ïû• Ï†úÍ±∞, F -1",apply:e=>(Ae(e,-1),y(e,"Ïù¥Î≤§Ìä∏: Ïßê Î≤ÑÎ¶¨Í∏∞ ‚Üí Ï†úÍ±∞Ìï† Ïπ¥ÎìúÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî."),{kind:"REMOVE_PICK",title:"Ïßê Î≤ÑÎ¶¨Í∏∞",prompt:"Ï†úÍ±∞Ìï† Ïπ¥Îìú 1Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.",then:"NONE"})},{key:"skip",label:"ÏïÑÎ¨¥Í≤ÉÎèÑ ÌïòÏßÄ ÏïäÎäîÎã§",apply:e=>(y(e,"Ïù¥Î≤§Ìä∏: Ïßê Î≤ÑÎ¶¨Í∏∞(ÏÉùÎûµ)"),"NONE")}]},{id:"hide_from_monster",name:"Î™¨Ïä§ÌÑ∞Î°úÎ∂ÄÌÑ∞ Ïà®Í∏∞",prompt:"Ï†ÑÌà¨ÌïòÍ±∞ÎÇò, ÎåÄÍ∞ÄÎ•º ÏπòÎ•¥Í≥† Ïà®ÏùÑ Ïàò ÏûàÎã§.",art:"assets/events/event_hide_from_monster.png",options:()=>[{key:"fight",label:"Ï†ÑÌà¨",apply:e=>(y(e,"Ïù¥Î≤§Ìä∏: Î™¨Ïä§ÌÑ∞Î°úÎ∂ÄÌÑ∞ Ïà®Í∏∞ ‚Üí Ï†ÑÌà¨ ÏÑ†ÌÉù"),"BATTLE")},{key:"remove_and_fatigue",label:"Ïπ¥Îìú 1Ïû• Ï†úÍ±∞ ÌõÑ F +1",apply:e=>(Ae(e,1),y(e,"Ïù¥Î≤§Ìä∏: Î™¨Ïä§ÌÑ∞Î°úÎ∂ÄÌÑ∞ Ïà®Í∏∞ ‚Üí Ïπ¥Îìú Ï†úÍ±∞ ÌõÑ F+1"),{kind:"REMOVE_PICK",title:"Ïà®Í∏∞",prompt:"Ï†úÍ±∞Ìï† Ïπ¥Îìú 1Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.",then:"NONE"})}]},{id:"goblin_ambush_low_supplies",name:"Îß§Î≥µÌïú ÏïΩÌÉàÏûêÎì§",prompt:`Í≥†Î∏îÎ¶∞Îì§Ïù¥ Î≥¥Í∏âÏùÑ ÏïΩÌÉàÌñàÎã§.
Ïù¥Î≤à Ï†ÑÌà¨Îäî Î≥¥Í∏â(S) 5Î°ú ÏãúÏûëÌï©ÎãàÎã§.`,art:"assets/events/event_goblin_ambush_low_supplies.png",options:()=>[{key:"fight",label:"ÎßûÏÑú Ïã∏Ïö¥Îã§",detail:"Í≥†Î∏îÎ¶∞ ÏïΩÌÉàÏûê 2ÎßàÎ¶¨ Ï†ÑÌà¨ (S = 5 ÏãúÏûë)",apply:e=>(e.run.nextBattleSuppliesBonus=-5,{kind:"BATTLE_SPECIAL",title:"Í≥†Î∏îÎ¶∞ Îß§Î≥µ",enemyIds:["goblin_raider","goblin_raider"]})}]},{id:"find_adventurer",name:"Îã§Î•∏ Î™®ÌóòÍ∞Ä Î∞úÍ≤¨",prompt:"Í±∞ÎûòÌïúÎã§.",art:"assets/events/event_find_adventurer.png",options:e=>e.run.treasureObtained?[{key:"adventurer:forced_battle",label:"ÎåÄÏπòÌïúÎã§",detail:"Î≥¥Î¨ºÏùÑ ÎÖ∏Î¶¨Í≥† Îç§Î≤ºÎì†Îã§.",apply:t=>({kind:"BATTLE_SPECIAL",enemyIds:["other_adventurer"],title:"Î≥¥Î¨ºÏùÑ ÎÖ∏Î¶¨Îäî Î™®ÌóòÍ∞Ä"})}]:[{key:"trade",label:"Ïπ¥Îìú 1Ïû• Ï†úÍ±∞ ÌõÑ Ïπ¥Îìú Î≥¥ÏÉÅ(2Ïû• Ï§ë 1Ïû•)",apply:t=>(y(t,"Ïù¥Î≤§Ìä∏: Îã§Î•∏ Î™®ÌóòÍ∞Ä Î∞úÍ≤¨ ‚Üí Ï†úÍ±∞Ìï† Ïπ¥Îìú ÏÑ†ÌÉù ÌõÑ Î≥¥ÏÉÅ"),{kind:"REMOVE_PICK",title:"Îã§Î•∏ Î™®ÌóòÍ∞Ä Î∞úÍ≤¨",prompt:"Ï†úÍ±∞Ìï† Ïπ¥Îìú 1Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.",then:"REWARD"})},{key:"leave",label:"ÏßÄÎÇòÏπúÎã§",apply:t=>(y(t,"Ïù¥Î≤§Ìä∏: Îã§Î•∏ Î™®ÌóòÍ∞Ä Î∞úÍ≤¨(ÏÉùÎûµ)"),"NONE")}]},{id:"ominous_prophecy",name:"Î∂àÍ∏∏Ìïú ÏòàÏñ∏",prompt:"Î∂àÍ∏∏Ìïú ÏÜçÏÇ≠ÏûÑÏù¥ Í∑ìÍ∞ÄÎ•º Îß¥ÎèàÎã§. ÎåÄÍ∞ÄÎ•º ÏπòÎ•¥Í≥† ÎØ∏ÎûòÎ•º ÏóøÎ≥ºÍπå?",art:"assets/events/event_ominous_prophecy.png",options:e=>[{key:"omen:listen",label:"ÏòàÏñ∏ÏùÑ Îì£ÎäîÎã§",detail:"F +1. Îã§Ïùå Î≥¥Ïä§Î•º ÌôïÏ†ïÌïòÍ≥† Í≥µÍ∞úÌï©ÎãàÎã§.",apply:t=>{if(Ae(t,1),y(t,"Î∂àÍ∏∏Ìïú ÏòàÏñ∏: F +1"),t.run.nextBossId||(t.run.bossPool.length>0?t.run.nextBossId=re(t.run.bossPool):t.run.nextBossId=null),!t.run.nextBossId)return y(t,"ÏòàÏñ∏: ÎØ∏ÎûòÍ∞Ä ÌùêÎ¶øÌïòÎã§. (Î≥¥Ïä§Í∞Ä ÎÇ®ÏïÑÏûàÏßÄ ÏïäÏùå)"),"NONE";t.content.enemiesById[t.run.nextBossId];const n=dr[t.run.nextBossId]??"Ï†ïÏ≤¥Î∂àÎ™ÖÏùò ÏúÑÌòëÏù¥ Îã§Í∞ÄÏò®Îã§.";return t.run.bossOmenText=`${n}`,y(t,`ÏòàÏñ∏: ${n}`),"NONE"}},{key:"omen:ignore",label:"Î¨¥ÏãúÌïúÎã§",detail:"ÏïÑÎ¨¥ ÏùºÎèÑ ÏùºÏñ¥ÎÇòÏßÄ ÏïäÏäµÎãàÎã§.",apply:t=>(y(t,"Î∂àÍ∏∏Ìïú ÏòàÏñ∏(Î¨¥Ïãú)"),"NONE")}]},{id:"rat_circle",name:"Ï•êÎì§Ïùò Ïõê",prompt:`Ï•êÎì§Ïù¥ ÎèåÎ∞îÎã•Ïóê ÏõêÏùÑ ÎßåÎì†Îã§.
ÎãπÏã†ÏùÑ Î≥¥Ïûê ÏõêÏù¥ Ïª§ÏßÑÎã§.`,art:"assets/events/event_rat_circle.png",options:e=>{const t=!eo(e,"relic_ratskin_charm"),n=[{key:"rat_circle:one",label:"Ï•êÎñº Ìïú ÎßàÎ¶¨ÏôÄ Ïã∏Ïö¥Îã§",detail:"Ï†ÑÌà¨",apply:r=>(y(r,"Ïù¥Î≤§Ìä∏: Ï•êÎì§Ïùò Ìåê ‚Üí Ï•êÎñº 1"),{kind:"BATTLE_SPECIAL",title:"Ï•êÎì§Ïùò Ïõê",enemyIds:["rat_swarm"]})}];return t&&n.splice(1,0,{key:"rat_circle:three_for_relic",label:"Ïú†Î¨ºÏùÑ Í±∏Í≥† Ï•êÎñº ÏÖãÍ≥º Ïã∏Ïö¥Îã§",detail:"ÏäπÎ¶¨ Ïãú Í≥†Ïú† Ïú†Î¨º ÌöçÎìù",apply:r=>(y(r,"Ïù¥Î≤§Ìä∏: Ï•êÎì§Ïùò Ìåê ‚Üí Ï•êÎñº 3 (Í≥†Ïú† Ïú†Î¨º)"),{kind:"BATTLE_SPECIAL",title:"Ï•êÎì§Ïùò Ïõê",enemyIds:["rat_swarm","rat_swarm","rat_swarm"],onWinGrantRelicId:"relic_ratskin_charm"})}),n}}];function Yt(e){return Vt.find(t=>t.id===e)??null}function as(){return Object.keys(Gn).sort((e,t)=>e.localeCompare(t))}function is(){return{cardsById:Gn,enemiesById:Gr}}let Ue=!1,pn=null,Fe=[],Ye=[],Ee=-1;function ls(e){return Array.from(new Set(e)).sort((t,n)=>t.localeCompare(n))}function Ln(e,t){return e.toLowerCase().startsWith(t.toLowerCase())}function cs(){return[{name:"help",desc:"show commands"},{name:"state",desc:"print game state"},{name:"newrun",desc:"start new run"},{name:"hp",args:"<n>",desc:"set current hp"},{name:"maxhp",args:"<n>",desc:"set max hp"},{name:"supplies",args:"<n>",desc:"set supplies"},{name:"fatigue",args:"<n>",desc:"set fatigue"},{name:"phase",args:"<PLACE|BACK|FRONT|ENEMY|UPKEEP|DRAW|NODE>",desc:"set phase",suggest:()=>["PLACE","BACK","FRONT","ENEMY","UPKEEP","DRAW","NODE"]},{name:"addcard",args:"<defId> [upgrade=0] [zone=deck|hand|discard]",desc:"add card",suggest:(e,t)=>t.length<=2?as():t.length===4?["deck","hand","discard"]:[]},{name:"removecard",args:"<uid>",desc:"remove card",suggest:e=>ls(Object.keys(e.cards??{}))},{name:"win",desc:"force victory"},{name:"lose",desc:"force defeat"},{name:"log",args:"<text...>",desc:"log message"},{name:"addrelic",args:"<relicId> [now|locked|unlocked]",desc:"grant relic",suggest:(e,t)=>t.length<=2?Jr():t.length===3?["now","locked","unlocked"]:[]},{name:"relicapply",desc:"apply pending relic activations"}]}function kt(e,t){Fe.push({t:Date.now(),kind:e,text:t}),Fe.length>300&&(Fe=Fe.slice(-300))}function ds(e){pn=e}function us(){return Ue}function ps(e){Ue=!Ue,We()}function We(){if(document.querySelector(".devConsole")?.remove(),!Ue)return;const e=document.createElement("div");e.className="devConsole",e.style.cssText=`
    position: fixed; inset: 0;
    z-index: 60000;
    pointer-events: auto;
    background: rgba(0,0,0,.35);
    backdrop-filter: blur(4px);
    display:flex; align-items:flex-end; justify-content:center;
    padding: 12px;
    box-sizing: border-box;
  `;const t=document.createElement("div");t.style.cssText=`
    width: min(980px, 100%);
    height: min(420px, 70vh);
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(10,12,14,.92);
    box-shadow: 0 18px 60px rgba(0,0,0,.55);
    display:flex;
    flex-direction: column;
    overflow:hidden;
  `;const n=document.createElement("div");n.style.cssText=`
    padding: 10px 12px;
    display:flex; align-items:center; justify-content:space-between;
    border-bottom: 1px solid rgba(255,255,255,.10);
  `;const r=document.createElement("div");r.textContent="Dev Console",r.style.cssText="font-weight:800; color:#fff; opacity:.95;";const o=document.createElement("div");o.style.cssText="display:flex; gap:8px;";const s=(b,g)=>{const m=document.createElement("button");return m.type="button",m.textContent=b,m.style.cssText=`
      padding: 6px 10px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: #fff;
      cursor: pointer;
      font-weight: 700;
    `,m.onclick=g,m};o.appendChild(s("Clear",()=>{Fe=[],We()})),o.appendChild(s("Close",()=>{Ue=!1,We()})),n.appendChild(r),n.appendChild(o);const a=document.createElement("div");a.className="devConsoleOut",a.style.cssText=`
    flex: 1 1 auto;
    padding: 10px 12px;
    overflow: auto;
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 12px;
    line-height: 1.4;
    color: #ddd;
    white-space: pre-wrap;
  `;const i=b=>(b.kind==="in"?"> ":b.kind==="err"?"! ":"  ")+b.text;a.textContent=Fe.map(i).join(`
`),queueMicrotask(()=>{a.scrollTop=a.scrollHeight});const l=document.createElement("div");l.style.cssText=`
    border-top: 1px solid rgba(255,255,255,.10);
    padding: 10px 12px;
    display:flex; gap:10px; align-items:center;
  `;const c=document.createElement("div");c.className="devConsoleHint",c.style.cssText=`
    margin-left: 10px;
    max-width: 45%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    color: rgba(255,255,255,.55);
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 12px;
  `;const h=document.createElement("div");h.textContent=">",h.style.cssText="color:#fff; font-weight:900; opacity:.9;";const u=document.createElement("input");u.type="text",u.placeholder="help / state / newrun ...",u.style.cssText=`
    flex: 1 1 auto;
    padding: 10px 12px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(255,255,255,.06);
    color: #fff;
    outline: none;
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 13px;
  `;const d=cs();let x={base:"",items:[],idx:-1,lastApplied:""};const _=b=>{const g=pn?.getG();if(!g)return[];const m=b.split(/\s+/).filter(Boolean),k=/\s$/.test(b);if(m.length===0)return d.map(E=>E.name);if(m.length===1&&!k){const E=m[0];return d.map($=>$.name).filter($=>Ln($,E))}const M=(m[0]??"").toLowerCase(),T=d.find(E=>E.name===M);if(!T?.suggest)return[];const L=k?"":m[m.length-1]??"";return T.suggest(g,m).filter(E=>Ln(E,L))},f=(b,g)=>{const m=/\s$/.test(b);if(!b.trim())return g+" ";const k=b.split(/\s+/);return m?b+g+" ":(k[k.length-1]=g,k.join(" ")+" ")},p=()=>{const b=_(u.value);if(!b.length){c.textContent="";return}const g=b.slice(0,6);c.textContent=g.join("  ")};u.onkeydown=b=>{if(b.key==="Escape"){Ue=!1,We();return}if(b.key==="Enter"){const g=u.value.trim();if(!g)return;u.value="",Ye.unshift(g),Ee=-1,kt("in",g);try{fs(g)}catch(m){kt("err",String(m?.message??m))}We();return}if(b.key==="ArrowUp"){b.preventDefault();const g=Ye.length;if(g===0)return;Ee=Math.min(g-1,Ee+1),u.value=Ye[Ee]??"";return}if(b.key==="ArrowDown"){if(b.preventDefault(),Ye.length===0)return;Ee=Math.max(-1,Ee-1),u.value=Ee>=0?Ye[Ee]??"":"";return}if(b.key==="Tab"){b.preventDefault();const g=b.shiftKey===!0,m=u.value;if(!(x.items.length>0&&(m===x.lastApplied||m===x.base))){const L=_(m);x.base=m,x.items=L,x.idx=-1,x.lastApplied=m}if(!x.items.length){p();return}g?x.idx=(x.idx-1+x.items.length)%x.items.length:x.idx=(x.idx+1)%x.items.length;const M=x.items[x.idx],T=f(x.base,M);u.value=T,x.lastApplied=T,p();return}},u.oninput=()=>{x.items=[],x.base="",x.idx=0,p()},l.appendChild(h),l.appendChild(u),l.appendChild(c),t.appendChild(n),t.appendChild(a),t.appendChild(l),t.onclick=b=>b.stopPropagation(),e.appendChild(t),document.body.appendChild(e),p(),queueMicrotask(()=>u.focus())}function fs(e){const t=pn;if(!t){kt("err","Dev console context not set");return}const n=t.getG(),r=e.split(/\s+/).filter(Boolean),o=(r[0]??"").toLowerCase(),s=r[1],a=r[2],i=c=>kt("out",c);if(o==="help"){i(["help","state","newrun","hp <n> | maxhp <n> | supplies <n> | fatigue <n>","phase <PLACE|BACK|FRONT|ENEMY|UPKEEP|DRAW|NODE>","addcard <defId> [upgrade=0] [zone=deck|hand|discard]","removecard <uid>","addrelic <relicId> [now|locked|unlocked]","relicapply  (apply pending relic activations)","win | lose","log <text...>"].join(`
`));return}if(o==="state"){i(JSON.stringify({phase:n.phase,hp:`${n.player.hp}/${n.player.maxHp}`,supplies:n.player.supplies,fatigue:n.player.fatigue,deck:n.deck.length,hand:n.hand.length,discard:n.discard.length,enemies:n.enemies.map(c=>({id:c.id,hp:`${c.hp}/${c.maxHp}`,intent:c.intentIndex}))},null,2));return}if(o==="newrun"){t.actions.onNewRun(),i("OK: newrun");return}const l=(c,h)=>{const u=Number(s);if(!Number.isFinite(u)){i(`ERR: ${c} requires number`);return}h(u),t.rerender(),i(`OK: ${c} = ${u}`)};if(o==="hp")return l("hp",c=>n.player.hp=Math.max(0,Math.min(n.player.maxHp,c)));if(o==="maxhp")return l("maxHp",c=>{n.player.maxHp=Math.max(1,c),n.player.hp=Math.min(n.player.hp,n.player.maxHp)});if(o==="supplies")return l("supplies",c=>n.player.supplies=Math.max(0,c));if(o==="fatigue")return l("fatigue",c=>n.player.fatigue=Math.max(0,c));if(o==="phase"){const c=(s??"").toUpperCase();if(!new Set(["PLACE","BACK","FRONT","ENEMY","UPKEEP","DRAW","NODE"]).has(c)){i("ERR: phase invalid");return}n.phase=c,t.rerender(),i(`OK: phase=${c}`);return}if(o==="log"){const c=e.slice(e.indexOf(" ")+1);if(!c||c===e){i("ERR: log <text...>");return}t.log?.(`[DEV] ${c}`),i("OK: logged");return}if(o==="addcard"){const c=s;if(!c){i("ERR: addcard <defId> [upgrade=0] [zone=deck|hand|discard]");return}const h=Math.max(0,Number(a??"0")||0),u=r[3]??"deck";dn(n,c,{upgrade:h});const d=n.deck[n.deck.length-1];d&&u!=="deck"&&(n.deck=n.deck.filter(x=>x!==d),u==="hand"?n.hand.push(d):u==="discard"&&n.discard.push(d),n.cards[d].zone=u),t.log?.(`[DEV] addcard ${c} +${h} (${u}) uid=${d}`),t.rerender(),i(`OK: addcard uid=${d}`);return}if(o==="removecard"){const c=s;if(!c){i("ERR: removecard <uid>");return}if(!n.cards[c]){i(`ERR: uid not found: ${c}`);return}const h=n.deck.includes(c),u=n.hand.includes(c),d=n.discard.includes(c);!h&&!u&&!d&&i(`WARN: uid exists but not in piles (deck/hand/discard): ${c} (zone=${n.cards[c]?.zone??"?"})`),_t(n,c),t.log?.(`[DEV] removecard ${c}`),t.rerender(),i("OK: removecard");return}if(o==="addrelic"){const c=s,h=(a??"").toLowerCase();if(!c){i("ERR: addrelic <relicId> [now|locked|unlocked]");return}bt(n,c);const u=n.run;if(u.forceLockedRelics??={},u.forceUnlockedRelics??={},h==="locked"){u.forceLockedRelics[c]=!0,delete u.forceUnlockedRelics[c],u.relicRuntime??={},u.relicRuntime[c]??={active:!1,pending:!1,obtainedAtNode:n.run.nodePickCount},u.relicRuntime[c].active=!1,u.relicRuntime[c].pending=!1,t.log?.(`[DEV] addrelic ${c} (locked)`),t.rerender(),i(`OK: addrelic ${c} (locked)`);return}if(h==="unlocked"){u.forceUnlockedRelics[c]=!0,delete u.forceLockedRelics[c],t.log?.(`[DEV] addrelic ${c} (unlocked)`),t.rerender(),i(`OK: addrelic ${c} (unlocked)`);return}h==="now"&&ie(n),t.log?.(`[DEV] addrelic ${c}${h?` (${h})`:""}`),t.rerender(),i(`OK: addrelic ${c}`);return}if(o==="relicapply"){ie(n),t.log?.("[DEV] relicapply"),t.rerender(),i("OK: relicapply");return}if(o==="win"){if(!n.enemies||n.enemies.length===0){i("WARN: enemies=0");return}for(const c of n.enemies)c.hp=0;n.enemies=[],n.pendingTarget=null,n.pendingTargetQueue=[],n.selectedEnemyIndex=null,Ke(n),t.log?.("[DEV] win"),t.rerender(),i("OK: win");return}if(o==="lose"){n.run.finished=!0,t.log?.("[DEV] lose"),t.rerender(),i("OK: lose");return}i(`Unknown command: ${o} (try: help)`)}function Lt(e,t){if(!t)return;const n=e.player.fatigue??0;n<10||(e.player.fatigue=Math.max(0,n-2),e.time=(e.time??0)+1,y(e,"ÌîºÎ°úÍ∞Ä ÎÑàÎ¨¥ ÎÜíÏïÑ Ìú¥ÏãùÏù¥ Îçî Ïò§Îûò Í±∏Î¶ΩÎãàÎã§. (F -2, ÏãúÍ∞Ñ +1)"))}function hs(e){let t=Object.values(e.cards).filter(a=>(a.zone==="deck"||a.zone==="hand"||a.zone==="discard")&&$t(e,a.uid)).map(a=>a.uid);const n=e.player.fatigue??0;let r=1/0;return n>=8?r=4:n>=5&&(r=8),r!==1/0&&t.length>r&&(t=[...t].sort(()=>Math.random()-.5).slice(0,r)),t.length===0?null:{kind:"UPGRADE_PICK",title:"Í∞ïÌôî",prompt:"Í∞ïÌôîÌï† Ïπ¥Îìú 1Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.",options:[...[...t].sort((a,i)=>{const l=e.cards[a],c=e.cards[i],h=e.content.cardsById[l.defId]?.name??l.defId,u=e.content.cardsById[c.defId]?.name??c.defId,d=h.localeCompare(u,"ko");return d!==0?d:(l.upgrade??0)-(c.upgrade??0)}).map(a=>{const i=e.cards[a],l=he(e.content,i.defId,i.upgrade??0),c=he(e.content,i.defId,(i.upgrade??0)+1),h=e.content.cardsById[i.defId]?.name??i.defId,u=(i.upgrade??0)>0?`${h} +${i.upgrade}`:h,d=`ÌòÑÏû¨: Ï†ÑÏó¥ ${l.frontText} / ÌõÑÏó¥ ${l.backText}
Í∞ïÌôî: Ï†ÑÏó¥ ${c.frontText} / ÌõÑÏó¥ ${c.backText}`;return{key:`up:${a}`,label:u,detail:d,cardUid:a}}),{key:"skip",label:"Ï∑®ÏÜå"}]}}function ms(e,t){const n=e.choiceCtx&&e.choiceCtx.kind==="REST"&&typeof e.choiceCtx.highF=="boolean"?e.choiceCtx.highF:(e.player.fatigue??0)>=10;if(t.startsWith("rest:")){const r=ke(e);r.rest+=1,me(e)}if(t==="rest:heal")return Lt(e,n),tt(e,15),y(e,"Ìú¥Ïãù: HP +15"),pe(e),e.phase="NODE",ie(e),!0;if(t==="rest:clear_f")return Lt(e,n),e.player.fatigue=Math.max(0,(e.player.fatigue??0)-3),y(e,"Ìú¥Ïãù: ÌîºÎ°ú F-=3"),pe(e),e.phase="NODE",ie(e),!0;if(t==="rest:upgrade"){const s=[...Object.values(e.cards).filter(l=>l.zone==="deck"||l.zone==="hand"||l.zone==="discard").filter(l=>$t(e,l.uid)).map(l=>{const c=he(e.content,l.defId,l.upgrade??0),h=e.content.cardsById[l.defId]?.name??l.defId,u=(l.upgrade??0)>0?`${h} +${l.upgrade}`:h;return{key:`up:${l.uid}`,label:u,detail:`Ï†ÑÏó¥: ${c.frontText} / ÌõÑÏó¥: ${c.backText}`,cardUid:l.uid}}),{key:"skip",label:"Ï∑®ÏÜå"}],a=e.choice,i=e.choiceCtx;return yt(e,{kind:"UPGRADE_PICK",title:"Í∞ïÌôî",prompt:"Í∞ïÌôîÌï† Ïπ¥Îìú 1Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.",options:s},{kind:"UPGRADE_PICK",returnChoice:a,returnCtx:i}),!0}return t==="rest:skip"?(Lt(e,n),y(e,"Ìú¥Ïãù: ÏÉùÎûµ"),pe(e),e.phase="NODE",ie(e),!0):!1}function bs(e,t){if(!e.choiceCtx||e.choiceCtx.kind!=="EVENT")return!1;const n=Yt(e.choiceCtx.eventId);if(!n)return!1;const o=n.options(e).find(i=>i.key===t);if(!o)return!1;const s=ke(e);s.eventPicks+=1,me(e);const a=o.apply(e);if(a&&typeof a=="object"&&a.kind==="UPGRADE_PICK"){const i=hs(e);return i?(yt(e,i,null),!0):(y(e,"Í∞ïÌôîÌï† Ïàò ÏûàÎäî Ïπ¥ÎìúÍ∞Ä ÏóÜÏäµÎãàÎã§."),pe(e),e.phase="NODE",ie(e),!0)}if(a&&typeof a=="object"&&a.kind==="REMOVE_PICK"){const l=[...Object.values(e.cards).filter(c=>c.zone==="deck"||c.zone==="hand"||c.zone==="discard").map(c=>c.uid).map(c=>{const h=e.cards[c],u=he(e.content,h.defId,h.upgrade??0),d=e.content.cardsById[h.defId]?.name??h.defId,x=(h.upgrade??0)>0?`${d} +${h.upgrade}`:d;return{key:`remove:${c}`,label:x,detail:`Ï†ÑÏó¥: ${u.frontText} / ÌõÑÏó¥: ${u.backText}`,cardUid:c}}),{key:"skip",label:"Ï∑®ÏÜå"}];return yt(e,{kind:"REMOVE_PICK",title:a.title??"Ï†úÍ±∞",prompt:a.prompt??"Ï†úÍ±∞Ìï† Ïπ¥Îìú 1Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.",options:l},null),!0}return pe(e),e.phase="NODE",ie(e),!0}function ys(e,t){const n=e.choice;if(!n)return!1;if(t==="close")return pe(e),!0;if(n.kind==="REWARD")return Io(e,t);if(n.kind==="UPGRADE_PICK"){if(t==="skip"){const r=e.choiceCtx;return r?.returnChoice?(y(e,"Í∞ïÌôî Ï∑®ÏÜå"),yt(e,r.returnChoice,r.returnCtx??null),!0):(y(e,"Í∞ïÌôî Ï∑®ÏÜå"),pe(e),e.phase="NODE",ie(e),!0)}if(t.startsWith("up:")){const r=t.slice(3),o=sr(e,r);return y(e,o?"Í∞ïÌôî ÏôÑÎ£å":"Í∞ïÌôî Ïã§Ìå®"),pe(e),e.phase="NODE",ie(e),!0}return!1}if(n.kind==="REMOVE_PICK"){if(t==="skip")return y(e,"Ï†úÍ±∞ Ï∑®ÏÜå"),pe(e),e.phase="NODE",ie(e),!0;if(t.startsWith("remove:")){const r=t.slice(7);return _t(e,r),y(e,"Ïπ¥ÎìúÎ•º Ï†úÍ±∞ÌñàÏäµÎãàÎã§."),pe(e),e.phase="NODE",ie(e),!0}return!1}if(n.kind==="EVENT"){if(e.choiceCtx?.kind==="REST")return ms(e,t);if(e.choiceCtx?.kind==="EVENT")return bs(e,t)}return t==="skip"?(pe(e),!0):!1}const Mt="deck-rogue-save-v1",ur=1;function xs(e){try{return JSON.parse(e)}catch{return null}}function ks(){return!!localStorage.getItem(Mt)}function Ts(){localStorage.removeItem(Mt)}function gs(e,t){const n={ver:ur,savedAt:Date.now(),build:t?.build,state:e};localStorage.setItem(Mt,JSON.stringify(n))}function Es(){const e=localStorage.getItem(Mt);if(!e)return null;const t=xs(e);return!t||t.ver!==ur||!t.state?null:{state:t.state,savedAt:t.savedAt}}const Cs=`# Deck Rogue Prototype ‚Äî Î£∞Î∂Å (ÌîåÎ†àÏù¥Ïñ¥Ïö©)

Ïù¥ Î¨∏ÏÑúÎäî Ïä§Ìè¨ÏùºÎü¨Î•º ÏµúÏÜåÌôîÌï©ÎãàÎã§.

[1] Í∞úÏöî
ÎÖ∏ÎìúÎ•º ÏÑ†ÌÉùÌïòÎ©∞ ÏßÑÌñâÌïòÍ≥†, Ï†ÑÌà¨ÏóêÏÑú ÏÇ¥ÏïÑÎÇ®ÏïÑ ÏÑ±Ïû•Ìï©ÎãàÎã§. Î™©ÌëúÎäî Î¨¥ÏóáÏùºÍπåÏöî?
Î™®Îì† Ïπ¥ÎìúÎäî Ï†ÑÏó¥Í≥º ÌõÑÏó¥Ïù¥ ÏûàÏäµÎãàÎã§. Î∞∞ÏπòÏóê Îî∞Îùº Ïó≠Ìï†Ïù¥ Îã¨ÎùºÏßëÎãàÎã§.

[2] Î≥¥Í∏âÍ≥º ÌîºÎ°úÎèÑ

Î≥¥Í∏â(S): Ï†ÑÏó¥ Ïπ¥Îìú Î∞è ÏùºÎ∂Ä Ìö®Í≥ºÏùò Î∞úÎèôÏóê ÏÇ¨Ïö©Îê©ÎãàÎã§. Î≥¥ÌÜµ 7Î°ú ÏãúÏûëÌï©ÎãàÎã§.
Î≥¥Í∏âÏù¥ Î∂ÄÏ°±Ìïú ÏÉÅÌÉúÎ°ú ÌÑ¥ Ï¢ÖÎ£å Ïãú ÌîºÎ°úÎèÑÎßåÌÅº ÌîºÌï¥Î•º Î∞õÏäµÎãàÎã§.

ÌîºÎ°úÎèÑ(F): Îç±ÏùÑ ÏÑûÍ±∞ÎÇò Ï†ÑÏó¥ Ïπ¥ÎìúÏùò Î≥¥Í∏âÏù¥ Î∂ÄÏ°±Ìïú Ï±ÑÎ°ú ÌÑ¥ÏùÑ ÎßàÏπ† Îïå ÌîºÎ°úÎèÑÍ∞Ä 1 Ïò¨ÎùºÍ∞ÄÎ©∞, ÏùºÎ∂Ä Ïπ¥ÎìúÏùò Ìö®Í≥ºÎ°úÎèÑ Î≥ÄÌï©ÎãàÎã§.
ÌîºÎ°úÎèÑÎäî Ï†ÑÌà¨Í∞Ä ÎÅùÎÇòÎèÑ Ïú†ÏßÄÎê©ÎãàÎã§. ÎÑàÎ¨¥ ÏåìÏù∏ ÌîºÎ°úÎäî ÎïåÎïåÎ°ú ÎãπÏã†ÏùÑ Î≥ÄÌïòÍ≤å Ìï©ÎãàÎã§.

[3] Ï†ÑÌà¨ ÌùêÎ¶Ñ
Î∞∞Ïπò ‚Üí ÌõÑÏó¥ Î∞úÎèô ‚Üí Ï†ÑÏó¥ Î∞úÎèô ‚Üí Ï†Å ÌñâÎèô ‚Üí Ï†ïÎ¶¨ ‚Üí ÎìúÎ°úÏö∞
‚Äª ‚ÄúÎåÄÏÉÅ ÏÑ†ÌÉù ÌïÑÏöî‚ÄùÍ∞Ä Îú®Î©¥ ÏÇ¥ÏïÑÏûàÎäî Ï†ÅÏùÑ ÌÅ¥Î¶≠Ìï¥ ÎåÄÏÉÅÏùÑ Ï†ïÌïòÏÑ∏Ïöî.
‚Äª ÌõÑÏó¥ Î∞úÎèôÏùÑ ÎàÑÎ•¥Î©¥ ÌÑ¥Ïù¥ ÏßÑÌñâÎêòÏñ¥, Ïπ¥ÎìúÏùò Î∞∞ÏπòÎ•º Î≥ÄÍ≤ΩÌï† Ïàò ÏóÜÏäµÎãàÎã§.
Î≥¥Í∏â Î∞è Í∑∏Ïóê Îî∞Î•∏ Î≥ÄÌôîÎäî Ï†ïÎ¶¨ Îã®Í≥ÑÏóêÏÑú Ï≤òÎ¶¨Ìï©ÎãàÎã§.

ÏÜêÌå®Îäî ÌÑ¥Ïù¥ Ï¢ÖÎ£åÎêòÏñ¥ÎèÑ Ïú†ÏßÄÎê©ÎãàÎã§.
Ïπ¥ÎìúÎäî Îß§ ÌÑ¥ÎßàÎã§ ÏÇ¨Ïö©Ìïú ÎßåÌÅº ÎΩëÏäµÎãàÎã§. Ï¶â, Ïπ¥ÎìúÎ°ú Ïù∏Ìïú ÎìúÎ°úÏö∞Îäî Ìå®Ïùò Îß§Ïàò ÏûêÏ≤¥Î•º ÎäòÎ¶¨Îäî Ìö®Í≥ºÍ∞Ä ÏûàÏäµÎãàÎã§.

[4] Ïö©Ïñ¥
- ÏÜåÎ™®: Ïù¥Î≤à Ï†ÑÌà¨ÏóêÏÑú ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÍ≤å ÎêòÎäî Í≤ÉÏûÖÎãàÎã§.
- ÏÜåÏã§: Îü∞ Ï†ÑÏ≤¥ÏóêÏÑú Ìï¥Îãπ Ïπ¥ÎìúÍ∞Ä ÏÇ¨ÎùºÏßÄÎäî Í≤ÉÏûÖÎãàÎã§.
- Ï∑®ÏïΩ: Î∞õÎäî ÌîºÌï¥Í∞Ä (Ï∑®ÏïΩ)ÎßåÌÅº Ï¶ùÍ∞ÄÌï©ÎãàÎã§.
- ÏïΩÌôî: Ï£ºÎäî ÌîºÌï¥Í∞Ä (ÏïΩÌôî)ÎßåÌÅº Í∞êÏÜåÌï©ÎãàÎã§.
- Ï∂úÌòà: ÌÑ¥ Ï¢ÖÎ£å Ïãú (Ï∂úÌòà)ÎßåÌÅº ÌîºÌï¥Î•º ÏûÖÏäµÎãàÎã§.
- ÍµêÎûÄ: ÎãπÏã†ÏùÑ Î∞©Ìï¥Ìï©ÎãàÎã§. Î¨¥ÏóáÏùºÍπåÏöî?

[5] Ï°∞Ïûë

(Ïª¥Ìì®ÌÑ∞)
- 4: ÏÑ†ÌÉù Ìï¥Ï†ú
- Tab: ÏÜêÌå® ÏÑ†ÌÉù Ïù¥Îèô
- 1~3: Ï†ÑÏó¥ Î∞∞Ïπò / q,w,e: ÌõÑÏó¥ Î∞∞Ïπò
- ÎìúÎûòÍ∑∏: ÏÜêÌå®‚ÜíÏä¨Î°Ø Î∞∞Ïπò, Ïä¨Î°Ø‚ÜîÏä¨Î°Ø Ïä§Ïôë, Ïä¨Î°Ø‚ÜíÏÜêÌå® ÌöåÏàò
- Space: Îã§Ïùå ÌÑ¥
- P: ÏÉàÎ°úÏö¥ Îü∞

(Î™®Î∞îÏùº)
- ÏÜêÌå®: ÌÅ¥Î¶≠ Ïãú ÏÑ†ÌÉù, Í∏∏Í≤å ÎàÑÎ•º Ïãú ÌôïÎåÄ
- Ïπ¥Îìú ÏÑ†ÌÉù ÏÉÅÌÉúÏóêÏÑú Ïä¨Î°ØÏùÑ ÎàåÎü¨ Î∞∞Ïπò
- Ïä¨Î°Ø: ÌÅ¥Î¶≠ Ïãú ÌôïÎåÄ, Í∏∏Í≤å ÎàÑÎ•º Ïãú ÌöåÏàò
- Ïä¨Î°ØÏóê ÎÑ£ÏùÄ Ïπ¥ÎìúÎäî Ïù¥Î¶ÑÎßå Î≥¥ÏûÖÎãàÎã§.

[6] ÎãπÏã†ÏùÑ ÏúÑÌïú Ï°∞Ïñ∏

Îç±ÏùÄ ÎãπÏã†Ïùò ÎπÑÌíàÏûÖÎãàÎã§. ÎπÑÌíàÏù¥ Ï†ÅÏúºÎ©¥, Îäò ÏÉàÎ°ú Íæ∏Î¶¨ÎäêÎùº ÌûòÎì§ Í≤ÅÎãàÎã§. ÎπÑÌíàÏù¥ ÎßéÏúºÎ©¥, Îì§Í≥† Îã§ÎãàÍ∏∞ ÌûòÎì§Í≤†ÏßÄÏöî. Í∑†ÌòïÏùÑ Ï∞æÏúºÏÑ∏Ïöî.

[7] ÏãúÍ∞Ñ

ÏãúÍ∞ÑÏùÄ Í∏àÏûÖÎãàÎã§. Î™®Îì† ÌñâÎèôÏùÄ ÏãúÍ∞ÑÏùÑ ÏÜåÎ™®Ìï©ÎãàÎã§. Ïã∏ÏõÄÏùÄ Ï¢Ä Îçî ÏÜåÎ™®Ìï†ÏßÄÎèÑ Î™®Î•¥Í≤†Íµ∞Ïöî.
Ï§ëÏöîÌïú Í±¥ Ïù¥Í≥≥Ïù¥ ÎãπÏã†ÏóêÍ≤å ÎÑâÎÑâÌïú ÏãúÍ∞ÑÏùÑ Ï£ºÏßÄ ÏïäÎäîÎã§Îäî Í≤ÉÏù¥Í≤†ÏßÄÏöî.
`,vs=new URL("/deck-rogue-prototype/",window.location.origin).href;function fe(e){if(!e||/^(https?:|data:|blob:)/i.test(e))return e;const t=e.replace(/^\/+/,"");return new URL(t,vs).href}let Hn=!1;function ws(){if(Hn)return;Hn=!0;const e=document.documentElement;e.style.setProperty("--bgUrl",`url("${fe("assets/ui/background/dungeon_bg.png")}")`),e.style.setProperty("--boardUrl",`url("${fe("assets/ui/boards/battle_board.png")}")`),e.style.setProperty("--cardUrl",`url("${fe("assets/ui/cards/card_parchment.png")}")`),e.style.setProperty("--mapBgUrl",`url("${fe("assets/ui/background/map_bg.png")}")`)}function Ss(e){return new Promise(t=>window.setTimeout(t,e))}function _s(e){switch(e){case"BACK":return 100;case"FRONT":return 100;case"ENEMY":return 100;case"UPKEEP":return 100;case"DRAW":return 100;case"PLACE":return 0;default:return 220}}let Ht=!1;function $s(){document.querySelectorAll(".slot").forEach(e=>{const t=e.querySelector(".slotCardScaler");t&&Nr(e,t)})}function Ms(e){Ht||(Ht=!0,requestAnimationFrame(()=>{Ht=!1,yn(),Tn(),kn(),$s()}))}let Ns=1,Tt=[],pr=null;function nt(e,t,n,r){Tt.push({id:Ns++,kind:e,text:t,x:n,y:r,born:performance.now()})}function Ps(){const e=performance.now();Tt=Tt.filter(t=>e-t.born<700)}let ut=null,pt=null,Ot=[];function As(e){if(!(!e.run.finished&&e.enemies.length>0&&e.phase!=="NODE")){ut=null,pt=null,Ot=[];return}if(ut!=null){const n=e.player.hp-ut;n!==0&&Rs(n)}if(pt!=null){const n=e.player.block-pt;n!==0&&Is(n)}for(let n=0;n<e.enemies.length;n++){const r=e.enemies[n].hp,o=Ot[n];o!=null&&r!==o&&Ls(n,r-o)}ut=e.player.hp,pt=e.player.block,Ot=e.enemies.map(n=>n.hp)}function Rs(e){const t=document.querySelector(".playerHudBox")??document.querySelector(".playerHudLeft");if(!t)return;const n=t.getBoundingClientRect(),r=(n.left+n.right)/2,o=n.top+14;e<0?nt("dmg",`${e}`,r,o):nt("heal",`+${e}`,r,o),t.classList.add("fxFlash"),setTimeout(()=>t.classList.remove("fxFlash"),240)}function Is(e){const t=document.querySelector(".playerHudBox")??document.querySelector(".playerHudLeft");if(!t)return;const n=t.getBoundingClientRect(),r=(n.left+n.right)/2,o=n.top+34;nt("block",e>0?`+${e}`:`${e}`,r,o)}function Ls(e,t){const r=Array.from(document.querySelectorAll(".enemyHudCenter .enemyBanner"))[e];if(!r)return;const o=r.getBoundingClientRect(),s=(o.left+o.right)/2,a=o.top+14;t<0?nt("dmg",`${t}`,s,a):nt("heal",`+${t}`,s,a),r.classList.add("fxFlash"),setTimeout(()=>r.classList.remove("fxFlash"),240)}const fr="deckrogue_uiSettings_v1";function Gt(e,t,n){return Math.max(t,Math.min(n,e))}function hr(){try{const e=localStorage.getItem(fr);if(!e)return{uiScaleDesktop:1,uiScaleMobile:1,slotCardMode:"FULL"};const t=JSON.parse(e),n=t.slotCardMode==="NAME_ONLY"?"NAME_ONLY":"FULL";return{uiScaleDesktop:Gt(Number(t.uiScaleDesktop??1)||1,.75,1.5),uiScaleMobile:Gt(Number(t.uiScaleMobile??1)||1,.75,1.5),slotCardMode:n}}catch{return{uiScaleDesktop:1,uiScaleMobile:1,slotCardMode:"FULL"}}}let te=hr();function mr(){return Nt()?te.uiScaleMobile:te.uiScaleDesktop}function P(e){return Math.round(e*mr())}function Nt(){return window.matchMedia("(max-width: 900px) and (pointer: coarse)").matches}let $e=!1;function Hs(){try{const e=localStorage.getItem("deckrogue_logCollapsed");if(e==null)return;$e=e==="1"}catch{}}function Os(){try{localStorage.setItem("deckrogue_logCollapsed",$e?"1":"0")}catch{}}let ft=null;function Ds(e){ft!=null&&window.clearTimeout(ft),ft=window.setTimeout(()=>{ft=null,gs(e)},250)}let Dt=!1;async function Bs(e,t){if(e._justStartedCombat){e._justStartedCombat=!1;return}if(!Dt){Dt=!0;try{if(e.run.finished||e.choice||Z(e)||q||e.phase==="NODE")return;let n=0;for(;n++<60&&!(e.run.finished||e.choice||q||Z(e));){const r=Mr(e,t,!1);if(!r.fn||r.disabled)break;const o=e.phase;if(r.fn(),A(e,t),e.phase==="PLACE")break;const s=_s(o);s>0&&await Ss(s)}}finally{Dt=!1}}}function br(e){const t=e.run;t.timeMove==null&&(t.timeMove=e.run.nodePickCount??0),t.nextBossTime==null&&(t.nextBossTime=40),t.forcedNext==null&&(t.forcedNext=null)}function Fs(e,t){const n=e;return n.content=t,n.time??=0,n.run.relics??=[],n.run??={},n.run.timeMove??=n.run.nodePickCount??0,n.run.nextBossTime??=40,n.run.forcedNext??=null,n.run.bossOmenText??=null,n.run.enemyLastSeenBattle??={},n.run.nodePickByType??={BATTLE:0,ELITE:0,REST:0,EVENT:0,TREASURE:0},n.run.bossPool??=["boss_gravity_master","boss_cursed_wall","boss_giant_orc","boss_soul_stealer"],n.run.nextBossId??=null,n.run.afterTreasureNodePicks??=0,n.run.deckSizeAtTreasure??=null,n.run.treasureObtained&&n.run.deckSizeAtTreasure==null&&(n.run.deckSizeAtTreasure=lr(n)),n.choiceStack??=[],n.pendingTargetQueue??=[],n.exhausted??=[],n.vanished??=[],n.choiceQueue??=[],n.choiceCtx??=null,n}function Ws(e){if(!ks())return Kt(e);const t=Es();return t?Fs(t.state,e):Kt(e)}function Us(){if(document.querySelector(".bgLayer"))return;const e=document.createElement("div");e.className="bgLayer",document.body.appendChild(e)}let On=0,Dn=0,be=null,yr=0;function fn(){try{xr.hide()}catch{}const e=document.querySelector(".cardHoverPreview");e&&e.classList.remove("on")}function hn(e=250){yr=performance.now()+e}const xr=Ks();function Ks(){let e=null,t=null,n=null,r=null;function o(i){if(e)return;e=v("cardHoverPreview"),t=v("cardHoverPreviewTitle");const l=v("cardHoverPreviewRow");n=v("cardHoverPreviewCard"),r=v("cardHoverPreviewDetail"),l.appendChild(n),l.appendChild(r),e.appendChild(t),e.appendChild(l),i.appendChild(e)}function s(i){!e||!t||!n||!r||(t.textContent=i.title,n.innerHTML="",i.cardEl&&n.appendChild(i.cardEl),r.textContent=i.detail,e.classList.add("on"))}function a(){e&&e.classList.remove("on")}return{ensure:o,show:s,hide:a}}function gt(e,t){const n=e.cards[t];return he(e.content,n.defId,n.upgrade??0)}function Et(e,t){return e.content.cardsById[t]?.name??t}function zs(e,t,n){const r=n??0,o=e.content.cardsById[t]?.name??t;return r>0?`${o} +${r}`:o}function ce(e,t){const n=e.cards[t];return zs(e,n.defId,n.upgrade??0)}function it(e,t,n,r,o){const s=e.cards[t],a=he(e.content,s.defId,s.upgrade??0),i=o?.draggable??!0,l=o?.mode??"FULL",c=v("card");e.selectedHandCardUid===t&&c.classList.add("selected"),a.tags?.includes("EXHAUST")&&c.classList.add("exhaust"),a.tags?.includes("VANISH")&&c.classList.add("vanish"),l==="SLOT_NAME_ONLY"&&c.classList.add("slotNameOnly");const h=v("cardHeader"),u=Tr(e,t);if(h.appendChild(X("cardTitle",u)),l==="FULL"){const d=v("cardMeta");a.tags?.includes("EXHAUST")&&d.appendChild(Qt("ÏÜåÎ™®")),a.tags?.includes("VANISH")&&d.appendChild(Qt("ÏÜåÏã§")),h.appendChild(d)}if(c.appendChild(h),l==="FULL"){const d=v("cardBody"),x=v("cardSection");x.classList.add("front"),x.appendChild(Fn(a.frontText)),d.appendChild(x);const _=v("cardSection");_.classList.add("back"),_.appendChild(Fn(a.backText)),d.appendChild(_),c.appendChild(d)}if(n&&r&&(c.onclick=()=>r(t)),n&&(c.onpointerdown=d=>{if(d.button!==0&&d.pointerType==="mouse"||Z(e)||e.phase!=="PLACE"||!i)return;const x=e.hand.indexOf(t);Pr(d,{kind:"hand",cardUid:t,fromHandIndex:x})}),o?.hoverPreview){const{root:d,api:x,buildDetail:_}=o.hoverPreview;x.ensure(d);const f=_?.(e,t)??(()=>{const p=Ct(a.frontText),b=Ct(a.backText);return`Ï†ÑÏó¥: ${p||"ÏóÜÏùå"}
ÌõÑÏó¥: ${b||"ÏóÜÏùå"}`})();c.addEventListener("pointerenter",p=>{if(performance.now()<yr||B?.dragging)return;const b=it(e,t,!1,void 0,{draggable:!1,mode:"FULL"});b.classList.add("isPreviewCard"),x.show({title:u,detail:f,cardEl:b})}),c.addEventListener("pointerleave",()=>{x.hide()}),c.addEventListener("pointerdown",()=>{hn(250),fn()},{capture:!0})}return c}function Ct(e){if(!e)return"";if(typeof e=="string")return e;if(Array.isArray(e))return e.map(Ct).join("");if(typeof e=="object"){if(e.text)return String(e.text);if(e.children)return Ct(e.children)}return""}function v(e){const t=document.createElement("div");return t.className=e,t}function X(e,t){const n=document.createElement("div");return n.className=e,n.textContent=t,n}function js(e){const t=document.createElement("h2");return t.textContent=e,t}function Xt(e){const t=document.createElement("h3");return t.textContent=e,t}function mn(e){const t=document.createElement("p");return t.textContent=e,t}function Qt(e){const t=document.createElement("span");return t.className="badge",t.textContent=e,t}function Jt(e,t,n){const r=document.createElement("button");return r.textContent=e,r.disabled=n,r.onclick=t,r}function qs(e){const t=document.createElement("pre");return t.className="log",t.textContent=e,t}function kr(e,t){const n=t??0;return n>0?`${e} +${n}`:e}function Tr(e,t){const n=e.cards[t],r=e.content.cardsById[n.defId].name;return kr(r,n.upgrade)}function Vs(e,t){const n=e.content.cardsById[t.defId].name;return kr(n,t.upgrade)}const Ys={Ï∑®ÏïΩ:"üéØ",ÏïΩÌôî:"ü•Ä",Ï∂úÌòà:"ü©∏",ÍµêÎûÄ:"üåÄ",Î©¥Ïó≠:"‚ú®",S:"üåæ",F:"üí§",ÎìúÎ°úÏö∞:"üÉè",ÌîºÌï¥:"üó°Ô∏è",ÌöåÎ≥µ:"üíä",Î∞©Ïñ¥:"üõ°Ô∏è",Î∏îÎ°ù:"üõ°Ô∏è",ÏÜåÎ™®:"üî•",ÏÜåÏã§:"üï≥Ô∏è"};function Bn(e,t,n){const r=Ys[e]??"",o=t!=null?`${e} ${t}`:e;return`<span class="kwBadge"><span class="kwIcon">${r}</span> <span class="kwLabel">${o}</span><span class="kwPunc">${n||""}</span></span>`}const gr="[,Ôºå„ÄÅ]",Gs=new RegExp(`(Ï∑®ÏïΩ|ÏïΩÌôî|Ï∂úÌòà|ÍµêÎûÄ|Î©¥Ïó≠|S|F|ÎìúÎ°úÏö∞|ÌîºÌï¥|Î∞©Ïñ¥|Î∏îÎ°ù|ÌöåÎ≥µ|ÏÜåÎ™®|ÏÜåÏã§)\\s*([+-]?\\d+)\\s*(${gr})?`,"g"),Xs=new RegExp(`(^|[^Í∞Ä-Ìû£A-Za-z0-9_])(ÏÜåÎ™®|ÏÜåÏã§)\\s*(${gr})?`,"g");function Qs(e){let t=e.replace(Gs,(n,r,o,s)=>Bn(r,o,s));return t=t.replace(Xs,(n,r,o,s)=>`${r}${Bn(o,void 0,s)}`),t=t.replace(/\n/g,"<br>"),t}function Fn(e){const t=v("cardText");return t.innerHTML=Qs(e),t}function Js(e){return fe(`assets/enemies/${e}.png`)}const Wn={vuln:"üéØ",weak:"ü•Ä",bleed:"ü©∏",disrupt:"üåÄ",immune:"‚ú®",supplies:"üåæ",fatigue:"üí§"};function Er(e){return e==="ATTACK"||e==="ATTACK_BUFF"||e==="ATTACK_DEBUFF"}function Zs(e,t,n){if(!n||!Er(n.cat))return"";const r=Math.max(1,Number(n.hits??1)||1),o=Math.max(0,Number(n.perHit??0)||0),s=Math.max(0,Number(n.dmgTotal??o*r)||0);if(r>1){if(o<=0)return`${s} (${r}ÌÉÄ)`;const a=o*r;if(s===a)return`${s} (${o}x${r})`;const i=Math.max(0,Number(e.player?.block??0)||0);if(i>0){let l=i;const c=[];for(let u=0;u<r;u++){const d=Math.min(l,o);l-=d,c.push(o-d)}if(c.reduce((u,d)=>u+d,0)===s)return c.every(d=>d===c[0])?`${s} (${c[0]}x${r})`:`${s} (${c.join("+")})`}return`${s} (${o}x${r})`}return`${s}`}function ea(e){if(!e)return"?";const t=Er(e.cat),n=e.applies??[],r=n.some(a=>a.target==="player"),o=n.some(a=>a.target==="enemy");let s="";if(t&&(s+="üó°Ô∏è"),r&&(s+="üåÄ"),o&&(s+="‚ú®"),!s){const a=e.cat;return a==="DEFEND"?"üõ°Ô∏è":a==="BUFF"?"‚ú®":a==="DEBUFF"?"üåÄ":"?"}return s}function ta(e,t){const n=v("enemyStatusEmojiRow"),r=(o,s)=>{if(!s||s<=0)return;const a=document.createElement("span");a.className="stEmoji",a.textContent=`${Wn[o]??"?"}${s}`,n.appendChild(a)};if(r("vuln",e?.vuln??0),r("weak",e?.weak??0),r("bleed",e?.bleed??0),r("disrupt",e?.disrupt??0),t){const o=document.createElement("span");o.className="stEmoji",o.textContent=`${Wn.immune}1`,n.appendChild(o)}return n}let q=null,Un=!1,B=null,xe=null,Zt=!1,Oe=!1,ye=null,Ne=null,Pe=null;function na(e,t,n){const r=e.cards[t];return Cr(e,r.defId,n)}function vt(e,t,n){const o=it(e,t,!!n,n,{draggable:!1});return o.classList.add("overlayCard"),o}function Cr(e,t,n){const r=`__preview:${t}:${n}:${Math.random().toString(36).slice(2)}`,o=e.cards[r];e.cards[r]={uid:r,defId:t,upgrade:n,zone:"preview"};const s=it(e,r,!1,void 0,{draggable:!1});return s.classList.add("overlayCard"),s.draggable=!1,s.style.pointerEvents="none",o?e.cards[r]=o:delete e.cards[r],s}const Ge="Ô∏é";function rt(e,t){return e==="BATTLE"?t?{icon:"‚ò†"+Ge,text:"Î≥¥Ïä§",kind:"boss"}:{icon:"‚öî"+Ge,text:"Ï†ÑÌà¨",kind:"battle"}:e==="ELITE"?{icon:"‚ò†"+Ge,text:"Ï†ïÏòà",kind:"elite"}:e==="REST"?{icon:"‚õ∫Ô∏é"+Ge,text:"Ìú¥Ïãù",kind:"rest"}:e==="EVENT"?{icon:"‚ùîÔ∏é"+Ge,text:"ÎØ∏ÏßÄ",kind:"event"}:{icon:"‚ú¶",text:"Î≥¥Î¨º",kind:"treasure"}}function ra(e,t,n){const r=rt(t,n),o=document.createElement("span");o.className=`nodeIcon ${r.kind}`,o.textContent=r.icon;const s=document.createElement("span");s.className="nodeText",s.textContent=`(${r.text})`,e.appendChild(o),e.appendChild(s)}function Kn(e){let t=2166136261;for(let n=0;n<e.length;n++)t^=e.charCodeAt(n),t=Math.imul(t,16777619);return t>>>0}function oa(e){let t=e>>>0;return t^=t<<13,t^=t>>>17,t^=t<<5,(t>>>0)/4294967296}function Me(e){return Math.max(0,Math.min(1,e))}function Bt(e,t,n){return Math.max(t,Math.min(n,Math.floor(e)))}function lt(e){const t=e.run;if(t.timeMove??=0,t.vision??={mode:"NORMAL",presenceR:2,typeR:1,detailR:0,noise:.01*e.player.fatigue},t.pursuit??={heat:0},!t.map)t.map=la();else{const o=t.map;if(Array.isArray(o.nodes)){const s={};for(const a of o.nodes)s[String(a.id)]=a;o.nodes=s}}const n=t.map;if(!Object.keys(n?.nodes??{}).every(o=>typeof n.nodes[o]?.order=="number"))try{wr(n,2)}catch{}try{bn(n)}catch{}return{map:t.map,vision:t.vision,pursuit:t.pursuit,timeMove:t.timeMove}}function vr(e){const t=e.run,n=Number(t.timeMove??0)||0,r=Number(e.time??0)||0;return n+r}function ot(e){return e>=14?3:e>=9?2:e>=5?1:0}function sa(e){const{map:t,pursuit:n}=lt(e),r=ot(n.heat??0);if(r<=0)return;const o=.05+.04*r;if(Math.random()>=o)return;const s=t.edges??={},a=Object.keys(t.nodes);if(a.length<4)return;const i=m=>Number(t.nodes[m]?.depth??999),l=m=>Number(t.nodes[m]?.order??0),c=(m,k)=>{s[m]??=[],s[k]??=[],s[m].includes(k)||s[m].push(k),s[k].includes(m)||s[k].push(m)},h=(m,k)=>{s[m]=(s[m]??[]).filter(M=>M!==k),s[k]=(s[k]??[]).filter(M=>M!==m)},u=m=>{const k=new Set,M=[m];for(k.add(m);M.length;){const T=M.shift();for(const L of s[T]??[])k.has(L)||(k.add(L),M.push(L))}return k},d=new Map;for(const m of a){const k=i(m);d.has(k)||d.set(k,[]),d.get(k).push(m)}for(const[m,k]of d)k.sort((M,T)=>l(M)-l(T)||M.localeCompare(T));const x=Array.from(d.keys()).filter(m=>d.has(m)&&d.has(m+1));if(x.length===0)return;const _=m=>{const k=d.get(m)??[],M=d.get(m+1)??[],T=new Map,L=new Map;for(let E=0;E<k.length;E++)T.set(k[E],E);for(let E=0;E<M.length;E++)L.set(M[E],E);const R=[];for(const E of k)for(const $ of s[E]??[]){if(i($)!==m+1)continue;const N=T.get(E),C=L.get($);N==null||C==null||R.push([N,C])}return{left:k,right:M,li:T,ri:L,pairs:R}},f=(m,k,M)=>{const{li:T,ri:L,pairs:R}=_(m),E=T.get(k),$=L.get(M);if(E==null||$==null)return!0;for(const[N,C]of R)if(E<N&&$>C||E>N&&$<C)return!0;return!1},p=(m,k)=>{if((s[m]??[]).includes(k))return!1;const M=i(m),T=i(k);if(Math.abs(M-T)!==1)return!1;const L=Math.min(M,T),R=M<T?m:k,E=M<T?k:m;return f(L,R,E)?!1:(c(R,E),!0)};if(Math.random()<.55){for(let m=0;m<80;m++){const k=x[Math.floor(Math.random()*x.length)],{left:M,right:T}=_(k);if(!M.length||!T.length)continue;const L=M[Math.floor(Math.random()*M.length)],R=T[Math.floor(Math.random()*T.length)];if(p(L,R)){y(e,`ÎåÄÍ≤©Î≥Ä: Í∏∏Ïù¥ ÏÉàÎ°ú Ïó¥Î†∏ÏäµÎãàÎã§. (${L} ‚Üî ${R})`);return}}return}const g=[];for(const m of a)for(const k of s[m]??[])m>=k||Math.abs(i(m)-i(k))===1&&g.push([m,k]);if(g.length!==0)for(let m=0;m<120;m++){const[k,M]=g[Math.floor(Math.random()*g.length)],T=(s[k]??[]).length,L=(s[M]??[]).length;if(T<=1||L<=1)continue;h(k,M);const R=Object.values(t.nodes).find($=>$.kind==="START")?.id??t.pos;if(u(R).size===a.length&&a.every($=>(s[$]??[]).length>=1)){y(e,`ÎåÄÍ≤©Î≥Ä: Í∏∏Ïù¥ Î¨¥ÎÑàÏ°åÏäµÎãàÎã§. (${k} ‚Üî ${M})`);return}c(k,M)}}function ze(e,t,n){const r={},o=[];for(r[t]=0,o.push(t);o.length;){const s=o.shift(),a=r[s]??0;if(a>=n)continue;const i=e.edges[s]??[];for(const l of i)r[l]==null&&(r[l]=a+1,o.push(l))}return r}function bn(e){const t=e;return t.seen||(t.seen={}),t.seen[e.pos]=3,t.seen}function aa(e,t){const n=bn(e),r=Math.max(0,t.presenceR|0),o=ze(e,e.pos,r);for(const s of Object.keys(o)){const a=o[s]??0,i=wt(a,t),l=n[s]??0;i>l&&(n[s]=i)}n[e.pos]=3}function ia(e,t){return(e.seen??{})[t]??0}function wr(e,t=2){const n=Object.keys(e.nodes);if(n.length<=2)return;e.edges??={};for(const u of Object.keys(e.edges))for(const d of(e.edges[u]??[]).slice())e.edges[d]??=[],e.edges[d].includes(u)||e.edges[d].push(u);const r=u=>Number(e.nodes[u]?.depth??999),o=u=>Number(e.nodes[u]?.order??0),s=u=>(e.edges[u]??[]).length,a=n.every(u=>{const d=r(u);return d>=0&&d<900&&typeof e.nodes[u]?.order=="number"}),i=new Map;if(a){for(const u of n){const d=r(u);i.has(d)||i.set(d,[]),i.get(d).push(u)}for(const[u,d]of i)d.sort((x,_)=>o(x)-o(_)||x.localeCompare(_))}const l=u=>{const d=i.get(u)??[],x=i.get(u+1)??[],_=new Map,f=new Map;for(let b=0;b<d.length;b++)_.set(d[b],b);for(let b=0;b<x.length;b++)f.set(x[b],b);const p=[];for(const b of d)for(const g of e.edges[b]??[]){if(r(g)!==u+1)continue;const m=_.get(b),k=f.get(g);m==null||k==null||p.push([m,k])}return{left:d,right:x,li:_,ri:f,pairs:p}},c=(u,d)=>{const x=r(u);if(r(d)!==x+1)return!0;const{li:f,ri:p,pairs:b}=l(x),g=f.get(u),m=p.get(d);if(g==null||m==null)return!0;for(const[k,M]of b)if(g<k&&m>M||g>k&&m<M)return!0;return!1},h=u=>{e.edges[u]??=[];const d=new Set(e.edges[u]??[]),x=r(u);let _=n.filter(p=>p!==u&&!d.has(p));if(_.length===0||a&&(_=_.filter(p=>Math.abs(r(p)-x)===1),_.length===0||(_=_.filter(p=>{const b=r(u),g=r(p),m=b<g?u:p,k=b<g?p:u;return!c(m,k)}),_.length===0)))return!1;_.sort((p,b)=>s(b)-s(p));const f=_[0];return e.edges[u].push(f),e.edges[f]??=[],e.edges[f].push(u),!0};for(let u=0;u<200;u++){const d=n.filter(_=>s(_)<t);if(d.length===0)break;let x=!1;for(const _ of d)for(;s(_)<t&&h(_);)x=!0;if(!x)break}}function la(){const t={},n={},r=Array.from({length:18},(h,u)=>`n${u}`);n[r[0]]=[],t[r[0]]={id:r[0],kind:"START",visited:!0,cleared:!0,depth:0};for(let h=1;h<r.length;h++){const u=r[h],d=r[Math.floor(Math.random()*h)];n[u]??=[],n[d]??=[],n[u].push(d),n[d].push(u),t[u]={id:u,kind:"BATTLE",visited:!1,cleared:!1}}const o=10;for(let h=0;h<o;h++){const u=r[Math.floor(Math.random()*r.length)],d=r[Math.floor(Math.random()*r.length)];u!==d&&(n[u]??=[],n[d]??=[],!n[u].includes(d)&&(n[u].push(d),n[d].push(u)))}const s={pos:r[0],startId:r[0],nodes:t,edges:n,treasureId:r[r.length-1]};wr(s,2);const a=ze(s,r[0],999);let i=r[1],l=-1;for(const h of r){const u=a[h]??999;t[h].depth=u,h!==r[0]&&u>l&&(l=u,i=h)}for(const h of r)h!==r[0]&&(t[h].kind="BATTLE");const c=["BATTLE","BATTLE","BATTLE","EVENT","REST","ELITE"];for(const h of r){if(h===r[0]||h===i)continue;const u=c[Math.floor(Math.random()*c.length)];t[h].kind=u}return t[i].kind="TREASURE",{pos:r[0],startId:r[0],nodes:t,edges:n,visionNonce:1,treasureId:i}}function ca(e){const{vision:t,pursuit:n}=lt(e),r=e.run,o=Number(r.timeMove??0)||0,s=t;s.forceModeUntilMove!=null&&o>=Number(s.forceModeUntilMove)&&(s.forceModeUntilMove=null,s.forceMode=null),s.switchLockedUntilMove!=null&&o>=Number(s.switchLockedUntilMove)&&(s.switchLockedUntilMove=null);let a=s.forceMode??t.mode??"NORMAL",i=Number(t.presenceR??2)||0,l=Number(t.typeR??1)||0,c=Number(t.detailR??0)||0,h=Me(Number(t.noise??.08)||0);if(a==="FOCUS"?(i-=1,l-=1,c+=1,h*=.6):a==="WIDE"&&(i+=1,l+=1,c+=0,h=Me(h*1.35)),e.run.treasureObtained){const d=ot(n.heat??0);i+=d>=2?1:0,l-=d,c-=Math.max(0,d-1),h=Me(h+d*.07)}const u=Math.max(0,Number(e.player.fatigue??0)||0);if(u>0){const d=Math.floor(u/14),x=Math.floor(u/6),_=Math.floor(u/10);i-=d,l-=x,c-=_,h=Me(h+Math.min(.3,u*.015))}return i=Bt(i,0,99),l=Bt(l,0,i),c=Bt(c,0,l),h=Me(h),{mode:a,presenceR:i,typeR:l,detailR:c,noise:h}}function wt(e,t){return e<=0||e<=t.detailR?3:e<=t.typeR?2:e<=t.presenceR?1:0}function St(e,t,n,r,o){if(r===0)return{shown:null,label:"Î≥¥Ïù¥ÏßÄ ÏïäÏùå",certainty:"HIDDEN"};if(r===1)return{shown:null,label:"Î¨¥Ïñ∏Í∞Ä",certainty:"PRESENCE"};if(n==="START")return{shown:null,label:"ÏûÖÍµ¨",certainty:r===3?"DETAIL":"TYPE"};if(n==="EMPTY")return{shown:null,label:"ÏßÄÎÇòÍ∞Ñ Í≥≥",certainty:"PRESENCE"};if(r===3)return{shown:n,label:rt(n,!1).text,certainty:"DETAIL"};const s=Kn(t)^Math.imul(Kn(String(e.run.map?.visionNonce??1)),2654435761);return oa(s)<o.noise?{shown:null,label:"Î¨¥Ïñ∏Í∞Ä",certainty:"PRESENCE"}:{shown:n,label:rt(n,!1).text,certainty:"TYPE"}}function da(e,t){const n=v("mapNodeLine");if(n.style.cssText=`display:flex; gap:${P(8)}px; align-items:center;`,t.shown)ra(n,t.shown,!1);else{const r=document.createElement("span");r.className="nodeText",r.textContent=`(${t.label})`,n.appendChild(r)}e.appendChild(n)}function ua(e){const t=Object.keys(e.nodes);if(t.length===0||t.every(s=>{const a=e.nodes[s]?.depth,i=Number(a);return a!=null&&Number.isFinite(i)&&i>=0&&i<900}))return;const r=Object.values(e.nodes).find(s=>s.kind==="START")?.id??e.pos??t[0],o=ze(e,r,999);for(const s of t){const a=e.nodes[s]?.depth;if(a!=null&&Number.isFinite(Number(a))&&Number(a)<900)continue;const i=o[s];e.nodes[s].depth=i??e.nodes[s].depth??999}}function pa(e){ua(e);const t=Object.keys(e.nodes),n=t.every(E=>typeof e.nodes[E]?.order=="number"),r=new Map;let o=0;for(const E of t){const $=Number(e.nodes[E]?.depth??999),N=Number.isFinite($)?$:999;o=Math.max(o,N),r.has(N)||r.set(N,[]),r.get(N).push(E)}const s=Array.from(r.keys()).sort((E,$)=>E-$),a=s.filter(E=>E<900).length?Math.max(...s.filter(E=>E<900)):o,i=s.some(E=>E>=900),l=a+(i?1:0),c=110,h=64,u=54,d=40,x=E=>{const $=Number(e.nodes[E]?.depth??999),N=Number.isFinite($)?$:999;return N>=900?a+1:N},_=Array.from({length:l+1},(E,$)=>$),f={};for(const E of _)f[E]=[];for(const E of t){const $=x(E);f[$].push(E)}for(const E of _)f[E].sort(($,N)=>(e.nodes[$].order??0)-(e.nodes[N].order??0)||$.localeCompare(N));const p=E=>{const $=new Map,N=f[E]??[];for(let C=0;C<N.length;C++)$.set(N[C],C);return $},b=E=>e.edges[E]??[],g=E=>{if(E==="LR")for(let $=1;$<=l;$++){const N=f[$-1];if(!N||N.length===0)continue;const C=p($-1);f[$].sort((w,S)=>{const O=m(w,C,$-1),H=m(S,C,$-1);return O!==H?O-H:w.localeCompare(S)})}else for(let $=l-1;$>=0;$--){const N=f[$+1];if(!N||N.length===0)continue;const C=p($+1);f[$].sort((w,S)=>{const O=m(w,C,$+1),H=m(S,C,$+1);return O!==H?O-H:w.localeCompare(S)})}},m=(E,$,N)=>{const C=b(E);let I=0,w=0;for(const S of C){if(x(S)!==N)continue;const O=$.get(S);O!=null&&(I+=O,w+=1)}if(w===0){const S=x(E),O=(f[S]??[]).indexOf(E);return O<0?9999:O}return I/w};if(!n)for(let E=0;E<4;E++)g("LR"),g("RL");let k=1;for(const E of _)k=Math.max(k,f[E]?.length??0);const M=k*h,T=d*2+M,L=u*2+(l+1)*c,R={};for(const E of _){const $=f[E]??[],N=$.length,C=N*h,I=(M-C)/2,w=u+E*c;for(let S=0;S<N;S++){const O=$[S],H=d+I+(S+.5)*h;R[O]={x:w,y:H,depth:Number(e.nodes[O]?.depth??999)}}}return{width:L,height:T,pos:R,maxDepth:l,maxCount:k}}function fa(e,t,n){return n?"‚óé":t==="HIDDEN"?"":t==="PRESENCE"?"¬∑":e?rt(e,!1).icon:"?"}function ha(e,t,n,r,o,s){const a=pa(r),i=bn(r),l=ze(r,r.pos,Math.max(0,o.presenceR|0)),c=W=>W===r.pos||(i[W]??0)>0,h=Object.keys(r.nodes).filter(c);h.includes(r.pos)||h.push(r.pos);const u=70;let d=1/0,x=1/0,_=-1/0,f=-1/0;for(const W of h){const j=a.pos[W];j&&(d=Math.min(d,j.x),x=Math.min(x,j.y),_=Math.max(_,j.x),f=Math.max(f,j.y))}Number.isFinite(d)||(d=0,x=0,_=300,f=200);const p=d-u,b=x-u,g=_-d+u*2,m=f-x+u*2,k=1.4,M=460,T="#0B0B0B",L="#1A0B0B",R="rgba(242,241,234,.70)",E="rgba(242,241,234,.34)",$="rgba(242,241,234,1)",N="rgba(179,74,70,.34)",C=L,I=T,w=v("mapMiniBox");w.style.cssText=`margin-top:${P(12)}px; border:1px solid rgba(255,255,255,.12); border-radius:${P(12)}px; background:rgba(0,0,0,.18); padding:${P(10)}px;`;const S=X("","ÏßÄÎèÑ");S.style.cssText=`font-weight:700; margin-bottom:${P(8)}px; opacity:.95;`,w.appendChild(S);const O=v("mapMiniScroller"),H=v("mapMiniViewport");O.appendChild(H),O.style.cssText=`position:relative; overflow:auto; max-height:${P(M)}px; border-radius:${P(10)}px; background:rgba(255,255,255,.02);`,H.addEventListener("wheel",W=>{Math.abs(W.deltaY)>Math.abs(W.deltaX)&&(H.scrollLeft+=W.deltaY,W.preventDefault())},{passive:!1});const F=document.createElementNS("http://www.w3.org/2000/svg","svg");F.setAttribute("viewBox",`${p} ${b} ${g} ${m}`),F.setAttribute("width",String(P(g*k))),F.setAttribute("height",String(P(m*k))),F.setAttribute("preserveAspectRatio","xMidYMid meet"),F.style.display="block";const K=document.createElementNS("http://www.w3.org/2000/svg","g"),D=document.createElementNS("http://www.w3.org/2000/svg","g");F.appendChild(K),F.appendChild(D);const z=new Set(r.edges[r.pos]??[]),U=(W,j,J)=>{const ee=Math.max(0,Math.min(3,J));return St(t,W,j,ee,{...o,noise:0})},Y=(W,j)=>{const J=W.x,ee=W.y,oe=j.x,se=j.y,de=Math.abs((W.depth??0)-(j.depth??0));if(de===0)return`M ${J} ${ee} L ${oe} ${se}`;if(de>=2){const Pt=38+10*de,ae=Math.max(J,oe)+Pt;return`M ${J} ${ee} C ${ae} ${ee}, ${ae} ${se}, ${oe} ${se}`}const Re=oe-J,we=J+Re*.35,je=J+Re*.65;return`M ${J} ${ee} C ${we} ${ee}, ${je} ${se}, ${oe} ${se}`},V=new Set(h);for(const W of h)for(const j of r.edges[W]??[]){if(W>=j||!V.has(j))continue;const J=r.nodes[W]?.depth,ee=r.nodes[j]?.depth;if(J!=null&&ee!=null&&Math.abs(Number(J)-Number(ee))>1)continue;const oe=a.pos[W],se=a.pos[j];if(!oe||!se)continue;const de=document.createElementNS("http://www.w3.org/2000/svg","path");de.setAttribute("d",Y(oe,se)),de.setAttribute("fill","none"),de.setAttribute("stroke",R),de.setAttribute("stroke-width","2"),K.appendChild(de)}const ve=h.slice().sort((W,j)=>W.localeCompare(j));for(const W of ve){const j=a.pos[W];if(!j)continue;const J=r.nodes[W],ee=J?.kind??"BATTLE",oe=l[W],se=W===r.pos?3:oe==null?0:wt(oe,o),de=i[W]??0,Re=se>0?St(t,W,ee,se,o):U(W,ee,de),we=W===r.pos,je=z.has(W),Pt=ee==="START",ae=document.createElementNS("http://www.w3.org/2000/svg","circle");ae.setAttribute("cx",String(j.x)),ae.setAttribute("cy",String(j.y)),ae.setAttribute("r",String(we?13:10));const En=we||je;ae.setAttribute("fill",En?N:E),ae.setAttribute("stroke",En?C:$),ae.setAttribute("stroke-width",String(we?3:2)),ae.style.cursor=je&&!we?"pointer":"default",je&&!we&&ae.addEventListener("click",vn=>{vn.preventDefault(),vn.stopPropagation(),n.onMoveToNode?.(W)});const Cn=document.createElementNS("http://www.w3.org/2000/svg","title"),Ir=J?.cleared?"ÌÅ¥Î¶¨Ïñ¥":J?.visited?"Î∞©Î¨∏":"ÎØ∏Î∞©Î¨∏";Cn.textContent=`${Ir}`,ae.appendChild(Cn),D.appendChild(ae);const le=document.createElementNS("http://www.w3.org/2000/svg","text");le.setAttribute("x",String(j.x)),le.setAttribute("y",String(j.y)),le.setAttribute("dy","0.05em"),le.setAttribute("dominant-baseline","central"),le.setAttribute("text-anchor","middle"),le.setAttribute("font-size","14"),le.setAttribute("fill",I),le.style.pointerEvents="none",le.style.userSelect="none";const Lr=fa(Re.shown,Re.certainty,Pt);le.textContent=Lr,le.style.opacity="0.95",D.appendChild(le)}H.appendChild(F),w.appendChild(O),requestAnimationFrame(()=>{const W=a.pos[r.pos];if(!W)return;const j=mr(),J=(W.x-p)*j*k,ee=(W.y-b)*j*k,oe=Math.max(0,J-H.clientWidth*.45),se=Math.max(0,ee-H.clientHeight*.45);H.scrollLeft=oe,H.scrollTop=se});const gn=X("","Í¥ÄÏ∏° Í∞ÄÎä•Ìïú Í≥≥Îßå ÏßÄÎèÑÏóê ÎìúÎü¨ÎÇ©ÎãàÎã§. Ïù∏Ï†ë ÎÖ∏ÎìúÎ•º ÌÅ¥Î¶≠Ìï¥ Ïù¥ÎèôÌï† Ïàò ÏûàÏäµÎãàÎã§.");gn.style.cssText=`margin-top:${P(8)}px; font-size:12px; opacity:.8; line-height:1.3;`,w.appendChild(gn),e.appendChild(w)}function ma(e,t,n){const{map:r,timeMove:o,pursuit:s}=lt(t),a=ca(t);aa(r,a);const i=v("nodeSelectWrap");i.classList.add("mapNodeSelect");const l=v("nodeSelectHeader");l.style.cssText="display:flex; align-items:flex-end; justify-content:space-between; gap:16px;";const c=v("nodeSelectTitle"),h=vr(t),u=t.run.nodePickCount??0;c.appendChild(X("",`Ï¥ù ÏãúÍ∞Ñ ${h} ¬∑ ÌÉêÌóò ${u} ¬∑ Ïù¥Îèô ${o}`)),br(t);const d=t.run,x=Number(d.nextBossTime??40)||40,_=Math.max(0,x-h),f=t.run.bossOmenText&&String(t.run.bossOmenText).trim()!==""?String(t.run.bossOmenText):"ÏïÑÏßÅ ÏßïÏ°∞Í∞Ä ÏóÜÎã§.";if(c.appendChild(X("",`Îã§Ïùå Î≥¥Ïä§ÍπåÏßÄ ${_} ¬∑ ${f}`)),t.run.treasureObtained){const m=ze(r,r.pos,9999)[r.startId],k=m==null?"?":String(m);c.appendChild(X("",`Ï∂îÍ≤© ${s.heat??0} (tier ${ot(s.heat??0)}) ¬∑ ÏûÖÍµ¨ÍπåÏßÄ ${k}`))}const p=v("nodeSelectHeaderRight"),b=X("",`Ïò§Î•ò ${Math.round(a.noise*100)}%`);b.style.opacity="0.8",p.appendChild(b);const g=ne(Oe?"ÏÉÅÏÑ∏ Îã´Í∏∞":"ÏÉÅÏÑ∏",()=>{Oe=!Oe,A(t,n)});if(g.style.cssText=`margin-left:${P(-10)}px; padding:${P(2)}px ${P(5)}px; opacity:.9;`,p.appendChild(g),l.appendChild(c),l.appendChild(p),i.appendChild(l),ha(i,t,n,r,a),Oe){const m=v("mapDetailPanel");m.style.cssText=`position:fixed; right:${P(24)}px; top:${P(24)}px; width:min(${P(520)}px, calc(100vw - ${P(64)}px)); max-height:calc(100vh - ${P(64)}px); overflow-y:auto; overflow-x:hidden; z-index:70001; border:1px solid rgba(255,255,255,.14); border-radius:${P(14)}px; background:rgba(0,0,0,1); backdrop-filter:none; padding:${P(12)}px;`,m.addEventListener("click",N=>N.stopPropagation()),m.addEventListener("wheel",N=>N.stopPropagation(),{passive:!0});const k=N=>{const C=N.target;C&&m.contains(C)||(Oe=!1,document.removeEventListener("pointerdown",k,!0),A(t,n))},M=v("");M.style.cssText=`display:flex; align-items:center; justify-content:space-between; gap:${P(10)}px;`;const T=X("","ÏßÄÎèÑ ÏÉÅÏÑ∏");T.style.cssText="font-weight:700; opacity:.95;",M.appendChild(T);const L=ne("Îã´Í∏∞",()=>{Oe=!1,A(t,n)});L.style.cssText=`padding:${P(6)}px ${P(10)}px; opacity:.9;`,M.appendChild(L),m.appendChild(M);const R=v("");R.style.cssText=`margin-top:${P(10)}px; padding:${P(10)}px; border:1px solid rgba(255,255,255,.10); border-radius:${P(12)}px; background:rgba(255,255,255,.03);`;const E=Xt("Ïù¥Îèô Í∞ÄÎä•Ìïú Ïù¥ÏõÉ");E.style.margin=`0 0 ${P(6)}px 0`,R.appendChild(E);const $=r.edges[r.pos]??[];$.length===0&&R.appendChild(mn("Ïù¥ÏõÉÏù¥ ÏóÜÏäµÎãàÎã§."));for(let N=0;N<$.length;N++){const C=$[N],w=r.nodes[C]?.kind??"BATTLE",S=a.presenceR>=1?wt(1,a):0,O=ia(r,C),H=S>0?St(t,C,w,S,a):O>=2?w==="START"?{shown:null,label:"ÏûÖÍµ¨"}:{shown:w,label:rt(w,!1).text}:O===1?{shown:null,label:"Î¨¥Ïñ∏Í∞Ä"}:{shown:null,label:"Î≥¥Ïù¥ÏßÄ ÏïäÏùå"},F=v("");F.style.cssText=`display:flex; align-items:center; gap:${P(10)}px; padding:${P(8)}px ${P(10)}px; border-radius:${P(10)}px; border:1px solid rgba(255,255,255,.10); background:rgba(0,0,0,.20);margin-top:${P(6)}px;`;const K=X("",S>0||O>0?`${C}`:`Ï∂úÍµ¨ ${N+1}`);K.style.cssText=`flex:0 0 auto; padding:${P(4)}px ${P(8)}px; border-radius:${P(10)}px; border:1px solid rgba(255,255,255,.14); background:rgba(0,0,0,.25); opacity:.9;`,F.appendChild(K);const D=v("");D.style.cssText="flex:1 1 auto; min-width:0;",da(D,H),F.appendChild(D),R.appendChild(F)}if(m.appendChild(R),a.presenceR>=2){const N=ze(r,r.pos,a.presenceR),C=Object.keys(N).filter(I=>(N[I]??999)>=2&&(N[I]??999)<=a.presenceR).sort((I,w)=>N[I]-N[w]||I.localeCompare(w));if(C.length){const I=v("");I.style.cssText=`margin-top:${P(10)}px; padding:${P(10)}px; border:1px solid rgba(255,255,255,.10); border-radius:${P(12)}px; background:rgba(255,255,255,.03);`;const w=Xt("Î©ÄÎ¶¨ Î≥¥Ïù¥Îäî Í≥≥");w.style.margin=`0 0 ${P(6)}px 0`,I.appendChild(w);const S=new Map;for(const H of C){const F=N[H]??0,D=r.nodes[H]?.kind??"BATTLE",z=wt(F,a),U=St(t,H,D,z,a),Y=U.certainty==="PRESENCE"?"Î¨¥Ïñ∏Í∞Ä":U.label,V=S.get(F)??{};V[Y]=(V[Y]??0)+1,S.set(F,V)}const O=Array.from(S.keys()).sort((H,F)=>H-F);for(const H of O){const F=S.get(H),K=Object.keys(F).map(D=>`${D}√ó${F[D]}`);I.appendChild(X("",`Í±∞Î¶¨ ${H}: ${K.join(" ¬∑ ")}`))}m.appendChild(I)}}document.addEventListener("pointerdown",k,!0),e.appendChild(m)}e.appendChild(i)}function ba(e,t,n){lt(t),ma(e,t,n)}function Sr(e,t){let n=null,r=!1,o=!1;const s=[];function a(f){s.length=0,f.choice=null,n=null,document.querySelector(".choice-overlay")?.remove()}function i(f){s.push({choice:f.choice,handler:n})}function l(f){const p=s.pop();if(!p){c(f);return}f.choice=p.choice,n=p.handler}function c(f){if(s.length>0){l(f);return}f.choice=null,n=null,document.querySelector(".choice-overlay")?.remove()}function h(f,p,b){f.choice&&i(f),f.choice=p,n=b}const u=()=>be||e,d={onHotkeySlot:(f,p)=>{const b=u();if(b.run.finished||Z(b)||b.phase!=="PLACE"||f==="back"&&b.backSlotDisabled?.[p])return;const g=f==="front"?b.frontSlots:b.backSlots,m=g[p];if(!b.selectedHandCardUid){if(!m)return;d.onReturnSlotToHand(f,p);return}const k=b.selectedHandCardUid;if(!m){d.onPlaceHandUidToSlot(k,f,p);return}g[p]=null,b.usedThisTurn=Math.max(0,b.usedThisTurn-1),f==="front"&&(b.frontPlacedThisTurn=Math.max(0,b.frontPlacedThisTurn-1)),b.hand.push(m),b.cards[m].zone="hand",$n(b,k,f,p),b.selectedHandCardUid=null,y(b,`[${ce(b,k)}] ‚Üî [${ce(b,m)}] Ïä§Ïôë: ÏÜêÌå® ‚Üî ${f}${p+1}`),A(b,d)},rerender:()=>{const f=u();A(f,d)},onToggleLogOverlay:()=>{Zt=!Zt,A(u(),d)},onCloseOverlay:()=>{const f=u();q=null,A(f,d)},onNewRun:()=>{const f=u();xe=null,q=null,B=null,c(f),Ts(),t(Kt(f.content))},onViewRulebook:()=>{const f=u();q={kind:"RULEBOOK"},A(f,d)},onViewPile:f=>{const p=u();q={kind:"PILE",pile:f},A(p,d)},onViewSettings:()=>{const f=u();q={kind:"SETTINGS"},A(f,d)},onReturnSlotToHand:(f,p)=>{const b=u();if(b.run.finished||Z(b)||b.phase!=="PLACE")return;const g=f==="front"?b.frontSlots:b.backSlots,m=g[p];m&&(g[p]=null,b.usedThisTurn=Math.max(0,b.usedThisTurn-1),f==="front"&&(b.frontPlacedThisTurn=Math.max(0,b.frontPlacedThisTurn-1)),b.hand.push(m),b.cards[m].zone="hand",y(b,`[${ce(b,m)}] ÌöåÏàò: ${f}${p+1} ‚Üí ÏÜêÌå®`),A(b,d))},onClearSelected:()=>{const f=u();f.selectedHandCardUid=null,A(f,d)},onSelectEnemy:f=>{const p=u();if(o)return;o=!0,requestAnimationFrame(()=>{o=!1});const b=es(p,f);A(p,d),b&&!p.choice&&!p.run.finished&&d.onAutoAdvance()},onSelectHandCard:f=>{const p=u();Z(p)||(p.selectedHandCardUid=p.selectedHandCardUid===f?null:f,A(p,d))},onMoveToNode:f=>{const p=u();if(p.run.finished||p.choice||p.phase!=="NODE"||r)return;r=!0,setTimeout(()=>r=!1,180);const b=p.run,{map:g,pursuit:m}=lt(p),k=g.pos;if(!(g.edges[k]??[]).includes(f))return;b.timeMove=Number(b.timeMove??0)+1,g.visionNonce=Number(g.visionNonce??0)+1,g.pos=f;const T=g.nodes[f]??(g.nodes[f]={id:f,kind:"BATTLE"}),L=!T.visited;if(L&&(T.visited=!0,p.run.nodePickCount=(p.run.nodePickCount??0)+1),p.run.treasureObtained){if(m.heat=Number(m.heat??0)+1,ot(m.heat),sa(p),g.pos===g.startId){p.run.finished=!0,y(p,"Î≥¥Î¨ºÏùÑ Îì§Í≥† ÏûÖÍµ¨Î°ú ÎèåÏïÑÏôîÎã§! ÌÉàÏ∂úÏóê ÏÑ±Í≥µÌñàÏäµÎãàÎã§!"),A(p,d);return}L&&T.kind!=="TREASURE"&&T.kind!=="START"&&(p.run.afterTreasureNodePicks=(p.run.afterTreasureNodePicks??0)+1)}br(p);const R=vr(p);if(Number(b.nextBossTime??0)>0&&R>=Number(b.nextBossTime??0)){b.forcedNext=null,b.nextBossTime=Number(b.nextBossTime??0)+40,p.run.bossOmenText=null,T.cleared=!0,T.kind="EMPTY",T.noRespawn=!0,T.lastClearedMove=Number(b.timeMove??0),y(p,"ÏãúÍ∞ÑÏù¥ Îã§ ÎêòÏñ¥ Î≥¥Ïä§Í∞Ä ÎÇòÌÉÄÎÇ©ÎãàÎã§. (ÏãúÍ∞Ñ +1)"),Le(p,{forceBoss:!0}),Ve(p),A(p,d);return}const E=Number(b.timeMove??0)||0;T.cleared&&(T.kind==="BATTLE"||T.kind==="EVENT"||T.kind==="REST"||T.kind==="ELITE")&&(T.kind==="ELITE"&&(T.noRespawn=!0),T.kind="EMPTY",T.lastClearedMove=Number(T.lastClearedMove??E));let $=T.kind;if($==="EMPTY"){const N=!!T.noRespawn,C=Number(T.lastClearedMove??-999),I=Number(b.respawnCooldownMoves??2)||2,w=E-C<=I;if(!N&&!w){const S=p.run.treasureObtained?ot(m.heat):0,O=Math.max(0,Number(p.player.fatigue??0)||0),H=Me(O/25)*.18,F=p.run.treasureObtained?.22:.12,K=p.run.treasureObtained?.1:.08,D=Me(F+S*K+H);if(Math.random()<D){const z=Math.random(),U=p.run.treasureObtained?.72:.55,Y=p.run.treasureObtained?.9:.85;$=z<U?"BATTLE":z<Y?"EVENT":"REST",T.kind=$,T.cleared=!1,T.respawnCount=Number(T.respawnCount??0)+1,y(p,"Ïû¨Î∞úÎèô: Ïù¥Í≥≥ÏóêÏÑú Îã§Ïãú Î¨¥Ïñ∏Í∞ÄÍ∞Ä ÏùºÏñ¥ÎÇ©ÎãàÎã§...")}}}if($==="START"){A(p,d);return}if($==="TREASURE"){T.cleared=!0,T.kind="EMPTY",T.noRespawn=!0,T.lastClearedMove=E,vo(p),A(p,d);return}if($==="REST"){T.cleared=!0,T.kind="EMPTY",T.lastClearedMove=E;const N=(p.player.fatigue??0)>=10;p.choice={kind:"EVENT",title:"Ìú¥Ïãù",art:fe("assets/events/event_rest.png"),prompt:N?"ÌîºÎ°úÍ∞Ä ÎÑàÎ¨¥ ÎÜíÏïÑ ÏãúÍ∞ÑÏù¥ Îçî Í±∏Î¶¥ Ïàò ÏûàÏäµÎãàÎã§.":"Ï∫†ÌîÑÏóê Ïû†Ïãú Î®∏Î¨∏Îã§.",options:[{key:"rest:heal",label:"ÌöåÎ≥µ",detail:"HP +15"},{key:"rest:clear_f",label:"Ï†ïÎπÑ",detail:"F -3"},{key:"rest:upgrade",label:"Í∞ïÌôî",detail:"Ïπ¥Îìú 1Ïû• Í∞ïÌôî"},{key:"rest:skip",label:"Îñ†ÎÇòÍ∏∞"}]},p.choiceCtx={kind:"REST",highF:N},A(p,d);return}if($==="EVENT"){T.cleared=!0,T.kind="EMPTY",T.lastClearedMove=E;const N=p.run;N.seenOneTimeEvents??={},N.ominousProphecyLockedUntilBossKill??=!1;const C=H=>H==="goblin_ambush_low_supplies"||H==="rat_circle",I=H=>H==="ominous_prophecy"&&N.ominousProphecyLockedUntilBossKill===!0||C(H)&&N.seenOneTimeEvents?.[H]===!0,w=.3;let S=null;N.ominousProphecyLockedUntilBossKill!==!0&&Math.random()<w&&(S=Yt("ominous_prophecy")),S||(S=Rn(p));for(let H=0;H<80&&S&&I(S.id);H++)S=Rn(p);if(S&&I(S.id)&&(S=Yt("drop_bag")??S),S?.id==="ominous_prophecy"&&(N.ominousProphecyLockedUntilBossKill=!0),S?.id&&C(S.id)&&(N.seenOneTimeEvents[S.id]=!0),!S){A(p,d);return}const O=S.options(p);p.choice={kind:"EVENT",title:S.name,prompt:S.prompt,art:S.art??null,options:O.map(H=>({key:H.key,label:H.label,detail:H.detail}))},n=H=>{const F=O.find(z=>z.key===H);if(!F)return;const K=ke(p);K.eventPicks+=1,me(p);const D=F.apply(p);if(typeof D=="object"&&D.kind==="UPGRADE_PICK"){_(p,d,D.title??"Í∞ïÌôî",D.prompt??"Í∞ïÌôîÌï† Ïπ¥Îìú 1Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.");return}if(typeof D=="object"&&D.kind==="REMOVE_PICK"){const z=Object.values(p.cards).filter(U=>U.zone==="deck"||U.zone==="hand"||U.zone==="discard").map(U=>U.uid);h(p,{kind:"PICK_CARD",title:D.title,prompt:D.prompt??"Ï†úÍ±∞Ìï† Ïπ¥Îìú 1Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.",options:[...z.map(U=>{const Y=gt(p,U);return{key:`remove:${U}`,label:ce(p,U),detail:`Ï†ÑÏó¥: ${Y.frontText} / ÌõÑÏó¥: ${Y.backText}`,cardUid:U}}),{key:"cancel",label:"Ï∑®ÏÜå"}]},U=>{if(U==="cancel"){y(p,"Ï†úÍ±∞ Ï∑®ÏÜå"),c(p),A(p,d);return}if(!U.startsWith("remove:")){A(p,d);return}const Y=U.slice(7);_t(p,Y);const V=D.then,ve=V==="REWARD"||V==="REWARD_PICK"?"REWARD_PICK":V==="BATTLE"?"BATTLE":V==="NONE"?"NONE":void 0;if(ve==="BATTLE"){a(p),p.phase="NODE",Le(p),Ve(p),A(p,d);return}if(ve==="REWARD_PICK"){a(p),x(p,d,"Ïπ¥Îìú Î≥¥ÏÉÅ","Îëê Ïû• Ï§ë Ìïú Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÍ±∞ÎÇò ÏÉùÎûµÌï©ÎãàÎã§."),A(p,d);return}a(p),p.phase="NODE",A(p,d)}),A(p,d);return}if(typeof D=="object"&&D.kind==="BATTLE_SPECIAL"){a(p),p.run.onWinGrantRelicId=D.onWinGrantRelicId??null,y(p,D.title?`Ïù¥Î≤§Ìä∏ Ï†ÑÌà¨: ${D.title}`:"Ïù¥Î≤§Ìä∏ Ï†ÑÌà¨ Î∞úÏÉù!");const z=p.run;z.pendingEventWinRelicId=D.onWinGrantRelicId??null,p.phase="NODE",Le(p,{forcePatternIds:D.enemyIds}),p._justStartedCombat=!0,Ve(p),A(p,d);return}if(D==="BATTLE"){a(p),p.phase="NODE",Le(p),p._justStartedCombat=!0,Ve(p),A(p,d);return}if(D==="REWARD"){a(p),x(p,d,"Ïπ¥Îìú Î≥¥ÏÉÅ","Îëê Ïû• Ï§ë Ìïú Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÍ±∞ÎÇò ÏÉùÎûµÌï©ÎãàÎã§."),A(p,d);return}c(p),A(p,d)},A(p,d);return}if($==="BATTLE"||$==="ELITE"){T.cleared=!0,T.kind="EMPTY",T.lastClearedMove=E,$==="ELITE"&&(T.noRespawn=!0),y(p,"Ïù¥Îèô ÌõÑ Ï†ÑÌà¨ ÏãúÏûë (ÏãúÍ∞Ñ +1)"),$==="ELITE"?Le(p,{forceBoss:!1,forceElite:!0}):Le(p,{forceBoss:!1}),Ve(p),A(p,d);return}A(p,d)},onChooseChoice:f=>{const p=u();if(!p.choice)return;const b=p.choice.kind;if(ys(p,f)){const g=b==="EVENT"&&f==="startBattle";A(p,d),g||d.onAutoAdvance();return}if(n){n(f);const g=b==="EVENT"&&f==="startBattle";A(p,d),g||d.onAutoAdvance();return}y(p,`ÏÑ†ÌÉù Ï≤òÎ¶¨ Î∂àÍ∞Ä: handler ÏóÜÏùå (kind=${b}, key=${f})`)},onAutoAdvance:()=>{const f=u();Bs(f,d)},onRevealIntents:()=>{const f=u();f.run.finished||f.enemies.length!==0&&(cn(f),A(f,d))},onPlaceHandUidToSlot:(f,p,b)=>{const g=u();g.run.finished||Z(g)||g.phase==="PLACE"&&(p==="back"&&g.backSlotDisabled?.[b]||($n(g,f,p,b),g.selectedHandCardUid=null,A(g,d)))},onPlaceSelected:(f,p)=>{const b=u();b.selectedHandCardUid&&d.onPlaceHandUidToSlot(b.selectedHandCardUid,f,p)},onMoveSlotCard:(f,p,b,g)=>{const m=u();if(m.run.finished||Z(m)||m.phase!=="PLACE"||b==="back"&&m.backSlotDisabled?.[g])return;const k=f==="front"?m.frontSlots:m.backSlots,M=b==="front"?m.frontSlots:m.backSlots,T=k[p];if(!T)return;const L=M[g];k[p]=L??null,M[g]=T,m.cards[T].zone=b,L&&(m.cards[L].zone=f),f!==b&&(f==="front"&&(m.frontPlacedThisTurn=Math.max(0,m.frontPlacedThisTurn-1)),b==="front"&&(m.frontPlacedThisTurn+=1),L&&(b==="front"&&(m.frontPlacedThisTurn=Math.max(0,m.frontPlacedThisTurn-1)),f==="front"&&(m.frontPlacedThisTurn+=1))),y(m,L?`[${ce(m,T)}] ‚Üî [${ce(m,L)}] Ïä§Ïôë: ${f}${p+1} ‚Üî ${b}${g+1}`:`[${ce(m,T)}] Ïù¥Îèô: ${f}${p+1} ‚Üí ${b}${g+1}`),en(m),A(m,d)},onResolveBack:()=>{const f=u();f.phase==="PLACE"&&en(f),Ko(f),A(f,d)},onResolveFront:()=>{const f=u();zo(f),A(f,d)},onResolveEnemy:()=>{const f=u();qo(f),A(f,d)},onUpkeep:()=>{const f=u();Go(f),A(f,d)},onDrawNextTurn:()=>{const f=u();Qo(f),A(f,d)}};function x(f,p,b,g){const k=rr(f).map(M=>{const T=he(f.content,M.defId,M.upgrade);return{key:`pick:${M.defId}:${M.upgrade}`,label:Vs(f,M),detail:`Ï†ÑÏó¥: ${T.frontText} / ÌõÑÏó¥: ${T.backText}`}});f.choice={kind:"REWARD",title:b,prompt:g,options:[...k,{key:"skip",label:"ÏÉùÎûµ"}]},n=M=>{if(n=null,M.startsWith("pick:")){const T=M.slice(5),[L,R]=T.split(":"),E=Number(R??"0")||0;dn(f,L,{upgrade:E})}else y(f,"Ïπ¥Îìú Î≥¥ÏÉÅ ÏÉùÎûµ");c(f),f.choice=null,f.run.finished||(f.phase="NODE"),A(f,p)},A(f,p)}function _(f,p,b,g,m){let k=Object.values(f.cards).filter(R=>(R.zone==="deck"||R.zone==="hand"||R.zone==="discard")&&$t(f,R.uid)).map(R=>R.uid);const M=f.player.fatigue??0;let T=1/0;if(M>=8?T=4:M>=5&&(T=8),T!==1/0&&k.length>T&&(k=[...k].sort(()=>Math.random()-.5).slice(0,T)),k.length===0){y(f,"Í∞ïÌôîÌï† Ïàò ÏûàÎäî Ïπ¥ÎìúÍ∞Ä ÏóÜÏäµÎãàÎã§."),f.choice=null,n=null,A(f,p);return}const L=[...k].sort((R,E)=>{const $=f.cards[R],N=f.cards[E],C=Et(f,$.defId),I=Et(f,N.defId),w=C.localeCompare(I,"ko");return w!==0?w:($.upgrade??0)-(N.upgrade??0)});f.choice={kind:"UPGRADE_PICK",title:b,prompt:g,options:[...L.map(R=>{const E=f.cards[R],$=gt(f,R),N=he(f.content,E.defId,(E.upgrade??0)+1),C=ce(f,R),I=`ÌòÑÏû¨: Ï†ÑÏó¥ ${$.frontText} / ÌõÑÏó¥ ${$.backText}
Í∞ïÌôî: Ï†ÑÏó¥ ${N.frontText} / ÌõÑÏó¥ ${N.backText}`;return{key:`up:${R}`,label:C,detail:I,cardUid:R}}),{key:"skip",label:"Ï∑®ÏÜå"}]},n=R=>{if(R==="skip"){y(f,"Í∞ïÌôî Ï∑®ÏÜå"),c(f),A(f,p);return}if(R.startsWith("up:")){const E=R.slice(3),$=sr(f,E);y(f,$?`Í∞ïÌôî: [${ce(f,E)}]`:"Í∞ïÌôî Ïã§Ìå®"),c(f),A(f,p);return}c(f),A(f,p)},A(f,p)}return d}function en(e){const t=e.frontSlots.filter(r=>r!=null).length,n=e.backSlots.filter(r=>r!=null).length;e.frontPlacedThisTurn=t,e.usedThisTurn=t+n}function ya(){ws();const e=document.querySelector("#app");return e.innerHTML="",e}function ne(e,t,n=""){const r=document.createElement("button");return n&&(r.className=n),r.type="button",r.textContent=e,r.onclick=t,r}function yn(){const e=Array.from(document.querySelectorAll(".enemyName"));if(e.length===0)return;e.forEach(o=>{o.style.display="inline-block",o.style.width="auto",o.style.whiteSpace="nowrap"});let t=0;for(const o of e)t=Math.max(t,o.scrollWidth);const r=Math.min(t,320);e.forEach(o=>{o.style.width=`${r}px`,o.style.overflow="hidden",o.style.textOverflow="ellipsis"})}function xa(){document.querySelector(".phaseBanner")?.remove(),performance.now()}function ka(){Ps();let e=document.querySelector(".floatFxLayer");e||(e=document.createElement("div"),e.className="floatFxLayer",document.body.appendChild(e)),e.style.cssText="position:fixed; inset:0;pointer-events:none;z-index: var(--zChrome);";for(const t of Tt){const n=String(t.id);let r=e.querySelector(`.floatNum[data-fx-id="${n}"]`);r?(r.style.left=`${Math.round(t.x)}px`,r.style.top=`${Math.round(t.y)}px`):(r=document.createElement("div"),r.className=`floatNum ${t.kind}`,r.dataset.fxId=n,r.textContent=t.text,r.style.position="absolute",r.style.left=`${Math.round(t.x)}px`,r.style.top=`${Math.round(t.y)}px`,e.appendChild(r))}}function Ta(){if(document.querySelector(".floatingNewRun"))return;const e=document.createElement("button");e.className="floatingNewRun",e.type="button",e.textContent="ÏÉàÎ°úÏö¥ Îü∞",e.style.cssText=`
    position: fixed;
    top: calc(env(safe-area-inset-top, 0px) + 10px);
    left: calc(env(safe-area-inset-left, 0px) + 10px);
    pointer-events: auto;
    z-index: var(--zChrome);

    padding: 10px 12px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,.16);
    background: rgba(0,0,0,.55);
    color: #fff;

    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    cursor: pointer;
    touch-action: manipulation;
  `,e.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),pr?.()}),document.body.appendChild(e)}function A(e,t){A._uiScaleInitDone||(A._uiScaleInitDone=!0,te=hr(),_r()),be=e,ds({getG:()=>be??e,actions:{onNewRun:()=>t.onNewRun()},rerender:()=>A(be??e,t),log:h=>y(be??e,h)}),We(),pr=()=>t.onNewRun(),Ta(),Us(),A._logInitDone||(A._logInitDone=!0,Hs());const n=document.querySelector(".mainPanel");n&&(On=n.scrollTop,Dn=n.scrollLeft);const r=ya();Un||(window.addEventListener("resize",()=>{}),Da(()=>be??e,t),Un=!0),r.appendChild(Ma(e,t));const o=v("mainRow"),s=v("stage"),a=v("stageInner"),i=v("panel mainPanel"),l=!e.run.finished&&e.enemies.length>0&&e.phase!=="NODE";i.classList.toggle("inCombat",l),i.scrollTop=On,i.scrollLeft=Dn,i.appendChild(Pa(e)),e.run.finished?i.appendChild(mn("Îü∞ Ï¢ÖÎ£å. ÏÉàÎ°úÏö¥ Îü∞ÏùÑ ÏõêÌïòÏãúÎ©¥ Î≤ÑÌäºÏùÑ ÎàÑÎ•¥Í±∞ÎÇò ÌÇ§Î≥¥Îìú PÎ•º ÏûÖÎ†•ÌïòÏã≠ÏãúÏò§.")):e.phase==="NODE"?ba(i,e,t):Ia(i,e,t),a.appendChild(i),s.appendChild(a);const c=v("panel logPanel");if(c.classList.toggle("collapsed",$e),c.appendChild(Aa($e,()=>{$e=!$e,Os(),A(e,t)})),c.classList.add("logScroll"),!$e){const h=qs(e.log.join(`
`));h.classList.add("log"),c.appendChild(h)}o.appendChild(s),o.appendChild(c),r.appendChild(o),yn(),Ea(e),La(e,t,Z(e)),Tn(),kn(),wa(),Ar(),Sa(e,{...t,onCloseOverlay:()=>{q=null,A(be??e,t)}}),$a(e,t),Ca(e,t),_a(e,t),ht(e,t),As(e),xa(),ka(),ga(e,t),Ds(e),Ms()}function xn(e,t){const n=Q[t]??null,r=mt(e,t),o=n?.art??n?.icon??null,s=o??null;return{id:t,name:r.name,desc:r.text,state:r.state,icon:s,art:o}}function ga(e,t){document.querySelector(".relicHud")?.remove(),document.querySelector(".relicTooltip")?.remove(),ht(e,t);const n=(e.run.relics??[]).slice();if(n.length===0)return;const r=document.createElement("div");r.className="relicHud";for(const o of n.slice().reverse()){const s=xn(e,o),a=document.createElement("div");if(a.className="relicIcon",a.setAttribute("role","button"),a.tabIndex=0,s.icon){const l=document.createElement("img");l.className="relicIconImg",l.src=fe(s.icon),l.alt=s.name??s.id??"relic",a.appendChild(l)}else{const l=document.createElement("div");l.textContent=s.name.slice(0,2),l.style.fontWeight="900",l.style.fontSize="12px",l.style.opacity=".95",a.appendChild(l)}const i=(l,c)=>{ye=o,Ne={x:l,y:c},Ft(e)};a.onpointerenter=l=>i(l.clientX??0,l.clientY??0),a.onpointermove=l=>{ye===o&&(Ne={x:l.clientX??0,y:l.clientY??0},Ft(e))},a.onpointerleave=()=>{ye===o&&(ye=null,Ne=null,document.querySelector(".relicTooltip")?.remove())},a.onclick=l=>{l.preventDefault(),l.stopPropagation(),Pe=o,ye=null,Ne=null,document.querySelector(".relicTooltip")?.remove(),ht(e,t)},a.onkeydown=l=>{(l.key==="Enter"||l.key===" ")&&(l.preventDefault(),Pe=o,ht(e,t))},r.appendChild(a)}document.body.appendChild(r),Ft(e)}function Ft(e){if(document.querySelector(".relicTooltip")?.remove(),!ye||!Ne)return;const t=xn(e,ye);if(!t.desc&&!t.name)return;const n=document.createElement("div");n.className="relicTooltip";const r=document.createElement("div");if(r.className="relicTooltipTitle",r.textContent=t.name,n.appendChild(r),t.desc){const l=document.createElement("div");l.className="relicTooltipDesc",l.textContent=t.desc,n.appendChild(l)}document.body.appendChild(n);const o=12,s=n.getBoundingClientRect();let a=Ne.x-s.width,i=Ne.y-s.height-10;a=Math.max(o,Math.min(window.innerWidth-s.width-o,a)),i=Math.max(o,Math.min(window.innerHeight-s.height-o,i)),n.style.left=`${Math.round(a)}px`,n.style.top=`${Math.round(i)}px`}function ht(e,t){if(document.querySelector(".relicModal")?.remove(),!Pe)return;const n=xn(e,Pe),r=document.createElement("div");r.className="relicModal",r.style.cssText=`
    position: fixed;
    inset: 0;
    z-index: var(--zRelicModal, 70000);
    pointer-events: auto;
    background: rgba(0,0,0,.55);
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 18px;
    box-sizing: border-box;
  `,r.onclick=d=>{d.target===r&&(Pe=null,A(e,t))};const o=document.createElement("div");o.className="relicModalPanel",o.onclick=d=>d.stopPropagation();const s=document.createElement("div");s.className="relicModalHeader";const a=document.createElement("h3");a.className="relicModalTitle",a.textContent=n.name,a.style.fontFamily='"Î¨ºÎßàÎ£®", serif';const i=document.createElement("button");i.type="button",i.textContent="Îã´Í∏∞",i.className="overlayClose",i.onclick=()=>{Pe=null,A(e,t)},s.appendChild(a),s.appendChild(i);const l=document.createElement("div");l.className="relicModalBody";const c=document.createElement("div");c.className="relicModalArt";const h=document.createElement("div");h.className="relicModalArtImg",n.art&&(h.style.backgroundImage=`url("${fe(n.art)}")`),c.appendChild(h);const u=document.createElement("pre");u.className="relicModalDesc",u.textContent=n.desc||"",u.style.fontFamily='"Î¨ºÎßàÎ£®", serif',l.appendChild(c),l.appendChild(u),o.appendChild(s),o.appendChild(l),r.appendChild(o),document.body.appendChild(r)}function Ea(e){const t=document.querySelector(".stageInner");if(!t)return;document.querySelector(".stageCornerHud")?.remove();const n=document.createElement("div");n.className="stageCornerHud",n.textContent=Na(e),document.body.appendChild(n);const r=t.getBoundingClientRect(),o=-56,s=(r.left+r.right)/2;n.style.right="",n.style.left=`${Math.round(s)}px`,n.style.top=`${Math.round(r.top+o)}px`,n.style.transform="translateX(-50%)"}function tn(){try{localStorage.setItem(fr,JSON.stringify(te))}catch{}}function Wt(e){const t=Gt(e,.75,1.5);Nt()?te.uiScaleMobile=t:te.uiScaleDesktop=t,tn(),_r()}function Ca(e,t){if(document.querySelector(".logOverlay")?.remove(),!Zt)return;const n=v("logOverlay");n.style.cssText=`
    position: fixed; inset: 0;
    pointer-events:auto;
    background: rgba(0,0,0,.55);
    backdrop-filter: blur(6px);
    display: flex;
    align-items: flex-end;
    justify-content: center;
  `;const r=v("panel");r.style.cssText=`
    width: min(720px, 100%);
    max-height: 70vh;
    border-radius: 18px 18px 0 0;
    padding: 12px;
    margin: 0;
  `;const o=v("panelHeader"),s=document.createElement("h2");s.textContent="Î°úÍ∑∏",o.appendChild(s);const a=ne("Îã´Í∏∞",()=>t.onToggleLogOverlay());o.appendChild(a),r.appendChild(o);const i=document.createElement("pre");i.className="log",i.textContent=e.log.join(`
`),i.style.maxHeight="60vh",i.style.overflow="auto",r.appendChild(i),n.onclick=()=>t.onToggleLogOverlay(),r.onclick=l=>l.stopPropagation(),n.appendChild(r),document.body.appendChild(n)}function va(e,t){const n=v("settingsPanel");n.style.cssText="display:flex; flex-direction:column; gap:12px;";const r=v("settingsRow");r.style.cssText="display:flex; align-items:center; gap:12px; flex-wrap:wrap;";const o=X("","UI Ïä§ÏºÄÏùº");o.style.cssText="font-weight:800;";const s=()=>Nt()?te.uiScaleMobile:te.uiScaleDesktop,a=X("",`${Math.round(s()*100)}%`);a.style.cssText="opacity:.9; min-width:64px; text-align:right;";const i=document.createElement("input");i.type="range",i.min="0.75",i.max="1.25",i.step="0.01",i.value=String(s()),i.style.cssText="flex:1 1 260px;",i.oninput=()=>{const b=Number(i.value);Wt(b),a.textContent=`${Math.round(s()*100)}%`,e()},r.appendChild(o),r.appendChild(i),r.appendChild(a),n.appendChild(r);const l=v("settingsPresets");l.style.cssText="display:flex; gap:8px; flex-wrap:wrap;";const c=(b,g)=>{const m=ne(b,()=>{Wt(g),i.value=String(s()),a.textContent=`${Math.round(s()*100)}%`,e()});return m.style.cssText="padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.16);background:rgba(255,255,255,.06); color:#fff; cursor:pointer;",m};l.appendChild(c("ÏûëÍ≤å 90%",.9)),l.appendChild(c("Í∏∞Î≥∏ 100%",1)),l.appendChild(c("ÌÅ¨Í≤å 110%",1.1)),l.appendChild(c("Îçî ÌÅ¨Í≤å 120%",1.2)),n.appendChild(l);const h=v("settingsResetRow");h.style.cssText="display:flex; justify-content:flex-end; margin-top:6px;";const u=ne("Ï¥àÍ∏∞Ìôî",()=>{Wt(1),i.value=String(s()),a.textContent=`${Math.round(s()*100)}%`,e()});u.style.cssText="padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.16);background:rgba(255,255,255,.06); color:#fff; cursor:pointer;",h.appendChild(u),n.appendChild(h);const d=v("settingsRow");d.style.cssText="display:flex; align-items:center; gap:12px; flex-wrap:wrap;";const x=X("","Ïä¨Î°Ø Ïπ¥Îìú ÌëúÏãú");x.style.cssText="font-weight:800;";const _=te.slotCardMode??"FULL",f=ne("Ï†ÑÏ≤¥",()=>{te.slotCardMode="FULL",tn(),e()}),p=ne("Ïù¥Î¶ÑÎßå",()=>{te.slotCardMode="NAME_ONLY",tn(),e()});return f.style.cssText=`padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.16);
    background:${_==="FULL"?"rgba(255,255,255,.16)":"rgba(255,255,255,.06)"}; color:#fff; cursor:pointer;`,p.style.cssText=`padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.16);
    background:${_==="NAME_ONLY"?"rgba(255,255,255,.16)":"rgba(255,255,255,.06)"}; color:#fff; cursor:pointer;`,d.appendChild(x),d.appendChild(f),d.appendChild(p),n.appendChild(d),n}function wa(){const e=document.querySelector(".stageInner");if(!e)return;const t=e.getBoundingClientRect(),n=Math.round(t.left),r=Math.round(t.top),o=document.documentElement;o.style.setProperty("--stageLeftPx",`${n}px`),o.style.setProperty("--stageTopPx",`${r}px`),o.style.setProperty("--stageHPx",`${Math.round(t.height)}px`)}function _r(){const e=document.documentElement,t=Nt()?te.uiScaleMobile:te.uiScaleDesktop;e.style.setProperty("--uiScale",String(t)),e.style.setProperty("--uiScaleDesktop",String(te.uiScaleDesktop)),e.style.setProperty("--uiScaleMobile",String(te.uiScaleMobile))}function Sa(e,t){if(document.querySelector(".overlay-layer")?.remove(),!q)return;const n=q.kind==="SETTINGS",r=v("overlay-layer");r.style.cssText=n?"position:fixed; inset:0;background:rgba(0,0,0,1);display:flex; justify-content:center; align-items:flex-start;padding:24px; box-sizing:border-box;":"position:fixed; inset:0;background:rgba(0,0,0,.55);display:flex; justify-content:center; align-items:center;",r.onclick=c=>{c.target===r&&t.onCloseOverlay()};const o=v("overlay-panel");o.style.cssText=n?"width:min(860px, 96vw); max-height:calc(100vh - 48px); overflow:auto;padding:16px; border:1px solid rgba(255,255,255,.12); border-radius:16px;background:rgba(15,18,22,1); box-shadow:0 18px 60px rgba(0,0,0,.45);":"width:min(980px, 92vw); max-height:80vh; overflow:auto; padding:16px;border:1px solid rgba(255,255,255,.12); border-radius:16px;background:rgba(15,18,22,.92); box-shadow:0 18px 60px rgba(0,0,0,.45);",o.onclick=c=>c.stopPropagation();const s=q.kind==="RULEBOOK"?"Î£∞Î∂Å":q.kind==="SETTINGS"?"ÏÑ§Ï†ï":q.pile==="deck"?"Îç±":q.pile==="discard"?"Î≤ÑÎ¶º ÎçîÎØ∏":q.pile==="exhausted"?"ÏÜåÎ™®(Ïù¥Î≤à Ï†ÑÌà¨)":q.pile==="vanished"?"ÏÜåÏã§(ÏòÅÍµ¨)":"ÏÜêÌå®",a=v("overlayHeader");a.style.cssText="display:flex; align-items:center; justify-content:space-between; gap:12px; position:sticky; top:0; padding-bottom:12px; margin-bottom:12px; background:rgba(15,18,22,.92);";const i=Xt(s);i.classList.add("overlayTitle");const l=Jt("Îã´Í∏∞",t.onCloseOverlay,!1);if(l.classList.add("overlayClose"),l.style.cssText="padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.16); background:rgba(255,255,255,.06); color:#fff; cursor:pointer;",a.appendChild(i),a.appendChild(l),o.appendChild(a),q.kind==="RULEBOOK"){const c=document.createElement("pre");c.className="rulebook",c.textContent=Cs,c.style.cssText="white-space:pre-wrap; line-height:1.45; font-size:13px; margin:0; padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.10); background:rgba(0,0,0,.18);",o.appendChild(c)}else if(q.kind==="SETTINGS")o.appendChild(va(()=>{be&&(yn(),Tn(),kn()),A(be??e,t)}));else{const h=[...q.pile==="deck"?e.deck:q.pile==="discard"?e.discard:q.pile==="exhausted"?e.exhausted:q.pile==="vanished"?e.vanished:e.hand].sort((m,k)=>{const M=e.cards[m],T=e.cards[k],L=Et(e,M.defId),R=Et(e,T.defId),E=L.localeCompare(R,"ko");return E!==0?E:(M.upgrade??0)-(T.upgrade??0)}),u=v("pileView");u.style.cssText="display:grid;grid-template-columns: 1fr 320px;gap:16px;align-items:start;";const d=v("pileGrid");d.style.cssText="display:grid;grid-template-columns: repeat(auto-fill, minmax(var(--handCardW), 1fr));gap:10px;align-content:start;min-width:0;max-height: 62vh;overflow-y: auto;overflow-x: hidden;";const x=v("pileSide");x.style.cssText="position:sticky; top:72px;align-self:start;border:1px solid rgba(255,255,255,.10);border-radius:14px;padding:12px;background:rgba(0,0,0,.22);";const _=v("pileSideTitle");_.style.cssText="font-weight:800; margin:0 0 10px 0; opacity:.95;",x.appendChild(_);const f=v("pilePreviewBox");f.style.cssText="display:flex; justify-content:center; align-items:flex-start;padding:8px 0 10px 0;",x.appendChild(f);const p=document.createElement("pre");p.className="pileSideDetail",p.style.cssText="margin:0;padding:10px;white-space:pre-wrap;border-radius:12px;border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.20);font-size:12px;line-height:1.45;",x.appendChild(p);let b=h[0]??null;const g=()=>{if(f.innerHTML="",!b){_.textContent="ÏÑ†ÌÉùÎêú Ïπ¥Îìú ÏóÜÏùå",p.textContent="";return}const m=gt(e,b),k=Tr(e,b);_.textContent=k;const M=vt(e,b);f.appendChild(M),p.textContent=`Ï†ÑÏó¥: ${m.frontText}
ÌõÑÏó¥: ${m.backText}`};if(h.length===0){const m=v("overlayEmpty");m.textContent="ÎπÑÏñ¥ ÏûàÏùå",m.style.cssText="padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.10); background:rgba(255,255,255,.03);",d.appendChild(m)}else for(const m of h){const k=vt(e,m,T=>{b=T,g()});k.style.width="var(--handCardW)",k.style.height="var(--handCardH)",k.style.boxSizing="border-box",k.style.cursor="pointer";const M=()=>{b=m,d.querySelectorAll(".pileSelected").forEach(T=>T.classList.remove("pileSelected")),k.classList.add("pileSelected"),g()};k.onclick=M,k.onmouseenter=M,d.appendChild(k)}if(u.appendChild(d),u.appendChild(x),o.appendChild(u),b){const m=d.firstElementChild;m&&m.classList.add("pileSelected")}g()}r.appendChild(o),document.body.appendChild(r)}function Xe(e,t){const n=document.createElement(e);return t&&(n.className=t),n}function _a(e,t){const n=document.getElementById("relicTray");n&&n.remove();const r=e.run.relics??[];if(r.length===0)return;const o=Xe("div","relicTray");o.id="relicTray";const s=Xe("div","relicHoverTip");o.appendChild(s);const a=Xe("div","relicTrayList");o.appendChild(a);const i=()=>{const l=ye;if(!l){s.style.display="none",s.textContent="";return}if(!Q[l]){s.style.display="none",s.textContent="";return}const h=mt(e,l);s.style.display="block",s.innerHTML="";const u=Xe("div","relicTipTitle");u.textContent=h.name;const d=Xe("div","relicTipBody");d.textContent=h.text,s.appendChild(u),s.appendChild(d)};for(const l of r){const c=Q[l];if(!c)continue;const h=mt(e,l),u=document.createElement("button");if(u.type="button",u.className="relicIcon",c.art){const d=document.createElement("img");d.className="relicIconImg",d.src=fe(c.art),d.alt=h.name,u.appendChild(d)}else u.textContent=h.name.slice(0,1);u.onmouseenter=()=>{ye=l,i()},u.onmouseleave=()=>{ye=null,i()},u.onclick=()=>{Pe=l,A(e,t)},a.appendChild(u)}i(),document.body.appendChild(o)}function $a(e,t){document.querySelector(".choice-overlay")?.remove();const n=e.choice,r=document.querySelector(".mainPanel");if(!n){r?.classList.remove("choiceOpen");return}if(!r)return;r.classList.add("choiceOpen");const o=P(70),s=P(20)+o,a=P(36),i=P(16),l=P(16),c=P(18),h=P(10),u=P(260),d=P(200),x=P(14),_=P(12),f=P(10),p=P(12),b=P(12),g=P(220),m=P(22),k=P(14),M=v("choice-overlay");M.style.cssText="position:fixed; inset:0; z-index: var(--zChoice);display:flex; justify-content:center; align-items:flex-start;pointer-events:auto;";const T=v("choice-backdrop");T.style.cssText="position:absolute; inset:0;background: rgba(0,0,0,.72);backdrop-filter: blur(4px);-webkit-backdrop-filter: blur(4px);pointer-events:auto;",T.onclick=()=>{};const L=v("choice-padWrap");L.style.cssText=`position:relative; width:100%;padding:${s}px ${a}px ${i}px ${l}px;box-sizing:border-box;display:flex; justify-content:center; align-items:flex-start;pointer-events:auto;`;const R=v("choice-panel");R.style.cssText="position:relative;pointer-events:auto;",R.onclick=w=>w.stopPropagation();const E=js(n.title);if(E.style.cssText=`margin:0 0 ${P(8)}px 0; font-size:${m}px; font-weight:900;text-align:left;`,R.appendChild(E),n.prompt){const w=mn(n.prompt);w.style.cssText=`margin:0 0 ${P(12)}px 0; font-size:${k}px; line-height:1.25; opacity:.95;`,R.appendChild(w)}const $=w=>{w.style.width="var(--handCardW)",w.style.height="var(--handCardH)",w.style.boxSizing="border-box"},N=w=>{const S=document.createElement("pre");return S.className="choice-detail",S.textContent=String(w),S.style.cssText=`margin:${P(10)}px 0 0 0; padding:${f}px;white-space:pre-wrap;border-radius:${p}px; border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.22);font-size:${b}px; line-height:1.45;max-height:${g}px; overflow:auto;`,S},C=()=>{const w=v("choice-item");return w.style.cssText=`display:flex;gap:${P(12)}px;align-items:flex-start;border:1px solid rgba(255,255,255,.10); border-radius:${x}px;padding:${_}px;background:rgba(255,255,255,.03);`,w};if(n.options.some(w=>w.cardUid?!0:typeof w.key=="string"&&w.key.startsWith("pick:"))){const w=v("choice-list");w.style.cssText=`display:flex; flex-direction:column;gap:${h}px; margin-top:${P(12)}px;`,n.options.forEach(S=>{const O=C(),H=v("choice-left");H.style.cssText="flex:0 0 auto;";const F=S.cardUid;if(F){const z=e.choice?.kind==="UPGRADE_PICK",Y=(e.cards[F].upgrade??0)+1;let V;try{V=z?na(e,F,Y):vt(e,F)}catch{V=vt(e,F)}$(V),H.appendChild(V)}else if(typeof S.key=="string"&&S.key.startsWith("pick:")){const z=S.key.slice(5),[U,Y]=z.split(":"),V=Number(Y??"0")||0,ve=Cr(e,U,V);$(ve),H.appendChild(ve)}const K=v("choice-right");K.style.cssText=`flex:1 1 auto; min-width:${P(260)}px;`;const D=Jt(S.label,()=>t.onChooseChoice(S.key),!1);D.classList.add("primary"),D.style.fontSize=`${P(14)}px`,D.style.padding=`${P(10)}px ${P(12)}px`,D.style.borderRadius=`${P(10)}px`,K.appendChild(D),S.detail&&K.appendChild(N(S.detail)),O.appendChild(H),O.appendChild(K),w.appendChild(O)}),R.appendChild(w)}else{const w=v("choice-contentRow");w.style.cssText=`display:flex;gap:${c}px; margin-top:${P(12)}px;justify-content:center; align-items:stretch;`;const S=v("choice-leftCol");S.style.cssText=`flex:1 1 ${P(640)}px; max-width:${P(720)}px; min-width:0;display:flex; flex-direction:column;`;const O=v("choice-list");O.style.cssText=`display:flex; flex-direction:column; gap:${h}px;`,n.options.forEach(D=>{const z=C(),U=Jt(D.label,()=>t.onChooseChoice(D.key),!1);U.classList.add("choiceOptBtn"),U.style.fontSize=`${P(14)}px`,U.style.padding=`${P(10)}px ${P(12)}px`,U.style.borderRadius=`${P(10)}px`,z.appendChild(U),D.detail&&z.appendChild(N(D.detail)),O.appendChild(z)}),S.appendChild(O);const H=v("choice-illuCol");H.style.cssText=`flex:0 0 ${u}px; min-width:${d}px;display:flex; align-items:center; justify-content:center;`;const F=v("choice-illuBox");F.style.cssText=`width:100%; aspect-ratio:1/1;border-radius:${P(18)}px; border:1px solid rgba(255,255,255,.16);background:rgba(0,0,0,.35);position:relative; overflow:hidden;box-shadow: 0 10px 30px rgba(0,0,0,.35);`;const K=n.art;if(K){const D=document.createElement("img");D.src=fe(K),D.alt=n.title??"illustration";const z=1.5;D.style.imageRendering="pixelated",D.style.cssText=`position:absolute; inset:0;width:${z*100}%; height:${z*100}%;left:${-.5*50}%; top:${-.5*50}%;object-fit:cover; object-position:50% 50%;image-rendering: pixelated; image-rendering: crisp-edges;`,F.appendChild(D)}H.appendChild(F),w.appendChild(S),w.appendChild(H),R.appendChild(w)}L.appendChild(R),M.appendChild(T),M.appendChild(L),document.body.appendChild(M)}function Ma(e,t){document.querySelectorAll(".topHud").forEach(g=>g.remove()),document.querySelectorAll(".enemyHudCenter").forEach(g=>g.remove());const n=v("topHud");n.appendChild(v("topHudLeftSpacer"));const r=v("playerHudLeft"),o=v("playerTitleRow");o.appendChild(X("playerHudTitle","ÌîåÎ†àÏù¥Ïñ¥"));const s=v("pileButtons");s.appendChild(ne("Îç±",()=>t.onViewPile("deck"))),s.appendChild(ne("Î≤ÑÎ¶º",()=>t.onViewPile("discard"))),s.appendChild(ne("ÏÜêÌå®",()=>t.onViewPile("hand"))),s.appendChild(ne("ÏÜåÎ™®",()=>t.onViewPile("exhausted"))),s.appendChild(ne("ÏÜåÏã§",()=>t.onViewPile("vanished"))),o.appendChild(s),r.appendChild(o);const a=v("enemyChip");a.classList.add("playerHudBox");const i=v("enemyChipTop");i.appendChild(X("","HP")),i.appendChild(X("",`${e.player.hp}/${e.player.maxHp}`)),a.appendChild(i);const l=v("enemyHPOuter"),c=v("enemyHPFill");c.style.width=`${Math.max(0,Math.min(100,e.player.hp/Math.max(1,e.player.maxHp)*100))}%`,l.appendChild(c),a.appendChild(l);const h=v("enemyChipTop");h.appendChild(X("","Î∏îÎ°ù")),h.appendChild(X("",`${e.player.block}`)),a.appendChild(h);const u=v("enemyHPOuter"),d=v("enemyHPFill");d.style.background="linear-gradient(90deg, #64b5ff, #2a7cff)",d.style.width=`${Math.max(0,Math.min(100,e.player.block/Math.max(1,e.player.maxHp)*100))}%`,u.appendChild(d),a.appendChild(u);const x=e.player.status,_=v("enemyBadges");a.appendChild(_);const f=[];(x.vuln??0)>0&&f.push(`Ï∑®ÏïΩ ${x.vuln}`),(x.weak??0)>0&&f.push(`ÏïΩÌôî ${x.weak}`),(x.bleed??0)>0&&f.push(`Ï∂úÌòà ${x.bleed}`),(x.disrupt??0)>0&&f.push(`ÍµêÎûÄ ${x.disrupt}`);for(const g of f)_.appendChild(Qt(g));if(r.appendChild(a),!e.run.finished&&e.enemies.length>0&&e.phase!=="NODE"){const g=v("enemyHudCenter"),m=v("enemyHudCenterMover"),k=v("enemyHud");k.style.cssText=`
      display: flex;
      flex-direction: row;
      flex-wrap: nowrap;
      justify-content: center;
      align-items: stretch;
      gap: 14px;
      overflow: visible;
      white-space: nowrap;
    `,g.style.overflow="visible",m.style.overflow="visible",m.style.width="max-content";const M=Z(e);m.appendChild(k),g.appendChild(m),document.body.appendChild(g);for(let T=0;T<e.enemies.length;T++){const L=e.enemies[T],R=v("enemyBanner enemyCardWrap");M&&L.hp>0&&R.classList.add("targetable"),R.onclick=()=>t.onSelectEnemy(T);const E=v("enemyArtWrap"),$=v("enemyArtCard");E.style.setProperty("--frameImg",`url("${fe("assets/enemies/enemies_frame.png")}")`),E.style.setProperty("--artImg",`url("${Js(L.id)}")`),E.appendChild($);const N=v("enemyMiniHud"),C=e.content.enemiesById[L.id],I=C.intents[L.intentIndex%C.intents.length],w=L.intentLabelOverride??I.label,S=e.intentsRevealedThisTurn?Zn(e,L,I,{includeBlock:!1}):null,O=v("enemyIntentTopRow");let H="Ôºü",F="";e.intentsRevealedThisTurn&&S?(H=ea(S),F=Zs(e,L,S)??""):(H="Ôºü",F=""),O.appendChild(X("enemyIntentIcon",H)),O.appendChild(X("enemyIntentDmg",F)),N.appendChild(O);const K=v("enemyHpLine");K.appendChild(X("enemyHpText",`HP ${L.hp}/${L.maxHp}`));const D=v("enemyHPOuter"),z=v("enemyHPFill");z.style.width=`${Math.max(0,Math.min(100,L.hp/Math.max(1,L.maxHp)*100))}%`,D.appendChild(z),K.appendChild(D),N.appendChild(K),N.appendChild(ta(L.status,L.immuneThisTurn));const U=v("enemyHoverDetail"),Y=L.status,V=[];(Y.vuln??0)>0&&V.push(`Ï∑®ÏïΩ ${Y.vuln}`),(Y.weak??0)>0&&V.push(`ÏïΩÌôî ${Y.weak}`),(Y.bleed??0)>0&&V.push(`Ï∂úÌòà ${Y.bleed}`),(Y.disrupt??0)>0&&V.push(`ÍµêÎûÄ ${Y.disrupt}`),L.immuneThisTurn&&V.push("Î©¥Ïó≠"),U.textContent=e.enemies[T].name+`
 
`+(e.intentsRevealedThisTurn?`${w}
 
`:"")+(V.length?`ÏÉÅÌÉú: ${V.join(", ")}`:"ÏÉÅÌÉú: ÏóÜÏùå"),R.appendChild(E),R.appendChild(N),R.appendChild(U),k.appendChild(R)}}n.appendChild(r);const b=v("topHudRight");return b.appendChild(ne("Î£∞Î∂Å",()=>t.onViewRulebook())),b.appendChild(ne("Î°úÍ∑∏",()=>t.onToggleLogOverlay())),b.appendChild(ne("ÏÑ§Ï†ï",()=>{q={kind:"SETTINGS"},A(e,t)})),n.appendChild(b),n}function Na(e){const t=e.enemies.length>0&&e.phase!=="NODE",n=e.run.nextBattleSuppliesBonus??0,r=[];t?r.push(`üåæ S ${e.player.supplies} |`):n>0&&r.push(`Î≥¥ÎÑàÏä§ üåæ S +${n} |`),r.push(`üí§ F ${e.player.fatigue}`);const o=e.run,s=Number(o.timeMove??0)||0,a=Number(e.time??0)||0,i=s+a;return r.push(`| ‚è≥ Ï¥ù ${i}`),r.push(`| üÉè Îç± ${e.deck.length}`),r.join(" ")}function Ut(e,t=""){const n=document.createElement("span");return n.className="chip"+(t?` ${t}`:""),n.textContent=e,n}function Pa(e){const t=v("battleTitleRow");t.style.display="flex",t.style.alignItems="center",t.style.gap="12px";const n=document.createElement("h2");n.textContent="",t.appendChild(n);const r=Ra(e),o=X("targetHintInline","");o.style.cssText="padding:5px 10px; border-radius:12px; border:1px solid rgba(0,0,0,.55);background: rgb(255, 0, 0);opacity:.9;font-weight:400; font-size:12px; line-height:1.2;white-space:nowrap; overflow:hidden; text-overflow:ellipsis;width: min(240px, 92vw);max-width: none;pointer-events:auto;",r?(o.textContent=r,o.style.visibility="visible",o.style.pointerEvents="auto"):(o.textContent="ÎåÄÏÉÅ ÏÑ†ÌÉù ÌïÑÏöî",o.style.visibility="hidden",o.style.pointerEvents="none");const s=v("battleTitleRight");s.style.cssText="margin-left:auto;display:flex; align-items:center; gap:10px;flex: 0 0 auto;white-space:nowrap;position:relative;";const a=v("resourceRow inline");return a.appendChild(Ut("")),a.appendChild(Ut("")),a.appendChild(Ut("")),s.appendChild(a),o.style.position="absolute",o.style.right="207px",o.style.top="calc(100% - 8px)",o.style.marginTop="0px",o.style.zIndex="5",o.style.pointerEvents=r?"auto":"none",t.appendChild(o),t.appendChild(s),t}function Aa(e,t){const n=v("logHeaderRow");n.tabIndex=0;const r=document.createElement("h2");r.textContent="Î°úÍ∑∏";const o=document.createElement("span");return o.className="chev",o.textContent=e?"‚ñ∏":"‚ñæ",n.appendChild(r),n.appendChild(o),n.onclick=()=>t(),n.onkeydown=s=>{(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),t())},n}function Ra(e){if(!Z(e)||e.selectedEnemyIndex!=null)return null;const t=e.pendingTarget??null,n=t?.sourceCardUid?ce(e,t.sourceCardUid):null,r=t?.sourceLabel??null,o=t?.reason??null,s=n?`ÎåÄÏÉÅ ÏÑ†ÌÉù (${n})`:r?`ÎåÄÏÉÅ ÏÑ†ÌÉù (${r})`:"ÎåÄÏÉÅ ÏÑ†ÌÉù ÌïÑÏöî",a=o==="FRONT"?"Ï†ÑÏó¥":o==="BACK"?"ÌõÑÏó¥":o==="EVENT"?"Ïù¥Î≤§Ìä∏":o==="RELIC"?"Ïú†Î¨º":null,i=a?` ‚Äî ${a}`:"",l=e.pendingTargetQueue?.length??0,c=(e.pendingTarget?1:0)+l,h=c>1?` (ÎÇ®ÏùÄ ${c}Í∞ú)`:" (ÎÇ®ÏùÄ 1Í∞ú)";return`${s}${i}${h}`}function Ia(e,t,n){const r=v("combatRoot"),o=v("boardArea"),s=!t.run.finished&&t.enemies.length>0&&t.phase!=="NODE";o.classList.toggle("slabOn",s);const a=v("boardSlotsWrap");a.style.paddingTop=`${P(6)}px`,a.appendChild(jn(t,n,"front")),a.appendChild(jn(t,n,"back")),o.appendChild(a),r.appendChild(o),e.appendChild(r)}let nn=null,$r=!0;function zn(e,t){nn=e,$r=t}function Mr(e,t,n){return e.run.finished?{label:"Ï¢ÖÎ£å",fn:null,disabled:!0,activePhase:e.phase}:e.choice||q?{label:"ÏÑ†ÌÉù Ï§ë",fn:null,disabled:!0,activePhase:e.phase}:n?{label:"ÎåÄÏÉÅ ÏÑ†ÌÉù",fn:null,disabled:!0,activePhase:e.phase}:e.phase==="NODE"?{label:"ÎÖ∏Îìú ÏÑ†ÌÉù",fn:null,disabled:!0,activePhase:e.phase}:e.phase==="PLACE"?e.enemies.length>0&&!e.intentsRevealedThisTurn?{label:"Îã§Ïùå: Ï†ïÏ∞∞",fn:t.onRevealIntents,disabled:!1,activePhase:e.phase}:{label:"Îã§Ïùå: ÌõÑÏó¥",fn:t.onResolveBack,disabled:!1,activePhase:e.phase}:e.phase==="BACK"?{label:"Îã§Ïùå: ÌõÑÏó¥",fn:t.onResolveBack,disabled:!1,activePhase:e.phase}:e.phase==="FRONT"?{label:"Îã§Ïùå: Ï†ÑÏó¥",fn:t.onResolveFront,disabled:!1,activePhase:e.phase}:e.phase==="ENEMY"?{label:"Îã§Ïùå: Ï†Å",fn:t.onResolveEnemy,disabled:!1,activePhase:e.phase}:e.phase==="UPKEEP"?{label:"Îã§Ïùå: Ï†ïÎ¶¨",fn:t.onUpkeep,disabled:!1,activePhase:e.phase}:e.phase==="DRAW"?{label:"Îã§Ïùå ÌÑ¥",fn:t.onDrawNextTurn,disabled:!1,activePhase:e.phase}:{label:"Îã§Ïùå",fn:null,disabled:!0,activePhase:e.phase}}function La(e,t,n){const r=document.querySelector(".handDock");r&&r.remove();const o=!e.run.finished&&e.enemies.length>0&&e.phase!=="NODE";document.querySelector(".combatControls")?.remove();const s=v("handDock"),a=Mr(e,t,n);if(o){const c=v("combatControls"),h=document.createElement("button");h.textContent="Îã§Ïùå ÌÑ¥",h.className="stepBtn primary",h.disabled=a.disabled||e.phase==="NODE",h.onclick=()=>t.onAutoAdvance();const u=document.createElement("button");u.textContent="ÏÑ†ÌÉù Ìï¥Ï†ú",u.className="clearBtn primary",u.disabled=!e.selectedHandCardUid,u.onclick=t.onClearSelected,c.appendChild(h),c.appendChild(u),document.body.appendChild(c);const d=document.querySelector('.slot[data-slot-side="front"][data-slot-index="1"]')??document.querySelector(".stageInner");if(d){const x=d.getBoundingClientRect(),_=x.left+x.width/2;c.style.left=`${Math.round(_)}px`}zn(()=>t.onAutoAdvance(),h.disabled)}else zn(null,!0);const i=v("hand");i.dataset.dropHand="1";const l=v("handCardsRow");if(i.appendChild(l),e.hand.length===0){const c=v("handEmptyHint");c.textContent="",l.appendChild(c)}else for(const c of e.hand)l.appendChild(it(e,c,!0,t.onSelectHandCard,{draggable:!0}));s.appendChild(i),document.body.appendChild(s),Ha(i)}function Ha(e){e.dataset?.wheelX!=="1"&&(e.dataset.wheelX="1",e.addEventListener("wheel",t=>{if(t.shiftKey)return;const n=Math.abs(t.deltaX)>Math.abs(t.deltaY)?t.deltaX:t.deltaY;e.scrollLeft+=n,t.preventDefault()},{passive:!1}))}function kn(){const e=document.querySelector(".enemyHudCenter");if(!e)return;const t=e.querySelector(".enemyHudCenterMover")??e,n=e.querySelector(".enemyHud")??e.querySelector(".enemyStrip")??t;e.style.position="fixed";const r=document.querySelector(".topHud"),a=r?Math.round(r.getBoundingClientRect().bottom+10):8;e.style.top=`${a}px`,e.style.top="8px",e.style.left="50%",e.style.right="auto",e.style.transform="translateX(-50%)",e.style.overflow="visible",t.style.transform="",t.style.overflow="visible";const i=Array.from(e.querySelectorAll(".enemyBanner")),l=i.length;if(l===0){e.style.width="";return}const c=14,h=Math.ceil(i[0].getBoundingClientRect().width)||460,u=Math.max(320,Math.floor(window.innerWidth-16)),d=Math.min(u,h),x=Math.min(u,h*2+c),_=Math.min(u,h*3+c*2);n.style.display="flex",n.style.flexWrap="nowrap",n.style.justifyContent="center",n.style.alignItems="stretch",n.style.gap=`${c}px`,e.style.width=`${l===1?d:l===2?x:_}px`,t.style.width="100%"}function Tn(e){const t=document.querySelector(".hand"),n=document.querySelector(".handCardsRow");if(!t||!n)return;const r=document.querySelector('.slot[data-slot-side="front"][data-slot-index="1"]'),o=document.querySelector(".stageInner"),s=r?.getBoundingClientRect()??o?.getBoundingClientRect();if(!s)return;const a=s.left+s.width/2,i=Array.from(n.querySelectorAll(".card"));if(i.length===0)return;const l=i[0].getBoundingClientRect(),c=i[i.length-1].getBoundingClientRect(),h=l.left,u=c.right,d=(h+u)/2,x=a-d,_=n.scrollWidth,f=t.clientWidth;if(_<=f+1){n.style.transform=`translateX(${Math.round(x)}px)`,t.scrollLeft=0;return}let p=t.scrollLeft-x;const b=Math.max(0,_-f);p<0&&(p=0),p>b&&(p=b),t.scrollLeft=Math.round(p),n.style.transform=""}function Nr(e,t){const n=getComputedStyle(document.documentElement),r=parseFloat(n.getPropertyValue("--handCardW"))||240,o=parseFloat(n.getPropertyValue("--handCardH"))||336,s=e.getBoundingClientRect();if(s.width<=0||s.height<=0)return;const a=6,i=Math.max(1,s.width-a*2),l=Math.max(1,s.height-a*2);let c=Math.min(i/r,l/o);c=Math.max(.8,Math.min(1,c)),t.style.setProperty("--slotCardScale",String(c))}function jn(e,t,n){const r=v("grid6"),o=!!e.selectedHandCardUid,s=n==="front"?e.frontSlots:e.backSlots;for(let a=0;a<3;a++){const i=n==="back"?!!e.backSlotDisabled?.[a]:!1,l=v("slot"+(i?" disabled":""));l.dataset.slotSide=n,l.dataset.slotIndex=String(a),xe&&xe.side===n&&xe.idx===a&&l.classList.add("dropHover"),o&&!i&&l.classList.add("placeable");const c=s[a];if(c){const h=te.slotCardMode==="NAME_ONLY"?"SLOT_NAME_ONLY":"FULL",u=it(e,c,!1,void 0,{draggable:!1,mode:h,hoverPreview:{root:document.body,api:xr,buildDetail:(x,_)=>{const f=gt(x,_);return`Ï†ÑÏó¥: ${f.frontText}
ÌõÑÏó¥: ${f.backText}`}}});u.classList.add("inSlot");const d=document.createElement("div");d.className="slotCardScaler",d.appendChild(u),l.appendChild(d),u.onpointerdown=x=>{x.button!==0&&x.pointerType==="mouse"||Z(e)||e.phase==="PLACE"&&Pr(x,{kind:"slot",cardUid:c,fromSide:n,fromIdx:a})},u.ondblclick=()=>t.onReturnSlotToHand(n,a),requestAnimationFrame(()=>Nr(l,d))}r.appendChild(l)}return r}function Oa(){if(document.querySelectorAll(".slot.dropHover").forEach(n=>n.classList.remove("dropHover")),!xe)return;const e=`.slot[data-slot-side="${xe.side}"][data-slot-index="${xe.idx}"]`,t=document.querySelector(e);t&&t.classList.add("dropHover")}let qn=!1;function Da(e,t){qn||(qn=!0,window.addEventListener("pointermove",n=>{const r=e();if(r.choice||q||!B||n.pointerId!==B.pointerId)return;B.x=n.clientX,B.y=n.clientY;const o=B.x-B.startX,s=B.y-B.startY,a=B.dragging;!B.dragging&&o*o+s*s>36&&(B.dragging=!0),!a&&B.dragging&&(hn(250),fn()),xe=B.dragging?Vn(n.clientX,n.clientY,r):null,Ar(document.querySelector("#app")),Oa()},{passive:!0}),window.addEventListener("pointerup",n=>{const r=e();if(!(r.choice||q)&&!(!B||n.pointerId!==B.pointerId)){if(B.dragging){const o=Ba(n.clientX,n.clientY),s=Vn(n.clientX,n.clientY,r);if(o&&B.kind==="slot"&&B.fromSide!=null&&B.fromIdx!=null){!r.run.finished&&!Z(r)&&r.phase==="PLACE"&&t.onReturnSlotToHand(B.fromSide,B.fromIdx),B=null,xe=null,A(r,t);return}if(s)if(B.kind==="hand"){const a=e();if(!(a.run.finished||Z(a)||a.phase!=="PLACE")){const i=s.side,l=s.idx;if(!(i==="back"&&a.backSlotDisabled?.[l])){const c=i==="front"?a.frontSlots:a.backSlots,h=c[l];if(!h)t.onPlaceHandUidToSlot(B.cardUid,i,l);else{const u=B.fromHandIndex!=null&&B.fromHandIndex>=0?B.fromHandIndex:a.hand.indexOf(B.cardUid),d=a.hand.indexOf(B.cardUid);d>=0&&a.hand.splice(d,1),c[l]=B.cardUid,a.cards[B.cardUid].zone=i;const x=u!=null&&u>=0&&u<=a.hand.length?u:a.hand.length;a.hand.splice(x,0,h),a.cards[h].zone="hand",a.selectedHandCardUid=null,en(a),y(a,`[${ce(a,B.cardUid)}] ‚Üî [${ce(a,h)}] Ïä§Ïôë: ÏÜêÌå® ‚Üî ${i}${l+1}`),A(a,t)}}}}else B.kind==="slot"&&B.fromSide!=null&&B.fromIdx!=null&&(B.fromSide===s.side&&B.fromIdx===s.idx||t.onMoveSlotCard(B.fromSide,B.fromIdx,s.side,s.idx))}B?.sourceEl&&B.sourceEl.classList.remove("isDraggingSource"),B=null,xe=null,A(r,t)}}),window.addEventListener("keydown",n=>{const r=n.target;if(r&&(r.tagName==="INPUT"||r.tagName==="TEXTAREA"))return;const o=e();if(!us()){if(n.ctrlKey&&n.shiftKey&&n.code==="KeyK"){n.preventDefault(),ps();return}if(n.code==="KeyP"){n.preventDefault(),t.onNewRun();return}if(n.code==="Digit4"){if(n.preventDefault(),Z(o)){o.pendingTarget=null,o.pendingTargetQueue=[],o.selectedEnemyIndex=null,y(o,"ÎåÄÏÉÅ ÏÑ†ÌÉù Ï∑®ÏÜå"),A(o,t);return}t.onClearSelected();return}if(n.key==="Tab"){if(n.preventDefault(),o.hand.length===0)return;const s=o.selectedHandCardUid,a=s?o.hand.indexOf(s):-1,i=n.shiftKey?-1:1,l=((a+i)%o.hand.length+o.hand.length)%o.hand.length;o.selectedHandCardUid=o.hand[l],A(o,t);return}if(n.code==="Space"){n.preventDefault();const s=e();if(s.run.finished||s.choice||Z(s))return;t.onAutoAdvance();return}if(n.code==="Digit1"||n.code==="Digit2"||n.code==="Digit3"){n.preventDefault();const s=n.code==="Digit1"?0:n.code==="Digit2"?1:2;if(Z(o)){const a=o.enemies[s];if(!a||a.hp<=0){y(o,`ÎåÄÏÉÅ ÏÑ†ÌÉù Ïã§Ìå®: ${s+1}Î≤à Ï†ÅÏù¥ ÏóÜÏäµÎãàÎã§.`),A(o,t);return}t.onSelectEnemy(s);return}t.onHotkeySlot("front",s);return}if(n.code==="KeyQ"||n.code==="KeyW"||n.code==="KeyE"){n.preventDefault();const s=n.code==="KeyQ"?0:n.code==="KeyW"?1:2;t.onHotkeySlot("back",s);return}if(n.code==="Enter"){n.preventDefault(),!$r&&nn&&nn();return}}}))}function Pr(e,t){hn(250),fn();const n=e.currentTarget;try{n.setPointerCapture(e.pointerId)}catch{}const r=n.closest(".card");r&&r.classList.add("isDraggingSource");const o=r?.getBoundingClientRect(),s=o?e.clientX-o.left:20,a=o?e.clientY-o.top:20,i=getComputedStyle(document.documentElement),l=parseFloat(i.getPropertyValue("--handCardW"))||void 0,c=parseFloat(i.getPropertyValue("--handCardH"))||void 0;if(B={kind:t.kind,cardUid:t.cardUid,fromHandIndex:t.fromHandIndex,fromSide:t.fromSide,fromIdx:t.fromIdx,pointerId:e.pointerId,startX:e.clientX,startY:e.clientY,x:e.clientX,y:e.clientY,dragging:!1,previewEl:void 0,previewW:o?.width??l,previewH:o?.height??c,grabDX:s,grabDY:a},r){B.sourceEl=r;const h=r.cloneNode(!0);h.classList.remove("inSlot"),h.classList.remove("selected"),h.classList.remove("isDraggingSource"),h.style.position="static",h.style.inset="",h.style.width="100%",h.style.height="100%",h.style.margin="0",h.style.boxSizing="border-box",h.style.opacity="1",h.style.filter="none",h.style.transform="none",h.style.backgroundColor="transparent",B.previewEl=h}}function Ba(e,t){const n=document.elementFromPoint(e,t);if(!n)return!1;let r=n;for(;r;){if(r.dataset?.dropHand==="1")return!0;r=r.parentElement}return!1}function Vn(e,t,n){const r=document.elementFromPoint(e,t);if(!r)return null;const o=Fa(r,["slotSide","slotIndex"]);if(!o)return null;const s=o.dataset.slotSide,a=Number(o.dataset.slotIndex);return s==="back"&&n.backSlotDisabled?.[a]?null:{side:s,idx:a}}function Fa(e,t){let n=e;for(;n;){const r=n.dataset;let o=!0;for(const s of t)if(r[s]==null){o=!1;break}if(o)return n;n=n.parentElement}return null}function Ar(e,t){if(!B||!B.dragging){document.querySelector(".dragLayer")?.remove();return}let n=document.querySelector(".dragLayer");if(n||(n=document.createElement("div"),n.className="dragLayer",n.style.position="fixed",n.style.inset="0",n.style.zIndex="21000",n.style.pointerEvents="none",document.body.appendChild(n)),n.innerHTML="",!B.previewEl)return;const r=document.createElement("div");r.className="dragCardPreview",r.style.position="fixed",r.style.left=`${Math.round(B.x-(B.grabDX??20))}px`,r.style.top=`${Math.round(B.y-(B.grabDY??20))}px`;const o=B.previewW??0,s=B.previewH??0;o>0&&(r.style.width=`${Math.round(o)}px`),s>0&&(r.style.height=`${Math.round(s)}px`),r.style.transform="none",r.style.opacity="1",r.style.filter="none",r.style.boxShadow="0 16px 44px rgba(0,0,0,.65)",r.style.backdropFilter="none",r.style.isolation="isolate",r.style.mixBlendMode="normal",r.style.overflow="hidden",r.style.borderRadius="16px",r.style.background="transparent",r.style.clipPath="inset(0 round 16px)",r.appendChild(B.previewEl),n.appendChild(r)}Hr();Or();const Wa=is();let Je=Ws(Wa);function Rr(e){Je=e,rn=Sr(Je,Rr),A(Je,rn)}let rn=Sr(Je,Rr);A(Je,rn);document.documentElement.style.setProperty("--base","/deck-rogue-prototype/");
