(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();function de(e){return[{id:"A",type:e[0]},{id:"B",type:e[1]}]}function ue(e,t,n){e.status[t]=Math.max(0,(e.status[t]??0)+n)}function J(e){const t=de(ce(e)),n=de(ce(e)),a=de(ce(e));return{root:t,nextIfA:n,nextIfB:a}}function en(e,t){e.run.branchOffer||(e.run.branchOffer=J(e));const n=e.run.branchOffer,a=t==="A"?n.nextIfA:n.nextIfB,r=J(e);e.run.branchOffer={root:a,nextIfA:r.nextIfA,nextIfB:r.nextIfB}}function nn(){return Math.random().toString(16).slice(2)+"-"+Date.now().toString(16)}function ie(e,t=0){return e<t?t:e}function We(e){const t=[...e];for(let n=t.length-1;n>0;n--){const a=Math.floor(Math.random()*(n+1));[t[n],t[a]]=[t[a],t[n]]}return t}function W(e){return e[Math.floor(Math.random()*e.length)]}function c(e,t){e.log.unshift(t),e.log=e.log.slice(0,250)}function R(e){return e.enemies.filter(t=>t.hp>0)}function tn(e,t,n){e.status[t]=ie((e.status[t]??0)+n,0)}function ce(e){if((e.run.nodePickCount+1)%30===0)return["BATTLE","BATTLE"];const n=[],a=e.run.treasureObtained?25:24,r=e.run.treasureObtained?1:3,s=e.run.treasureObtained?7:5,u=!e.run.treasureObtained&&e.run.nodePickCount>=30?1:0;for(let m=0;m<a;m++)n.push("BATTLE");for(let m=0;m<r;m++)n.push("REST");for(let m=0;m<s;m++)n.push("EVENT");for(let m=0;m<u;m++)n.push("TREASURE");const d=W(n);let y=W(n);if(d==="TREASURE"&&y==="TREASURE"){let m=0;do if(y=W(n),m++,m>50)break;while(y==="TREASURE")}return[d,y]}function Fe(e){const t={phase:"NODE",log:[],uidSeq:0,winHooksAppliedThisCombat:!1,intentsRevealedThisTurn:!1,disruptIndexThisTurn:null,backUidsThisTurn:[],run:{encounterCount:0,treasureObtained:!1,afterTreasureNodePicks:0,finished:!1,nextBattleSuppliesBonus:0,bossPool:["boss_cursed_wall","boss_giant_orc","boss_soul_stealer"],nodePickCount:0,branchOffer:null,nodeOfferQueue:[],currentNodeOffers:null,nodePickByType:{BATTLE:0,REST:0,EVENT:0,TREASURE:0},battleCount:0,enemyLastSeenBattle:{}},player:{hp:40,maxHp:40,block:0,supplies:0,fatigue:0,zeroSupplyTurns:0,status:{vuln:0,weak:0,bleed:0,disrupt:0},immuneToDisruptThisTurn:!1,nullifyDamageThisTurn:!1},content:e,cards:{},deck:[],hand:[],discard:[],exhausted:[],vanished:[],choice:null,choiceStack:[],frontSlots:[null,null,null],backSlots:[null,null,null],backSlotDisabled:[!1,!1,!1],enemies:[],attackedEnemyIndicesThisTurn:[],usedThisTurn:0,frontPlacedThisTurn:0,selectedHandCardUid:null,pendingTargetQueue:[],pendingTarget:null,drawCountThisTurn:0};return t.run.branchOffer=J(t),an(t),c(t,"ìƒˆ ëŸ° ì‹œì‘. ë‹¤ìŒ ì¸ì¹´ìš´í„°ë¥¼ ì„ íƒí•˜ì„¸ìš”."),t}function Y(e,t,n){for(let a=0;a<n;a++){const r=nn(),s={uid:r,defId:t,zone:"deck",upgrade:0};e.cards[r]=s,e.deck.push(r)}}function an(e){Y(e,"field_ration",2),Y(e,"maintenance",2),Y(e,"scout",2),Y(e,"shield",2),Y(e,"power_arrow",1),Y(e,"arrow",3),e.deck=We(e.deck)}function z(e,t){const n=e.cards[t],a=e.content.cardsById[n.defId],r=n.upgrade??0,s=a.upgrades?.[r-1];return s?{...a,...s}:a}function F(e,t,n){const a=e.cardsById[t],r=Math.max(0,n|0);if(r<=0)return a;const s=a.upgrades?.[r-1];return s?{...a,...s}:a}function j(e,t){const a=e.cards[t].upgrade??0,r=z(e,t);return a>0?`${r.name} +${a}`:r.name}const rn=[{id:"field_ration",name:"ì•¼ì „ ì‹ëŸ‰",frontText:"ë°©ì–´ +3",backText:"S +2",front:[{op:"block",n:3}],back:[{op:"supplies",n:2}],upgrades:[{frontText:"ë°©ì–´ +5",front:[{op:"block",n:5}],backText:"S +3",back:[{op:"supplies",n:3}]}]},{id:"maintenance",name:"ì •ë¹„ ë„êµ¬",tags:["EXHAUST"],exhaustWhen:"BACK",frontText:"ë°©ì–´ +3",backText:"F -1, ì†Œëª¨",front:[{op:"block",n:3}],back:[{op:"fatigue",n:-1}],upgrades:[{frontText:"ë°©ì–´ +5",front:[{op:"block",n:5}],backText:"F -1, S +1, ì†Œëª¨",back:[{op:"fatigue",n:-1},{op:"supplies",n:1}]}]},{id:"scout",name:"ì •ì°°",frontText:"ì„ íƒí•œ ì ì—ê²Œ 3 í”¼í•´, ë°©ì–´ +2",backText:"ë“œë¡œìš° 1, ì†íŒ¨ í¬ê¸° +1, S +2",front:[{op:"damageEnemy",target:"select",n:3},{op:"block",n:2}],back:[{op:"draw",n:1},{op:"supplies",n:2}],upgrades:[{frontText:"ì„ íƒí•œ ì ì—ê²Œ 4 í”¼í•´, ë°©ì–´ +3",front:[{op:"damageEnemy",target:"select",n:3},{op:"block",n:2}],backText:"ë“œë¡œìš° 2, ì†íŒ¨ í¬ê¸° +2, S +2",back:[{op:"draw",n:2},{op:"supplies",n:2}]}]},{id:"shield",name:"ë°©íŒ¨",frontText:"ë°©ì–´ +6",backText:"ë°©ì–´ +3",front:[{op:"block",n:6}],back:[{op:"block",n:3}],upgrades:[{frontText:"ë°©ì–´ +8",front:[{op:"block",n:8}],backText:"ë°©ì–´ +4",back:[{op:"block",n:4}]}]},{id:"power_arrow",name:"ê°•ë ¥í•œ í™”ì‚´",frontText:"ë¬´ì‘ìœ„ ì ì—ê²Œ 10 í”¼í•´, S -1",backText:"ë¬´ì‘ìœ„ ì ì—ê²Œ ì „ì—´ í•œ ì¥ë‹¹ 2 í”¼í•´, S -1",front:[{op:"supplies",n:-1},{op:"damageEnemy",target:"random",n:10}],back:[{op:"supplies",n:-1},{op:"damageEnemyBy",target:"random",nPer:2,by:"frontCount"}],upgrades:[{frontText:"ë¬´ì‘ìœ„ ì ì—ê²Œ 13 í”¼í•´, S -1",front:[{op:"supplies",n:-1},{op:"damageEnemy",target:"random",n:13}],backText:"ë¬´ì‘ìœ„ ì ì—ê²Œ ì „ì—´ í•œ ì¥ë‹¹ 2 í”¼í•´",back:[{op:"damageEnemyBy",target:"random",nPer:2,by:"frontCount"}]}]},{id:"arrow",name:"í™”ì‚´",frontText:"ì„ íƒí•œ ì ì—ê²Œ 5 í”¼í•´",backText:"ì„ íƒí•œ ì ì—ê²Œ 5 í”¼í•´, S -1",front:[{op:"damageEnemy",target:"select",n:5}],back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:5}],upgrades:[{frontText:"ì„ íƒí•œ ì ì—ê²Œ 7 í”¼í•´",front:[{op:"damageEnemy",target:"select",n:7}],backText:"ì„ íƒí•œ ì ì—ê²Œ 7 í”¼í•´, S -1",back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:7}]}]},{id:"goal_treasure",name:"ì €ì£¼ë°›ì€ ë³´ë¬¼",tags:["EXHAUST"],exhaustWhen:"BOTH",frontText:"F +1, ì†Œëª¨",backText:"S -1, F +1, ì†Œëª¨",front:[{op:"fatigue",n:1}],back:[{op:"supplies",n:-1},{op:"fatigue",n:1}]},{id:"berserk",name:"ê´‘í­í™”",frontText:"ë¬´ì‘ìœ„ ì ì—ê²Œ 15 í”¼í•´, F +1",backText:"S +4, F +1",front:[{op:"damageEnemy",target:"random",n:15},{op:"fatigue",n:1}],back:[{op:"supplies",n:4},{op:"fatigue",n:1}],upgrades:[{frontText:"ë¬´ì‘ìœ„ ì ì—ê²Œ 20 í”¼í•´, F +2",front:[{op:"damageEnemy",target:"random",n:20},{op:"fatigue",n:2}],backText:"S +6, F +2",back:[{op:"supplies",n:6},{op:"fatigue",n:2}]}]},{id:"bandage",name:"ë¶•ëŒ€",frontText:"HP +4",backText:"HP +4, S -1",front:[{op:"heal",n:4}],back:[{op:"supplies",n:-1},{op:"heal",n:4}],upgrades:[{frontText:"HP +4, ì¶œí˜ˆ ì œê±°",front:[{op:"heal",n:4},{op:"clearStatusSelf",key:"bleed"}],backText:"HP +4, ì¶œí˜ˆ ì œê±°, S -1",back:[{op:"supplies",n:-1},{op:"heal",n:4},{op:"clearStatusSelf",key:"bleed"}]}]},{id:"arrow_rain",name:"í™”ì‚´ì˜ ë¹„",tags:["EXHAUST"],exhaustWhen:"BOTH",frontText:"ëª¨ë“  ì ì—ê²Œ 10 í”¼í•´, S -1, F +1, ì†Œëª¨",backText:"ë“œë¡œìš° 2, ì†íŒ¨ í¬ê¸° +2, S +2, F +1, ì†Œëª¨",front:[{op:"damageEnemy",target:"all",n:10},{op:"supplies",n:-1},{op:"fatigue",n:1}],back:[{op:"draw",n:2},{op:"supplies",n:2},{op:"fatigue",n:1}],upgrades:[{frontText:"ëª¨ë“  ì ì—ê²Œ 13 í”¼í•´, S -2, F +1, ì†Œëª¨",front:[{op:"damageEnemy",target:"all",n:13},{op:"supplies",n:-2},{op:"fatigue",n:1}],backText:"ë“œë¡œìš° 3, ì†íŒ¨ í¬ê¸° +3, S +3, F +2, ì†Œëª¨",back:[{op:"draw",n:3},{op:"supplies",n:3},{op:"fatigue",n:2}]}]},{id:"smoke",name:"ì—°ë§‰",tags:["EXHAUST"],exhaustWhen:"FRONT",frontText:"ì´ë²ˆ í„´ í”¼í•´ ë¬´íš¨, ì†Œëª¨",backText:"ìì‹ ì€ êµë€ ë‹¹í•˜ì§€ ì•ŠìŒ",front:[{op:"nullifyDamageThisTurn"}],back:[{op:"immuneDisruptThisTurn"}]},{id:"redeploy",name:"ì¬ë°°ì¹˜",frontText:"S +2",backText:"3ë²ˆ ìŠ¬ë¡¯ì— ìˆëŠ” í›„ì—´ ì¹´ë“œì˜ ì „ì—´ íš¨ê³¼ ë°œë™",front:[{op:"supplies",n:2}],back:[{op:"triggerFrontOfBackSlot",index:2}],upgrades:[{frontText:"S +3",front:[{op:"supplies",n:3}],backText:"3ë²ˆ ìŠ¬ë¡¯ì— ìˆëŠ” í›„ì—´ ì¹´ë“œì˜ ì „ì—´ íš¨ê³¼ ë°œë™, S +1",back:[{op:"triggerFrontOfBackSlot",index:2},{op:"supplies",n:1}]}]},{id:"secret_strike",name:"ë¹„ì¥ì˜ ì¼ê²©",tags:["EXHAUST"],exhaustWhen:"BOTH",frontText:"ë¬´ì‘ìœ„ ì ì—ê²Œ ìì‹ ì˜ Fì˜ 3ë°° í”¼í•´, ì†Œëª¨",backText:"ëª¨ë“  ì ì—ê²Œ ì·¨ì•½ +4 ë° ì•½í™” +4, ì†Œëª¨",front:[{op:"damageEnemyByPlayerFatigue",target:"random",mult:3}],back:[{op:"statusEnemy",target:"all",key:"vuln",n:4},{op:"statusEnemy",target:"all",key:"weak",n:4}],upgrades:[{tags:["EXHAUST"],exhaustWhen:"FRONT",frontText:"ì„ íƒí•œ ì ì—ê²Œ ìì‹ ì˜ Fì˜ 3ë°° í”¼í•´, ì†Œëª¨",front:[{op:"damageEnemyByPlayerFatigue",target:"select",mult:3}],backText:"ëª¨ë“  ì ì—ê²Œ ì·¨ì•½ +4 ë° ì•½í™” +4",back:[{op:"statusEnemy",target:"all",key:"vuln",n:4},{op:"statusEnemy",target:"all",key:"weak",n:4}]}]},{id:"fire_scroll",name:"í™”ì—¼ ë‘ë£¨ë§ˆë¦¬",tags:["EXHAUST"],exhaustWhen:"BOTH",frontText:"ë°©ì–´ +7, ì†Œëª¨",backText:"ëª¨ë“  ì ì—ê²Œ 12 í”¼í•´, ì†Œëª¨",front:[{op:"block",n:7}],back:[{op:"damageEnemy",target:"all",n:12}],upgrades:[{frontText:"ë°©ì–´ +8, ì†Œëª¨",front:[{op:"block",n:8}],backText:"ëª¨ë“  ì ì—ê²Œ 14 í”¼í•´, ì†Œëª¨",back:[{op:"damageEnemy",target:"all",n:14}]}]},{id:"caltrops",name:"ë§ˆë¦„ì‡ ",frontText:"ëª¨ë“  ì ì—ê²Œ ì¶œí˜ˆ 4 ë¶€ì—¬",backText:"ì´ë²ˆ í„´ì— ìì‹ ì„ ê³µê²©í•˜ë ¤ëŠ” ì ì—ê²Œ ì¶œí˜ˆ 3 ë¶€ì—¬",front:[{op:"statusEnemy",target:"all",key:"bleed",n:4}],back:[{op:"statusEnemiesAttackingThisTurn",key:"bleed",n:3}],upgrades:[{frontText:"ëª¨ë“  ì ì—ê²Œ ì¶œí˜ˆ 5 ë¶€ì—¬",backText:"ì´ë²ˆ í„´ì— ìì‹ ì„ ê³µê²©í•˜ë ¤ëŠ” ì ì—ê²Œ ì¶œí˜ˆ 4 ë¶€ì—¬",front:[{op:"statusEnemy",target:"all",key:"bleed",n:5}],back:[{op:"statusEnemiesAttackingThisTurn",key:"bleed",n:4}]}]},{id:"emergency_rations",name:"ë¹„ìƒì‹ëŸ‰",tags:["VANISH"],vanishWhen:"BACK",frontText:"S +2",backText:"Së¥¼ 10ìœ¼ë¡œ ë§Œë“¦. ì†Œì‹¤",front:[{op:"supplies",n:2}],back:[{op:"setSupplies",n:10}],upgrades:[{frontText:"S +3",backText:"Së¥¼ 15ìœ¼ë¡œ ë§Œë“¦. ì†Œì‹¤",front:[{op:"supplies",n:3}],back:[{op:"setSupplies",n:15}]}]},{id:"painkiller",name:"ì§„í†µì œ",tags:["EXHAUST"],exhaustWhen:"BOTH",frontText:"HP -8, F -2, ì†Œëª¨",backText:"HP +10, F +2, ì†Œëª¨",front:[{op:"hp",n:-8},{op:"fatigue",n:-2}],back:[{op:"hp",n:10},{op:"fatigue",n:2}],upgrades:[{frontText:"HP -5, F -2, ì†Œëª¨",backText:"HP +10, F +1, ì†Œëª¨",front:[{op:"hp",n:-5},{op:"fatigue",n:-2}],back:[{op:"hp",n:10},{op:"fatigue",n:1}]}]},{id:"field_experience",name:"ì‹¤ì „ ê²½í—˜",tags:["EXHAUST"],exhaustWhen:"BACK",frontText:"ëª¨ë“  ì ì—ê²Œ 3 í”¼í•´",backText:"ì´ ì¹´ë“œê°€ í›„ì—´ì— ìˆëŠ” í„´ì— ìŠ¹ë¦¬í•˜ë©´ ìµœëŒ€ ì²´ë ¥ +2, ì†Œëª¨",front:[{op:"damageEnemy",target:"all",n:3}],back:[],onWinWhileInBack:[{op:"maxHp",n:2}],upgrades:[{frontText:"ëª¨ë“  ì ì—ê²Œ 4 í”¼í•´",backText:"ì´ ì¹´ë“œê°€ í›„ì—´ì— ìˆëŠ” í„´ì— ìŠ¹ë¦¬í•˜ë©´ ìµœëŒ€ ì²´ë ¥ +3, ì†Œëª¨",front:[{op:"damageEnemy",target:"all",n:4}],onWinWhileInBack:[{op:"maxHp",n:3}]}]},{id:"camp_prep",name:"ì•¼ì˜ ì¤€ë¹„",frontText:"ë°©ì–´ +4, S +1",backText:"S +3",front:[{op:"block",n:4},{op:"supplies",n:1}],back:[{op:"supplies",n:3}],upgrades:[{frontText:"ë°©ì–´ +5, S +2",backText:"S +5",front:[{op:"block",n:5},{op:"supplies",n:2}],back:[{op:"supplies",n:5}]}]},{id:"vital_shot",name:"ê¸‰ì†Œ ì‚¬ê²©",frontText:"ì„ íƒí•œ ì ì—ê²Œ 8 í”¼í•´",backText:"ì„ íƒí•œ ì ì—ê²Œ 5 í”¼í•´, ì¶œí˜ˆ 2 ë¶€ì—¬, S -1",front:[{op:"damageEnemy",target:"select",n:8}],back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:5},{op:"statusEnemy",target:"select",key:"bleed",n:2}],upgrades:[{frontText:"ì„ íƒí•œ ì ì—ê²Œ 11 í”¼í•´",backText:"ì„ íƒí•œ ì ì—ê²Œ 6 í”¼í•´, ì¶œí˜ˆ 3 ë¶€ì—¬, S -1",front:[{op:"damageEnemy",target:"select",n:11}],back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:6},{op:"statusEnemy",target:"select",key:"bleed",n:3}]}]},{id:"taunt",name:"ë…ì„¤",frontText:"ì„ íƒí•œ ì ì—ê²Œ ì•½í™” +4",backText:"ëª¨ë“  ì ì—ê²Œ ì·¨ì•½ +2 ë° ì•½í™” +2",front:[{op:"statusEnemy",target:"select",key:"weak",n:4}],back:[{op:"statusEnemy",target:"all",key:"vuln",n:2},{op:"statusEnemy",target:"all",key:"weak",n:2}],upgrades:[{frontText:"ì„ íƒí•œ ì ì—ê²Œ ì•½í™” +5",backText:"ëª¨ë“  ì ì—ê²Œ ì·¨ì•½ +2 ë° ì•½í™” +3",front:[{op:"statusEnemy",target:"select",key:"weak",n:5}],back:[{op:"statusEnemy",target:"all",key:"vuln",n:2},{op:"statusEnemy",target:"all",key:"weak",n:3}]}]},{id:"rapid_fire",name:"ì—°ì† ì‚¬ê²©",frontText:"ì„ íƒí•œ ì ì—ê²Œ 2 í”¼í•´, 3ë²ˆ ë°œë™",backText:"ì´ë²ˆ í„´ì— ì¹´ë“œë¥¼ ë½‘ì•˜ìœ¼ë©´ ë¬´ì‘ìœ„ ì ì—ê²Œ 8 í”¼í•´",front:[{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2}],back:[{op:"ifDrewThisTurn",then:[{op:"damageEnemy",target:"random",n:8}]}],upgrades:[{frontText:"ì„ íƒí•œ ì ì—ê²Œ 2 í”¼í•´, 4ë²ˆ ë°œë™",backText:"ì´ë²ˆ í„´ì— ì¹´ë“œë¥¼ ë½‘ì•˜ìœ¼ë©´ ë¬´ì‘ìœ„ ì ì—ê²Œ 10 í”¼í•´",front:[{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2}],back:[{op:"ifDrewThisTurn",then:[{op:"damageEnemy",target:"random",n:10}]}]}]}],on=Object.fromEntries(rn.map(e=>[e.id,e])),sn=[{id:"other_adventurer",name:"ë³´ë¬¼ì„ ë…¸ë¦¬ëŠ” ë‹¤ë¥¸ ëª¨í—˜ê°€",maxHp:40,intents:[{label:"5 í”¼í•´, 3ë²ˆ ë°œë™",acts:[{op:"damagePlayer",n:5},{op:"damagePlayer",n:5},{op:"damagePlayer",n:5}]},{label:"ì¶œí˜ˆ4, ì·¨ì•½4, ì•½í™”4",acts:[{op:"statusPlayer",key:"bleed",n:4},{op:"statusPlayer",key:"vuln",n:4},{op:"statusPlayer",key:"weak",n:4}]}]},{id:"goblin_raider",name:"ê³ ë¸”ë¦° ì•½íƒˆì",maxHp:15,intents:[{label:"(12-ì´ë²ˆ í„´ì— ì‚¬ìš©í•œ ì¹´ë“œì˜ ìˆ˜) í”¼í•´",acts:[{op:"damagePlayerFormula",kind:"goblin_raider"}]},{label:"S -4",acts:[{op:"supplies",n:-4}]}]},{id:"watching_statue",name:"ê°ì‹œí•˜ëŠ” ì„ìƒ",maxHp:25,intents:[{label:"4+(ì´ë²ˆ í„´ì— ì‚¬ìš©í•œ ì¹´ë“œì˜ ìˆ˜) í”¼í•´",acts:[{op:"damagePlayerFormula",kind:"watching_statue"}]}]},{id:"pebble_golem",name:"ì¡°ì•½ëŒ ê³¨ë ˜",maxHp:25,intents:[{label:"6 í”¼í•´",acts:[{op:"damagePlayer",n:6}]},{label:"ìì‹  HP 6 íšŒë³µ",acts:[{op:"enemyHealSelf",n:6}]}]},{id:"rock_golem",name:"ë°”ìœ„ ê³¨ë ˜",maxHp:50,intents:[{label:"7 í”¼í•´",acts:[{op:"damagePlayer",n:7}]},{label:"ìì‹  HP 10 íšŒë³µ",acts:[{op:"enemyHealSelf",n:10}]}]},{id:"slime",name:"ìŠ¬ë¼ì„",maxHp:30,intents:[{label:"ë‹¤ìŒ í„´ ë™ì•ˆ í”¼í•´ë¥¼ ì…ì§€ ì•ŠìŒ",acts:[{op:"enemyImmuneNextTurn"}]},{label:"ì•½í™” 3 ë¶€ì—¬ í›„ ìì‹  HP 3 íšŒë³µ",acts:[{op:"statusPlayer",key:"weak",n:3},{op:"enemyHealSelf",n:3}]},{label:"6 í”¼í•´",acts:[{op:"damagePlayer",n:6}]}]},{id:"poison_spider",name:"ë…ê±°ë¯¸",maxHp:28,intents:[{label:"ì¶œí˜ˆ 4 ë¶€ì—¬",acts:[{op:"statusPlayer",key:"bleed",n:4}]},{label:"7 í”¼í•´",acts:[{op:"damagePlayer",n:7}]},{label:"ì¶œí˜ˆ 2 ë¶€ì—¬, 6 í”¼í•´)",acts:[{op:"statusPlayer",key:"bleed",n:2},{op:"damagePlayer",n:6}]}]},{id:"boss_cursed_wall",name:"ì €ì£¼ë°›ì€ ë²½",maxHp:100,intents:[{label:"F += 1",acts:[{op:"fatiguePlayer",n:1}]},{label:"ì•„ë¬´ í–‰ë™ë„ í•˜ì§€ ì•ŠìŒ",acts:[]}]},{id:"boss_giant_orc",name:"ê±°ëŒ€í•œ ì˜¤í¬",maxHp:70,intents:[{label:"15 í”¼í•´",acts:[{op:"damagePlayer",n:15}]},{label:"ë‹¤ìŒ í„´ ë™ì•ˆ í”¼í•´ë¥¼ ì…ì§€ ì•ŠìŒ",acts:[{op:"enemyImmuneNextTurn"}]},{label:"ìì‹  HP 15 íšŒë³µ",acts:[{op:"enemyHealSelf",n:15}]}]},{id:"boss_soul_stealer",name:"ì˜í˜¼ ê°•íƒˆì",maxHp:50,intents:[{label:"7 í”¼í•´, S -2",acts:[{op:"damagePlayer",n:7},{op:"supplies",n:-2}]},{label:"7 í”¼í•´, F +1",acts:[{op:"damagePlayer",n:7},{op:"fatiguePlayer",n:1}]},{label:"ì¹´ìš´íŠ¸ ì§„í–‰",acts:[]}]}],ln=Object.fromEntries(sn.map(e=>[e.id,e]));function dn(e,t){t<=0||(e.player.block+=t,c(e,`ë°©ì–´(ë¸”ë¡) +${t} (í˜„ì¬ ${e.player.block})`))}function cn(e,t){e.player.supplies=ie(e.player.supplies+t,0),c(e,`ë³´ê¸‰ S ${t>=0?"+":""}${t} (í˜„ì¬ ${e.player.supplies})`)}function ae(e,t){e.player.fatigue=ie(e.player.fatigue+t,0),c(e,`í”¼ë¡œ F ${t>=0?"+":""}${t} (í˜„ì¬ ${e.player.fatigue})`)}function pn(e,t){if(t<=0)return;const n=e.player.hp;e.player.hp=Math.min(e.player.maxHp,e.player.hp+t),c(e,`HP +${e.player.hp-n} (í˜„ì¬ ${e.player.hp}/${e.player.maxHp})`)}function un(e){R(e).length===0&&(e.pendingTarget=null,e.pendingTargetQueue=[])}function Ue(e,t){e.fx||(e.fx={}),e.fx.enemyShake||(e.fx.enemyShake=[]),e.fx.enemyShake.push(t)}function fn(e){e.fx??={},e.fx.playerShake=!0}function G(e,t,n){const a=e.enemies.indexOf(t);if(a>=0&&!e.attackedEnemyIndicesThisTurn.includes(a)&&e.attackedEnemyIndicesThisTurn.push(a),n<=0)return;const r=e.player.status.weak??0,s=t.status.vuln??0;if(t.immuneThisTurn){c(e,`ì (${t.name})ì€(ëŠ”) ì´ë²ˆ í„´ í”¼í•´ ë©´ì—­ â†’ ${n} í”¼í•´ ë¬´ì‹œ`);return}let l=n-r+s;l<0&&(l=0),t.hp-=l,l>0&&Ue(e,a),t.hp<0&&(t.hp=0),c(e,`ì (${t.name})ì—ê²Œ ${l} í”¼í•´. (HP ${t.hp}/${t.maxHp})`),un(e)}function K(e,t,n,a,r){if(t<=0)return 0;let s=t;if(n==="ENEMY_ATTACK"){const l=r??0,u=e.player.status.vuln??0;if(s=s-l+u,s<0&&(s=0),e.player.block>0){const d=Math.min(e.player.block,s);e.player.block-=d,s-=d}}return s<=0?0:(e.player.hp=Math.max(0,e.player.hp-s),s>0&&fn(e),c(e,`í”Œë ˆì´ì–´ ${s} í”¼í•´ (${a??n}). (HP ${e.player.hp}/${e.player.maxHp})`),s)}function hn(){return we[Math.floor(Math.random()*we.length)]}const we=[{id:"drop_bag",name:"ì§ ë²„ë¦¬ê¸°",prompt:"ì§ì„ ì¤„ì—¬ í”¼ë¡œë¥¼ ë‚®ì¶”ì.",options:()=>[{key:"drop",label:"ì¹´ë“œ 1ì¥ ì œê±°, F -= 1",apply:e=>(ae(e,-1),c(e,"ì´ë²¤íŠ¸: ì§ ë²„ë¦¬ê¸° â†’ ì œê±°í•  ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”."),{kind:"REMOVE_PICK",title:"ì§ ë²„ë¦¬ê¸°",prompt:"ì œê±°í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",then:"NONE"})},{key:"skip",label:"ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠëŠ”ë‹¤",apply:e=>(c(e,"ì´ë²¤íŠ¸: ì§ ë²„ë¦¬ê¸°(ìƒëµ)"),"NONE")}]},{id:"hide_from_monster",name:"ëª¬ìŠ¤í„°ë¡œë¶€í„° ìˆ¨ê¸°",prompt:"ì „íˆ¬í•˜ê±°ë‚˜, ëŒ€ê°€ë¥¼ ì¹˜ë¥´ê³  ìˆ¨ì„ ìˆ˜ ìˆë‹¤.",options:()=>[{key:"fight",label:"ì „íˆ¬",apply:e=>(c(e,"ì´ë²¤íŠ¸: ëª¬ìŠ¤í„°ë¡œë¶€í„° ìˆ¨ê¸° â†’ ì „íˆ¬ ì„ íƒ"),"BATTLE")},{key:"remove_and_fatigue",label:"ì¹´ë“œ 1ì¥ ì œê±° í›„ F += 1",apply:e=>(ae(e,1),c(e,"ì´ë²¤íŠ¸: ëª¬ìŠ¤í„°ë¡œë¶€í„° ìˆ¨ê¸° â†’ ì¹´ë“œ ì œê±° í›„ F+1"),{kind:"REMOVE_PICK",title:"ìˆ¨ê¸°",prompt:"ì œê±°í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",then:"NONE"})}]},{id:"overweight",name:"ê³¼ì¤‘ëŸ‰",prompt:"ë„ˆë¬´ ë§ì€ ì§ì´ í”¼ë¡œë¥¼ ë¶€ë¥¸ë‹¤!",options:e=>{const t=Object.values(e.cards).filter(a=>["deck","hand","discard"].includes(a.zone)).length,n=Math.floor(t/5);return[{key:"accept",label:`F +${n} (ë²„ë¦¼)`,apply:a=>(ae(a,n),c(a,`ì´ë²¤íŠ¸: ê³¼ì¤‘ëŸ‰ (ë± ${t}ì¥ â†’ F +${n})`),"NONE")}]}},{id:"goblin_ambush_low_supplies",name:"ë§¤ë³µí•œ ì•½íƒˆìë“¤",prompt:`ê³ ë¸”ë¦°ë“¤ì´ ë³´ê¸‰ì„ ì•½íƒˆí–ˆë‹¤.
ì´ë²ˆ ì „íˆ¬ëŠ” ë³´ê¸‰(S) 5ë¡œ ì‹œì‘í•©ë‹ˆë‹¤.`,options:()=>[{key:"fight",label:"ë§ì„œ ì‹¸ìš´ë‹¤",detail:"ê³ ë¸”ë¦° ì•½íƒˆì 2ë§ˆë¦¬ ì „íˆ¬ (S=5 ì‹œì‘)",apply:e=>(e.run.nextBattleSuppliesBonus=-5,{kind:"BATTLE_SPECIAL",title:"ê³ ë¸”ë¦° ë§¤ë³µ",enemyIds:["goblin_raider","goblin_raider"]})}]},{id:"find_adventurer",name:"ë‹¤ë¥¸ ëª¨í—˜ê°€ ë°œê²¬",prompt:"ê±°ë˜í•œë‹¤.",options:e=>e.run.treasureObtained?[{key:"adventurer:forced_battle",label:"ëŒ€ì¹˜í•œë‹¤",detail:"ë³´ë¬¼ì„ ë…¸ë¦¬ê³  ë¤ë²¼ë“ ë‹¤.",apply:t=>({kind:"BATTLE_SPECIAL",enemyIds:["other_adventurer"],title:"ë³´ë¬¼ì„ ë…¸ë¦¬ëŠ” ëª¨í—˜ê°€"})}]:[{key:"trade",label:"ì¹´ë“œ 1ì¥ ì œê±° í›„ ì¹´ë“œ ë³´ìƒ(2ì¥ ì¤‘ 1ì¥)",apply:t=>(c(t,"ì´ë²¤íŠ¸: ë‹¤ë¥¸ ëª¨í—˜ê°€ ë°œê²¬ â†’ ì œê±°í•  ì¹´ë“œ ì„ íƒ í›„ ë³´ìƒ"),{kind:"REMOVE_PICK",title:"ë‹¤ë¥¸ ëª¨í—˜ê°€ ë°œê²¬",prompt:"ì œê±°í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",then:"REWARD"})},{key:"leave",label:"ì§€ë‚˜ì¹œë‹¤",apply:t=>(c(t,"ì´ë²¤íŠ¸: ë‹¤ë¥¸ ëª¨í—˜ê°€ ë°œê²¬(ìƒëµ)"),"NONE")}]},{id:"edible_mushroom",name:"ì‹ìš© ë²„ì„¯ ë°œê²¬",prompt:"ê¸°ìš´ì´ ë‚œë‹¤. ë‹¤ìŒ ì „íˆ¬ì˜ ì‹œì‘ ë³´ê¸‰ì´ ëŠ˜ì–´ë‚œë‹¤.",options:()=>[{key:"eat",label:"F -= 2, ë‹¤ìŒ ì „íˆ¬ ì‹œì‘ S +5",apply:e=>(e.player.fatigue=Math.max(0,e.player.fatigue-2),e.run.nextBattleSuppliesBonus+=5,c(e,"ì‹ìš© ë²„ì„¯: F -2, ë‹¤ìŒ ì „íˆ¬ ì‹œì‘ S +5"),"NONE")}]}],mn=[{id:"berserk",weight:20},{id:"bandage",weight:12},{id:"arrow_rain",weight:20},{id:"smoke",weight:0},{id:"redeploy",weight:12},{id:"secret_strike",weight:1},{id:"fire_scroll",weight:1},{id:"caltrops",weight:12},{id:"emergency_rations",weight:1},{id:"painkiller",weight:1},{id:"field_experience",weight:1},{id:"camp_prep",weight:20},{id:"vital_shot",weight:12},{id:"taunt",weight:12},{id:"rapid_fire",weight:12}];function bn(e){const t=new Map;for(const n of e){const a=Math.max(0,n.weight??0);a<=0||t.set(n.id,(t.get(n.id)??0)+a)}return[...t.entries()].map(([n,a])=>({id:n,w:a}))}function He(e){let t=0;for(const a of e)t+=a.w;if(t<=0)throw new Error("No positive weights to pick from.");let n=Math.random()*t;for(const a of e)if(n-=a.w,n<=0)return a.id;return e[e.length-1].id}function ge(){return Math.random()<.1?1:0}function Ke(){const e=bn(mn),t=He(e),n=e.filter(r=>r.id!==t),a=He(n);return[{defId:t,upgrade:ge()},{defId:a,upgrade:ge()}]}function Tn(e){return e.uidSeq+=1,`c_${e.uidSeq}`}function Ae(e,t,n){const a=Tn(e);e.cards[a]={uid:a,defId:t,zone:"deck",upgrade:n?.upgrade??0},e.deck.push(a)}const kn="goal_treasure";function yn(e,t){const n=e.cards[t];if(n){if(n.defId===kn){c(e,"ì €ì£¼ë°›ì€ ë³´ë¬¼ì€ ë±ì—ì„œ ì œê±°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");return}e.deck=e.deck.filter(a=>a!==t),e.hand=e.hand.filter(a=>a!==t),e.discard=e.discard.filter(a=>a!==t),e.frontSlots=e.frontSlots.map(a=>a===t?null:a),e.backSlots=e.backSlots.map(a=>a===t?null:a),n.zone="vanished",e.vanished.push(t),c(e,`ì¹´ë“œ ì œê±°: [${z(e,n.uid).name} +${e.cards[n.uid].upgrade??0}]`)}}function ze(e,t){const n=e.cards[t];if(!n)return!1;const r=e.content.cardsById[n.defId].upgrades?.length??0;return(n.upgrade??0)<r}function xn(e,t){return ze(e,t)?(e.cards[t].upgrade=(e.cards[t].upgrade??0)+1,!0):!1}function Cn(){return{cardsById:on,enemiesById:ln}}function En(e,t){const n={kind:"damageSelect",amount:t};e.pendingTarget==null?e.pendingTarget=n:e.pendingTargetQueue.push(n);const a=(e.pendingTarget?1:0)+e.pendingTargetQueue.length;c(e,`ëŒ€ìƒ ì„ íƒ í•„ìš”: ì ì„ í´ë¦­í•˜ì„¸ìš”. (ë‚¨ì€ ì„ íƒ ${a})`)}function Sn(e,t,n){const a={kind:"statusSelect",key:t,n};e.pendingTarget==null?e.pendingTarget=a:e.pendingTargetQueue.push(a);const r=(e.pendingTarget?1:0)+e.pendingTargetQueue.length;c(e,`ëŒ€ìƒ ì„ íƒ í•„ìš”: ì ì„ í´ë¦­í•˜ì„¸ìš”. (ë‚¨ì€ ì„ íƒ ${r})`)}function Pn(e,t){const n=e.content.enemiesById[t.id];return n.intents[t.intentIndex%n.intents.length].acts.some(r=>r.op==="damagePlayer"||r.op==="damagePlayerFormula")}function ee(e,t){const n=e.game;for(const a of t)switch(a.op){case"block":dn(n,a.n);break;case"supplies":cn(n,a.n);break;case"fatigue":ae(n,a.n);break;case"heal":pn(n,a.n);break;case"hp":n.player.hp=Math.max(0,Math.min(n.player.maxHp,n.player.hp+a.n)),c(n,`HP ${a.n>=0?"+":""}${a.n} (í˜„ì¬ ${n.player.hp}/${n.player.maxHp})`);break;case"maxHp":n.player.maxHp+=a.n,n.player.hp=Math.min(n.player.maxHp,n.player.hp+a.n),c(n,`ìµœëŒ€ HP +${a.n} (í˜„ì¬ ${n.player.hp}/${n.player.maxHp})`);break;case"setSupplies":n.player.supplies=Math.max(0,a.n),c(n,`ë³´ê¸‰ Së¥¼ ${n.player.supplies}ìœ¼ë¡œ ì„¤ì •`);break;case"draw":{const r=ye(n,a.n);n.drawCountThisTurn+=r;break}case"ifDrewThisTurn":{n.drawCountThisTurn>0&&ee(e,a.then);break}case"damageEnemy":if(a.target==="random"){const r=R(n);if(r.length===0)break;G(n,W(r),a.n)}else if(a.target==="all")for(const r of R(n))G(n,r,a.n);else En(n,a.n);break;case"clearStatusSelf":{const r=a.key;n.player.status[r]=0,c(n,`ìƒíƒœ í•´ì œ: ${r} = 0`);break}case"damageEnemyBy":{if(a.target!=="random")break;const r=R(n);if(r.length===0)break;let s=0;a.by==="frontCount"&&(s=n.frontSlots.filter(Boolean).length*a.nPer),G(n,W(r),s);break}case"damageEnemyByPlayerFatigue":{const r=Math.max(0,n.player.fatigue*a.mult);if(a.target==="random"){const s=R(n);if(s.length===0)break;G(n,W(s),r);break}if(a.target==="select"){if(r<=0)break;n.pendingTargetQueue.push({kind:"damageSelect",amount:r}),n.pendingTarget=n.pendingTarget??n.pendingTargetQueue.shift()??null;break}break}case"statusPlayer":n.player.status[a.key]=Math.max(0,(n.player.status[a.key]??0)+a.n),c(n,`í”Œë ˆì´ì–´ ìƒíƒœ: ${a.key} ${a.n>=0?"+":""}${a.n}`);break;case"statusEnemy":if(a.target==="random"){const r=R(n);if(r.length===0)break;const s=W(r);ue(s,a.key,a.n),c(n,`ì (${s.name}) ìƒíƒœ: ${a.key} ${a.n>=0?"+":""}${a.n}`)}else if(a.target==="all"){const r=R(n);if(r.length===0)break;for(const s of r)ue(s,a.key,a.n);c(n,`ëª¨ë“  ì  ìƒíƒœ: ${a.key} ${a.n>=0?"+":""}${a.n}`)}else Sn(n,a.key,a.n);break;case"statusEnemiesAttackingThisTurn":{const r=R(n).filter(s=>Pn(n,s));if(r.length===0){c(n,`ì´ë²ˆ í„´ ê³µê²© ì˜ë„ ì  ì—†ìŒ â†’ ${a.key} ì ìš© ì—†ìŒ`);break}for(const s of r)s.status[a.key]=Math.max(0,(s.status[a.key]??0)+a.n);c(n,`ê³µê²© ì˜ë„ ì ì—ê²Œ ${a.key} ${a.n>=0?"+":""}${a.n} (ëŒ€ìƒ ${r.length})`);break}case"immuneDisruptThisTurn":n.player.immuneToDisruptThisTurn=!0,c(n,"ì´ë²ˆ í„´ êµë€ ë¬´ì‹œ");break;case"nullifyDamageThisTurn":n.player.nullifyDamageThisTurn=!0,c(n,"ì´ë²ˆ í„´ í”¼í•´ ë¬´íš¨");break;case"triggerFrontOfBackSlot":{const r=n.backSlots[a.index];if(!r){c(n,`ì¬ë°°ì¹˜: í›„ì—´ ${a.index+1}ë²ˆ ìŠ¬ë¡¯ì´ ë¹„ì–´ ìˆìŒ`);break}const s=z(n,r);c(n,`ì¬ë°°ì¹˜: [[${j(n,r)}]]ì˜ ì „ì—´ íš¨ê³¼ë¥¼ ì¶”ê°€ ë°œë™`),ee({game:n},s.front);break}default:return a}}function pe(e,t){const n=e.content.enemiesById[t];return{id:n.id,name:n.name,hp:n.maxHp,maxHp:n.maxHp,intentIndex:0,status:{vuln:0,weak:0,bleed:0,disrupt:0},immuneThisTurn:!1,immuneNextTurn:!1,soulWarnCount:t==="boss_soul_stealer"?0:void 0,soulArmed:t==="boss_soul_stealer"?!1:void 0,soulWillNukeThisTurn:t==="boss_soul_stealer"?!1:void 0}}function $n(e,t,n,a=5){for(const r of t){const s=e.run.enemyLastSeenBattle[r];if(s!=null&&n-s<a)return!1}return!0}function ne(e,t){const n=t?.forceBoss??!1,a=e.run.nodePickCount,r=e.run.battleCount+1;if(t?.forcePatternIds&&t.forcePatternIds.length>0){const o=t.forcePatternIds;e.run.battleCount=r;for(const p of o)e.run.enemyLastSeenBattle[p]=r;e.enemies=o.map(p=>pe(e,p)),c(e,`ì „íˆ¬ ì‹œì‘! (ë…¸ë“œ ${a}, ì „íˆ¬ ${r}íšŒì°¨) ì : ${e.enemies.map(p=>p.name).join(", ")}`);return}if(n)if(e.run.bossPool.length===0)c(e,`ë³´ìŠ¤ í’€ì´ ë¹„ì—ˆìŠµë‹ˆë‹¤. ì¼ë°˜ ì „íˆ¬ë¡œ ì§„í–‰í•©ë‹ˆë‹¤. (ë…¸ë“œ ${a})`);else{const o=W(e.run.bossPool);e.run.bossPool=e.run.bossPool.filter(p=>p!==o),e.run.battleCount=r,e.run.enemyLastSeenBattle[o]=r,e.enemies=[pe(e,o)],c(e,`ë³´ìŠ¤ ë“±ì¥! (ë…¸ë“œ ${a}, ì „íˆ¬ ${r}íšŒì°¨) ì : ${e.enemies[0].name}`);return}const s=[[["goblin_raider"],["watching_statue"],["pebble_golem"],["slime"]],[["goblin_raider","slime"],["pebble_golem","pebble_golem"],["rock_golem"],["goblin_raider","goblin_raider"],["poison_spider"]],[["goblin_raider","goblin_raider","goblin_raider"],["pebble_golem","pebble_golem","slime"],["rock_golem","pebble_golem"],["slime","slime"],["poison_spider","slime"]]],l=Math.min(s.length-1,Math.floor((a-1)/10)),u=s[l],d=5,y=u.filter(o=>$n(e,o,r,d)),m=y.length>0?y:u,i=W(m);e.run.battleCount=r;for(const o of i)e.run.enemyLastSeenBattle[o]=r;e.enemies=i.map(o=>pe(e,o)),c(e,`ì „íˆ¬ ì‹œì‘! (ë…¸ë“œ ${a}, ì „íˆ¬ ${r}íšŒì°¨) ì : ${e.enemies.map(o=>o.name).join(", ")}`)}function te(e){e.phase="REVEAL",e.frontSlots=[null,null,null],e.backSlots=[null,null,null],e.backSlotDisabled=[!1,!1,!1],e.backUidsThisTurn=[],e.hand=[],e.selectedHandCardUid=null,e.pendingTarget=null,e.pendingTargetQueue=[],e.usedThisTurn=0,e.winHooksAppliedThisCombat=!1;const t=e.run.nextBattleSuppliesBonus??0;e.player.supplies=10+t,t>0&&(c(e,`ë‹¤ìŒ ì „íˆ¬ ë³´ë„ˆìŠ¤ ì ìš©: S +${t}`),e.run.nextBattleSuppliesBonus=0),e.player.immuneToDisruptThisTurn=!1,e.player.nullifyDamageThisTurn=!1,e.intentsRevealedThisTurn=!1,e.disruptIndexThisTurn=null,e.drawCountThisTurn=0,e.attackedEnemyIndicesThisTurn=[],e.frontPlacedThisTurn=0,e.usedThisTurn=0,ye(e,4),ke(e),e.phase="PLACE"}const wn=2,Hn=.6;function ke(e){if(e.intentsRevealedThisTurn)return;e.intentsRevealedThisTurn=!0,e.attackedEnemyIndicesThisTurn=[],e.backUidsThisTurn=[],e.drawCountThisTurn=0,e.phase="REVEAL",e.player.immuneToDisruptThisTurn=!1,e.player.nullifyDamageThisTurn=!1,e.disruptIndexThisTurn=null,e.backSlotDisabled=[!1,!1,!1],(e.player.status.disrupt??0)>0&&(e.disruptIndexThisTurn=Math.floor(Math.random()*3),e.backSlotDisabled[e.disruptIndexThisTurn]=!0);for(const n of e.enemies)n.immuneThisTurn=n.immuneNextTurn,n.immuneNextTurn=!1;for(const n of R(e)){const a=e.content.enemiesById[n.id],r=a.intents.length;if(r<=0)continue;if(n.intentIndex=Math.floor(Math.random()*r),n.id==="boss_soul_stealer"){n.soulWillNukeThisTurn=!1;const l=n.soulWarnCount??0;if(!!n.soulArmed){if(Math.random()<Hn){n.soulWillNukeThisTurn=!0,c(e,`ì  ì˜ë„: ${n.name} â†’ ì˜í˜¼ í­ë°œ (50 í”¼í•´!)`);continue}n.intentIndex=Math.floor(Math.random()*r);const y=a.intents[n.intentIndex];c(e,`ì  ì˜ë„: ${n.name} â†’ ${y.label} (âš  í­ë°œ ê°€ëŠ¥ ìƒíƒœ)`);continue}n.intentIndex=Math.floor(Math.random()*r);const d=a.intents[n.intentIndex];c(e,`ì  ì˜ë„: ${n.name} â†’ ${d.label} (ê²½ê³  ${l}/3)`);continue}const s=a.intents[n.intentIndex];c(e,`ì  ì˜ë„: ${n.name} â†’ ${s.label}`)}e.disruptIndexThisTurn!==null&&c(e,`êµë€: ì´ë²ˆ í„´ í›„ì—´ ${e.disruptIndexThisTurn} ë¬´íš¨`),e.phase="PLACE"}function Ie(e,t,n,a){if(e.phase!=="PLACE"||!e.hand.includes(t))return;n==="back"&&(e.backUidsThisTurn.includes(t)||e.backUidsThisTurn.push(t));const r=n==="front"?e.frontSlots:e.backSlots;r[a]||(e.hand=e.hand.filter(s=>s!==t),r[a]=t,e.cards[t].zone=n,e.usedThisTurn+=1,c(e,`[${j(e,t)}]ë¥¼ ${n==="front"?"ì „ì—´":"í›„ì—´"} ${a}ë²ˆì— ë°°ì¹˜`),n==="front"&&(e.frontPlacedThisTurn+=1))}function Be(e,t,n){return z(e,t).tags?.includes(n)??!1}function gn(e,t){e.frontSlots=e.frontSlots.map(n=>n===t?null:n),e.backSlots=e.backSlots.map(n=>n===t?null:n)}function re(e,t,n){const a=z(e,t);gn(e,t),e.hand=e.hand.filter(l=>l!==t),e.deck=e.deck.filter(l=>l!==t),e.discard=e.discard.filter(l=>l!==t);const r=a.vanishWhen==="BOTH"||a.vanishWhen==="FRONT"&&n==="front"||a.vanishWhen==="BACK"&&n==="back",s=a.exhaustWhen==="BOTH"||a.exhaustWhen==="FRONT"&&n==="front"||a.exhaustWhen==="BACK"&&n==="back";if(a.vanishWhen&&r){e.vanished.push(t),e.cards[t].zone="vanished",c(e,`[${j(e,t)}] ì†Œì‹¤(ì˜êµ¬ ì œê±°)`);return}if(a.exhaustWhen&&s){e.exhausted.push(t),e.cards[t].zone="exhausted",c(e,`[${j(e,t)}] ì†Œëª¨(ì´ë²ˆ ì „íˆ¬ì—ì„œ ì œê±°)`);return}if(!a.vanishWhen&&Be(e,t,"VANISH")){e.vanished.push(t),e.cards[t].zone="vanished",c(e,`[${j(e,t)}] ì†Œì‹¤(ì˜êµ¬ ì œê±°)`);return}if(!a.exhaustWhen&&Be(e,t,"EXHAUST")){e.exhausted.push(t),e.cards[t].zone="exhausted",c(e,`[[${j(e,t)}]] ì†Œëª¨(ì´ë²ˆ ì „íˆ¬ì—ì„œ ì œê±°)`);return}e.discard.push(t),e.cards[t].zone="discard"}function An(e){for(let t=0;t<3;t++){const n=e.frontSlots[t];n&&re(e,n,"front"),e.frontSlots[t]=null;const a=e.backSlots[t];a&&re(e,a,"back"),e.backSlots[t]=null}}function In(e){if(!(e.phase!=="PLACE"&&e.phase!=="BACK")){e.phase="BACK",c(e,"=== í›„ì—´ ë‹¨ê³„ ===");for(let t=0;t<3;t++){const n=e.backSlots[t];if(!n)continue;const a=z(e,n);if(!e.player.immuneToDisruptThisTurn&&e.backSlotDisabled[t]){c(e,`í›„ì—´ ${t}ë²ˆ [${a.name}] êµë€ìœ¼ë¡œ ë¬´íš¨`);continue}ee({game:e},a.back),re(e,n,"back")}e.phase="FRONT"}}function Bn(e){if(e.phase==="FRONT"){c(e,"=== ì „ì—´ ë‹¨ê³„ ===");for(let t=0;t<3;t++){const n=e.frontSlots[t];if(!n)continue;const a=z(e,n);ee({game:e},a.front),re(e,n,"front")}e.phase="ENEMY"}}function Nn(e){if(e.phase==="ENEMY"){c(e,"=== ì  í–‰ë™ ===");for(const t of R(e)){const n=e.content.enemiesById[t.id],a=n.intents[t.intentIndex%n.intents.length];if(t.id==="boss_soul_stealer"){if(t.soulWillNukeThisTurn){const r=t.status.weak??0;K(e,50,"ENEMY_ATTACK","ì˜í˜¼ ê°•íƒˆì",r),c(e,"ì˜í˜¼ ê°•íƒˆì: ì˜í˜¼ í­ë°œ â†’ 50 í”¼í•´!"),t.soulWillNukeThisTurn=!1,t.soulArmed=!1,t.soulWarnCount=0;continue}for(const r of a.acts)Ne(e,t,r);t.intentIndex===wn&&(t.soulWarnCount=(t.soulWarnCount??0)+1,c(e,`ì˜í˜¼ ê°•íƒˆì: ê²½ê³  +1 (${t.soulWarnCount}/3)`),(t.soulWarnCount??0)>=3&&(t.soulArmed=!0,c(e,"ì˜í˜¼ ê°•íƒˆì: ê²½ê³  3íšŒ ì™„ë£Œ â†’ í­ë°œ ê°€ëŠ¥ ìƒíƒœ!")));continue}for(const r of a.acts)Ne(e,t,r)}e.phase="UPKEEP"}}function Ne(e,t,n){switch(n.op){case"damagePlayer":const a=t.status.weak??0;K(e,n.n,"ENEMY_ATTACK",t.name,a);break;case"damagePlayerFormula":if(n.kind==="goblin_raider"){const r=Math.max(0,12-e.usedThisTurn),s=t.status.weak??0;K(e,r,"ENEMY_ATTACK",t.name,s)}else{const r=4+e.usedThisTurn,s=t.status.weak??0;K(e,r,"ENEMY_ATTACK",t.name,s)}break;case"supplies":e.player.supplies=ie(e.player.supplies+n.n,0),c(e,`ì  íš¨ê³¼: ë³´ê¸‰ S ${n.n>=0?"+":""}${n.n} (í˜„ì¬ ${e.player.supplies})`);break;case"statusPlayer":tn(e.player,n.key,n.n),c(e,`ì  íš¨ê³¼: í”Œë ˆì´ì–´ ìƒíƒœ ${n.key} ${n.n>=0?"+":""}${n.n}`);break;case"enemyHealSelf":t.hp=Math.min(t.maxHp,t.hp+n.n),c(e,`ì (${t.name})ì´(ê°€) ${n.n} íšŒë³µ (HP ${t.hp}/${t.maxHp})`);break;case"enemyImmuneThisTurn":t.immuneThisTurn=!0,c(e,`ì (${t.name})ì´(ê°€) í”¼í•´ ë©´ì—­ ìƒíƒœê°€ ë¨`);break;case"enemyImmuneNextTurn":t.immuneNextTurn=!0,c(e,`ì (${t.name})ì´(ê°€) ë‹¤ìŒ í„´ í”¼í•´ ë©´ì—­ ìƒíƒœê°€ ë¨`);break;case"fatiguePlayer":e.player.fatigue=Math.max(0,e.player.fatigue+n.n),c(e,`ì  íš¨ê³¼: í”¼ë¡œ F ${n.n>=0?"+":""}${n.n} (í˜„ì¬ ${e.player.fatigue})`);break;default:return n}}function vn(e){if(e.phase!=="UPKEEP")return;c(e,"=== ìœ ì§€ë¹„ / ìƒíƒœ ì²˜ë¦¬ ===");const t=e.frontPlacedThisTurn;t>0&&c(e,`ì „ì—´ ìœ ì§€ë¹„ ì²˜ë¦¬: ì „ì—´ ${t}ì¥`);for(let a=0;a<t;a++)e.player.supplies>0?e.player.supplies-=1:(e.player.fatigue+=1,K(e,3,"ZERO_SUPPLY","ì „ì—´ ìœ ì§€ë¹„ ë¶€ì¡±!"));if(e.player.supplies===0){e.player.zeroSupplyTurns+=1;const a=e.player.zeroSupplyTurns;K(e,a,"ZERO_SUPPLY",`ë³´ê¸‰ ì—†ì´ í„´ ì¢…ë£Œ! ëˆ„ì  ${a}ë²ˆì§¸`)}const n=e.player.status.bleed??0;n>0&&K(e,n,"BLEED","ì¶œí˜ˆ");for(const a of R(e)){const r=a.status.bleed??0;if(r>0)if(a.immuneThisTurn)c(e,`ì (${a.name})ì€(ëŠ”) ì´ë²ˆ í„´ ë©´ì—­ì´ë¼ ì¶œí˜ˆ í”¼í•´ ë¬´ì‹œ`);else{a.hp=Math.max(0,a.hp-r);const s=e.enemies.indexOf(a);s>=0&&Ue(e,s),c(e,`ì (${a.name}) ì¶œí˜ˆë¡œ HP -${r} (HP ${a.hp}/${a.maxHp})`)}}e.frontPlacedThisTurn=0,Rn(e),An(e),e.phase="DRAW"}function Rn(e){const t=["vuln","weak","bleed","disrupt"];for(const n of t)e.player.status[n]>0&&(e.player.status[n]-=1);for(const n of e.enemies)for(const a of t)n.status[a]>0&&(n.status[a]-=1)}function _n(e){if(e.phase!=="DRAW"||(e.intentsRevealedThisTurn=!1,e.disruptIndexThisTurn=null,Ln(e),e.run.finished))return;if(R(e).length===0){e.phase="NODE";return}const t=e.usedThisTurn;e.usedThisTurn=0,ye(e,t),e.player.block>0&&(e.player.block=0,c(e,"ë°©ì–´(ë¸”ë¡) ì†Œì‹¤")),ke(e)}function ye(e,t){let n=0;for(let a=0;a<t;a++){On(e);const r=e.deck.pop();if(!r)break;e.hand.push(r),n++}return c(e,`ë“œë¡œìš° ${n}/${t} (ì†íŒ¨ ${e.hand.length})`),n}function On(e){if(e.deck.length===0&&e.discard.length>0){e.deck=We(e.discard),e.discard=[];const t=e.player.fatigue;t>0?K(e,t,"FATIGUE","í”¼ë¡œë„"):c(e,"í”¼ë¡œë„ í”¼í•´ ì—†ìŒ (F=0)"),e.player.fatigue+=1,c(e,`í”¼ë¡œë„ F +1 (í˜„ì¬ ${e.player.fatigue})`)}}function Dn(e,t){if(!e.pendingTarget)return;if(R(e).length===0){e.pendingTarget=null,e.pendingTargetQueue=[];return}const n=e.enemies[t];if(!n||n.hp<=0)return;const a=e.pendingTarget;a.kind==="damageSelect"?G(e,n,a.amount):a.kind==="statusSelect"&&(ue(n,a.key,a.n),c(e,`ì (${n.name}) ìƒíƒœ: ${a.key} ${a.n>=0?"+":""}${a.n}`)),e.pendingTarget=e.pendingTargetQueue.shift()??null}function Ln(e){if(e.player.hp<=0){e.run.finished=!0,c(e,"íŒ¨ë°°: í”Œë ˆì´ì–´ HPê°€ 0 ì´í•˜");return}if(R(e).length===0&&e.phase!=="NODE"){if(Fn(e),c(e,"ìŠ¹ë¦¬: ì ì„ ëª¨ë‘ ì²˜ì¹˜!"),Mn(e),e.player.zeroSupplyTurns=0,e.run.treasureObtained&&e.run.afterTreasureNodePicks>=10){e.run.finished=!0,c(e,"ìŠ¹ë¦¬! ì €ì£¼ë°›ì€ ë³´ë¬¼ì„ ì–»ì€ í›„ 10í„´ ë™ì•ˆ ì‚´ì•„ë‚¨ì•˜ìŠµë‹ˆë‹¤.");return}const[t,n]=Ke(),a=F(e.content,t.defId,t.upgrade),r=F(e.content,n.defId,n.upgrade),s=t.upgrade>0?`${a.name} +${t.upgrade}`:a.name,l=n.upgrade>0?`${r.name} +${n.upgrade}`:r.name;e.choice={kind:"REWARD",title:"ì „íˆ¬ ë³´ìƒ",prompt:"ë‘ ì¥ ì¤‘ í•œ ì¥ì„ ì„ íƒí•˜ê±°ë‚˜ ìƒëµí•©ë‹ˆë‹¤.",options:[{key:`pick:${t.defId}:${t.upgrade}`,label:s,detail:`ì „ì—´: ${a.frontText} / í›„ì—´: ${a.backText}`},{key:`pick:${n.defId}:${n.upgrade}`,label:l,detail:`ì „ì—´: ${r.frontText} / í›„ì—´: ${r.backText}`},{key:"skip",label:"ìƒëµ"}]};return}}function Mn(e){const t=[];for(const s of e.deck)t.push(s);for(const s of e.hand)t.push(s);for(const s of e.discard)t.push(s);for(const s of e.frontSlots)s&&t.push(s);for(const s of e.backSlots)s&&t.push(s);for(const s of e.exhausted)t.push(s);const n=new Set,r=t.filter(s=>n.has(s)?!1:(n.add(s),!0)).filter(s=>e.cards[s]?.zone!=="vanished");e.deck=r;for(const s of r)e.cards[s].zone="deck";e.hand=[],e.discard=[],e.frontSlots=[null,null,null],e.backSlots=[null,null,null],e.selectedHandCardUid=null,e.exhausted=[],e.pendingTarget=null,e.pendingTargetQueue=[],Wn(e.deck)}function Wn(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}function Fn(e){if(!e.winHooksAppliedThisCombat){e.winHooksAppliedThisCombat=!0;for(const t of e.backUidsThisTurn){if(!e.cards[t])continue;const r=z(e,t).onWinWhileInBack;!r||r.length===0||ee({game:e},r)}}}const Un=`# Deck Rogue Prototype â€” ë£°ë¶ (í”Œë ˆì´ì–´ìš©)

ì´ ë¬¸ì„œëŠ” ìŠ¤í¬ì¼ëŸ¬ë¥¼ ìµœì†Œí™”í•©ë‹ˆë‹¤.

[1] ê°œìš”
ë…¸ë“œë¥¼ ì„ íƒí•˜ë©° ì§„í–‰í•˜ê³ , ì „íˆ¬ì—ì„œ ì‚´ì•„ë‚¨ì•„ ì„±ì¥í•©ë‹ˆë‹¤. ëª©í‘œëŠ” ë¬´ì—‡ì¼ê¹Œìš”?
ëª¨ë“  ì¹´ë“œëŠ” ì „ì—´ê³¼ í›„ì—´ì´ ìˆìŠµë‹ˆë‹¤. ë°°ì¹˜ì— ë”°ë¼ ì—­í• ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤.

[2] ë³´ê¸‰ê³¼ í”¼ë¡œë„

ë³´ê¸‰(S): ì „ì—´ ì¹´ë“œ ë° ì¼ë¶€ íš¨ê³¼ì˜ ë°œë™ì— ì‚¬ìš©ë©ë‹ˆë‹¤. ë³´í†µ 10ìœ¼ë¡œ ì‹œì‘í•©ë‹ˆë‹¤.
ë³´ê¸‰ì´ ë¶€ì¡±í•œ ìƒíƒœë¡œ í„´ ì¢…ë£Œ ì‹œ, ì´ë²ˆ ì „íˆ¬ì—ì„œ ë³´ê¸‰ ì—†ì´ ì¢…ë£Œí•œ í„´ì˜ íšŸìˆ˜ë§Œí¼ í”¼í•´ë¥¼ ë°›ìŠµë‹ˆë‹¤.

í”¼ë¡œë„(F): ë±ì„ ì„ì„ ë•Œ í”¼ë¡œë„ê°€ 1 ì˜¬ë¼ê°€ë©°, ì¼ë¶€ ì¹´ë“œì˜ íš¨ê³¼ë¡œë„ ë³€í•©ë‹ˆë‹¤.
ë±ì„ ì„ì„ ë•Œ í”¼ë¡œë„ë§Œí¼ í”¼í•´ë¥¼ ì…ìŠµë‹ˆë‹¤. í”¼ë¡œë„ëŠ” ì „íˆ¬ê°€ ëë‚˜ë„ ìœ ì§€ë©ë‹ˆë‹¤.

ë³´ê¸‰ì´ ë¶€ì¡±í•œ ì±„ë¡œ í„´ì„ ë§ˆì¹  ë•Œ, ì‚¬ìš©í•œ ì „ì—´ ì¹´ë“œ í•œ ì¥ ë‹¹ í”¼í•´ë¥¼ 3 ë°›ìœ¼ë©°, Fê°€ 1 ì¦ê°€í•©ë‹ˆë‹¤.
ì´ íš¨ê³¼ëŠ” ë³´ê¸‰ ìì²´ì— ì˜í•œ HP ì†ì‹¤ê³¼ ë³„ê°œì…ë‹ˆë‹¤!

[3] ì „íˆ¬ íë¦„
ë°°ì¹˜ â†’ í›„ì—´ ë°œë™ â†’ ì „ì—´ ë°œë™ â†’ ì  í–‰ë™ â†’ ì •ë¦¬ â†’ ë“œë¡œìš°
â€» â€œëŒ€ìƒ ì„ íƒ í•„ìš”â€ê°€ ëœ¨ë©´ ì‚´ì•„ìˆëŠ” ì ì„ í´ë¦­í•´ ëŒ€ìƒì„ ì •í•˜ì„¸ìš”.
â€» í›„ì—´ ë°œë™ì„ ëˆ„ë¥´ë©´ í„´ì´ ì§„í–‰ë˜ì–´, ì¹´ë“œì˜ ë°°ì¹˜ë¥¼ ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
ë³´ê¸‰ ë° ê·¸ì— ë”°ë¥¸ ë³€í™”ëŠ” ì •ë¦¬ ë‹¨ê³„ì—ì„œ ì²˜ë¦¬í•©ë‹ˆë‹¤.

ì†íŒ¨ëŠ” í„´ì´ ì¢…ë£Œë˜ì–´ë„ ìœ ì§€ë©ë‹ˆë‹¤.
ì¹´ë“œëŠ” ë§¤ í„´ë§ˆë‹¤ ì‚¬ìš©í•œ ë§Œí¼ ë½‘ìŠµë‹ˆë‹¤. ì¦‰, ì¹´ë“œë¡œ ì¸í•œ ë“œë¡œìš°ëŠ” íŒ¨ì˜ ë§¤ìˆ˜ ìì²´ë¥¼ ëŠ˜ë¦¬ëŠ” íš¨ê³¼ê°€ ìˆìŠµë‹ˆë‹¤.

[4] ìš©ì–´
- ì†Œëª¨: ì´ë²ˆ ì „íˆ¬ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ì—†ê²Œ ë˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
- ì†Œì‹¤: ëŸ° ì „ì²´ì—ì„œ í•´ë‹¹ ì¹´ë“œê°€ ì‚¬ë¼ì§€ëŠ” ê²ƒì…ë‹ˆë‹¤.
- ì·¨ì•½: ë°›ëŠ” í”¼í•´ê°€ (ì·¨ì•½)ë§Œí¼ ì¦ê°€í•©ë‹ˆë‹¤.
- ì•½í™”: ì£¼ëŠ” í”¼í•´ê°€ (ì•½í™”)ë§Œí¼ ê°ì†Œí•©ë‹ˆë‹¤.
- ì¶œí˜ˆ: í„´ ì¢…ë£Œ ì‹œ (ì¶œí˜ˆ)ë§Œí¼ í”¼í•´ë¥¼ ì…ìŠµë‹ˆë‹¤.
- êµë€: ë‹¹ì‹ ì„ ë°©í•´í•©ë‹ˆë‹¤. ë¬´ì—‡ì¼ê¹Œìš”?

[5] ì¡°ì‘
- 4: ì„ íƒ í•´ì œ
- Tab: ì†íŒ¨ ì„ íƒ ì´ë™
- 1~3: ì „ì—´ ë°°ì¹˜ / Shift+1~3: í›„ì—´ ë°°ì¹˜
- ë“œë˜ê·¸: ì†íŒ¨â†’ìŠ¬ë¡¯ ë°°ì¹˜, ìŠ¬ë¡¯â†”ìŠ¬ë¡¯ ìŠ¤ì™‘, ìŠ¬ë¡¯â†’ì†íŒ¨ íšŒìˆ˜
`;let ve=0,Re=0,oe=null,A=null,_e=!1,T=null,M=null;function Kn(e,t){const n=e.cards[t],a=F(e.content,n.defId,n.upgrade??0),r=h("card");r.classList.add("choiceCard"),a.tags?.includes("EXHAUST")&&r.classList.add("exhaust"),a.tags?.includes("VANISH")&&r.classList.add("vanish"),r.appendChild($("cardTitle",Ee(e,t)));const s=h("cardMeta");a.tags?.includes("EXHAUST")&&s.appendChild(v("ì†Œëª¨")),a.tags?.includes("VANISH")&&s.appendChild(v("ì†Œì‹¤")),r.appendChild(s);const l=h("cardSection");l.appendChild($("cardSectionTitle","âš” ì „ì—´")),l.appendChild($("cardText",a.frontText)),r.appendChild(l);const u=h("cardSection");return u.appendChild($("cardSectionTitle","ğŸ•¯ í›„ì—´")),u.appendChild($("cardText",a.backText)),r.appendChild(u),r}function zn(e,t,n){const a=F(e.content,t,n),r=e.content.cardsById[t]?.name??t,s=h("card");s.classList.add("choiceCard"),a.tags?.includes("EXHAUST")&&s.classList.add("exhaust"),a.tags?.includes("VANISH")&&s.classList.add("vanish"),s.appendChild($("cardTitle",Ce(r,n)));const l=h("cardMeta");a.tags?.includes("EXHAUST")&&l.appendChild(v("ì†Œëª¨")),a.tags?.includes("VANISH")&&l.appendChild(v("ì†Œì‹¤")),s.appendChild(l);const u=h("cardSection");u.appendChild($("cardSectionTitle","âš” ì „ì—´")),u.appendChild($("cardText",a.frontText)),s.appendChild(u);const d=h("cardSection");return d.appendChild($("cardSectionTitle","ğŸ•¯ í›„ì—´")),d.appendChild($("cardText",a.backText)),s.appendChild(d),s}function fe(e,t){return e==="BATTLE"?t?"â˜ ï¸":"âš”ï¸":e==="REST"?"â›º":e==="EVENT"?"â”":"ğŸŒ‘"}function Oe(e,t){return t?"ë³´ìŠ¤":e.map(n=>fe(n.type,!1)).join(" / ")}function Vn(e,t,n){const a=[`[ì„ íƒ ${t.run.nodePickCount}íšŒ]`];t.run.treasureObtained&&a.push(`[ë³´ë¬¼ í›„ ${t.run.afterTreasureNodePicks}/10]`),e.appendChild(xe(a.join(" ")));const s=(t.run.nodePickCount+1)%30===0,l=(t.run.nodePickCount+2)%30===0,u=n.getNodeOffers(),d=t.run.branchOffer;if(d){const y=h("nodePreviewBox");y.style.cssText="margin-top:10px; padding:12px; border:1px solid rgba(255,255,255,.10); border-radius:16px; background:rgba(0,0,0,.18);";const m=h("nodePreviewRow");m.style.cssText="display:flex; gap:10px; align-items:center; padding:10px; border-radius:14px; cursor:pointer;",m.onmouseenter=()=>m.style.background="rgba(255,255,255,.06)",m.onmouseleave=()=>m.style.background="transparent",m.onclick=()=>n.onChooseNode("A");const i=fe(u[0]?.type??"BATTLE",s),o=document.createElement("div");o.className="nodePill primary",o.textContent=i,m.appendChild(o),m.appendChild($("","â†’"));const p=Oe(d.nextIfA,l),k=$("",p);k.style.cssText="opacity:.85;",m.appendChild(k);const f=h("nodePreviewRow");f.style.cssText="display:flex; gap:10px; align-items:center; padding:10px; border-radius:14px; cursor:pointer;",f.onmouseenter=()=>f.style.background="rgba(255,255,255,.06)",f.onmouseleave=()=>f.style.background="transparent",f.onclick=()=>n.onChooseNode("B");const C=fe(u[1]?.type??"BATTLE",s),E=document.createElement("div");E.className="nodePill primary",E.textContent=C,f.appendChild(E),f.appendChild($("","â†’"));const x=Oe(d.nextIfB,l),S=$("",x);S.style.cssText="opacity:.85;",f.appendChild(S),o.onclick=H=>{H.stopPropagation(),n.onChooseNode("A")},E.onclick=H=>{H.stopPropagation(),n.onChooseNode("B")},y.appendChild(m),y.appendChild(f),e.appendChild(y),e.appendChild(Xn())}}function Xn(){return document.createElement("hr")}function Ve(e,t){let n=null,a=!1;const r=[];function s(i){r.push({choice:i.choice,handler:n})}function l(i){const o=r.pop();if(!o){N(i),n=null;return}i.choice=o.choice,n=o.handler}const u=()=>oe||e,d={onHotkeySlot:(i,o)=>{const p=u();if(p.run.finished||B(p)||p.phase!=="PLACE"||i==="back"&&p.backSlotDisabled?.[o])return;const k=i==="front"?p.frontSlots:p.backSlots,f=k[o];if(!p.selectedHandCardUid){if(!f)return;d.onReturnSlotToHand(i,o);return}const C=p.selectedHandCardUid;if(!f){d.onPlaceHandUidToSlot(C,i,o);return}k[o]=null,p.usedThisTurn=Math.max(0,p.usedThisTurn-1),i==="front"&&(p.frontPlacedThisTurn=Math.max(0,p.frontPlacedThisTurn-1)),p.hand.push(f),p.cards[f].zone="hand",Ie(p,C,i,o),p.selectedHandCardUid=null,c(p,`[${D(p,C)}] â†” [${D(p,f)}] ìŠ¤ì™‘: ì†íŒ¨ â†” ${i}${o+1}`),b(p,d)},rerender:()=>{const i=u();b(i,d)},onCloseOverlay:()=>{const i=u();A=null,b(i,d)},onNewRun:()=>{const i=u();M=null,A=null,T=null,n=null,N(i),t(Fe(i.content))},onViewRulebook:()=>{const i=u();A={kind:"RULEBOOK"},b(i,d)},onViewPile:i=>{const o=u();A={kind:"PILE",pile:i},b(o,d)},onReturnSlotToHand:(i,o)=>{const p=u();if(p.run.finished||B(p)||p.phase!=="PLACE")return;const k=i==="front"?p.frontSlots:p.backSlots,f=k[o];f&&(k[o]=null,p.usedThisTurn=Math.max(0,p.usedThisTurn-1),i==="front"&&(p.frontPlacedThisTurn=Math.max(0,p.frontPlacedThisTurn-1)),p.hand.push(f),p.cards[f].zone="hand",c(p,`[${D(p,f)}] íšŒìˆ˜: ${i}${o+1} â†’ ì†íŒ¨`),b(p,d))},onClearSelected:()=>{const i=u();i.selectedHandCardUid=null,b(i,d)},onSelectHandCard:i=>{const o=u();B(o)||(o.selectedHandCardUid=o.selectedHandCardUid===i?null:i,b(o,d))},getNodeOffers:()=>{const i=u();return i.run.branchOffer||(i.run.branchOffer=J(i)),(i.run.nodePickCount+1)%30===0?[{id:"A",type:"BATTLE"},{id:"B",type:"BATTLE"}]:i.run.branchOffer.root},onChooseNode:i=>{const o=u();if(a||(a=!0,queueMicrotask(()=>a=!1),o.run.finished)||o.phase!=="NODE")return;o.run.branchOffer||(o.run.branchOffer=J(o));const p=o.run.nodePickCount+1,k=p%30===0,C=k?"BATTLE":i==="A"?o.run.branchOffer.root[0].type:o.run.branchOffer.root[1].type;if(o.run.nodePickCount=p,o.run.nodePickByType[C]=(o.run.nodePickByType[C]??0)+1,en(o,i),o.run.treasureObtained&&C!=="TREASURE"&&(o.run.afterTreasureNodePicks+=1,o.run.afterTreasureNodePicks>=10)){o.run.finished=!0,c(o,"ìŠ¹ë¦¬! ì €ì£¼ë°›ì€ ë³´ë¬¼ì„ ì–»ì€ í›„ 10ë²ˆì˜ íƒí—˜ì„ ë²„í…¼ìŠµë‹ˆë‹¤."),b(o,d);return}if(C==="BATTLE"){k&&c(o,`=== ${p}ë²ˆì§¸ ë…¸ë“œ: ë³´ìŠ¤ ì „íˆ¬ ===`),ne(o,{forceBoss:k}),te(o),b(o,d);return}if(C==="REST"){const E=()=>{o.choice={kind:"EVENT",title:"íœ´ì‹",prompt:"ë¬´ì—‡ì„ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",options:[{key:"rest:heal",label:"HP +15"},{key:"rest:clear_f",label:"F -3"},{key:"rest:upgrade",label:"ê°•í™”"},{key:"rest:skip",label:"ìƒëµ"}]},n=x=>{if(x==="rest:heal"){o.player.hp=Math.min(o.player.maxHp,o.player.hp+15),c(o,"íœ´ì‹: HP +15"),N(o),n=null,o.phase="NODE",b(o,d);return}if(x==="rest:clear_f"){o.player.fatigue=Math.max(0,o.player.fatigue-3),c(o,"íœ´ì‹: í”¼ë¡œ F-=3"),N(o),n=null,o.phase="NODE",b(o,d);return}if(x==="rest:upgrade"){m(o,d,"ê°•í™”","ê°•í™”í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",{onDone:()=>{o.phase="NODE",b(o,d)},onSkip:()=>{E(),b(o,d)}});return}c(o,"íœ´ì‹: ìƒëµ"),N(o),n=null,o.phase="NODE",b(o,d)}};E(),b(o,d);return}if(C==="TREASURE"){o.run.treasureObtained=!0,o.run.afterTreasureNodePicks=0,c(o,"ì €ì£¼ë°›ì€ ë³´ë¬¼ì„ ì–»ì—ˆìŠµë‹ˆë‹¤! ì´ì œë¶€í„° 10ë²ˆì˜ íƒí—˜ì„ ë²„í‹°ë©´ ìŠ¹ë¦¬í•©ë‹ˆë‹¤."),b(o,d);return}if(C==="EVENT"){const E=hn(),x=E.options(o);o.choice={kind:"EVENT",title:E.name,prompt:E.prompt,options:x.map(S=>({key:S.key,label:S.label,detail:S.detail}))},n=S=>{const H=x.find(_=>_.key===S);if(!H)return;const P=H.apply(o);if(typeof P=="object"&&P.kind==="UPGRADE_PICK"){m(o,d,P.title??"ê°•í™”",P.prompt??"ê°•í™”í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.");return}if(typeof P=="object"&&P.kind==="REMOVE_PICK"){s(o);const _=Object.values(o.cards).filter(w=>w.zone==="deck"||w.zone==="hand"||w.zone==="discard").map(w=>w.uid);o.choice={kind:"PICK_CARD",title:P.title,prompt:P.prompt??"ì œê±°í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",options:[..._.map(w=>{const I=be(o,w);return{key:`remove:${w}`,label:D(o,w),detail:`ì „ì—´: ${I.frontText} / í›„ì—´: ${I.backText}`,cardUid:w}}),{key:"cancel",label:"ì·¨ì†Œ"}]},n=w=>{if(w==="cancel"){c(o,"ì œê±° ì·¨ì†Œ"),l(o),b(o,d);return}if(!w.startsWith("remove:")){b(o,d);return}const I=w.slice(7);yn(o,I);const g=P.then,O=g==="REWARD"||g==="REWARD_PICK"?"REWARD_PICK":g==="BATTLE"?"BATTLE":g==="NONE"?"NONE":void 0;if(O==="BATTLE"){N(o),n=null,ne(o),te(o),b(o,d);return}if(O==="REWARD_PICK"){N(o),n=null,y(o,d,"ì¹´ë“œ ë³´ìƒ","ë‘ ì¥ ì¤‘ í•œ ì¥ì„ ì„ íƒí•˜ê±°ë‚˜ ìƒëµí•©ë‹ˆë‹¤.");return}N(o),n=null,o.phase="NODE",b(o,d)},b(o,d);return}if(typeof P=="object"&&P.kind==="BATTLE_SPECIAL"){o.choice=null,n=null,c(o,P.title?`ì´ë²¤íŠ¸ ì „íˆ¬: ${P.title}`:"ì´ë²¤íŠ¸ ì „íˆ¬ ë°œìƒ!"),ne(o,{forcePatternIds:P.enemyIds}),te(o),b(o,d);return}if(P==="BATTLE"){o.choice=null,n=null,ne(o),te(o),b(o,d);return}if(P==="REWARD"){y(o,d,"ì¹´ë“œ ë³´ìƒ","ë‘ ì¥ ì¤‘ í•œ ì¥ì„ ì„ íƒí•˜ê±°ë‚˜ ìƒëµí•©ë‹ˆë‹¤.");return}o.choice=null,N(o),n=null,b(o,d)},b(o,d);return}},onChooseChoice:i=>{const o=u();if(!o.choice)return;if(n){n(i);return}const p=o.choice.kind;if(p==="REWARD"||p==="REWARD_PICK"){if(i==="skip"){c(o,"ì¹´ë“œ ë³´ìƒ ìƒëµ"),N(o),b(o,d);return}if(i.startsWith("pick:")){const k=i.slice(5),[f,C]=k.split(":"),E=Number(C??"0")||0;Ae(o,f,{upgrade:E}),c(o,`ì¹´ë“œ íšë“: ${je(o,f,E)}`),N(o),b(o,d);return}}c(o,`ì„ íƒ ì²˜ë¦¬ ë¶ˆê°€: handler ì—†ìŒ (kind=${p}, key=${i})`)},onRevealIntents:()=>{const i=u();i.run.finished||i.enemies.length!==0&&(ke(i),b(i,d))},onSelectEnemy:i=>{const o=u();Dn(o,i),b(o,d)},onPlaceHandUidToSlot:(i,o,p)=>{const k=u();k.run.finished||B(k)||k.phase==="PLACE"&&(o==="back"&&k.backSlotDisabled?.[p]||(Ie(k,i,o,p),k.selectedHandCardUid=null,b(k,d)))},onPlaceSelected:(i,o)=>{const p=u();p.selectedHandCardUid&&d.onPlaceHandUidToSlot(p.selectedHandCardUid,i,o)},onMoveSlotCard:(i,o,p,k)=>{const f=u();if(f.run.finished||B(f)||f.phase!=="PLACE"||p==="back"&&f.backSlotDisabled?.[k])return;const C=i==="front"?f.frontSlots:f.backSlots,E=p==="front"?f.frontSlots:f.backSlots,x=C[o];if(!x)return;const S=E[k];C[o]=S??null,E[k]=x,f.cards[x].zone=p,S&&(f.cards[S].zone=i),i!==p&&(i==="front"&&(f.frontPlacedThisTurn=Math.max(0,f.frontPlacedThisTurn-1)),p==="front"&&(f.frontPlacedThisTurn+=1),S&&(p==="front"&&(f.frontPlacedThisTurn=Math.max(0,f.frontPlacedThisTurn-1)),i==="front"&&(f.frontPlacedThisTurn+=1))),c(f,S?`[${D(f,x)}] â†” [${D(f,S)}] ìŠ¤ì™‘: ${i}${o+1} â†” ${p}${k+1}`:`[${D(f,x)}] ì´ë™: ${i}${o+1} â†’ ${p}${k+1}`),he(f),b(f,d)},onResolveBack:()=>{const i=u();i.phase==="PLACE"&&he(i),In(i),b(i,d)},onResolveFront:()=>{const i=u();Bn(i),b(i,d)},onResolveEnemy:()=>{const i=u();Nn(i),b(i,d)},onUpkeep:()=>{const i=u();vn(i),b(i,d)},onDrawNextTurn:()=>{const i=u();_n(i),b(i,d)}};function y(i,o,p,k){const[f,C]=Ke(),E=F(i.content,f.defId,f.upgrade),x=F(i.content,C.defId,C.upgrade),S=Me(i,f),H=Me(i,C);i.choice={kind:"REWARD",title:p,prompt:k,options:[{key:`pick:${f.defId}:${f.upgrade}`,label:S,detail:`ì „ì—´: ${E.frontText} / í›„ì—´: ${E.backText}`},{key:`pick:${C.defId}:${C.upgrade}`,label:H,detail:`ì „ì—´: ${x.frontText} / í›„ì—´: ${x.backText}`},{key:"skip",label:"ìƒëµ"}]},n=P=>{if(P.startsWith("pick:")){const _=P.slice(5),[w,I]=_.split(":"),g=Number(I??"0")||0;Ae(i,w,{upgrade:g})}else c(i,"ì¹´ë“œ ë³´ìƒ ìƒëµ");N(i),n=null,b(i,o)},b(i,o)}function m(i,o,p,k,f){const C=Object.values(i.cards).filter(x=>(x.zone==="deck"||x.zone==="hand"||x.zone==="discard")&&ze(i,x.uid)).map(x=>x.uid);if(C.length===0){c(i,"ê°•í™”í•  ìˆ˜ ìˆëŠ” ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤."),i.choice=null,n=null,f?.onSkip?f.onSkip():b(i,o);return}const E=[...C].sort((x,S)=>{const H=i.cards[x],P=i.cards[S],_=se(i,H.defId),w=se(i,P.defId),I=_.localeCompare(w,"ko");return I!==0?I:(H.upgrade??0)-(P.upgrade??0)});i.choice={kind:"UPGRADE_PICK",title:p,prompt:k,options:[...E.map(x=>{const S=i.cards[x],H=be(i,x),P=F(i.content,S.defId,(S.upgrade??0)+1),_=D(i,x),w=`í˜„ì¬: ì „ì—´ ${H.frontText} / í›„ì—´ ${H.backText}
ê°•í™”: ì „ì—´ ${P.frontText} / í›„ì—´ ${P.backText}`;return{key:`up:${x}`,label:_,detail:w,cardUid:x}}),{key:"skip",label:"ì·¨ì†Œ"}]},n=x=>{if(x==="skip"){c(i,"ê°•í™” ì·¨ì†Œ"),N(i),n=null,f?.onSkip?f.onSkip():b(i,o);return}if(x.startsWith("up:")){const S=x.slice(3),H=xn(i,S);c(i,H?`ê°•í™”: [${D(i,S)}]`:"ê°•í™” ì‹¤íŒ¨"),N(i),n=null,f?.onDone?f.onDone():b(i,o);return}N(i),n=null,b(i,o)},b(i,o)}return d}function he(e){const t=e.frontSlots.filter(a=>a!=null).length,n=e.backSlots.filter(a=>a!=null).length;e.frontPlacedThisTurn=t,e.usedThisTurn=t+n}function Yn(){const e=document.querySelector("#app");return e.innerHTML="",e}function X(e,t,n=""){const a=document.createElement("button");return n&&(a.className=n),a.type="button",a.textContent=e,a.onclick=t,a}function b(e,t){oe=e;const n=document.querySelector(".mainPanel");n&&(ve=n.scrollTop,Re=n.scrollLeft);const a=Yn();_e||(tt(()=>oe??e,t),_e=!0),a.appendChild(Qn(e,t));const r=h("mainRow"),s=h("stage"),l=h("stageInner"),u=h("panel mainPanel");u.scrollTop=ve,u.scrollLeft=Re,u.appendChild(Gn()),e.run.finished?u.appendChild(xe("ëŸ° ì¢…ë£Œ")):e.phase==="NODE"?Vn(u,e,t):Jn(u,e,t),l.appendChild(u),s.appendChild(l);const d=h("panel logPanel");d.appendChild(Zn());const y=lt(e.log.join(`
`));y.classList.add("log"),d.appendChild(y),r.appendChild(s),r.appendChild(d),a.appendChild(r),et(e,t,B(e)),qe(),qn(e,t),jn(e,t),e.fx&&(e.fx.enemyShake=[],e.fx.playerShake=!1)}function qn(e,t){if(document.querySelector(".overlay-layer")?.remove(),!A)return;const n=h("overlay-layer");n.style.cssText="position:fixed; inset:0; z-index:2500; background:rgba(0,0,0,.55); display:flex; justify-content:center; align-items:center;",n.onclick=d=>{d.target===n&&t.onCloseOverlay()};const a=h("overlay-panel");a.style.cssText="width:min(980px, 92vw); max-height:80vh; overflow:auto; padding:16px; border:1px solid rgba(255,255,255,.12); border-radius:16px; background:rgba(15,18,22,.92); box-shadow:0 18px 60px rgba(0,0,0,.45);",a.onclick=d=>d.stopPropagation();const r=A.kind==="RULEBOOK"?"ë£°ë¶":A.pile==="deck"?"ë±":A.pile==="discard"?"ë²„ë¦¼ ë”ë¯¸":A.pile==="exhausted"?"ì†Œëª¨(ì´ë²ˆ ì „íˆ¬)":A.pile==="vanished"?"ì†Œì‹¤(ì˜êµ¬)":"ì†íŒ¨",s=h("overlayHeader");s.style.cssText="display:flex; align-items:center; justify-content:space-between; gap:12px; position:sticky; top:0; padding-bottom:12px; margin-bottom:12px; background:rgba(15,18,22,.92);";const l=st(r);l.classList.add("overlayTitle");const u=Ge("ë‹«ê¸°",t.onCloseOverlay,!1);if(u.classList.add("overlayClose"),u.style.cssText="padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.16); background:rgba(255,255,255,.06); color:#fff; cursor:pointer;",s.appendChild(l),s.appendChild(u),a.appendChild(s),A.kind==="RULEBOOK"){const d=document.createElement("pre");d.className="rulebook",d.textContent=Un,d.style.cssText="white-space:pre-wrap; line-height:1.45; font-size:13px; margin:0; padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.10); background:rgba(0,0,0,.18);",a.appendChild(d)}else{const y=[...A.pile==="deck"?e.deck:A.pile==="discard"?e.discard:A.pile==="exhausted"?e.exhausted:A.pile==="vanished"?e.vanished:e.hand].sort((i,o)=>{const p=e.cards[i],k=e.cards[o],f=se(e,p.defId),C=se(e,k.defId),E=f.localeCompare(C,"ko");return E!==0?E:(p.upgrade??0)-(k.upgrade??0)}),m=h("overlayList");if(m.style.cssText="display:flex; flex-direction:column; gap:10px;",y.length===0){const i=h("overlayEmpty");i.textContent="ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.",i.style.cssText="padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.10); background:rgba(255,255,255,.03);",m.appendChild(i)}else for(const i of y){const o=be(e,i),p=Ee(e,i),k=h("overlayItem");k.style.cssText="border:1px solid rgba(255,255,255,.10); border-radius:14px; padding:10px; background:rgba(255,255,255,.03);";const f=h("overlayItemTop");f.style.cssText="display:flex; align-items:center; justify-content:space-between; gap:10px;";const C=h("overlayItemTitle");C.textContent=p,C.style.cssText="font-weight:700;";const E=h("overlayItemMeta");E.textContent=`(${e.cards[i].zone})`,E.style.cssText="opacity:.7; font-size:12px; white-space:nowrap;",f.appendChild(C),f.appendChild(E),k.appendChild(f);const x=document.createElement("pre");x.className="overlayItemDetail",x.textContent=`ì „ì—´: ${o.frontText}
í›„ì—´: ${o.backText}`,x.style.cssText="margin:10px 0 0 0; padding:10px; white-space:pre-wrap; border-radius:12px; border:1px solid rgba(255,255,255,.10); background:rgba(0,0,0,.20); font-size:12px; line-height:1.45;",k.appendChild(x),m.appendChild(k)}a.appendChild(m)}n.appendChild(a),document.body.appendChild(n)}function jn(e,t){document.querySelector(".choice-overlay")?.remove();const n=e.choice;if(!n)return;const a=h("choice-overlay");a.style.cssText="position:fixed; inset:0; z-index:3000; background:rgba(0,0,0,0.82); display:flex; justify-content:center; align-items:center;";const r=h("choice-panel");r.style.cssText="width:min(980px, 92vw); max-height:80vh; overflow:auto; padding:16px; border:1px solid rgba(255,255,255,.12); border-radius:16px; background:rgba(15,18,22,.92);",r.appendChild(ot(n.title)),n.prompt&&r.appendChild(xe(n.prompt));const s=h("choice-list");s.style.cssText="display:flex; flex-direction:column; gap:10px; margin-top:12px;",n.options.forEach(l=>{const u=h("choice-item");u.style.cssText="display:flex; gap:12px; align-items:flex-start;border:1px solid rgba(255,255,255,.10); border-radius:14px; padding:12px;background:rgba(255,255,255,.03);";const d=h("choice-left");d.style.cssText="flex:0 0 auto;";const y=l.cardUid;if(y)d.appendChild(Kn(e,y));else if(typeof l.key=="string"&&l.key.startsWith("pick:")){const o=l.key.slice(5),[p,k]=o.split(":"),f=Number(k??"0")||0;d.appendChild(zn(e,p,f))}const m=h("choice-right");m.style.cssText="flex:1 1 auto; min-width:260px;";const i=Ge(l.label,()=>t.onChooseChoice(l.key),!1);if(i.classList.add("primary"),m.appendChild(i),l.detail){const o=document.createElement("pre");o.className="choice-detail",o.textContent=String(l.detail),o.style.cssText="margin:10px 0 0 0; padding:10px; white-space:pre-wrap;border-radius:12px; border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.22); font-size:12px; line-height:1.45;max-height:220px; overflow:auto;",m.appendChild(o)}u.appendChild(d),u.appendChild(m),s.appendChild(u)}),r.appendChild(s),a.appendChild(r),document.body.appendChild(a)}function Qn(e,t){const n=h("topHud");n.appendChild(h("topHudLeftSpacer"));const a=h("playerHudLeft"),r=h("playerTitleRow");r.appendChild($("playerHudTitle","í”Œë ˆì´ì–´"));const s=h("pileButtons");s.appendChild(X("ë±",()=>t.onViewPile("deck"))),s.appendChild(X("ë²„ë¦¼",()=>t.onViewPile("discard"))),s.appendChild(X("ì†íŒ¨",()=>t.onViewPile("hand"))),s.appendChild(X("ì†Œëª¨",()=>t.onViewPile("exhausted"))),s.appendChild(X("ì†Œì‹¤",()=>t.onViewPile("vanished"))),r.appendChild(s),a.appendChild(r);const l=h("enemyChip");l.classList.add("playerHudBox"),e.fx?.playerShake&&l.classList.add("shake");const u=h("enemyChipTop");u.appendChild($("","HP")),u.appendChild($("",`${e.player.hp}/${e.player.maxHp}`)),l.appendChild(u);const d=h("enemyHPOuter"),y=h("enemyHPFill");y.style.width=`${Math.max(0,Math.min(100,e.player.hp/Math.max(1,e.player.maxHp)*100))}%`,d.appendChild(y),l.appendChild(d);const m=h("enemyChipTop");m.appendChild($("","ë¸”ë¡")),m.appendChild($("",`${e.player.block}`)),l.appendChild(m);const i=h("enemyHPOuter"),o=h("enemyHPFill");o.style.background="linear-gradient(90deg, #64b5ff, #2a7cff)",o.style.width=`${Math.max(0,Math.min(100,e.player.block/Math.max(1,e.player.maxHp)*100))}%`,i.appendChild(o),l.appendChild(i);const p=e.player.status,k=h("enemyBadges");(p.vuln??0)>0&&k.appendChild(v(`ì·¨ì•½ ${p.vuln}`)),(p.weak??0)>0&&k.appendChild(v(`ì•½í™” ${p.weak}`)),(p.bleed??0)>0&&k.appendChild(v(`ì¶œí˜ˆ ${p.bleed}`)),(p.disrupt??0)>0&&k.appendChild(v(`êµë€ ${p.disrupt}`)),k.childNodes.length&&l.appendChild(k),a.appendChild(l);const f=h("resourceRow inline"),C=e.enemies.length>0&&e.phase!=="NODE",E=e.run.nextBattleSuppliesBonus??0;C?f.appendChild(Q(`S ${e.player.supplies}`,e.player.supplies===0?"warn":"")):E>0&&f.appendChild(Q(`ë³´ë„ˆìŠ¤ S +${E}`,"bonus")),f.appendChild(Q(`F ${e.player.fatigue}`)),f.appendChild(Q(`íƒí—˜ ${Math.max(1,e.run.nodePickCount)}`)),f.appendChild(Q(`ë± ${e.deck.length}`)),a.appendChild(f);const x=h("enemyHudCenter"),S=h("enemyHud"),H=e.fx?.enemyShake??[];if(e.enemies.length===0)S.appendChild($("enemyNone",""));else{const w=B(e);for(let I=0;I<e.enemies.length;I++){const g=e.enemies[I],O=h("enemyChip");H.includes(I)&&O.classList.add("shake"),w&&g.hp>0&&O.classList.add("targetable");const le=h("enemyChipTop");le.appendChild($("",`${I+1}. ${g.name}`)),le.appendChild($("",`${g.hp}/${g.maxHp}`)),O.appendChild(le);const Se=h("enemyHPOuter"),Pe=h("enemyHPFill");Pe.style.width=`${Math.max(0,Math.min(100,g.hp/Math.max(1,g.maxHp)*100))}%`,Se.appendChild(Pe),O.appendChild(Se);const $e=e.content.enemiesById[g.id],Je=$e.intents[g.intentIndex%$e.intents.length];O.appendChild($("enemyIntent",e.intentsRevealedThisTurn?`ì˜ë„: ${Je.label}`:"ì˜ë„: (ë¯¸ê³µê°œ)")),O.onclick=()=>t.onSelectEnemy(I),S.appendChild(O);const U=g.status,V=h("enemyBadges");(U.vuln??0)>0&&V.appendChild(v(`ì·¨ì•½ ${U.vuln}`)),(U.weak??0)>0&&V.appendChild(v(`ì•½í™” ${U.weak}`)),(U.bleed??0)>0&&V.appendChild(v(`ì¶œí˜ˆ ${U.bleed}`)),(U.disrupt??0)>0&&V.appendChild(v(`êµë€ ${U.disrupt}`)),g.immuneThisTurn&&V.appendChild(v("ë©´ì—­")),V.childNodes.length&&O.appendChild(V)}}x.appendChild(S);const P=h("topHudRight"),_=h("topRightControls");return _.appendChild(X("ìƒˆë¡œìš´ ëŸ°",t.onNewRun)),_.appendChild(X("ë£°ë¶",t.onViewRulebook)),P.appendChild(_),n.appendChild(a),n.appendChild(x),n.appendChild(P),e.fx?.enemyShake?.length&&(e.fx.enemyShake=[]),n}function Q(e,t=""){const n=document.createElement("span");return n.className="chip"+(t?` ${t}`:""),n.textContent=e,n}function Gn(e){const t=h("battleTitleRow"),n=document.createElement("h2");return n.textContent="ì „ì¥",t.appendChild(n),t}function Zn(){const e=h("logHeaderRow"),t=document.createElement("h2");return t.textContent="ë¡œê·¸",e.appendChild(t),e}function Jn(e,t,n){const a=h("combatRoot"),r=h("boardArea");if(B(t)&&t.selectedEnemyIndex==null){const s=h("targetHint");s.textContent="ëŒ€ìƒ ì„ íƒ í•„ìš”: ìœ„ì˜ ì  ë°•ìŠ¤ë¥¼ í´ë¦­í•˜ì„¸ìš”.",a.appendChild(s)}r.appendChild(De(t,n,"front")),r.appendChild(De(t,n,"back")),a.appendChild(r),e.appendChild(a)}let me=null,Xe=!0;function L(e,t){me=e,Xe=t}function et(e,t,n){const a=document.querySelector(".handDock");a&&a.remove();const r=h("handDock"),s=h("controlsDock");s.appendChild(q("ì •ì°°",t.onRevealIntents,e.enemies.length===0||e.intentsRevealedThisTurn||e.phase!=="PLACE"||n,e.phase==="PLACE")),s.appendChild(q("í›„ì—´",t.onResolveBack,!(e.phase==="PLACE"||e.phase==="BACK")||n,e.phase==="BACK")),s.appendChild(q("ì „ì—´",t.onResolveFront,e.phase!=="FRONT"||n,e.phase==="FRONT")),s.appendChild(q("ì ",t.onResolveEnemy,e.phase!=="ENEMY"||n,e.phase==="ENEMY")),s.appendChild(q("ì •ë¦¬",t.onUpkeep,e.phase!=="UPKEEP"||n,e.phase==="UPKEEP")),s.appendChild(q("ë“œë¡œìš°",t.onDrawNextTurn,e.phase!=="DRAW"||n,e.phase==="DRAW"));const l=document.createElement("button");l.textContent="ì„ íƒ í•´ì œ",l.disabled=!e.selectedHandCardUid,l.onclick=t.onClearSelected,s.appendChild(l),r.appendChild(s);const u=h("hand");u.dataset.dropHand="1";const d=h("handCardsRow");if(u.appendChild(d),e.hand.length===0){const y=h("handEmptyHint");y.textContent="ì†íŒ¨ê°€ ë¹„ì—ˆìŠµë‹ˆë‹¤.",d.appendChild(y)}else for(const y of e.hand)d.appendChild(Qe(e,y,!0,t.onSelectHandCard));e.run.finished||n?L(null,!0):e.phase==="PLACE"?e.enemies.length===0||e.intentsRevealedThisTurn?L(t.onResolveBack,!1):L(t.onRevealIntents,!1):e.phase==="BACK"?L(t.onResolveBack,!1):e.phase==="FRONT"?L(t.onResolveFront,!1):e.phase==="ENEMY"?L(t.onResolveEnemy,!1):e.phase==="UPKEEP"?L(t.onUpkeep,!1):e.phase==="DRAW"?L(t.onDrawNextTurn,!1):L(null,!0),r.appendChild(u),document.body.appendChild(r)}function q(e,t,n,a){const r=document.createElement("button");return r.textContent=e,r.disabled=n,r.onclick=t,r.className="stepBtn",a&&r.classList.add("stepOn"),r}function De(e,t,n){const a=h("grid6"),r=!!e.selectedHandCardUid,s=n==="front"?e.frontSlots:e.backSlots;for(let l=0;l<3;l++){const u=n==="back"?!!e.backSlotDisabled?.[l]:!1,d=h("slot"+(u?" disabled":""));d.dataset.slotSide=n,d.dataset.slotIndex=String(l),M&&M.side===n&&M.idx===l&&d.classList.add("dropHover"),r&&!u&&d.classList.add("placeable"),d.appendChild(it(`${n==="front"?"ì „ì—´":"í›„ì—´"} ${l+1}`));const y=s[l];if(y){const m=Qe(e,y,!1);m.classList.add("inSlot"),d.appendChild(m),m.onpointerdown=i=>{i.button!==0&&i.pointerType==="mouse"||B(e)||e.phase==="PLACE"&&Ye(i,{kind:"slot",cardUid:y,fromSide:n,fromIdx:l})},m.ondblclick=()=>t.onReturnSlotToHand(n,l)}d.onclick=()=>{if(u||B(e)||e.phase!=="PLACE")return;const m=s[l];if(!e.selectedHandCardUid&&m){t.onReturnSlotToHand(n,l);return}t.onPlaceSelected(n,l)},a.appendChild(d)}return a}function nt(){if(document.querySelectorAll(".slot.dropHover").forEach(n=>n.classList.remove("dropHover")),!M)return;const e=`.slot[data-slot-side="${M.side}"][data-slot-index="${M.idx}"]`,t=document.querySelector(e);t&&t.classList.add("dropHover")}function tt(e,t){window.onpointermove=n=>{const a=e();if(a.choice||A||!T||n.pointerId!==T.pointerId)return;T.x=n.clientX,T.y=n.clientY;const r=T.x-T.startX,s=T.y-T.startY;!T.dragging&&r*r+s*s>36&&(T.dragging=!0),M=T.dragging?Le(n.clientX,n.clientY,a):null,qe(document.querySelector("#app")),nt()},window.onpointerup=n=>{const a=e();if(!(a.choice||A)&&!(!T||n.pointerId!==T.pointerId)){if(T.dragging){const r=at(n.clientX,n.clientY),s=Le(n.clientX,n.clientY,a);if(r&&T.kind==="slot"&&T.fromSide!=null&&T.fromIdx!=null){!a.run.finished&&!B(a)&&a.phase==="PLACE"&&t.onReturnSlotToHand(T.fromSide,T.fromIdx),T=null,M=null,b(a,t);return}if(s)if(T.kind==="hand"){const l=e();if(!(l.run.finished||B(l)||l.phase!=="PLACE")){const u=s.side,d=s.idx;if(!(u==="back"&&l.backSlotDisabled?.[d])){const y=u==="front"?l.frontSlots:l.backSlots,m=y[d];if(!m)t.onPlaceHandUidToSlot(T.cardUid,u,d);else{const i=T.fromHandIndex!=null&&T.fromHandIndex>=0?T.fromHandIndex:l.hand.indexOf(T.cardUid),o=l.hand.indexOf(T.cardUid);o>=0&&l.hand.splice(o,1),y[d]=T.cardUid,l.cards[T.cardUid].zone=u;const p=i!=null&&i>=0&&i<=l.hand.length?i:l.hand.length;l.hand.splice(p,0,m),l.cards[m].zone="hand",l.selectedHandCardUid=null,he(l),c(l,`[${D(l,T.cardUid)}] â†” [${D(l,m)}] ìŠ¤ì™‘: ì†íŒ¨ â†” ${u}${d+1}`),b(l,t)}}}}else T.kind==="slot"&&T.fromSide!=null&&T.fromIdx!=null&&(T.fromSide===s.side&&T.fromIdx===s.idx||t.onMoveSlotCard(T.fromSide,T.fromIdx,s.side,s.idx))}T?.sourceEl&&T.sourceEl.classList.remove("isDraggingSource"),T=null,M=null,b(a,t)}},window.addEventListener("keydown",n=>{const a=n.target;if(a&&(a.tagName==="INPUT"||a.tagName==="TEXTAREA"))return;const r=e();if(n.code==="Digit4"){if(n.preventDefault(),B(r)){r.pendingTarget=null,r.pendingTargetQueue=[],c(r,"ëŒ€ìƒ ì„ íƒ ì·¨ì†Œ"),b(r,t);return}t.onClearSelected();return}if(n.key==="Tab"){if(n.preventDefault(),r.hand.length===0)return;const s=r.selectedHandCardUid,l=s?r.hand.indexOf(s):-1,u=n.shiftKey?-1:1,d=((l+u)%r.hand.length+r.hand.length)%r.hand.length;r.selectedHandCardUid=r.hand[d],b(r,t);return}if(n.code==="Space"){if(n.preventDefault(),r.run.finished||r.choice||B(r))return;if(r.phase==="PLACE"){t.onResolveBack();return}return r.phase==="BACK"?t.onResolveBack():r.phase==="FRONT"?t.onResolveFront():r.phase==="ENEMY"?t.onResolveEnemy():r.phase==="UPKEEP"?t.onUpkeep():r.phase==="DRAW"?t.onDrawNextTurn():void 0}if(n.code==="Digit1"||n.code==="Digit2"||n.code==="Digit3"){n.preventDefault();const s=n.code==="Digit1"?0:n.code==="Digit2"?1:2;if(B(r)){const l=r.enemies[s];if(!l||l.hp<=0){c(r,`ëŒ€ìƒ ì„ íƒ ì‹¤íŒ¨: ${s+1}ë²ˆ ì ì´ ì—†ìŠµë‹ˆë‹¤.`),b(r,t);return}t.onSelectEnemy(s);return}t.onHotkeySlot("front",s);return}if(n.code==="KeyQ"||n.code==="KeyW"||n.code==="KeyE"){n.preventDefault();const s=n.code==="KeyQ"?0:n.code==="KeyW"?1:2;t.onHotkeySlot("back",s);return}if(n.code==="Enter"){n.preventDefault(),!Xe&&me&&me();return}})}function Ye(e,t){const n=e.currentTarget;try{n.setPointerCapture(e.pointerId)}catch{}const a=n.closest(".card");a&&a.classList.add("isDraggingSource");const r=a?.getBoundingClientRect(),s=r?e.clientX-r.left:20,l=r?e.clientY-r.top:20;if(T={kind:t.kind,cardUid:t.cardUid,fromHandIndex:t.fromHandIndex,fromSide:t.fromSide,fromIdx:t.fromIdx,pointerId:e.pointerId,startX:e.clientX,startY:e.clientY,x:e.clientX,y:e.clientY,dragging:!1,previewEl:void 0,previewW:r?.width,previewH:r?.height,grabDX:s,grabDY:l},a){const u=a.cloneNode(!0);u.classList.remove("inSlot"),u.classList.remove("selected"),u.classList.remove("isDraggingSource"),u.style.position="static",u.style.inset="",u.style.width="100%",u.style.height="100%",u.style.margin="0",T.previewEl=u}}function at(e,t){const n=document.elementFromPoint(e,t);if(!n)return!1;let a=n;for(;a;){if(a.dataset?.dropHand==="1")return!0;a=a.parentElement}return!1}function Le(e,t,n){const a=document.elementFromPoint(e,t);if(!a)return null;const r=rt(a,["slotSide","slotIndex"]);if(!r)return null;const s=r.dataset.slotSide,l=Number(r.dataset.slotIndex);return s==="back"&&n.backSlotDisabled?.[l]?null:{side:s,idx:l}}function rt(e,t){let n=e;for(;n;){const a=n.dataset;let r=!0;for(const s of t)if(a[s]==null){r=!1;break}if(r)return n;n=n.parentElement}return null}function qe(e,t){if(!T||!T.dragging){document.querySelector(".dragLayer")?.remove();return}let n=document.querySelector(".dragLayer");if(n||(n=document.createElement("div"),n.className="dragLayer",n.style.position="fixed",n.style.inset="0",n.style.zIndex="5000",n.style.pointerEvents="none",document.body.appendChild(n)),n.innerHTML="",!T.previewEl)return;const a=document.createElement("div");a.className="dragCardPreview",a.style.position="fixed",a.style.left=`${T.x-(T.grabDX??20)}px`,a.style.top=`${T.y-(T.grabDY??20)}px`,a.appendChild(T.previewEl),n.appendChild(a)}function N(e){e.choice=null,document.querySelector(".choice-overlay")?.remove()}function B(e){return e.pendingTarget!=null||(e.pendingTargetQueue?.length??0)>0}function be(e,t){const n=e.cards[t];return F(e.content,n.defId,n.upgrade??0)}function se(e,t){return e.content.cardsById[t]?.name??t}function je(e,t,n){const a=n??0,r=e.content.cardsById[t]?.name??t;return a>0?`${r} +${a}`:r}function D(e,t){const n=e.cards[t];return je(e,n.defId,n.upgrade??0)}function Qe(e,t,n,a){const r=e.cards[t],s=F(e.content,r.defId,r.upgrade??0),l=h("card");e.selectedHandCardUid===t&&l.classList.add("selected"),s.tags?.includes("EXHAUST")&&l.classList.add("exhaust"),s.tags?.includes("VANISH")&&l.classList.add("vanish");const u=Ee(e,t);l.appendChild($("cardTitle",u));const d=h("cardMeta");s.tags?.includes("EXHAUST")&&d.appendChild(v("ì†Œëª¨")),s.tags?.includes("VANISH")&&d.appendChild(v("ì†Œì‹¤")),l.appendChild(d);const y=h("cardSection");y.appendChild($("cardSectionTitle","âš” ì „ì—´")),y.appendChild($("cardText",s.frontText)),l.appendChild(y);const m=h("cardSection");return m.appendChild($("cardSectionTitle","ğŸ•¯ í›„ì—´")),m.appendChild($("cardText",s.backText)),l.appendChild(m),n&&a&&(l.onclick=()=>a(t)),n&&(l.onpointerdown=i=>{if(i.button!==0&&i.pointerType==="mouse"||B(e)||e.phase!=="PLACE")return;const o=e.hand.indexOf(t);Ye(i,{kind:"hand",cardUid:t,fromHandIndex:o})}),l}function h(e){const t=document.createElement("div");return t.className=e,t}function $(e,t){const n=document.createElement("div");return n.className=e,n.textContent=t,n}function ot(e){const t=document.createElement("h2");return t.textContent=e,t}function st(e){const t=document.createElement("h3");return t.textContent=e,t}function xe(e){const t=document.createElement("p");return t.textContent=e,t}function it(e){const t=document.createElement("small");return t.textContent=e,t}function v(e){const t=document.createElement("span");return t.className="badge",t.textContent=e,t}function Ge(e,t,n){const a=document.createElement("button");return a.textContent=e,a.disabled=n,a.onclick=t,a}function lt(e){const t=document.createElement("pre");return t.className="log",t.textContent=e,t}function Ce(e,t){const n=t??0;return n>0?`${e} +${n}`:e}function Ee(e,t){const n=e.cards[t],a=e.content.cardsById[n.defId].name;return Ce(a,n.upgrade)}function Me(e,t){const n=e.content.cardsById[t.defId].name;return Ce(n,t.upgrade)}const dt=Cn();let Z=Fe(dt);function Ze(e){Z=e,Te=Ve(Z,Ze),b(Z,Te)}let Te=Ve(Z,Ze);b(Z,Te);
