(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();function Br(){const e=document.documentElement,t=180,n=5,r=7,o=3;let s=0;const a=()=>{s=0;const l=getComputedStyle(e),c=window.innerWidth,h=window.innerHeight,u=parseFloat(l.getPropertyValue("--hudH"))||140,d=parseFloat(l.getPropertyValue("--dockH"))||210,x=parseFloat(l.getPropertyValue("--uiGap"))||16,$=parseFloat(l.getPropertyValue("--edgePad"))||14,f=parseFloat(l.getPropertyValue("--logW"))||360,p=parseFloat(l.getPropertyValue("--logGap"))||14,b=parseFloat(l.getPropertyValue("--playerW"))||320,g=parseFloat(l.getPropertyValue("--slotGapXBase"))||22,m=parseFloat(l.getPropertyValue("--slotGapYBase"))||6,k=Math.max(320,c-(b+f+p*2+$*2)),M=Math.max(260,h-(u+d+x)),T=o*t+(o-1)*g,H=t*(r/n),I=parseFloat(l.getPropertyValue("--battleChromeHBase"))||140,E=H*2+m+I,_=k/T,N=M/E,C=Math.min(_,N),P=Math.max(.55,Math.min(C,1.25));e.style.setProperty("--u",String(P))},i=()=>{s||(s=requestAnimationFrame(a))};window.addEventListener("resize",i,{passive:!0}),a()}function Fr(){let e=!1;const t=()=>{const o=window.innerWidth;!e&&o<1180&&(e=!0),e&&o>1220&&(e=!1),document.body.classList.toggle("compact",e)};let n=0;const r=()=>{n||(n=requestAnimationFrame(()=>{n=0,t()}))};window.addEventListener("resize",r,{passive:!0}),t()}function ot(e,t,n,r,o="SYSTEM"){let s=n;if(r&&o==="PLAYER"&&t==="bleed"){const a=Number(r._bleedBonusPerApply??0);a&&(s+=a)}if(r&&t==="vuln"&&s>0&&e===r.player){const a=r.run;(a?.relics??[]).includes("relic_ratskin_charm")&&a?.relicRuntime?.relic_ratskin_charm?.active!==!1&&(s=Math.max(0,s-1))}e.status[t]=Math.max(0,(e.status[t]??0)+s)}function ln(e,t=0){return e<t?t:e}function cn(e){const t=[...e];for(let n=t.length-1;n>0;n--){const r=Math.floor(Math.random()*(n+1));[t[n],t[r]]=[t[r],t[n]]}return t}function oe(e,t="pickOne"){if(e.length===0)throw new Error(`${t}: empty array`);return e[Math.floor(Math.random()*e.length)]}function y(e,t){e.log.unshift(t),e.log=e.log.slice(0,250)}function V(e){return e.enemies.filter(t=>t.hp>0)}function Wr(e){return Math.max(0,Math.min(1,e))}function Xn(e,t=0){const n=e.player?.fatigue??0,r=Wr(t+Math.max(0,n-5)*.12),o=n<=5?0:n<=8?1:n<=11?2:3;return{f:n,p:r,tier:o}}function Sn(e,t){e.includes(t)||e.push(t)}function Ht(e,t,n){e[t]??=[],e[n]??=[],Sn(e[t],n),Sn(e[n],t)}function Ur(e,t,n){return(e[t]??[]).includes(n)}function _n(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}function Kr(e){return e[Math.floor(Math.random()*e.length)]}function zr(e){const t=Math.floor((e+1)/2),r=Math.round((Math.max(4,e)-1)/3.2)+1,o=12,s=Math.min(t,32),a=Math.max(o,Math.min(s,r));return Math.max(3,Math.min(t,a))}function jr(e){let n=zr(e);for(;n>2&&1+2*(n-1)>e;)n-=1;const r=Math.floor((e+1)/2);for(;n<r&&1+4*(n-1)<e;)n+=1;const o=4,s=new Array(n).fill(2);s[0]=1;let a=e-(1+2*(n-1));for(;a>0;){const i=1+Math.floor(Math.random()*(n-1));s[i]>=o||(s[i]+=1,a-=1)}for(let i=0;i<24;i++){const l=1+Math.floor(Math.random()*(n-1)),c=1+Math.floor(Math.random()*(n-1));l!==c&&(s[l]<=2||s[c]>=o||Math.random()<.5&&(s[l]-=1,s[c]+=1))}return s}function qr(e){const n=Math.max(18,Math.floor(8.64)),r=Math.max(2,Math.floor(72/15)),o={},s={},a=jr(72),i=[];let l=0;for(let C=0;C<a.length;C++){const P=a[C],w=[];for(let S=0;S<P;S++){const D=`n${l++}`;w.push(D)}i.push(w)}for(;l<72;)i[i.length-1].length>=4&&i.push([]),i[i.length-1].push(`n${l++}`);for(let C=0;C<i.length;C++){const P=i[C];for(let w=0;w<P.length;w++){const S=P[w];o[S]={id:S,kind:C===0&&w===0?"START":"BATTLE",depth:C,order:w,visited:C===0&&w===0,cleared:C===0&&w===0,reprocCount:0,lastProcTime:-999},s[S]=[]}}const c=i.slice(0,-1).map(()=>[]),h=(C,P)=>{if(Ur(s,C,P))return!1;const w=o[C]?.depth??0,S=o[P]?.depth??0;if(Math.abs(w-S)!==1)return!1;const D=Math.min(w,S),F=w<S?C:P,L=w<S?P:C,W=o[F]?.order??0,B=o[L]?.order??0;for(const[K,j]of c[D])if(W<K&&B>j||W>K&&B<j)return!1;return Ht(s,F,L),c[D].push([W,B]),!0};for(let C=0;C<i.length-1;C++){const P=i[C],w=i[C+1];for(let D=0;D<w.length;D++){const F=Math.floor(D*P.length/w.length),L=(Math.random()<.5?-1:1)*(Math.random()<.35?1:0),W=Math.max(0,Math.min(P.length-1,F+L));h(P[W],w[D])}const S=.35;for(let D=0;D<P.length;D++){if(Math.random()>S)continue;const F=Math.floor(D*w.length/P.length),L=(Math.random()<.5?-1:1)*(Math.random()<.35?1:0),W=Math.max(0,Math.min(w.length-1,F+L));h(P[D],w[W])}}i.length>=2&&i[1].length>=2&&h(i[0][0],i[1][i[1].length-1]);const u=Math.max(0,Math.min(n,144));let d=0,x=0;for(;d<u&&x++<8e3;){const C=Math.floor(Math.random()*(i.length-1)),P=i[C],w=i[C+1],S=P[Math.floor(Math.random()*P.length)],D=w[Math.floor(Math.random()*w.length)];h(S,D)&&(d+=1)}const $=.25;for(let C=0;C<i.length;C++){const P=i[C];if(P.length<2)continue;const w=Math.floor(Math.random()*(P.length-1));Ht(s,P[w],P[w+1]);for(let S=0;S<P.length-1;S++)S!==w&&Math.random()<$&&Ht(s,P[S],P[S+1])}const f={nodes:o,edges:s,startId:i[0][0],pos:i[0][0],treasureId:null,visionNonce:0},p=[],b=Math.max(2,Math.floor(i.length*.85)),g=Math.max(b,Math.floor(i.length*1)-1);for(let C=b;C<=g&&C<i.length;C++)for(const P of i[C])p.push(P);const m=p.length?Kr(p):"n71";f.treasureId=m,o[m].kind="TREASURE";const k=Object.keys(o).filter(C=>C!==f.startId&&C!==m);_n(k);const M=k.filter(C=>(o[C]?.depth??0)>=2);_n(M);const T=new Set(M.slice(0,Math.min(r,M.length))),H=4,I={battleMul:.25,eventMul:1.35,restMul:1.55},E=C=>s[C]?.length??0,_=new Set(Object.keys(o).filter(C=>C===f.startId||(o[C]?.depth??0)<H?!1:E(C)===1)),N=(C,P)=>{let w=.5,S=.25,D=.25;C<=1?(w=.72,S=.14,D=.14):C<=3&&(w=.6,S=.2,D=.2),P&&(w*=I.battleMul??.25,S*=I.eventMul??1.35,D*=I.restMul??1.55);const F=w+S+D,L=Math.random()*F;return L<w?"BATTLE":L<w+S?"EVENT":"REST"};for(const C of k){if(T.has(C)){o[C].kind="ELITE";continue}const P=o[C]?.depth??0;o[C].kind=N(P,_.has(C))}return f}function Vr(e){return e.uidSeq+=1,String(e.uidSeq)}function Yr(){return{relicRuntime:{},pendingRelicActivations:[],unlock:{rest:0,eliteWins:0,tookBigHit10:!1,kills:0,endedTurnWeak:!1,eventPicks:0,hpLeq15:!1,skippedTurn:!1,bleedApplied:0},timeMove:0,map:qr(),pursuit:{heat:0},vision:{mode:"NORMAL",blind:!1,presenceR:2,typeR:2,detailR:0,noise:0},encounterCount:0,treasureObtained:!1,afterTreasureNodePicks:0,nodeOfferQueue:[],finished:!1,nodePickCount:0,nodePickByType:{BATTLE:0,ELITE:0,REST:0,EVENT:0,TREASURE:0},currentNodeOffers:null,nextBattleSuppliesBonus:0,bossPool:["boss_gravity_master","boss_cursed_wall","boss_giant_orc","boss_soul_stealer"],branchOffer:null,battleCount:0,enemyLastSeenBattle:{},nextBossId:null,nextBossTime:40,forcedNext:null,bossOmenText:null,deckSizeAtTreasure:null,ominousProphecySeen:!1,relics:[],lastBattleWasElite:!1,eliteRelicOfferedThisBattle:!1,pendingElite:!1}}function Vt(e){const t={uidSeq:0,combatTurn:0,intentsRevealedThisTurn:!1,disruptIndexThisTurn:null,attackedEnemyIndicesThisTurn:[],phase:"NODE",log:[],run:Yr(),player:{hp:60,maxHp:60,block:0,supplies:7,fatigue:0,zeroSupplyTurns:0,status:{vuln:0,weak:0,bleed:0,disrupt:0},immuneToDisruptThisTurn:!1,nullifyDamageThisTurn:!1},content:e,cards:{},deck:[],hand:[],discard:[],exhausted:[],vanished:[],frontSlots:[null,null,null],backSlots:[null,null,null],backSlotDisabled:[!1,!1,!1],enemies:[],usedThisTurn:0,frontPlacedThisTurn:0,selectedHandCardUid:null,winHooksAppliedThisCombat:!1,drawCountThisTurn:0,pendingTarget:null,pendingTargetQueue:[],backUidsThisTurn:[],victoryResolvedThisCombat:!1,time:0,choice:null,choiceQueue:[],choiceStack:[],choiceCtx:null,selectedEnemyIndex:null,_justStartedCombat:!1};return Gr(t),y(t,"ÏÉà Îü∞ ÏãúÏûë."),t}function Oe(e,t,n){for(let r=0;r<n;r++){const o=Vr(e),s={uid:o,defId:t,zone:"deck",upgrade:0};e.cards[o]=s,e.deck.push(o)}}function Gr(e){Oe(e,"field_ration",2),Oe(e,"maintenance",2),Oe(e,"scout",2),Oe(e,"shield",2),Oe(e,"power_arrow",1),Oe(e,"arrow",3),e.deck=cn(e.deck)}function Ce(e,t){const n=e.cards[t],r=e.content.cardsById[n.defId],o=n.upgrade??0,s=r.upgrades?.[o-1];return s?{...r,...s}:r}function be(e,t,n){const r=e.cardsById[t],o=Math.max(0,n|0);if(o<=0)return r;const s=r.upgrades?.[o-1];return s?{...r,...s}:r}function Ue(e,t){const r=e.cards[t].upgrade??0,o=Ce(e,t);return r>0?`${o.name} +${r}`:o.name}const Xr=[{id:"field_ration",name:"ÏïºÏ†Ñ ÏãùÎüâ",frontText:"Î∞©Ïñ¥ +3",backText:"S +2",front:[{op:"block",n:3}],back:[{op:"supplies",n:2}],upgrades:[{frontText:"Î∞©Ïñ¥ +5",front:[{op:"block",n:5}],backText:"S +3",back:[{op:"supplies",n:3}]}]},{id:"maintenance",name:"Ï†ïÎπÑ ÎèÑÍµ¨",exhaustWhen:"BACK",frontText:"Î∞©Ïñ¥ +3",backText:"F -1, ÏÜåÎ™®",front:[{op:"block",n:3}],back:[{op:"fatigue",n:-1}],upgrades:[{frontText:"Î∞©Ïñ¥ +5",front:[{op:"block",n:5}],backText:"F -1, S +2, ÏÜåÎ™®",back:[{op:"fatigue",n:-1},{op:"supplies",n:2}]}]},{id:"scout",name:"Ï†ïÏ∞∞",frontText:"ÏßÄÏ†ï ÌîºÌï¥ 3, Î∞©Ïñ¥ +1",backText:"ÎìúÎ°úÏö∞ 1, S +2",front:[{op:"damageEnemy",target:"select",n:3},{op:"block",n:1}],back:[{op:"draw",n:1},{op:"supplies",n:2}],upgrades:[{frontText:"ÏßÄÏ†ï ÌîºÌï¥ 4, Î∞©Ïñ¥ +2",front:[{op:"damageEnemy",target:"select",n:4},{op:"block",n:2}],backText:"ÎìúÎ°úÏö∞ 2, S +3",back:[{op:"draw",n:2},{op:"supplies",n:3}]}]},{id:"shield",name:"Î∞©Ìå®",frontText:"Î∞©Ïñ¥ +5",backText:"Î∞©Ïñ¥ +3",front:[{op:"block",n:5}],back:[{op:"block",n:3}],upgrades:[{frontText:"Î∞©Ïñ¥ +7",front:[{op:"block",n:7}],backText:"Î∞©Ïñ¥ +4",back:[{op:"block",n:4}]}]},{id:"power_arrow",name:"Í∞ïÎ†•Ìïú ÌôîÏÇ¥",frontText:"Î¨¥ÏûëÏúÑ ÌîºÌï¥ 10, S -2",backText:"Î¨¥ÏûëÏúÑ ÌîºÌï¥ 7, S -2",front:[{op:"supplies",n:-2},{op:"damageEnemy",target:"random",n:10}],back:[{op:"supplies",n:-2},{op:"damageEnemy",target:"random",n:7}],upgrades:[{frontText:"Î¨¥ÏûëÏúÑ ÌîºÌï¥ 13, S -2",front:[{op:"supplies",n:-2},{op:"damageEnemy",target:"random",n:13}],backText:"Î¨¥ÏûëÏúÑ ÌîºÌï¥ 10, S -2",back:[{op:"supplies",n:-2},{op:"damageEnemy",target:"random",n:10}]}]},{id:"arrow",name:"ÌôîÏÇ¥",frontText:"ÏßÄÏ†ï ÌîºÌï¥ 5",backText:"ÏßÄÏ†ï ÌîºÌï¥ 5, S -1",front:[{op:"damageEnemy",target:"select",n:5}],back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:5}],upgrades:[{frontText:"ÏßÄÏ†ï ÌîºÌï¥ 7",front:[{op:"damageEnemy",target:"select",n:7}],backText:"ÏßÄÏ†ï ÌîºÌï¥ 7, S -1",back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:7}]}]},{id:"goal_treasure",name:"Ï†ÄÏ£ºÎ∞õÏùÄ Î≥¥Î¨º",exhaustWhen:"BOTH",frontText:"F +1, ÏÜåÎ™®",backText:"S -1, F +1, ÏÜåÎ™®",front:[{op:"fatigue",n:1}],back:[{op:"supplies",n:-1},{op:"fatigue",n:1}]},{id:"berserk",name:"Í¥ëÌè≠Ìôî",frontText:"Î¨¥ÏûëÏúÑ ÌîºÌï¥ 15, S -3",backText:"S +4, F +1",front:[{op:"damageEnemy",target:"random",n:15},{op:"supplies",n:-3}],back:[{op:"supplies",n:4},{op:"fatigue",n:1}],upgrades:[{frontText:"Î¨¥ÏûëÏúÑ ÌîºÌï¥ 20, S -4",front:[{op:"damageEnemy",target:"random",n:20},{op:"supplies",n:-4}],backText:"S +6, F +2",back:[{op:"supplies",n:6},{op:"fatigue",n:2}]}]},{id:"bandage",name:"Î∂ïÎåÄ",exhaustWhen:"BOTH",frontText:"HP +4, ÏÜåÎ™®",backText:"HP +4, S -1, ÏÜåÎ™®",front:[{op:"heal",n:4}],back:[{op:"supplies",n:-1},{op:"heal",n:4}],upgrades:[{frontText:"HP +4, Ï∂úÌòà Ï†úÍ±∞, ÏÜåÎ™®",front:[{op:"heal",n:4},{op:"clearStatusSelf",key:"bleed"}],backText:"HP +4, Ï∂úÌòà Ï†úÍ±∞, S -1, ÏÜåÎ™®",back:[{op:"supplies",n:-1},{op:"heal",n:4},{op:"clearStatusSelf",key:"bleed"}]}]},{id:"arrow_rain",name:"ÌôîÏÇ¥Ïùò ÎπÑ",exhaustWhen:"BOTH",frontText:"Ï†ÑÏ≤¥ ÌîºÌï¥ 10, S -2 ÏÜåÎ™®",backText:"ÎìúÎ°úÏö∞ 2, S +2, F +1, ÏÜåÎ™®",front:[{op:"damageEnemy",target:"all",n:10},{op:"supplies",n:-2}],back:[{op:"draw",n:2},{op:"supplies",n:2},{op:"fatigue",n:1}],upgrades:[{frontText:"Ï†ÑÏ≤¥ ÌîºÌï¥ 13, S -2, ÏÜåÎ™®",front:[{op:"damageEnemy",target:"all",n:13},{op:"supplies",n:-2}],backText:"ÎìúÎ°úÏö∞ 3, S +3, F +2, ÏÜåÎ™®",back:[{op:"draw",n:3},{op:"supplies",n:3},{op:"fatigue",n:2}]}]},{id:"smoke",name:"Ïó∞Îßâ",vanishWhen:"FRONT",frontText:"Ïù¥Î≤à ÌÑ¥ Ï†Å Í≥µÍ≤© ÌîºÌï¥ Î¨¥Ìö®, ÏÜåÏã§",backText:"F +1",front:[{op:"nullifyDamageThisTurn"}],back:[{op:"fatigue",n:1}]},{id:"redeploy",name:"Ïû¨Î∞∞Ïπò",frontText:"S +2",backText:"3Î≤à Ïä¨Î°ØÏóê ÏûàÎäî ÌõÑÏó¥ Ïπ¥ÎìúÏùò Ï†ÑÏó¥ Ìö®Í≥º Î∞úÎèô",front:[{op:"supplies",n:2}],back:[{op:"triggerFrontOfBackSlot",index:2}],upgrades:[{frontText:"S +3",front:[{op:"supplies",n:3}],backText:"3Î≤à Ïä¨Î°ØÏóê ÏûàÎäî ÌõÑÏó¥ Ïπ¥ÎìúÏùò Ï†ÑÏó¥ Ìö®Í≥º Î∞úÎèô, S +1",back:[{op:"triggerFrontOfBackSlot",index:2},{op:"supplies",n:1}]}]},{id:"secret_strike",name:"ÎπÑÏû•Ïùò ÏùºÍ≤©",exhaustWhen:"BOTH",frontText:"Î¨¥ÏûëÏúÑ ÌîºÌï¥ (FÏùò 2Î∞∞), ÏÜåÎ™®",backText:"Ï†ÑÏ≤¥ Ï∑®ÏïΩ +3 Î∞è ÏïΩÌôî +3, ÏÜåÎ™®",front:[{op:"damageEnemyByPlayerFatigue",target:"random",mult:2}],back:[{op:"statusEnemy",target:"all",key:"vuln",n:3},{op:"statusEnemy",target:"all",key:"weak",n:3}],upgrades:[{exhaustWhen:"FRONT",frontText:"ÏßÄÏ†ï ÌîºÌï¥ (FÏùò 2Î∞∞), ÏÜåÎ™®",front:[{op:"damageEnemyByPlayerFatigue",target:"select",mult:2}],backText:"Ï†ÑÏ≤¥ Ï∑®ÏïΩ +4 Î∞è ÏïΩÌôî +4",back:[{op:"statusEnemy",target:"all",key:"vuln",n:4},{op:"statusEnemy",target:"all",key:"weak",n:4}]}]},{id:"fire_scroll",name:"ÌôîÏóº ÎëêÎ£®ÎßàÎ¶¨",exhaustWhen:"FRONT",vanishWhen:"BACK",frontText:"Ï†ÑÏ≤¥ ÌîºÌï¥ 6, ÏÜåÎ™®",backText:"Ï†ÑÏ≤¥ ÌîºÌï¥ 12, ÏÜåÏã§",front:[{op:"damageEnemy",target:"all",n:6}],back:[{op:"damageEnemy",target:"all",n:12}],upgrades:[{frontText:"Ï†ÑÏ≤¥ ÌîºÌï¥ 8, ÏÜåÎ™®",front:[{op:"damageEnemy",target:"all",n:8}],backText:"Ï†ÑÏ≤¥ ÌîºÌï¥ 15, ÏÜåÏã§",back:[{op:"damageEnemy",target:"all",n:15}]}]},{id:"caltrops",name:"ÎßàÎ¶ÑÏá†",frontText:"Ï†ÑÏ≤¥ Ï∂úÌòà 4 Î∂ÄÏó¨",backText:"Ïù¥Î≤à ÌÑ¥Ïóê ÏûêÏã†ÏùÑ Í≥µÍ≤©ÌïòÎ†§Îäî Ï†ÅÏóêÍ≤å Ï∂úÌòà 3 Î∂ÄÏó¨",front:[{op:"statusEnemy",target:"all",key:"bleed",n:4}],back:[{op:"statusEnemiesAttackingThisTurn",key:"bleed",n:3}],upgrades:[{frontText:"Ï†ÑÏ≤¥ Ï∂úÌòà 5 Î∂ÄÏó¨",backText:"Ïù¥Î≤à ÌÑ¥Ïóê ÏûêÏã†ÏùÑ Í≥µÍ≤©ÌïòÎ†§Îäî Ï†ÅÏóêÍ≤å Ï∂úÌòà 4 Î∂ÄÏó¨",front:[{op:"statusEnemy",target:"all",key:"bleed",n:5}],back:[{op:"statusEnemiesAttackingThisTurn",key:"bleed",n:4}]}]},{id:"emergency_rations",name:"ÎπÑÏÉÅÏãùÎüâ",vanishWhen:"BACK",frontText:"S +2",backText:"SÎ•º 7Î°ú ÎßåÎì¶. ÏÜåÏã§",front:[{op:"supplies",n:2}],back:[{op:"setSupplies",n:7}],upgrades:[{frontText:"S +3",backText:"SÎ•º 10ÏúºÎ°ú ÎßåÎì¶. ÏÜåÏã§",front:[{op:"supplies",n:3}],back:[{op:"setSupplies",n:10}]}]},{id:"painkiller",name:"ÏßÑÌÜµÏ†ú",exhaustWhen:"FRONT",vanishWhen:"BACK",frontText:"HP -8, F -3, ÏÜåÎ™®",backText:"HP +8, F +1, ÏÜåÏã§",front:[{op:"hp",n:-8},{op:"fatigue",n:-3}],back:[{op:"hp",n:8},{op:"fatigue",n:1}],upgrades:[{frontText:"HP -6, F -3, ÏÜåÎ™®",backText:"HP +10, F +1, ÏÜåÏã§",front:[{op:"hp",n:-6},{op:"fatigue",n:-3}],back:[{op:"hp",n:10},{op:"fatigue",n:1}]}]},{id:"field_experience",name:"Ïã§Ï†Ñ Í≤ΩÌóò",exhaustWhen:"BACK",frontText:"Ï†ÑÏ≤¥ ÌîºÌï¥ 3",backText:"Ïù¥ Ïπ¥ÎìúÍ∞Ä ÌõÑÏó¥Ïóê ÏûàÎäî ÌÑ¥Ïóê ÏäπÎ¶¨ÌïòÎ©¥ ÏµúÎåÄ Ï≤¥Î†• +2, ÏÜåÎ™®",front:[{op:"damageEnemy",target:"all",n:3}],back:[],onWinWhileInBack:[{op:"maxHp",n:2}],upgrades:[{frontText:"Ï†ÑÏ≤¥ ÌîºÌï¥ 4",backText:"Ïù¥ Ïπ¥ÎìúÍ∞Ä ÌõÑÏó¥Ïóê ÏûàÎäî ÌÑ¥Ïóê ÏäπÎ¶¨ÌïòÎ©¥ ÏµúÎåÄ Ï≤¥Î†• +3, ÏÜåÎ™®",front:[{op:"damageEnemy",target:"all",n:4}],back:[],onWinWhileInBack:[{op:"maxHp",n:3}]}]},{id:"camp_prep",name:"ÏïºÏòÅ Ï§ÄÎπÑ",frontText:"Î∞©Ïñ¥ +4, S +1",backText:"S +3",front:[{op:"block",n:4},{op:"supplies",n:1}],back:[{op:"supplies",n:3}],upgrades:[{frontText:"Î∞©Ïñ¥ +5, S +2",backText:"S +5",front:[{op:"block",n:5},{op:"supplies",n:2}],back:[{op:"supplies",n:5}]}]},{id:"vital_shot",name:"Í∏âÏÜå ÏÇ¨Í≤©",frontText:"ÏßÄÏ†ï ÌîºÌï¥ 8",backText:"ÏßÄÏ†ï ÌîºÌï¥ 5, Ï∂úÌòà 2 Î∂ÄÏó¨, S -1",front:[{op:"damageEnemy",target:"select",n:8}],back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:5},{op:"statusEnemy",target:"select",key:"bleed",n:2}],upgrades:[{frontText:"ÏßÄÏ†ï ÌîºÌï¥ 11",backText:"ÏßÄÏ†ï ÌîºÌï¥ 6, Ï∂úÌòà 3 Î∂ÄÏó¨, S -1",front:[{op:"damageEnemy",target:"select",n:11}],back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:6},{op:"statusEnemy",target:"select",key:"bleed",n:3}]}]},{id:"taunt",name:"ÎèÖÏÑ§",frontText:"ÏßÄÏ†ï ÏïΩÌôî +4",backText:"Ï†ÑÏ≤¥ Ï∑®ÏïΩ +2 Î∞è ÏïΩÌôî +2",front:[{op:"statusEnemy",target:"select",key:"weak",n:4}],back:[{op:"statusEnemy",target:"all",key:"vuln",n:2},{op:"statusEnemy",target:"all",key:"weak",n:2}],upgrades:[{frontText:"ÏßÄÏ†ï ÏïΩÌôî +5",backText:"Ï†ÑÏ≤¥ Ï∑®ÏïΩ +2 Î∞è ÏïΩÌôî +3",front:[{op:"statusEnemy",target:"select",key:"weak",n:5}],back:[{op:"statusEnemy",target:"all",key:"vuln",n:2},{op:"statusEnemy",target:"all",key:"weak",n:3}]}]},{id:"rapid_fire",name:"Ïó∞ÏÜç ÏÇ¨Í≤©",frontText:"ÏßÄÏ†ï ÌîºÌï¥ 2, 3Î≤à Î∞úÎèô",backText:"Ïù¥Î≤à ÌÑ¥Ïóê Ïπ¥ÎìúÎ•º ÎΩëÏïòÏúºÎ©¥ Î¨¥ÏûëÏúÑ ÌîºÌï¥ 8",front:[{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2}],back:[{op:"ifDrewThisTurn",then:[{op:"damageEnemy",target:"random",n:8}]}],upgrades:[{frontText:"ÏßÄÏ†ï ÌîºÌï¥ 2, 4Î≤à Î∞úÎèô",backText:"Ïù¥Î≤à ÌÑ¥Ïóê Ïπ¥ÎìúÎ•º ÎΩëÏïòÏúºÎ©¥ Î¨¥ÏûëÏúÑ ÌîºÌï¥ 10",front:[{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2},{op:"damageEnemy",target:"select",n:2}],back:[{op:"ifDrewThisTurn",then:[{op:"damageEnemy",target:"random",n:10}]}]}]},{id:"blood_contract",name:"ÌîºÏùò Í≥ÑÏïΩ",frontText:"ÏßÄÏ†ï ÌîºÌï¥ 12, HP -3",backText:"S +3, F +1",front:[{op:"damageEnemy",target:"select",n:12},{op:"hp",n:-3}],back:[{op:"supplies",n:3},{op:"fatigue",n:1}],upgrades:[{frontText:"ÏßÄÏ†ï ÌîºÌï¥ 15, HP -3",backText:"S +4, F +1",front:[{op:"damageEnemy",target:"select",n:15},{op:"hp",n:-3}],back:[{op:"supplies",n:4},{op:"fatigue",n:1}]}]},{id:"cloth_scrap_armor",name:"Ï≤ú Ï°∞Í∞Å Í∞ëÏò∑",frontText:"Î∞©Ïñ¥ +8, S -1",backText:"Î∞©Ïñ¥ +4",front:[{op:"supplies",n:-1},{op:"block",n:8}],back:[{op:"block",n:4}],upgrades:[{frontText:"Î∞©Ïñ¥ +10, S -1",backText:"Î∞©Ïñ¥ +5",front:[{op:"supplies",n:-1},{op:"block",n:10}],back:[{op:"block",n:5}]}]},{id:"prey_mark",name:"ÏÇ¨ÎÉ•Í∞ê ÌëúÏãú",frontText:"ÏßÄÏ†ï ÌîºÌï¥ 7, ÎåÄÏÉÅÏùò HPÍ∞Ä ÌîåÎ†àÏù¥Ïñ¥Î≥¥Îã§ ÎÜíÏúºÎ©¥ ÎåÄÏã† ÌîºÌï¥ 12",backText:"ÏßÄÏ†ï Ï∑®ÏïΩ +2",front:[{op:"damageEnemyFormula",target:"select",kind:"prey_mark"}],back:[{op:"statusEnemy",target:"select",key:"vuln",n:2}],upgrades:[{frontText:"ÏßÄÏ†ï ÌîºÌï¥ 9, ÎåÄÏÉÅÏùò HPÍ∞Ä ÌîåÎ†àÏù¥Ïñ¥Î≥¥Îã§ ÎÜíÏúºÎ©¥ ÎåÄÏã† ÌîºÌï¥ 15",front:[{op:"damageEnemyFormula",target:"select",kind:"prey_mark_u1"}],backText:"ÏßÄÏ†ï Ï∑®ÏïΩ +3",back:[{op:"statusEnemy",target:"select",key:"vuln",n:3}]}]},{id:"brawl_cleaver",name:"ÎÇúÏ†Ñ Ï†ïÎ¶¨",frontText:"ÏßÄÏ†ï ÌîºÌï¥ 8, ÎÇ®ÏùÄ Ï†ÅÏù¥ 3Î™ÖÏù¥Î©¥ ÎåÄÏã† ÌîºÌï¥ 16",backText:"Î∞©Ïñ¥ +6",front:[{op:"damageEnemyFormula",target:"select",kind:"triple_bounty"}],back:[{op:"block",n:6}],upgrades:[{frontText:"ÏßÄÏ†ï ÌîºÌï¥ 10, ÎÇ®ÏùÄ Ï†ÅÏù¥ 3Î™ÖÏù¥Î©¥ ÎåÄÏã† 20",front:[{op:"damageEnemyFormula",target:"select",kind:"triple_bounty_u1"}],backText:"Î∞©Ïñ¥ +7",back:[{op:"block",n:7}]}]},{id:"mad_echo",name:"Î©îÏïÑÎ¶¨",frontText:"Î¨¥ÏûëÏúÑ ÌîºÌï¥ (FÏùò Ï†àÎ∞ò (Î≤ÑÎ¶º))",backText:"ÎìúÎ°úÏö∞ 1, S +2, F +1",front:[{op:"damageEnemyByPlayerFatigue",target:"random",mult:.5}],back:[{op:"draw",n:1},{op:"supplies",n:2},{op:"fatigue",n:1}],upgrades:[{frontText:"Î¨¥ÏûëÏúÑ ÌîºÌï¥ (F)",front:[{op:"damageEnemyByPlayerFatigue",target:"random",mult:1}],backText:"ÎìúÎ°úÏö∞ 2, S +2, F +1",back:[{op:"draw",n:2},{op:"supplies",n:2},{op:"fatigue",n:1}]}]},{id:"mad_insight",name:"Í∏àÎã®Ïùò ÌÜµÏ∞∞",exhaustWhen:"BOTH",frontText:"Î∞©Ïñ¥ +8, ÎìúÎ°úÏö∞ 1, F +1, ÏÜåÎ™®",backText:"ÎìúÎ°úÏö∞ 3, S +2, F +2, ÏÜåÎ™®",front:[{op:"block",n:8},{op:"draw",n:1},{op:"fatigue",n:1}],back:[{op:"draw",n:3},{op:"supplies",n:2},{op:"fatigue",n:2}],upgrades:[{frontText:"Î∞©Ïñ¥ +10, ÎìúÎ°úÏö∞ 2, F +1, ÏÜåÎ™®",front:[{op:"block",n:10},{op:"draw",n:2},{op:"fatigue",n:1}],backText:"ÎìúÎ°úÏö∞ 4, S +3, F +2, ÏÜåÎ™®",back:[{op:"draw",n:4},{op:"supplies",n:3},{op:"fatigue",n:2}]}]},{id:"mad_bargain",name:"Í±∞ÎûòÏùò ÏûîÏû¨",exhaustWhen:"BOTH",frontText:"ÏßÄÏ†ï 12 ÌîºÌï¥, S -1, F +1, ÏÜåÎ™®",backText:"HP +5, F +2, ÏÜåÎ™®",front:[{op:"damageEnemy",target:"select",n:12},{op:"supplies",n:-1},{op:"fatigue",n:1}],back:[{op:"heal",n:5},{op:"fatigue",n:2}],upgrades:[{frontText:"ÏßÄÏ†ï 20 ÌîºÌï¥, S -1, F +2, ÏÜåÎ™®",front:[{op:"damageEnemy",target:"select",n:20},{op:"supplies",n:-1},{op:"fatigue",n:2}],backText:"HP +7, F +2, ÏÜåÎ™®",back:[{op:"heal",n:7},{op:"fatigue",n:2}]}]}],Qn=Object.fromEntries(Xr.map(e=>[e.id,e])),Qr=[{id:"other_adventurer",name:"Î≥¥Î¨ºÏùÑ ÎÖ∏Î¶¨Îäî Îã§Î•∏ Î™®ÌóòÍ∞Ä",maxHp:60,intents:[{label:"Ï∞Ω Ï∞åÎ•¥Í∏∞: 5 ÌîºÌï¥, 3Î≤à Î∞úÎèô",acts:[{op:"damagePlayer",n:5},{op:"damagePlayer",n:5},{op:"damagePlayer",n:5}]},{label:"ÎèÖÏïΩ ÎøåÎ¶¨Í∏∞: Ï∂úÌòà +4, Ï∑®ÏïΩ +4, ÏïΩÌôî +4 Î∂ÄÏó¨",acts:[{op:"statusPlayer",key:"bleed",n:4},{op:"statusPlayer",key:"vuln",n:4},{op:"statusPlayer",key:"weak",n:4}]}]},{id:"goblin_raider",name:"Í≥†Î∏îÎ¶∞ ÏïΩÌÉàÏûê",maxHp:15,intents:[{label:"Í∏∞Ïäµ: 12 - Ïù¥Î≤à ÌÑ¥Ïóê ÏÇ¨Ïö©Ìïú Ïπ¥ÎìúÏùò ÏàòÎßåÌÅº ÌîºÌï¥",acts:[{op:"damagePlayerFormula",kind:"goblin_raider"}]},{label:"ÌõîÏπòÍ∏∞: Ï∂úÌòà +2 Î∂ÄÏó¨, S -3",acts:[{op:"supplies",n:-3},{op:"statusPlayer",key:"bleed",n:2}]}]},{id:"watching_statue",name:"Í∞êÏãúÌïòÎäî ÏÑùÏÉÅ",maxHp:25,intents:[{label:"Í∞êÏãú: 4 + Ïù¥Î≤à ÌÑ¥Ïóê ÏÇ¨Ïö©Ìïú Ïπ¥ÎìúÏùò ÏàòÎßåÌÅº ÌîºÌï¥",acts:[{op:"damagePlayerFormula",kind:"watching_statue"}]}]},{id:"pebble_golem",name:"Ï°∞ÏïΩÎèå Í≥®Î†ò",maxHp:30,intents:[{label:"Ï°∞ÏïΩÎèå ÎçòÏßÄÍ∏∞: 8 ÌîºÌï¥",acts:[{op:"damagePlayer",n:8}]},{label:"Î™®Îûò Î™®ÏúºÍ∏∞: ÏûêÏã† HP 6 ÌöåÎ≥µ",acts:[{op:"enemyHealSelf",n:6}]}]},{id:"rock_golem",name:"Î∞îÏúÑ Í≥®Î†ò",maxHp:50,intents:[{label:"Î∞îÏúÑ ÎçòÏßÄÍ∏∞: 10 ÌîºÌï¥",acts:[{op:"damagePlayer",n:10}]},{label:"ÎïÖ Î™®ÏúºÍ∏∞: ÏûêÏã† HP 8 ÌöåÎ≥µ",acts:[{op:"enemyHealSelf",n:8}]}]},{id:"slime",name:"Ïä¨ÎùºÏûÑ",maxHp:30,intents:[{label:"ÏÇ∞ÏÑ±Ïï°: Ï∂úÌòà +3 Î∂ÄÏó¨",acts:[{op:"statusPlayer",key:"bleed",n:3}]},{label:"Ï†êÏï°: ÏïΩÌôî +3 Î∂ÄÏó¨ ÌõÑ ÏûêÏã† HP 3 ÌöåÎ≥µ",acts:[{op:"statusPlayer",key:"weak",n:3},{op:"enemyHealSelf",n:3}]},{label:"ÎïåÎ¶¨Í∏∞: 6 ÌîºÌï¥",acts:[{op:"damagePlayer",n:6}]}]},{id:"poison_spider",name:"ÎèÖÍ±∞ÎØ∏",maxHp:28,intents:[{label:"ÎèÖÎãàÎ°ú Î¨ºÍ∏∞: Ï∂úÌòà +4 Î∂ÄÏó¨",acts:[{op:"statusPlayer",key:"bleed",n:4}]},{label:"ÏÜ°Í≥≥ÎãàÎ°ú Î¨ºÍ∏∞: 7 ÌîºÌï¥",acts:[{op:"damagePlayer",n:7}]},{label:"Îã®Î≤àÏóê Î¨ºÍ∏∞: Ï∂úÌòà +2 Î∂ÄÏó¨, 6 ÌîºÌï¥",acts:[{op:"statusPlayer",key:"bleed",n:2},{op:"damagePlayer",n:6}]}]},{id:"gravity_echo",name:"Ï§ëÎ†•Ïùò ÏûîÌñ•",maxHp:35,intents:[{label:"ÌïòÏ§ë Ïù∏Ïû•",acts:[{op:"damagePlayerByDeckSize",base:5,per:2,div:6,cap:18}]},{label:"ÏïïÏ∂ï: 7 ÌîºÌï¥",acts:[{op:"damagePlayer",n:7}]},{label:"ÎÜìÏπòÍ≤å ÎßåÎì§Í∏∞: S -3",acts:[{op:"supplies",n:-3}]}]},{id:"rat_swarm",name:"Ï•êÎñº",maxHp:20,intents:[{label:"ÎúØÍ∏∞: 4 ÌîºÌï¥, 2Î≤à Î∞úÎèô",acts:[{op:"damagePlayer",n:4},{op:"damagePlayer",n:4}]},{label:"Í∏∞ÏäµÌïòÍ∏∞: Ï∑®ÏïΩ +2 Î∂ÄÏó¨",acts:[{op:"statusPlayer",key:"vuln",n:2}]},{label:"Í¥ëÎûÄ: 2 ÌîºÌï¥ (ÌÉÄÏàòÍ∞Ä Ï¶ùÍ∞ÄÌï©ÎãàÎã§!) ",acts:[{op:"damagePlayerRampHits",n:2,baseHits:1,everyTurns:1,capHits:6}]}]},{id:"goblin_commander",name:"Í≥†Î∏îÎ¶∞ ÏßÄÌúòÍ¥Ä",maxHp:30,intents:[{label:"Ìò∏Î†π: Ï∑®ÏïΩ +2 Î∂ÄÏó¨",acts:[{op:"statusPlayer",key:"vuln",n:2}]},{label:"Î∞úÎ°ú Ï∞®Í∏∞: 7 ÌîºÌï¥",acts:[{op:"damagePlayer",n:7}]},{label:"Ï†ÑÏà† ÏßÄÏãú: ÏïΩÌôî +2 Î∂ÄÏó¨",acts:[{op:"statusPlayer",key:"weak",n:2}]}]},{id:"goblin_archer",name:"Í≥†Î∏îÎ¶∞ Í∂ÅÏàò",maxHp:15,intents:[{label:"Ï°∞Ï§Ä: 2 ÌîºÌï¥, 3Î≤à",acts:[{op:"damagePlayer",n:2},{op:"damagePlayer",n:2},{op:"damagePlayer",n:2}]},{label:"Ïó∞ÏÇ¨: 1 ÌîºÌï¥ (ÌÉÄÏàòÍ∞Ä Ï¶ùÍ∞ÄÌï©ÎãàÎã§!)",acts:[{op:"damagePlayerRampHits",n:1,baseHits:1,everyTurns:1,capHits:10}]}]},{id:"gloved_hunter",name:"Ïû•Í∞ë ÎÇÄ ÏÇ¨ÎÉ•Íæº",maxHp:52,intents:[{label:"Í∞ÄÎä†: Ï∑®ÏïΩ +3 Î∂ÄÏó¨",acts:[{op:"statusPlayer",key:"vuln",n:3}]},{label:"ÏÇ¨ÎÉ•: 6 ÌîºÌï¥, Î∞©Ïñ¥Í∞Ä 4 Ïù¥ÏÉÅÏù¥Î©¥ ÎåÄÏã† 12 ÌîºÌï¥",acts:[{op:"damagePlayerFormula",kind:"gloved_hunter"}]},{label:"ÏÇ¨ÏÇ¥: 9 ÌîºÌï¥",acts:[{op:"damagePlayer",n:9}]}]},{id:"debt_collector",name:"Ïû•Î∂Ä ÏàòÍ∏àÍ¥Ä",maxHp:55,intents:[{label:"ÏàòÍ∏à: S -3",acts:[{op:"supplies",n:-4}]},{label:"ÏïïÎ•ò: (SÍ∞Ä 0Ïù¥Î©¥) 15 ÌîºÌï¥",acts:[{op:"damagePlayerIfSuppliesZero",n:15}]},{label:"Ïû¨Ï†êÍ≤Ä: ÏïÑÎ¨¥ ÌñâÎèôÎèÑ ÌïòÏßÄ ÏïäÏùå",acts:[]}]},{id:"supply_hound",name:"Î≥¥Í∏â ÏÇ¨ÎÉ•Í∞ú",maxHp:26,intents:[{label:"ÎÉÑÏÉà Îß°Í∏∞: Ï∑®ÏïΩ +2 Î∂ÄÏó¨",acts:[{op:"statusPlayer",key:"vuln",n:2}]},{label:"ÎçÆÏπòÍ∏∞: (SÍ∞Ä 0Ïù¥ ÏïÑÎãàÎ©¥) 10 ÌîºÌï¥",acts:[{op:"damagePlayerIfSuppliesPositive",n:7}]},{label:"ÎúØÏñ¥ÎÇ¥Í∏∞: S -2",acts:[{op:"supplies",n:-2}]}]},{id:"boss_gravity_master",name:"Ï§ëÎ†• ÌÜµÎã¨Ïûê",omen:"Î™∏Ïù¥ Ï†êÏ†ê Î¨¥Í≤ÅÎã§. ÏßêÏùÑ ÎπÑÏõåÎùº.",maxHp:90,intents:[{label:"Ï§ëÎ†• ÏàòÏ∂ï: ÏïΩÌôî +3 Î∂ÄÏó¨",acts:[{op:"statusPlayer",key:"weak",n:3}]},{label:"ÌäπÏù¥Ï†ê ÏÉùÏÑ±",acts:[{op:"damagePlayerByDeckSize",base:8,per:3,div:5,cap:30}]},{label:"Ï≤úÏû• Î∂ïÍ¥¥: 11 ÌîºÌï¥",acts:[{op:"damagePlayer",n:11}]}]},{id:"boss_cursed_wall",name:"Ï†ÄÏ£ºÎ∞õÏùÄ Î≤Ω",omen:"ÏõÄÏßÅÏù¥ÏßÄ ÏïäÎäîÎã§. Îã≥ÏïÑÍ∞ÑÎã§.",maxHp:160,intents:[{label:"Ï†ÄÏ£ºÏùò Í∏∞Ïö¥: Ï∂úÌòà +3 Î∂ÄÏó¨",acts:[{op:"statusPlayer",key:"bleed",n:3}]},{label:"Ï†ÄÏ£ºÏùò Í∏∞Ïö¥: F +1",acts:[{op:"fatiguePlayer",n:1}]},{label:"ÏïÑÎ¨¥ ÌñâÎèôÎèÑ ÌïòÏßÄ ÏïäÏùå",acts:[]}]},{id:"boss_giant_orc",name:"Í±∞ÎåÄÌïú Ïò§ÌÅ¨",omen:"Í±∞ÎåÄÌïú ÏßêÏäπÏù¥ Í∏∞Îã§Î¶∞Îã§. ÌûòÏùÑ ÍπéÏïÑÏïº ÌïúÎã§.",maxHp:95,intents:[{label:"ÎÇ¥Î†§ÏπòÍ∏∞: Ï∑®ÏïΩ +2 Î∂ÄÏó¨, 10 ÌîºÌï¥",acts:[{op:"statusPlayer",key:"vuln",n:2},{op:"damagePlayer",n:15}]},{label:"Îã®Îã®Ìïú ÌîºÎ∂Ä: Îã§Ïùå ÌÑ¥ ÎèôÏïà ÌîºÌï¥Î•º ÏûÖÏßÄ ÏïäÏùå",acts:[{op:"enemyImmuneNextTurn"}]},{label:"ÌÉÄÍ≥†ÎÇú ÌöåÎ≥µ: ÏûêÏã† HP 15 ÌöåÎ≥µ",acts:[{op:"enemyHealSelf",n:15}]},{label:"Í¥ëÎ∂Ñ: 6 ÌîºÌï¥ (ÌÉÄÏàòÍ∞Ä Ï¶ùÍ∞ÄÌï©ÎãàÎã§!)",acts:[{op:"damagePlayerRampHits",n:6,baseHits:1,everyTurns:1,capHits:6}],meta:{cat:"ATTACK"}}]},{id:"boss_soul_stealer",name:"ÏòÅÌòº Í∞ïÌÉàÏûê",omen:"ÌñâÎèôÌïòÏßÄ ÏïäÏúºÎ©¥ Ï¢ÖÎßêÏù¥ Ïò®Îã§.",maxHp:80,intents:[{label:"ÌóàÍ∏∞: 7 ÌîºÌï¥, S -2",acts:[{op:"damagePlayer",n:7},{op:"supplies",n:-2}]},{label:"ÎÇòÌÉú: 7 ÌîºÌï¥, F +1",acts:[{op:"damagePlayer",n:7},{op:"fatiguePlayer",n:1}]},{label:"ÏòàÏñ∏: Ïπ¥Ïö¥Ìä∏ ÏßÑÌñâ",acts:[]}]}],Jr=Object.fromEntries(Qr.map(e=>[e.id,e]));function Zr(e,t=10,n=16){const r=Math.max(0,e-n),o=Math.ceil(Math.sqrt(r));return t+o}function Dt(e,t){const n=e.content.enemiesById[t];return{id:n.id,name:n.name,hp:n.maxHp,maxHp:n.maxHp,intentIndex:0,status:{vuln:0,weak:0,bleed:0,disrupt:0},immuneThisTurn:!1,immuneNextTurn:!1,lastIntentKey:null,lastIntentStreak:0,soulWarnCount:t==="boss_soul_stealer"?0:void 0,soulArmed:t==="boss_soul_stealer"?!1:void 0,soulWillNukeThisTurn:t==="boss_soul_stealer"?!1:void 0}}function eo(e,t,n,r=5){for(const o of t){const s=e.run.enemyLastSeenBattle?.[o];if(s!=null&&n-s<r)return!1}return!0}function Be(e,t){const n=t?.forceBoss??!1,r=e.run,o=(t?.forceElite??r.pendingElite??!1)===!0;r.pendingElite=!1,e.run.enemyLastSeenBattle??={},e.run.battleCount??=0;const s=e.run.nodePickCount??0,a=(e.run.battleCount??0)+1;if(t?.forcePatternIds&&t.forcePatternIds.length>0){const m=t.forcePatternIds;e.run.battleCount=a;for(const k of m)e.run.enemyLastSeenBattle[k]=a;e.enemies=m.map(k=>Dt(e,k)),e.run.lastBattleWasElite=!1,y(e,`Ï†ÑÌà¨ ÏãúÏûë! (ÎÖ∏Îìú ${s}, Ï†ÑÌà¨ ${a}ÌöåÏ∞®) Ï†Å: ${e.enemies.map(k=>k.name).join(", ")}`);return}if(n)if(e.run.lastBattleWasElite=!1,e.run.bossPool??=["boss_gravity_master","boss_cursed_wall","boss_giant_orc","boss_soul_stealer"],e.run.bossPool.length===0&&!e.run.nextBossId)y(e,`Î≥¥Ïä§ ÌíÄÏù¥ ÎπÑÏóàÏäµÎãàÎã§. ÏùºÎ∞ò Ï†ÑÌà¨Î°ú ÏßÑÌñâÌï©ÎãàÎã§. (ÎÖ∏Îìú ${s})`);else{let m=e.run.nextBossId??null;if(m!=null){const k=e.content.enemiesById[m];e.run.bossOmenText=pr[m]??k.omen??null}m?(e.run.nextBossId=null,e.run.bossPool=e.run.bossPool.filter(k=>k!==m)):(m=oe(e.run.bossPool),e.run.bossPool=e.run.bossPool.filter(k=>k!==m)),e.enemies=[Dt(e,m)],e.run.ominousProphecySeen=!1,y(e,`Î≥¥Ïä§ Îì±Ïû•! (ÎÖ∏Îìú ${s}) Ï†Å: ${e.enemies[0].name}`),e.run.battleCount=a,e.run.enemyLastSeenBattle[m]=a;return}const i=[[["goblin_raider"],["watching_statue"],["pebble_golem"],["slime"],["rat_swarm"],["supply_hound"]],[["goblin_raider","slime"],["pebble_golem","pebble_golem"],["rock_golem"],["poison_spider"],["rat_swarm","rat_swarm"],["goblin_archer","goblin_raider"],["supply_hound","goblin_raider"]],[["goblin_raider","goblin_raider","goblin_raider"],["rock_golem","pebble_golem"],["slime","slime"],["poison_spider","slime"],["gravity_echo"],["gloved_hunter"],["debt_collector"]]],l=[["gravity_echo","poison_spider"],["poison_spider","slime"],["watching_statue","slime"],["watching_statue","watching_statue"],["poison_spider","poison_spider"],["rock_golem","gravity_echo"],["goblin_raider","goblin_raider","watching_statue"],["rat_swarm","rat_swarm","rat_swarm"]],c=[[["goblin_raider","watching_statue"],["rat_swarm","goblin_archer"]],[["goblin_commander","goblin_archer","goblin_archer"],["watching_statue","watching_statue"],["gloved_hunter","rat_swarm"]],[["rock_golem","gravity_echo"],["poison_spider","poison_spider","poison_spider"]]],h=[["gravity_echo","gravity_echo"],["rock_golem","poison_spider"],["watching_statue","gravity_echo"],["debt_collector","supply_hound","supply_hound"]],u=Number(e.run.timeMove??0)+(e.time??0),d=Math.min(i.length-1,Math.floor(Math.max(0,u)/15)),x=o?e.run.treasureObtained?h:c[d]:e.run.treasureObtained?l:i[d],$=5,f=x.filter(m=>eo(e,m,a,$)),p=f.length>0?f:x,b=oe(p);e.run.battleCount=a;for(const m of b)e.run.enemyLastSeenBattle[m]=a;e.enemies=b.map(m=>Dt(e,m)),e.run.lastBattleWasElite=o,y(e,`Ï†ÑÌà¨ ÏãúÏûë!${o?" [Ï†ïÏòà]":""} (ÎÖ∏Îìú ${s}, Ï†ÑÌà¨ ${a}ÌöåÏ∞®) Ï†Å: ${e.enemies.map(m=>m.name).join(", ")}`)}function to(){return Object.keys(X).sort((e,t)=>e.localeCompare(t))}const no=[{id:"relic_ratskin_charm",name:"Ï•êÍ∞ÄÏ£Ω Î∂ÄÏ†Å",text:"Ï∑®ÏïΩÏùÑ Î∞õÏùÑ Îïå 1 Îçú Î∞õÏäµÎãàÎã§.",unlockFlavor:"ÏÇ¥Í∞ÄÏ£Ω. ÏñáÍ≤å, ÏïÑÏ£º ÏñáÍ≤å.",tags:["EVENT_ONLY"],art:"assets/relics/relic_ratskin_charm.png"}],X={relic_unknown_square:{id:"relic_unknown_square",dormantName:"Ï†ñÏùÄ ÏÇ¨Í∞ÅÌòï",dormantText:"Í≥∞Ìå°Ïù¥ÏùºÍπå? Î®πÏùÑ Ïàò ÏûàÏùÑÍπå?",unlockHint:"Ï°∞Í±¥: Ìú¥Ïãù 1Ìöå",art:"assets/relics/relic_unknown_square.png",unlock:e=>e.run.unlock?.rest>=1,name:"Î®πÏùÑ Ïàò ÏûàÎäî ÏÇ¨Í∞ÅÌòï",text:"Ï†ÑÌà¨ ÏãúÏûë Ïãú üåæ S +2",unlockFlavor:"Î®πÏùÑ ÏàòÎäî ÏûàÎã§. ÏùºÎã®ÏùÄ.",onCombatStart(e){e.player.supplies+=2,y(e,"Ïú†Î¨º[Î®πÏùÑ Ïàò ÏûàÎäî ÏÇ¨Í∞ÅÌòï]: S +2")}},relic_monster_leather_helm:{id:"relic_monster_leather_helm",dormantName:"Îì§Îü¨Î∂ôÎäî Í∞ÄÏ£Ω",dormantText:"ÌÑ∏Í≥º ÌîºÍ∞Ä Îí§ÏÑûÏù∏ Í∞ÄÏ£ΩÏù¥ ÏÜêÏóê Îì§Îü¨Î∂ôÎäîÎã§.",unlockHint:"Ï°∞Í±¥: ÏóòÎ¶¨Ìä∏ Ï†ÑÌà¨ ÏäπÎ¶¨ 1Ìöå",art:"assets/relics/relic_monster_leather_helm.png",unlock:e=>e.run.unlock?.eliteWins>=1,name:"Î™¨Ïä§ÌÑ∞ Í∞ÄÏ£Ω Ìà¨Íµ¨",text:"Ï≤´ ÌÑ¥Ïóê üõ°Ô∏è Î∞©Ïñ¥ +4",unlockFlavor:"Î®∏Î¶¨Ïóê Îì§Îü¨Î∂ôÏñ¥ Îñ®Ïñ¥ÏßÄÏßÄ ÏïäÏßÄÎßå ÎãπÏû•Ïùò Î¨∏Ï†úÎäî ÏïÑÎãàÎã§.",onCombatStart(e){e.player.block+=4,y(e,"Ïú†Î¨º[Î™¨Ïä§ÌÑ∞ Í∞ÄÏ£Ω Ìà¨Íµ¨]: Î∞©Ïñ¥ +4")}},relic_smoke_bomb:{id:"relic_smoke_bomb",dormantName:"ÏÜçÏù¥ ÎπÑÏñ¥ ÏûàÎäî ÌÉÑÌôò",dormantText:"ÌùîÎì§Î©¥ ÏûëÏùÄ ÏïåÍ∞±Ïù¥Í∞Ä Íµ¥Îü¨Îã§ÎãåÎã§. Ïó∞Í∏∞Í∞Ä Ï°∞Í∏àÏî© ÏÉåÎã§.",unlockHint:"Ï°∞Í±¥: Ìïú Î≤àÏóê 10 Ïù¥ÏÉÅÏùò üó°Ô∏è ÌîºÌï¥ 1Ìöå Î∞õÍ∏∞",art:"assets/relics/relic_smoke_bomb.png",unlock:e=>!!e.run.unlock?.tookBigHit10,name:"Ïó∞ÎßâÌÉÑ",text:"ÌôúÏÑ±Ìôî Ïãú Ïó∞Îßâ Ïπ¥Îìú(ÏÜåÏã§) 1Ïû• ÌöçÎìù",unlockFlavor:"ÎπÑÏÉÅ ÌÉàÏ∂ú!",onActivate(e){const t="smoke";e.uidSeq+=1;const n=String(e.uidSeq);e.cards[n]={uid:n,defId:t,zone:"deck",upgrade:0},e.deck.push(n),y(e,"Ïú†Î¨º[Ïó∞ÎßâÌÉÑ]: Ïó∞Îßâ Ïπ¥Îìú 1Ïû• ÌöçÎìù")}},relic_bone_compass:{id:"relic_bone_compass",dormantName:"Í∏∏ÏùÑ ÏûÉÎäî Î∞îÎäò",dormantText:"Î∞©Ìñ•ÏùÑ Í∞ÄÎ¶¨ÌÇ§ÏßÄ Î™ªÌïòÎäî Î∞îÎäòÏù¥ Ï£ºÎ®∏Îãà Î∞îÍπ•ÏúºÎ°ú ÎÇòÏò®Îã§.",unlockHint:"Ï°∞Í±¥: ÌÉêÌóò 5Ìöå",art:"assets/relics/relic_bone_compass.png",unlock:e=>{const t=e.run;return(Number(t.timeMove??e.run?.nodePickCount??0)||0)>=5},name:"ÎºàÍ∞Ä ÎßåÎì† ÎÇòÏπ®Î∞ò",text:"Ï†ÑÌà¨ ÏãúÏûë Ïãú üÉè ÎìúÎ°úÏö∞ +1",unlockFlavor:"Ïñ¥ÎîîÎ•º Í∞ÄÎ¶¨ÌÇ§Îäî Í≤ÉÏù¥ÏßÄ?",onCombatStart(e){e._combatStartExtraDraw=(e._combatStartExtraDraw??0)+1,y(e,"Ïú†Î¨º[ÎºàÍ∞Ä ÎßåÎì† ÎÇòÏπ®Î∞ò]: Ï†ÑÌà¨ ÏãúÏûë ÎìúÎ°úÏö∞ +1")}},relic_flesh_whetstone:{id:"relic_flesh_whetstone",dormantName:"Ïù¥Í∞Ä Îπ†ÏßÑ ÏπºÎÇ†",dormantText:"Ïñ¥ÎîîÏóê Ïì∞ÎùºÍ≥† ÏûàÎäîÏßÄ Î™®Î•¥Í≤†Îã§.",unlockHint:"Ï°∞Í±¥: Ï†Å Ï≤òÏπò 3Ìöå",art:"assets/relics/relic_flesh_whetstone.png",unlock:e=>(e.run.unlock?.kills??0)>=3,name:"ÏÜçÏÇ¥ÏùÑ Ï∞æÎäî Ïà´Îèå",text:"Ï†ÑÌà¨ÏóêÏÑú Ï≤´ Í≥µÍ≤©Ïù¥ Ï£ºÎäî üó°Ô∏è ÌîºÌï¥ +3",unlockFlavor:"Î∞§ÎßàÎã§ Î¨¥Ïñ∏Í∞Ä Í∞àÍ≥† ÏûàÎã§.",onCombatStart(e){e._firstPlayerAttackDoneThisCombat=!1},modifyDamage(e,t){if(t.phase!=="PRE_STATUS")return t.current;if(t.target==="ENEMY"&&t.source==="PLAYER_ATTACK"){const n=e;if(!n._firstPlayerAttackDoneThisCombat)return n._firstPlayerAttackDoneThisCombat=!0,t.current+3}return t.current}},relic_weak_bell:{id:"relic_weak_bell",dormantName:"ÏÉàÍπåÎßå Ï¢Ö",dormantText:"ÎßåÏßÄÎ©¥ ÏÜêÎÅùÏù¥ Î¨¥Í≤ÅÎã§. ÎãπÏû•Ïóî ÏïÑÎ¨¥ ÏùºÎèÑ ÏóÜÎã§.",unlockHint:"Ï°∞Í±¥: ü•Ä ÏïΩÌôîÎ•º Î∞õÏùÄ ÏÉÅÌÉúÎ°ú ÌÑ¥ Ï¢ÖÎ£å 1Ìöå",art:"assets/relics/relic_weak_bell.png",unlock:e=>!!e.run.unlock?.endedTurnWeak,name:"ÌóàÏïΩÏùò Ï¢ÖÏÜåÎ¶¨",text:"Ï†ÑÌà¨ ÏãúÏûë Ïãú Î™®Îì† Ï†ÅÏóêÍ≤å ü•Ä ÏïΩÌôî +2",unlockFlavor:"Ïô†ÏßÄ Îì§ÏúºÎ©¥ ÎßàÏùåÏù¥ ÌèâÏò®Ìï¥ÏßÑÎã§.",onCombatStart(e){const t=V(e);for(const n of t)ot(n,"weak",2,e,"SYSTEM");t.length&&y(e,"Ïú†Î¨º[ÌóàÏïΩÏùò Ï¢ÖÏÜåÎ¶¨]: Î™®Îì† Ï†Å ÏïΩÌôî +2")}},relic_return_path_memory:{id:"relic_return_path_memory",dormantName:"Ï∞¢Ïñ¥ÏßÑ ÏßÄÎèÑ Ï°∞Í∞Å",dormantText:"ÏùΩÏùÑ Ïàò ÏóÜÎäî Í∏∏Ïù¥ Í∑∏Î†§Ï†∏ ÏûàÎã§. Í∞ÄÎ≥¥Í≥† Ïã∂Îã§.",unlockHint:"Ï°∞Í±¥: Ïù¥Î≤§Ìä∏ 2Ìöå ÏÑ†ÌÉù",art:"assets/relics/relic_return_path_memory.png",unlock:e=>(e.run.unlock?.eventPicks??0)>=2,name:"ÎèåÏïÑÏò® Í∏∏Ïùò Í∏∞Ïñµ",text:"Ï†ÑÌà¨ ÏäπÎ¶¨ Ïãú HP +3",unlockFlavor:"ÏôîÍ∏∞Ïóê Í∞à Ïàò ÏóÜÎã§.",onVictory(e){at(e,3),y(e,"Ïú†Î¨º[ÎèåÏïÑÏò® Í∏∏Ïùò Í∏∞Ïñµ]: ÏäπÎ¶¨ ÌöåÎ≥µ +3")}},relic_wound_vial:{id:"relic_wound_vial",dormantName:"Î∞òÏù¥ÎÇò ÎÇ®ÏùÄ Î∂âÏùÄ Ïï°Ï≤¥",dormantText:"ÎßàÍ∞úÎ•º Ïó¥ÏßÄ ÏïäÏïòÎäîÎç∞ÎèÑ Ìîº ÎÉÑÏÉàÍ∞Ä ÎÇúÎã§.",unlockHint:"Ï°∞Í±¥: HPÍ∞Ä 15 Ïù¥ÌïòÎ°ú Îñ®Ïñ¥ÏßÑ Ï†Å 1Ìöå",art:"assets/relics/relic_wound_vial.png",unlock:e=>!!e.run.unlock?.hpLeq15,name:"ÏÉÅÏ≤òÎ°ú Í∏∞Ïñ¥Í∞ÄÎäî ÏïΩÎ≥ë",text:"Ï†ÑÌà¨ ÏãúÏûë Ïãú HP +3",unlockFlavor:"Ïî®ÏïóÏù¥ ÏûàÏóàÎÇò?",onCombatStart(e){at(e,3),y(e,"Ïú†Î¨º[ÏÉÅÏ≤òÎ°ú Í∏∞Ïñ¥Í∞ÄÎäî ÏïΩÎ≥ë]: Ï†ÑÌà¨ ÏãúÏûë ÌöåÎ≥µ +3")}},relic_counting_needle:{id:"relic_counting_needle",dormantName:"Î©àÏ∂ò Î∞îÎäò",dormantText:"ÏãúÍ≥ÑÏùºÍπå? ÏãúÍ≥ÑÍ∞Ä ÏïÑÎãêÍπå? Îëò Îã§ ÏïÑÎãàÎã§.",unlockHint:"Ï°∞Í±¥: ÏïÑÎ¨¥ ÌñâÎèôÎèÑ ÌïòÏßÄ ÏïäÍ≥† ÌÑ¥ Ï¢ÖÎ£å 1Ìöå",art:"assets/relics/relic_counting_needle.png",unlock:e=>!!e.run.unlock?.skippedTurn,name:"Ïà®ÏùÑ ÏÑ∏Îäî Î∞îÎäò",text:"ÌÑ¥ Ï¢ÖÎ£å Ïãú Îã§Ïùå ÌÑ¥ üÉè ÎìúÎ°úÏö∞ +1",unlockFlavor:"Î∞îÎäòÏù¥ ÎèàÎã§. ÏïÑÎ¨¥Í≤ÉÎèÑ ÏóÜÏù¥.",onUpkeepEnd(e){e._extraDrawNextTurn=Number(e._extraDrawNextTurn??0)+1,y(e,"Ïú†Î¨º[Ïà®ÏùÑ ÏÑ∏Îäî Î∞îÎäò]: Îã§Ïùå ÌÑ¥ ÎìúÎ°úÏö∞ +1")}},relic_deeper_needle:{id:"relic_deeper_needle",dormantName:"ÎºàÎ°ú ÎßåÎì† Î∞îÎäò",dormantText:"Îî∞ÎÅîÌï®Ïóê ÏùµÏàôÌïú ÏßÄ Ïò§ÎûòÎã§.",unlockHint:"Ï°∞Í±¥: Ï†ÅÏóêÍ≤å ü©∏ Ï∂úÌòà Î∂ÄÏó¨ 3Ìöå",art:"assets/relics/relic_deeper_needle.png",unlock:e=>(e.run.unlock?.bleedApplied??0)>=3,name:"Îçî ÍπäÏùÄ Î∞îÎäò",text:"ü©∏ Ï∂úÌòàÏùÑ Î∂ÄÏó¨Ìï† ÎïåÎßàÎã§ +1 Ï∂îÍ∞Ä",unlockFlavor:"Î∞îÎäòÏù¥ ÌîºÎ•º Î®πÍ≥† Í∏∏Ïñ¥ÏßÑ Í≤É Í∞ôÎã§.",onCombatStart(e){e._bleedBonusPerApply=1},onVictory(e){delete e._bleedBonusPerApply}},relic_broken_millstone:{id:"relic_broken_millstone",dormantName:"Í∏à Í∞Ñ Îß∑Îèå",dormantText:"Í∞àÍ≥† ÏûàÏúºÎ©¥ ÏãúÍ∞Ñ Í∞ÄÎäî Ï§Ñ Î™®Î•¥Í≤†Îã§.",unlockHint:"Ï°∞Í±¥: ÏãúÍ∞Ñ 10 ÌùòÎ†§Î≥¥ÎÇ¥Í∏∞",art:"assets/relics/relic_broken_millstone.png",unlock:e=>{const t=e.run,n=Number(t.timeMove??0)||0,r=Number(e.time??0)||0;return n+r>=10},name:"Íπ®ÏßÑ Îß∑Îèå",text:"Îß§ ÌÑ¥ Î™®Îì† Ï†ÅÏóêÍ≤å üó°Ô∏è 2 ÌîºÌï¥",unlockFlavor:"ÎèåÏù¥ Îã≥ÎäîÎã§. Ï†ÅÎèÑ Îã≥ÎäîÎã§.",onUpkeepEnd(e){const t=V(e);if(t?.length){for(const n of t){let r=2;const o=Number(n.block??0);if(o>0){const s=Math.min(o,r);n.block=o-s,r-=s}if(r>0){const s=Number(n.hp??0);n.hp=Math.max(0,s-r)}}y(e,"Ïú†Î¨º[Íπ®ÏßÑ Îß∑Îèå]: Î™®Îì† Ï†ÅÏóêÍ≤å 2 ÌîºÌï¥")}}},relic_bloody_spoon:{id:"relic_bloody_spoon",dormantName:"Î∂âÏùÄ ÏàüÍ∞ÄÎùΩ",dormantText:"Ïá† ÎÉÑÏÉàÍ∞Ä ÏßÑÌïòÎã§.",unlockHint:"Ï°∞Í±¥: üí§ F 10 Ïù¥ÏÉÅ",art:"assets/relics/relic_bloody_spoon.png",unlock:e=>e.player.fatigue>9,name:"Ìîº Î¨ªÏùÄ ÏàüÍ∞ÄÎùΩ",text:"ÌöåÎ≥µ Ïãú 1 Ï∂îÍ∞Ä ÌöåÎ≥µ",unlockFlavor:"Ïù¥Îü∞, ÌîºÏòÄÎã§."},relic_black_ledger_shard:{id:"relic_black_ledger_shard",dormantName:"Í≤ÄÎåï Î¨ªÏùÄ Ï¢ÖÏù¥",dormantText:"Í≤ÄÏùÄ Ï¢ÖÏù¥Îã§. ÌÉÄÍ≥† ÎÇ®ÏùÄ Ï°∞Í∞ÅÏùºÏßÄÎèÑ Î™®Î•¥Í≤†Îã§.",unlockHint:"Ï°∞Í±¥: üåæS = 0",art:"assets/relics/relic_black_ledger_shard.png",unlock:e=>e.player.supplies===0,name:"Í≤ÄÏùÄ Ïû•Î∂Ä Ï°∞Í∞Å",text:"üåæS = 0ÏúºÎ°ú ÌÑ¥ÏùÑ Ï¢ÖÎ£åÌïòÎ©¥, üåæS +2, üí§ F +1",unlockFlavor:"Ïû•Î∂Ä. Î¨¥ÏóáÏùò?",onUpkeepEnd(e){const t=V(e);if(t?.length){for(const n of t){let r=2;const o=Number(n.block??0);if(o>0){const s=Math.min(o,r);n.block=o-s,r-=s}if(r>0){const s=Number(n.hp??0);n.hp=Math.max(0,s-r)}}y(e,"Ïú†Î¨º[Í≤ÄÏùÄ Ïû•Î∂Ä Ï°∞Í∞Å]: S +2, F +1")}}},relic_ratskin_charm:{id:"relic_ratskin_charm",name:"Ï•êÍ∞ÄÏ£Ω Î∂ÄÏ†Å",text:"Ï∑®ÏïΩÏùÑ Î∞õÏùÑ Îïå 1 Îçú Î∞õÏäµÎãàÎã§.",unlockFlavor:"ÏÇ¥Í∞ÄÏ£Ω. ÏñáÍ≤å, ÏïÑÏ£º ÏñáÍ≤å.",tags:["EVENT_ONLY"],art:"assets/relics/relic_ratskin_charm.png"}};function ro(e,t){return(e.run?.relics??[]).includes(t)}const oo=new Set(no.map(e=>e.id));function so(e){return oo.has(e)}const ao={rest:0,eliteWins:0,tookBigHit10:!1,kills:0,endedTurnWeak:!1,eventPicks:0,hpLeq15:!1,skippedTurn:!1,bleedApplied:0};function _e(e){e.run.relics??=[];const t=e.run;t.relicRuntime??={},t.pendingRelicActivations??=[],t.unlock??={...ao},t.relicUnlocked??={}}function Jn(e){return _e(e),e.run.relicRuntime}function Zn(e){return _e(e),e.run.pendingRelicActivations}function ge(e){return _e(e),e.run.unlock}function dt(e,t){const n=Jn(e);if(n[t])return n[t];const o=!X[t]?.unlock;return n[t]={active:o,pending:!1,obtainedAtNode:e.run.nodePickCount},n[t]}function dn(e,t){return!!dt(e,t).active}function io(e,t){const n=e.run;return n.forceLockedRelics?.[t]===!0?!1:!!(n.forceUnlockedRelics?.[t]===!0||n.relicUnlocked?.[t]===!0||Array.isArray(n.unlockedRelics)&&n.unlockedRelics.includes(t)||n.unlockProgress?.relics?.[t]===!0||n.unlocks?.relics?.[t]===!0)}function Tt(e,t){_e(e);const n=X[t],r=n?.name??t,o=n?.text??"",s=n?.art,i=e.run.relicRuntime?.[t]??null,l=!!n?.unlock,c=io(e,t),h=i?.active===!0?"ACTIVE":i?.pending===!0?"PENDING":"DORMANT",u=(()=>{const d=n?.unlockFlavor;if(!d||l&&!c)return"";const x=typeof d=="function"?d(e):d;return x?`

${x}`:""})();if(h==="ACTIVE")return{id:t,state:h,name:r,text:`${o}${u}`,art:s};if(h==="PENDING")return l&&!c?{id:t,state:h,name:r,text:`${o}

(Îã§Ïùå ÎÖ∏ÎìúÎ∂ÄÌÑ∞ ÌôúÏÑ±)`,art:s}:{id:t,state:h,name:r,text:`${o}${u}`,art:s};if(l&&!c){const d=n?.dormantName??r,x=[];n?.dormantText&&x.push(n.dormantText),n?.unlockHint&&x.push(n.unlockHint);const $=x.length?x.join(`
`):o;return{id:t,state:h,name:d,text:$,art:s}}return{id:t,state:h,name:r,text:`${o}${u}`,art:s}}function gt(e,t,n="NORMAL"){if(_e(e),so(t)&&n!=="EVENT"){const a=X[t];y(e,`Ïù¥ Ïú†Î¨ºÏùÄ Ïù¥Î≤§Ìä∏Î°úÎßå ÌöçÎìùÌï† Ïàò ÏûàÏäµÎãàÎã§: ${a?.name??t}`);return}e.run.relics.includes(t)||e.run.relics.push(t);const r=X[t],o=dt(e,t);if(!r?.unlock){o.active=!0,o.pending=!1,e.run.relicUnlocked[t]=!0,y(e,`Ïú†Î¨º ÌöçÎìù: ${r?.name??t}`);return}o.active=!1;const s=Tt(e,t);y(e,`Ïú†Î¨º ÌöçÎìù: ${s.name}`),ye(e)}function lo(e,t){const n=dt(e,t);if(n.active||n.pending)return;n.pending=!0;const r=Zn(e);r.includes(t)||r.push(t);const o=X[t];y(e,`Ïú†Î¨º Ï°∞Í±¥ Îã¨ÏÑ±: ${o?.name??t} (Îã§Ïùå ÎÖ∏ÎìúÎ∂ÄÌÑ∞ ÌôúÏÑ±)`)}function ye(e){_e(e);for(const t of e.run.relics){const n=X[t];if(!n?.unlock)continue;const r=dt(e,t);r.active||r.pending||n.unlock(e)&&lo(e,t)}}function le(e){_e(e);const t=Zn(e);if(!t.length)return;e.run.pendingRelicActivations=[];const n=Jn(e);for(const r of t){const o=n[r]??dt(e,r);if(!o.pending)continue;o.pending=!1,o.active=!0,o.activatedAtNode=e.run.nodePickCount,e.run.relicUnlocked[r]=!0;const s=X[r];s?.onActivate?.(e),y(e,`Ïú†Î¨º ÌôúÏÑ±Ìôî: ${s?.name??r}`)}}function co(e){return _e(e),e.run.relics??[]}function un(e){return co(e).filter(t=>dn(e,t))}function ut(e,t,...n){for(const r of un(e)){const o=X[r];if(!o)continue;const s=o[t];s?.(e,...n)}}function Ee(e,t){let n=t.current;for(const r of un(e)){const s=X[r]?.modifyDamage;if(!s)continue;const a=s(e,{...t,current:n});n=Number.isFinite(a)?a:n,n<0&&(n=0)}return n}function er(e,t,n){for(const r of un(e))X[r]?.onDamageApplied?.(e,t,n)}function uo(e){return e<0?0:e}function po(e,t,n){const r=t.player.status?.vuln??0,o=n.status?.weak??0;return uo(e+r-o)}function fo(e,t){let n=Math.max(0,Number(t)||0);const r=[];for(const o of e){const s=Math.min(n,o);n-=s,r.push(o-s)}return r}function Fe(e,t){e.push(t)}function ho(e){const t=(e.dmgTotal??0)>0||(e.hits??0)>0||(e.perHit??0)>0,n=(e.applies??[]).some(o=>o.target==="player"&&["vuln","weak","bleed","disrupt","supplies","fatigue"].includes(String(o.kind))),r=(e.applies??[]).some(o=>o.target==="enemy"&&["vuln","weak","bleed","disrupt","immune"].includes(String(o.kind)));return t&&n?"ATTACK_DEBUFF":t&&r?"ATTACK_BUFF":t?"ATTACK":n?"DEBUFF":r?"BUFF":"OTHER"}function mo(e,t,n){const r=t.usedThisTurn??0;return e==="goblin_raider"?{raw:Math.max(0,12-r),hits:1}:e==="watching_statue"?{raw:4+r,hits:1}:e==="gloved_hunter"?{raw:Number(t.player.block??0)>=4?12:6,hits:1}:{raw:0,hits:1}}function bo(e,t){const n=Number(t.base??0),r=Number(t.per??0),o=Math.max(1,Number(t.div??1)),s=t.cap==null?1/0:Number(t.cap),a=(e.deck?.length??0)+(e.discard?.length??0)+(e.hand?.length??0),i=Math.floor(a/o),l=n+r*i;return Math.min(s,Math.max(0,l))}function tr(e,t,n,r={}){if(n.meta?.preview){const d=n.meta.preview(e,t);if(d)return d}const o=[],s=[],a=[];if(n.meta?.applies)for(const d of n.meta.applies)Fe(o,d);for(const d of n.acts)switch(d.op){case"damagePlayer":{a.push(Math.max(0,Number(d.n)||0));break}case"damagePlayerFormula":{const{raw:x,hits:$}=mo(d.kind,e),f=Math.max(1,Number($??1)||1),p=Math.max(0,Number(x)||0);for(let b=0;b<f;b++)a.push(p);break}case"statusPlayer":{Fe(o,{target:"player",kind:d.key,amount:d.n});break}case"supplies":{Fe(o,{target:"player",kind:"supplies",amount:d.n});break}case"fatiguePlayer":{Fe(o,{target:"player",kind:"fatigue",amount:d.n});break}case"enemyHealSelf":{Fe(o,{target:"enemy",kind:"heal",amount:d.n});break}case"enemyImmuneNextTurn":{Fe(o,{target:"enemy",kind:"immune",amount:1});break}case"damagePlayerRampHits":{const x=Math.max(1,Number(e.combatTurn??1)),$=Math.max(1,Number(d.baseHits??1)),f=Math.max(1,Number(d.everyTurns??1));let p=$+Math.floor((x-1)/f);d.capHits!=null&&(p=Math.min(p,Math.max(1,Number(d.capHits))));const b=Math.max(0,Number(d.n)||0);for(let g=0;g<p;g++)a.push(b);break}case"damagePlayerIfSuppliesPositive":{e.player.supplies>0&&a.push(Math.max(0,Number(d.n)||0));break}case"damagePlayerIfSuppliesZero":{e.player.supplies==0&&a.push(Math.max(0,Number(d.n)||0));break}case"damagePlayerByDeckSize":{a.push(bo(e,d));break}}if(!a.length){const d=Math.max(0,Number(n.meta?.hits??0)||0),x=Math.max(0,Number(n.meta?.baseDmg??0)||0);if(d>0&&x>0)for(let $=0;$<d;$++)a.push(x)}let i=a.map(d=>po(d,e,t));r.includeBlock&&i.length&&(i=fo(i,e.player.block??0));const l=i.length,c=l?i.reduce((d,x)=>d+x,0):void 0,h=l&&i.every(d=>d===i[0])?i[0]:void 0,u={cat:n.meta?.cat??"OTHER",dmgTotal:c,hits:l>0?l:n.meta?.hits,perHit:h??n.meta?.baseDmg,applies:o.length?o:void 0,notes:s.length?s:void 0};return u.cat=n.meta?.cat??ho(u),u.shortText||(u.dmgTotal!=null&&(u.hits??0)>1?u.shortText=`${u.dmgTotal} (${u.hits}ÌÉÄ)`:u.dmgTotal!=null&&(u.shortText=`${u.dmgTotal}`)),u}const yo={other_adventurer:new Set([1]),slime:new Set([0,1]),pebble_golem:new Set([1]),rock_golem:new Set([1]),poison_spider:new Set([0,2]),boss_cursed_wall:new Set([0]),boss_giant_orc:new Set([1])};function xo(e,t){const n=yo[e];return!!n&&n.has(t)}function Yt(e){if(e===null)return"null";const t=typeof e;return t==="number"||t==="boolean"?String(e):t==="string"?JSON.stringify(e):Array.isArray(e)?"["+e.map(Yt).join(",")+"]":t==="object"?"{"+Object.keys(e).sort().map(r=>JSON.stringify(r)+":"+Yt(e[r])).join(",")+"}":JSON.stringify(String(e))}function nr(e){if(!e)return"NONE";const t={};for(const n of Object.keys(e))n==="label"||n==="text"||n==="desc"||n==="name"||(t[n]=e[n]);return t.effects&&Array.isArray(t.effects)&&(t.effects=t.effects.map(n=>{const r={};for(const o of Object.keys(n??{}))o==="label"||o==="text"||o==="desc"||o==="name"||(r[o]=n[o]);return r})),Yt(t)}function ko(e,t){const n=e.lastIntentKey??null,r=e.lastIntentStreak??0;n===t?e.lastIntentStreak=Math.min(3,r+1):(e.lastIntentKey=t,e.lastIntentStreak=1)}function To(e,t,n,r,o){const s=e.length;if(s<=1)return 0;const a=Array.from({length:s},(d,x)=>x),i=d=>d===t&&xo(n,d),l=d=>!!r&&o>=2&&nr(e[d])===r,c=a.filter(d=>!i(d)&&!l(d));if(c.length>0)return oe(c);const h=a.filter(d=>!l(d));if(h.length>0)return oe(h);const u=a.filter(d=>!i(d));return u.length>0?oe(u):oe(a)}const go=2,Eo=.6;function pn(e){if(e.intentsRevealedThisTurn)return;e.intentsRevealedThisTurn=!0,e.attackedEnemyIndicesThisTurn=[],e.backUidsThisTurn=[],e.drawCountThisTurn=0,e.phase="REVEAL",e.player.immuneToDisruptThisTurn=!1,e.player.nullifyDamageThisTurn=!1,e.disruptIndexThisTurn=null,e.backSlotDisabled=[!1,!1,!1],(e.player.status.disrupt??0)>0&&(e.disruptIndexThisTurn=Math.floor(Math.random()*3),e.backSlotDisabled[e.disruptIndexThisTurn]=!0);for(const n of e.enemies)n.immuneThisTurn=n.immuneNextTurn,n.immuneNextTurn=!1;for(const n of V(e)){n.intentLabelOverride=void 0;const o=e.content.enemiesById[n.id].intents;if(!o||o.length===0)continue;const s=To(o,n.intentIndex??0,n.id,n.lastIntentKey??null,n.lastIntentStreak??0);n.intentIndex=s;const a=o[s%o.length];if(ko(n,nr(a)),n.id==="boss_soul_stealer"){n.soulWillNukeThisTurn=!1;const u=n.soulWarnCount??0;if(!!n.soulArmed){if(Math.random()<Eo){n.soulWillNukeThisTurn=!0,n.intentLabelOverride="Ï¢ÖÎßê: 50 ÌîºÌï¥",y(e,`Ï†Å ÏùòÎèÑ: ${n.name} ‚Üí ${n.intentLabelOverride}`);continue}const $=o[n.intentIndex%o.length];n.intentLabelOverride=`${$.label} (Ìè≠Î∞ú Í∞ÄÎä• ÏÉÅÌÉú)`,y(e,`Ï†Å ÏùòÎèÑ: ${n.name} ‚Üí ${n.intentLabelOverride}`);continue}const x=o[n.intentIndex%o.length];n.intentLabelOverride=`${x.label} (Í≤ΩÍ≥† ${u}/3)`,y(e,`Ï†Å ÏùòÎèÑ: ${n.name} ‚Üí ${n.intentLabelOverride}`);continue}const i=o[n.intentIndex%o.length],l=tr(e,n,i);let c="";l.dmgTotal!=null?c=(l.hits??1)>1?` (${l.dmgTotal}, ${l.hits}ÌÉÄ)`:` (${l.dmgTotal})`:(l.hits??0)>1&&(c=` (${l.hits}ÌÉÄ)`);const h=`${i.label}${c}`;n.intentLabelOverride=h,y(e,`Ï†Å ÏùòÎèÑ: ${n.name} ‚Üí ${h}`)}e.disruptIndexThisTurn!==null&&y(e,`ÍµêÎûÄ: Ïù¥Î≤à ÌÑ¥ ÌõÑÏó¥ ${e.disruptIndexThisTurn} Î¨¥Ìö®`),ut(e,"onReveal"),e.phase="PLACE"}const Co=go;function Ot(e,t,n){const r=e.game,o={kind:"damageSelect",amount:t,formulaKind:n,sourceCardUid:e.cardUid,reason:e.side==="front"?"FRONT":"BACK"};r.pendingTargetQueue??=[],r.pendingTarget==null?r.pendingTarget=o:r.pendingTargetQueue.push(o),y(r,`ÎåÄÏÉÅ ÏÑ†ÌÉù ÌïÑÏöî: Ï†ÅÏùÑ ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî. (${1+r.pendingTargetQueue.length}Í∞ú ÎÇ®Ïùå)`)}function vo(e,t,n){const r=e.game,o={kind:"statusSelect",key:t,n,sourceCardUid:e.cardUid,reason:e.side==="front"?"FRONT":"BACK"};r.pendingTargetQueue??=[],r.pendingTarget==null?r.pendingTarget=o:r.pendingTargetQueue.push(o),y(r,"ÎåÄÏÉÅ ÏÑ†ÌÉù ÌïÑÏöî: Ï†ÅÏùÑ ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî.")}function wo(e,t){if(t.id==="boss_soul_stealer"&&t.soulWillNukeThisTurn)return!0;const n=e.content.enemiesById[t.id];return n.intents[t.intentIndex%n.intents.length].acts.some(o=>o.op==="damagePlayer"||o.op==="damagePlayerFormula"||o.op==="damagePlayerByDeckSize")}function So(e,t){switch(t){case"prey_mark":return 7;case"prey_mark_u1":return 9;case"triple_bounty":return 8;case"triple_bounty_u1":return 10;default:return 0}}function $n(e,t,n,r){switch(t){case"prey_mark":return n.hp>e.player.hp?r+5:r;case"prey_mark_u1":return n.hp>e.player.hp?r+6:r;case"triple_bounty":return V(e).length>=3?r+8:r;case"triple_bounty_u1":return V(e).length>=3?r+10:r;default:return r}}function st(e,t){const n=e.game;for(const r of t)switch(r.op){case"block":ss(n,r.n);break;case"supplies":as(n,r.n);break;case"fatigue":Le(n,r.n);break;case"heal":at(n,r.n);break;case"hp":n.player.hp=Math.max(0,Math.min(n.player.maxHp,n.player.hp+r.n)),y(n,`HP ${r.n>=0?"+":""}${r.n} (ÌòÑÏû¨ ${n.player.hp}/${n.player.maxHp})`);break;case"maxHp":n.player.maxHp+=r.n,n.player.hp=Math.min(n.player.maxHp,n.player.hp+r.n),y(n,`ÏµúÎåÄ HP +${r.n} (ÌòÑÏû¨ ${n.player.hp}/${n.player.maxHp})`);break;case"setSupplies":n.player.supplies=Math.max(0,r.n),y(n,`Î≥¥Í∏â SÎ•º ${n.player.supplies}ÏúºÎ°ú ÏÑ§Ï†ï`);break;case"draw":{const o=Ct(n,r.n);n.drawCountThisTurn+=o;break}case"ifDrewThisTurn":{n.drawCountThisTurn>0&&st(e,r.then);break}case"damageEnemy":if(r.target==="random"){const o=V(n);if(o.length===0)break;Ne(n,oe(o),r.n)}else if(r.target==="all")for(const o of V(n))Ne(n,o,r.n);else Ot(e,r.n);break;case"clearStatusSelf":{const o=r.key;n.player.status[o]=0,y(n,`ÏÉÅÌÉú Ìï¥Ï†ú: ${o} = 0`);break}case"damageEnemyBy":{if(r.target!=="random")break;const o=V(n);if(o.length===0)break;let s=0;r.by==="frontCount"&&(s=n.frontSlots.filter(Boolean).length*r.nPer),Ne(n,oe(o),s);break}case"damageEnemyByPlayerFatigue":{const o=Math.max(0,Math.floor(n.player.fatigue*r.mult));if(r.target==="random"){const s=V(n);if(s.length===0)break;Ne(n,oe(s),o);break}if(r.target==="select"){if(o<=0)break;Ot(e,o);break}break}case"damageEnemyFormula":{const o=So(e,r.kind);if(o<=0)break;if(r.target==="select"){Ot(e,o,r.kind);break}if(r.target==="random"){const s=V(n);if(s.length===0)break;const a=oe(s),i=$n(n,r.kind,a,o);Ne(n,a,i);break}if(r.target==="all"){for(const s of V(n)){const a=$n(n,r.kind,s,o);Ne(n,s,a)}break}break}case"statusPlayer":n.player.status[r.key]=Math.max(0,(n.player.status[r.key]??0)+r.n),y(n,`ÌîåÎ†àÏù¥Ïñ¥ ÏÉÅÌÉú: ${r.key} ${r.n>=0?"+":""}${r.n}`);break;case"statusEnemy":if(r.target==="random"){const o=V(n);if(o.length===0)break;const s=oe(o);if(ot(s,r.key,r.n,n,"PLAYER"),y(n,`Ï†Å(${s.name}) ÏÉÅÌÉú: ${r.key} ${r.n>=0?"+":""}${r.n}`),r.key==="bleed"&&r.n>0){const a=ge(n);a.bleedApplied+=1,ye(n)}}else if(r.target==="all"){const o=V(n);if(o.length===0)break;for(const s of o)ot(s,r.key,r.n,n,"PLAYER");if(y(n,`Î™®Îì† Ï†Å ÏÉÅÌÉú: ${r.key} ${r.n>=0?"+":""}${r.n}`),r.key==="bleed"&&r.n>0){const s=ge(n);s.bleedApplied+=o.length,ye(n)}}else vo(e,r.key,r.n);break;case"statusEnemiesAttackingThisTurn":{const o=V(n).filter(s=>wo(n,s));if(o.length===0){y(n,`Ïù¥Î≤à ÌÑ¥ Í≥µÍ≤© ÏùòÎèÑ Ï†Å ÏóÜÏùå ‚Üí ${r.key} Ï†ÅÏö© ÏóÜÏùå`);break}for(const s of o)s.status[r.key]=Math.max(0,(s.status[r.key]??0)+r.n);y(n,`Í≥µÍ≤© ÏùòÎèÑ Ï†ÅÏóêÍ≤å ${r.key} ${r.n>=0?"+":""}${r.n} (ÎåÄÏÉÅ ${o.length})`);break}case"immuneDisruptThisTurn":n.player.immuneToDisruptThisTurn=!0,y(n,"Ïù¥Î≤à ÌÑ¥ ÍµêÎûÄ Î¨¥Ïãú");break;case"nullifyDamageThisTurn":n.player.nullifyDamageThisTurn=!0,y(n,"Ïù¥Î≤à ÌÑ¥ Ï†Å Í≥µÍ≤© ÌîºÌï¥ Î¨¥Ìö®");break;case"triggerFrontOfBackSlot":{const o=n.backSlots[r.index];if(!o){y(n,`Ïû¨Î∞∞Ïπò: ÌõÑÏó¥ ${r.index+1}Î≤à Ïä¨Î°ØÏù¥ ÎπÑÏñ¥ ÏûàÏùå`);break}const s=Ce(n,o);y(n,`Ïû¨Î∞∞Ïπò: [[${Ue(n,o)}]]Ïùò Ï†ÑÏó¥ Ìö®Í≥ºÎ•º Ï∂îÍ∞Ä Î∞úÎèô`),st({game:n,side:"front",cardUid:o},s.front);break}default:return r}}function _o(e){if(e.run.treasureObtained)return;e.run.treasureObtained=!0,e.run.afterTreasureNodePicks=0,e.run.deckSizeAtTreasure=dr(e);const t=ar(e);e.cards[t]={uid:t,defId:"goal_treasure",zone:"deck",upgrade:0},e.deck.push(t),e.deck=cn(e.deck),y(e,"Ï†ÄÏ£ºÎ∞õÏùÄ Î≥¥Î¨ºÏùÑ ÌöçÎìùÌñàÏäµÎãàÎã§! Îç±Ïóê [Ï†ÄÏ£ºÎ∞õÏùÄ Î≥¥Î¨º] Ï∂îÍ∞Ä"),$o(e),y(e,"Î≥¥Î¨ºÏù¥ Ïö∏Î∂ÄÏßñÏûê, ÎçòÏ†ÑÏùò Î™®Îì† Î∞©Ïù¥ Îã§Ïãú Ï±ÑÏõåÏßëÎãàÎã§...")}function $o(e){const t=e.run?.map;if(!t||!t.nodes)return;const n=t.startId,r=t.treasureId,o=Object.keys(t.nodes);for(const s of o){if(s===n||s===r)continue;const a=t.nodes[s];if(!a)continue;a.cleared=!1,delete a.noRespawn,delete a.lastClearedMove,a.reprocCount=Number(a.reprocCount??0)+1;const i=Number(a.depth??0);if(a.kind==="ELITE"||a.kind==="START"||a.kind==="TREASURE")continue;const l=Math.min(.88,.72+i*.01),c=.18,h=Math.random();a.kind=h<l?"BATTLE":h<l+c?"EVENT":"REST"}}const Mo=["arrow","shield","scout","field_ration"],nt=[{id:"mad_echo",weight:12},{id:"mad_insight",weight:12},{id:"mad_bargain",weight:3}],Qe=[{id:"berserk",weight:20},{id:"bandage",weight:12},{id:"arrow_rain",weight:20},{id:"smoke",weight:0},{id:"redeploy",weight:12},{id:"secret_strike",weight:3},{id:"fire_scroll",weight:3},{id:"caltrops",weight:12},{id:"emergency_rations",weight:3},{id:"painkiller",weight:12},{id:"field_experience",weight:3},{id:"camp_prep",weight:20},{id:"vital_shot",weight:12},{id:"taunt",weight:12},{id:"rapid_fire",weight:20},{id:"blood_contract",weight:20},{id:"cloth_scrap_armor",weight:12},{id:"prey_mark",weight:12},{id:"brawl_cleaver",weight:20}];function ht(e,t,n){const r=n?or(t,n):rr(t);return{defId:Gt(r),upgrade:t===nt?0:Xt(e)}}function mt(e,t,n){const r=n?or(t,n):rr(t),o=Gt(r),s=r.filter(h=>h.id!==o),a=Gt(s),i=t===nt,l=i?0:Xt(e),c=i?0:Xt(e);return[{defId:o,upgrade:l},{defId:a,upgrade:c}]}function No(e){const{tier:t}=Xn(e);return Math.random()<(t===0?0:t===1?.15:t===2?.35:.6)}function rr(e){const t=new Map;for(const n of e){const r=Math.max(0,n.weight??0);r<=0||t.set(n.id,(t.get(n.id)??0)+r)}return[...t.entries()].map(([n,r])=>({id:n,w:r}))}function or(e,t={}){const n=t.mult3??1,r=t.mult12??1,o=t.mult20??1,s=new Map;for(const a of e){const i=Math.max(0,a.weight??0);if(i<=0||i===3&&t.drop3||i===12&&t.drop12||i===20&&t.drop20)continue;let l=null;i===3?l=i*n:i===12?l=i*r:i===20?l=i*o:l=i,!(l<=0)&&s.set(a.id,(s.get(a.id)??0)+l)}return[...s.entries()].map(([a,i])=>({id:a,w:i}))}function Gt(e){let t=0;for(const r of e)t+=r.w;if(t<=0)throw new Error("No positive weights to pick from.");let n=Math.random()*t;for(const r of e)if(n-=r.w,n<=0)return r.id;return e[e.length-1].id}function Xt(e){const t=e?.player?.fatigue??0;if((e?.run.nodePickCount??999)<=6)return 0;const r=.1,o=t>=12?0:t>=9?.25:t>=6?.5:1;return Math.random()<r*o?1:0}function sr(e){const t=e.player?.fatigue??0,n={defId:oe(Mo),upgrade:0},r=()=>t<=3?mt(e,Qe):t<=6?mt(e,Qe,{mult3:.25,mult12:.75,mult20:1}):t<=8?mt(e,Qe,{mult3:.1,mult12:.55,mult20:1}):mt(e,Qe,{drop3:!0,mult12:.45,mult20:1}),o=i=>No(e)?ht(e,nt):i;if(t<=8){if(t<=6){const[h,u]=r();return[o(h),o(u)]}const i=t===7?.3:.55;if(Math.random()<i){const[h]=r(),u=o(h);return Math.random()<.5?[n,u]:[u,n]}const[l,c]=r();return[o(l),o(c)]}if(t<=11){const i=o(ht(e,Qe,{drop3:!0,mult12:.45,mult20:1}));return Math.random()<.5?[n,i]:[i,n]}const s=ht(e,nt),a=Math.random()<.65?ht(e,nt):n;return Math.random()<.5?[s,a]:[a,s]}function Po(e){const t=sr(e),n=t[0]??{defId:"arrow",upgrade:0},r=t[1]??{defId:"shield",upgrade:0};return[n,r]}function ar(e){return e.uidSeq+=1,`c_${e.uidSeq}`}function fn(e,t,n){const r=ar(e);e.cards[r]={uid:r,defId:t,zone:"deck",upgrade:n?.upgrade??0},e.deck.push(r)}function Ao(e){const t=Object.values(e.cards).filter(r=>r.zone==="deck"||r.zone==="hand"||r.zone==="discard");if(t.length===0)return;const n=oe(t);e.cards[n.uid].zone="vanished",e.vanished.push(n.uid),e.deck=e.deck.filter(r=>r!==n.uid),e.hand=e.hand.filter(r=>r!==n.uid),e.discard=e.discard.filter(r=>r!==n.uid),y(e,`Ïπ¥Îìú Ï†úÍ±∞: [${Ce(e,n.uid).name} +${e.cards[n.uid].upgrade??0}]`)}const Ro="goal_treasure";function Pt(e,t){const n=e.cards[t];return n?n.defId===Ro?(y(e,"Ï†ÄÏ£ºÎ∞õÏùÄ Î≥¥Î¨ºÏùÄ Îç±ÏóêÏÑú Ï†úÍ±∞Ìï† Ïàò ÏóÜÏäµÎãàÎã§."),!1):(e.deck=e.deck.filter(r=>r!==t),e.hand=e.hand.filter(r=>r!==t),e.discard=e.discard.filter(r=>r!==t),e.frontSlots=e.frontSlots.map(r=>r===t?null:r),e.backSlots=e.backSlots.map(r=>r===t?null:r),n.zone="vanished",e.vanished.push(t),y(e,`Ïπ¥Îìú Ï†úÍ±∞: [${Ce(e,n.uid).name} +${e.cards[n.uid].upgrade??0}]`),!0):!1}function At(e,t){const n=e.cards[t];if(!n)return!1;const o=e.content.cardsById[n.defId].upgrades?.length??0;return(n.upgrade??0)<o}function ir(e,t){return At(e,t)?(e.cards[t].upgrade=(e.cards[t].upgrade??0)+1,!0):!1}function hn(e,t,n=null){if(e.choiceQueue??=[],!e.choice){e.choice=t,e.choiceCtx=n;return}e.choiceQueue.push({choice:t,ctx:n})}function Et(e,t,n=null){e.choiceQueue=[],e.choice=t,e.choiceCtx=n}function lr(e){e.choice=null,e.choiceCtx=null}function he(e){e.choiceQueue=[],lr(e),e.phase==="NODE"&&le(e)}function Me(e){const t=e.choiceQueue??[];if(t.length>0){const n=t.shift()??null;if(n){e.choice=n.choice,e.choiceCtx=n.ctx,e.choiceQueue=t;return}}lr(e),e.phase==="NODE"&&le(e)}function Io(e){const t=new Set(e.run.relics??[]);return Object.keys(X).filter(n=>{const r=X[n];return!(!r||r.debugOnly||t.has(n))})}function cr(e,t=1){const n=Io(e);if(n.length===0)return null;const r=[],o=n.slice(),s=Math.min(t,o.length);for(let a=0;a<s;a++){const i=oe(o),l=o.indexOf(i);l>=0&&o.splice(l,1);const c=X[i]??{};r.push({id:i,name:c.name??String(i),desc:c.desc??c.description??c.text,art:c.art})}return{choices:r}}function Lo(e){const t=Po(e);if(!t)return;const[n,r]=t,o=be(e.content,n.defId,n.upgrade),s=be(e.content,r.defId,r.upgrade),a=`${o.name}${n.upgrade>0?` +${n.upgrade}`:""}`,i=`${s.name}${r.upgrade>0?` +${r.upgrade}`:""}`,l={kind:"REWARD",title:"Ï†ÑÌà¨ Î≥¥ÏÉÅ",prompt:"Ïπ¥Îìú 1Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÍ±∞ÎÇò ÏÉùÎûµÌï©ÎãàÎã§.",options:[{key:`pick:${n.defId}:${n.upgrade}`,label:a,detail:`Ï†ÑÏó¥: ${o.frontText} / ÌõÑÏó¥: ${o.backText}`},{key:`pick:${r.defId}:${r.upgrade}`,label:i,detail:`Ï†ÑÏó¥: ${s.frontText} / ÌõÑÏó¥: ${s.backText}`},{key:"skip",label:"ÏÉùÎûµ",detail:""}]};hn(e,l,{kind:"BATTLE_CARD_REWARD",offers:[n,r]})}function Ho(e){if(!e.run.lastBattleWasElite||e.run.eliteRelicOfferedThisBattle)return;const t=cr(e,1);if(!t)return;e.run.eliteRelicOfferedThisBattle=!0;const n=t.choices[0];if(!n)return;const r=n.id,o=X[r],s=!!o?.unlock,a=s?o?.dormantName??o?.name??r:o?.name??r,i=s?[o?.dormantText,o?.unlockHint].filter(Boolean).join(`
`):o?.text??"",c={kind:"REWARD",title:"Ï†ïÏòà Î≥¥ÏÉÅ: Ïú†Î¨º",prompt:"Ïú†Î¨ºÏùÑ Î∞õÍ±∞ÎÇò ÏÉùÎûµÌï©ÎãàÎã§.",options:[{key:"take",label:"Î∞õÍ∏∞",detail:`${a}

${i}`},{key:"skip",label:"ÏÉùÎûµ",detail:""}]};c.art=o?.art??void 0,hn(e,c,{kind:"ELITE_RELIC",offerIds:[r]})}function Do(e,t){if(!e.choice)return!1;if(t==="take"){if(e.choiceCtx?.kind!=="ELITE_RELIC")return!1;const r=e.choiceCtx.offerIds?.[0];return r?(e.run.relics??=[],e.run.relics.includes(r)||gt(e,r),y(e,`Ïú†Î¨º ÌöçÎìù: ${X[r]?.name??r}`),Me(e),!0):!1}if(t==="skip")return y(e,"Î≥¥ÏÉÅÏùÑ ÏÉùÎûµÌñàÏäµÎãàÎã§."),Me(e),!0;if(t.startsWith("pick:")){const r=t.split(":"),o=r[1]??"",s=Number(r[2]??0);return o?(fn(e,o,{upgrade:Number.isFinite(s)?s:0}),y(e,`Ïπ¥Îìú ÌöçÎìù: ${o}${s>0?` +${s}`:""}`),Me(e),!0):!1}if(t.startsWith("up:")){const r=t.slice(3);if(!r)return!1;const o=e.cards[r];if(!o)return!1;const a=e.content.cardsById[o.defId]?.upgrades??[],i=o.upgrade??0;if(i>=a.length)return y(e,"Ïù¥ÎØ∏ ÏµúÎåÄ Í∞ïÌôîÏûÖÎãàÎã§."),Me(e),!0;o.upgrade=i+1;const l=be(e.content,o.defId,o.upgrade);return y(e,`Ïπ¥Îìú Í∞ïÌôî: ${l.name} +${o.upgrade}`),Me(e),!0}if(t.startsWith("remove:")){const r=t.slice(7);return!r||!Pt(e,r)?!1:(Me(e),!0)}if(t.startsWith("relic:")){const r=t.slice(6);if(!r)return!1;const o=e.choiceCtx?.offerIds;return o&&o.length>0&&!o.includes(r)?!1:(e.run.relics??=[],e.run.relics.includes(r)||gt(e,r),y(e,`Ïú†Î¨º ÌöçÎìù: ${X[r]?.name??r}`),Me(e),!0)}return!1}function Oo(e,t){const n=cr(e,t.count);if(!n||n.choices.length===0)return null;const r=n.choices.map(a=>a.id),o=n.choices.map(a=>{const i=X[a.id],l=!!i?.unlock,c=l?i?.dormantName??i?.name??a.id:i?.name??a.id,h=l?[i?.dormantText,i?.unlockHint].filter(Boolean).join(`
`):i?.text??"";return{key:`relic:${a.id}`,label:c,detail:`${c}

${h}`}}),s={kind:"REWARD",title:t.title,prompt:t.prompt,options:o};{const a=String(t.artKeyOrPath),i=a.includes("/")||a.includes("\\")||a.includes(".")?a:`assets/ui/${a}.png`;s.art=i}return hn(e,s,{kind:"RELIC_OFFER",offerIds:r,source:t.source}),r}function Bo(e){return Oo(e,{count:3,title:"Î≥¥Ïä§ Î≥¥ÏÉÅ: Ïú†Î¨º",prompt:"Ïú†Î¨º 1Í∞úÎ•º ÏÑ†ÌÉùÌï©ÎãàÎã§.",source:"BOSS",artKeyOrPath:"what_to_do"})}function Fo(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}function Wo(e){const t=[];for(const s of e.deck)t.push(s);for(const s of e.hand)t.push(s);for(const s of e.discard)t.push(s);for(const s of e.frontSlots)s&&t.push(s);for(const s of e.backSlots)s&&t.push(s);for(const s of e.exhausted)t.push(s);const n=new Set,o=t.filter(s=>n.has(s)?!1:(n.add(s),!0)).filter(s=>e.cards[s]?.zone!=="vanished");e.deck=o;for(const s of o)e.cards[s].zone="deck";e.hand=[],e.discard=[],e.frontSlots=[null,null,null],e.backSlots=[null,null,null],e.selectedHandCardUid=null,e.exhausted=[],e.pendingTarget=null,e.pendingTargetQueue=[],Fo(e.deck)}function Uo(e){if(!e.winHooksAppliedThisCombat){e.winHooksAppliedThisCombat=!0;for(const t of e.backUidsThisTurn){if(!e.cards[t])continue;const o=Ce(e,t).onWinWhileInBack;!o||o.length===0||st({game:e,side:"back",cardUid:t},o)}}}function Ko(e){const t=e.run.deckSizeAtTreasure??null;return t==null?10:Zr(t)}function Ye(e){if(e.player.hp<=0){Rn(e),e.run.finished=!0,y(e,"Ìå®Î∞∞: Ï£ΩÏóàÏäµÎãàÎã§.");return}if(!e.victoryResolvedThisCombat&&V(e).length===0&&e.phase!=="NODE"){e.victoryResolvedThisCombat=!0;const t=e.enemies.some(n=>String(n.id).startsWith("boss_"));Rn(e),Uo(e),y(e,"Ï†ÅÏùÑ Î™®Îëê Ï≤òÏπò!");{const n=e.run.map;n&&n.nodes&&n.pos&&n.nodes[n.pos]&&(n.nodes[n.pos].cleared=!0,n.nodes[n.pos].visited=!0)}if(e.run.lastBattleWasElite){const n=ge(e);n.eliteWins+=1,ye(e)}Wo(e),e.enemies=[],e.player.zeroSupplyTurns=0;{const n=e.run,r=n.pendingEventWinRelicId;r&&(n.pendingEventWinRelicId=null,gt(e,r,"EVENT"))}if(ut(e,"onVictory"),t&&(e.run.ominousProphecyLockedUntilBossKill=!1,e.run.ominousProphecySeen=!1,e.player.hp=e.player.maxHp,y(e,"Î≥¥Ïä§ Í≤©Ìåå! Ï≤¥Î†•Ïù¥ ÏôÑÏ†ÑÌûà ÌöåÎ≥µÎêòÏóàÏäµÎãàÎã§."),Bo(e)),Ho(e),Lo(e),e.phase="NODE",e.run.treasureObtained){const n=Ko(e);if(e.run.afterTreasureNodePicks>=n){e.run.finished=!0,y(e,`ÏäπÎ¶¨! Ï†ÄÏ£ºÎ∞õÏùÄ Î≥¥Î¨ºÏùÑ ÏñªÏùÄ ÌõÑ ${n}Î≤àÏùò ÌÉêÌóò ÎèôÏïà ÏÇ¥ÏïÑÎÇ®ÏïòÏäµÎãàÎã§.`);return}}return}}function dr(e){return e.deck.length+e.hand.length+e.discard.length+e.frontSlots.filter(Boolean).length+e.backSlots.filter(Boolean).length+e.exhausted.length}function Je(e){e.combatTurn=1,e.time=(e.time??0)+1,y(e,"Ï†ÑÌà¨: ÏãúÍ∞Ñ +1"),e.player.block=0,e.player.status.vuln=0,e.player.status.weak=0,e.player.status.bleed=0,e.player.status.disrupt=0,e.player.zeroSupplyTurns=0,e.phase="REVEAL",e.frontSlots=[null,null,null],e.backSlots=[null,null,null],e.backSlotDisabled=[!1,!1,!1],e.backUidsThisTurn=[],e.hand=[],e.selectedHandCardUid=null,e.pendingTarget=null,e.pendingTargetQueue=[],e.usedThisTurn=0,e.frontPlacedThisTurn=0,e.winHooksAppliedThisCombat=!1,e.victoryResolvedThisCombat=!1,e.run.eliteRelicOfferedThisBattle=!1;const t=e.run.nextBattleSuppliesBonus??0;e.player.supplies=7+t,t!==0&&(y(e,`Îã§Ïùå Ï†ÑÌà¨ S Î≥ÄÎèô: ${t}`),e.run.nextBattleSuppliesBonus=0),e.player.immuneToDisruptThisTurn=!1,e.player.nullifyDamageThisTurn=!1,e.intentsRevealedThisTurn=!1,e.disruptIndexThisTurn=null,e.drawCountThisTurn=0,e.attackedEnemyIndicesThisTurn=[],Ct(e,4),pn(e),e.phase="PLACE",ut(e,"onCombatStart");{const n=Number(e._combatStartExtraDraw??0);e._combatStartExtraDraw=0,n>0&&Ct(e,n)}}function Mn(e,t,n,r){if(e.phase!=="PLACE"||!e.hand.includes(t))return;n==="back"&&(e.backUidsThisTurn.includes(t)||e.backUidsThisTurn.push(t));const o=n==="front"?e.frontSlots:e.backSlots;o[r]||(e.hand=e.hand.filter(s=>s!==t),o[r]=t,e.cards[t].zone=n,e.usedThisTurn+=1,n==="front"&&(e.frontPlacedThisTurn+=1),y(e,`[${Ue(e,t)}]Î•º ${n==="front"?"Ï†ÑÏó¥":"ÌõÑÏó¥"} ${r}Î≤àÏóê Î∞∞Ïπò`),ut(e,"onPlaceCard",{side:n,idx:r,cardUid:t}))}function Nn(e,t,n){return Ce(e,t).tags?.includes(n)??!1}function zo(e,t){e.frontSlots=e.frontSlots.map(n=>n===t?null:n),e.backSlots=e.backSlots.map(n=>n===t?null:n)}function Pn(e,t,n){const r=Ce(e,t);zo(e,t),e.hand=e.hand.filter(l=>l!==t),e.deck=e.deck.filter(l=>l!==t),e.discard=e.discard.filter(l=>l!==t);const o=r.vanishWhen,s=r.exhaustWhen,a=o==="BOTH"||o==="FRONT"&&n==="front"||o==="BACK"&&n==="back",i=s==="BOTH"||s==="FRONT"&&n==="front"||s==="BACK"&&n==="back";if(o&&o!=="NONE"&&a){e.vanished.push(t),e.cards[t].zone="vanished",y(e,`[${Ue(e,t)}] ÏÜåÏã§(ÏòÅÍµ¨ Ï†úÍ±∞)`);return}if(s&&s!=="NONE"&&i){e.exhausted.push(t),e.cards[t].zone="exhausted",y(e,`[${Ue(e,t)}] ÏÜåÎ™®(Ïù¥Î≤à Ï†ÑÌà¨ÏóêÏÑú Ï†úÍ±∞)`);return}if(!o&&Nn(e,t,"VANISH")){e.vanished.push(t),e.cards[t].zone="vanished",y(e,`[${Ue(e,t)}] ÏÜåÏã§(ÏòÅÍµ¨ Ï†úÍ±∞)`);return}if(!s&&Nn(e,t,"EXHAUST")){e.exhausted.push(t),e.cards[t].zone="exhausted",y(e,`[${Ue(e,t)}] ÏÜåÎ™®(Ïù¥Î≤à Ï†ÑÌà¨ÏóêÏÑú Ï†úÍ±∞)`);return}e.discard.push(t),e.cards[t].zone="discard"}function jo(e){for(let t=0;t<3;t++){const n=e.frontSlots[t];n&&Pn(e,n,"front"),e.frontSlots[t]=null;const r=e.backSlots[t];r&&Pn(e,r,"back"),e.backSlots[t]=null}}function qo(e){if(!(e.phase!=="PLACE"&&e.phase!=="BACK")){e.phase="BACK",y(e,"=== ÌõÑÏó¥ Îã®Í≥Ñ ===");for(let t=0;t<3;t++){const n=e.backSlots[t];if(!n)continue;const r=Ce(e,n);if(!e.player.immuneToDisruptThisTurn&&e.backSlotDisabled[t]){y(e,`ÌõÑÏó¥ ${t}Î≤à [${r.name}] ÍµêÎûÄÏúºÎ°ú Î¨¥Ìö®`);continue}st({game:e,side:"back",cardUid:n},r.back)}e.phase="FRONT"}}function Vo(e){if(e.phase==="FRONT"){y(e,"=== Ï†ÑÏó¥ Îã®Í≥Ñ ===");for(let t=0;t<3;t++){const n=e.frontSlots[t];if(!n)continue;const r=Ce(e,n);st({game:e,side:"front",cardUid:n},r.front)}e.phase="ENEMY"}}const Yo=.6;function Go(e){if(e.phase==="ENEMY"){y(e,"=== Ï†Å ÌñâÎèô ===");for(const t of V(e)){const n=e.content.enemiesById[t.id],r=n.intents[t.intentIndex%n.intents.length];if(t.id==="boss_soul_stealer"){if(t.soulWillNukeThisTurn){const o=t.status.weak??0;fe(e,50,"ENEMY_ATTACK","ÏòÅÌòº Í∞ïÌÉàÏûê",o),y(e,"ÏòÅÌòº Í∞ïÌÉàÏûê: ÏòÅÌòº Ìè≠Î∞ú ‚Üí 50 ÌîºÌï¥!"),t.soulWillNukeThisTurn=!1,t.soulArmed=!1,t.soulWarnCount=0;continue}for(const o of r.acts)An(e,t,o);t.intentIndex===Co&&(t.soulWarnCount=(t.soulWarnCount??0)+1,y(e,`ÏòÅÌòº Í∞ïÌÉàÏûê: Í≤ΩÍ≥† +1 (${t.soulWarnCount}/3)`),(t.soulWarnCount??0)>=3&&(t.soulArmed=!0,y(e,"ÏòÅÌòº Í∞ïÌÉàÏûê: Í≤ΩÍ≥† 3Ìöå ÏôÑÎ£å ‚Üí Ìè≠Î∞ú Í∞ÄÎä• ÏÉÅÌÉú!"),Math.random()<Yo&&(t.soulWillNukeThisTurn=!0)));continue}for(const o of r.acts)An(e,t,o)}e.phase="UPKEEP"}}function Xo(e){return e.deck.length+e.hand.length+e.discard.length+e.frontSlots.filter(Boolean).length+e.backSlots.filter(Boolean).length+e.exhausted.length}function Qo(e,t){const n=Math.ceil(t/e.div);let r=e.base+e.per*n;return e.cap!=null&&(r=Math.min(r,e.cap)),{dmg:r,scale:n}}function An(e,t,n){switch(n.op){case"damagePlayer":{const r=t.status.weak??0;fe(e,n.n,"ENEMY_ATTACK",t.name,r);return}case"damagePlayerFormula":{if(n.kind==="goblin_raider"){const r=Math.max(0,12-e.usedThisTurn),o=t.status.weak??0;fe(e,r,"ENEMY_ATTACK",t.name,o)}else if(n.kind==="gloved_hunter"){const o=(e.player.block??0)>=4?12:6,s=t.status.weak??0;fe(e,o,"ENEMY_ATTACK",t.name,s)}else{const r=4+e.usedThisTurn,o=t.status.weak??0;fe(e,r,"ENEMY_ATTACK",t.name,o)}return}case"supplies":{e.player.supplies=ln(e.player.supplies+n.n,0),y(e,`Ï†Å Ìö®Í≥º: Î≥¥Í∏â S ${n.n>=0?"+":""}${n.n} (ÌòÑÏû¨ ${e.player.supplies})`);return}case"statusPlayer":{let r=n.n;n.key==="vuln"&&r>0&&dn(e,"relic_ratskin_charm")&&(r=Math.max(0,r-1)),ot(e.player,n.key,r,e,"ENEMY"),y(e,`Ï†Å Ìö®Í≥º: ÌîåÎ†àÏù¥Ïñ¥ ÏÉÅÌÉú ${n.key} ${r>=0?"+":""}${r}`);return}case"enemyHealSelf":{t.hp=Math.min(t.maxHp,t.hp+n.n),y(e,`Ï†Å(${t.name})Ïù¥(Í∞Ä) ${n.n} ÌöåÎ≥µ (HP ${t.hp}/${t.maxHp})`);return}case"enemyImmuneThisTurn":{t.immuneThisTurn=!0,y(e,`Ï†Å(${t.name})Ïù¥(Í∞Ä) ÌîºÌï¥ Î©¥Ïó≠ ÏÉÅÌÉúÍ∞Ä Îê®`);return}case"enemyImmuneNextTurn":{t.immuneNextTurn=!0,y(e,`Ï†Å(${t.name})Ïù¥(Í∞Ä) Îã§Ïùå ÌÑ¥ ÌîºÌï¥ Î©¥Ïó≠ ÏÉÅÌÉúÍ∞Ä Îê®`);return}case"fatiguePlayer":{e.player.fatigue=Math.max(0,e.player.fatigue+n.n),y(e,`Ï†Å Ìö®Í≥º: ÌîºÎ°ú F ${n.n>=0?"+":""}${n.n} (ÌòÑÏû¨ ${e.player.fatigue})`);return}case"damagePlayerByDeckSize":{const r=Xo(e),{dmg:o,scale:s}=Qo(n,r),a=t.status.weak??0;fe(e,o,"ENEMY_ATTACK",t.name,a),y(e,`Ï§ëÎ†• ÌîºÌï¥: base ${n.base} + per ${n.per} * ceil(${r}/${n.div})=${s} => ${o}`);return}case"damagePlayerRampHits":{const r=Math.max(1,Number(e.combatTurn??1)),o=Math.max(1,Number(n.baseHits??1)),s=Math.max(1,Number(n.everyTurns??1));let a=o+Math.floor((r-1)/s);n.capHits!=null&&(a=Math.min(a,Math.max(1,Number(n.capHits))));const i=t.status.weak??0,l=`${t.name} (${a}ÌÉÄ)`;for(let c=0;c<a;c++)fe(e,n.n,"ENEMY_ATTACK",l,i);return}case"damagePlayerIfSuppliesPositive":{if((e.player.supplies??0)>0){const o=t.status.weak??0;fe(e,n.n,"ENEMY_ATTACK",t.name,o)}else y(e,"ÎçÆÏπòÍ∏∞: S = 0 ‚Üí ÌîºÌï¥ ÏóÜÏùå");break}case"damagePlayerIfSuppliesZero":{const r=e.player.supplies??0;if(r===0){const o=t.status.weak??0;fe(e,n.n,"ENEMY_ATTACK",t.name,o)}else y(e,`ÏïïÎ•ò: S = ${r} ‚Üí ÌîºÌï¥ ÏóÜÏùå`);break}default:return n}}function Jo(e){if(e.phase!=="UPKEEP")return;y(e,"=== Ïú†ÏßÄÎπÑ / ÏÉÅÌÉú Ï≤òÎ¶¨ ===");{const o=ge(e);let s=!1;(e.player.status.weak??0)>0&&!o.endedTurnWeak&&(o.endedTurnWeak=!0,s=!0),(e.usedThisTurn??0)===0&&(e.frontPlacedThisTurn??0)===0&&(e.backUidsThisTurn?.length??0)===0&&!o.skippedTurn&&(o.skippedTurn=!0,s=!0),s&&ye(e)}const t=e.frontPlacedThisTurn;t>0&&y(e,`Ï†ÑÏó¥ Ïú†ÏßÄÎπÑ Ï≤òÎ¶¨: Ï†ÑÏó¥ ${t}Ïû•`);let n=!1;for(let o=0;o<t;o++)e.player.supplies>0?e.player.supplies-=1:n=!0;if(n&&(e.player.fatigue+=1,y(e,"Ï†ÑÏó¥ Ïú†ÏßÄÎπÑ Î∂ÄÏ°±! (F +1)")),e.player.supplies===0){e.player.zeroSupplyTurns+=1;const o=e.player.fatigue;fe(e,o,"ZERO_SUPPLY",`Î≥¥Í∏â ÏóÜÏù¥ ÌÑ¥ Ï¢ÖÎ£å! ÌîºÌï¥ ${o}`)}const r=e.player.status.bleed??0;r>0&&fe(e,r,"BLEED","Ï∂úÌòà");for(const o of V(e)){const s=o.status.bleed??0;s>0&&(o.immuneThisTurn?y(e,`Ï†Å(${o.name})ÏùÄ(Îäî) Ïù¥Î≤à ÌÑ¥ Î©¥Ïó≠Ïù¥Îùº Ï∂úÌòà ÌîºÌï¥ Î¨¥Ïãú`):(o.hp=Math.max(0,o.hp-s),y(e,`Ï†Å(${o.name}) Ï∂úÌòàÎ°ú HP -${s} (HP ${o.hp}/${o.maxHp})`)))}e.frontPlacedThisTurn=0,Zo(e),jo(e),Ke(e),Ye(e),ut(e,"onUpkeepEnd"),e.phase="DRAW"}function Zo(e){const t=["vuln","weak","bleed","disrupt"];for(const n of t)e.player.status[n]>0&&(e.player.status[n]-=1);for(const n of e.enemies)for(const r of t)n.status[r]>0&&(n.status[r]-=1)}function es(e){if(e.phase!=="DRAW"||(e.intentsRevealedThisTurn=!1,e.disruptIndexThisTurn=null,Ye(e),e.run.finished))return;if(V(e).length===0){ur(e),e.phase="NODE";return}const t=e.usedThisTurn;e.usedThisTurn=0;const n=Number(e._extraDrawNextTurn??0);e._extraDrawNextTurn=0,Ct(e,t+(n>0?n:0)),e.player.block>0&&(e.player.block=0,y(e,"Î∞©Ïñ¥(Î∏îÎ°ù) ÏÜåÏã§")),pn(e),e.phase="PLACE",e.backUidsThisTurn=[],e.attackedEnemyIndicesThisTurn=[],e.drawCountThisTurn=0,e.combatTurn=(e.combatTurn??0)+1}function Ct(e,t){let n=0;for(let r=0;r<t&&(ts(e),!e.run.finished);r++){const o=e.deck.pop();if(!o)break;e.hand.push(o),n++}return y(e,`ÎìúÎ°úÏö∞ ${n}/${t} (ÏÜêÌå® ${e.hand.length})`),n}function ts(e){e.deck.length===0&&e.discard.length>0&&(e.deck=cn(e.discard),e.discard=[],e.player.fatigue+=1,y(e,`ÌîºÎ°úÎèÑ F +1 (ÏÖîÌîå, ÌòÑÏû¨ ${e.player.fatigue})`))}function ur(e){e.player.block>0&&(e.player.block=0,y(e,"Î∞©Ïñ¥(Î∏îÎ°ù) ÏÜåÏã§")),e.intentsRevealedThisTurn=!1,e.disruptIndexThisTurn=null}function Rn(e){ur(e)}function Z(e){return e.pendingTarget!=null||(e.pendingTargetQueue?.length??0)>0}function ns(e,t,n){const r=Number(t.amount??0)|0,o=t.formulaKind;if(!o)return r;switch(o){case"prey_mark":return n.hp>e.player.hp?r+5:r;case"triple_bounty":return V(e).length>=3?r+4:r;default:return r}}function rs(e,t){if(!e.pendingTarget)return!1;if(V(e).length===0)return e.pendingTarget=null,e.pendingTargetQueue=[],e.selectedEnemyIndex=null,Ye(e),!0;const n=e.enemies[t];if(!n||n.hp<=0)return!1;const r=e.pendingTarget;if(r.kind==="damageSelect"){const o=ns(e,r,n);Ne(e,n,o)}else if(r.kind==="statusSelect"&&(ot(n,r.key,r.n,e,"PLAYER"),r.key==="bleed"&&r.n>0)){const o=ge(e);o.bleedApplied+=1,ye(e)}return Ke(e),Ye(e),V(e).length===0?!0:(os(e),!e.pendingTarget&&(e.pendingTargetQueue?.length??0)===0)}function os(e){const t=e.pendingTargetQueue??[],n=t.shift()??null;e.pendingTarget=n,e.pendingTargetQueue=t,e.selectedEnemyIndex=null}function ss(e,t){t<=0||(e.player.block+=t,y(e,`Î∞©Ïñ¥(Î∏îÎ°ù) +${t} (ÌòÑÏû¨ ${e.player.block})`))}function as(e,t){e.player.supplies=ln(e.player.supplies+t,0),y(e,`Î≥¥Í∏â S ${t>=0?"+":""}${t} (ÌòÑÏû¨ ${e.player.supplies})`)}function Le(e,t){e.player.fatigue=ln(e.player.fatigue+t,0),y(e,`ÌîºÎ°ú F ${t>=0?"+":""}${t} (ÌòÑÏû¨ ${e.player.fatigue})`)}function at(e,t){if(t<=0)return;let n=t;dn(e,"relic_bloody_spoon")&&n>0&&(n+=1,y(e,"Ìîº Î¨ªÏùÄ ÏàüÍ∞ÄÎùΩ, Ï∂îÍ∞Ä ÌöåÎ≥µ +1"));const r=e.player.hp;e.player.hp=Math.min(e.player.maxHp,e.player.hp+n),y(e,`HP +${e.player.hp-r} (ÌòÑÏû¨ ${e.player.hp}/${e.player.maxHp})`)}function Ke(e){V(e).length===0&&(e.pendingTarget=null,e.pendingTargetQueue=[],e.selectedEnemyIndex=null)}function Ne(e,t,n){if(n<=0)return;const r=e.enemies.indexOf(t);if(r<0){y(e,`WARN: applyDamageToEnemy target not in g.enemies (${t?.id??"?"})`);return}if(e.attackedEnemyIndicesThisTurn.includes(r)||e.attackedEnemyIndicesThisTurn.push(r),t.immuneThisTurn){y(e,`Ï†Å(${t.name})ÏùÄ(Îäî) Ïù¥Î≤à ÌÑ¥ ÌîºÌï¥ Î©¥Ïó≠ ‚Üí ${n} ÌîºÌï¥ Î¨¥Ïãú`),Ke(e);return}let o={target:"ENEMY",source:"PLAYER_ATTACK",raw:n,enemyIndex:r,enemyId:t.id},s=Ee(e,{...o,phase:"PRE_STATUS",current:n,targetVuln:t.status.vuln??0,attackerWeak:e.player.status.weak??0});const a=e.player.status.weak??0,i=t.status.vuln??0;if(s=s-a+i,s<0&&(s=0),s=Ee(e,{...o,phase:"POST_STATUS",current:s,afterStatus:s,targetVuln:i,attackerWeak:a}),s=Ee(e,{...o,phase:"FINAL",current:s,afterStatus:s,targetVuln:i,attackerWeak:a}),s<=0){y(e,`Ï†Å(${t.name})ÏóêÍ≤å ÌîºÌï¥ 0 (Ïú†Î¨º/ÏÉÅÌÉúÎ°ú ÏÉÅÏáÑ)`),Ke(e);return}const l=t.hp;if(t.hp=Math.max(0,t.hp-s),y(e,`Ï†Å(${t.name})ÏóêÍ≤å ${s} ÌîºÌï¥. (HP ${t.hp}/${t.maxHp})`),l>0&&t.hp===0){const c=ge(e);c.kills+=1,ye(e)}er(e,{...o,phase:"FINAL",current:s,afterStatus:s,targetVuln:i,attackerWeak:a},s),Ke(e),V(e).length===0&&(Ke(e),Ye(e))}function fe(e,t,n,r,o){if(n==="ENEMY_ATTACK"&&e.player.nullifyDamageThisTurn)return y(e,`Ï†Å Í≥µÍ≤© ÌîºÌï¥ Î¨¥Ìö® (${r??n})`),0;if(t<=0)return 0;const a={target:"PLAYER",source:n==="ENEMY_ATTACK"?"ENEMY_ATTACK":n==="FATIGUE"?"FATIGUE":"OTHER",raw:t,reason:r};let i=Ee(e,{...a,phase:"PRE_STATUS",current:t,attackerWeak:o,targetVuln:e.player.status.vuln??0});if(n==="ENEMY_ATTACK"){const l=o??0,c=e.player.status.vuln??0;if(i=i-l+c,i<0&&(i=0),i=Ee(e,{...a,phase:"POST_STATUS",current:i,afterStatus:i,attackerWeak:l,targetVuln:c}),i=Ee(e,{...a,phase:"PRE_BLOCK",current:i,afterStatus:i,attackerWeak:l,targetVuln:c}),e.player.block>0){const h=Math.min(e.player.block,i);e.player.block-=h,i-=h}i=Ee(e,{...a,phase:"POST_BLOCK",current:i,afterStatus:i,afterBlock:i,attackerWeak:l,targetVuln:c})}else i=Ee(e,{...a,phase:"POST_STATUS",current:i,afterStatus:i});if(i=Ee(e,{...a,phase:"FINAL",current:i}),i<=0)return 0;e.player.hp=Math.max(0,e.player.hp-i),y(e,`ÌîåÎ†àÏù¥Ïñ¥ ${i} ÌîºÌï¥ (${r??n}). (HP ${e.player.hp}/${e.player.maxHp})`);{const l=ge(e);let c=!1;i>=10&&!l.tookBigHit10&&(l.tookBigHit10=!0,c=!0),e.player.hp<=15&&!l.hpLeq15&&(l.hpLeq15=!0,c=!0),c&&ye(e)}return er(e,{...a,phase:"FINAL",current:i},i),i}function is(){return Qt[Math.floor(Math.random()*Qt.length)]}function In(e){const{tier:t}=Xn(e),n=t===0?0:t===1?.25:t===2?.55:.85;return Math.random()<n?ls():is()}const pr={boss_cursed_wall:"ÏõÄÏßÅÏù¥ÏßÄ ÏïäÎäîÎã§. ÎãπÏã†Ïù¥ Îã≥ÏïÑÍ∞ÑÎã§.",boss_giant_orc:"Í±∞ÎåÄÌïú Î¨¥Ïñ∏Í∞ÄÍ∞Ä Í∏∞Îã§Î¶∞Îã§.",boss_soul_stealer:"ÌñâÎèôÌïòÏßÄ ÏïäÏúºÎ©¥ Ï¢ÖÎßêÏù¥ Ïò®Îã§.",boss_gravity_master:"Î™∏Ïù¥ Ï†êÏ†ê Î¨¥Í≤ÅÎã§. Î™∏ÏùÑ Í∞ÄÎ≥çÍ≤å ÌïòÎùº."},Ln=[{id:"mad_mirror",name:"Í±∞Ïö∏Ïóê Ïû†Í∏¥ Î¨º",prompt:"Î¨º ÏÜçÏùò ÎãπÏã†Ïù¥ Î®ºÏ†Ä ÏõÉÏäµÎãàÎã§.",art:"assets/events/event_mad_mirror.png",options:e=>[{key:"mad_mirror:take",label:"ÏÜêÏùÑ ÎÑ£ÎäîÎã§",detail:"Ïπ¥Îìú Î≥¥ÏÉÅ. F +2.",apply:t=>(Le(t,2),y(t,"Í±∞Ïö∏: Î¨¥Ïñ∏Í∞ÄÎ•º Í±¥Ï†∏ Ïò¨Î†∏Îã§. (F +2)"),"REWARD")},{key:"mad_mirror:leave",label:"Ïô∏Î©¥ÌïúÎã§",apply:t=>(y(t,"Í±∞Ïö∏: ÎãπÏã†ÏùÄ Î¨ºÎü¨ÎÇ¨Îã§."),"NONE")}]},{id:"mad_contract",name:"Ï†ñÏùÄ Í≥ÑÏïΩÏÑú",prompt:"Í≥∞Ìå°Ïù¥ ÎÉÑÏÉàÍ∞Ä ÎÇ©ÎãàÎã§.",art:"assets/events/event_mad_contract.png",options:e=>[{key:"mad_contract:sign",label:"ÏÑúÎ™ÖÌïúÎã§",detail:"ÏµúÎåÄ HP +2. Ïπ¥Îìú 1Ïû• Ï†úÍ±∞ ÌõÑ Î≥¥ÏÉÅ.",apply:t=>(t.player.maxHp+=2,t.player.hp=Math.min(t.player.maxHp,t.player.hp+2),y(t,"Í≥ÑÏïΩ: ÏµúÎåÄ HP +2"),{kind:"REMOVE_PICK",title:"ÎåÄÍ∞Ä",prompt:"Ï†úÍ±∞Ìï† Ïπ¥Îìú 1Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.",then:"REWARD"})},{key:"mad_contract:burn",label:"Ï∞¢Ïñ¥Î≤ÑÎ¶∞Îã§",detail:"F +1",apply:t=>(Le(t,1),y(t,"Î∂àÍ∏∏Ìï®: F +1"),"NONE")}]},{id:"mad_lullaby",name:"ÏûêÏû•Í∞Ä",prompt:"Ïû†Îì§Î©¥ ÌöåÎ≥µÌïòÏßÄÎßå, Íπ®Ïñ¥ÎÇòÎ©¥ ÏûäÏäµÎãàÎã§.",art:"assets/events/event_mad_lullaby.png",options:e=>[{key:"mad_lullaby:sleep",label:"Ïû†Îì†Îã§",detail:"HP +12. Îç±ÏóêÏÑú Î¨¥ÏûëÏúÑ 1Ïû• ÏÜåÏã§.",apply:t=>(at(t,12),Ao(t),y(t,"ÏûêÏû•Í∞Ä: HP ÌöåÎ≥µ, Í∑∏Îü¨ÎÇò ÏûäÏóàÎã§‚Ä¶ (Î¨¥ÏûëÏúÑ 1Ïû• ÏÜåÏã§)"),"NONE")},{key:"mad_lullaby:stay",label:"Î≤ÑÌã¥Îã§",detail:"F -1",apply:t=>(Le(t,-1),y(t,"Î≤ÑÌåÄ: F -1"),"NONE")}]}];function ls(e){return Ln[Math.floor(Math.random()*Ln.length)]}const Qt=[{id:"drop_bag",name:"Ïßê Î≤ÑÎ¶¨Í∏∞",prompt:"ÏßêÏùÑ Ï§ÑÏó¨ ÌîºÎ°úÎ•º ÎÇÆÏ∂îÏûê.",art:"assets/events/event_drop_bag.png",options:()=>[{key:"drop",label:"Ïπ¥Îìú 1Ïû• Ï†úÍ±∞, F -1",apply:e=>(Le(e,-1),y(e,"Ïù¥Î≤§Ìä∏: Ïßê Î≤ÑÎ¶¨Í∏∞ ‚Üí Ï†úÍ±∞Ìï† Ïπ¥ÎìúÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî."),{kind:"REMOVE_PICK",title:"Ïßê Î≤ÑÎ¶¨Í∏∞",prompt:"Ï†úÍ±∞Ìï† Ïπ¥Îìú 1Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.",then:"NONE"})},{key:"skip",label:"ÏïÑÎ¨¥Í≤ÉÎèÑ ÌïòÏßÄ ÏïäÎäîÎã§",apply:e=>(y(e,"Ïù¥Î≤§Ìä∏: Ïßê Î≤ÑÎ¶¨Í∏∞(ÏÉùÎûµ)"),"NONE")}]},{id:"hide_from_monster",name:"Î™¨Ïä§ÌÑ∞Î°úÎ∂ÄÌÑ∞ Ïà®Í∏∞",prompt:"Ï†ÑÌà¨ÌïòÍ±∞ÎÇò, ÎåÄÍ∞ÄÎ•º ÏπòÎ•¥Í≥† Ïà®ÏùÑ Ïàò ÏûàÎã§.",art:"assets/events/event_hide_from_monster.png",options:()=>[{key:"fight",label:"Ï†ÑÌà¨",apply:e=>(y(e,"Ïù¥Î≤§Ìä∏: Î™¨Ïä§ÌÑ∞Î°úÎ∂ÄÌÑ∞ Ïà®Í∏∞ ‚Üí Ï†ÑÌà¨ ÏÑ†ÌÉù"),"BATTLE")},{key:"remove_and_fatigue",label:"Ïπ¥Îìú 1Ïû• Ï†úÍ±∞ ÌõÑ F +1",apply:e=>(Le(e,1),y(e,"Ïù¥Î≤§Ìä∏: Î™¨Ïä§ÌÑ∞Î°úÎ∂ÄÌÑ∞ Ïà®Í∏∞ ‚Üí Ïπ¥Îìú Ï†úÍ±∞ ÌõÑ F+1"),{kind:"REMOVE_PICK",title:"Ïà®Í∏∞",prompt:"Ï†úÍ±∞Ìï† Ïπ¥Îìú 1Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.",then:"NONE"})}]},{id:"goblin_ambush_low_supplies",name:"Îß§Î≥µÌïú ÏïΩÌÉàÏûêÎì§",prompt:`Í≥†Î∏îÎ¶∞Îì§Ïù¥ Î≥¥Í∏âÏùÑ ÏïΩÌÉàÌñàÎã§.
Ïù¥Î≤à Ï†ÑÌà¨Îäî Î≥¥Í∏â(S) 5Î°ú ÏãúÏûëÌï©ÎãàÎã§.`,art:"assets/events/event_goblin_ambush_low_supplies.png",options:()=>[{key:"fight",label:"ÎßûÏÑú Ïã∏Ïö¥Îã§",detail:"Í≥†Î∏îÎ¶∞ ÏïΩÌÉàÏûê 2ÎßàÎ¶¨ Ï†ÑÌà¨ (S = 5 ÏãúÏûë)",apply:e=>(e.run.nextBattleSuppliesBonus=-5,{kind:"BATTLE_SPECIAL",title:"Í≥†Î∏îÎ¶∞ Îß§Î≥µ",enemyIds:["goblin_raider","goblin_raider"]})}]},{id:"find_adventurer",name:"Îã§Î•∏ Î™®ÌóòÍ∞Ä Î∞úÍ≤¨",prompt:"Í±∞ÎûòÌïúÎã§.",art:"assets/events/event_find_adventurer.png",options:e=>e.run.treasureObtained?[{key:"adventurer:forced_battle",label:"ÎåÄÏπòÌïúÎã§",detail:"Î≥¥Î¨ºÏùÑ ÎÖ∏Î¶¨Í≥† Îç§Î≤ºÎì†Îã§.",apply:t=>({kind:"BATTLE_SPECIAL",enemyIds:["other_adventurer"],title:"Î≥¥Î¨ºÏùÑ ÎÖ∏Î¶¨Îäî Î™®ÌóòÍ∞Ä"})}]:[{key:"trade",label:"Ïπ¥Îìú 1Ïû• Ï†úÍ±∞ ÌõÑ Ïπ¥Îìú Î≥¥ÏÉÅ(2Ïû• Ï§ë 1Ïû•)",apply:t=>(y(t,"Ïù¥Î≤§Ìä∏: Îã§Î•∏ Î™®ÌóòÍ∞Ä Î∞úÍ≤¨ ‚Üí Ï†úÍ±∞Ìï† Ïπ¥Îìú ÏÑ†ÌÉù ÌõÑ Î≥¥ÏÉÅ"),{kind:"REMOVE_PICK",title:"Îã§Î•∏ Î™®ÌóòÍ∞Ä Î∞úÍ≤¨",prompt:"Ï†úÍ±∞Ìï† Ïπ¥Îìú 1Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.",then:"REWARD"})},{key:"leave",label:"ÏßÄÎÇòÏπúÎã§",apply:t=>(y(t,"Ïù¥Î≤§Ìä∏: Îã§Î•∏ Î™®ÌóòÍ∞Ä Î∞úÍ≤¨(ÏÉùÎûµ)"),"NONE")}]},{id:"ominous_prophecy",name:"Î∂àÍ∏∏Ìïú ÏòàÏñ∏",prompt:"Î∂àÍ∏∏Ìïú ÏÜçÏÇ≠ÏûÑÏù¥ Í∑ìÍ∞ÄÎ•º Îß¥ÎèàÎã§. ÎåÄÍ∞ÄÎ•º ÏπòÎ•¥Í≥† ÎØ∏ÎûòÎ•º ÏóøÎ≥ºÍπå?",art:"assets/events/event_ominous_prophecy.png",options:e=>[{key:"omen:listen",label:"ÏòàÏñ∏ÏùÑ Îì£ÎäîÎã§",detail:"F +1. Îã§Ïùå Î≥¥Ïä§Î•º ÌôïÏ†ïÌïòÍ≥† Í≥µÍ∞úÌï©ÎãàÎã§.",apply:t=>{if(Le(t,1),y(t,"Î∂àÍ∏∏Ìïú ÏòàÏñ∏: F +1"),t.run.nextBossId||(t.run.bossPool.length>0?t.run.nextBossId=oe(t.run.bossPool):t.run.nextBossId=null),!t.run.nextBossId)return y(t,"ÏòàÏñ∏: ÎØ∏ÎûòÍ∞Ä ÌùêÎ¶øÌïòÎã§. (Î≥¥Ïä§Í∞Ä ÎÇ®ÏïÑÏûàÏßÄ ÏïäÏùå)"),"NONE";t.content.enemiesById[t.run.nextBossId];const n=pr[t.run.nextBossId]??"Ï†ïÏ≤¥Î∂àÎ™ÖÏùò ÏúÑÌòëÏù¥ Îã§Í∞ÄÏò®Îã§.";return t.run.bossOmenText=`${n}`,y(t,`ÏòàÏñ∏: ${n}`),"NONE"}},{key:"omen:ignore",label:"Î¨¥ÏãúÌïúÎã§",detail:"ÏïÑÎ¨¥ ÏùºÎèÑ ÏùºÏñ¥ÎÇòÏßÄ ÏïäÏäµÎãàÎã§.",apply:t=>(y(t,"Î∂àÍ∏∏Ìïú ÏòàÏñ∏(Î¨¥Ïãú)"),"NONE")}]},{id:"rat_circle",name:"Ï•êÎì§Ïùò Ïõê",prompt:`Ï•êÎì§Ïù¥ ÎèåÎ∞îÎã•Ïóê ÏõêÏùÑ ÎßåÎì†Îã§.
ÎãπÏã†ÏùÑ Î≥¥Ïûê ÏõêÏù¥ Ïª§ÏßÑÎã§.`,art:"assets/events/event_rat_circle.png",options:e=>{const t=!ro(e,"relic_ratskin_charm"),n=[{key:"rat_circle:one",label:"Ï•êÎñº Ìïú ÎßàÎ¶¨ÏôÄ Ïã∏Ïö¥Îã§",detail:"Ï†ÑÌà¨",apply:r=>(y(r,"Ïù¥Î≤§Ìä∏: Ï•êÎì§Ïùò Ìåê ‚Üí Ï•êÎñº 1"),{kind:"BATTLE_SPECIAL",title:"Ï•êÎì§Ïùò Ïõê",enemyIds:["rat_swarm"]})}];return t&&n.splice(1,0,{key:"rat_circle:three_for_relic",label:"Ïú†Î¨ºÏùÑ Í±∏Í≥† Ï•êÎñº ÏÖãÍ≥º Ïã∏Ïö¥Îã§",detail:"ÏäπÎ¶¨ Ïãú Í≥†Ïú† Ïú†Î¨º ÌöçÎìù",apply:r=>(y(r,"Ïù¥Î≤§Ìä∏: Ï•êÎì§Ïùò Ìåê ‚Üí Ï•êÎñº 3 (Í≥†Ïú† Ïú†Î¨º)"),{kind:"BATTLE_SPECIAL",title:"Ï•êÎì§Ïùò Ïõê",enemyIds:["rat_swarm","rat_swarm","rat_swarm"],onWinGrantRelicId:"relic_ratskin_charm"})}),n}}];function fr(e){return Qt.find(t=>t.id===e)??null}function cs(){return Object.keys(Qn).sort((e,t)=>e.localeCompare(t))}function ds(){return{cardsById:Qn,enemiesById:Jr}}let Ve=!1,mn=null,ze=[],Ze=[],Se=-1;function us(e){return Array.from(new Set(e)).sort((t,n)=>t.localeCompare(n))}function Hn(e,t){return e.toLowerCase().startsWith(t.toLowerCase())}function ps(){return[{name:"help",desc:"show commands"},{name:"state",desc:"print game state"},{name:"newrun",desc:"start new run"},{name:"hp",args:"<n>",desc:"set current hp"},{name:"maxhp",args:"<n>",desc:"set max hp"},{name:"supplies",args:"<n>",desc:"set supplies"},{name:"fatigue",args:"<n>",desc:"set fatigue"},{name:"phase",args:"<PLACE|BACK|FRONT|ENEMY|UPKEEP|DRAW|NODE>",desc:"set phase",suggest:()=>["PLACE","BACK","FRONT","ENEMY","UPKEEP","DRAW","NODE"]},{name:"addcard",args:"<defId> [upgrade=0] [zone=deck|hand|discard]",desc:"add card",suggest:(e,t)=>t.length<=2?cs():t.length===4?["deck","hand","discard"]:[]},{name:"removecard",args:"<uid>",desc:"remove card",suggest:e=>us(Object.keys(e.cards??{}))},{name:"win",desc:"force victory"},{name:"lose",desc:"force defeat"},{name:"log",args:"<text...>",desc:"log message"},{name:"addrelic",args:"<relicId> [now|locked|unlocked]",desc:"grant relic",suggest:(e,t)=>t.length<=2?to():t.length===3?["now","locked","unlocked"]:[]},{name:"relicapply",desc:"apply pending relic activations"}]}function vt(e,t){ze.push({t:Date.now(),kind:e,text:t}),ze.length>300&&(ze=ze.slice(-300))}function fs(e){mn=e}function hs(){return Ve}function ms(e){Ve=!Ve,je()}function je(){if(document.querySelector(".devConsole")?.remove(),!Ve)return;const e=document.createElement("div");e.className="devConsole",e.style.cssText=`
    position: fixed; inset: 0;
    z-index: 60000;
    pointer-events: auto;
    background: rgba(0,0,0,.35);
    backdrop-filter: blur(4px);
    display:flex; align-items:flex-end; justify-content:center;
    padding: 12px;
    box-sizing: border-box;
  `;const t=document.createElement("div");t.style.cssText=`
    width: min(980px, 100%);
    height: min(420px, 70vh);
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(10,12,14,.92);
    box-shadow: 0 18px 60px rgba(0,0,0,.55);
    display:flex;
    flex-direction: column;
    overflow:hidden;
  `;const n=document.createElement("div");n.style.cssText=`
    padding: 10px 12px;
    display:flex; align-items:center; justify-content:space-between;
    border-bottom: 1px solid rgba(255,255,255,.10);
  `;const r=document.createElement("div");r.textContent="Dev Console",r.style.cssText="font-weight:800; color:#fff; opacity:.95;";const o=document.createElement("div");o.style.cssText="display:flex; gap:8px;";const s=(b,g)=>{const m=document.createElement("button");return m.type="button",m.textContent=b,m.style.cssText=`
      padding: 6px 10px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: #fff;
      cursor: pointer;
      font-weight: 700;
    `,m.onclick=g,m};o.appendChild(s("Clear",()=>{ze=[],je()})),o.appendChild(s("Close",()=>{Ve=!1,je()})),n.appendChild(r),n.appendChild(o);const a=document.createElement("div");a.className="devConsoleOut",a.style.cssText=`
    flex: 1 1 auto;
    padding: 10px 12px;
    overflow: auto;
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 12px;
    line-height: 1.4;
    color: #ddd;
    white-space: pre-wrap;
  `;const i=b=>(b.kind==="in"?"> ":b.kind==="err"?"! ":"  ")+b.text;a.textContent=ze.map(i).join(`
`),queueMicrotask(()=>{a.scrollTop=a.scrollHeight});const l=document.createElement("div");l.style.cssText=`
    border-top: 1px solid rgba(255,255,255,.10);
    padding: 10px 12px;
    display:flex; gap:10px; align-items:center;
  `;const c=document.createElement("div");c.className="devConsoleHint",c.style.cssText=`
    margin-left: 10px;
    max-width: 45%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    color: rgba(255,255,255,.55);
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 12px;
  `;const h=document.createElement("div");h.textContent=">",h.style.cssText="color:#fff; font-weight:900; opacity:.9;";const u=document.createElement("input");u.type="text",u.placeholder="help / state / newrun ...",u.style.cssText=`
    flex: 1 1 auto;
    padding: 10px 12px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(255,255,255,.06);
    color: #fff;
    outline: none;
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: 13px;
  `;const d=ps();let x={base:"",items:[],idx:-1,lastApplied:""};const $=b=>{const g=mn?.getG();if(!g)return[];const m=b.split(/\s+/).filter(Boolean),k=/\s$/.test(b);if(m.length===0)return d.map(E=>E.name);if(m.length===1&&!k){const E=m[0];return d.map(_=>_.name).filter(_=>Hn(_,E))}const M=(m[0]??"").toLowerCase(),T=d.find(E=>E.name===M);if(!T?.suggest)return[];const H=k?"":m[m.length-1]??"";return T.suggest(g,m).filter(E=>Hn(E,H))},f=(b,g)=>{const m=/\s$/.test(b);if(!b.trim())return g+" ";const k=b.split(/\s+/);return m?b+g+" ":(k[k.length-1]=g,k.join(" ")+" ")},p=()=>{const b=$(u.value);if(!b.length){c.textContent="";return}const g=b.slice(0,6);c.textContent=g.join("  ")};u.onkeydown=b=>{if(b.key==="Escape"){Ve=!1,je();return}if(b.key==="Enter"){const g=u.value.trim();if(!g)return;u.value="",Ze.unshift(g),Se=-1,vt("in",g);try{bs(g)}catch(m){vt("err",String(m?.message??m))}je();return}if(b.key==="ArrowUp"){b.preventDefault();const g=Ze.length;if(g===0)return;Se=Math.min(g-1,Se+1),u.value=Ze[Se]??"";return}if(b.key==="ArrowDown"){if(b.preventDefault(),Ze.length===0)return;Se=Math.max(-1,Se-1),u.value=Se>=0?Ze[Se]??"":"";return}if(b.key==="Tab"){b.preventDefault();const g=b.shiftKey===!0,m=u.value;if(!(x.items.length>0&&(m===x.lastApplied||m===x.base))){const H=$(m);x.base=m,x.items=H,x.idx=-1,x.lastApplied=m}if(!x.items.length){p();return}g?x.idx=(x.idx-1+x.items.length)%x.items.length:x.idx=(x.idx+1)%x.items.length;const M=x.items[x.idx],T=f(x.base,M);u.value=T,x.lastApplied=T,p();return}},u.oninput=()=>{x.items=[],x.base="",x.idx=0,p()},l.appendChild(h),l.appendChild(u),l.appendChild(c),t.appendChild(n),t.appendChild(a),t.appendChild(l),t.onclick=b=>b.stopPropagation(),e.appendChild(t),document.body.appendChild(e),p(),queueMicrotask(()=>u.focus())}function bs(e){const t=mn;if(!t){vt("err","Dev console context not set");return}const n=t.getG(),r=e.split(/\s+/).filter(Boolean),o=(r[0]??"").toLowerCase(),s=r[1],a=r[2],i=c=>vt("out",c);if(o==="help"){i(["help","state","newrun","hp <n> | maxhp <n> | supplies <n> | fatigue <n>","phase <PLACE|BACK|FRONT|ENEMY|UPKEEP|DRAW|NODE>","addcard <defId> [upgrade=0] [zone=deck|hand|discard]","removecard <uid>","addrelic <relicId> [now|locked|unlocked]","relicapply  (apply pending relic activations)","win | lose","log <text...>"].join(`
`));return}if(o==="state"){i(JSON.stringify({phase:n.phase,hp:`${n.player.hp}/${n.player.maxHp}`,supplies:n.player.supplies,fatigue:n.player.fatigue,deck:n.deck.length,hand:n.hand.length,discard:n.discard.length,enemies:n.enemies.map(c=>({id:c.id,hp:`${c.hp}/${c.maxHp}`,intent:c.intentIndex}))},null,2));return}if(o==="newrun"){t.actions.onNewRun(),i("OK: newrun");return}const l=(c,h)=>{const u=Number(s);if(!Number.isFinite(u)){i(`ERR: ${c} requires number`);return}h(u),t.rerender(),i(`OK: ${c} = ${u}`)};if(o==="hp")return l("hp",c=>n.player.hp=Math.max(0,Math.min(n.player.maxHp,c)));if(o==="maxhp")return l("maxHp",c=>{n.player.maxHp=Math.max(1,c),n.player.hp=Math.min(n.player.hp,n.player.maxHp)});if(o==="supplies")return l("supplies",c=>n.player.supplies=Math.max(0,c));if(o==="fatigue")return l("fatigue",c=>n.player.fatigue=Math.max(0,c));if(o==="phase"){const c=(s??"").toUpperCase();if(!new Set(["PLACE","BACK","FRONT","ENEMY","UPKEEP","DRAW","NODE"]).has(c)){i("ERR: phase invalid");return}n.phase=c,t.rerender(),i(`OK: phase=${c}`);return}if(o==="log"){const c=e.slice(e.indexOf(" ")+1);if(!c||c===e){i("ERR: log <text...>");return}t.log?.(`[DEV] ${c}`),i("OK: logged");return}if(o==="addcard"){const c=s;if(!c){i("ERR: addcard <defId> [upgrade=0] [zone=deck|hand|discard]");return}const h=Math.max(0,Number(a??"0")||0),u=r[3]??"deck";fn(n,c,{upgrade:h});const d=n.deck[n.deck.length-1];d&&u!=="deck"&&(n.deck=n.deck.filter(x=>x!==d),u==="hand"?n.hand.push(d):u==="discard"&&n.discard.push(d),n.cards[d].zone=u),t.log?.(`[DEV] addcard ${c} +${h} (${u}) uid=${d}`),t.rerender(),i(`OK: addcard uid=${d}`);return}if(o==="removecard"){const c=s;if(!c){i("ERR: removecard <uid>");return}if(!n.cards[c]){i(`ERR: uid not found: ${c}`);return}const h=n.deck.includes(c),u=n.hand.includes(c),d=n.discard.includes(c);!h&&!u&&!d&&i(`WARN: uid exists but not in piles (deck/hand/discard): ${c} (zone=${n.cards[c]?.zone??"?"})`),Pt(n,c),t.log?.(`[DEV] removecard ${c}`),t.rerender(),i("OK: removecard");return}if(o==="addrelic"){const c=s,h=(a??"").toLowerCase();if(!c){i("ERR: addrelic <relicId> [now|locked|unlocked]");return}gt(n,c);const u=n.run;if(u.forceLockedRelics??={},u.forceUnlockedRelics??={},h==="locked"){u.forceLockedRelics[c]=!0,delete u.forceUnlockedRelics[c],u.relicRuntime??={},u.relicRuntime[c]??={active:!1,pending:!1,obtainedAtNode:n.run.nodePickCount},u.relicRuntime[c].active=!1,u.relicRuntime[c].pending=!1,t.log?.(`[DEV] addrelic ${c} (locked)`),t.rerender(),i(`OK: addrelic ${c} (locked)`);return}if(h==="unlocked"){u.forceUnlockedRelics[c]=!0,delete u.forceLockedRelics[c],t.log?.(`[DEV] addrelic ${c} (unlocked)`),t.rerender(),i(`OK: addrelic ${c} (unlocked)`);return}h==="now"&&le(n),t.log?.(`[DEV] addrelic ${c}${h?` (${h})`:""}`),t.rerender(),i(`OK: addrelic ${c}`);return}if(o==="relicapply"){le(n),t.log?.("[DEV] relicapply"),t.rerender(),i("OK: relicapply");return}if(o==="win"){if(!n.enemies||n.enemies.length===0){i("WARN: enemies=0");return}for(const c of n.enemies)c.hp=0;n.enemies=[],n.pendingTarget=null,n.pendingTargetQueue=[],n.selectedEnemyIndex=null,Ye(n),t.log?.("[DEV] win"),t.rerender(),i("OK: win");return}if(o==="lose"){n.run.finished=!0,t.log?.("[DEV] lose"),t.rerender(),i("OK: lose");return}i(`Unknown command: ${o} (try: help)`)}function Bt(e,t){if(!t)return;const n=e.player.fatigue??0;n<10||(e.player.fatigue=Math.max(0,n-2),e.time=(e.time??0)+1,y(e,"ÌîºÎ°úÍ∞Ä ÎÑàÎ¨¥ ÎÜíÏïÑ Ìú¥ÏãùÏù¥ Îçî Ïò§Îûò Í±∏Î¶ΩÎãàÎã§. (F -2, ÏãúÍ∞Ñ +1)"))}function ys(e){let t=Object.values(e.cards).filter(a=>(a.zone==="deck"||a.zone==="hand"||a.zone==="discard")&&At(e,a.uid)).map(a=>a.uid);const n=e.player.fatigue??0;let r=1/0;return n>=8?r=4:n>=5&&(r=8),r!==1/0&&t.length>r&&(t=[...t].sort(()=>Math.random()-.5).slice(0,r)),t.length===0?null:{kind:"UPGRADE_PICK",title:"Í∞ïÌôî",prompt:"Í∞ïÌôîÌï† Ïπ¥Îìú 1Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.",options:[...[...t].sort((a,i)=>{const l=e.cards[a],c=e.cards[i],h=e.content.cardsById[l.defId]?.name??l.defId,u=e.content.cardsById[c.defId]?.name??c.defId,d=h.localeCompare(u,"ko");return d!==0?d:(l.upgrade??0)-(c.upgrade??0)}).map(a=>{const i=e.cards[a],l=be(e.content,i.defId,i.upgrade??0),c=be(e.content,i.defId,(i.upgrade??0)+1),h=e.content.cardsById[i.defId]?.name??i.defId,u=(i.upgrade??0)>0?`${h} +${i.upgrade}`:h,d=`ÌòÑÏû¨: Ï†ÑÏó¥ ${l.frontText} / ÌõÑÏó¥ ${l.backText}
Í∞ïÌôî: Ï†ÑÏó¥ ${c.frontText} / ÌõÑÏó¥ ${c.backText}`;return{key:`up:${a}`,label:u,detail:d,cardUid:a}}),{key:"skip",label:"Ï∑®ÏÜå"}]}}function xs(e,t){const n=e.choiceCtx&&e.choiceCtx.kind==="REST"&&typeof e.choiceCtx.highF=="boolean"?e.choiceCtx.highF:(e.player.fatigue??0)>=10;if(t.startsWith("rest:")){const r=ge(e);r.rest+=1,ye(e)}if(t==="rest:heal")return Bt(e,n),at(e,15),y(e,"Ìú¥Ïãù: HP +15"),he(e),e.phase="NODE",le(e),!0;if(t==="rest:clear_f")return Bt(e,n),e.player.fatigue=Math.max(0,(e.player.fatigue??0)-3),y(e,"Ìú¥Ïãù: ÌîºÎ°ú F-=3"),he(e),e.phase="NODE",le(e),!0;if(t==="rest:upgrade"){const s=[...Object.values(e.cards).filter(l=>l.zone==="deck"||l.zone==="hand"||l.zone==="discard").filter(l=>At(e,l.uid)).map(l=>{const c=be(e.content,l.defId,l.upgrade??0),h=e.content.cardsById[l.defId]?.name??l.defId,u=(l.upgrade??0)>0?`${h} +${l.upgrade}`:h;return{key:`up:${l.uid}`,label:u,detail:`Ï†ÑÏó¥: ${c.frontText} / ÌõÑÏó¥: ${c.backText}`,cardUid:l.uid}}),{key:"skip",label:"Ï∑®ÏÜå"}],a=e.choice,i=e.choiceCtx;return Et(e,{kind:"UPGRADE_PICK",title:"Í∞ïÌôî",prompt:"Í∞ïÌôîÌï† Ïπ¥Îìú 1Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.",options:s},{kind:"UPGRADE_PICK",returnChoice:a,returnCtx:i}),!0}return t==="rest:skip"?(Bt(e,n),y(e,"Ìú¥Ïãù: ÏÉùÎûµ"),he(e),e.phase="NODE",le(e),!0):!1}function ks(e,t){if(!e.choiceCtx||e.choiceCtx.kind!=="EVENT")return!1;const n=fr(e.choiceCtx.eventId);if(!n)return!1;const o=n.options(e).find(i=>i.key===t);if(!o)return!1;const s=ge(e);s.eventPicks+=1,ye(e);const a=o.apply(e);if(a&&typeof a=="object"&&a.kind==="UPGRADE_PICK"){const i=ys(e);return i?(Et(e,i,null),!0):(y(e,"Í∞ïÌôîÌï† Ïàò ÏûàÎäî Ïπ¥ÎìúÍ∞Ä ÏóÜÏäµÎãàÎã§."),he(e),e.phase="NODE",le(e),!0)}if(a&&typeof a=="object"&&a.kind==="REMOVE_PICK"){const l=[...Object.values(e.cards).filter(c=>c.zone==="deck"||c.zone==="hand"||c.zone==="discard").map(c=>c.uid).map(c=>{const h=e.cards[c],u=be(e.content,h.defId,h.upgrade??0),d=e.content.cardsById[h.defId]?.name??h.defId,x=(h.upgrade??0)>0?`${d} +${h.upgrade}`:d;return{key:`remove:${c}`,label:x,detail:`Ï†ÑÏó¥: ${u.frontText} / ÌõÑÏó¥: ${u.backText}`,cardUid:c}}),{key:"skip",label:"Ï∑®ÏÜå"}];return Et(e,{kind:"REMOVE_PICK",title:a.title??"Ï†úÍ±∞",prompt:a.prompt??"Ï†úÍ±∞Ìï† Ïπ¥Îìú 1Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.",options:l},null),!0}return he(e),e.phase="NODE",le(e),!0}function Ts(e,t){const n=e.choice;if(!n)return!1;if(t==="close")return he(e),!0;if(n.kind==="REWARD")return Do(e,t);if(n.kind==="UPGRADE_PICK"){if(t==="skip"){const r=e.choiceCtx;return r?.returnChoice?(y(e,"Í∞ïÌôî Ï∑®ÏÜå"),Et(e,r.returnChoice,r.returnCtx??null),!0):(y(e,"Í∞ïÌôî Ï∑®ÏÜå"),he(e),e.phase="NODE",le(e),!0)}if(t.startsWith("up:")){const r=t.slice(3),o=ir(e,r);return y(e,o?"Í∞ïÌôî ÏôÑÎ£å":"Í∞ïÌôî Ïã§Ìå®"),he(e),e.phase="NODE",le(e),!0}return!1}if(n.kind==="REMOVE_PICK"){if(t==="skip")return y(e,"Ï†úÍ±∞ Ï∑®ÏÜå"),he(e),e.phase="NODE",le(e),!0;if(t.startsWith("remove:")){const r=t.slice(7);return Pt(e,r),y(e,"Ïπ¥ÎìúÎ•º Ï†úÍ±∞ÌñàÏäµÎãàÎã§."),he(e),e.phase="NODE",le(e),!0}return!1}if(n.kind==="EVENT"){if(e.choiceCtx?.kind==="REST")return xs(e,t);if(e.choiceCtx?.kind==="EVENT")return ks(e,t)}return t==="skip"?(he(e),!0):!1}const Rt="deck-rogue-save-v1",hr=1;function gs(e){try{return JSON.parse(e)}catch{return null}}function Es(){return!!localStorage.getItem(Rt)}function Cs(){localStorage.removeItem(Rt)}function vs(e,t){const n={ver:hr,savedAt:Date.now(),build:t?.build,state:e};localStorage.setItem(Rt,JSON.stringify(n))}function ws(){const e=localStorage.getItem(Rt);if(!e)return null;const t=gs(e);return!t||t.ver!==hr||!t.state?null:{state:t.state,savedAt:t.savedAt}}const Ss=`# Deck Rogue Prototype ‚Äî Î£∞Î∂Å (ÌîåÎ†àÏù¥Ïñ¥Ïö©)

Ïù¥ Î¨∏ÏÑúÎäî Ïä§Ìè¨ÏùºÎü¨Î•º ÏµúÏÜåÌôîÌï©ÎãàÎã§.

[1] Í∞úÏöî
ÎÖ∏ÎìúÎ•º ÏÑ†ÌÉùÌïòÎ©∞ ÏßÑÌñâÌïòÍ≥†, Ï†ÑÌà¨ÏóêÏÑú ÏÇ¥ÏïÑÎÇ®ÏïÑ ÏÑ±Ïû•Ìï©ÎãàÎã§. Î™©ÌëúÎäî Î¨¥ÏóáÏùºÍπåÏöî?
Î™®Îì† Ïπ¥ÎìúÎäî Ï†ÑÏó¥Í≥º ÌõÑÏó¥Ïù¥ ÏûàÏäµÎãàÎã§. Î∞∞ÏπòÏóê Îî∞Îùº Ïó≠Ìï†Ïù¥ Îã¨ÎùºÏßëÎãàÎã§.

[2] Î≥¥Í∏âÍ≥º ÌîºÎ°úÎèÑ

Î≥¥Í∏â(S): Ï†ÑÏó¥ Ïπ¥Îìú Î∞è ÏùºÎ∂Ä Ìö®Í≥ºÏùò Î∞úÎèôÏóê ÏÇ¨Ïö©Îê©ÎãàÎã§. Î≥¥ÌÜµ 7Î°ú ÏãúÏûëÌï©ÎãàÎã§.
Î≥¥Í∏âÏù¥ Î∂ÄÏ°±Ìïú ÏÉÅÌÉúÎ°ú ÌÑ¥ Ï¢ÖÎ£å Ïãú ÌîºÎ°úÎèÑÎßåÌÅº ÌîºÌï¥Î•º Î∞õÏäµÎãàÎã§.

ÌîºÎ°úÎèÑ(F): Îç±ÏùÑ ÏÑûÍ±∞ÎÇò Ï†ÑÏó¥ Ïπ¥ÎìúÏùò Î≥¥Í∏âÏù¥ Î∂ÄÏ°±Ìïú Ï±ÑÎ°ú ÌÑ¥ÏùÑ ÎßàÏπ† Îïå ÌîºÎ°úÎèÑÍ∞Ä 1 Ïò¨ÎùºÍ∞ÄÎ©∞, ÏùºÎ∂Ä Ïπ¥ÎìúÏùò Ìö®Í≥ºÎ°úÎèÑ Î≥ÄÌï©ÎãàÎã§.
ÌîºÎ°úÎèÑÎäî Ï†ÑÌà¨Í∞Ä ÎÅùÎÇòÎèÑ Ïú†ÏßÄÎê©ÎãàÎã§. ÎÑàÎ¨¥ ÏåìÏù∏ ÌîºÎ°úÎäî ÎïåÎïåÎ°ú ÎãπÏã†ÏùÑ Î≥ÄÌïòÍ≤å Ìï©ÎãàÎã§.

[3] Ï†ÑÌà¨ ÌùêÎ¶Ñ
Î∞∞Ïπò ‚Üí ÌõÑÏó¥ Î∞úÎèô ‚Üí Ï†ÑÏó¥ Î∞úÎèô ‚Üí Ï†Å ÌñâÎèô ‚Üí Ï†ïÎ¶¨ ‚Üí ÎìúÎ°úÏö∞
‚Äª ‚ÄúÎåÄÏÉÅ ÏÑ†ÌÉù ÌïÑÏöî‚ÄùÍ∞Ä Îú®Î©¥ ÏÇ¥ÏïÑÏûàÎäî Ï†ÅÏùÑ ÌÅ¥Î¶≠Ìï¥ ÎåÄÏÉÅÏùÑ Ï†ïÌïòÏÑ∏Ïöî.
‚Äª ÌõÑÏó¥ Î∞úÎèôÏùÑ ÎàÑÎ•¥Î©¥ ÌÑ¥Ïù¥ ÏßÑÌñâÎêòÏñ¥, Ïπ¥ÎìúÏùò Î∞∞ÏπòÎ•º Î≥ÄÍ≤ΩÌï† Ïàò ÏóÜÏäµÎãàÎã§.
Î≥¥Í∏â Î∞è Í∑∏Ïóê Îî∞Î•∏ Î≥ÄÌôîÎäî Ï†ïÎ¶¨ Îã®Í≥ÑÏóêÏÑú Ï≤òÎ¶¨Ìï©ÎãàÎã§.

ÏÜêÌå®Îäî ÌÑ¥Ïù¥ Ï¢ÖÎ£åÎêòÏñ¥ÎèÑ Ïú†ÏßÄÎê©ÎãàÎã§.
Ïπ¥ÎìúÎäî Îß§ ÌÑ¥ÎßàÎã§ ÏÇ¨Ïö©Ìïú ÎßåÌÅº ÎΩëÏäµÎãàÎã§. Ï¶â, Ïπ¥ÎìúÎ°ú Ïù∏Ìïú ÎìúÎ°úÏö∞Îäî Ìå®Ïùò Îß§Ïàò ÏûêÏ≤¥Î•º ÎäòÎ¶¨Îäî Ìö®Í≥ºÍ∞Ä ÏûàÏäµÎãàÎã§.

[4] Ïö©Ïñ¥
- ÏÜåÎ™®: Ïù¥Î≤à Ï†ÑÌà¨ÏóêÏÑú ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÍ≤å ÎêòÎäî Í≤ÉÏûÖÎãàÎã§.
- ÏÜåÏã§: Îü∞ Ï†ÑÏ≤¥ÏóêÏÑú Ìï¥Îãπ Ïπ¥ÎìúÍ∞Ä ÏÇ¨ÎùºÏßÄÎäî Í≤ÉÏûÖÎãàÎã§.
- Ï∑®ÏïΩ: Î∞õÎäî ÌîºÌï¥Í∞Ä (Ï∑®ÏïΩ)ÎßåÌÅº Ï¶ùÍ∞ÄÌï©ÎãàÎã§.
- ÏïΩÌôî: Ï£ºÎäî ÌîºÌï¥Í∞Ä (ÏïΩÌôî)ÎßåÌÅº Í∞êÏÜåÌï©ÎãàÎã§.
- Ï∂úÌòà: ÌÑ¥ Ï¢ÖÎ£å Ïãú (Ï∂úÌòà)ÎßåÌÅº ÌîºÌï¥Î•º ÏûÖÏäµÎãàÎã§.
- ÍµêÎûÄ: ÎãπÏã†ÏùÑ Î∞©Ìï¥Ìï©ÎãàÎã§. Î¨¥ÏóáÏùºÍπåÏöî?

[5] Ï°∞Ïûë

(Ïª¥Ìì®ÌÑ∞)
- 4: ÏÑ†ÌÉù Ìï¥Ï†ú
- Tab: ÏÜêÌå® ÏÑ†ÌÉù Ïù¥Îèô
- 1~3: Ï†ÑÏó¥ Î∞∞Ïπò / q,w,e: ÌõÑÏó¥ Î∞∞Ïπò
- ÎìúÎûòÍ∑∏: ÏÜêÌå®‚ÜíÏä¨Î°Ø Î∞∞Ïπò, Ïä¨Î°Ø‚ÜîÏä¨Î°Ø Ïä§Ïôë, Ïä¨Î°Ø‚ÜíÏÜêÌå® ÌöåÏàò
- Space: Îã§Ïùå ÌÑ¥
- P: ÏÉàÎ°úÏö¥ Îü∞

(Î™®Î∞îÏùº)
- ÏÜêÌå®: ÌÅ¥Î¶≠ Ïãú ÏÑ†ÌÉù, Í∏∏Í≤å ÎàÑÎ•º Ïãú ÌôïÎåÄ
- Ïπ¥Îìú ÏÑ†ÌÉù ÏÉÅÌÉúÏóêÏÑú Ïä¨Î°ØÏùÑ ÎàåÎü¨ Î∞∞Ïπò
- Ïä¨Î°Ø: ÌÅ¥Î¶≠ Ïãú ÌôïÎåÄ, Í∏∏Í≤å ÎàÑÎ•º Ïãú ÌöåÏàò
- Ïä¨Î°ØÏóê ÎÑ£ÏùÄ Ïπ¥ÎìúÎäî Ïù¥Î¶ÑÎßå Î≥¥ÏûÖÎãàÎã§.

[6] ÎãπÏã†ÏùÑ ÏúÑÌïú Ï°∞Ïñ∏

Îç±ÏùÄ ÎãπÏã†Ïùò ÎπÑÌíàÏûÖÎãàÎã§. ÎπÑÌíàÏù¥ Ï†ÅÏúºÎ©¥, Îäò ÏÉàÎ°ú Íæ∏Î¶¨ÎäêÎùº ÌûòÎì§ Í≤ÅÎãàÎã§. ÎπÑÌíàÏù¥ ÎßéÏúºÎ©¥, Îì§Í≥† Îã§ÎãàÍ∏∞ ÌûòÎì§Í≤†ÏßÄÏöî. Í∑†ÌòïÏùÑ Ï∞æÏúºÏÑ∏Ïöî.

[7] ÏãúÍ∞Ñ

ÏãúÍ∞ÑÏùÄ Í∏àÏûÖÎãàÎã§. Î™®Îì† ÌñâÎèôÏùÄ ÏãúÍ∞ÑÏùÑ ÏÜåÎ™®Ìï©ÎãàÎã§. Ïã∏ÏõÄÏùÄ Ï¢Ä Îçî ÏÜåÎ™®Ìï†ÏßÄÎèÑ Î™®Î•¥Í≤†Íµ∞Ïöî.
Ï§ëÏöîÌïú Í±¥ Ïù¥Í≥≥Ïù¥ ÎãπÏã†ÏóêÍ≤å ÎÑâÎÑâÌïú ÏãúÍ∞ÑÏùÑ Ï£ºÏßÄ ÏïäÎäîÎã§Îäî Í≤ÉÏù¥Í≤†ÏßÄÏöî.
`,_s=new URL("/deck-rogue-prototype/",window.location.origin).href;function me(e){if(!e||/^(https?:|data:|blob:)/i.test(e))return e;const t=e.replace(/^\/+/,"");return new URL(t,_s).href}let Dn=!1;function $s(){if(Dn)return;Dn=!0;const e=document.documentElement;if(e.style.setProperty("--bgUrl",`url("${me("assets/ui/background/dungeon_bg.png")}")`),e.style.setProperty("--boardUrl",`url("${me("assets/ui/boards/battle_board.png")}")`),e.style.setProperty("--cardUrl",`url("${me("assets/ui/cards/card_parchment.png")}")`),e.style.setProperty("--mapBgUrl",`url("${me("assets/ui/background/map_bg.png")}")`),!document.getElementById("deck-fontfaces")){const t=document.createElement("style");t.id="deck-fontfaces";const n=me("assets/fonts/Mulmaru.woff2"),r=me("assets/fonts/Mulmaru.woff");t.textContent=`@font-face {  font-family: "Mulmaru";  src: url("${n}") format("woff2"), url("${r}") format("woff");  font-weight: 400;  font-style: normal;  font-display: swap;}:root { --gameFont: "Mulmaru", system-ui, -apple-system, "Segoe UI", Arial, sans-serif; }body { font-family: var(--gameFont); }`,document.head.appendChild(t)}}function Ms(e){return new Promise(t=>window.setTimeout(t,e))}function Ns(e){switch(e){case"BACK":return 100;case"FRONT":return 100;case"ENEMY":return 100;case"UPKEEP":return 100;case"DRAW":return 100;case"PLACE":return 0;default:return 220}}let Ft=!1;function Ps(){document.querySelectorAll(".slot").forEach(e=>{const t=e.querySelector(".slotCardScaler");t&&Rr(e,t)})}function As(e){Ft||(Ft=!0,requestAnimationFrame(()=>{Ft=!1,Tn(),Cn(),En(),Ps()}))}let Rs=1,wt=[],mr=null;function it(e,t,n,r){wt.push({id:Rs++,kind:e,text:t,x:n,y:r,born:performance.now()})}function Is(){const e=performance.now();wt=wt.filter(t=>e-t.born<700)}let bt=null,yt=null,Wt=[];function Ls(e){if(!(!e.run.finished&&e.enemies.length>0&&e.phase!=="NODE")){bt=null,yt=null,Wt=[];return}if(bt!=null){const n=e.player.hp-bt;n!==0&&Hs(n)}if(yt!=null){const n=e.player.block-yt;n!==0&&Ds(n)}for(let n=0;n<e.enemies.length;n++){const r=e.enemies[n].hp,o=Wt[n];o!=null&&r!==o&&Os(n,r-o)}bt=e.player.hp,yt=e.player.block,Wt=e.enemies.map(n=>n.hp)}function Hs(e){const t=document.querySelector(".playerHudBox")??document.querySelector(".playerHudLeft");if(!t)return;const n=t.getBoundingClientRect(),r=(n.left+n.right)/2,o=n.top+14;e<0?it("dmg",`${e}`,r,o):it("heal",`+${e}`,r,o),t.classList.add("fxFlash"),setTimeout(()=>t.classList.remove("fxFlash"),240)}function Ds(e){const t=document.querySelector(".playerHudBox")??document.querySelector(".playerHudLeft");if(!t)return;const n=t.getBoundingClientRect(),r=(n.left+n.right)/2,o=n.top+34;it("block",e>0?`+${e}`:`${e}`,r,o)}function Os(e,t){const r=Array.from(document.querySelectorAll(".enemyHudCenter .enemyBanner"))[e];if(!r)return;const o=r.getBoundingClientRect(),s=(o.left+o.right)/2,a=o.top+14;t<0?it("dmg",`${t}`,s,a):it("heal",`+${t}`,s,a),r.classList.add("fxFlash"),setTimeout(()=>r.classList.remove("fxFlash"),240)}const br="deckrogue_uiSettings_v1";function Jt(e,t,n){return Math.max(t,Math.min(n,e))}function yr(){try{const e=localStorage.getItem(br);if(!e)return{uiScaleDesktop:1,uiScaleMobile:1,slotCardMode:"FULL"};const t=JSON.parse(e),n=t.slotCardMode==="NAME_ONLY"?"NAME_ONLY":"FULL";return{uiScaleDesktop:Jt(Number(t.uiScaleDesktop??1)||1,.75,1.5),uiScaleMobile:Jt(Number(t.uiScaleMobile??1)||1,.75,1.5),slotCardMode:n}}catch{return{uiScaleDesktop:1,uiScaleMobile:1,slotCardMode:"FULL"}}}let te=yr();function xr(){return It()?te.uiScaleMobile:te.uiScaleDesktop}function A(e){return Math.round(e*xr())}function It(){return window.matchMedia("(max-width: 900px) and (pointer: coarse)").matches}let Pe=!1;function Bs(){try{const e=localStorage.getItem("deckrogue_logCollapsed");if(e==null)return;Pe=e==="1"}catch{}}function Fs(){try{localStorage.setItem("deckrogue_logCollapsed",Pe?"1":"0")}catch{}}let xt=null;function Ws(e){xt!=null&&window.clearTimeout(xt),xt=window.setTimeout(()=>{xt=null,vs(e)},250)}let Ut=!1;async function Us(e,t){if(e._justStartedCombat){e._justStartedCombat=!1;return}if(!Ut){Ut=!0;try{if(e.run.finished||e.choice||Z(e)||q||e.phase==="NODE")return;let n=0;for(;n++<60&&!(e.run.finished||e.choice||q||Z(e));){const r=Ar(e,t,!1);if(!r.fn||r.disabled)break;const o=e.phase;if(r.fn(),R(e,t),e.phase==="PLACE")break;const s=Ns(o);s>0&&await Ms(s)}}finally{Ut=!1}}}function kr(e){const t=e.run;t.timeMove==null&&(t.timeMove=e.run.nodePickCount??0),t.nextBossTime==null&&(t.nextBossTime=40),t.forcedNext==null&&(t.forcedNext=null)}function Ks(e,t){const n=e;return n.content=t,n.time??=0,n.run.relics??=[],n.run??={},n.run.timeMove??=n.run.nodePickCount??0,n.run.nextBossTime??=40,n.run.forcedNext??=null,n.run.bossOmenText??=null,n.run.enemyLastSeenBattle??={},n.run.nodePickByType??={BATTLE:0,ELITE:0,REST:0,EVENT:0,TREASURE:0},n.run.bossPool??=["boss_gravity_master","boss_cursed_wall","boss_giant_orc","boss_soul_stealer"],n.run.nextBossId??=null,n.run.afterTreasureNodePicks??=0,n.run.deckSizeAtTreasure??=null,n.run.treasureObtained&&n.run.deckSizeAtTreasure==null&&(n.run.deckSizeAtTreasure=dr(n)),n.choiceStack??=[],n.pendingTargetQueue??=[],n.exhausted??=[],n.vanished??=[],n.choiceQueue??=[],n.choiceCtx??=null,n}function zs(e){if(!Es())return Vt(e);const t=ws();return t?Ks(t.state,e):Vt(e)}function js(){if(document.querySelector(".bgLayer"))return;const e=document.createElement("div");e.className="bgLayer",document.body.appendChild(e)}let On=0,Bn=0,xe=null,Tr=0;function bn(){try{gr.hide()}catch{}const e=document.querySelector(".cardHoverPreview");e&&e.classList.remove("on")}function yn(e=250){Tr=performance.now()+e}const gr=qs();function qs(){let e=null,t=null,n=null,r=null;function o(i){if(e)return;e=v("cardHoverPreview"),t=v("cardHoverPreviewTitle");const l=v("cardHoverPreviewRow");n=v("cardHoverPreviewCard"),r=v("cardHoverPreviewDetail"),l.appendChild(n),l.appendChild(r),e.appendChild(t),e.appendChild(l),i.appendChild(e)}function s(i){!e||!t||!n||!r||(t.textContent=i.title,n.innerHTML="",i.cardEl&&n.appendChild(i.cardEl),r.textContent=i.detail,e.classList.add("on"))}function a(){e&&e.classList.remove("on")}return{ensure:o,show:s,hide:a}}function St(e,t){const n=e.cards[t];return be(e.content,n.defId,n.upgrade??0)}function _t(e,t){return e.content.cardsById[t]?.name??t}function Vs(e,t,n){const r=n??0,o=e.content.cardsById[t]?.name??t;return r>0?`${o} +${r}`:o}function ue(e,t){const n=e.cards[t];return Vs(e,n.defId,n.upgrade??0)}function pt(e,t,n,r,o){const s=e.cards[t],a=be(e.content,s.defId,s.upgrade??0),i=o?.draggable??!0,l=o?.mode??"FULL",c=v("card");e.selectedHandCardUid===t&&c.classList.add("selected"),a.tags?.includes("EXHAUST")&&c.classList.add("exhaust"),a.tags?.includes("VANISH")&&c.classList.add("vanish"),l==="SLOT_NAME_ONLY"&&c.classList.add("slotNameOnly");const h=v("cardHeader"),u=Cr(e,t);if(h.appendChild(G("cardTitle",u)),l==="FULL"){const d=v("cardMeta");a.tags?.includes("EXHAUST")&&d.appendChild(en("ÏÜåÎ™®")),a.tags?.includes("VANISH")&&d.appendChild(en("ÏÜåÏã§")),h.appendChild(d)}if(c.appendChild(h),l==="FULL"){const d=v("cardBody"),x=v("cardSection");x.classList.add("front"),x.appendChild(Wn(a.frontText)),d.appendChild(x);const $=v("cardSection");$.classList.add("back"),$.appendChild(Wn(a.backText)),d.appendChild($),c.appendChild(d)}if(n&&r&&(c.onclick=()=>r(t)),n&&(c.onpointerdown=d=>{if(d.button!==0&&d.pointerType==="mouse"||Z(e)||e.phase!=="PLACE"||!i)return;const x=e.hand.indexOf(t);Ir(d,{kind:"hand",cardUid:t,fromHandIndex:x})}),o?.hoverPreview){const{root:d,api:x,buildDetail:$}=o.hoverPreview;x.ensure(d);const f=$?.(e,t)??(()=>{const p=$t(a.frontText),b=$t(a.backText);return`Ï†ÑÏó¥: ${p||"ÏóÜÏùå"}
ÌõÑÏó¥: ${b||"ÏóÜÏùå"}`})();c.addEventListener("pointerenter",p=>{if(performance.now()<Tr||O?.dragging)return;const b=pt(e,t,!1,void 0,{draggable:!1,mode:"FULL"});b.classList.add("isPreviewCard"),x.show({title:u,detail:f,cardEl:b})}),c.addEventListener("pointerleave",()=>{x.hide()}),c.addEventListener("pointerdown",()=>{yn(250),bn()},{capture:!0})}return c}function $t(e){if(!e)return"";if(typeof e=="string")return e;if(Array.isArray(e))return e.map($t).join("");if(typeof e=="object"){if(e.text)return String(e.text);if(e.children)return $t(e.children)}return""}function v(e){const t=document.createElement("div");return t.className=e,t}function G(e,t){const n=document.createElement("div");return n.className=e,n.textContent=t,n}function Ys(e){const t=document.createElement("h2");return t.textContent=e,t}function Zt(e){const t=document.createElement("h3");return t.textContent=e,t}function xn(e){const t=document.createElement("p");return t.textContent=e,t}function en(e){const t=document.createElement("span");return t.className="badge",t.textContent=e,t}function tn(e,t,n){const r=document.createElement("button");return r.textContent=e,r.disabled=n,r.onclick=t,r}function Gs(e){const t=document.createElement("pre");return t.className="log",t.textContent=e,t}function Er(e,t){const n=t??0;return n>0?`${e} +${n}`:e}function Cr(e,t){const n=e.cards[t],r=e.content.cardsById[n.defId].name;return Er(r,n.upgrade)}function Xs(e,t){const n=e.content.cardsById[t.defId].name;return Er(n,t.upgrade)}const Qs={Ï∑®ÏïΩ:"üéØ",ÏïΩÌôî:"ü•Ä",Ï∂úÌòà:"ü©∏",ÍµêÎûÄ:"üåÄ",Î©¥Ïó≠:"‚ú®",S:"üåæ",F:"üí§",ÎìúÎ°úÏö∞:"üÉè",ÌîºÌï¥:"üó°Ô∏è",ÌöåÎ≥µ:"üíä",Î∞©Ïñ¥:"üõ°Ô∏è",Î∏îÎ°ù:"üõ°Ô∏è",ÏÜåÎ™®:"üî•",ÏÜåÏã§:"üï≥Ô∏è"};function Fn(e,t,n){const r=Qs[e]??"",o=t!=null?`${e} ${t}`:e;return`<span class="kwBadge"><span class="kwIcon">${r}</span> <span class="kwLabel">${o}</span><span class="kwPunc">${n||""}</span></span>`}const vr="[,Ôºå„ÄÅ]",Js=new RegExp(`(Ï∑®ÏïΩ|ÏïΩÌôî|Ï∂úÌòà|ÍµêÎûÄ|Î©¥Ïó≠|S|F|ÎìúÎ°úÏö∞|ÌîºÌï¥|Î∞©Ïñ¥|Î∏îÎ°ù|ÌöåÎ≥µ|ÏÜåÎ™®|ÏÜåÏã§)\\s*([+-]?\\d+)\\s*(${vr})?`,"g"),Zs=new RegExp(`(^|[^Í∞Ä-Ìû£A-Za-z0-9_])(ÏÜåÎ™®|ÏÜåÏã§)\\s*(${vr})?`,"g");function ea(e){let t=e.replace(Js,(n,r,o,s)=>Fn(r,o,s));return t=t.replace(Zs,(n,r,o,s)=>`${r}${Fn(o,void 0,s)}`),t=t.replace(/\n/g,"<br>"),t}function Wn(e){const t=v("cardText");return t.innerHTML=ea(e),t}function ta(e){return me(`assets/enemies/${e}.png`)}const Un={vuln:"üéØ",weak:"ü•Ä",bleed:"ü©∏",disrupt:"üåÄ",immune:"‚ú®",supplies:"üåæ",fatigue:"üí§"};function wr(e){return e==="ATTACK"||e==="ATTACK_BUFF"||e==="ATTACK_DEBUFF"}function na(e,t,n){if(!n||!wr(n.cat))return"";const r=Math.max(1,Number(n.hits??1)||1),o=Math.max(0,Number(n.perHit??0)||0),s=Math.max(0,Number(n.dmgTotal??o*r)||0);if(r>1){if(o<=0)return`${s} (${r}ÌÉÄ)`;const a=o*r;if(s===a)return`${s} (${o}x${r})`;const i=Math.max(0,Number(e.player?.block??0)||0);if(i>0){let l=i;const c=[];for(let u=0;u<r;u++){const d=Math.min(l,o);l-=d,c.push(o-d)}if(c.reduce((u,d)=>u+d,0)===s)return c.every(d=>d===c[0])?`${s} (${c[0]}x${r})`:`${s} (${c.join("+")})`}return`${s} (${o}x${r})`}return`${s}`}function ra(e){if(!e)return"?";const t=wr(e.cat),n=e.applies??[],r=n.some(a=>a.target==="player"),o=n.some(a=>a.target==="enemy");let s="";if(t&&(s+="üó°Ô∏è"),r&&(s+="üåÄ"),o&&(s+="‚ú®"),!s){const a=e.cat;return a==="DEFEND"?"üõ°Ô∏è":a==="BUFF"?"‚ú®":a==="DEBUFF"?"üåÄ":"?"}return s}function oa(e,t){const n=v("enemyStatusEmojiRow"),r=(o,s)=>{if(!s||s<=0)return;const a=document.createElement("span");a.className="stEmoji",a.textContent=`${Un[o]??"?"}${s}`,n.appendChild(a)};if(r("vuln",e?.vuln??0),r("weak",e?.weak??0),r("bleed",e?.bleed??0),r("disrupt",e?.disrupt??0),t){const o=document.createElement("span");o.className="stEmoji",o.textContent=`${Un.immune}1`,n.appendChild(o)}return n}let q=null,Kn=!1,O=null,Te=null,nn=!1,We=!1,ke=null,Re=null,Ie=null;function zn(e,t,n){const r=e.cards[t];return Sr(e,r.defId,n)}function qe(e,t,n){const o=pt(e,t,!!n,n,{draggable:!1});return o.classList.add("overlayCard"),o}function Sr(e,t,n){const r=`__preview:${t}:${n}:${Math.random().toString(36).slice(2)}`,o=e.cards[r];e.cards[r]={uid:r,defId:t,upgrade:n,zone:"preview"};const s=pt(e,r,!1,void 0,{draggable:!1});return s.classList.add("overlayCard"),s.draggable=!1,s.style.pointerEvents="none",o?e.cards[r]=o:delete e.cards[r],s}const et="Ô∏é";function lt(e,t){return e==="BATTLE"?t?{icon:"‚ò†"+et,text:"Î≥¥Ïä§",kind:"boss"}:{icon:"‚öî"+et,text:"Ï†ÑÌà¨",kind:"battle"}:e==="ELITE"?{icon:"‚ò†"+et,text:"Ï†ïÏòà",kind:"elite"}:e==="REST"?{icon:"‚õ∫Ô∏é"+et,text:"Ìú¥Ïãù",kind:"rest"}:e==="EVENT"?{icon:"‚ùîÔ∏é"+et,text:"ÎØ∏ÏßÄ",kind:"event"}:{icon:"‚ú¶",text:"Î≥¥Î¨º",kind:"treasure"}}function sa(e,t,n){const r=lt(t,n),o=document.createElement("span");o.className=`nodeIcon ${r.kind}`,o.textContent=r.icon;const s=document.createElement("span");s.className="nodeText",s.textContent=`(${r.text})`,e.appendChild(o),e.appendChild(s)}function jn(e){let t=2166136261;for(let n=0;n<e.length;n++)t^=e.charCodeAt(n),t=Math.imul(t,16777619);return t>>>0}function aa(e){let t=e>>>0;return t^=t<<13,t^=t>>>17,t^=t<<5,(t>>>0)/4294967296}function Ae(e){return Math.max(0,Math.min(1,e))}function Kt(e,t,n){return Math.max(t,Math.min(n,Math.floor(e)))}function ft(e){const t=e.run;if(t.timeMove??=0,t.vision??={mode:"NORMAL",presenceR:2,typeR:1,detailR:0,noise:.01*e.player.fatigue},t.pursuit??={heat:0},!t.map)t.map=da();else{const o=t.map;if(Array.isArray(o.nodes)){const s={};for(const a of o.nodes)s[String(a.id)]=a;o.nodes=s}}const n=t.map;if(!Object.keys(n?.nodes??{}).every(o=>typeof n.nodes[o]?.order=="number"))try{$r(n,2)}catch{}try{kn(n)}catch{}return{map:t.map,vision:t.vision,pursuit:t.pursuit,timeMove:t.timeMove}}function _r(e){const t=e.run,n=Number(t.timeMove??0)||0,r=Number(e.time??0)||0;return n+r}function ct(e){return e>=14?3:e>=9?2:e>=5?1:0}function ia(e){const{map:t,pursuit:n}=ft(e),r=ct(n.heat??0);if(r<=0)return;const o=.05+.04*r;if(Math.random()>=o)return;const s=t.edges??={},a=Object.keys(t.nodes);if(a.length<4)return;const i=m=>Number(t.nodes[m]?.depth??999),l=m=>Number(t.nodes[m]?.order??0),c=(m,k)=>{s[m]??=[],s[k]??=[],s[m].includes(k)||s[m].push(k),s[k].includes(m)||s[k].push(m)},h=(m,k)=>{s[m]=(s[m]??[]).filter(M=>M!==k),s[k]=(s[k]??[]).filter(M=>M!==m)},u=m=>{const k=new Set,M=[m];for(k.add(m);M.length;){const T=M.shift();for(const H of s[T]??[])k.has(H)||(k.add(H),M.push(H))}return k},d=new Map;for(const m of a){const k=i(m);d.has(k)||d.set(k,[]),d.get(k).push(m)}for(const[m,k]of d)k.sort((M,T)=>l(M)-l(T)||M.localeCompare(T));const x=Array.from(d.keys()).filter(m=>d.has(m)&&d.has(m+1));if(x.length===0)return;const $=m=>{const k=d.get(m)??[],M=d.get(m+1)??[],T=new Map,H=new Map;for(let E=0;E<k.length;E++)T.set(k[E],E);for(let E=0;E<M.length;E++)H.set(M[E],E);const I=[];for(const E of k)for(const _ of s[E]??[]){if(i(_)!==m+1)continue;const N=T.get(E),C=H.get(_);N==null||C==null||I.push([N,C])}return{left:k,right:M,li:T,ri:H,pairs:I}},f=(m,k,M)=>{const{li:T,ri:H,pairs:I}=$(m),E=T.get(k),_=H.get(M);if(E==null||_==null)return!0;for(const[N,C]of I)if(E<N&&_>C||E>N&&_<C)return!0;return!1},p=(m,k)=>{if((s[m]??[]).includes(k))return!1;const M=i(m),T=i(k);if(Math.abs(M-T)!==1)return!1;const H=Math.min(M,T),I=M<T?m:k,E=M<T?k:m;return f(H,I,E)?!1:(c(I,E),!0)};if(Math.random()<.55){for(let m=0;m<80;m++){const k=x[Math.floor(Math.random()*x.length)],{left:M,right:T}=$(k);if(!M.length||!T.length)continue;const H=M[Math.floor(Math.random()*M.length)],I=T[Math.floor(Math.random()*T.length)];if(p(H,I)){y(e,`ÎåÄÍ≤©Î≥Ä: Í∏∏Ïù¥ ÏÉàÎ°ú Ïó¥Î†∏ÏäµÎãàÎã§. (${H} ‚Üî ${I})`);return}}return}const g=[];for(const m of a)for(const k of s[m]??[])m>=k||Math.abs(i(m)-i(k))===1&&g.push([m,k]);if(g.length!==0)for(let m=0;m<120;m++){const[k,M]=g[Math.floor(Math.random()*g.length)],T=(s[k]??[]).length,H=(s[M]??[]).length;if(T<=1||H<=1)continue;h(k,M);const I=Object.values(t.nodes).find(_=>_.kind==="START")?.id??t.pos;if(u(I).size===a.length&&a.every(_=>(s[_]??[]).length>=1)){y(e,`ÎåÄÍ≤©Î≥Ä: Í∏∏Ïù¥ Î¨¥ÎÑàÏ°åÏäµÎãàÎã§. (${k} ‚Üî ${M})`);return}c(k,M)}}function Ge(e,t,n){const r={},o=[];for(r[t]=0,o.push(t);o.length;){const s=o.shift(),a=r[s]??0;if(a>=n)continue;const i=e.edges[s]??[];for(const l of i)r[l]==null&&(r[l]=a+1,o.push(l))}return r}function kn(e){const t=e;return t.seen||(t.seen={}),t.seen[e.pos]=3,t.seen}function la(e,t){const n=kn(e),r=Math.max(0,t.presenceR|0),o=Ge(e,e.pos,r);for(const s of Object.keys(o)){const a=o[s]??0,i=Mt(a,t),l=n[s]??0;i>l&&(n[s]=i)}n[e.pos]=3}function ca(e,t){return(e.seen??{})[t]??0}function $r(e,t=2){const n=Object.keys(e.nodes);if(n.length<=2)return;e.edges??={};for(const u of Object.keys(e.edges))for(const d of(e.edges[u]??[]).slice())e.edges[d]??=[],e.edges[d].includes(u)||e.edges[d].push(u);const r=u=>Number(e.nodes[u]?.depth??999),o=u=>Number(e.nodes[u]?.order??0),s=u=>(e.edges[u]??[]).length,a=n.every(u=>{const d=r(u);return d>=0&&d<900&&typeof e.nodes[u]?.order=="number"}),i=new Map;if(a){for(const u of n){const d=r(u);i.has(d)||i.set(d,[]),i.get(d).push(u)}for(const[u,d]of i)d.sort((x,$)=>o(x)-o($)||x.localeCompare($))}const l=u=>{const d=i.get(u)??[],x=i.get(u+1)??[],$=new Map,f=new Map;for(let b=0;b<d.length;b++)$.set(d[b],b);for(let b=0;b<x.length;b++)f.set(x[b],b);const p=[];for(const b of d)for(const g of e.edges[b]??[]){if(r(g)!==u+1)continue;const m=$.get(b),k=f.get(g);m==null||k==null||p.push([m,k])}return{left:d,right:x,li:$,ri:f,pairs:p}},c=(u,d)=>{const x=r(u);if(r(d)!==x+1)return!0;const{li:f,ri:p,pairs:b}=l(x),g=f.get(u),m=p.get(d);if(g==null||m==null)return!0;for(const[k,M]of b)if(g<k&&m>M||g>k&&m<M)return!0;return!1},h=u=>{e.edges[u]??=[];const d=new Set(e.edges[u]??[]),x=r(u);let $=n.filter(p=>p!==u&&!d.has(p));if($.length===0||a&&($=$.filter(p=>Math.abs(r(p)-x)===1),$.length===0||($=$.filter(p=>{const b=r(u),g=r(p),m=b<g?u:p,k=b<g?p:u;return!c(m,k)}),$.length===0)))return!1;$.sort((p,b)=>s(b)-s(p));const f=$[0];return e.edges[u].push(f),e.edges[f]??=[],e.edges[f].push(u),!0};for(let u=0;u<200;u++){const d=n.filter($=>s($)<t);if(d.length===0)break;let x=!1;for(const $ of d)for(;s($)<t&&h($);)x=!0;if(!x)break}}function da(){const t={},n={},r=Array.from({length:18},(h,u)=>`n${u}`);n[r[0]]=[],t[r[0]]={id:r[0],kind:"START",visited:!0,cleared:!0,depth:0};for(let h=1;h<r.length;h++){const u=r[h],d=r[Math.floor(Math.random()*h)];n[u]??=[],n[d]??=[],n[u].push(d),n[d].push(u),t[u]={id:u,kind:"BATTLE",visited:!1,cleared:!1}}const o=10;for(let h=0;h<o;h++){const u=r[Math.floor(Math.random()*r.length)],d=r[Math.floor(Math.random()*r.length)];u!==d&&(n[u]??=[],n[d]??=[],!n[u].includes(d)&&(n[u].push(d),n[d].push(u)))}const s={pos:r[0],startId:r[0],nodes:t,edges:n,treasureId:r[r.length-1]};$r(s,2);const a=Ge(s,r[0],999);let i=r[1],l=-1;for(const h of r){const u=a[h]??999;t[h].depth=u,h!==r[0]&&u>l&&(l=u,i=h)}for(const h of r)h!==r[0]&&(t[h].kind="BATTLE");const c=["BATTLE","BATTLE","BATTLE","EVENT","REST","ELITE"];for(const h of r){if(h===r[0]||h===i)continue;const u=c[Math.floor(Math.random()*c.length)];t[h].kind=u}return t[i].kind="TREASURE",{pos:r[0],startId:r[0],nodes:t,edges:n,visionNonce:1,treasureId:i}}function ua(e){const{vision:t,pursuit:n}=ft(e),r=e.run,o=Number(r.timeMove??0)||0,s=t;s.forceModeUntilMove!=null&&o>=Number(s.forceModeUntilMove)&&(s.forceModeUntilMove=null,s.forceMode=null),s.switchLockedUntilMove!=null&&o>=Number(s.switchLockedUntilMove)&&(s.switchLockedUntilMove=null);let a=s.forceMode??t.mode??"NORMAL",i=Number(t.presenceR??2)||0,l=Number(t.typeR??1)||0,c=Number(t.detailR??0)||0,h=Ae(Number(t.noise??.08)||0);if(a==="FOCUS"?(i-=1,l-=1,c+=1,h*=.6):a==="WIDE"&&(i+=1,l+=1,c+=0,h=Ae(h*1.35)),e.run.treasureObtained){const d=ct(n.heat??0);i+=d>=2?1:0,l-=d,c-=Math.max(0,d-1),h=Ae(h+d*.07)}const u=Math.max(0,Number(e.player.fatigue??0)||0);if(u>0){const d=Math.floor(u/14),x=Math.floor(u/6),$=Math.floor(u/10);i-=d,l-=x,c-=$,h=Ae(h+Math.min(.3,u*.015))}return i=Kt(i,0,99),l=Kt(l,0,i),c=Kt(c,0,l),h=Ae(h),{mode:a,presenceR:i,typeR:l,detailR:c,noise:h}}function Mt(e,t){return e<=0||e<=t.detailR?3:e<=t.typeR?2:e<=t.presenceR?1:0}function Nt(e,t,n,r,o){if(r===0)return{shown:null,label:"Î≥¥Ïù¥ÏßÄ ÏïäÏùå",certainty:"HIDDEN"};if(r===1)return{shown:null,label:"Î¨¥Ïñ∏Í∞Ä",certainty:"PRESENCE"};if(n==="START")return{shown:null,label:"ÏûÖÍµ¨",certainty:r===3?"DETAIL":"TYPE"};if(n==="EMPTY")return{shown:null,label:"ÏßÄÎÇòÍ∞Ñ Í≥≥",certainty:"PRESENCE"};if(r===3)return{shown:n,label:lt(n,!1).text,certainty:"DETAIL"};const s=jn(t)^Math.imul(jn(String(e.run.map?.visionNonce??1)),2654435761);return aa(s)<o.noise?{shown:null,label:"Î¨¥Ïñ∏Í∞Ä",certainty:"PRESENCE"}:{shown:n,label:lt(n,!1).text,certainty:"TYPE"}}function pa(e,t){const n=v("mapNodeLine");if(n.style.cssText=`display:flex; gap:${A(8)}px; align-items:center;`,t.shown)sa(n,t.shown,!1);else{const r=document.createElement("span");r.className="nodeText",r.textContent=`(${t.label})`,n.appendChild(r)}e.appendChild(n)}function fa(e){const t=Object.keys(e.nodes);if(t.length===0||t.every(s=>{const a=e.nodes[s]?.depth,i=Number(a);return a!=null&&Number.isFinite(i)&&i>=0&&i<900}))return;const r=Object.values(e.nodes).find(s=>s.kind==="START")?.id??e.pos??t[0],o=Ge(e,r,999);for(const s of t){const a=e.nodes[s]?.depth;if(a!=null&&Number.isFinite(Number(a))&&Number(a)<900)continue;const i=o[s];e.nodes[s].depth=i??e.nodes[s].depth??999}}function ha(e){fa(e);const t=Object.keys(e.nodes),n=t.every(E=>typeof e.nodes[E]?.order=="number"),r=new Map;let o=0;for(const E of t){const _=Number(e.nodes[E]?.depth??999),N=Number.isFinite(_)?_:999;o=Math.max(o,N),r.has(N)||r.set(N,[]),r.get(N).push(E)}const s=Array.from(r.keys()).sort((E,_)=>E-_),a=s.filter(E=>E<900).length?Math.max(...s.filter(E=>E<900)):o,i=s.some(E=>E>=900),l=a+(i?1:0),c=110,h=64,u=54,d=40,x=E=>{const _=Number(e.nodes[E]?.depth??999),N=Number.isFinite(_)?_:999;return N>=900?a+1:N},$=Array.from({length:l+1},(E,_)=>_),f={};for(const E of $)f[E]=[];for(const E of t){const _=x(E);f[_].push(E)}for(const E of $)f[E].sort((_,N)=>(e.nodes[_].order??0)-(e.nodes[N].order??0)||_.localeCompare(N));const p=E=>{const _=new Map,N=f[E]??[];for(let C=0;C<N.length;C++)_.set(N[C],C);return _},b=E=>e.edges[E]??[],g=E=>{if(E==="LR")for(let _=1;_<=l;_++){const N=f[_-1];if(!N||N.length===0)continue;const C=p(_-1);f[_].sort((w,S)=>{const D=m(w,C,_-1),F=m(S,C,_-1);return D!==F?D-F:w.localeCompare(S)})}else for(let _=l-1;_>=0;_--){const N=f[_+1];if(!N||N.length===0)continue;const C=p(_+1);f[_].sort((w,S)=>{const D=m(w,C,_+1),F=m(S,C,_+1);return D!==F?D-F:w.localeCompare(S)})}},m=(E,_,N)=>{const C=b(E);let P=0,w=0;for(const S of C){if(x(S)!==N)continue;const D=_.get(S);D!=null&&(P+=D,w+=1)}if(w===0){const S=x(E),D=(f[S]??[]).indexOf(E);return D<0?9999:D}return P/w};if(!n)for(let E=0;E<4;E++)g("LR"),g("RL");let k=1;for(const E of $)k=Math.max(k,f[E]?.length??0);const M=k*h,T=d*2+M,H=u*2+(l+1)*c,I={};for(const E of $){const _=f[E]??[],N=_.length,C=N*h,P=(M-C)/2,w=u+E*c;for(let S=0;S<N;S++){const D=_[S],F=d+P+(S+.5)*h;I[D]={x:w,y:F,depth:Number(e.nodes[D]?.depth??999)}}}return{width:H,height:T,pos:I,maxDepth:l,maxCount:k}}function ma(e,t,n){return n?"‚óé":t==="HIDDEN"?"":t==="PRESENCE"?"¬∑":e?lt(e,!1).icon:"?"}function ba(e,t,n,r,o,s){const a=ha(r),i=kn(r),l=Ge(r,r.pos,Math.max(0,o.presenceR|0)),c=U=>U===r.pos||(i[U]??0)>0,h=Object.keys(r.nodes).filter(c);h.includes(r.pos)||h.push(r.pos);const u=70;let d=1/0,x=1/0,$=-1/0,f=-1/0;for(const U of h){const z=a.pos[U];z&&(d=Math.min(d,z.x),x=Math.min(x,z.y),$=Math.max($,z.x),f=Math.max(f,z.y))}Number.isFinite(d)||(d=0,x=0,$=300,f=200);const p=d-u,b=x-u,g=$-d+u*2,m=f-x+u*2,k=1.4,M=460,T="#0B0B0B",H="#B34A46",I="#1A0B0B",E="rgba(242,241,234,.70)",_="rgba(242,241,234,.34)",N="rgba(242,241,234,1)",C="rgba(179,74,70,.34)",P=I,w=T,S=v("mapMiniBox");S.style.cssText=`margin-top:${A(12)}px; border:1px solid rgba(255,255,255,.12); border-radius:${A(12)}px; background:rgba(0,0,0,.18); padding:${A(10)}px;`;const D=G("","ÏßÄÎèÑ");D.style.cssText=`font-weight:700; margin-bottom:${A(8)}px; opacity:.95;`,S.appendChild(D);const F=v("mapMiniScroller"),L=v("mapMiniViewport");F.appendChild(L),F.style.cssText=`position:relative; overflow:auto; max-height:${A(M)}px; border-radius:${A(10)}px; background:rgba(255,255,255,.02);`,L.addEventListener("wheel",U=>{Math.abs(U.deltaY)>Math.abs(U.deltaX)&&(L.scrollLeft+=U.deltaY,U.preventDefault())},{passive:!1});const W=document.createElementNS("http://www.w3.org/2000/svg","svg");W.setAttribute("viewBox",`${p} ${b} ${g} ${m}`),W.setAttribute("width",String(A(g*k))),W.setAttribute("height",String(A(m*k))),W.setAttribute("preserveAspectRatio","xMidYMid meet"),W.style.display="block";const B=document.createElementNS("http://www.w3.org/2000/svg","g"),K=document.createElementNS("http://www.w3.org/2000/svg","g");W.appendChild(B),W.appendChild(K);const j=new Set(r.edges[r.pos]??[]),Y=(U,z,Q)=>{const ee=Math.max(0,Math.min(3,Q));return Nt(t,U,z,ee,{...o,noise:0})},J=(U,z)=>{const Q=U.x,ee=U.y,se=z.x,ae=z.y,pe=Math.abs((U.depth??0)-(z.depth??0));if(pe===0)return`M ${Q} ${ee} L ${se} ${ae}`;if(pe>=2){const Lt=38+10*pe,ie=Math.max(Q,se)+Lt;return`M ${Q} ${ee} C ${ie} ${ee}, ${ie} ${ae}, ${se} ${ae}`}const De=se-Q,ve=Q+De*.35,Xe=Q+De*.65;return`M ${Q} ${ee} C ${ve} ${ee}, ${Xe} ${ae}, ${se} ${ae}`},ne=new Set(h);for(const U of h)for(const z of r.edges[U]??[]){if(U>=z||!ne.has(z))continue;const Q=r.nodes[U]?.depth,ee=r.nodes[z]?.depth;if(Q!=null&&ee!=null&&Math.abs(Number(Q)-Number(ee))>1)continue;const se=a.pos[U],ae=a.pos[z];if(!se||!ae)continue;const pe=document.createElementNS("http://www.w3.org/2000/svg","path");pe.setAttribute("d",J(se,ae)),pe.setAttribute("fill","none"),pe.setAttribute("stroke",E),pe.setAttribute("stroke-width","2"),B.appendChild(pe)}const He=h.slice().sort((U,z)=>U.localeCompare(z));for(const U of He){const z=a.pos[U];if(!z)continue;const Q=r.nodes[U],ee=Q?.kind??"BATTLE",se=l[U],ae=U===r.pos?3:se==null?0:Mt(se,o),pe=i[U]??0,De=ae>0?Nt(t,U,ee,ae,o):Y(U,ee,pe),ve=U===r.pos,Xe=j.has(U),Lt=ee==="START";if(ve){const de=document.createElementNS("http://www.w3.org/2000/svg","circle");de.setAttribute("cx",String(z.x)),de.setAttribute("cy",String(z.y)),de.setAttribute("r",String(22)),de.setAttribute("fill","none"),de.setAttribute("stroke",H),de.setAttribute("stroke-width",String(3.5)),de.setAttribute("opacity","0.55"),de.style.filter="drop-shadow(0 0 6px rgba(179,74,70,.65))",K.appendChild(de);const we=document.createElementNS("http://www.w3.org/2000/svg","circle");we.setAttribute("cx",String(z.x)),we.setAttribute("cy",String(z.y)),we.setAttribute("r",String(32)),we.setAttribute("fill","none"),we.setAttribute("stroke",H),we.setAttribute("stroke-width","2"),we.setAttribute("opacity","0.18"),K.appendChild(we)}const ie=document.createElementNS("http://www.w3.org/2000/svg","circle");ie.setAttribute("cx",String(z.x)),ie.setAttribute("cy",String(z.y)),ie.setAttribute("r",String(ve?13:10));const vn=ve||Xe;ie.setAttribute("fill",vn?C:_),ie.setAttribute("stroke",vn?P:N),ie.setAttribute("stroke-width",String(ve?3:2)),ie.style.cursor=Xe&&!ve?"pointer":"default",Xe&&!ve&&ie.addEventListener("click",de=>{de.preventDefault(),de.stopPropagation(),n.onMoveToNode?.(U)});const wn=document.createElementNS("http://www.w3.org/2000/svg","title"),Dr=Q?.cleared?"ÌÅ¥Î¶¨Ïñ¥":Q?.visited?"Î∞©Î¨∏":"ÎØ∏Î∞©Î¨∏";wn.textContent=`${Dr}`,ie.appendChild(wn),K.appendChild(ie);const ce=document.createElementNS("http://www.w3.org/2000/svg","text");ce.setAttribute("x",String(z.x)),ce.setAttribute("y",String(z.y)),ce.setAttribute("dy","0.05em"),ce.setAttribute("dominant-baseline","central"),ce.setAttribute("text-anchor","middle"),ce.setAttribute("font-size","14"),ce.setAttribute("fill",w),ce.style.pointerEvents="none",ce.style.userSelect="none";const Or=ma(De.shown,De.certainty,Lt);ce.textContent=Or,ce.style.opacity="0.95",K.appendChild(ce)}L.appendChild(W),S.appendChild(F),requestAnimationFrame(()=>{const U=a.pos[r.pos];if(!U)return;const z=xr(),Q=(U.x-p)*z*k,ee=(U.y-b)*z*k,se=Math.max(0,Q-L.clientWidth*.45),ae=Math.max(0,ee-L.clientHeight*.45);L.scrollLeft=se,L.scrollTop=ae});const $e=G("","Í¥ÄÏ∏° Í∞ÄÎä•Ìïú Í≥≥Îßå ÏßÄÎèÑÏóê ÎìúÎü¨ÎÇ©ÎãàÎã§. Ïù∏Ï†ë ÎÖ∏ÎìúÎ•º ÌÅ¥Î¶≠Ìï¥ Ïù¥ÎèôÌï† Ïàò ÏûàÏäµÎãàÎã§.");$e.style.cssText=`margin-top:${A(8)}px; font-size:12px; opacity:.8; line-height:1.3;`,S.appendChild($e),e.appendChild(S)}function ya(e,t,n){const{map:r,timeMove:o,pursuit:s}=ft(t),a=ua(t);la(r,a);const i=v("nodeSelectWrap");i.classList.add("mapNodeSelect");const l=v("nodeSelectHeader");l.style.cssText="display:flex; align-items:flex-end; justify-content:space-between; gap:16px;";const c=v("nodeSelectTitle"),h=_r(t),u=t.run.nodePickCount??0;c.appendChild(G("",`Ï¥ù ÏãúÍ∞Ñ ${h} ¬∑ ÌÉêÌóò ${u} ¬∑ Ïù¥Îèô ${o}`)),kr(t);const d=t.run,x=Number(d.nextBossTime??40)||40,$=Math.max(0,x-h),f=t.run.bossOmenText&&String(t.run.bossOmenText).trim()!==""?String(t.run.bossOmenText):"ÏïÑÏßÅ ÏßïÏ°∞Í∞Ä ÏóÜÎã§.";if(c.appendChild(G("",`Îã§Ïùå Î≥¥Ïä§ÍπåÏßÄ ${$} ¬∑ ${f}`)),t.run.treasureObtained){const m=Ge(r,r.pos,9999)[r.startId],k=m==null?"?":String(m);c.appendChild(G("",`Ï∂îÍ≤© ${s.heat??0} (tier ${ct(s.heat??0)}) ¬∑ ÏûÖÍµ¨ÍπåÏßÄ ${k}`))}const p=v("nodeSelectHeaderRight"),b=G("",`Ïò§Î•ò ${Math.round(a.noise*100)}%`);b.style.opacity="0.8",p.appendChild(b);const g=re(We?"ÏÉÅÏÑ∏ Îã´Í∏∞":"ÏÉÅÏÑ∏",()=>{We=!We,R(t,n)});if(g.style.cssText=`margin-left:${A(-10)}px; padding:${A(2)}px ${A(5)}px; opacity:.9;`,p.appendChild(g),l.appendChild(c),l.appendChild(p),i.appendChild(l),ba(i,t,n,r,a),We){const m=v("mapDetailPanel");m.style.cssText=`position:fixed; right:${A(24)}px; top:${A(24)}px; width:min(${A(520)}px, calc(100vw - ${A(64)}px)); max-height:calc(100vh - ${A(64)}px); overflow-y:auto; overflow-x:hidden; z-index:70001; border:1px solid rgba(255,255,255,.14); border-radius:${A(14)}px; background:rgba(0,0,0,1); backdrop-filter:none; padding:${A(12)}px;`,m.addEventListener("click",N=>N.stopPropagation()),m.addEventListener("wheel",N=>N.stopPropagation(),{passive:!0});const k=N=>{const C=N.target;C&&m.contains(C)||(We=!1,document.removeEventListener("pointerdown",k,!0),R(t,n))},M=v("");M.style.cssText=`display:flex; align-items:center; justify-content:space-between; gap:${A(10)}px;`;const T=G("","ÏßÄÎèÑ ÏÉÅÏÑ∏");T.style.cssText="font-weight:700; opacity:.95;",M.appendChild(T);const H=re("Îã´Í∏∞",()=>{We=!1,R(t,n)});H.style.cssText=`padding:${A(6)}px ${A(10)}px; opacity:.9;`,M.appendChild(H),m.appendChild(M);const I=v("");I.style.cssText=`margin-top:${A(10)}px; padding:${A(10)}px; border:1px solid rgba(255,255,255,.10); border-radius:${A(12)}px; background:rgba(255,255,255,.03);`;const E=Zt("Ïù¥Îèô Í∞ÄÎä•Ìïú Ïù¥ÏõÉ");E.style.margin=`0 0 ${A(6)}px 0`,I.appendChild(E);const _=r.edges[r.pos]??[];_.length===0&&I.appendChild(xn("Ïù¥ÏõÉÏù¥ ÏóÜÏäµÎãàÎã§."));for(let N=0;N<_.length;N++){const C=_[N],w=r.nodes[C]?.kind??"BATTLE",S=a.presenceR>=1?Mt(1,a):0,D=ca(r,C),F=S>0?Nt(t,C,w,S,a):D>=2?w==="START"?{shown:null,label:"ÏûÖÍµ¨"}:{shown:w,label:lt(w,!1).text}:D===1?{shown:null,label:"Î¨¥Ïñ∏Í∞Ä"}:{shown:null,label:"Î≥¥Ïù¥ÏßÄ ÏïäÏùå"},L=v("");L.style.cssText=`display:flex; align-items:center; gap:${A(10)}px; padding:${A(8)}px ${A(10)}px; border-radius:${A(10)}px; border:1px solid rgba(255,255,255,.10); background:rgba(0,0,0,.20);margin-top:${A(6)}px;`;const W=G("",S>0||D>0?`${C}`:`Ï∂úÍµ¨ ${N+1}`);W.style.cssText=`flex:0 0 auto; padding:${A(4)}px ${A(8)}px; border-radius:${A(10)}px; border:1px solid rgba(255,255,255,.14); background:rgba(0,0,0,.25); opacity:.9;`,L.appendChild(W);const B=v("");B.style.cssText="flex:1 1 auto; min-width:0;",pa(B,F),L.appendChild(B),I.appendChild(L)}if(m.appendChild(I),a.presenceR>=2){const N=Ge(r,r.pos,a.presenceR),C=Object.keys(N).filter(P=>(N[P]??999)>=2&&(N[P]??999)<=a.presenceR).sort((P,w)=>N[P]-N[w]||P.localeCompare(w));if(C.length){const P=v("");P.style.cssText=`margin-top:${A(10)}px; padding:${A(10)}px; border:1px solid rgba(255,255,255,.10); border-radius:${A(12)}px; background:rgba(255,255,255,.03);`;const w=Zt("Î©ÄÎ¶¨ Î≥¥Ïù¥Îäî Í≥≥");w.style.margin=`0 0 ${A(6)}px 0`,P.appendChild(w);const S=new Map;for(const F of C){const L=N[F]??0,B=r.nodes[F]?.kind??"BATTLE",K=Mt(L,a),j=Nt(t,F,B,K,a),Y=j.certainty==="PRESENCE"?"Î¨¥Ïñ∏Í∞Ä":j.label,J=S.get(L)??{};J[Y]=(J[Y]??0)+1,S.set(L,J)}const D=Array.from(S.keys()).sort((F,L)=>F-L);for(const F of D){const L=S.get(F),W=Object.keys(L).map(B=>`${B}√ó${L[B]}`);P.appendChild(G("",`Í±∞Î¶¨ ${F}: ${W.join(" ¬∑ ")}`))}m.appendChild(P)}}document.addEventListener("pointerdown",k,!0),e.appendChild(m)}e.appendChild(i)}function xa(e,t,n){ft(t),ya(e,t,n)}function Mr(e,t){let n=null,r=!1,o=!1;const s=[];function a(f){s.length=0,f.choice=null,n=null,document.querySelector(".choice-overlay")?.remove()}function i(f){s.push({choice:f.choice,handler:n})}function l(f){const p=s.pop();if(!p){c(f);return}f.choice=p.choice,n=p.handler}function c(f){if(s.length>0){l(f);return}f.choice=null,n=null,document.querySelector(".choice-overlay")?.remove()}function h(f,p,b){f.choice&&i(f),f.choice=p,n=b}const u=()=>xe||e,d={onHotkeySlot:(f,p)=>{const b=u();if(b.run.finished||Z(b)||b.phase!=="PLACE"||f==="back"&&b.backSlotDisabled?.[p])return;const g=f==="front"?b.frontSlots:b.backSlots,m=g[p];if(!b.selectedHandCardUid){if(!m)return;d.onReturnSlotToHand(f,p);return}const k=b.selectedHandCardUid;if(!m){d.onPlaceHandUidToSlot(k,f,p);return}g[p]=null,b.usedThisTurn=Math.max(0,b.usedThisTurn-1),f==="front"&&(b.frontPlacedThisTurn=Math.max(0,b.frontPlacedThisTurn-1)),b.hand.push(m),b.cards[m].zone="hand",Mn(b,k,f,p),b.selectedHandCardUid=null,y(b,`[${ue(b,k)}] ‚Üî [${ue(b,m)}] Ïä§Ïôë: ÏÜêÌå® ‚Üî ${f}${p+1}`),R(b,d)},rerender:()=>{const f=u();R(f,d)},onToggleLogOverlay:()=>{nn=!nn,R(u(),d)},onCloseOverlay:()=>{const f=u();q=null,R(f,d)},onNewRun:()=>{const f=u();Te=null,q=null,O=null,c(f),Cs(),t(Vt(f.content))},onViewRulebook:()=>{const f=u();q={kind:"RULEBOOK"},R(f,d)},onViewPile:f=>{const p=u();q={kind:"PILE",pile:f},R(p,d)},onViewSettings:()=>{const f=u();q={kind:"SETTINGS"},R(f,d)},onReturnSlotToHand:(f,p)=>{const b=u();if(b.run.finished||Z(b)||b.phase!=="PLACE")return;const g=f==="front"?b.frontSlots:b.backSlots,m=g[p];m&&(g[p]=null,b.usedThisTurn=Math.max(0,b.usedThisTurn-1),f==="front"&&(b.frontPlacedThisTurn=Math.max(0,b.frontPlacedThisTurn-1)),b.hand.push(m),b.cards[m].zone="hand",y(b,`[${ue(b,m)}] ÌöåÏàò: ${f}${p+1} ‚Üí ÏÜêÌå®`),R(b,d))},onClearSelected:()=>{const f=u();f.selectedHandCardUid=null,R(f,d)},onSelectEnemy:f=>{const p=u();if(o)return;o=!0,requestAnimationFrame(()=>{o=!1});const b=rs(p,f);R(p,d),b&&!p.choice&&!p.run.finished&&d.onAutoAdvance()},onSelectHandCard:f=>{const p=u();Z(p)||(p.selectedHandCardUid=p.selectedHandCardUid===f?null:f,R(p,d))},onMoveToNode:f=>{const p=u();if(p.run.finished||p.choice||p.phase!=="NODE"||r)return;r=!0,setTimeout(()=>r=!1,180);const b=p.run,{map:g,pursuit:m}=ft(p),k=g.pos;if(!(g.edges[k]??[]).includes(f))return;b.timeMove=Number(b.timeMove??0)+1,g.visionNonce=Number(g.visionNonce??0)+1,g.pos=f;const T=g.nodes[f]??(g.nodes[f]={id:f,kind:"BATTLE"}),H=!T.visited;if(H&&(T.visited=!0,p.run.nodePickCount=(p.run.nodePickCount??0)+1),p.run.treasureObtained){if(m.heat=Number(m.heat??0)+1,ct(m.heat),ia(p),g.pos===g.startId){p.run.finished=!0,y(p,"Î≥¥Î¨ºÏùÑ Îì§Í≥† ÏûÖÍµ¨Î°ú ÎèåÏïÑÏôîÎã§! ÌÉàÏ∂úÏóê ÏÑ±Í≥µÌñàÏäµÎãàÎã§!"),R(p,d);return}H&&T.kind!=="TREASURE"&&T.kind!=="START"&&(p.run.afterTreasureNodePicks=(p.run.afterTreasureNodePicks??0)+1)}kr(p);const I=_r(p);if(Number(b.nextBossTime??0)>0&&I>=Number(b.nextBossTime??0)){b.forcedNext=null,b.nextBossTime=Number(b.nextBossTime??0)+40,p.run.bossOmenText=null,T.cleared=!0,T.kind="EMPTY",T.noRespawn=!0,T.lastClearedMove=Number(b.timeMove??0),y(p,"ÏãúÍ∞ÑÏù¥ Îã§ ÎêòÏñ¥ Î≥¥Ïä§Í∞Ä ÎÇòÌÉÄÎÇ©ÎãàÎã§. (ÏãúÍ∞Ñ +1)"),Be(p,{forceBoss:!0}),Je(p),R(p,d);return}const E=Number(b.timeMove??0)||0;T.cleared&&(T.kind==="BATTLE"||T.kind==="EVENT"||T.kind==="REST"||T.kind==="ELITE")&&(T.kind==="ELITE"&&(T.noRespawn=!0),T.kind="EMPTY",T.lastClearedMove=Number(T.lastClearedMove??E));let _=T.kind;if(_==="EMPTY"){const N=!!T.noRespawn,C=Number(T.lastClearedMove??-999),P=Number(b.respawnCooldownMoves??2)||2,w=E-C<=P;if(!N&&!w){const S=p.run.treasureObtained?ct(m.heat):0,D=Math.max(0,Number(p.player.fatigue??0)||0),F=Ae(D/25)*.18,L=p.run.treasureObtained?.22:.12,W=p.run.treasureObtained?.1:.08,B=Ae(L+S*W+F);if(Math.random()<B){const K=Math.random(),j=p.run.treasureObtained?.72:.55,Y=p.run.treasureObtained?.9:.85;_=K<j?"BATTLE":K<Y?"EVENT":"REST",T.kind=_,T.cleared=!1,T.respawnCount=Number(T.respawnCount??0)+1,y(p,"Ïû¨Î∞úÎèô: Ïù¥Í≥≥ÏóêÏÑú Îã§Ïãú Î¨¥Ïñ∏Í∞ÄÍ∞Ä ÏùºÏñ¥ÎÇ©ÎãàÎã§...")}}}if(_==="START"){R(p,d);return}if(_==="TREASURE"){T.cleared=!0,T.kind="EMPTY",T.noRespawn=!0,T.lastClearedMove=E,_o(p),R(p,d);return}if(_==="REST"){T.cleared=!0,T.kind="EMPTY",T.lastClearedMove=E;const N=(p.player.fatigue??0)>=10;p.choice={kind:"EVENT",title:"Ìú¥Ïãù",art:me("assets/events/event_rest.png"),prompt:N?"ÌîºÎ°úÍ∞Ä ÎÑàÎ¨¥ ÎÜíÏïÑ ÏãúÍ∞ÑÏù¥ Îçî Í±∏Î¶¥ Ïàò ÏûàÏäµÎãàÎã§.":"Ï∫†ÌîÑÏóê Ïû†Ïãú Î®∏Î¨∏Îã§.",options:[{key:"rest:heal",label:"ÌöåÎ≥µ",detail:"HP +15"},{key:"rest:clear_f",label:"Ï†ïÎπÑ",detail:"F -3"},{key:"rest:upgrade",label:"Í∞ïÌôî",detail:"Ïπ¥Îìú 1Ïû• Í∞ïÌôî"},{key:"rest:skip",label:"Îñ†ÎÇòÍ∏∞"}]},p.choiceCtx={kind:"REST",highF:N},R(p,d);return}if(_==="EVENT"){T.cleared=!0,T.kind="EMPTY",T.lastClearedMove=E;const N=p.run;N.ominousProphecySeen??=!1;const C=.3;let P=In(p);if(N.ominousProphecySeen===!0)for(let S=0;S<50&&P.id==="ominous_prophecy";S++)P=In(p);else Math.random()<C&&(P=fr("ominous_prophecy")??P,N.ominousProphecySeen=!0);if(!P){R(p,d);return}let w=P.options(p);p.choice={kind:"EVENT",title:P.name,prompt:P.prompt,art:P.art??null,options:w.map(S=>({key:S.key,label:S.label,detail:S.detail}))},n=S=>{const D=w.find(W=>W.key===S);if(!D)return;const F=ge(p);F.eventPicks+=1,ye(p);const L=D.apply(p);if(typeof L=="object"&&L.kind==="UPGRADE_PICK"){$(p,d,L.title??"Í∞ïÌôî",L.prompt??"Í∞ïÌôîÌï† Ïπ¥Îìú 1Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.");return}if(typeof L=="object"&&L.kind==="REMOVE_PICK"){const W=Object.values(p.cards).filter(B=>B.zone==="deck"||B.zone==="hand"||B.zone==="discard").map(B=>B.uid);h(p,{kind:"PICK_CARD",title:L.title,prompt:L.prompt??"Ï†úÍ±∞Ìï† Ïπ¥Îìú 1Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.",options:[...W.map(B=>{const K=St(p,B);return{key:`remove:${B}`,label:ue(p,B),detail:`Ï†ÑÏó¥: ${K.frontText} / ÌõÑÏó¥: ${K.backText}`,cardUid:B}}),{key:"cancel",label:"Ï∑®ÏÜå"}]},B=>{if(B==="cancel"){y(p,"Ï†úÍ±∞ Ï∑®ÏÜå"),c(p),R(p,d);return}if(!B.startsWith("remove:")){R(p,d);return}const K=B.slice(7);Pt(p,K);const j=L.then,Y=j==="REWARD"||j==="REWARD_PICK"?"REWARD_PICK":j==="BATTLE"?"BATTLE":j==="NONE"?"NONE":void 0;if(Y==="BATTLE"){a(p),p.phase="NODE",Be(p),Je(p),R(p,d);return}if(Y==="REWARD_PICK"){a(p),x(p,d,"Ïπ¥Îìú Î≥¥ÏÉÅ","Îëê Ïû• Ï§ë Ìïú Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÍ±∞ÎÇò ÏÉùÎûµÌï©ÎãàÎã§."),R(p,d);return}a(p),p.phase="NODE",R(p,d)}),R(p,d);return}if(typeof L=="object"&&L.kind==="BATTLE_SPECIAL"){a(p),p.run.onWinGrantRelicId=L.onWinGrantRelicId??null,y(p,L.title?`Ïù¥Î≤§Ìä∏ Ï†ÑÌà¨: ${L.title}`:"Ïù¥Î≤§Ìä∏ Ï†ÑÌà¨ Î∞úÏÉù!");const W=p.run;W.pendingEventWinRelicId=L.onWinGrantRelicId??null,p.phase="NODE",Be(p,{forcePatternIds:L.enemyIds}),p._justStartedCombat=!0,Je(p),R(p,d);return}if(L==="BATTLE"){a(p),p.phase="NODE",Be(p),p._justStartedCombat=!0,Je(p),R(p,d);return}if(L==="REWARD"){a(p),x(p,d,"Ïπ¥Îìú Î≥¥ÏÉÅ","Îëê Ïû• Ï§ë Ìïú Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÍ±∞ÎÇò ÏÉùÎûµÌï©ÎãàÎã§."),R(p,d);return}c(p),R(p,d)},R(p,d);return}if(_==="BATTLE"||_==="ELITE"){T.cleared=!0,T.kind="EMPTY",T.lastClearedMove=E,_==="ELITE"&&(T.noRespawn=!0),y(p,"Ïù¥Îèô ÌõÑ Ï†ÑÌà¨ ÏãúÏûë (ÏãúÍ∞Ñ +1)"),_==="ELITE"?Be(p,{forceBoss:!1,forceElite:!0}):Be(p,{forceBoss:!1}),Je(p),R(p,d);return}R(p,d)},onChooseChoice:f=>{const p=u();if(!p.choice)return;const b=p.choice.kind;if(Ts(p,f)){const g=b==="EVENT"&&f==="startBattle";R(p,d),g||d.onAutoAdvance();return}if(n){n(f);const g=b==="EVENT"&&f==="startBattle";R(p,d),g||d.onAutoAdvance();return}y(p,`ÏÑ†ÌÉù Ï≤òÎ¶¨ Î∂àÍ∞Ä: handler ÏóÜÏùå (kind=${b}, key=${f})`)},onAutoAdvance:()=>{const f=u();Us(f,d)},onRevealIntents:()=>{const f=u();f.run.finished||f.enemies.length!==0&&(pn(f),R(f,d))},onPlaceHandUidToSlot:(f,p,b)=>{const g=u();g.run.finished||Z(g)||g.phase==="PLACE"&&(p==="back"&&g.backSlotDisabled?.[b]||(Mn(g,f,p,b),g.selectedHandCardUid=null,R(g,d)))},onPlaceSelected:(f,p)=>{const b=u();b.selectedHandCardUid&&d.onPlaceHandUidToSlot(b.selectedHandCardUid,f,p)},onMoveSlotCard:(f,p,b,g)=>{const m=u();if(m.run.finished||Z(m)||m.phase!=="PLACE"||b==="back"&&m.backSlotDisabled?.[g])return;const k=f==="front"?m.frontSlots:m.backSlots,M=b==="front"?m.frontSlots:m.backSlots,T=k[p];if(!T)return;const H=M[g];k[p]=H??null,M[g]=T,m.cards[T].zone=b,H&&(m.cards[H].zone=f),f!==b&&(f==="front"&&(m.frontPlacedThisTurn=Math.max(0,m.frontPlacedThisTurn-1)),b==="front"&&(m.frontPlacedThisTurn+=1),H&&(b==="front"&&(m.frontPlacedThisTurn=Math.max(0,m.frontPlacedThisTurn-1)),f==="front"&&(m.frontPlacedThisTurn+=1))),y(m,H?`[${ue(m,T)}] ‚Üî [${ue(m,H)}] Ïä§Ïôë: ${f}${p+1} ‚Üî ${b}${g+1}`:`[${ue(m,T)}] Ïù¥Îèô: ${f}${p+1} ‚Üí ${b}${g+1}`),rn(m),R(m,d)},onResolveBack:()=>{const f=u();f.phase==="PLACE"&&rn(f),qo(f),R(f,d)},onResolveFront:()=>{const f=u();Vo(f),R(f,d)},onResolveEnemy:()=>{const f=u();Go(f),R(f,d)},onUpkeep:()=>{const f=u();Jo(f),R(f,d)},onDrawNextTurn:()=>{const f=u();es(f),R(f,d)}};function x(f,p,b,g){const k=sr(f).map(M=>{const T=be(f.content,M.defId,M.upgrade);return{key:`pick:${M.defId}:${M.upgrade}`,label:Xs(f,M),detail:`Ï†ÑÏó¥: ${T.frontText} / ÌõÑÏó¥: ${T.backText}`}});f.choice={kind:"REWARD",title:b,prompt:g,options:[...k,{key:"skip",label:"ÏÉùÎûµ"}]},n=M=>{if(n=null,M.startsWith("pick:")){const T=M.slice(5),[H,I]=T.split(":"),E=Number(I??"0")||0;fn(f,H,{upgrade:E})}else y(f,"Ïπ¥Îìú Î≥¥ÏÉÅ ÏÉùÎûµ");c(f),f.choice=null,f.run.finished||(f.phase="NODE"),R(f,p)},R(f,p)}function $(f,p,b,g,m){let k=Object.values(f.cards).filter(I=>(I.zone==="deck"||I.zone==="hand"||I.zone==="discard")&&At(f,I.uid)).map(I=>I.uid);const M=f.player.fatigue??0;let T=1/0;if(M>=8?T=4:M>=5&&(T=8),T!==1/0&&k.length>T&&(k=[...k].sort(()=>Math.random()-.5).slice(0,T)),k.length===0){y(f,"Í∞ïÌôîÌï† Ïàò ÏûàÎäî Ïπ¥ÎìúÍ∞Ä ÏóÜÏäµÎãàÎã§."),f.choice=null,n=null,R(f,p);return}const H=[...k].sort((I,E)=>{const _=f.cards[I],N=f.cards[E],C=_t(f,_.defId),P=_t(f,N.defId),w=C.localeCompare(P,"ko");return w!==0?w:(_.upgrade??0)-(N.upgrade??0)});f.choice={kind:"UPGRADE_PICK",title:b,prompt:g,options:[...H.map(I=>{const E=f.cards[I],_=St(f,I),N=be(f.content,E.defId,(E.upgrade??0)+1),C=ue(f,I),P=`ÌòÑÏû¨: Ï†ÑÏó¥ ${_.frontText} / ÌõÑÏó¥ ${_.backText}
Í∞ïÌôî: Ï†ÑÏó¥ ${N.frontText} / ÌõÑÏó¥ ${N.backText}`;return{key:`up:${I}`,label:C,detail:P,cardUid:I}}),{key:"skip",label:"Ï∑®ÏÜå"}]},n=I=>{if(I==="skip"){y(f,"Í∞ïÌôî Ï∑®ÏÜå"),c(f),R(f,p);return}if(I.startsWith("up:")){const E=I.slice(3),_=ir(f,E);y(f,_?`Í∞ïÌôî: [${ue(f,E)}]`:"Í∞ïÌôî Ïã§Ìå®"),c(f),R(f,p);return}c(f),R(f,p)},R(f,p)}return d}function rn(e){const t=e.frontSlots.filter(r=>r!=null).length,n=e.backSlots.filter(r=>r!=null).length;e.frontPlacedThisTurn=t,e.usedThisTurn=t+n}function ka(){$s();const e=document.querySelector("#app");return e.innerHTML="",e}function re(e,t,n=""){const r=document.createElement("button");return n&&(r.className=n),r.type="button",r.textContent=e,r.onclick=t,r}function Tn(){const e=Array.from(document.querySelectorAll(".enemyName"));if(e.length===0)return;e.forEach(o=>{o.style.display="inline-block",o.style.width="auto",o.style.whiteSpace="nowrap"});let t=0;for(const o of e)t=Math.max(t,o.scrollWidth);const r=Math.min(t,320);e.forEach(o=>{o.style.width=`${r}px`,o.style.overflow="hidden",o.style.textOverflow="ellipsis"})}function Ta(){document.querySelector(".phaseBanner")?.remove(),performance.now()}function ga(){Is();let e=document.querySelector(".floatFxLayer");e||(e=document.createElement("div"),e.className="floatFxLayer",document.body.appendChild(e)),e.style.cssText="position:fixed; inset:0;pointer-events:none;z-index: var(--zChrome);";for(const t of wt){const n=String(t.id);let r=e.querySelector(`.floatNum[data-fx-id="${n}"]`);r?(r.style.left=`${Math.round(t.x)}px`,r.style.top=`${Math.round(t.y)}px`):(r=document.createElement("div"),r.className=`floatNum ${t.kind}`,r.dataset.fxId=n,r.textContent=t.text,r.style.position="absolute",r.style.left=`${Math.round(t.x)}px`,r.style.top=`${Math.round(t.y)}px`,e.appendChild(r))}}function Ea(){if(document.querySelector(".floatingNewRun"))return;const e=document.createElement("button");e.className="floatingNewRun",e.type="button",e.textContent="ÏÉàÎ°úÏö¥ Îü∞",e.style.cssText=`
    position: fixed;
    top: calc(env(safe-area-inset-top, 0px) + 10px);
    left: calc(env(safe-area-inset-left, 0px) + 10px);
    pointer-events: auto;
    z-index: var(--zChrome);

    padding: 10px 12px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,.16);
    background: rgba(0,0,0,.55);
    color: #fff;

    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    cursor: pointer;
    touch-action: manipulation;
  `,e.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),mr?.()}),document.body.appendChild(e)}function R(e,t){R._uiScaleInitDone||(R._uiScaleInitDone=!0,te=yr(),Nr()),xe=e,fs({getG:()=>xe??e,actions:{onNewRun:()=>t.onNewRun()},rerender:()=>R(xe??e,t),log:h=>y(xe??e,h)}),je(),mr=()=>t.onNewRun(),Ea(),js(),R._logInitDone||(R._logInitDone=!0,Bs());const n=document.querySelector(".mainPanel");n&&(On=n.scrollTop,Bn=n.scrollLeft);const r=ka();Kn||(window.addEventListener("resize",()=>{}),Fa(()=>xe??e,t),Kn=!0),r.appendChild(Pa(e,t));const o=v("mainRow"),s=v("stage"),a=v("stageInner"),i=v("panel mainPanel"),l=!e.run.finished&&e.enemies.length>0&&e.phase!=="NODE";i.classList.toggle("inCombat",l),i.scrollTop=On,i.scrollLeft=Bn,i.appendChild(Ra(e)),e.run.finished?i.appendChild(xn("Îü∞ Ï¢ÖÎ£å. ÏÉàÎ°úÏö¥ Îü∞ÏùÑ ÏõêÌïòÏãúÎ©¥ Î≤ÑÌäºÏùÑ ÎàÑÎ•¥Í±∞ÎÇò ÌÇ§Î≥¥Îìú PÎ•º ÏûÖÎ†•ÌïòÏã≠ÏãúÏò§.")):e.phase==="NODE"?xa(i,e,t):Ha(i,e,t),a.appendChild(i),s.appendChild(a);const c=v("panel logPanel");if(c.classList.toggle("collapsed",Pe),c.appendChild(Ia(Pe,()=>{Pe=!Pe,Fs(),R(e,t)})),c.classList.add("logScroll"),!Pe){const h=Gs(e.log.join(`
`));h.classList.add("log"),c.appendChild(h)}o.appendChild(s),o.appendChild(c),r.appendChild(o),Tn(),va(e),Da(e,t,Z(e)),Cn(),En(),_a(),Lr(),$a(e,{...t,onCloseOverlay:()=>{q=null,R(xe??e,t)}}),Na(e,t),wa(e,t),Ma(e,t),kt(e,t),Ls(e),Ta(),ga(),Ca(e,t),Ws(e),As()}function gn(e,t){const n=X[t]??null,r=Tt(e,t),o=n?.art??n?.icon??null,s=o??null;return{id:t,name:r.name,desc:r.text,state:r.state,icon:s,art:o}}function Ca(e,t){document.querySelector(".relicHud")?.remove(),document.querySelector(".relicTooltip")?.remove(),kt(e,t);const n=(e.run.relics??[]).slice();if(n.length===0)return;const r=document.createElement("div");r.className="relicHud";for(const o of n.slice().reverse()){const s=gn(e,o),a=document.createElement("div");if(a.className="relicIcon",a.setAttribute("role","button"),a.tabIndex=0,s.icon){const l=document.createElement("img");l.className="relicIconImg",l.src=s.icon,l.alt=s.name??s.id??"relic",a.appendChild(l)}else{const l=document.createElement("div");l.textContent=s.name.slice(0,2),l.style.fontWeight="900",l.style.fontSize="12px",l.style.opacity=".95",a.appendChild(l)}const i=(l,c)=>{ke=o,Re={x:l,y:c},zt(e)};a.onpointerenter=l=>i(l.clientX??0,l.clientY??0),a.onpointermove=l=>{ke===o&&(Re={x:l.clientX??0,y:l.clientY??0},zt(e))},a.onpointerleave=()=>{ke===o&&(ke=null,Re=null,document.querySelector(".relicTooltip")?.remove())},a.onclick=l=>{l.preventDefault(),l.stopPropagation(),Ie=o,ke=null,Re=null,document.querySelector(".relicTooltip")?.remove(),kt(e,t)},a.onkeydown=l=>{(l.key==="Enter"||l.key===" ")&&(l.preventDefault(),Ie=o,kt(e,t))},r.appendChild(a)}document.body.appendChild(r),zt(e)}function zt(e){if(document.querySelector(".relicTooltip")?.remove(),!ke||!Re)return;const t=gn(e,ke);if(!t.desc&&!t.name)return;const n=document.createElement("div");n.className="relicTooltip";const r=document.createElement("div");if(r.className="relicTooltipTitle",r.textContent=t.name,n.appendChild(r),t.desc){const l=document.createElement("div");l.className="relicTooltipDesc",l.textContent=t.desc,n.appendChild(l)}document.body.appendChild(n);const o=12,s=n.getBoundingClientRect();let a=Re.x-s.width,i=Re.y-s.height-10;a=Math.max(o,Math.min(window.innerWidth-s.width-o,a)),i=Math.max(o,Math.min(window.innerHeight-s.height-o,i)),n.style.left=`${Math.round(a)}px`,n.style.top=`${Math.round(i)}px`}function kt(e,t){if(document.querySelector(".relicModal")?.remove(),!Ie)return;const n=gn(e,Ie),r=document.createElement("div");r.className="relicModal",r.style.cssText=`
    position: fixed;
    inset: 0;
    z-index: var(--zRelicModal, 70000);
    pointer-events: auto;
    background: rgba(0,0,0,.55);
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 18px;
    box-sizing: border-box;
  `,r.onclick=d=>{d.target===r&&(Ie=null,R(e,t))};const o=document.createElement("div");o.className="relicModalPanel",o.onclick=d=>d.stopPropagation();const s=document.createElement("div");s.className="relicModalHeader";const a=document.createElement("h3");a.className="relicModalTitle",a.textContent=n.name,a.style.fontFamily='"Î¨ºÎßàÎ£®", serif';const i=document.createElement("button");i.type="button",i.textContent="Îã´Í∏∞",i.className="overlayClose",i.onclick=()=>{Ie=null,R(e,t)},s.appendChild(a),s.appendChild(i);const l=document.createElement("div");l.className="relicModalBody";const c=document.createElement("div");c.className="relicModalArt";const h=document.createElement("div");h.className="relicModalArtImg",n.art&&(h.style.backgroundImage=`url("${me(n.art)}")`),c.appendChild(h);const u=document.createElement("pre");u.className="relicModalDesc",u.textContent=n.desc||"",u.style.fontFamily='"Î¨ºÎßàÎ£®", serif',l.appendChild(c),l.appendChild(u),o.appendChild(s),o.appendChild(l),r.appendChild(o),document.body.appendChild(r)}function va(e){const t=document.querySelector(".stageInner");if(!t)return;document.querySelector(".stageCornerHud")?.remove();const n=document.createElement("div");n.className="stageCornerHud",n.textContent=Aa(e),document.body.appendChild(n);const r=t.getBoundingClientRect(),o=-56,s=(r.left+r.right)/2;n.style.right="",n.style.left=`${Math.round(s)}px`,n.style.top=`${Math.round(r.top+o)}px`,n.style.transform="translateX(-50%)"}function on(){try{localStorage.setItem(br,JSON.stringify(te))}catch{}}function jt(e){const t=Jt(e,.75,1.5);It()?te.uiScaleMobile=t:te.uiScaleDesktop=t,on(),Nr()}function wa(e,t){if(document.querySelector(".logOverlay")?.remove(),!nn)return;const n=v("logOverlay");n.style.cssText=`
    position: fixed; inset: 0;
    pointer-events:auto;
    background: rgba(0,0,0,.55);
    backdrop-filter: blur(6px);
    display: flex;
    align-items: flex-end;
    justify-content: center;
  `;const r=v("panel");r.style.cssText=`
    width: min(720px, 100%);
    max-height: 70vh;
    border-radius: 18px 18px 0 0;
    padding: 12px;
    margin: 0;
  `;const o=v("panelHeader"),s=document.createElement("h2");s.textContent="Î°úÍ∑∏",o.appendChild(s);const a=re("Îã´Í∏∞",()=>t.onToggleLogOverlay());o.appendChild(a),r.appendChild(o);const i=document.createElement("pre");i.className="log",i.textContent=e.log.join(`
`),i.style.maxHeight="60vh",i.style.overflow="auto",r.appendChild(i),n.onclick=()=>t.onToggleLogOverlay(),r.onclick=l=>l.stopPropagation(),n.appendChild(r),document.body.appendChild(n)}function Sa(e,t){const n=v("settingsPanel");n.style.cssText="display:flex; flex-direction:column; gap:12px;";const r=v("settingsRow");r.style.cssText="display:flex; align-items:center; gap:12px; flex-wrap:wrap;";const o=G("","UI Ïä§ÏºÄÏùº");o.style.cssText="font-weight:800;";const s=()=>It()?te.uiScaleMobile:te.uiScaleDesktop,a=G("",`${Math.round(s()*100)}%`);a.style.cssText="opacity:.9; min-width:64px; text-align:right;";const i=document.createElement("input");i.type="range",i.min="0.75",i.max="1.25",i.step="0.01",i.value=String(s()),i.style.cssText="flex:1 1 260px;",i.oninput=()=>{const b=Number(i.value);jt(b),a.textContent=`${Math.round(s()*100)}%`,e()},r.appendChild(o),r.appendChild(i),r.appendChild(a),n.appendChild(r);const l=v("settingsPresets");l.style.cssText="display:flex; gap:8px; flex-wrap:wrap;";const c=(b,g)=>{const m=re(b,()=>{jt(g),i.value=String(s()),a.textContent=`${Math.round(s()*100)}%`,e()});return m.style.cssText="padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.16);background:rgba(255,255,255,.06); color:#fff; cursor:pointer;",m};l.appendChild(c("ÏûëÍ≤å 90%",.9)),l.appendChild(c("Í∏∞Î≥∏ 100%",1)),l.appendChild(c("ÌÅ¨Í≤å 110%",1.1)),l.appendChild(c("Îçî ÌÅ¨Í≤å 120%",1.2)),n.appendChild(l);const h=v("settingsResetRow");h.style.cssText="display:flex; justify-content:flex-end; margin-top:6px;";const u=re("Ï¥àÍ∏∞Ìôî",()=>{jt(1),i.value=String(s()),a.textContent=`${Math.round(s()*100)}%`,e()});u.style.cssText="padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.16);background:rgba(255,255,255,.06); color:#fff; cursor:pointer;",h.appendChild(u),n.appendChild(h);const d=v("settingsRow");d.style.cssText="display:flex; align-items:center; gap:12px; flex-wrap:wrap;";const x=G("","Ïä¨Î°Ø Ïπ¥Îìú ÌëúÏãú");x.style.cssText="font-weight:800;";const $=te.slotCardMode??"FULL",f=re("Ï†ÑÏ≤¥",()=>{te.slotCardMode="FULL",on(),e()}),p=re("Ïù¥Î¶ÑÎßå",()=>{te.slotCardMode="NAME_ONLY",on(),e()});return f.style.cssText=`padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.16);
    background:${$==="FULL"?"rgba(255,255,255,.16)":"rgba(255,255,255,.06)"}; color:#fff; cursor:pointer;`,p.style.cssText=`padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.16);
    background:${$==="NAME_ONLY"?"rgba(255,255,255,.16)":"rgba(255,255,255,.06)"}; color:#fff; cursor:pointer;`,d.appendChild(x),d.appendChild(f),d.appendChild(p),n.appendChild(d),n}function _a(){const e=document.querySelector(".stageInner");if(!e)return;const t=e.getBoundingClientRect(),n=Math.round(t.left),r=Math.round(t.top),o=document.documentElement;o.style.setProperty("--stageLeftPx",`${n}px`),o.style.setProperty("--stageTopPx",`${r}px`),o.style.setProperty("--stageHPx",`${Math.round(t.height)}px`)}function Nr(){const e=document.documentElement,t=It()?te.uiScaleMobile:te.uiScaleDesktop;e.style.setProperty("--uiScale",String(t)),e.style.setProperty("--uiScaleDesktop",String(te.uiScaleDesktop)),e.style.setProperty("--uiScaleMobile",String(te.uiScaleMobile))}function $a(e,t){if(document.querySelector(".overlay-layer")?.remove(),!q)return;const n=q.kind==="SETTINGS",r=v("overlay-layer");r.style.cssText=n?"position:fixed; inset:0;background:rgba(0,0,0,1);display:flex; justify-content:center; align-items:flex-start;padding:24px; box-sizing:border-box;":"position:fixed; inset:0;background:rgba(0,0,0,.55);display:flex; justify-content:center; align-items:center;",r.onclick=c=>{c.target===r&&t.onCloseOverlay()};const o=v("overlay-panel");o.style.cssText=n?"width:min(860px, 96vw); max-height:calc(100vh - 48px); overflow:auto;padding:16px; border:1px solid rgba(255,255,255,.12); border-radius:16px;background:rgba(15,18,22,1); box-shadow:0 18px 60px rgba(0,0,0,.45);":"width:min(980px, 92vw); max-height:80vh; overflow:auto; padding:16px;border:1px solid rgba(255,255,255,.12); border-radius:16px;background:rgba(15,18,22,.92); box-shadow:0 18px 60px rgba(0,0,0,.45);",o.onclick=c=>c.stopPropagation();const s=q.kind==="RULEBOOK"?"Î£∞Î∂Å":q.kind==="SETTINGS"?"ÏÑ§Ï†ï":q.pile==="deck"?"Îç±":q.pile==="discard"?"Î≤ÑÎ¶º ÎçîÎØ∏":q.pile==="exhausted"?"ÏÜåÎ™®(Ïù¥Î≤à Ï†ÑÌà¨)":q.pile==="vanished"?"ÏÜåÏã§(ÏòÅÍµ¨)":"ÏÜêÌå®",a=v("overlayHeader");a.style.cssText="display:flex; align-items:center; justify-content:space-between; gap:12px; position:sticky; top:0; padding-bottom:12px; margin-bottom:12px; background:rgba(15,18,22,.92);";const i=Zt(s);i.classList.add("overlayTitle");const l=tn("Îã´Í∏∞",t.onCloseOverlay,!1);if(l.classList.add("overlayClose"),l.style.cssText="padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.16); background:rgba(255,255,255,.06); color:#fff; cursor:pointer;",a.appendChild(i),a.appendChild(l),o.appendChild(a),q.kind==="RULEBOOK"){const c=document.createElement("pre");c.className="rulebook",c.textContent=Ss,c.style.cssText="white-space:pre-wrap; line-height:1.45; font-size:13px; margin:0; padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.10); background:rgba(0,0,0,.18);",o.appendChild(c)}else if(q.kind==="SETTINGS")o.appendChild(Sa(()=>{xe&&(Tn(),Cn(),En()),R(xe??e,t)}));else{const h=[...q.pile==="deck"?e.deck:q.pile==="discard"?e.discard:q.pile==="exhausted"?e.exhausted:q.pile==="vanished"?e.vanished:e.hand].sort((m,k)=>{const M=e.cards[m],T=e.cards[k],H=_t(e,M.defId),I=_t(e,T.defId),E=H.localeCompare(I,"ko");return E!==0?E:(M.upgrade??0)-(T.upgrade??0)}),u=v("pileView");u.style.cssText="display:grid;grid-template-columns: 1fr 320px;gap:16px;align-items:start;";const d=v("pileGrid");d.style.cssText="display:grid;grid-template-columns: repeat(auto-fill, minmax(var(--handCardW), 1fr));gap:10px;align-content:start;min-width:0;max-height: 62vh;overflow-y: auto;overflow-x: hidden;";const x=v("pileSide");x.style.cssText="position:sticky; top:72px;align-self:start;border:1px solid rgba(255,255,255,.10);border-radius:14px;padding:12px;background:rgba(0,0,0,.22);";const $=v("pileSideTitle");$.style.cssText="font-weight:800; margin:0 0 10px 0; opacity:.95;",x.appendChild($);const f=v("pilePreviewBox");f.style.cssText="display:flex; justify-content:center; align-items:flex-start;padding:8px 0 10px 0;",x.appendChild(f);const p=document.createElement("pre");p.className="pileSideDetail",p.style.cssText="margin:0;padding:10px;white-space:pre-wrap;border-radius:12px;border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.20);font-size:12px;line-height:1.45;",x.appendChild(p);let b=h[0]??null;const g=()=>{if(f.innerHTML="",!b){$.textContent="ÏÑ†ÌÉùÎêú Ïπ¥Îìú ÏóÜÏùå",p.textContent="";return}const m=St(e,b),k=Cr(e,b);$.textContent=k;const M=qe(e,b);f.appendChild(M),p.textContent=`Ï†ÑÏó¥: ${m.frontText}
ÌõÑÏó¥: ${m.backText}`};if(h.length===0){const m=v("overlayEmpty");m.textContent="ÎπÑÏñ¥ ÏûàÏùå",m.style.cssText="padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.10); background:rgba(255,255,255,.03);",d.appendChild(m)}else for(const m of h){const k=qe(e,m,T=>{b=T,g()});k.style.width="var(--handCardW)",k.style.height="var(--handCardH)",k.style.boxSizing="border-box",k.style.cursor="pointer";const M=()=>{b=m,d.querySelectorAll(".pileSelected").forEach(T=>T.classList.remove("pileSelected")),k.classList.add("pileSelected"),g()};k.onclick=M,k.onmouseenter=M,d.appendChild(k)}if(u.appendChild(d),u.appendChild(x),o.appendChild(u),b){const m=d.firstElementChild;m&&m.classList.add("pileSelected")}g()}r.appendChild(o),document.body.appendChild(r)}function tt(e,t){const n=document.createElement(e);return t&&(n.className=t),n}function Ma(e,t){const n=document.getElementById("relicTray");n&&n.remove();const r=e.run.relics??[];if(r.length===0)return;const o=tt("div","relicTray");o.id="relicTray";const s=tt("div","relicHoverTip");o.appendChild(s);const a=tt("div","relicTrayList");o.appendChild(a);const i=()=>{const l=ke;if(!l){s.style.display="none",s.textContent="";return}if(!X[l]){s.style.display="none",s.textContent="";return}const h=Tt(e,l);s.style.display="block",s.innerHTML="";const u=tt("div","relicTipTitle");u.textContent=h.name;const d=tt("div","relicTipBody");d.textContent=h.text,s.appendChild(u),s.appendChild(d)};for(const l of r){const c=X[l];if(!c)continue;const h=Tt(e,l),u=document.createElement("button");if(u.type="button",u.className="relicIcon",c.art){const d=document.createElement("img");d.className="relicIconImg",d.alt=h.name,u.appendChild(d)}else u.textContent=h.name.slice(0,1);u.onmouseenter=()=>{ke=l,i()},u.onmouseleave=()=>{ke=null,i()},u.onclick=()=>{Ie=l,R(e,t)},a.appendChild(u)}i(),document.body.appendChild(o)}function Na(e,t){document.querySelector(".choice-overlay")?.remove();const n=e.choice,r=document.querySelector(".mainPanel");if(!n){r?.classList.remove("choiceOpen");return}if(!r)return;r.classList.add("choiceOpen");const o=A(70),s=A(20)+o,a=A(36),i=A(16),l=A(16),c=A(18),h=A(10),u=A(260),d=A(200),x=A(14),$=A(12),f=A(10),p=A(12),b=A(12),g=A(220),m=A(22),k=A(14),M=v("choice-overlay");M.style.cssText="position:fixed; inset:0; z-index: var(--zChoice);display:flex; justify-content:center; align-items:flex-start;pointer-events:auto;";const T=v("choice-backdrop");T.style.cssText="position:absolute; inset:0;background: rgba(0,0,0,.72);backdrop-filter: blur(4px);-webkit-backdrop-filter: blur(4px);pointer-events:auto;",T.onclick=()=>{};const H=v("choice-padWrap");H.style.cssText=`position:relative; width:100%;padding:${s}px ${a}px ${i}px ${l}px;box-sizing:border-box;display:flex; justify-content:center; align-items:flex-start;pointer-events:auto;`;const I=v("choice-panel");I.style.cssText="position:relative;pointer-events:auto;",I.onclick=w=>w.stopPropagation();const E=Ys(n.title);if(E.style.cssText=`margin:0 0 ${A(8)}px 0; font-size:${m}px; font-weight:900;text-align:left;`,I.appendChild(E),n.prompt){const w=xn(n.prompt);w.style.cssText=`margin:0 0 ${A(12)}px 0; font-size:${k}px; line-height:1.25; opacity:.95;`,I.appendChild(w)}const _=(w,S=1)=>{const D=S===1?"var(--handCardW)":`calc(var(--handCardW) * ${S})`,F=S===1?"var(--handCardH)":`calc(var(--handCardH) * ${S})`;w.style.width=D,w.style.height=F,w.style.boxSizing="border-box"},N=w=>{const S=document.createElement("pre");return S.className="choice-detail",S.textContent=String(w),S.style.cssText=`margin:${A(10)}px 0 0 0; padding:${f}px;white-space:pre-wrap;border-radius:${p}px; border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.22);font-size:${b}px; line-height:1.45;max-height:${g}px; overflow:auto;`,S},C=()=>{const w=v("choice-item");return w.style.cssText=`display:flex;gap:${A(12)}px;align-items:flex-start;border:1px solid rgba(255,255,255,.10); border-radius:${x}px;padding:${$}px;background:rgba(255,255,255,.03);`,w};if(n.options.some(w=>w.cardUid?!0:typeof w.key=="string"&&w.key.startsWith("pick:"))){const w=v("choice-list");w.style.cssText=`display:flex; flex-direction:column;gap:${h}px; margin-top:${A(12)}px;`,n.options.forEach(S=>{const D=C(),F=v("choice-left");F.style.cssText="flex:0 0 auto;";const L=S.cardUid;if(L){const K=e.choice?.kind==="UPGRADE_PICK",Y=(e.cards[L]?.upgrade??0)||0,J=Y+1;if(K){const ne=v("upgradePair");ne.style.cssText=`display:flex; gap:${A(10)}px; align-items:flex-start;`;let He,$e;try{He=zn(e,L,Y)}catch{He=qe(e,L)}try{$e=zn(e,L,J)}catch{$e=qe(e,L)}_(He,.78),_($e,.78);const U=G("upgradeArrow","‚Üí");U.style.cssText=`align-self:center; font-weight:900; opacity:.85; margin-top:${A(6)}px;`,ne.appendChild(He),ne.appendChild(U),ne.appendChild($e),F.appendChild(ne)}else{let ne;try{ne=qe(e,L)}catch{ne=qe(e,L)}_(ne),F.appendChild(ne)}}else if(typeof S.key=="string"&&S.key.startsWith("pick:")){const K=S.key.slice(5),[j,Y]=K.split(":"),J=Number(Y??"0")||0,ne=Sr(e,j,J);_(ne),F.appendChild(ne)}const W=v("choice-right");W.style.cssText=`flex:1 1 auto; min-width:${A(260)}px;`;const B=tn(S.label,()=>t.onChooseChoice(S.key),!1);B.classList.add("primary"),B.style.fontSize=`${A(14)}px`,B.style.padding=`${A(10)}px ${A(12)}px`,B.style.borderRadius=`${A(10)}px`,W.appendChild(B),S.detail&&W.appendChild(N(S.detail)),D.appendChild(F),D.appendChild(W),w.appendChild(D)}),I.appendChild(w)}else{const w=v("choice-contentRow");w.style.cssText=`display:flex;gap:${c}px; margin-top:${A(12)}px;justify-content:center; align-items:stretch;`;const S=v("choice-leftCol");S.style.cssText=`flex:1 1 ${A(640)}px; max-width:${A(720)}px; min-width:0;display:flex; flex-direction:column;`;const D=v("choice-list");D.style.cssText=`display:flex; flex-direction:column; gap:${h}px;`,n.options.forEach(B=>{const K=C(),j=tn(B.label,()=>t.onChooseChoice(B.key),!1);j.classList.add("choiceOptBtn"),j.style.fontSize=`${A(14)}px`,j.style.padding=`${A(10)}px ${A(12)}px`,j.style.borderRadius=`${A(10)}px`,K.appendChild(j),B.detail&&K.appendChild(N(B.detail)),D.appendChild(K)}),S.appendChild(D);const F=v("choice-illuCol");F.style.cssText=`flex:0 0 ${u}px; min-width:${d}px;display:flex; align-items:center; justify-content:center;`;const L=v("choice-illuBox");L.style.cssText=`width:100%; aspect-ratio:1/1;border-radius:${A(18)}px; border:1px solid rgba(255,255,255,.16);background:rgba(0,0,0,.35);position:relative; overflow:hidden;box-shadow: 0 10px 30px rgba(0,0,0,.35);`;const W=n.art;if(W){const B=document.createElement("img");B.src=me(W),B.alt=n.title??"illustration";const K=1.5;B.style.imageRendering="pixelated",B.style.cssText=`position:absolute; inset:0;width:${K*100}%; height:${K*100}%;left:${-.5*50}%; top:${-.5*50}%;object-fit:cover; object-position:50% 50%;image-rendering: pixelated; image-rendering: crisp-edges;`,L.appendChild(B)}F.appendChild(L),w.appendChild(S),w.appendChild(F),I.appendChild(w)}H.appendChild(I),M.appendChild(T),M.appendChild(H),document.body.appendChild(M)}function Pa(e,t){document.querySelectorAll(".topHud").forEach(g=>g.remove()),document.querySelectorAll(".enemyHudCenter").forEach(g=>g.remove());const n=v("topHud");n.appendChild(v("topHudLeftSpacer"));const r=v("playerHudLeft"),o=v("playerTitleRow");o.appendChild(G("playerHudTitle","ÌîåÎ†àÏù¥Ïñ¥"));const s=v("pileButtons");s.appendChild(re("Îç±",()=>t.onViewPile("deck"))),s.appendChild(re("Î≤ÑÎ¶º",()=>t.onViewPile("discard"))),s.appendChild(re("ÏÜêÌå®",()=>t.onViewPile("hand"))),s.appendChild(re("ÏÜåÎ™®",()=>t.onViewPile("exhausted"))),s.appendChild(re("ÏÜåÏã§",()=>t.onViewPile("vanished"))),o.appendChild(s),r.appendChild(o);const a=v("enemyChip");a.classList.add("playerHudBox");const i=v("enemyChipTop");i.appendChild(G("","HP")),i.appendChild(G("",`${e.player.hp}/${e.player.maxHp}`)),a.appendChild(i);const l=v("enemyHPOuter"),c=v("enemyHPFill");c.style.width=`${Math.max(0,Math.min(100,e.player.hp/Math.max(1,e.player.maxHp)*100))}%`,l.appendChild(c),a.appendChild(l);const h=v("enemyChipTop");h.appendChild(G("","Î∏îÎ°ù")),h.appendChild(G("",`${e.player.block}`)),a.appendChild(h);const u=v("enemyHPOuter"),d=v("enemyHPFill");d.style.background="linear-gradient(90deg, #64b5ff, #2a7cff)",d.style.width=`${Math.max(0,Math.min(100,e.player.block/Math.max(1,e.player.maxHp)*100))}%`,u.appendChild(d),a.appendChild(u);const x=e.player.status,$=v("enemyBadges");a.appendChild($);const f=[];(x.vuln??0)>0&&f.push(`Ï∑®ÏïΩ ${x.vuln}`),(x.weak??0)>0&&f.push(`ÏïΩÌôî ${x.weak}`),(x.bleed??0)>0&&f.push(`Ï∂úÌòà ${x.bleed}`),(x.disrupt??0)>0&&f.push(`ÍµêÎûÄ ${x.disrupt}`);for(const g of f)$.appendChild(en(g));if(r.appendChild(a),!e.run.finished&&e.enemies.length>0&&e.phase!=="NODE"){const g=v("enemyHudCenter"),m=v("enemyHudCenterMover"),k=v("enemyHud");k.style.cssText=`
      display: flex;
      flex-direction: row;
      flex-wrap: nowrap;
      justify-content: center;
      align-items: stretch;
      gap: 14px;
      overflow: visible;
      white-space: nowrap;
    `,g.style.overflow="visible",m.style.overflow="visible",m.style.width="max-content";const M=Z(e);m.appendChild(k),g.appendChild(m),document.body.appendChild(g);for(let T=0;T<e.enemies.length;T++){const H=e.enemies[T],I=v("enemyBanner enemyCardWrap");M&&H.hp>0&&I.classList.add("targetable"),I.onclick=()=>t.onSelectEnemy(T);const E=v("enemyArtWrap"),_=v("enemyArtCard");E.style.setProperty("--frameImg",`url("${me("assets/enemies/enemies_frame.png")}")`),E.style.setProperty("--artImg",`url("${ta(H.id)}")`),E.appendChild(_);const N=v("enemyMiniHud"),C=e.content.enemiesById[H.id],P=C.intents[H.intentIndex%C.intents.length],w=H.intentLabelOverride??P.label,S=e.intentsRevealedThisTurn?tr(e,H,P,{includeBlock:!1}):null,D=v("enemyIntentTopRow");let F="Ôºü",L="";e.intentsRevealedThisTurn&&S?(F=ra(S),L=na(e,H,S)??""):(F="Ôºü",L=""),D.appendChild(G("enemyIntentIcon",F)),D.appendChild(G("enemyIntentDmg",L)),N.appendChild(D);const W=v("enemyHpLine");W.appendChild(G("enemyHpText",`HP ${H.hp}/${H.maxHp}`));const B=v("enemyHPOuter"),K=v("enemyHPFill");K.style.width=`${Math.max(0,Math.min(100,H.hp/Math.max(1,H.maxHp)*100))}%`,B.appendChild(K),W.appendChild(B),N.appendChild(W),N.appendChild(oa(H.status,H.immuneThisTurn));const j=v("enemyHoverDetail"),Y=H.status,J=[];(Y.vuln??0)>0&&J.push(`Ï∑®ÏïΩ ${Y.vuln}`),(Y.weak??0)>0&&J.push(`ÏïΩÌôî ${Y.weak}`),(Y.bleed??0)>0&&J.push(`Ï∂úÌòà ${Y.bleed}`),(Y.disrupt??0)>0&&J.push(`ÍµêÎûÄ ${Y.disrupt}`),H.immuneThisTurn&&J.push("Î©¥Ïó≠"),j.textContent=e.enemies[T].name+`
 
`+(e.intentsRevealedThisTurn?`${w}
 
`:"")+(J.length?`ÏÉÅÌÉú: ${J.join(", ")}`:"ÏÉÅÌÉú: ÏóÜÏùå"),I.appendChild(E),I.appendChild(N),I.appendChild(j),k.appendChild(I)}}n.appendChild(r);const b=v("topHudRight");return b.appendChild(re("Î£∞Î∂Å",()=>t.onViewRulebook())),b.appendChild(re("Î°úÍ∑∏",()=>t.onToggleLogOverlay())),b.appendChild(re("ÏÑ§Ï†ï",()=>{q={kind:"SETTINGS"},R(e,t)})),n.appendChild(b),n}function Aa(e){const t=e.enemies.length>0&&e.phase!=="NODE",n=e.run.nextBattleSuppliesBonus??0,r=[];t?r.push(`üåæ S ${e.player.supplies} |`):n>0&&r.push(`Î≥¥ÎÑàÏä§ üåæ S +${n} |`),r.push(`üí§ F ${e.player.fatigue}`);const o=e.run,s=Number(o.timeMove??0)||0,a=Number(e.time??0)||0,i=s+a;return r.push(`| ‚è≥ Ï¥ù ${i}`),r.push(`| üÉè Îç± ${e.deck.length}`),r.join(" ")}function qt(e,t=""){const n=document.createElement("span");return n.className="chip"+(t?` ${t}`:""),n.textContent=e,n}function Ra(e){const t=v("battleTitleRow");t.style.display="flex",t.style.alignItems="center",t.style.gap="12px";const n=document.createElement("h2");n.textContent="",t.appendChild(n);const r=La(e),o=G("targetHintInline","");o.style.cssText="padding:5px 10px; border-radius:12px; border:1px solid rgba(0,0,0,.55);background: rgb(255, 0, 0);opacity:.9;font-weight:400; font-size:12px; line-height:1.2;white-space:nowrap; overflow:hidden; text-overflow:ellipsis;width: min(240px, 92vw);max-width: none;pointer-events:auto;",r?(o.textContent=r,o.style.visibility="visible",o.style.pointerEvents="auto"):(o.textContent="ÎåÄÏÉÅ ÏÑ†ÌÉù ÌïÑÏöî",o.style.visibility="hidden",o.style.pointerEvents="none");const s=v("battleTitleRight");s.style.cssText="margin-left:auto;display:flex; align-items:center; gap:10px;flex: 0 0 auto;white-space:nowrap;position:relative;";const a=v("resourceRow inline");return a.appendChild(qt("")),a.appendChild(qt("")),a.appendChild(qt("")),s.appendChild(a),o.style.position="absolute",o.style.right="207px",o.style.top="calc(100% - 8px)",o.style.marginTop="0px",o.style.zIndex="5",o.style.pointerEvents=r?"auto":"none",t.appendChild(o),t.appendChild(s),t}function Ia(e,t){const n=v("logHeaderRow");n.tabIndex=0;const r=document.createElement("h2");r.textContent="Î°úÍ∑∏";const o=document.createElement("span");return o.className="chev",o.textContent=e?"‚ñ∏":"‚ñæ",n.appendChild(r),n.appendChild(o),n.onclick=()=>t(),n.onkeydown=s=>{(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),t())},n}function La(e){if(!Z(e)||e.selectedEnemyIndex!=null)return null;const t=e.pendingTarget??null,n=t?.sourceCardUid?ue(e,t.sourceCardUid):null,r=t?.sourceLabel??null,o=t?.reason??null,s=n?`ÎåÄÏÉÅ ÏÑ†ÌÉù (${n})`:r?`ÎåÄÏÉÅ ÏÑ†ÌÉù (${r})`:"ÎåÄÏÉÅ ÏÑ†ÌÉù ÌïÑÏöî",a=o==="FRONT"?"Ï†ÑÏó¥":o==="BACK"?"ÌõÑÏó¥":o==="EVENT"?"Ïù¥Î≤§Ìä∏":o==="RELIC"?"Ïú†Î¨º":null,i=a?` ‚Äî ${a}`:"",l=e.pendingTargetQueue?.length??0,c=(e.pendingTarget?1:0)+l,h=c>1?` (ÎÇ®ÏùÄ ${c}Í∞ú)`:" (ÎÇ®ÏùÄ 1Í∞ú)";return`${s}${i}${h}`}function Ha(e,t,n){const r=v("combatRoot"),o=v("boardArea"),s=!t.run.finished&&t.enemies.length>0&&t.phase!=="NODE";o.classList.toggle("slabOn",s);const a=v("boardSlotsWrap");a.style.paddingTop=`${A(6)}px`,a.appendChild(Vn(t,n,"front")),a.appendChild(Vn(t,n,"back")),o.appendChild(a),r.appendChild(o),e.appendChild(r)}let sn=null,Pr=!0;function qn(e,t){sn=e,Pr=t}function Ar(e,t,n){return e.run.finished?{label:"Ï¢ÖÎ£å",fn:null,disabled:!0,activePhase:e.phase}:e.choice||q?{label:"ÏÑ†ÌÉù Ï§ë",fn:null,disabled:!0,activePhase:e.phase}:n?{label:"ÎåÄÏÉÅ ÏÑ†ÌÉù",fn:null,disabled:!0,activePhase:e.phase}:e.phase==="NODE"?{label:"ÎÖ∏Îìú ÏÑ†ÌÉù",fn:null,disabled:!0,activePhase:e.phase}:e.phase==="PLACE"?e.enemies.length>0&&!e.intentsRevealedThisTurn?{label:"Îã§Ïùå: Ï†ïÏ∞∞",fn:t.onRevealIntents,disabled:!1,activePhase:e.phase}:{label:"Îã§Ïùå: ÌõÑÏó¥",fn:t.onResolveBack,disabled:!1,activePhase:e.phase}:e.phase==="BACK"?{label:"Îã§Ïùå: ÌõÑÏó¥",fn:t.onResolveBack,disabled:!1,activePhase:e.phase}:e.phase==="FRONT"?{label:"Îã§Ïùå: Ï†ÑÏó¥",fn:t.onResolveFront,disabled:!1,activePhase:e.phase}:e.phase==="ENEMY"?{label:"Îã§Ïùå: Ï†Å",fn:t.onResolveEnemy,disabled:!1,activePhase:e.phase}:e.phase==="UPKEEP"?{label:"Îã§Ïùå: Ï†ïÎ¶¨",fn:t.onUpkeep,disabled:!1,activePhase:e.phase}:e.phase==="DRAW"?{label:"Îã§Ïùå ÌÑ¥",fn:t.onDrawNextTurn,disabled:!1,activePhase:e.phase}:{label:"Îã§Ïùå",fn:null,disabled:!0,activePhase:e.phase}}function Da(e,t,n){const r=document.querySelector(".handDock");r&&r.remove();const o=!e.run.finished&&e.enemies.length>0&&e.phase!=="NODE";document.querySelector(".combatControls")?.remove();const s=v("handDock"),a=Ar(e,t,n);if(o){const c=v("combatControls"),h=document.createElement("button");h.textContent="Îã§Ïùå ÌÑ¥",h.className="stepBtn primary",h.disabled=a.disabled||e.phase==="NODE",h.onclick=()=>t.onAutoAdvance();const u=document.createElement("button");u.textContent="ÏÑ†ÌÉù Ìï¥Ï†ú",u.className="clearBtn primary",u.disabled=!e.selectedHandCardUid,u.onclick=t.onClearSelected,c.appendChild(h),c.appendChild(u),document.body.appendChild(c);const d=document.querySelector('.slot[data-slot-side="front"][data-slot-index="1"]')??document.querySelector(".stageInner");if(d){const x=d.getBoundingClientRect(),$=x.left+x.width/2;c.style.left=`${Math.round($)}px`}qn(()=>t.onAutoAdvance(),h.disabled)}else qn(null,!0);const i=v("hand");i.dataset.dropHand="1";const l=v("handCardsRow");if(i.appendChild(l),e.hand.length===0){const c=v("handEmptyHint");c.textContent="",l.appendChild(c)}else for(const c of e.hand)l.appendChild(pt(e,c,!0,t.onSelectHandCard,{draggable:!0}));s.appendChild(i),document.body.appendChild(s),Oa(i)}function Oa(e){e.dataset?.wheelX!=="1"&&(e.dataset.wheelX="1",e.addEventListener("wheel",t=>{if(t.shiftKey)return;const n=Math.abs(t.deltaX)>Math.abs(t.deltaY)?t.deltaX:t.deltaY;e.scrollLeft+=n,t.preventDefault()},{passive:!1}))}function En(){const e=document.querySelector(".enemyHudCenter");if(!e)return;const t=e.querySelector(".enemyHudCenterMover")??e,n=e.querySelector(".enemyHud")??e.querySelector(".enemyStrip")??t;e.style.position="fixed";const r=document.querySelector(".topHud"),a=r?Math.round(r.getBoundingClientRect().bottom+10):8;e.style.top=`${a}px`,e.style.top="8px",e.style.left="50%",e.style.right="auto",e.style.transform="translateX(-50%)",e.style.overflow="visible",t.style.transform="",t.style.overflow="visible";const i=Array.from(e.querySelectorAll(".enemyBanner")),l=i.length;if(l===0){e.style.width="";return}const c=14,h=Math.ceil(i[0].getBoundingClientRect().width)||460,u=Math.max(320,Math.floor(window.innerWidth-16)),d=Math.min(u,h),x=Math.min(u,h*2+c),$=Math.min(u,h*3+c*2);n.style.display="flex",n.style.flexWrap="nowrap",n.style.justifyContent="center",n.style.alignItems="stretch",n.style.gap=`${c}px`,e.style.width=`${l===1?d:l===2?x:$}px`,t.style.width="100%"}function Cn(e){const t=document.querySelector(".hand"),n=document.querySelector(".handCardsRow");if(!t||!n)return;const r=document.querySelector('.slot[data-slot-side="front"][data-slot-index="1"]'),o=document.querySelector(".stageInner"),s=r?.getBoundingClientRect()??o?.getBoundingClientRect();if(!s)return;const a=s.left+s.width/2,i=Array.from(n.querySelectorAll(".card"));if(i.length===0)return;const l=i[0].getBoundingClientRect(),c=i[i.length-1].getBoundingClientRect(),h=l.left,u=c.right,d=(h+u)/2,x=a-d,$=n.scrollWidth,f=t.clientWidth;if($<=f+1){n.style.transform=`translateX(${Math.round(x)}px)`,t.scrollLeft=0;return}let p=t.scrollLeft-x;const b=Math.max(0,$-f);p<0&&(p=0),p>b&&(p=b),t.scrollLeft=Math.round(p),n.style.transform=""}function Rr(e,t){const n=getComputedStyle(document.documentElement),r=parseFloat(n.getPropertyValue("--handCardW"))||240,o=parseFloat(n.getPropertyValue("--handCardH"))||336,s=e.getBoundingClientRect();if(s.width<=0||s.height<=0)return;const a=6,i=Math.max(1,s.width-a*2),l=Math.max(1,s.height-a*2);let c=Math.min(i/r,l/o);c=Math.max(.8,Math.min(1,c)),t.style.setProperty("--slotCardScale",String(c))}function Vn(e,t,n){const r=v("grid6"),o=!!e.selectedHandCardUid,s=n==="front"?e.frontSlots:e.backSlots;for(let a=0;a<3;a++){const i=n==="back"?!!e.backSlotDisabled?.[a]:!1,l=v("slot"+(i?" disabled":""));l.dataset.slotSide=n,l.dataset.slotIndex=String(a),Te&&Te.side===n&&Te.idx===a&&l.classList.add("dropHover"),o&&!i&&l.classList.add("placeable");const c=s[a];if(c){const h=te.slotCardMode==="NAME_ONLY"?"SLOT_NAME_ONLY":"FULL",u=pt(e,c,!1,void 0,{draggable:!1,mode:h,hoverPreview:{root:document.body,api:gr,buildDetail:(x,$)=>{const f=St(x,$);return`Ï†ÑÏó¥: ${f.frontText}
ÌõÑÏó¥: ${f.backText}`}}});u.classList.add("inSlot");const d=document.createElement("div");d.className="slotCardScaler",d.appendChild(u),l.appendChild(d),u.onpointerdown=x=>{x.button!==0&&x.pointerType==="mouse"||Z(e)||e.phase==="PLACE"&&Ir(x,{kind:"slot",cardUid:c,fromSide:n,fromIdx:a})},u.ondblclick=()=>t.onReturnSlotToHand(n,a),requestAnimationFrame(()=>Rr(l,d))}r.appendChild(l)}return r}function Ba(){if(document.querySelectorAll(".slot.dropHover").forEach(n=>n.classList.remove("dropHover")),!Te)return;const e=`.slot[data-slot-side="${Te.side}"][data-slot-index="${Te.idx}"]`,t=document.querySelector(e);t&&t.classList.add("dropHover")}let Yn=!1;function Fa(e,t){Yn||(Yn=!0,window.addEventListener("pointermove",n=>{const r=e();if(r.choice||q||!O||n.pointerId!==O.pointerId)return;O.x=n.clientX,O.y=n.clientY;const o=O.x-O.startX,s=O.y-O.startY,a=O.dragging;!O.dragging&&o*o+s*s>36&&(O.dragging=!0),!a&&O.dragging&&(yn(250),bn()),Te=O.dragging?Gn(n.clientX,n.clientY,r):null,Lr(document.querySelector("#app")),Ba()},{passive:!0}),window.addEventListener("pointerup",n=>{const r=e();if(!(r.choice||q)&&!(!O||n.pointerId!==O.pointerId)){if(O.dragging){const o=Wa(n.clientX,n.clientY),s=Gn(n.clientX,n.clientY,r);if(o&&O.kind==="slot"&&O.fromSide!=null&&O.fromIdx!=null){!r.run.finished&&!Z(r)&&r.phase==="PLACE"&&t.onReturnSlotToHand(O.fromSide,O.fromIdx),O=null,Te=null,R(r,t);return}if(s)if(O.kind==="hand"){const a=e();if(!(a.run.finished||Z(a)||a.phase!=="PLACE")){const i=s.side,l=s.idx;if(!(i==="back"&&a.backSlotDisabled?.[l])){const c=i==="front"?a.frontSlots:a.backSlots,h=c[l];if(!h)t.onPlaceHandUidToSlot(O.cardUid,i,l);else{const u=O.fromHandIndex!=null&&O.fromHandIndex>=0?O.fromHandIndex:a.hand.indexOf(O.cardUid),d=a.hand.indexOf(O.cardUid);d>=0&&a.hand.splice(d,1),c[l]=O.cardUid,a.cards[O.cardUid].zone=i;const x=u!=null&&u>=0&&u<=a.hand.length?u:a.hand.length;a.hand.splice(x,0,h),a.cards[h].zone="hand",a.selectedHandCardUid=null,rn(a),y(a,`[${ue(a,O.cardUid)}] ‚Üî [${ue(a,h)}] Ïä§Ïôë: ÏÜêÌå® ‚Üî ${i}${l+1}`),R(a,t)}}}}else O.kind==="slot"&&O.fromSide!=null&&O.fromIdx!=null&&(O.fromSide===s.side&&O.fromIdx===s.idx||t.onMoveSlotCard(O.fromSide,O.fromIdx,s.side,s.idx))}O?.sourceEl&&O.sourceEl.classList.remove("isDraggingSource"),O=null,Te=null,R(r,t)}}),window.addEventListener("keydown",n=>{const r=n.target;if(r&&(r.tagName==="INPUT"||r.tagName==="TEXTAREA"))return;const o=e();if(!hs()){if(n.ctrlKey&&n.shiftKey&&n.code==="KeyK"){n.preventDefault(),ms();return}if(n.code==="KeyP"){n.preventDefault(),t.onNewRun();return}if(n.code==="Digit4"){if(n.preventDefault(),Z(o)){o.pendingTarget=null,o.pendingTargetQueue=[],o.selectedEnemyIndex=null,y(o,"ÎåÄÏÉÅ ÏÑ†ÌÉù Ï∑®ÏÜå"),R(o,t);return}t.onClearSelected();return}if(n.key==="Tab"){if(n.preventDefault(),o.hand.length===0)return;const s=o.selectedHandCardUid,a=s?o.hand.indexOf(s):-1,i=n.shiftKey?-1:1,l=((a+i)%o.hand.length+o.hand.length)%o.hand.length;o.selectedHandCardUid=o.hand[l],R(o,t);return}if(n.code==="Space"){n.preventDefault();const s=e();if(s.run.finished||s.choice||Z(s))return;t.onAutoAdvance();return}if(n.code==="Digit1"||n.code==="Digit2"||n.code==="Digit3"){n.preventDefault();const s=n.code==="Digit1"?0:n.code==="Digit2"?1:2;if(Z(o)){const a=o.enemies[s];if(!a||a.hp<=0){y(o,`ÎåÄÏÉÅ ÏÑ†ÌÉù Ïã§Ìå®: ${s+1}Î≤à Ï†ÅÏù¥ ÏóÜÏäµÎãàÎã§.`),R(o,t);return}t.onSelectEnemy(s);return}t.onHotkeySlot("front",s);return}if(n.code==="KeyQ"||n.code==="KeyW"||n.code==="KeyE"){n.preventDefault();const s=n.code==="KeyQ"?0:n.code==="KeyW"?1:2;t.onHotkeySlot("back",s);return}if(n.code==="Enter"){n.preventDefault(),!Pr&&sn&&sn();return}}}))}function Ir(e,t){yn(250),bn();const n=e.currentTarget;try{n.setPointerCapture(e.pointerId)}catch{}const r=n.closest(".card");r&&r.classList.add("isDraggingSource");const o=r?.getBoundingClientRect(),s=o?e.clientX-o.left:20,a=o?e.clientY-o.top:20,i=getComputedStyle(document.documentElement),l=parseFloat(i.getPropertyValue("--handCardW"))||void 0,c=parseFloat(i.getPropertyValue("--handCardH"))||void 0;if(O={kind:t.kind,cardUid:t.cardUid,fromHandIndex:t.fromHandIndex,fromSide:t.fromSide,fromIdx:t.fromIdx,pointerId:e.pointerId,startX:e.clientX,startY:e.clientY,x:e.clientX,y:e.clientY,dragging:!1,previewEl:void 0,previewW:o?.width??l,previewH:o?.height??c,grabDX:s,grabDY:a},r){O.sourceEl=r;const h=r.cloneNode(!0);h.classList.remove("inSlot"),h.classList.remove("selected"),h.classList.remove("isDraggingSource"),h.style.position="static",h.style.inset="",h.style.width="100%",h.style.height="100%",h.style.margin="0",h.style.boxSizing="border-box",h.style.opacity="1",h.style.filter="none",h.style.transform="none",h.style.backgroundColor="transparent",O.previewEl=h}}function Wa(e,t){const n=document.elementFromPoint(e,t);if(!n)return!1;let r=n;for(;r;){if(r.dataset?.dropHand==="1")return!0;r=r.parentElement}return!1}function Gn(e,t,n){const r=document.elementFromPoint(e,t);if(!r)return null;const o=Ua(r,["slotSide","slotIndex"]);if(!o)return null;const s=o.dataset.slotSide,a=Number(o.dataset.slotIndex);return s==="back"&&n.backSlotDisabled?.[a]?null:{side:s,idx:a}}function Ua(e,t){let n=e;for(;n;){const r=n.dataset;let o=!0;for(const s of t)if(r[s]==null){o=!1;break}if(o)return n;n=n.parentElement}return null}function Lr(e,t){if(!O||!O.dragging){document.querySelector(".dragLayer")?.remove();return}let n=document.querySelector(".dragLayer");if(n||(n=document.createElement("div"),n.className="dragLayer",n.style.position="fixed",n.style.inset="0",n.style.zIndex="21000",n.style.pointerEvents="none",document.body.appendChild(n)),n.innerHTML="",!O.previewEl)return;const r=document.createElement("div");r.className="dragCardPreview",r.style.position="fixed",r.style.left=`${Math.round(O.x-(O.grabDX??20))}px`,r.style.top=`${Math.round(O.y-(O.grabDY??20))}px`;const o=O.previewW??0,s=O.previewH??0;o>0&&(r.style.width=`${Math.round(o)}px`),s>0&&(r.style.height=`${Math.round(s)}px`),r.style.transform="none",r.style.opacity="1",r.style.filter="none",r.style.boxShadow="0 16px 44px rgba(0,0,0,.65)",r.style.backdropFilter="none",r.style.isolation="isolate",r.style.mixBlendMode="normal",r.style.overflow="hidden",r.style.borderRadius="16px",r.style.background="transparent",r.style.clipPath="inset(0 round 16px)",r.appendChild(O.previewEl),n.appendChild(r)}Br();Fr();const Ka=ds();let rt=zs(Ka);function Hr(e){rt=e,an=Mr(rt,Hr),R(rt,an)}let an=Mr(rt,Hr);R(rt,an);document.documentElement.style.setProperty("--base","/deck-rogue-prototype/");
