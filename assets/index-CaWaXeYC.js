(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();const Wn=(e,t,n)=>Math.max(t,Math.min(n,e)),jr=(e,t,n)=>{const r=parseFloat(e.getPropertyValue(t));return Number.isFinite(r)?r:n},Bo=()=>{const e=window.visualViewport,t=e?.width??window.innerWidth,n=e?.height??window.innerHeight;return{vw:Math.max(1,t),vh:Math.max(1,n)}},os=(e,t)=>Math.min(e/1440,t/900),Io=(e,t)=>t>=e*1.08?"portrait":e>=t*1.08?"landscape":"square",Lo=()=>{try{const e=new URLSearchParams(window.location.search),t=e.get("mobile")??e.get("m"),n=e.get("desktop"),r=e.get("orient");return{forceDevice:(n==="1"?!0:null)?!1:t==="1"?!0:t==="0"?!1:null,forceOrient:r==="portrait"||r==="landscape"||r==="square"?r:null}}catch{return{forceDevice:null,forceOrient:null}}},_r=e=>(window.matchMedia?.("(pointer: coarse)")?.matches??!1)&&e<=980;function as(){const e=document.documentElement,t=Lo(),n=180,r=5,o=7,a=3,s=14,i=360,l=14,c=320,d=64,h=160,m=16,u=22,p=6,y=140;let k=0,T="";const C=()=>{k=0;const N=getComputedStyle(e),{vw:W,vh:j}=Bo(),U=t.forceDevice??_r(W),V=U?jr(N,"--uiScaleMobile",1):jr(N,"--uiScaleDesktop",1),M=Wn(V,.65,1.5),B=a*n+(a-1)*u,K=n*(o/r)*2+p+y,re=t.forceOrient??Io(W,j),ae=U&&re==="portrait",ne=ae?s*2+B:s*2+c+i+l*2+B,se=ae?d+h+m+K+220:d+h+m+K,ce=Math.min(W/ne,j/se),H=os(W,j),$e=ce/Math.max(1e-6,H),Z=Wn($e,.55,1.25),b=Wn(Z*M,.55,2);e.style.setProperty("--uiScaleFit",String(Z)),e.style.setProperty("--uiScale",String(b));const v=`${Math.round(W)}x${Math.round(j)}|${b.toFixed(4)}`;v!==T&&(T=v,window.dispatchEvent(new CustomEvent("deckrogue:layout")))},x=()=>{k||(k=requestAnimationFrame(C))};window.addEventListener("resize",x,{passive:!0}),window.visualViewport?.addEventListener("resize",x,{passive:!0}),window.visualViewport?.addEventListener("scroll",x,{passive:!0}),window.addEventListener("deckrogue:uiFit",x,{passive:!0}),C()}function ss(){let e=!1,t=0,n="";const r=Lo(),o=()=>{const{vw:s,vh:i}=Bo(),l=r.forceOrient??Io(s,i),c=r.forceDevice??_r(s);!e&&s<1180&&(e=!0),e&&s>1220&&(e=!1);const d=document.body;d.classList.toggle("compact",e),d.classList.toggle("mobile",c),d.classList.toggle("desktop",!c),d.classList.toggle("portrait",l==="portrait"),d.classList.toggle("landscape",l==="landscape"),d.classList.toggle("square",l==="square");const h=[e?"c":"n",c?"m":"d",l,Math.round(s),Math.round(i)].join("|");h!==n&&(n=h,window.dispatchEvent(new CustomEvent("deckrogue:layout")))},a=()=>{t||(t=requestAnimationFrame(()=>{t=0,o()}))};window.addEventListener("resize",a,{passive:!0}),window.visualViewport?.addEventListener("resize",a,{passive:!0}),window.visualViewport?.addEventListener("scroll",a,{passive:!0}),o()}const is=(e,t)=>({op:"ifPlaced",side:e,then:t}),sn=e=>is("back",e);function Ce(e,t){const n=e.cards[t],r=e.content.cardsById[n.defId],o=n.upgrade??0,a=r.upgrades?.[o-1],s=a?{...r,...a}:r,i=n?.synth;if(!i)return s;let l=Array.isArray(s.tags)?[...s.tags]:[];const c=Array.isArray(i.addTags)?i.addTags:[];for(const u of c)u&&!l.includes(u)&&l.push(u);let d=s.exhaustWhen;if(i.removeExhaust&&(l=l.filter(u=>u!=="EXHAUST"),d&&d!=="NONE"&&(d="NONE")),!(c.length>0||!!i.removeExhaust))return s;const m={...s};return m.tags=l,i.removeExhaust&&(m.exhaustWhen=d),m}function xe(e,t,n){const r=e.cardsById[t],o=Math.max(0,n|0);if(o<=0)return r;const a=r.upgrades?.[o-1];return a?{...r,...a}:r}function Fe(e,t){const r=e.cards[t].upgrade??0,o=Ce(e,t);return r>0?`${o.name} +${r}`:o.name}const ls=[{id:"field_ration",name:"ì•¼ì „ ì‹ëŸ‰",rarity:"BASIC",frontText:"ë°©ì–´ +3",backText:"S +2",front:[{op:"block",n:3}],back:[{op:"supplies",n:2}],upgrades:[{frontText:"ë°©ì–´ +5",front:[{op:"block",n:5}],backText:"S +3",back:[{op:"supplies",n:3}]}]},{id:"maintenance",name:"ì •ë¹„ ë„êµ¬",rarity:"BASIC",exhaustWhen:"BACK",frontText:"ë°©ì–´ +3",backText:"F -1, ì†Œëª¨",front:[{op:"block",n:3}],back:[{op:"fatigue",n:-1}],upgrades:[{frontText:"ë°©ì–´ +5",front:[{op:"block",n:5}],backText:"F -1, S +2, ì†Œëª¨",back:[{op:"fatigue",n:-1},{op:"supplies",n:2}]}]},{id:"scout",name:"ì •ì°°",rarity:"BASIC",frontText:"ì§€ì • í”¼í•´ 3, ë°©ì–´ +1",backText:"ë“œë¡œìš° 1, S +2",front:[{op:"damageEnemy",target:"select",n:3},{op:"block",n:1}],back:[{op:"draw",n:1},{op:"supplies",n:2}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 4, ë°©ì–´ +2",front:[{op:"damageEnemy",target:"select",n:4},{op:"block",n:2}],backText:"ë“œë¡œìš° 2, S +3",back:[{op:"draw",n:2},{op:"supplies",n:3}]}]},{id:"shield",name:"ë°©íŒ¨",rarity:"BASIC",tags:["FORGE_START"],frontText:"ë°©ì–´ +5",backText:"ë°©ì–´ +3",front:[{op:"block",n:5}],back:[{op:"block",n:3}],upgrades:[{frontText:"ë°©ì–´ +7",front:[{op:"block",n:7}],backText:"ë°©ì–´ +4",back:[{op:"block",n:4}]}]},{id:"power_arrow",name:"ê°•ë ¥í•œ í™”ì‚´",rarity:"BASIC",tags:["FORGE_START","ARROW"],frontText:"ë¬´ì‘ìœ„ í”¼í•´ 10, S -2",backText:"ë¬´ì‘ìœ„ í”¼í•´ 7, S -2",front:[{op:"supplies",n:-2},{op:"damageEnemy",target:"random",n:10}],back:[{op:"supplies",n:-2},{op:"damageEnemy",target:"random",n:7}],upgrades:[{frontText:"ë¬´ì‘ìœ„ í”¼í•´ 13, S -2",front:[{op:"supplies",n:-2},{op:"damageEnemy",target:"random",n:13}],backText:"ë¬´ì‘ìœ„ í”¼í•´ 10, S -2",back:[{op:"supplies",n:-2},{op:"damageEnemy",target:"random",n:10}]}]},{id:"arrow",name:"í™”ì‚´",rarity:"BASIC",tags:["FORGE_START","ARROW"],frontText:"ì§€ì • í”¼í•´ 5",backText:"ì§€ì • í”¼í•´ 5, S -1",front:[{op:"damageEnemy",target:"select",n:5}],back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:5}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 7",front:[{op:"damageEnemy",target:"select",n:7}],backText:"ì§€ì • í”¼í•´ 7, S -1",back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:7}]}]},{id:"debt_paper",name:"ë¹š ë¬¸ì„œ",rarity:"BASIC",frontText:"ì•„ë¬´ ì¼ë„ ì¼ì–´ë‚˜ì§€ ì•ŠìŒ",backText:"ì•„ë¬´ ì¼ë„ ì¼ì–´ë‚˜ì§€ ì•ŠìŒ",front:[],back:[]},{id:"berserk",name:"ê´‘í­í™”",rarity:"COMMON",frontText:"ë¬´ì‘ìœ„ í”¼í•´ 13, S -3",backText:"ë¬´ì‘ìœ„ 4 í”¼í•´, Së§Œí¼ ì¶”ê°€ ë°˜ë³µ, Së¥¼ 0ìœ¼ë¡œ ë§Œë“¦",front:[{op:"damageEnemy",target:"random",n:13},{op:"supplies",n:-3}],back:[{op:"repeatBySupplies",effects:[{op:"damageEnemy",target:"random",n:4}],reset:!0}],upgrades:[{frontText:"ë¬´ì‘ìœ„ í”¼í•´ 18, S -4",front:[{op:"damageEnemy",target:"random",n:18},{op:"supplies",n:-4}],backText:"ë¬´ì‘ìœ„ 5 í”¼í•´, Së§Œí¼ ì¶”ê°€ ë°˜ë³µ, Së¥¼ 0ìœ¼ë¡œ ë§Œë“¦",back:[{op:"repeatBySupplies",effects:[{op:"damageEnemy",target:"random",n:5}],reset:!0}]}]},{id:"arrow_rain",name:"í™”ì‚´ì˜ ë¹„",rarity:"COMMON",tags:["ARROW"],exhaustWhen:"BOTH",frontText:"ì „ì²´ í”¼í•´ 8, S -2, ì†Œëª¨",backText:"ë“œë¡œìš° 2, S +1, F +1, ì†Œëª¨",front:[{op:"damageEnemy",target:"all",n:8},{op:"supplies",n:-2}],back:[{op:"draw",n:2},{op:"supplies",n:1},{op:"fatigue",n:1}],upgrades:[{frontText:"ì „ì²´ í”¼í•´ 10, S -2, ì†Œëª¨",front:[{op:"damageEnemy",target:"all",n:10},{op:"supplies",n:-2}],backText:"ë“œë¡œìš° 2, S +3, F +1, ì†Œëª¨",back:[{op:"draw",n:2},{op:"supplies",n:3},{op:"fatigue",n:1}]}]},{id:"camp_prep",name:"ì•¼ì˜ ì¤€ë¹„",rarity:"COMMON",frontText:"ë°©ì–´ +4, S +1",backText:"S +3",front:[{op:"block",n:4},{op:"supplies",n:1}],back:[{op:"supplies",n:3}],upgrades:[{frontText:"ë°©ì–´ +5, S +2",backText:"S +4",front:[{op:"block",n:5},{op:"supplies",n:2}],back:[{op:"supplies",n:4}]}]},{id:"rapid_fire",name:"ì—°ì† ì‚¬ê²©",rarity:"COMMON",frontText:"ì§€ì • í”¼í•´ 2, 3ë²ˆ ë°œë™",backText:"ì´ë²ˆ í„´ì— ì¹´ë“œë¥¼ ë“œë¡œìš°í–ˆë‹¤ë©´ ë¬´ì‘ìœ„ í”¼í•´ 8",front:[{op:"repeat",times:3,effects:[{op:"damageEnemy",target:"select",n:2}]}],back:[{op:"ifDrewThisTurn",then:[{op:"damageEnemy",target:"random",n:8}]}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 2, 4ë²ˆ ë°œë™",backText:"ì´ë²ˆ í„´ì— ì¹´ë“œë¥¼ ë“œë¡œìš°í–ˆë‹¤ë©´ ë¬´ì‘ìœ„ í”¼í•´ 10",front:[{op:"repeat",times:4,effects:[{op:"damageEnemy",target:"select",n:2}]}],back:[{op:"ifDrewThisTurn",then:[{op:"damageEnemy",target:"random",n:10}]}]}]},{id:"quiet_ambush",name:"ì¡°ìš©í•œ ê¸‰ìŠµ",rarity:"COMMON",frontText:"ì§€ì • í”¼í•´ 8, Sê°€ 2 ì´í•˜ë©´ ëŒ€ì‹  ì·¨ì•½ +2 í›„ ì§€ì • í”¼í•´ 13",backText:"ë“œë¡œìš° 1, Sê°€ 2 ì´í•˜ë©´ ëŒ€ì‹  ë“œë¡œìš° 2",front:[{op:"ifPlayerSuppliesAtMost",n:2,then:[{op:"statusEnemy",target:"select",key:"vuln",n:2},{op:"damageEnemy",target:"select",n:13}],else:[{op:"damageEnemy",target:"select",n:8}]}],back:[{op:"ifPlayerSuppliesAtMost",n:2,then:[{op:"draw",n:2}],else:[{op:"draw",n:1}]}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 8, Sê°€ 2 ì´í•˜ë©´ ëŒ€ì‹  ì·¨ì•½ +3 í›„ ì§€ì • í”¼í•´ 14",front:[{op:"ifPlayerSuppliesAtMost",n:2,then:[{op:"statusEnemy",target:"select",key:"vuln",n:3},{op:"damageEnemy",target:"select",n:14}],else:[{op:"damageEnemy",target:"select",n:8}]}]}]},{id:"blood_contract",name:"í”¼ì˜ ê³„ì•½",rarity:"COMMON",frontText:"ì§€ì • í”¼í•´ 15, HP -3",backText:"S +4, F +1",front:[{op:"damageEnemy",target:"select",n:15},{op:"hp",n:-3}],back:[{op:"supplies",n:4},{op:"fatigue",n:1}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 18, HP -3",backText:"S +5, F +1",front:[{op:"damageEnemy",target:"select",n:18},{op:"hp",n:-3}],back:[{op:"supplies",n:5},{op:"fatigue",n:1}]}]},{id:"brawl_cleaver",name:"ë‚œì „ ì •ë¦¬",rarity:"COMMON",frontText:"ì§€ì • í”¼í•´ 10, ì ì´ 3ëª…ì´ë©´ ëŒ€ì‹  í”¼í•´ 16",backText:"ë°©ì–´ +5",front:[{op:"damageEnemyFormula",target:"select",kind:"triple_bounty"}],back:[{op:"block",n:5}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 10, ì ì´ 3ëª…ì´ë©´ ëŒ€ì‹  í”¼í•´ 20",front:[{op:"damageEnemyFormula",target:"select",kind:"triple_bounty_u1"}],backText:"ë°©ì–´ +6",back:[{op:"block",n:6}]}]},{id:"gambler_glove",name:"ë„ë°•ì‚¬ì˜ ì¥ê°‘",rarity:"COMMON",tags:["INSTALL"],installWhen:"FRONT",passives:[{kind:"onDrawGainBlock",side:"front",block:2,perTurnCap:6}],frontText:"ì¹´ë“œë¥¼ ë“œë¡œìš°í•  ë•Œë§ˆë‹¤ ë°©ì–´ +2 (ìµœëŒ€ 6) (ì„¤ì¹˜)",backText:"ì†íŒ¨ë¥¼ ëª¨ë‘ ë²„ë¦¼, ë²„ë¦° ë§Œí¼ ë“œë¡œìš°",front:[],back:[{op:"discardHandAllDraw"}],upgrades:[{passives:[{kind:"onDrawGainBlock",side:"front",block:2,perTurnCap:10}],frontText:"ì¹´ë“œë¥¼ ë“œë¡œìš°í•  ë•Œë§ˆë‹¤ ë°©ì–´ +2 (ìµœëŒ€ 10) (ì„¤ì¹˜)",backText:"ì†íŒ¨ë¥¼ ëª¨ë‘ ë²„ë¦¼, ë²„ë¦° ë§Œí¼ ë“œë¡œìš°. ë“œë¡œìš° 1",front:[],back:[{op:"discardHandAllDraw",extraDraw:1}]}]},{id:"install_ballista",name:"ë°œë¦¬ìŠ¤íƒ€",rarity:"COMMON",tags:["INSTALL"],installWhen:"BOTH",frontText:"ì§€ì • í”¼í•´ 5 (ì„¤ì¹˜)",backText:"ë¬´ì‘ìœ„ í”¼í•´ 4 (ì„¤ì¹˜)",front:[{op:"damageEnemy",target:"select",n:5}],back:[{op:"damageEnemy",target:"random",n:4}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 7 (ì„¤ì¹˜)",backText:"ë¬´ì‘ìœ„ í”¼í•´ 5 (ì„¤ì¹˜)",front:[{op:"damageEnemy",target:"select",n:7}],back:[{op:"damageEnemy",target:"random",n:5}]}]},{id:"install_iron_bulwark",name:"ì² ê°‘ ë°©ë²½",rarity:"COMMON",tags:["INSTALL"],installWhen:"BOTH",frontText:"ë°©ì–´ +5 (ì„¤ì¹˜)",backText:"ë°©ì–´ +3 (ì„¤ì¹˜)",front:[{op:"block",n:5}],back:[{op:"block",n:3}],upgrades:[{frontText:"ë°©ì–´ +7 (ì„¤ì¹˜)",backText:"ë°©ì–´ +4 (ì„¤ì¹˜)",front:[{op:"block",n:7}],back:[{op:"block",n:4}]}]},{id:"install_lead_observation",name:"ì„ ë‘ ê´€ì¸¡",rarity:"COMMON",tags:["INSTALL"],installWhen:"BOTH",passives:[{kind:"bonusDamageToEnemyIndex",side:"front",enemyIndex:0,bonus:3},{kind:"bonusDamageToEnemyIndex",side:"back",enemyIndex:2,bonus:3}],frontText:"1ë²ˆ ì ì—ê²Œ ì£¼ëŠ” í”¼í•´ +3 (ì„¤ì¹˜)",backText:"3ë²ˆ ì ì—ê²Œ ì£¼ëŠ” í”¼í•´ +3 (ì„¤ì¹˜)",front:[],back:[],upgrades:[{frontText:"1ë²ˆ ì ì—ê²Œ ì£¼ëŠ” í”¼í•´ +3, ë°©ì–´ +2 (ì„¤ì¹˜)",backText:"3ë²ˆ ì ì—ê²Œ ì£¼ëŠ” í”¼í•´ +3, ë°©ì–´ +2 (ì„¤ì¹˜)",front:[{op:"block",n:2}],back:[{op:"block",n:2}]}]},{id:"innate_march_shield",name:"ê¸°ë™ ë°©íŒ¨",rarity:"COMMON",tags:["INNATE"],frontText:"ë°©ì–´ +7 (ì„ ì²œì„±)",backText:"ë°©ì–´ +4 (ì„ ì²œì„±)",front:[{op:"block",n:7}],back:[{op:"block",n:4}],upgrades:[{frontText:"ë°©ì–´ +9 (ì„ ì²œì„±)",backText:"ë°©ì–´ +6 (ì„ ì²œì„±)",front:[{op:"block",n:9}],back:[{op:"block",n:6}]}]},{id:"install_castle_ballista",name:"ì„±ê³½ ì‡ ë‡Œ",rarity:"COMMON",tags:["INSTALL"],installWhen:"BOTH",frontText:"ë¬´ì‘ìœ„ í”¼í•´ 1 + ì„¤ì¹˜í•œ í„´ ìˆ˜ (ì„¤ì¹˜)",backText:"ë°©ì–´ +2 (ì„¤ì¹˜)",front:[{op:"damageEnemyFormula",target:"random",kind:"castle_ballista_age"}],back:[{op:"block",n:2}],upgrades:[{frontText:"ë¬´ì‘ìœ„ í”¼í•´ 2 + ì„¤ì¹˜í•œ í„´ ìˆ˜ (ì„¤ì¹˜)",backText:"ë°©ì–´ +3 (ì„¤ì¹˜)",front:[{op:"damageEnemyFormula",target:"random",kind:"castle_ballista_age_u1"}],back:[{op:"block",n:3}]}]},{id:"token_moon_scroll",name:"ë‹¬ë¹› ë‘ë£¨ë§ˆë¦¬",rarity:"COMMON",tags:["TOKEN","EXHAUST"],passives:[{kind:"onPlaceIncrementUnlockProgress",counter:"moonScrollUses",n:1}],frontText:"ì§€ì • ì·¨ì•½ 1 ë¶€ì—¬, ì†Œëª¨",backText:"ë°©ì–´ +2, ì†Œëª¨",front:[{op:"statusEnemy",target:"select",key:"vuln",n:1}],back:[{op:"block",n:2}]},{id:"install_wedge_spike",name:"ìê¸° ë°•ê¸°",rarity:"COMMON",tags:["LOCKED","INSTALL"],installWhen:"BOTH",frontText:"ì´ë²ˆ í„´ì— ì„¤ì¹˜ ì‹œ, ì²´ë ¥ì´ ê°€ì¥ ë‚®ì€ ì  í”¼í•´ 15 (ë¶€ë™) (ì„¤ì¹˜)",backText:"ì´ë²ˆ í„´ì— ì„¤ì¹˜ ì‹œ, ì²´ë ¥ì´ ê°€ì¥ ë‚®ì€ ì  í”¼í•´ 15 (ë¶€ë™) (ì„¤ì¹˜)",front:[{op:"ifPlacedThisTurn",then:[{op:"damageEnemyLowestHp",n:15}]}],back:[{op:"ifPlacedThisTurn",then:[{op:"damageEnemyLowestHp",n:15}]}],upgrades:[{tags:["LOCKED","INSTALL"],installWhen:"BOTH",frontText:"ì´ë²ˆ í„´ì— ì„¤ì¹˜ ì‹œ, ì²´ë ¥ì´ ê°€ì¥ ë‚®ì€ ì  í”¼í•´ 20 (ë¶€ë™) (ì„¤ì¹˜)",backText:"ì´ë²ˆ í„´ì— ì„¤ì¹˜ ì‹œ, ì²´ë ¥ì´ ê°€ì¥ ë‚®ì€ ì  í”¼í•´ 20 (ë¶€ë™) (ì„¤ì¹˜)",front:[{op:"ifPlacedThisTurn",then:[{op:"damageEnemyLowestHp",n:20}]}],back:[{op:"ifPlacedThisTurn",then:[{op:"damageEnemyLowestHp",n:20}]}]}]},{id:"blood_tribute",name:"í”¼ì˜ ê³µë¬¼",rarity:"COMMON",frontText:"HP -4, S +4",backText:"HP +4, F +1",front:[{op:"hp",n:-4},{op:"supplies",n:4}],back:[{op:"heal",n:4},{op:"fatigue",n:1}],upgrades:[{frontText:"HP -4, S +6",backText:"HP +6, F +1",front:[{op:"hp",n:-4},{op:"supplies",n:6}],back:[{op:"heal",n:6},{op:"fatigue",n:1}]}]},{id:"heavy_shield",name:"ìœ¡ì¤‘í•œ ë°©íŒ¨",rarity:"COMMON",frontText:"ë°©ì–´ê°€ 8 ì´ìƒì´ë©´, ë°©ì–´ +8",backText:"í˜„ì¬ ë°©ì–´ë„ë§Œí¼ ë¬´ì‘ìœ„ í”¼í•´",front:[{op:"ifPlayerBlockAtLeast",n:8,then:[{op:"block",n:8}]}],back:[{op:"damageEnemyByPlayerBlock",target:"random",mult:1}],upgrades:[{frontText:"ë°©ì–´ê°€ 8 ì´ìƒì´ë©´, ë°©ì–´ë¥¼ ë‘ ë°°ë¡œ ë§Œë“¦",backText:"í˜„ì¬ ë°©ì–´ë„ë§Œí¼ ì§€ì • í”¼í•´",front:[{op:"ifPlayerBlockAtLeast",n:8,then:[{op:"blockByPlayerBlock",mult:1}]}],back:[{op:"damageEnemyByPlayerBlock",target:"select",mult:1}]}]},{id:"reinforced_bastion",name:"ê°•í™”ëœ ë°©ë²½",rarity:"COMMON",frontText:"ë‹¤ë¥¸ ì„¤ì¹˜ ì¹´ë“œ í•˜ë‚˜ ë‹¹ ë°©ì–´ +2",backText:"ë‹¤ë¥¸ ì„¤ì¹˜ ì¹´ë“œ í•˜ë‚˜ ë‹¹ S +1",front:[{op:"repeatByOtherInstall",effects:[{op:"block",n:2}]}],back:[{op:"repeatByOtherInstall",effects:[{op:"supplies",n:1}]}],upgrades:[{tags:["INSTALL"],installWhen:"BOTH",frontText:"ë‹¤ë¥¸ ì„¤ì¹˜ ì¹´ë“œ í•˜ë‚˜ ë‹¹ ë°©ì–´ +2 (ì„¤ì¹˜)",backText:"ë‹¤ë¥¸ ì„¤ì¹˜ ì¹´ë“œ í•˜ë‚˜ ë‹¹ S +1 (ì„¤ì¹˜)",front:[{op:"repeatByOtherInstall",effects:[{op:"block",n:2}]}],back:[{op:"repeatByOtherInstall",effects:[{op:"supplies",n:1}]}]}]},{id:"improv_arrow",name:"ê¸‰ì¡°ëœ í™”ì‚´",rarity:"COMMON",tags:["INSTALL","ARROW"],installWhen:"BACK",frontText:"ë¬´ì‘ìœ„ í”¼í•´ 10, ì†íŒ¨ ë¬´ì‘ìœ„ 1ì¥ ë²„ë¦¼",backText:"ë‚´ í™”ì‚´ ì¹´ë“œì˜ ê³µê²©ë ¥ +3 (ì„¤ì¹˜)",front:[{op:"damageEnemy",target:"random",n:10},{op:"discardHandRandom",n:1}],back:[{op:"increaseCardDamageByTag",tag:"ARROW",n:3}],upgrades:[{frontText:"ë¬´ì‘ìœ„ í”¼í•´ 14, ì†íŒ¨ ë¬´ì‘ìœ„ 1ì¥ ë²„ë¦¼",backText:"ë‚´ í™”ì‚´ ì¹´ë“œì˜ ê³µê²©ë ¥ +4 (ì„¤ì¹˜)",front:[{op:"damageEnemy",target:"random",n:14},{op:"discardHandRandom",n:1}],back:[{op:"increaseCardDamageByTag",tag:"ARROW",n:4}]}]},{id:"low_body_temperature",name:"ë‚®ì€ ì²´ì˜¨",rarity:"COMMON",frontText:"ìì‹ ì˜ ì•½í™” 1, ì·¨ì•½ 1 ì œê±°, Sê°€ 2 ì´í•˜ë©´ ëŒ€ì‹  ì•½í™”/ì·¨ì•½/ì¶œí˜ˆ 2 ì œê±°",backText:"ë“œë¡œìš° 1, Sê°€ 2 ì´í•˜ë©´ ëŒ€ì‹  ì´ë²ˆ í„´ ë°›ëŠ” í”¼í•´ -2",front:[{op:"ifPlayerSuppliesAtMost",n:2,then:[{op:"statusPlayer",key:"weak",n:-2},{op:"statusPlayer",key:"vuln",n:-2},{op:"statusPlayer",key:"bleed",n:-2}],else:[{op:"statusPlayer",key:"weak",n:-1},{op:"statusPlayer",key:"vuln",n:-1}]}],back:[{op:"ifPlayerSuppliesAtMost",n:2,then:[{op:"reduceIncomingDamageThisTurn",n:2}],else:[{op:"draw",n:1}]}],upgrades:[{frontText:"ìì‹ ì˜ ì•½í™” 1, ì·¨ì•½ 1 ì œê±°, Sê°€ 2 ì´í•˜ë©´ ëŒ€ì‹  ì•½í™”/ì·¨ì•½/ì¶œí˜ˆ 3 ì œê±°",backText:"ë“œë¡œìš° 1, Sê°€ 2 ì´í•˜ë©´ ëŒ€ì‹  ë“œë¡œìš° 2, ì´ë²ˆ í„´ ë°›ëŠ” í”¼í•´ -3",front:[{op:"ifPlayerSuppliesAtMost",n:2,then:[{op:"statusPlayer",key:"weak",n:-3},{op:"statusPlayer",key:"vuln",n:-3},{op:"statusPlayer",key:"bleed",n:-3}],else:[{op:"statusPlayer",key:"weak",n:-1},{op:"statusPlayer",key:"vuln",n:-1}]}],back:[{op:"ifPlayerSuppliesAtMost",n:2,then:[{op:"draw",n:2},{op:"reduceIncomingDamageThisTurn",n:3}],else:[{op:"draw",n:1}]}]}]},{id:"bandage",name:"ë¶•ëŒ€",rarity:"SPECIAL",exhaustWhen:"BOTH",frontText:"HP +4, ì†Œëª¨",backText:"HP +4, S -1, ì†Œëª¨",front:[{op:"heal",n:4}],back:[{op:"supplies",n:-1},{op:"heal",n:4}],upgrades:[{frontText:"HP +4, ì¶œí˜ˆ ì œê±°, ì†Œëª¨",front:[{op:"heal",n:4},{op:"clearStatusSelf",key:"bleed"}],backText:"HP +4, ì¶œí˜ˆ ì œê±°, S -1, ì†Œëª¨",back:[{op:"supplies",n:-1},{op:"heal",n:4},{op:"clearStatusSelf",key:"bleed"}]}]},{id:"caltrops",name:"ë§ˆë¦„ì‡ ",rarity:"SPECIAL",frontText:"ì „ì²´ ì¶œí˜ˆ +4",backText:"ìì‹ ì„ ê³µê²©í•˜ë ¤ëŠ” ì ì—ê²Œ ì¶œí˜ˆ +3",front:[{op:"statusEnemy",target:"all",key:"bleed",n:4}],back:[{op:"statusEnemiesAttackingThisTurn",key:"bleed",n:3}],upgrades:[{frontText:"ì „ì²´ ì¶œí˜ˆ +5",backText:"ìì‹ ì„ ê³µê²©í•˜ë ¤ëŠ” ì ì—ê²Œ ì¶œí˜ˆ +4",front:[{op:"statusEnemy",target:"all",key:"bleed",n:5}],back:[{op:"statusEnemiesAttackingThisTurn",key:"bleed",n:4}]}]},{id:"painkiller",name:"ì§„í†µì œ",rarity:"SPECIAL",exhaustWhen:"FRONT",vanishWhen:"BACK",frontText:"HP -8, F -3, ì†Œëª¨",backText:"HP +8, F +1, ì†Œì‹¤",front:[{op:"hp",n:-8},{op:"fatigue",n:-3}],back:[{op:"hp",n:8},{op:"fatigue",n:1}],upgrades:[{frontText:"HP -6, F -3, ì†Œëª¨",backText:"HP +11, F +1, ì†Œì‹¤",front:[{op:"hp",n:-6},{op:"fatigue",n:-3}],back:[{op:"hp",n:11},{op:"fatigue",n:1}]}]},{id:"vital_shot",name:"ê¸‰ì†Œ ì‚¬ê²©",rarity:"SPECIAL",frontText:"ì§€ì • í”¼í•´ 8",backText:"ì§€ì • í”¼í•´ 5, ì¶œí˜ˆ +2, S -1",front:[{op:"damageEnemy",target:"select",n:8}],back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:5},{op:"statusEnemy",target:"select",key:"bleed",n:2}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 11",backText:"ì§€ì • í”¼í•´ 6, ì¶œí˜ˆ +3, S -1",front:[{op:"damageEnemy",target:"select",n:11}],back:[{op:"supplies",n:-1},{op:"damageEnemy",target:"select",n:6},{op:"statusEnemy",target:"select",key:"bleed",n:3}]}]},{id:"taunt",name:"ë…ì„¤",rarity:"SPECIAL",frontText:"ì§€ì • ì•½í™” +4",backText:"ì „ì²´ ì·¨ì•½ +2 ë° ì•½í™” +2",front:[{op:"statusEnemy",target:"select",key:"weak",n:4}],back:[{op:"statusEnemy",target:"all",key:"vuln",n:2},{op:"statusEnemy",target:"all",key:"weak",n:2}],upgrades:[{frontText:"ì§€ì • ì•½í™” +5",backText:"ì „ì²´ ì·¨ì•½ +2 ë° ì•½í™” +3",front:[{op:"statusEnemy",target:"select",key:"weak",n:5}],back:[{op:"statusEnemy",target:"all",key:"vuln",n:2},{op:"statusEnemy",target:"all",key:"weak",n:3}]}]},{id:"cloth_scrap_armor",name:"ì²œ ì¡°ê° ê°‘ì˜·",rarity:"SPECIAL",frontText:"ë°©ì–´ +9, S -1",backText:"ë°©ì–´ +4",front:[{op:"supplies",n:-1},{op:"block",n:9}],back:[{op:"block",n:4}],upgrades:[{frontText:"ë°©ì–´ +11, S -1",backText:"ë°©ì–´ +5",front:[{op:"supplies",n:-1},{op:"block",n:11}],back:[{op:"block",n:5}]}]},{id:"hide_on_floor",name:"ë°”ë‹¥ ìˆ¨ê¸°",rarity:"SPECIAL",frontText:"ë°©ì–´ +6, Sê°€ 2 ì´í•˜ë©´ ëŒ€ì‹  ë°©ì–´ +12, êµë€ -1",backText:"S +2, Sê°€ 2ë³´ë‹¤ ë‚®ìœ¼ë©´ ëŒ€ì‹  Së¥¼ 3ìœ¼ë¡œ ë§Œë“¦",front:[{op:"ifPlayerSuppliesAtMost",n:2,then:[{op:"block",n:12},{op:"statusPlayer",key:"disrupt",n:-1}],else:[{op:"block",n:6}]}],back:[{op:"ifPlayerSuppliesAtMost",n:1,then:[{op:"setSupplies",n:3}],else:[{op:"supplies",n:2}]}],upgrades:[{frontText:"ë°©ì–´ +6, Sê°€ 2 ì´í•˜ë©´ ëŒ€ì‹  ë°©ì–´ +14, êµë€ -1",backText:"S +2, Sê°€ 2ë³´ë‹¤ ë‚®ìœ¼ë©´ ëŒ€ì‹  Së¥¼ 3ìœ¼ë¡œ ë§Œë“¦, ë°©ì–´ +2",front:[{op:"ifPlayerSuppliesAtMost",n:2,then:[{op:"block",n:14},{op:"statusPlayer",key:"disrupt",n:-1}],else:[{op:"block",n:6}]}],back:[{op:"ifPlayerSuppliesAtMost",n:1,then:[{op:"setSupplies",n:3}],else:[{op:"supplies",n:2}]},{op:"block",n:2}]}]},{id:"prey_mark",name:"ì‚¬ëƒ¥ê° í‘œì‹œ",rarity:"SPECIAL",frontText:"ì§€ì • í”¼í•´ 10, HPê°€ í”Œë ˆì´ì–´ë³´ë‹¤ ë†’ìœ¼ë©´ í”¼í•´ 15",backText:"ì§€ì • ì·¨ì•½ +2",front:[{op:"damageEnemyFormula",target:"select",kind:"prey_mark"}],back:[{op:"statusEnemy",target:"select",key:"vuln",n:2}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 12, HPê°€ í”Œë ˆì´ì–´ë³´ë‹¤ ë†’ìœ¼ë©´ í”¼í•´ 18",front:[{op:"damageEnemyFormula",target:"select",kind:"prey_mark_u1"}],backText:"ì§€ì • ì·¨ì•½ +3",back:[{op:"statusEnemy",target:"select",key:"vuln",n:3}]}]},{id:"lone_blow",name:"ê³ ë…í•œ ì¼ê²©",rarity:"SPECIAL",frontText:"ì´ë²ˆ í„´ ì´ ì¹´ë“œë§Œ ì‚¬ìš© ì‹œ, ì§€ì • í”¼í•´ 20",backText:"ì´ë²ˆ í„´ ì´ ì¹´ë“œë§Œ ì‚¬ìš© ì‹œ, ë°©ì–´ +10",front:[{op:"damageEnemyFormula",target:"select",kind:"lone_blow_20"}],back:[{op:"blockFormula",kind:"lone_blow_block_10"}],upgrades:[{frontText:"ì´ë²ˆ í„´ ì´ ì¹´ë“œë§Œ ì‚¬ìš© ì‹œ, ì§€ì • í”¼í•´ 26",backText:"ì´ë²ˆ í„´ ì´ ì¹´ë“œë§Œ ì‚¬ìš© ì‹œ, ë°©ì–´ +14",front:[{op:"damageEnemyFormula",target:"select",kind:"lone_blow_26"}],back:[{op:"blockFormula",kind:"lone_blow_block_14"}]}]},{id:"install_cursed_banner",name:"ì €ì£¼ì˜ ê¹ƒë°œ",rarity:"SPECIAL",tags:["INSTALL"],installWhen:"BOTH",frontText:"ë¬´ì‘ìœ„ ì ì—ê²Œ ì·¨ì•½ +1 (ì„¤ì¹˜)",backText:"ë°©ì–´ +2 (ì„¤ì¹˜)",front:[{op:"statusEnemy",target:"random",key:"vuln",n:1}],back:[{op:"block",n:2}],upgrades:[{frontText:"ë¬´ì‘ìœ„ ì ì—ê²Œ ì·¨ì•½ +2 (ì„¤ì¹˜)",backText:"ë°©ì–´ +3 (ì„¤ì¹˜)",front:[{op:"statusEnemy",target:"random",key:"vuln",n:2}],back:[{op:"block",n:3}]}]},{id:"scribe_hand",name:"í•„ê²½ì‚¬ì˜ ì†",rarity:"SPECIAL",frontText:"ë°©ì–´ +5",backText:"ë‹¬ë¹› ë‘ë£¨ë§ˆë¦¬ 2ì¥ ìƒì„±",front:[{op:"block",n:5}],back:[{op:"addCardToHand",defId:"token_moon_scroll",n:2}],upgrades:[{frontText:"ë°©ì–´ +7",backText:"ë‹¬ë¹› ë‘ë£¨ë§ˆë¦¬ 3ì¥ ìƒì„±",front:[{op:"block",n:7}],back:[{op:"addCardToHand",defId:"token_moon_scroll",n:3}]}]},{id:"fuel_kindling",name:"ë•”ê° ì‚¼ê¸°",rarity:"SPECIAL",frontText:"ì™¼ìª½ì— ìˆëŠ” ì¹´ë“œë¥¼ ì†Œëª¨, ì†Œëª¨í–ˆë‹¤ë©´ S +3",backText:"ì˜¤ë¥¸ìª½ì— ìˆëŠ” ì¹´ë“œë¥¼ ì†Œëª¨, ì†Œëª¨í–ˆë‹¤ë©´ S +4",front:[{op:"exhaustRelativeSlotByCurrentPosition",frontOffset:-1,backOffset:1,then:[{op:"supplies",n:3}]}],back:[{op:"exhaustRelativeSlotByCurrentPosition",frontOffset:-1,backOffset:1,then:[{op:"supplies",n:4}]}],upgrades:[{frontText:"ì™¼ìª½ì— ìˆëŠ” ì¹´ë“œë¥¼ ì†Œëª¨, ì†Œëª¨í–ˆë‹¤ë©´ S +4",backText:"ì˜¤ë¥¸ìª½ì— ìˆëŠ” ì¹´ë“œë¥¼ ì†Œëª¨, ì†Œëª¨í–ˆë‹¤ë©´ S +5",front:[{op:"exhaustRelativeSlotByCurrentPosition",frontOffset:-1,backOffset:1,then:[{op:"supplies",n:4}]}],back:[{op:"exhaustRelativeSlotByCurrentPosition",frontOffset:-1,backOffset:1,then:[{op:"supplies",n:5}]}]}]},{id:"impossible_plan",name:"ë¶ˆê°€ëŠ¥í•œ ê³„íš",rarity:"SPECIAL",frontText:"ì´ ì¹´ë“œê°€ í›„ì—´ì— ë°°ì¹˜ë˜ì–´ìˆë‹¤ë©´ ì „ì²´ í”¼í•´ 25",backText:"ì–´ë–»ê²Œ?",front:[sn([{op:"damageEnemy",target:"all",n:25}])],back:[],upgrades:[{frontText:"ì´ ì¹´ë“œê°€ í›„ì—´ì— ë°°ì¹˜ë˜ì–´ìˆë‹¤ë©´ ì „ì²´ í”¼í•´ 30",backText:"ì–´ë–»ê²Œ?",front:[sn([{op:"damageEnemy",target:"all",n:30}])],back:[]}]},{id:"slash_frenzy",name:"ì¹¼ë¶€ë¦¼",rarity:"SPECIAL",tags:["INSTALL"],installWhen:"BACK",frontText:"ë¬´ì‘ìœ„ í”¼í•´ 7, ğŸ—¡ï¸ ì¹¼ë¶€ë¦¼ë§Œí¼ ì¶”ê°€ ë°˜ë³µ, ğŸ—¡ï¸ ì¹¼ë¶€ë¦¼ì„ 0ìœ¼ë¡œ",backText:"[ì„¤ì¹˜] S -1, ğŸ—¡ï¸ ì¹¼ë¶€ë¦¼ +1",front:[{op:"damageEnemyRepeatByStatus",target:"random",n:7,key:"slash",reset:!0}],back:[{op:"supplies",n:-1},{op:"statusPlayer",key:"slash",n:1}],upgrades:[{frontText:"ë¬´ì‘ìœ„ í”¼í•´ 8, ğŸ—¡ï¸ ì¹¼ë¶€ë¦¼ë§Œí¼ ì¶”ê°€ ë°˜ë³µ, ğŸ—¡ï¸ ì¹¼ë¶€ë¦¼ì„ 0ìœ¼ë¡œ",front:[{op:"damageEnemyRepeatByStatus",target:"random",n:8,key:"slash",reset:!0}]}]},{id:"doppelganger",name:"ë„í”Œê°±ì–´",rarity:"SPECIAL",frontText:"ì „ì—´ íš¨ê³¼: í›„ì—´ì— ë„í”Œê°±ì–´ê°€ ìˆìœ¼ë©´ ë¬´ì‘ìœ„ í”¼í•´ 4, 4ë²ˆ",backText:"í›„ì—´ íš¨ê³¼: ì „ì—´ì— ë„í”Œê°±ì–´ê°€ ìˆìœ¼ë©´ ë“œë¡œìš° 4, S +4",front:[{op:"ifOtherRowHasDefId",defId:"doppelganger",then:[{op:"repeat",times:4,effects:[{op:"damageEnemy",target:"random",n:4}]}]}],back:[{op:"ifOtherRowHasDefId",defId:"doppelganger",then:[{op:"supplies",n:4},{op:"draw",n:4}]}],upgrades:[{frontText:"ì „ì—´ íš¨ê³¼: í›„ì—´ì— ë„í”Œê°±ì–´ê°€ ìˆìœ¼ë©´ ë¬´ì‘ìœ„ í”¼í•´ 5, 5ë²ˆ",backText:"í›„ì—´ íš¨ê³¼: ì „ì—´ì— ë„í”Œê°±ì–´ê°€ ìˆìœ¼ë©´ ë“œë¡œìš° 5, S +5",front:[{op:"ifOtherRowHasDefId",defId:"doppelganger",then:[{op:"repeat",times:5,effects:[{op:"damageEnemy",target:"random",n:5}]}]}],back:[{op:"ifOtherRowHasDefId",defId:"doppelganger",then:[{op:"supplies",n:5},{op:"draw",n:5}]}]}]},{id:"smoke",name:"ì—°ë§‰",rarity:"RARE",vanishWhen:"FRONT",frontText:"ì´ë²ˆ í„´ ì  ê³µê²© í”¼í•´ ë¬´íš¨, ì†Œì‹¤",backText:"F +1",front:[{op:"nullifyDamageThisTurn"}],back:[{op:"fatigue",n:1}]},{id:"redeploy",name:"ì¬ë°°ì¹˜",rarity:"RARE",frontText:"S +2",backText:"3ë²ˆ ìŠ¬ë¡¯ì— ìˆëŠ” í›„ì—´ ì¹´ë“œì˜ ì „ì—´ íš¨ê³¼ ë°œë™",front:[{op:"supplies",n:2}],back:[{op:"triggerFrontOfBackSlot",index:2}],upgrades:[{frontText:"S +3",front:[{op:"supplies",n:3}],backText:"3ë²ˆ ìŠ¬ë¡¯ì— ìˆëŠ” í›„ì—´ ì¹´ë“œì˜ ì „ì—´ íš¨ê³¼ ë°œë™, S +1",back:[{op:"triggerFrontOfBackSlot",index:2},{op:"supplies",n:1}]}]},{id:"secret_strike",name:"ë¹„ì¥ì˜ ì¼ê²©",rarity:"RARE",exhaustWhen:"BOTH",frontText:"ë¬´ì‘ìœ„ í”¼í•´ (Fì˜ 2ë°°), ì†Œëª¨",backText:"ì „ì²´ ì·¨ì•½ +3 ë° ì•½í™” +3, ì†Œëª¨",front:[{op:"damageEnemyByPlayerFatigue",target:"random",mult:2}],back:[{op:"statusEnemy",target:"all",key:"vuln",n:3},{op:"statusEnemy",target:"all",key:"weak",n:3}],upgrades:[{exhaustWhen:"BOTH",frontText:"ì§€ì • í”¼í•´ (Fì˜ 2ë°°), ì†Œëª¨",front:[{op:"damageEnemyByPlayerFatigue",target:"select",mult:2}],backText:"ì „ì²´ ì·¨ì•½ +4 ë° ì•½í™” +4, ì†Œëª¨",back:[{op:"statusEnemy",target:"all",key:"vuln",n:4},{op:"statusEnemy",target:"all",key:"weak",n:4}]}]},{id:"fire_scroll",name:"í™”ì—¼ ë‘ë£¨ë§ˆë¦¬",rarity:"RARE",exhaustWhen:"FRONT",vanishWhen:"BACK",frontText:"ì „ì²´ í”¼í•´ 8, ì†Œëª¨",backText:"ì „ì²´ í”¼í•´ 16, ì†Œì‹¤",front:[{op:"damageEnemy",target:"all",n:8}],back:[{op:"damageEnemy",target:"all",n:16}],upgrades:[{frontText:"ì „ì²´ í”¼í•´ 11, ì†Œëª¨",front:[{op:"damageEnemy",target:"all",n:11}],backText:"ì „ì²´ í”¼í•´ 20, ì†Œì‹¤",back:[{op:"damageEnemy",target:"all",n:20}]}]},{id:"emergency_rations",name:"ë¹„ìƒì‹ëŸ‰",rarity:"RARE",exhaustWhen:"BACK",frontText:"S +2",backText:"Së¥¼ 7ë¡œ ë§Œë“¦, ì†Œëª¨",front:[{op:"supplies",n:2}],back:[{op:"setSupplies",n:7}],upgrades:[{frontText:"S +3",backText:"Së¥¼ 10ìœ¼ë¡œ ë§Œë“¦, ì†Œëª¨",front:[{op:"supplies",n:3}],back:[{op:"setSupplies",n:10}]}]},{id:"field_experience",name:"ì‹¤ì „ ê²½í—˜",rarity:"RARE",exhaustWhen:"BACK",frontText:"ì „ì²´ í”¼í•´ 3",backText:"ì´ ì¹´ë“œê°€ í›„ì—´ì— ìˆëŠ” í„´ì— ìŠ¹ë¦¬í•˜ë©´ ìµœëŒ€ ì²´ë ¥ +2, ì†Œëª¨",front:[{op:"damageEnemy",target:"all",n:3}],back:[],onWinWhileInBack:[{op:"maxHp",n:2}],upgrades:[{frontText:"ì „ì²´ í”¼í•´ 4",backText:"ì´ ì¹´ë“œê°€ í›„ì—´ì— ìˆëŠ” í„´ì— ìŠ¹ë¦¬í•˜ë©´ ìµœëŒ€ ì²´ë ¥ +3, ì†Œëª¨",front:[{op:"damageEnemy",target:"all",n:4}],back:[],onWinWhileInBack:[{op:"maxHp",n:3}]}]},{id:"hand_blade",name:"ì† ì•ˆì˜ ì¹¼ë‚ ",rarity:"RARE",frontText:"ì§€ì • í”¼í•´ 4, ì†íŒ¨ 1ì¥ ë‹¹ í”¼í•´ +2",backText:"ì†íŒ¨ 1ì¥ë‹¹ ë°©ì–´ +1 (ìµœëŒ€ 6)",front:[{op:"damageEnemyFormula",target:"select",kind:"hand_blade"}],back:[{op:"blockFormula",kind:"hand_blade_back"}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 6, ì†íŒ¨ 1ì¥ ë‹¹ í”¼í•´ +2",backText:"ì†íŒ¨ 1ì¥ë‹¹ ë°©ì–´ +2",front:[{op:"damageEnemyFormula",target:"select",kind:"hand_blade_u1"}],back:[{op:"blockFormula",kind:"hand_blade_back_u1"}]}]},{id:"install_makeshift_wall",name:"ê°„ì´ ë°©ë²½",rarity:"RARE",tags:["INSTALL"],installWhen:"BOTH",passives:[{kind:"retainBlockBetweenTurns",side:"front"}],frontText:"í„´ì´ ëë‚  ë•Œ ë°©ì–´ê°€ ì‚¬ë¼ì§€ì§€ ì•ŠìŒ (ì„¤ì¹˜)",backText:"S +1 (ì„¤ì¹˜)",front:[],back:[{op:"supplies",n:1}],upgrades:[{frontText:"í„´ì´ ëë‚  ë•Œ ë°©ì–´ê°€ ì‚¬ë¼ì§€ì§€ ì•ŠìŒ, ë°©ì–´ +2 (ì„¤ì¹˜)",backText:"S +1, ë°©ì–´ +2 (ì„¤ì¹˜)",front:[{op:"block",n:2}],back:[{op:"supplies",n:1},{op:"block",n:2}]}]},{id:"cut_second",name:"ì¤‘ì—´ ì ˆë‹¨",rarity:"RARE",exhaustWhen:"BOTH",frontText:"2ë²ˆ ì ì˜ í˜„ì¬ HPë¥¼ ì ˆë°˜ìœ¼ë¡œ, ì†Œëª¨",backText:"2ë²ˆ ì ì˜ í˜„ì¬ HPë¥¼ ì ˆë°˜ìœ¼ë¡œ, F +1, ì†Œëª¨",front:[{op:"halveEnemyHpAtIndex",index:1}],back:[{op:"fatigue",n:1},{op:"halveEnemyHpAtIndex",index:1}],upgrades:[{frontText:"2ë²ˆ ì ì˜ í˜„ì¬ HPë¥¼ ì ˆë°˜ìœ¼ë¡œ, S +2, ì†Œëª¨",backText:"2ë²ˆ ì ì˜ í˜„ì¬ HPë¥¼ ì ˆë°˜ìœ¼ë¡œ, ì†Œëª¨",front:[{op:"halveEnemyHpAtIndex",index:1},{op:"supplies",n:2}],back:[{op:"halveEnemyHpAtIndex",index:1}]}]},{id:"install_scriptorium",name:"í•ë¹› í•„ì‚¬ëŒ€",rarity:"RARE",tags:["INSTALL"],installWhen:"BOTH",frontText:"ë°©ì–´ +1 (ì„¤ì¹˜)",backText:"ë‹¬ë¹› ë‘ë£¨ë§ˆë¦¬ 1ì¥ ìƒì„±, S -1 (ì„¤ì¹˜)",front:[{op:"block",n:1}],back:[{op:"supplies",n:-1},{op:"addCardToHand",defId:"token_moon_scroll",n:1}],upgrades:[{frontText:"ë°©ì–´ +2 (ì„¤ì¹˜)",backText:"ë‹¬ë¹› ë‘ë£¨ë§ˆë¦¬ 2ì¥ ìƒì„±, S -1 (ì„¤ì¹˜)",front:[{op:"block",n:2}],back:[{op:"supplies",n:-1},{op:"addCardToHand",defId:"token_moon_scroll",n:2}]}]},{id:"coin_toss",name:"ë™ì „ ë˜ì§€ê¸°",rarity:"RARE",frontText:"í›„ì—´ì´ë©´ ì „ì²´ í”¼í•´ 20, ì´ ì¹´ë“œë¥¼ ë’¤ì§‘ìŒ",backText:"ì´ ì¹´ë“œë¥¼ ë’¤ì§‘ìŒ",front:[sn([{op:"damageEnemy",target:"all",n:20}]),{op:"flipSelf"}],back:[{op:"flipSelf"}],upgrades:[{frontText:"í›„ì—´ì´ë©´ ì „ì²´ í”¼í•´ 25, ì´ ì¹´ë“œë¥¼ ë’¤ì§‘ìŒ",backText:"ì´ ì¹´ë“œë¥¼ ë’¤ì§‘ìŒ",front:[sn([{op:"damageEnemy",target:"all",n:25}]),{op:"flipSelf"}],back:[{op:"flipSelf"}]}]},{id:"unforgettable_memory",name:"ë°•ì œëœ ê¸°ì–µ",rarity:"RARE",frontText:"ë¬´ì‘ìœ„ ì†Œì‹¤ëœ ì¹´ë“œì˜ ì „ì—´ íš¨ê³¼ ë°œë™, 2ë²ˆ ë°˜ë³µ",backText:"ë¬´ì‘ìœ„ ì†Œì‹¤ëœ ì¹´ë“œì˜ í›„ì—´ íš¨ê³¼ ë°œë™, 2ë²ˆ ë°˜ë³µ",front:[{op:"triggerRandomVanished",side:"front",times:2}],back:[{op:"triggerRandomVanished",side:"back",times:2}],upgrades:[{frontText:"ë¬´ì‘ìœ„ ì†Œì‹¤ëœ ì¹´ë“œì˜ ì „ì—´ íš¨ê³¼ ë°œë™, 3ë²ˆ ë°˜ë³µ",backText:"ë¬´ì‘ìœ„ ì†Œì‹¤ëœ ì¹´ë“œì˜ í›„ì—´ íš¨ê³¼ ë°œë™, 3ë²ˆ ë°˜ë³µ",front:[{op:"triggerRandomVanished",side:"front",times:3}],back:[{op:"triggerRandomVanished",side:"back",times:3}]}]},{id:"goal_treasure",name:"ì €ì£¼ë°›ì€ ë³´ë¬¼",rarity:"MADNESS",exhaustWhen:"BOTH",frontText:"F +1, ì†Œëª¨",backText:"S -1, F +1, ì†Œëª¨",front:[{op:"fatigue",n:1}],back:[{op:"supplies",n:-1},{op:"fatigue",n:1}]},{id:"mad_echo",name:"ë©”ì•„ë¦¬",rarity:"MADNESS",frontText:"ë¬´ì‘ìœ„ í”¼í•´ (Fì˜ ì ˆë°˜ (ë²„ë¦¼))",backText:"ë“œë¡œìš° 1, S +2, F +1",front:[{op:"damageEnemyByPlayerFatigue",target:"random",mult:.5}],back:[{op:"draw",n:1},{op:"supplies",n:2},{op:"fatigue",n:1}],upgrades:[{frontText:"ë¬´ì‘ìœ„ í”¼í•´ (F)",front:[{op:"damageEnemyByPlayerFatigue",target:"random",mult:1}],backText:"ë“œë¡œìš° 2, S +2, F +1",back:[{op:"draw",n:2},{op:"supplies",n:2},{op:"fatigue",n:1}]}]},{id:"mad_insight",name:"ê¸ˆë‹¨ì˜ í†µì°°",rarity:"MADNESS",exhaustWhen:"BOTH",frontText:"ë°©ì–´ +8, ë“œë¡œìš° 1, F +1, ì†Œëª¨",backText:"ë“œë¡œìš° 3, S +2, F +2, ì†Œëª¨",front:[{op:"block",n:8},{op:"draw",n:1},{op:"fatigue",n:1}],back:[{op:"draw",n:3},{op:"supplies",n:2},{op:"fatigue",n:2}],upgrades:[{frontText:"ë°©ì–´ +10, ë“œë¡œìš° 2, F +1, ì†Œëª¨",front:[{op:"block",n:10},{op:"draw",n:2},{op:"fatigue",n:1}],backText:"ë“œë¡œìš° 4, S +3, F +2, ì†Œëª¨",back:[{op:"draw",n:4},{op:"supplies",n:3},{op:"fatigue",n:2}]}]},{id:"mad_bargain",name:"ê±°ë˜ì˜ ì”ì¬",rarity:"MADNESS",exhaustWhen:"BOTH",frontText:"ì§€ì • í”¼í•´ 16, S -1, F +1, ì†Œëª¨",backText:"HP +6, F +2, ì†Œëª¨",front:[{op:"damageEnemy",target:"select",n:16},{op:"supplies",n:-1},{op:"fatigue",n:1}],back:[{op:"heal",n:6},{op:"fatigue",n:2}],upgrades:[{frontText:"ì§€ì • í”¼í•´ 22, S -1, F +2, ì†Œëª¨",front:[{op:"damageEnemy",target:"select",n:22},{op:"supplies",n:-1},{op:"fatigue",n:2}],backText:"HP +9, F +2, ì†Œëª¨",back:[{op:"heal",n:9},{op:"fatigue",n:2}]}]},{id:"mad_no_impossible",name:"ë¶ˆê°€ëŠ¥ì€ ì—†ë‹¤",rarity:"MADNESS",frontText:"ë‚´ ë±ì˜ ëª¨ë“  ì¹´ë“œë¥¼ ë’¤ì§‘ìŒ, ì „íˆ¬ê°€ ëë‚  ë•Œ ì›ë˜ëŒ€ë¡œ ëŒì•„ì˜´, S -5",backText:"ì†Œì‹¤ ì¹´ë“œ í•œ ì¥ì„ ì„ íƒí•˜ì—¬ ê°€ì ¸ì˜´, ì†Œì‹¤",tags:["VANISH"],vanishWhen:"BACK",front:[{op:"flipAllPlayerCardsUntilCombatEnd"},{op:"supplies",n:-5}],back:[{op:"pickVanishedToHand"}]},{id:"mad_bed_of_thorns",name:"ê°€ì‹œë°©ì„",rarity:"MADNESS",tags:["INSTALL"],installWhen:"BOTH",frontText:"ìì‹ ì„ ê³µê²©í•˜ë ¤ëŠ” ì ì—ê²Œ ì¶œí˜ˆ +5 (ì„¤ì¹˜)",backText:"í”Œë ˆì´ì–´ ë° ì „ì²´ ì·¨ì•½ +1 (ì„¤ì¹˜)",front:[{op:"statusEnemiesAttackingThisTurn",key:"bleed",n:5}],back:[{op:"statusPlayer",key:"vuln",n:1},{op:"statusEnemy",target:"all",key:"vuln",n:1}],upgrades:[{frontText:"ìì‹ ì„ ê³µê²©í•˜ë ¤ëŠ” ì ì—ê²Œ ì¶œí˜ˆ +6 (ì„¤ì¹˜)",backText:"í”Œë ˆì´ì–´ ë° ì „ì²´ ì·¨ì•½ +2 (ì„¤ì¹˜)",front:[{op:"statusEnemiesAttackingThisTurn",key:"bleed",n:6}],back:[{op:"statusPlayer",key:"vuln",n:2},{op:"statusEnemy",target:"all",key:"vuln",n:2}]}]}],Oo=Object.fromEntries(ls.map(e=>[e.id,e])),cs=[{id:"other_adventurer",name:"ë³´ë¬¼ì„ ë…¸ë¦¬ëŠ” ë‹¤ë¥¸ ëª¨í—˜ê°€",maxHp:60,intentRules:{noRepeatIntentIndexes:[1]},intents:[{label:"ì°½ ì°Œë¥´ê¸°: 5 í”¼í•´, 3ë²ˆ ë°œë™",acts:[{op:"damagePlayer",n:5},{op:"damagePlayer",n:5},{op:"damagePlayer",n:5}]},{label:"ë…ì•½ ë¿Œë¦¬ê¸°: ì¶œí˜ˆ +4, ì·¨ì•½ +4, ì•½í™” +4",acts:[{op:"statusPlayer",key:"bleed",n:4},{op:"statusPlayer",key:"vuln",n:4},{op:"statusPlayer",key:"weak",n:4}]}]},{id:"goblin_raider",name:"ê³ ë¸”ë¦° ì•½íƒˆì",maxHp:15,intents:[{label:"ê¸°ìŠµ: 12 - ì´ë²ˆ í„´ì— ì‚¬ìš©í•œ ì¹´ë“œì˜ ìˆ˜ë§Œí¼ í”¼í•´",acts:[{op:"damagePlayerFormula",kind:"goblin_raider"}]},{label:"í›”ì¹˜ê¸°: ì¶œí˜ˆ +2, S -3",acts:[{op:"supplies",n:-3},{op:"statusPlayer",key:"bleed",n:2}]}]},{id:"watching_statue",name:"ê°ì‹œí•˜ëŠ” ì„ìƒ",maxHp:25,passives:[{id:"ramp_atk_1",icon:"ğŸ‘ï¸",name:"ëª°ë¦¬ëŠ” ì‹œì„ ",text:"ë§¤ í„´ ê³µê²©ë ¥ì´ +1 ì¦ê°€í•©ë‹ˆë‹¤."}],intents:[{label:"ê°ì‹œ: 4 + ì´ë²ˆ í„´ì— ì‚¬ìš©í•œ ì¹´ë“œì˜ ìˆ˜ë§Œí¼ í”¼í•´",acts:[{op:"damagePlayerFormula",kind:"watching_statue"}]}]},{id:"pebble_golem",name:"ì¡°ì•½ëŒ ê³¨ë ˜",maxHp:30,intentRules:{noRepeatIntentIndexes:[1]},passives:[{id:"ramp_atk_1",icon:"ğŸª¨",name:"ê²½í™”",text:"ë§¤ í„´ ê³µê²©ë ¥ì´ +1 ì¦ê°€í•©ë‹ˆë‹¤."}],intents:[{label:"ì¡°ì•½ëŒ ë˜ì§€ê¸°: 8 í”¼í•´",acts:[{op:"damagePlayer",n:8}]},{label:"ëª¨ë˜ ëª¨ìœ¼ê¸°: HP 6 íšŒë³µ",acts:[{op:"enemyHealSelf",n:6}]}]},{id:"rock_golem",name:"ë°”ìœ„ ê³¨ë ˜",maxHp:50,intentRules:{noRepeatIntentIndexes:[1]},passives:[{id:"ramp_atk_2",icon:"â›°ï¸",name:"ê±°ëŒ€í™”",text:"ë§¤ í„´ ê³µê²©ë ¥ì´ +2 ì¦ê°€í•©ë‹ˆë‹¤."}],intents:[{label:"ë°”ìœ„ ë˜ì§€ê¸°: 10 í”¼í•´",acts:[{op:"damagePlayer",n:10}]},{label:"ë•… ëª¨ìœ¼ê¸°: HP 8 íšŒë³µ",acts:[{op:"enemyHealSelf",n:8}]}]},{id:"slime",name:"ìŠ¬ë¼ì„",maxHp:30,intentRules:{noRepeatIntentIndexes:[0,1]},intents:[{label:"ì‚°ì„±ì•¡: ì¶œí˜ˆ +3",acts:[{op:"statusPlayer",key:"bleed",n:3}]},{label:"ì ì•¡: ì•½í™” +3, HP 3 íšŒë³µ",acts:[{op:"statusPlayer",key:"weak",n:3},{op:"enemyHealSelf",n:3}]},{label:"ë•Œë¦¬ê¸°: 6 í”¼í•´",acts:[{op:"damagePlayer",n:6}]}]},{id:"poison_spider",name:"ë…ê±°ë¯¸",maxHp:28,intentRules:{noRepeatIntentIndexes:[0,2]},intents:[{label:"ë…ë‹ˆë¡œ ë¬¼ê¸°: ì¶œí˜ˆ +4",acts:[{op:"statusPlayer",key:"bleed",n:4}]},{label:"ì†¡ê³³ë‹ˆë¡œ ë¬¼ê¸°: 7 í”¼í•´",acts:[{op:"damagePlayer",n:7}]},{label:"ë‹¨ë²ˆì— ë¬¼ê¸°: ì¶œí˜ˆ +2, 6 í”¼í•´",acts:[{op:"statusPlayer",key:"bleed",n:2},{op:"damagePlayer",n:6}]}]},{id:"gravity_echo",name:"ì¤‘ë ¥ì˜ ì”í–¥",maxHp:35,intents:[{label:"í•˜ì¤‘ ì¸ì¥",acts:[{op:"damagePlayerByDeckSize",base:5,per:2,div:6,cap:18}]},{label:"ì••ì¶•: 7 í”¼í•´",acts:[{op:"damagePlayer",n:7}]},{label:"ë†“ì¹˜ê²Œ ë§Œë“¤ê¸°: S -3",acts:[{op:"supplies",n:-3}]}]},{id:"rat_swarm",name:"ì¥ë–¼",maxHp:20,intents:[{label:"ëœ¯ê¸°: 4 í”¼í•´, 2ë²ˆ ë°œë™",acts:[{op:"damagePlayer",n:4},{op:"damagePlayer",n:4}]},{label:"ê¸°ìŠµí•˜ê¸°: ì·¨ì•½ +2",acts:[{op:"statusPlayer",key:"vuln",n:2}]},{label:"ê´‘ë€: 2 í”¼í•´ (íƒ€ìˆ˜ê°€ ì¦ê°€í•©ë‹ˆë‹¤!) ",acts:[{op:"damagePlayerRampHits",n:2,baseHits:1,everyTurns:1,capHits:6}]}]},{id:"goblin_commander",name:"ê³ ë¸”ë¦° ì§€íœ˜ê´€",maxHp:30,intents:[{label:"í˜¸ë ¹: ì·¨ì•½ +2",acts:[{op:"statusPlayer",key:"vuln",n:2}]},{label:"ë°œë¡œ ì°¨ê¸°: 7 í”¼í•´",acts:[{op:"damagePlayer",n:7}]},{label:"ì „ìˆ  ì§€ì‹œ: ì•½í™” +2",acts:[{op:"statusPlayer",key:"weak",n:2}]}]},{id:"goblin_archer",name:"ê³ ë¸”ë¦° ê¶ìˆ˜",maxHp:15,intents:[{label:"ì¡°ì¤€: 2 í”¼í•´, 3ë²ˆ",acts:[{op:"damagePlayer",n:2},{op:"damagePlayer",n:2},{op:"damagePlayer",n:2}]},{label:"ì—°ì‚¬: 1 í”¼í•´ (íƒ€ìˆ˜ê°€ ì¦ê°€í•©ë‹ˆë‹¤!)",acts:[{op:"damagePlayerRampHits",n:1,baseHits:1,everyTurns:1,capHits:10}]}]},{id:"goblin_assassin",name:"ê³ ë¸”ë¦° ì•”ì‚´ì",maxHp:22,targeting:{forbidTargetedAttackWhenNotLeftmost:!0},passives:[{id:"shadow_veil",icon:"ğŸ‘¥",name:"ê·¸ë¦¼ì ì¥ë§‰",text:"ì™¼ìª½ì— ì ì´ ìˆì„ ë•Œ, ì§€ì • ê³µê²©ìœ¼ë¡œ ë•Œë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."}],intents:[{label:"ì¡°ì¤€: ì•”ì‚´ ìˆ˜ì¹˜ +1",acts:[{op:"enemySetAssassinAim",n:1}]},{label:"ì•”ì‚´: 8 + ì•”ì‚´ ìˆ˜ì¹˜Ã—4 í”¼í•´",acts:[{op:"damagePlayerFormula",kind:"goblin_assassin"}]},{label:"ì¬ì •ë¹„: HP 5 íšŒë³µ",acts:[{op:"enemyHealSelf",n:5}]}]},{id:"old_monster_corpse",name:"ì˜¤ë˜ëœ ê´´ë¬¼ ì‚¬ì²´",maxHp:30,passives:[{id:"rotten_rage",icon:"â˜ ï¸",name:"ì©ì–´ë²„ë¦° ë¶„ë…¸",text:"ë‹¤ë¥¸ ì ì´ ì£½ì„ ë•Œë§ˆë‹¤ ë¶„ë…¸ +1 (ë¶„ë…¸ë‹¹ ê³µê²© +4)."}],intents:[{label:"íˆ¬ì²™: 9 + ë¶„ë…¸Ã—4 í”¼í•´",acts:[{op:"damagePlayerFormula",kind:"old_monster_corpse"}]},{label:"ì§ˆì²™ì„: HP 6 íšŒë³µ",acts:[{op:"enemyHealSelf",n:6}]}]},{id:"punishing_one",name:"ì§•ë²Œí•˜ëŠ” ì",maxHp:60,passives:[{id:"punish_hand",icon:"âš–ï¸",name:"ì§•ë²Œ",text:"í”Œë ˆì´ì–´ ì†íŒ¨ 1ì¥ë‹¹ ê³µê²© í”¼í•´ +2."}],intents:[{label:"ì‹¬íŒ: 6 + ì†íŒ¨Ã—2 í”¼í•´",acts:[{op:"damagePlayerFormula",kind:"punishing_one"}]},{label:"ì¶”ê¶: ì•½í™” +2",acts:[{op:"statusPlayer",key:"weak",n:2}]}]},{id:"gloved_hunter",name:"ì¥ê°‘ ë‚€ ì‚¬ëƒ¥ê¾¼",maxHp:52,intents:[{label:"ê°€ëŠ : ì·¨ì•½ +3",acts:[{op:"statusPlayer",key:"vuln",n:3}]},{label:"ì‚¬ëƒ¥: 6 í”¼í•´, ë°©ì–´ê°€ 4 ì´ìƒì´ë©´ ëŒ€ì‹  12 í”¼í•´",acts:[{op:"damagePlayerFormula",kind:"gloved_hunter"}]},{label:"ì‚¬ì‚´: 10 í”¼í•´",acts:[{op:"damagePlayer",n:10}]}]},{id:"debt_collector",name:"ì¥ë¶€ ìˆ˜ê¸ˆê´€",maxHp:55,intents:[{label:"ìˆ˜ê¸ˆ: S -3",acts:[{op:"supplies",n:-3}]},{label:"ì••ë¥˜: (Sê°€ 0ì´ë©´) 15 í”¼í•´",acts:[{op:"damagePlayerIfSuppliesZero",n:15}]},{label:"ì¬ì ê²€: ì•„ë¬´ í–‰ë™ë„ í•˜ì§€ ì•ŠìŒ",acts:[]}]},{id:"supply_hound",name:"ë³´ê¸‰ ì‚¬ëƒ¥ê°œ",maxHp:26,intents:[{label:"ëƒ„ìƒˆ ë§¡ê¸°: ì·¨ì•½ +2",acts:[{op:"statusPlayer",key:"vuln",n:2}]},{label:"ë®ì¹˜ê¸°: (Sê°€ 0ì´ ì•„ë‹ˆë©´) 7 í”¼í•´",acts:[{op:"damagePlayerIfSuppliesPositive",n:7}]},{label:"ëœ¯ì–´ë‚´ê¸°: S -2",acts:[{op:"supplies",n:-2}]}]},{id:"archive_censor",name:"ì„œê³ ì˜ ê²€ì—´ê´€",maxHp:34,intents:[{label:"ê²€ì—´ ì£¼ë¬¸: êµë€ +2",acts:[{op:"statusPlayer",key:"disrupt",n:2}]},{label:"ì••ìˆ˜: S -2",acts:[{op:"supplies",n:-2}]},{label:"ê¹ƒíœ ì°Œë¥´ê¸°: 7 í”¼í•´, ì•½í™” +2",acts:[{op:"damagePlayer",n:7},{op:"statusPlayer",key:"weak",n:2}]}]},{id:"living_chain",name:"ì‚´ì•„ìˆëŠ” ì‚¬ìŠ¬",maxHp:42,passives:[{id:"bind_front_mid",icon:"â›“ï¸",name:"ê½ê½ ë¬¶ê¸°",text:"ì´ ì ì´ ì‚´ì•„ìˆëŠ” ë™ì•ˆ, ì „ì—´ 2ë²ˆ ì¹¸ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."}],intents:[{label:"íœ˜ë‘ë¥´ê¸°: 12 í”¼í•´",acts:[{op:"damagePlayer",n:12}]},{label:"ì²´í¬: ìƒëŒ€ì˜ í›„ì—´ì´ ì„¸ ì¥ì´ë©´ S -4",acts:[{op:"suppliesIfPlayerBackFull",n:-4}]},{label:"ì‚¬ìŠ¬ ì—®ê¸°: 8 í”¼í•´, HP 5 íšŒë³µ",acts:[{op:"damagePlayer",n:8},{op:"enemyHealSelf",n:5}]}]},{id:"boss_gravity_master",name:"ì¤‘ë ¥ í†µë‹¬ì",omen:"ëª¸ì´ ì ì  ë¬´ê²ë‹¤. ì§ì„ ë¹„ì›Œë¼.",maxHp:90,isBoss:!0,intents:[{label:"ì¤‘ë ¥ ìˆ˜ì¶•: ì•½í™” +3",acts:[{op:"statusPlayer",key:"weak",n:3}]},{label:"íŠ¹ì´ì  ìƒì„±",acts:[{op:"damagePlayerByDeckSize",base:8,per:3,div:5,cap:30}]},{label:"ì²œì¥ ë¶•ê´´: 11 í”¼í•´",acts:[{op:"damagePlayer",n:11}]}]},{id:"boss_cursed_wall",name:"ì €ì£¼ë°›ì€ ë²½",omen:"ì›€ì§ì´ì§€ ì•ŠëŠ”ë‹¤. ë‹³ì•„ê°„ë‹¤.",maxHp:160,isBoss:!0,intentRules:{noRepeatIntentIndexes:[0]},intents:[{label:"ì €ì£¼ì˜ ê¸°ìš´: ì¶œí˜ˆ +3",acts:[{op:"statusPlayer",key:"bleed",n:3}]},{label:"ì €ì£¼ì˜ ê¸°ìš´: F +1",acts:[{op:"fatiguePlayer",n:1}]},{label:"ì•„ë¬´ í–‰ë™ë„ í•˜ì§€ ì•ŠìŒ",acts:[]}]},{id:"boss_giant_orc",name:"ê±°ëŒ€í•œ ì˜¤í¬",omen:"ê±°ëŒ€í•œ ì§ìŠ¹ì´ ê¸°ë‹¤ë¦°ë‹¤. í˜ì„ ê¹ì•„ì•¼ í•œë‹¤.",maxHp:90,isBoss:!0,intentRules:{noRepeatIntentIndexes:[1]},intents:[{label:"ë‚´ë ¤ì¹˜ê¸°: ì·¨ì•½ +2, 10 í”¼í•´",acts:[{op:"statusPlayer",key:"vuln",n:2},{op:"damagePlayer",n:15}]},{label:"ë‹¨ë‹¨í•œ í”¼ë¶€: ë‹¤ìŒ í„´ ë™ì•ˆ í”¼í•´ë¥¼ ì…ì§€ ì•ŠìŒ",acts:[{op:"enemyImmuneNextTurn"}]},{label:"íƒ€ê³ ë‚œ íšŒë³µ: ìì‹  HP 15 íšŒë³µ",acts:[{op:"enemyHealSelf",n:15}]},{label:"ê´‘ë¶„: 4 í”¼í•´ (íƒ€ìˆ˜ê°€ ì¦ê°€í•©ë‹ˆë‹¤!)",acts:[{op:"damagePlayerRampHits",n:4,baseHits:1,everyTurns:1,capHits:6}],meta:{cat:"ATTACK"}}]},{id:"boss_soul_stealer",name:"ì˜í˜¼ ê°•íƒˆì",omen:"í–‰ë™í•˜ì§€ ì•Šìœ¼ë©´ ì¢…ë§ì´ ì˜¨ë‹¤.",maxHp:80,isBoss:!0,passives:[{id:"soul_apocalypse",icon:"â˜„ï¸",name:"ì˜ˆì–¸ëœ ì¢…ë§",text:"ì˜ˆì–¸ì´ 3íšŒ ëˆ„ì ë˜ë©´ í­ë°œ ê°€ëŠ¥ ìƒíƒœê°€ ë©ë‹ˆë‹¤. í­ë°œí•˜ë©´ 50 í”¼í•´ë¥¼ ì¤ë‹ˆë‹¤."}],special:{kind:"SOUL_STEALER",warnIntentIndex:2,warnCap:3,nukeChance:.6,nukeDamage:50,nukeLabel:"ì¢…ë§: 50 í”¼í•´"},intents:[{label:"í—ˆê¸°: 7 í”¼í•´, S -3",acts:[{op:"damagePlayer",n:7},{op:"supplies",n:-3}]},{label:"ë‚˜íƒœ: 7 í”¼í•´, F +2",acts:[{op:"damagePlayer",n:7},{op:"fatiguePlayer",n:2}]},{label:"ì˜ˆì–¸: ì¹´ìš´íŠ¸ ì§„í–‰",acts:[]}]}],ds=Object.fromEntries(cs.map(e=>[e.id,e])),Gt=[{id:"item_balm",name:"ì•½ì´ˆ ì—°ê³ ",text:"HP 8 íšŒë³µ. (ì†Œëª¨)",art:"assets/items/item_balm.png",effects:[{op:"heal",n:8}],priceGold:16,consumable:!0},{id:"item_talisman",name:"ë‹¨ë‹¨í•œ ë¶€ì ",text:"ğŸ›¡ï¸ ë°©ì–´ 10 íšë“. (ì†Œëª¨)",art:"assets/items/item_talisman.png",effects:[{op:"block",n:10}],priceGold:18,consumable:!0},{id:"item_dust",name:"ì €ì£¼ ê°€ë£¨",text:"ëª¨ë“  ì ì—ê²Œ ì·¨ì•½ 2 ë¶€ì—¬. (ì†Œëª¨)",art:"assets/items/item_dust.png",effects:[{op:"statusEnemy",target:"all",key:"vuln",n:2}],priceGold:22,consumable:!0},{id:"item_moon_scroll",name:"ë‹¬ë¹› ë‘ë£¨ë§ˆë¦¬",text:"ë‹¬ë¹› ë‘ë£¨ë§ˆë¦¬ 1ì¥ì„ ì†íŒ¨ì— ì¶”ê°€. (ì†Œëª¨)",art:"assets/items/item_moon_scroll.png",effects:[{op:"addCardToHand",defId:"token_moon_scroll",n:1}],priceGold:18,consumable:!0},{id:"item_triple_swap",name:"êµí™˜ê¶Œ",text:"ì†íŒ¨ì—ì„œ ë¬´ì‘ìœ„ ì„¸ ì¥ì„ ë²„ë¦¼, ë²„ë¦° ë§Œí¼ ğŸƒ ë“œë¡œìš°. (ì†Œëª¨)",art:"assets/items/item_triple_swap.png",effects:[{op:"discardHandRandomDraw",n:3}],priceGold:20,consumable:!0},{id:"item_stanch_cloth",name:"ì§€í˜ˆ ì²œ",text:"ì¶œí˜ˆì„ 0ìœ¼ë¡œ ì„¤ì •. (ì†Œëª¨)",art:"assets/items/item_stanch_cloth.png",effects:[{op:"clearStatusSelf",key:"bleed"}],priceGold:17,consumable:!0},{id:"item_supply_sack",name:"ë³´ê¸‰ ìë£¨",text:"ğŸ Së¥¼ 5ë¡œ ì„¤ì •. (ì†Œëª¨)",art:"assets/items/item_supply_sack.png",effects:[{op:"setSupplies",n:5}],priceGold:19,consumable:!0},{id:"item_clear_incense",name:"ë§‘ì€ í–¥ë¡œ",text:"êµë€ì„ 0ìœ¼ë¡œ ì„¤ì •. (ì†Œëª¨)",art:"assets/items/item_clear_incense.png",effects:[{op:"clearStatusSelf",key:"disrupt"}],priceGold:17,consumable:!0},{id:"item_throwing_spike",name:"íˆ¬ì²™ìš© ê°€ì‹œ",text:"ëª¨ë“  ì ì—ê²Œ ì¶œí˜ˆ 3 ë¶€ì—¬. (ì†Œëª¨)",art:"assets/items/item_throwing_spike.png",effects:[{op:"statusEnemy",target:"all",key:"bleed",n:3}],priceGold:23,consumable:!0}],Do=Object.fromEntries(Gt.map(e=>[e.id,e]));function We(e){return Do[e]??null}function us(){return Gt.length===0?null:Gt[Math.floor(Math.random()*Gt.length)]?.id??null}function ps(e,t){const n=e.frontSlots.indexOf(t);if(n>=0)return{side:"front",index:n};const r=e.backSlots.indexOf(t);return r>=0?{side:"back",index:r}:null}function q(e,t,n,r=1600){e.uiToasts??=[],e.uiToasts.push({kind:t,text:n,ms:r}),e.uiToasts.length>30&&(e.uiToasts=e.uiToasts.slice(-30))}function Se(e,t,n,r,o="SYSTEM"){let a=n;if(r&&o==="PLAYER"&&t==="bleed"){const s=Number(r._bleedBonusPerApply??0);s&&(a+=s)}r&&t==="vuln"&&a>0&&e===r.player&&(r.run.relics??[]).includes("relic_ratskin_charm")&&r.run.relicRuntime?.relic_ratskin_charm?.active!==!1&&(a=Math.max(0,a-1)),e.status[t]=Math.max(0,(e.status[t]??0)+a)}function Xt(e,t=0){return e<t?t:e}function Sr(e){const t=[...e];for(let n=t.length-1;n>0;n--){const r=Math.floor(Math.random()*(n+1));[t[n],t[r]]=[t[r],t[n]]}return t}function me(e,t="pickOne"){if(e.length===0)throw new Error(`${t}: empty array`);return e[Math.floor(Math.random()*e.length)]}function f(e,t){const n=String(e._logSourceCardUid??"");if(n){const r=e.cards?.[n],o=r?.defId?e.content.cardsById?.[r.defId]?.name:null,a=Number(r?.upgrade??0)||0;t=`[ì›ì¸:${o?a>0?`${o} +${a}`:o:n}] ${t}`}e.log.push(t),e.log.length>250&&(e.log=e.log.slice(-250))}function le(e){return e.enemies.filter(t=>t.hp>0)}function fs(e){return Math.max(0,Math.min(1,e))}function Ho(e,t=0){const n=e.player?.fatigue??0,r=fs(t+Math.max(0,n-5)*.12),o=n<=5?0:n<=8?1:n<=11?2:3;return{f:n,p:r,tier:o}}function qt(e,t){if(t<=0)return;let n=t;try{const o=e.run?.faith,a=String(o?.focus??""),s=!!o?.hostile?.[a],i=Number(o?.points?.[a]??0)||0;(a&&a!=="madness"&&!s&&i>=3?a:null)==="rabbit_hunt"&&(n=Math.floor(n*.9),n>0&&!e._rabbitHuntBlockToastShownThisCombat&&(e._rabbitHuntBlockToastShownThisCombat=!0,q(e,"WARN","ê°€ë²¼ìš´ ë°©íŒ¨ëŠ” ì˜ ë¶€ëŸ¬ì§‘ë‹ˆë‹¤.",1600),f(e,"í† ë¼ ì‚¬ëƒ¥: ë°©ì–´ íšë“ëŸ‰ -10% (ë‚´ë¦¼)")))}catch{}n<=0||(e.player.block+=n,e._gainedBlockThisTurn=!0,f(e,`ë°©ì–´(ë¸”ë¡) +${n} (í˜„ì¬ ${e.player.block})`))}function nn(e,t,n=null){if(e.choiceQueue??=[],!e.choice){e.choice=t,e.choiceCtx=n;return}e.choiceQueue.push({choice:t,ctx:n})}function Be(e,t,n=null){e.choiceQueue=[],e.choice=t,e.choiceCtx=n}function Fo(e){e.choice=null,e.choiceCtx=null}function de(e){e.choiceQueue=[],Fo(e),e.phase==="NODE"&&fe(e)}function Oe(e){const t=e.choiceQueue??[];if(t.length>0){const n=t.shift()??null;if(n){e.choice=n.choice,e.choiceCtx=n.ctx,e.choiceQueue=t;return}}Fo(e),e.phase==="NODE"&&fe(e)}const _e=e=>Math.max(0,Number(e.numBonus??0)||0);function bn(e){const t=e.game,n=e.cardUid??"";if((Number(t.usedThisTurn??0)||0)!==1)return!1;const o=(t.placedUidsThisTurn??[]).filter(Boolean);return o.length!==1?!1:o[0]===n}const Wo={prey_mark:{base:e=>10+_e(e),forTarget:(e,t,n)=>t.hp>e.game.player.hp?n+5+_e(e):n},prey_mark_u1:{base:e=>12+_e(e),forTarget:(e,t,n)=>t.hp>e.game.player.hp?n+6+_e(e):n},triple_bounty:{base:e=>10+_e(e),forTarget:(e,t,n,r)=>r>=3+_e(e)?n+6+_e(e):n},triple_bounty_u1:{base:e=>10+_e(e),forTarget:(e,t,n,r)=>r>=3+_e(e)?n+10+_e(e):n},hand_blade:{base:e=>{const t=e.game.hand.length,n=_e(e);return 4+n+(2+n)*Math.floor(t/(1+n))}},hand_blade_u1:{base:e=>{const t=e.game.hand.length,n=_e(e);return 6+n+(2+n)*Math.floor(t/(1+n))}},lone_blow_20:{base:e=>bn(e)?20+_e(e):0},lone_blow_26:{base:e=>bn(e)?26+_e(e):0},castle_ballista_age:{base:e=>{const t=e.cardUid??"",n=(e.game.installAgeByUid?.[t]??0)|0;return 1+_e(e)+Math.max(0,n)}},castle_ballista_age_u1:{base:e=>{const t=e.cardUid??"",n=(e.game.installAgeByUid?.[t]??0)|0;return 2+_e(e)+Math.max(0,n)}}};function hs(e,t){return Wo[t]?.base(e)??0}function rr(e,t,n,r,o){const a=Wo[t];return a&&a.forTarget?a.forTarget(e,n,r,o):r}const ms={hand_blade_back:e=>{const t=e.game,n=_e(e),r=Math.max(0,Number(t.hand?.length??0)||0),o=(1+n)*Math.floor(r/(1+n));return Math.min(6+n,o)},hand_blade_back_u1:e=>{const t=e.game,n=_e(e),r=Math.max(0,Number(t.hand?.length??0)||0);return(2+n)*Math.floor(r/(1+n))},lone_blow_block_10:e=>bn(e)?10+_e(e):0,lone_blow_block_14:e=>bn(e)?14+_e(e):0};function Uo(e,t){return ms[t]?.(e)??0}function bs(e){return lt(e,"relic_wrong_dice")}function ys(e,t){const n=bs(e)?1:0,r=t&&e.cards[t]?.synth?.overrun?1:0;return n+r}function ks(e,t){return t<=0||e===0?e:e+Math.sign(e)*t}function Ts(e,t){return ue(e)!=="rabbit_hunt"?t:t.replace(/(ë°©ì–´|ë¸”ë¡)(\s*)([+-]?\d+)/g,(n,r,o,a)=>{const s=Number(a);if(!Number.isFinite(s))return`${r}${o}${a}`;const i=Math.floor(s*.9);return`${r}${o}${i}`})}function vs(e,t){return ue(e)!=="rabbit_hunt"?t:Math.max(0,Math.floor(t*.9))}function xs(e,t,n,r){if(!n||!e.cards[n])return null;const a=Ce(e,n),i=(t===a.frontText?Array.isArray(a.front)?a.front:[]:t===a.backText?Array.isArray(a.back)?a.back:[]:[]).find(c=>c?.op==="blockFormula");if(!i?.kind)return null;const l=Math.max(0,Number(Uo({game:e,cardUid:n,numBonus:r},i.kind))||0);return vs(e,l)}function je(e,t,n){if(!t)return t;const r=ys(e,n),o=xs(e,t,n,r);let a=t;return r>0&&(a=a.replace(/-?\d+/g,s=>{const i=Number(s);return Number.isFinite(i)?String(ks(i,r)):s})),o!=null?(a=`${a} (í˜„ì¬ ë°©ì–´ +${o})`,a):(a=Ts(e,a),a)}function Ae(e,t,n,r){const o=(()=>{if(!r)return[];const c=e.cards[r]?.synth;if(!c?.done)return[];const d=[];return c?.overrun&&d.push("í­ì£¼"),c?.addTags?.includes("INSTALL")&&d.push("ì„¤ì¹˜"),c?.addTags?.includes("INNATE")&&d.push("ì„ ì²œì„±"),c?.autoFlip&&d.push("ë’¤ì§‘ê¸°"),c?.removeExhaust&&d.push("ì†Œëª¨ ì œê±°"),d})(),a=o.length>0?`(${o.join("/")})`:"",s=je(e,t,r),i=je(e,n,r);return{frontText:a?`${s}
${a}`:s,backText:a?`${i}
${a}`:i}}function tt(e,t,n){const r=n??0,o=r>0?`${t} +${r}`:t;return je(e,o)}function Ge(e,t){const n=e.cards[t];if(!n)return t;const r=e.content.cardsById[n.defId]?.name??n.defId;return tt(e,r,n.upgrade??0)}function Cs(e){if(e.run.treasureObtained)return;e.run.treasureObtained=!0,e.run.afterTreasureNodePicks=0,e.run.deckSizeAtTreasure=oa(e);const t=jo(e);e.cards[t]={uid:t,defId:"goal_treasure",zone:"deck",upgrade:0},e.deck.push(t),e.deck=Sr(e.deck),f(e,"ì €ì£¼ë°›ì€ ë³´ë¬¼ì„ íšë“í–ˆìŠµë‹ˆë‹¤! ë±ì— [ì €ì£¼ë°›ì€ ë³´ë¬¼] ì¶”ê°€. ì´ì œ ì…êµ¬(START)ë¡œ ëŒì•„ê°€ íƒˆì¶œí•˜ì„¸ìš”!"),ws(e),f(e,"ë³´ë¬¼ì´ ìš¸ë¶€ì§–ì, ë˜ì „ì˜ ëª¨ë“  ë°©ì´ ë‹¤ì‹œ ì±„ì›Œì§‘ë‹ˆë‹¤..."),Ds(e),Hs(e)}function ws(e){const t=e.run?.map;if(!t||!t.nodes)return;const n=t.startId,r=t.treasureId,o=Object.keys(t.nodes),a=[];for(const l of o){if(l===n||l===r)continue;const c=t.nodes[l];if(!c)continue;c.cleared=!1,delete c.noRespawn,delete c.lastClearedMove,c.reprocCount=Number(c.reprocCount??0)+1;const d=Number(c.depth??0);if(c.kind==="ELITE"||c.kind==="START"||c.kind==="TREASURE")continue;a.push(l);const h=Math.min(.7,.54+d*.008),m=.2,u=.16,p=Math.random();c.kind=p<h?"BATTLE":p<h+m?"EVENT":p<h+m+u?"REST":"SHOP"}const s=Math.min(2,a.length);let i=a.reduce((l,c)=>l+(t.nodes[c]?.kind==="SHOP"?1:0),0);if(i<s){const l=a.filter(c=>t.nodes[c]?.kind!=="SHOP").sort((c,d)=>Number(t.nodes[c]?.depth??999)-Number(t.nodes[d]?.depth??999));for(const c of l){const d=t.nodes[c];if(d&&(d.kind="SHOP",i+=1,i>=s))break}}}const zo=["arrow","shield","scout","field_ration"],et=[{id:"mad_echo",weight:12},{id:"mad_insight",weight:12},{id:"mad_bargain",weight:12},{id:"mad_no_impossible",weight:3},{id:"mad_bed_of_thorns",weight:3}],ft=[{id:"smoke",weight:0},{id:"redeploy",weight:3},{id:"secret_strike",weight:3},{id:"fire_scroll",weight:3},{id:"emergency_rations",weight:3},{id:"field_experience",weight:3},{id:"install_makeshift_wall",weight:3},{id:"install_scriptorium",weight:3},{id:"cut_second",weight:3},{id:"coin_toss",weight:3},{id:"unforgettable_memory",weight:3},{id:"bandage",weight:12},{id:"caltrops",weight:12},{id:"painkiller",weight:12},{id:"vital_shot",weight:12},{id:"taunt",weight:12},{id:"cloth_scrap_armor",weight:12},{id:"hide_on_floor",weight:12},{id:"prey_mark",weight:12},{id:"hand_blade",weight:12},{id:"lone_blow",weight:12},{id:"install_cursed_banner",weight:12},{id:"install_lead_observation",weight:12},{id:"scribe_hand",weight:12},{id:"innate_march_shield",weight:12},{id:"fuel_kindling",weight:12},{id:"impossible_plan",weight:12},{id:"slash_frenzy",weight:12},{id:"doppelganger",weight:12},{id:"berserk",weight:20},{id:"arrow_rain",weight:20},{id:"camp_prep",weight:20},{id:"rapid_fire",weight:20},{id:"quiet_ambush",weight:20},{id:"blood_contract",weight:20},{id:"brawl_cleaver",weight:20},{id:"gambler_glove",weight:20},{id:"install_ballista",weight:20},{id:"install_iron_bulwark",weight:20},{id:"install_castle_ballista",weight:20},{id:"install_wedge_spike",weight:20},{id:"blood_tribute",weight:20},{id:"heavy_shield",weight:20},{id:"reinforced_bastion",weight:20},{id:"improv_arrow",weight:20},{id:"low_body_temperature",weight:20}];function mt(e,t,n){const r=n?Er(t,n):gr(t);return{defId:yn(r),upgrade:t===et?0:kn(e)}}function ln(e,t,n){const r=n?Er(t,n):gr(t),o=yn(r),a=r.filter(d=>d.id!==o),s=yn(a),i=t===et,l=i?0:kn(e),c=i?0:kn(e);return[{defId:o,upgrade:l},{defId:s,upgrade:c}]}function Ko(e){const{tier:t}=Ho(e);return Math.random()<(t===0?0:t===1?.15:t===2?.35:.6)}function gr(e){const t=new Map;for(const n of e){const r=Math.max(0,n.weight??0);r<=0||t.set(n.id,(t.get(n.id)??0)+r)}return[...t.entries()].map(([n,r])=>({id:n,w:r}))}function Er(e,t={}){const n=t.mult3??1,r=t.mult12??1,o=t.mult20??1,a=new Map;for(const s of e){const i=Math.max(0,s.weight??0);if(i<=0||i===3&&t.drop3||i===12&&t.drop12||i===20&&t.drop20)continue;let l=null;i===3?l=i*n:i===12?l=i*r:i===20?l=i*o:l=i,!(l<=0)&&a.set(s.id,(a.get(s.id)??0)+l)}return[...a.entries()].map(([s,i])=>({id:s,w:i}))}function yn(e){let t=0;for(const r of e)t+=r.w;if(t<=0)throw new Error("No positive weights to pick from.");let n=Math.random()*t;for(const r of e)if(n-=r.w,n<=0)return r.id;return e[e.length-1].id}function kn(e){const t=e?.player?.fatigue??0;if((e?.run.nodePickCount??999)<=6)return 0;const r=.1,o=t>=12?0:t>=9?.25:t>=6?.5:1;return Math.random()<r*o?1:0}function _s(e){const t=e.player?.fatigue??0,n={defId:me(zo),upgrade:0},r=()=>t<=3?ln(e,ft):t<=6?ln(e,ft,{mult3:.25,mult12:.75,mult20:1}):t<=8?ln(e,ft,{mult3:.1,mult12:.55,mult20:1}):ln(e,ft,{drop3:!0,mult12:.45,mult20:1}),o=i=>Ko(e)?mt(e,et):i;if(t<=8){if(t<=6){const[d,h]=r();return[o(d),o(h)]}const i=t===7?.3:.55;if(Math.random()<i){const[d]=r(),h=o(d);return Math.random()<.5?[n,h]:[h,n]}const[l,c]=r();return[o(l),o(c)]}if(t<=11){const i=o(mt(e,ft,{drop3:!0,mult12:.45,mult20:1}));return Math.random()<.5?[n,i]:[i,n]}const a=mt(e,et),s=Math.random()<.65?mt(e,et):n;return Math.random()<.5?[a,s]:[s,a]}function Ss(e,t,n,r){const o=[];let a=r?Er(t,r):gr(t);const s=t===et;for(let i=0;i<n&&!(a.length<=0);i++){const l=yn(a);o.push({defId:l,upgrade:s?0:kn(e)}),a=a.filter(c=>c.id!==l)}return o}function gs(e,t){const n=e.content.cardsById[t]?.rarity;return n==="SPECIAL"||n==="RARE"}function Es(e,t){if(t==="BOSS")return{drop12:!0,drop20:!0};if(t==="ELITE")return{mult3:2.7,mult12:1.8,mult20:.8};const n=Math.max(0,Math.min(10,Number(e.run.rewardPityNonElite??0)||0)),r=1+n*.18,o=1+n*.3,a=Math.max(.65,1-n*.04);return{mult3:o,mult12:r,mult20:a}}function Ns(e,t,n){const r=Math.max(1,Math.min(6,Math.floor(Number(n)||0))),o=e.player?.fatigue??0,a={defId:me(zo),upgrade:0},s=()=>{const d=Es(e,t);return Ss(e,ft,r,d)},i=d=>t==="BOSS"||!Ko(e)?d:mt(e,et);let l=s();for(;l.length<r;)l.push({defId:"arrow",upgrade:0});if(o>=12){const d=[];for(let h=0;h<r;h++)h===r-1?d.push(Math.random()<.55?mt(e,et):a):d.push(mt(e,et));l=d}else if(o>=9){const d=Math.floor(Math.random()*r);l[d]=a,l=l.map(i)}else if(o>=7){const d=o===7?.25:.45;if(Math.random()<d){const h=Math.floor(Math.random()*r);l[h]=a}l=l.map(i)}else l=l.map(i);return l.some(d=>gs(e,d.defId))?e.run.rewardPityNonElite=0:t==="BATTLE"&&(e.run.rewardPityNonElite=(Number(e.run.rewardPityNonElite??0)||0)+1),l.slice(0,r)}function jo(e){return e.uidSeq+=1,`c_${e.uidSeq}`}function Ve(e,t,n){const r=jo(e);e.cards[r]={uid:r,defId:t,zone:"deck",upgrade:n?.upgrade??0},e.deck.push(r)}function Nr(e){const t=Object.values(e.cards).filter(o=>o.zone==="deck"||o.zone==="hand"||o.zone==="discard");if(t.length===0)return;const n=me(t);e.cards[n.uid].zone="vanished",e.vanished.push(n.uid),e.deck=e.deck.filter(o=>o!==n.uid),e.hand=e.hand.filter(o=>o!==n.uid),e.discard=e.discard.filter(o=>o!==n.uid);const r=tt(e,e.content.cardsById[e.cards[n.uid].defId]?.name??e.cards[n.uid].defId,e.cards[n.uid].upgrade??0);f(e,`ì¹´ë“œ ì œê±°: [${r}]`)}const As="goal_treasure";function Qt(e,t){const n=e.cards[t];if(!n)return!1;if(n.defId===As)return f(e,"ì €ì£¼ë°›ì€ ë³´ë¬¼ì€ ë±ì—ì„œ ì œê±°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."),!1;e.deck=e.deck.filter(o=>o!==t),e.hand=e.hand.filter(o=>o!==t),e.discard=e.discard.filter(o=>o!==t),e.frontSlots=e.frontSlots.map(o=>o===t?null:o),e.backSlots=e.backSlots.map(o=>o===t?null:o),n.zone="vanished",e.vanished.push(t);const r=tt(e,e.content.cardsById[e.cards[n.uid].defId]?.name??e.cards[n.uid].defId,e.cards[n.uid].upgrade??0);return f(e,`ì¹´ë“œ ì œê±°: [${r}]`),!0}function rn(e,t){if(In(e))return!1;const n=e.cards[t];if(!n)return!1;const o=e.content.cardsById[n.defId].upgrades?.length??0;return(n.upgrade??0)<o}function Pt(e,t){return rn(e,t)?(e.cards[t].upgrade=(e.cards[t].upgrade??0)+1,!0):!1}const $s=[{id:"dream_shadow",name:"ê¿ˆê·¸ë¦¼ì",art:"assets/gods/dream_shadow.png",patronPlus:"íœ´ì‹-íšŒë³µ: í”¼ë¡œë„ +3 ëŒ€ì‹  í•­ìƒ ìµœëŒ€ ì²´ë ¥ì´ ë¨",patronMinus:"íœ´ì‹-ê°•í™”: í”¼ë¡œë„ë§Œí¼ í”¼í•´",temptation:"ì²´ë ¥ 10 íšŒë³µ, í”¼ë¡œë„ +3",hostile:"íœ´ì‹-íšŒë³µ: íšŒë³µëŸ‰ 0 / íœ´ì‹-ê°•í™”: í”¼ë¡œë„ë§Œí¼ í”¼í•´"},{id:"wing_artery",name:"ë‚ ê°œì˜ ë™ë§¥",art:"assets/gods/wing_artery.png",patronPlus:"ì´ë™: 50% í™•ë¥ ë¡œ ì‹œê°„ì´ íë¥´ì§€ ì•ŠìŒ / ì‹œì‘ S 10",patronMinus:"ì „íˆ¬: 5í„´ë§ˆë‹¤ í”¼ë¡œë„ +1",temptation:"ì‹œê°„ -7, í”¼ë¡œë„ +2",hostile:"ì´ë™ì— ê±¸ë¦¬ëŠ” ì‹œê°„ì´ 1 ëŠ˜ì–´ë‚¨"},{id:"master_spear",name:"ë‹¬ì¸ì˜ ì°½",art:"assets/gods/master_spear.png",patronPlus:"ì „íˆ¬: ì„ ë‘ ì ì—ê²Œ í”¼í•´ë¥¼ ì¤„ ë•Œ í”¼í•´ +25%",patronMinus:"ëŒ€ìƒ ì§€ì •: ì„ ë‘ ì ë§Œ ëŒ€ìƒìœ¼ë¡œ ì§€ì • ê°€ëŠ¥",temptation:"ë‹¤ìŒ ì •ì˜ˆ/ë³´ìŠ¤ ì „íˆ¬ ì‹œì‘: ëª¨ë“  ì  ì·¨ì•½ 3",hostile:"ì •ì˜ˆ/ë³´ìŠ¤ ì „íˆ¬ ì‹œì‘: ìì‹  ì·¨ì•½/ì•½í™”/êµë€ 2"},{id:"retort_fusion",name:"ë ˆí† ë¥´íŠ¸ í“¨ì „",art:"assets/gods/retort_fusion.png",patronPlus:"íœ´ì‹: í•©ì„± ì„ íƒ ê°€ëŠ¥",patronMinus:"íœ´ì‹-í•©ì„±: íš¨ê³¼ë³„ ë¹„ìš© ì§€ë¶ˆ",temptation:"ë‹¤ìŒ íœ´ì‹ì—ì„œ í•©ì„± ì„ íƒ ê°€ëŠ¥",hostile:"ë¬´ì‘ìœ„ 7ì¥ ì†Œëª¨ ë¶€ì—¬ / ì¹´ë“œê°€ ì†Œëª¨ë  ë•Œë§ˆë‹¤ HP -1"},{id:"nameless_vow",name:"ë¬´ëª…ì˜ ì„œì•½",art:"assets/gods/nameless_vow.png",patronPlus:"ë¹š ë¬¸ì„œ 1ì¥ë‹¹ ì²« í„´ ë“œë¡œìš° +1, ë°©ì–´ë„ +3",patronMinus:"ì „íˆ¬ ì¢…ë£Œ: 20% í™•ë¥ ë¡œ ë¹š ë¬¸ì„œ 1ì¥ ì¶”ê°€",temptation:"ë±ì— ë¹š ë¬¸ì„œ 1ì¥ ì¶”ê°€, ë‹¤ìŒ 3ì „íˆ¬ ë“œë¡œìš° +2",hostile:"ë°°êµ: ë¹š ë¬¸ì„œ 2ì¥ ì¶”ê°€ / ì „íˆ¬ ì‹œì‘: ë¹š ë¬¸ì„œ 1ì¥ë‹¹ HP -1"},{id:"bright_darkness",name:"ë°ì€ ì–´ë‘ ",art:"assets/gods/bright_darkness.png",patronPlus:"ì§€ë„: ì´ì›ƒ ë…¸ë“œ ì •ë³´ê°€ ë” ë©€ë¦¬ í‘œì‹œ(ì‹œì•¼ 4)",patronMinus:"ì „íˆ¬ ì‹œì‘: ìì‹  ì·¨ì•½ 1",temptation:"ë‹¤ìŒ 4ê°œ ë…¸ë“œ ë‚´ìš© ì¦‰ì‹œ ê³µê°œ, í”¼ë¡œë„ +1",hostile:"ì§€ë„: ë…¸ë“œ ì •ë³´ê°€ ì „ë¶€ ? / ì „íˆ¬ ì‹œì‘: ìì‹  ì·¨ì•½ 2"},{id:"twin_heart",name:"ìŒë‘¥ì´ ì‹¬ì¥",art:"assets/gods/twin_heart.png",patronPlus:"í„´ ì¢…ë£Œ: ì‚¬ìš©í•œ ì¹´ë“œ ì¤‘ ë¬´ì‘ìœ„ 1ì¥ì˜ ë°˜ëŒ€ìª½ ì—´ íš¨ê³¼ê°€ ë°œë™",patronMinus:"í„´ ì‹œì‘: S -1",temptation:"ì¹´ë“œ ë³´ìƒ 1íšŒ",hostile:"ì „íˆ¬ ì‹œì‘: êµë€ 5"},{id:"indifferent_one",name:"ì•„ë¬´ë ‡ì§€ ì•Šì€ ì",art:"assets/gods/indifferent_one.png",patronPlus:"í„´ ì¢…ë£Œ: ì¹´ë“œ 1ì¥ ì´í•˜ ì‚¬ìš© ì‹œ HP +2, ë°©ì–´ +6",patronMinus:"í„´: 5ì¥ ì´ìƒ ì‚¬ìš© ì‹œ í”¼ë¡œë„ +1 (ì „íˆ¬ ë‹¹ 1íšŒ)",temptation:"ì¦‰ì‹œ í”¼ë¡œë„ -5, ë‹¤ìŒ ì „íˆ¬ ë“œë¡œìš° -1",hostile:"í„´: 4ì¥ ì´ìƒ ì‚¬ìš© ì‹œ í”¼ë¡œë„ +1, HP -3 (ì „íˆ¬ ë‹¹ 3íšŒ)"},{id:"armored_tiger",name:"ì¤‘ê°‘ ì…ì€ í˜¸ë‘ì´",art:"assets/gods/armored_tiger.png",patronPlus:"ì „íˆ¬ ì‹œì‘: ì²« í„´ì— ë°©ì–´ 10, ê·¸ ë‹¤ìŒ í„´ì— ë°©ì–´ 5",patronMinus:"í„´ ì¢…ë£Œ: ë°©ì–´ë¥¼ ì–»ì§€ ëª»í–ˆìœ¼ë©´ HP -2",temptation:"ìµœëŒ€ ì²´ë ¥ +5, í”¼ë¡œë„ +2",hostile:"ì „íˆ¬ ì‹œì‘: ì·¨ì•½ 2, ë“œë¡œìš° -1"},{id:"first_human",name:"ì²« ë²ˆì§¸ ì¸ê°„",art:"assets/gods/first_human.png",patronPlus:"ì „íˆ¬ ë³´ìƒ: ì¹´ë“œ ì œì‹œ +1",patronMinus:"ìƒì : ë¹„ìš© +50%",temptation:"ì¹´ë“œ 1ì¥ ì„ íƒ ë³µì œ, í”¼ë¡œë„ +3",hostile:"ì „íˆ¬ ë³´ìƒ: ì¹´ë“œ ì œì‹œ -1 / ìƒì : ë¹„ìš© +50%"},{id:"card_dealer",name:"ì¹´ë“œ ë”œëŸ¬",art:"assets/gods/card_dealer.png",patronPlus:"ì „íˆ¬ ì‹œì‘: ë“œë¡œìš° +2",patronMinus:"ì „íˆ¬ ì¢…ë£Œ: 50% í™•ë¥ ë¡œ ê³¨ë“œ 10 ìƒìŒ",temptation:"ê³¨ë“œ +40, ë±ì— ë¹š ë¬¸ì„œ(ì €ì£¼) 1ì¥ ì¶”ê°€",hostile:"ì „íˆ¬ ê³¨ë“œ ë³´ìƒ ì—†ìŒ"},{id:"rabbit_hunt",name:"í† ë¼ ì‚¬ëƒ¥",art:"assets/gods/rabbit_hunt.png",patronPlus:"ì „íˆ¬ ì‹œì‘: ëª¨ë“  ì  ì·¨ì•½ 3",patronMinus:"ë°©ì–´ë„ íšë“ëŸ‰ -10%",temptation:"ë‹¤ìŒ 3ì „íˆ¬ ë™ì•ˆ ì „íˆ¬ ì‹œì‘ ë“œë¡œìš° +1",hostile:"ë§¤ ì „íˆ¬ ì²« í„´: ìì‹  ì·¨ì•½ 3"},{id:"wave_breath",name:"íŒŒë„ì˜ ìˆ¨ê²°",art:"assets/gods/wave_breath.png",patronPlus:"ì²˜ìŒ ì‚¬ìš©í•˜ëŠ” ëŒ€ìƒì„ ì„ íƒí•˜ëŠ” ì¹´ë“œê°€ ëª¨ë“  ì  ëŒ€ìƒ",patronMinus:"ê·¸ ì™¸ ëŒ€ìƒì„ ì„ íƒí•˜ëŠ” ì¹´ë“œëŠ” ë¬´ì‘ìœ„ ì  ëŒ€ìƒ",temptation:"ë‹¤ìŒ ì „íˆ¬: ì²˜ìŒ ì‚¬ìš©í•˜ëŠ” ëŒ€ìƒì„ ì„ íƒí•˜ëŠ” ì¹´ë“œê°€ ëª¨ë“  ì  ëŒ€ìƒ",hostile:"ëª¨ë“  ëŒ€ìƒ ì§€ì • ì¹´ë“œê°€ ë¬´ì‘ìœ„ ì  ëŒ€ìƒ"},{id:"forge_master",name:"í™”ë¡œì˜ ì£¼ì¸",art:"assets/gods/forge_master.png",patronPlus:"ì‹œì‘: í™”ì‚´/ê°•ë ¥í•œ í™”ì‚´/ë°©íŒ¨ê°€ ê°•í™”ëœ ì±„ë¡œ ì‹œì‘",patronMinus:"ì‹œì‘ S 6",temptation:"ë¬´ì‘ìœ„ ì¹´ë“œ 1ì¥ ì œê±° í›„ 2ì¥ ê°•í™”",hostile:"ê°•í™” ë¶ˆê°€ / íœ´ì‹ ì‹œ ì¹´ë“œ 1ì¥ ë¬´ì‘ìœ„ ì œê±°"}],Q={dream_shadow:{restHeal:"ì•…ëª½ì„ ê¾¸ì—ˆìŠµë‹ˆê¹Œ?",restUpgrade:"ë§ì¹˜ë¥¼ ë“¤ ê¸°ìš´ì´ ë‚˜ì§€ ì•ŠëŠ”êµ°ìš”.",tempt:"ë‚®ì ì—ì„œë„ ì•…ëª½ì€ ì°¾ì•„ì˜µë‹ˆë‹¤.",hostileRest:"ê¿ˆê·¸ë¦¼ìê°€ ë‹¹ì‹ ì˜ íœ´ì‹ì„ ë°©í•´í•©ë‹ˆë‹¤."},wing_artery:{moveNoTime:"ë‹¹ì‹ ì€ ë–¨ì–´ì§€ëŠ” í•ë°©ìš¸ë³´ë‹¤ ë¹ ë¦…ë‹ˆë‹¤.",every5Turns:"ë‚ ê°œê°€ ì‹œë“¤ê³  ìˆìŠµë‹ˆë‹¤.",tempt:"ì •ì‹ ì„ ì°¨ë ¤ë³´ë‹ˆ ì´ê³³ì…ë‹ˆë‹¤.",apostasy:"ìƒˆê°€ ë‚ ê°œë¥¼ ìƒì—ˆêµ°ìš”."},master_spear:{tempt:"ì°½ëì´ ê¿°ëš«ìŠµë‹ˆë‹¤.",hostileCombat:"í‹ˆì´ ë³´ì…ë‹ˆë‹¤.",targetOnlyFront:"ë§¨ ì•ì˜ ì ë§Œ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."},retort_fusion:{tempt:"ë ˆí† ë¥´íŠ¸ëŠ” ë‹¤ìŒ íœ´ì‹ì„ ì•½ì†í•©ë‹ˆë‹¤.",hostile:"ë ˆí† ë¥´íŠ¸ê°€ ë‹¹ì‹ ì˜ ë±ì„ ë°€ë´‰í•©ë‹ˆë‹¤."},nameless_vow:{tempt:"ì„œì•½ì€ ë¹šìœ¼ë¡œ ë‚¨ìŠµë‹ˆë‹¤.",victoryDebt:"ì„œì•½ì€ ê³µì§œê°€ ì•„ë‹™ë‹ˆë‹¤.",hostileStart:"ë¹šì´ ìˆ¨ì„ ë§‰ìŠµë‹ˆë‹¤."},bright_darkness:{nodeSelect:"ë¹›ì´ ë‹¹ì‹ ì„ ì¸ë„í•©ë‹ˆë‹¤.",combatStart:"ë„ˆë¬´ ë°ì•„ ìˆ¨ì„ ê³³ì´ ì—†ìŠµë‹ˆë‹¤.",tempt:"ë³´ì´ê²Œ í•´ì£¼ë§ˆ. ëŒ€ì‹  ëˆˆì„ ë‚´ì–´ë¼.",hostileMap:"ì–´ë‘ ì´ ë‹¹ì‹ ì˜ ëˆˆì„ ë¨¹ì—ˆìŠµë‹ˆë‹¤."},twin_heart:{tempt:"ì‹¬ì¥ì´ ë‹¹ì‹ ì˜ ì„ íƒì„ ë¶€ë¦…ë‹ˆë‹¤."},indifferent_one:{endTurnZero:"ì•„ë¬´ ì¼ë„ ì—†ì—ˆìŠµë‹ˆë‹¤.",at5Cards:"ì›€ì§ì„ì´ ê³¼í•©ë‹ˆë‹¤.",tempt:"ê°€ë§Œíˆ ìˆì–´ë„, êµ´ëŸ¬ê°‘ë‹ˆë‹¤.",hostileFirstUse:"ê´œíˆ ì›€ì§ì˜€êµ°ìš”."},armored_tiger:{combatStart:"ì´ë¹¨ì€ ë²¼ë ¤ì¡Œê³ , ê°‘ì˜·ì€ ë‹«í˜”ìŠµë‹ˆë‹¤.",endTurnNoBlock:"í˜¸ë‘ì´ëŠ” ë‹¹ì‹ ì„ ëŒ€ì‹  ì¡ì•„ë¨¹ìŠµë‹ˆë‹¤.",tempt:"ë¬´ê±°ì›Œì ¸ë¼. ì‚´ì•„ë‚¨ì•„ë¼.",hostileCombat:"í‹ˆì´ ë³´ì…ë‹ˆë‹¤."},first_human:{reward:"ë°°ì›ë‹ˆë‹¤. ë”°ë¼í•©ë‹ˆë‹¤.",shop:"ìˆœìˆ˜ì£¼ì˜ìì¸ ë‹¹ì‹ ì€ ê³ ë¸”ë¦°ì´ ë‹¬ê°‘ì§€ ì•ŠìŠµë‹ˆë‹¤.",tempt:"ì²« ë²ˆì§¸ëŠ” í•­ìƒ, ë‹¤ì‹œ íƒœì–´ë‚©ë‹ˆë‹¤.",hostileReward:"ì§€ì‹ì€ ìŠí™ë‹ˆë‹¤."},card_dealer:{combatStart:"íŒì„ ê¹”ì•„ë“œë¦¬ì£ .",victoryFee:"ìˆ˜ìˆ˜ë£ŒëŠ” ë‹¹ì—°íˆ ë°›ìŠµë‹ˆë‹¤.",tempt:"ì˜¤ëŠ˜ë§Œ ì™¸ìƒì…ë‹ˆë‹¤.",hostileShop:"ë”œëŸ¬ë¥¼ ë°°ì‹ í•˜ê³ ë„ ëˆì´ ë‚¨ì•„ìˆêµ°ìš”?"},rabbit_hunt:{combatStart:"ë¨¼ì € ì¡ìŠµë‹ˆë‹¤.",blockGain:"ê°€ë²¼ìš´ ë°©íŒ¨ëŠ” ì˜ ë¶€ëŸ¬ì§‘ë‹ˆë‹¤.",tempt:"ë” ë¹¨ë¦¬. ë” ê¹Šì´.",hostileCombatStart:"ì´ë²ˆì—” ë‹¹ì‹ ì´ ì«“ê¹ë‹ˆë‹¤."},wave_breath:{tempt:"íŒŒë„ê°€ ë‹¹ì‹ ì˜ ì†ì„ ë°”ê¿‰ë‹ˆë‹¤."},forge_master:{firstBattle:"ë‹¹ì‹ ì˜ ì² ì€ ëˆ„êµ¬ë³´ë‹¤ ë‹¨ë‹¨í•©ë‹ˆë‹¤.",tempt:"í™”ë§ˆê°€ ì² ì„ êµ½ìŠµë‹ˆë‹¤.",hostileRestEnter:"ë¶ˆì´ ë¶™ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¹ì‹ ì„ ë”°ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."},madness:{accept:"ë‹¹ì‹ ì€ ê·¸ í˜ì„ ë°›ì•„ë“¤ì´ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.",reject:"ë‹¹ì‹ ì—ê²Œ ì£¼ì–´ì ¸ ë§ˆë•…í•œ í˜ì´ ë˜ì „ ê³³ê³³ì— í©ì–´ì¡ŒìŠµë‹ˆë‹¤."}};function Vo(){const e=["dream_shadow","wing_artery","master_spear","retort_fusion","nameless_vow","bright_darkness","twin_heart","indifferent_one","armored_tiger","first_human","card_dealer","rabbit_hunt","wave_breath","forge_master"],t=[],n=[...e];for(;t.length<3&&n.length>0;){const r=Math.random()*n.length|0;t.push(n.splice(r,1)[0])}for(;t.length<3;)t.push("dream_shadow");return[t[0],t[1],t[2]]}function Ar(e){const t=$s.find(n=>n.id===e);if(!t)throw new Error(`Unknown god ${e}`);return t}function ge(e){return e==="madness"?"ê´‘ê¸°":Ar(e).name}function or(e){return e==="madness"?"assets/gods/madness.png":Ar(e).art}function Tn(e){const t=Ar(e);return[`í›„ì›(+)  ${t.patronPlus}`,`í›„ì›(-)  ${t.patronMinus}`,`ìœ í˜¹     ${t.temptation}`,`ë°°êµ/ì ëŒ€ ${t.hostile}`].join(`
`)}function Ms(e){const t=e??Vo(),n={dream_shadow:0,wing_artery:0,master_spear:0,retort_fusion:0,nameless_vow:0,bright_darkness:0,twin_heart:0,indifferent_one:0,armored_tiger:0,first_human:0,card_dealer:0,rabbit_hunt:0,wave_breath:0,forge_master:0,madness:0},r=t[0];return{offered:t,points:n,focus:r,lastFocus:r,chosen:!1,hostile:{}}}function be(e){const t=e.run;t.faith||(t.faith=Ms());const n=t.faith;n.offered??=Vo(),n.points??={dream_shadow:0,wing_artery:0,master_spear:0,retort_fusion:0,nameless_vow:0,bright_darkness:0,twin_heart:0,indifferent_one:0,armored_tiger:0,first_human:0,card_dealer:0,rabbit_hunt:0,wave_breath:0,forge_master:0,madness:0};const r=o=>{const a=Number(n.points[o]);Number.isFinite(a)||(n.points[o]=0)};for(const o of["dream_shadow","wing_artery","master_spear","retort_fusion","nameless_vow","bright_darkness","twin_heart","indifferent_one","armored_tiger","first_human","card_dealer","rabbit_hunt","wave_breath","forge_master","madness"])r(o);return n.hostile??={},n.focus??=n.offered?.[0]??"dream_shadow",n.lastFocus??=n.focus,n.chosen??=!1,n.madnessAwakened??=!1,n.madnessTemptUsed??=!1,vn(n),n}function ye(e,t){return!!be(e).hostile?.[t]}function Ps(e){const t=e.run;if(t._retortFusionHostileApplied)return;t._retortFusionHostileApplied=!0;const n=Object.values(e.cards).filter(a=>a&&(a.zone==="deck"||a.zone==="hand"||a.zone==="discard")).map(a=>a.uid).filter(a=>e.cards[a]?.defId!=="goal_treasure"),r=[],o=[...n];for(;r.length<7&&o.length>0;){const a=Math.random()*o.length|0;r.push(o.splice(a,1)[0])}for(const a of r){const s=e.cards[a];s.synth??={},s.synth.addTags??=[],s.synth.addTags.includes("EXHAUST")||s.synth.addTags.push("EXHAUST")}f(e,`ë ˆí† ë¥´íŠ¸ í“¨ì „(ì ëŒ€): ë¬´ì‘ìœ„ ${r.length}ì¥ì— ì†Œëª¨ ë¶€ì—¬`)}function Go(e,t,n){const r=be(e);if(r.hostile??={},r.hostile[t]){vn(r);return}r.hostile[t]=!0,t==="retort_fusion"&&(Ps(e),q(e,"WARN",Q.retort_fusion.hostile,2200),f(e,Q.retort_fusion.hostile)),t==="nameless_vow"&&(Ve(e,"debt_paper",{upgrade:0}),Ve(e,"debt_paper",{upgrade:0}),f(e,"ë¬´ëª…ì˜ ì„œì•½(ë°°êµ): ë¹š ë¬¸ì„œ 2ì¥ ì¶”ê°€")),vn(r)}function ue(e){const t=be(e),n=t.focus;return n==="madness"||t.hostile?.[n]?null:(t.points?.[n]??0)>=3?n:null}function vn(e,t){const n=e.offered,r=e.points,o=e.hostile??{},a=n.filter(c=>!o[c]),s=a.length>0?a:n;let i=-1,l=[];for(const c of s){const d=Number(r[c]??0)||0;d>i?(i=d,l=[c]):d===i&&l.push(c)}if(l.length===1){e.focus=l[0],e.lastFocus=e.focus;return}if(l.includes(e.lastFocus)){e.focus=e.lastFocus;return}if(t&&l.includes(t)){e.focus=t,e.lastFocus=t;return}e.focus=l[0],e.lastFocus=e.focus}function Vr(e){return e<0?0:e>5?5:e}function Rs(e){const t=be(e);return t.offered.map(n=>`${ge(n)}:${t.points[n]??0}`).join(", ")}function Bs(e,t){const n=be(e);if(n.offered.includes(t)){for(const r of n.offered)n.points[r]=0;if(n.points[t]=5,n.focus=t,n.lastFocus=t,n.chosen=!0,n.hostile={},t==="forge_master"){const r=Object.values(e.cards).filter(o=>o.zone==="deck"&&(e.content.cardsById[o.defId]?.tags??[]).includes("FORGE_START")).map(o=>o.uid);for(const o of r)Pt(e,o);f(e,`í™”ë¡œì˜ ì£¼ì¸: ì‹œì‘ ì¹´ë“œ ê°•í™” (${r.length}ì¥)`)}f(e,`ì‹ ì•™ ì„ íƒ: ${ge(t)} (5ì )`)}}function qo(e){const n=be(e).offered,o={kind:"FAITH",title:"ì‹ ì•™ ì„ íƒ",prompt:"",options:n.map(a=>{const s=a;return{key:`faith:choose:${a}`,label:ge(a),detail:Tn(s)}})};Be(e,o,{kind:"FAITH_START",offered:n})}function Is(e){const t=be(e);if(!t.chosen)return null;const n=t.focus,r=t.hostile??{},o=t.offered.filter(s=>s!==n&&!r[s]);if(o.length===0)return null;let a=o;return t.lastTempter&&o.length>=2&&(a=o.filter(s=>s!==t.lastTempter),a.length===0&&(a=o)),me(a,"pickTemptingGod")}function Un(e,t){const n=be(e);if(!n.chosen||!n.offered.includes(t))return;const r=n.focus;t!==r&&(n.points[t]=Vr((n.points[t]??0)+1),n.points[r]=Vr((n.points[r]??0)-1),vn(n,t),f(e,`ìœ í˜¹ ìˆ˜ë½: ${ge(t)} +1 / ${ge(r)} -1  ->  (${Rs(e)}) / í¬ì»¤ìŠ¤=${ge(n.focus)}`))}function Yo(e,t){const n=be(e);if(!n.chosen||!n.offered.includes(t)||t===n.focus||n.hostile?.[t])return;n.lastTempter=t;const r=`ìœ í˜¹: ${ge(t)}`,o=String(Q[t]?.tempt??""),a=Ls(t),s={kind:"GOD_TEMPT",title:r,prompt:o,art:or(t),options:[{key:"tempt:accept",label:"ë°›ì•„ë“¤ì¸ë‹¤",detail:a},{key:"tempt:reject",label:"ê±°ë¶€í•œë‹¤"}]};o&&(q(e,"INFO",o,1800),f(e,o)),Be(e,s,{kind:"GOD_TEMPT",tempter:t})}function Ls(e){return e==="dream_shadow"?"ì²´ë ¥ 10 íšŒë³µ, í”¼ë¡œë„ +3":e==="wing_artery"?"ì‹œê°„ -7, í”¼ë¡œë„ +2":e==="master_spear"?"ë‹¤ìŒ ì •ì˜ˆ/ë³´ìŠ¤ ì „íˆ¬ ì‹œì‘: ëª¨ë“  ì  ì·¨ì•½ 3":e==="retort_fusion"?"ë‹¤ìŒ íœ´ì‹ì—ì„œ í•©ì„± ê°€ëŠ¥":e==="nameless_vow"?"ë±ì— ë¹š ë¬¸ì„œ 1ì¥ ì¶”ê°€, ë‹¤ìŒ 3ì „íˆ¬ ë“œë¡œìš° +2":e==="bright_darkness"?"ë‹¤ìŒ 4ê°œ ë…¸ë“œì˜ ë‚´ìš©ì´ ì¦‰ì‹œ ê³µê°œ, í”¼ë¡œë„ +1":e==="twin_heart"?"ì¹´ë“œ ë³´ìƒ 1íšŒ":e==="indifferent_one"?"ì¦‰ì‹œ í”¼ë¡œë„ -5, ëŒ€ì‹  ë‹¤ìŒ ì „íˆ¬ ë“œë¡œìš° -1":e==="armored_tiger"?"ìµœëŒ€ ì²´ë ¥ +5, í”¼ë¡œë„ +2":e==="first_human"?"ì¹´ë“œ 1ì¥ ì„ íƒ ë³µì œ, í”¼ë¡œë„ +3":e==="card_dealer"?"ê³¨ë“œ +40, ë±ì— â€˜ë¹š ë¬¸ì„œâ€™(ì €ì£¼) 1ì¥ ì¶”ê°€":e==="rabbit_hunt"?"ë‹¤ìŒ 3ì „íˆ¬ ë™ì•ˆ ì „íˆ¬ ì‹œì‘ ë“œë¡œìš° +1":e==="wave_breath"?"ë‹¤ìŒ ì „íˆ¬ì—ì„œ ì²˜ìŒ ì‚¬ìš©í•˜ëŠ” ëŒ€ìƒ ì§€ì • ì¹´ë“œê°€ ëª¨ë“  ì ì„ ëŒ€ìƒìœ¼ë¡œ í•¨":e==="forge_master"?"ë¬´ì‘ìœ„ ì¹´ë“œ 1ì¥ ì œê±° í›„ 2ì¥ ê°•í™”":""}function Os(e,t){if(t==="dream_shadow"){kt(e,10),e.player.fatigue=(e.player.fatigue??0)+3,f(e,"ìœ í˜¹: HP +10, í”¼ë¡œ +3");return}if(t==="wing_artery"){e.time=Math.max(0,(e.time??0)-7),e.player.fatigue=(e.player.fatigue??0)+2,f(e,"ìœ í˜¹: ì‹œê°„ -7, í”¼ë¡œ +2");return}if(t==="master_spear"){const n=e.run;n.masterSpearVulnNextEliteBoss=!0,f(e,"ìœ í˜¹: ë‹¤ìŒ ì •ì˜ˆ/ë³´ìŠ¤ ì „íˆ¬ ì‹œì‘ ì‹œ ëª¨ë“  ì  ì·¨ì•½ 3");return}if(t==="retort_fusion"){const n=e.run;n.retortFusionNextRestSynth=!0,f(e,"ìœ í˜¹: ë‹¤ìŒ íœ´ì‹ì—ì„œ í•©ì„± ê°€ëŠ¥");return}if(t==="nameless_vow"){Ve(e,"debt_paper",{upgrade:0});const n=e.run;n.namelessVowDrawBoostBattles=Math.max(0,Number(n.namelessVowDrawBoostBattles??0)||0)+3,f(e,"ìœ í˜¹: ë¹š ë¬¸ì„œ 1ì¥ ì¶”ê°€, ë‹¤ìŒ 3ì „íˆ¬ ë“œë¡œìš° +2");return}if(t==="bright_darkness"){const n=e.run.map,r=String(n?.pos??""),o=n?.edges??{},a=n.seen??={},s=4,i={},l=[];for(r&&(i[r]=0,l.push(r));l.length;){const d=l.shift(),h=i[d]??0;if(!(h>=s))for(const m of o[d]??[])i[m]==null&&(i[m]=h+1,l.push(m))}let c=0;for(const d of Object.keys(i))d!==r&&((i[d]??999)>s||(a[d]??0)>=3||(a[d]=3,c+=1));e.player.fatigue=(e.player.fatigue??0)+1,f(e,`ìœ í˜¹: ê±°ë¦¬ ${s}ê¹Œì§€ ë…¸ë“œ ${c}ê°œ ê³µê°œ, í”¼ë¡œ +1`);return}if(t==="indifferent_one"){e.player.fatigue=Math.max(0,(e.player.fatigue??0)-5);const n=e.run;n.nextCombatDrawDelta=(Number(n.nextCombatDrawDelta??0)||0)-1,f(e,"ìœ í˜¹: í”¼ë¡œ -5, ë‹¤ìŒ ì „íˆ¬ ë“œë¡œìš° -1");return}if(t==="armored_tiger"){e.player.maxHp+=5,e.player.hp=Math.min(e.player.maxHp,e.player.hp+5),e.player.fatigue=(e.player.fatigue??0)+2,f(e,"ìœ í˜¹: ìµœëŒ€ HP +5, í”¼ë¡œ +2");return}if(t==="card_dealer"){const n=e.run,r=Number(n.gold??0)||0;n.gold=r+40,Ve(e,"debt_paper",{upgrade:0}),f(e,"ìœ í˜¹: ğŸª™ +40, ë¹š ë¬¸ì„œ 1ì¥ ì¶”ê°€");return}if(t==="rabbit_hunt"){const n=e.run;n.rabbitHuntDrawBoostBattles=Math.max(0,Number(n.rabbitHuntDrawBoostBattles??0)||0)+3,f(e,"ìœ í˜¹: ë‹¤ìŒ 3ì „íˆ¬ ì „íˆ¬ ì‹œì‘ ë“œë¡œìš° +1");return}if(t==="wave_breath"){const n=e.run;n.waveBreathNextCombatAll=!0,f(e,"ìœ í˜¹: ë‹¤ìŒ ì „íˆ¬ ì²« ëŒ€ìƒ ì§€ì • ì¹´ë“œê°€ ì „ì²´ ëŒ€ìƒ");return}if(t==="forge_master"){Nr(e);const n=Object.values(e.cards).filter(o=>(o.zone==="deck"||o.zone==="hand"||o.zone==="discard")&&rn(e,o.uid)).map(o=>o.uid);for(let o=n.length-1;o>0;o--){const a=Math.random()*(o+1)|0,s=n[o];n[o]=n[a],n[a]=s}const r=n.slice(0,2);for(const o of r)Pt(e,o);f(e,`ìœ í˜¹: ì¹´ë“œ 1ì¥ ì œê±°, ${r.length}ì¥ ê°•í™”`);return}}function Gr(e){return e===1?"ì¦‰ì‹œ ì²´ë ¥ ì „ë¶€ íšŒë³µ, ì „íˆ¬ ëŒì… ì‹œ 30% í™•ë¥ ë¡œ ì²«ë²ˆì§¸ ì  ì¦‰ì‚¬ (ë³´ìŠ¤ ì œì™¸)":e===2?"ì•ìœ¼ë¡œì˜ ì „íˆ¬ì—ì„œ ì²«ë²ˆì§¸ ì ì´ ì·¨ì•½/ì•½í™” 4":"50% í™•ë¥ ë¡œ ì „íˆ¬ ë…¸ë“œì— ë“¤ì–´ê°€ë„ ì „íˆ¬ê°€ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. (ë³´ìŠ¤ ì œì™¸)"}function qr(e){return e===1?"ëª¨ë“  ì ì˜ ì²´ë ¥ì´ 10 ì¦ê°€":e===2?"ì „íˆ¬ ì‹œì‘ ì‹œ ìì‹ ì€ ì·¨ì•½/ì•½í™”/ì¶œí˜ˆ 2":"50% í™•ë¥ ë¡œ ì „íˆ¬ê°€ ì•„ë‹Œ ë…¸ë“œì— ë“¤ì–´ê°€ë„ ì „íˆ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤."}function Ds(e){const t=be(e);t.madnessAwakened=!0}function Hs(e){const t=be(e);if(!t.chosen||(t.madnessAwakened||(t.madnessAwakened=!0),t.madnessTemptUsed))return;const n=me([1,2,3],"madness boon"),r=me([1,2,3],"madness bane"),o="ê´‘ê¸°ì˜ ì‹  0",a=`ê´‘ê¸°ì˜ ì‹ ì´ ê¹¨ì–´ë‚¬ìŠµë‹ˆë‹¤.

ìˆ˜ë½ ì‹œ(ë°°êµ): ${Gr(n)}
  - ë‹¨, ì¦‰ì‹œ F +10
ê±°ë¶€ ì‹œ(ì ëŒ€): ${qr(r)}`,s={kind:"MADNESS_TEMPT",title:o,prompt:a,art:"assets/gods/madness.png",options:[{key:"madness:accept",label:"í˜ì„ ë°›ì•„ë“¤ì¸ë‹¤",detail:`ë°°êµ
${Gr(n)}
(ì¦‰ì‹œ F+10)`},{key:"madness:reject",label:"ê±°ë¶€í•œë‹¤",detail:`ì ëŒ€
${qr(r)}`}]};Be(e,s,{kind:"MADNESS_TEMPT",offerBoon:n,offerBane:r})}function Fs(e,t){const n=be(e);if(n.madnessTemptUsed)return;n.madnessTemptUsed=!0,n.madnessAccepted=!0,n.madnessBoon=t,e.player.fatigue=(e.player.fatigue??0)+10,t===1&&(e.player.hp=e.player.maxHp,f(e,"ê´‘ê¸°: ì¦‰ì‹œ ì²´ë ¥ ì „ë¶€ íšŒë³µ")),q(e,"INFO",Q.madness.accept,2200),f(e,Q.madness.accept);const r=n.focus;Go(e,r),r==="wing_artery"&&(q(e,"WARN",Q.wing_artery.apostasy,2200),f(e,Q.wing_artery.apostasy)),f(e,`ë°°êµ: ${ge(r)} ì ëŒ€`)}function Ws(e,t){const n=be(e);n.madnessTemptUsed||(n.madnessTemptUsed=!0,n.madnessAccepted=!1,n.madnessBane=t,Go(e,"madness"),q(e,"WARN",Q.madness.reject,2200),f(e,Q.madness.reject))}function Xo(e){const t=be(e);return t.madnessAccepted?t.madnessBoon??null:null}function $r(e){const t=be(e);return t.hostile?.madness?t.madnessBane??null:null}function Us(e){const t=Xo(e);if($r(e)===2&&(Se(e.player,"vuln",2,e,"SYSTEM"),Se(e.player,"weak",2,e,"SYSTEM"),Se(e.player,"bleed",2,e,"SYSTEM"),f(e,"ê´‘ê¸°(ì ëŒ€): ì·¨ì•½/ì•½í™”/ì¶œí˜ˆ 2")),t===2){const r=e.enemies?.[0];r&&r.hp>0&&!e.content.enemiesById[r.id]?.isBoss&&(Se(r,"vuln",4,e,"SYSTEM"),Se(r,"weak",4,e,"SYSTEM"),f(e,"ê´‘ê¸°: ì²«ë²ˆì§¸ ì  ì·¨ì•½/ì•½í™” 4"))}if(t===1){const r=e.enemies?.[0];r&&r.hp>0&&!e.content.enemiesById[r.id]?.isBoss&&Math.random()<.3&&(r.hp=0,f(e,"ê´‘ê¸°: ì²«ë²ˆì§¸ ì  ì¦‰ì‚¬!"),q(e,"INFO","ê´‘ê¸°ì˜ í˜ì´ ì ì„ ì‚¼ì¼°ìŠµë‹ˆë‹¤.",1600))}}function zs(e){const t=ue(e),n=ye(e,"wing_artery");let r=1;return t==="wing_artery"&&Math.random()<.5&&(r=0,q(e,"INFO",Q.wing_artery.moveNoTime,1800),f(e,Q.wing_artery.moveNoTime)),n&&(r+=1),r}function Qo(e){const t=ue(e);return t==="wing_artery"?3:t==="forge_master"?-1:0}function Ks(e){if(ue(e)!=="wing_artery")return;const n=e.combatTurn??0;n>0&&n%5===0&&(e.player.fatigue=(e.player.fatigue??0)+1,q(e,"WARN",Q.wing_artery.every5Turns,1800),f(e,Q.wing_artery.every5Turns))}function js(e){const t=ue(e);return ye(e,"dream_shadow")?(q(e,"WARN",Q.dream_shadow.hostileRest,1800),f(e,Q.dream_shadow.hostileRest),{healed:!0}):t==="dream_shadow"?(e.player.hp=e.player.maxHp,e.player.fatigue=(e.player.fatigue??0)+3,q(e,"INFO",Q.dream_shadow.restHeal,1800),f(e,Q.dream_shadow.restHeal),f(e,"íœ´ì‹: ìµœëŒ€ ì²´ë ¥ íšŒë³µ (F +3)"),{healed:!0}):{healed:!1}}function Vs(e){const t=ue(e),n=ye(e,"dream_shadow");if(t!=="dream_shadow"&&!n)return;const r=e.player.fatigue??0;r>0?(Me(e,r,"OTHER","ê¿ˆê·¸ë¦¼ì"),q(e,"WARN",Q.dream_shadow.restUpgrade,1800),f(e,Q.dream_shadow.restUpgrade),f(e,`íœ´ì‹: ê°•í™” ëŒ€ê°€ë¡œ í”¼í•´ ${r}`)):(q(e,"WARN",Q.dream_shadow.restUpgrade,1400),f(e,Q.dream_shadow.restUpgrade))}function In(e){return ye(e,"forge_master")}function Gs(e){In(e)&&(q(e,"WARN",Q.forge_master.hostileRestEnter,2200),f(e,Q.forge_master.hostileRestEnter),Nr(e)),ye(e,"dream_shadow")&&(q(e,"WARN",Q.dream_shadow.hostileRest,2200),f(e,Q.dream_shadow.hostileRest))}function qs(e){return ye(e,"retort_fusion")?!1:ue(e)==="retort_fusion"?!0:!!e.run.retortFusionNextRestSynth}function Zo(e){const t=e.run;t.retortFusionNextRestSynth&&(t.retortFusionNextRestSynth=!1)}function Ys(e){let t=3;return ue(e)==="first_human"&&(t+=1),ye(e,"first_human")&&(t-=1),Math.max(1,Math.min(6,t))}function Xs(e){return ue(e)==="first_human"||ye(e,"first_human")?1.5:1}function He(e,t){const n=Math.max(0,Number(t)||0),r=Xs(e),o=r===1?n:Math.ceil(n*r);return Math.max(1,o)}function Qs(e){let t=0;return ue(e)==="card_dealer"&&(t+=2),ye(e,"armored_tiger")&&(t-=1),t}function Zs(e){const t=ue(e);{const n=e.run,r=!!e.run.lastBattleWasElite||!!n.lastBattleWasBoss;if(n.masterSpearVulnNextEliteBoss&&r){n.masterSpearVulnNextEliteBoss=!1;for(const o of e.enemies??[])!o||o.hp<=0||Se(o,"vuln",3,e,"SYSTEM");q(e,"INFO",Q.master_spear.tempt,1800),f(e,"ë‹¬ì¸ì˜ ì°½(ìœ í˜¹): ì •ì˜ˆ/ë³´ìŠ¤ ì‹œì‘ ì·¨ì•½ 3")}if(ye(e,"master_spear")&&r&&(Se(e.player,"vuln",2,e,"SYSTEM"),Se(e.player,"weak",2,e,"SYSTEM"),Se(e.player,"disrupt",2,e,"SYSTEM"),q(e,"WARN",Q.master_spear.hostileCombat,1800),f(e,"ë‹¬ì¸ì˜ ì°½(ì ëŒ€): ì •ì˜ˆ/ë³´ìŠ¤ ì‹œì‘ ì·¨ì•½/ì•½í™”/êµë€ 2")),t==="nameless_vow"||ye(e,"nameless_vow")){const o=e.deck.filter(a=>e.cards[a]?.defId==="debt_paper").length+e.discard.filter(a=>e.cards[a]?.defId==="debt_paper").length+e.hand.filter(a=>e.cards[a]?.defId==="debt_paper").length;t==="nameless_vow"&&(n.nextCombatDrawDelta=(Number(n.nextCombatDrawDelta??0)||0)+o,o>0&&(e.player.block=(e.player.block??0)+o*3,e._gainedBlockThisTurn=!0,f(e,`ë¬´ëª…ì˜ ì„œì•½: ë¹š ë¬¸ì„œ ${o}ì¥ â†’ ì‹œì‘ ë“œë¡œìš° +${o}, ë°©ì–´ +${o*3}`))),ye(e,"nameless_vow")&&o>0&&(Me(e,o,"OTHER","ë¬´ëª…ì˜ ì„œì•½"),q(e,"WARN",Q.nameless_vow.hostileStart,1800),f(e,`ë¬´ëª…ì˜ ì„œì•½(ì ëŒ€): ë¹š ë¬¸ì„œ ${o}ì¥ â†’ ì „íˆ¬ ì‹œì‘ HP -${o}`))}}if(t==="bright_darkness"&&(Se(e.player,"vuln",1,e,"SYSTEM"),q(e,"WARN",Q.bright_darkness.combatStart,1800),f(e,Q.bright_darkness.combatStart)),ye(e,"bright_darkness")&&(Se(e.player,"vuln",2,e,"SYSTEM"),f(e,"ë°ì€ ì–´ë‘ (ì ëŒ€): ì „íˆ¬ ì‹œì‘ ì·¨ì•½ 2")),ye(e,"twin_heart")&&(Se(e.player,"disrupt",5,e,"SYSTEM"),f(e,"ìŒë‘¥ì´ ì‹¬ì¥(ì ëŒ€): ì „íˆ¬ ì‹œì‘ êµë€ 5")),t==="armored_tiger"&&(e.player.block=(e.player.block??0)+10,e._gainedBlockThisTurn=!0,q(e,"INFO",Q.armored_tiger.combatStart,1800),f(e,Q.armored_tiger.combatStart),f(e,"ì¤‘ê°‘ ì…ì€ í˜¸ë‘ì´: ì „íˆ¬ ì‹œì‘ ë°©ì–´ +10")),ye(e,"armored_tiger")&&(Se(e.player,"vuln",2,e,"SYSTEM"),q(e,"WARN",Q.armored_tiger.hostileCombat,1800),f(e,Q.armored_tiger.hostileCombat),f(e,"ì¤‘ê°‘ ì…ì€ í˜¸ë‘ì´(ì ëŒ€): ì „íˆ¬ ì‹œì‘ ì·¨ì•½ 2 / ë“œë¡œìš° -1")),t==="card_dealer"&&(q(e,"INFO",Q.card_dealer.combatStart,1800),f(e,Q.card_dealer.combatStart)),t==="rabbit_hunt"){for(const n of e.enemies??[])n&&n.hp>0&&Se(n,"vuln",3,e,"SYSTEM");q(e,"INFO",Q.rabbit_hunt.combatStart,1800),f(e,Q.rabbit_hunt.combatStart),f(e,"í† ë¼ ì‚¬ëƒ¥: ëª¨ë“  ì  ì·¨ì•½ 3")}ye(e,"rabbit_hunt")&&(Se(e.player,"vuln",3,e,"SYSTEM"),q(e,"WARN",Q.rabbit_hunt.hostileCombatStart,1800),f(e,Q.rabbit_hunt.hostileCombatStart),f(e,"í† ë¼ ì‚¬ëƒ¥(ì ëŒ€): ì „íˆ¬ ì‹œì‘ ì·¨ì•½ 3"));{const n=e.run,r=ye(e,"wave_breath"),o=t==="wave_breath";let a=0;o&&(a+=1),r?(a=0,n.waveBreathNextCombatAll=!1):n.waveBreathNextCombatAll&&(a+=1,n.waveBreathNextCombatAll=!1),e._waveBreathAllRemainingThisCombat=a,e._waveBreathForceRandomThisCombat=o||r,e._waveBreathNoAllThisCombat=r}}function Js(e){const t=ue(e),n=Number(e.usedThisTurn??0)||0;if(t==="indifferent_one"&&n>=5&&!e._indifferentPatronPenaltyAppliedThisCombat&&(e._indifferentPatronPenaltyAppliedThisCombat=!0,e.player.fatigue=(e.player.fatigue??0)+1,q(e,"WARN",Q.indifferent_one.at5Cards,1800),f(e,Q.indifferent_one.at5Cards),f(e,"ì•„ë¬´ë ‡ì§€ ì•Šì€ ì: 5ì¥ ì´ìƒ ì‚¬ìš©(ì „íˆ¬ë‹¹ 1íšŒ) â†’ í”¼ë¡œ +1")),ye(e,"indifferent_one")){const r=Number(e._indifferentHostilePenaltyAppliedThisCombat??0)||0;n>=4&&r<3&&(e._indifferentHostilePenaltyAppliedThisCombat=r+1,e.player.fatigue=(e.player.fatigue??0)+1,Me(e,3,"OTHER","ì•„ë¬´ë ‡ì§€ ì•Šì€ ì"),q(e,"WARN",Q.indifferent_one.hostileFirstUse,1800),f(e,Q.indifferent_one.hostileFirstUse),f(e,`ì•„ë¬´ë ‡ì§€ ì•Šì€ ì(ì ëŒ€): 4ì¥ ì´ìƒ ì‚¬ìš©(ì „íˆ¬ë‹¹ ${e._indifferentHostilePenaltyAppliedThisCombat}/3íšŒ) â†’ í”¼ë¡œ +1, HP -3`))}}function ei(e){const t=ue(e);t==="indifferent_one"&&(Number(e.usedThisTurn??0)||0)<=1&&(kt(e,2),e.player.block=(e.player.block??0)+6,e._gainedBlockThisTurn=!0,q(e,"INFO",Q.indifferent_one.endTurnZero,1800),f(e,Q.indifferent_one.endTurnZero),f(e,"ì•„ë¬´ë ‡ì§€ ì•Šì€ ì: 1ì¥ ì´í•˜ ì‚¬ìš© â†’ HP +2, ë°©ì–´ +6")),t==="armored_tiger"&&(e._gainedBlockThisTurn||(Me(e,2,"OTHER","ì¤‘ê°‘ ì…ì€ í˜¸ë‘ì´"),q(e,"WARN",Q.armored_tiger.endTurnNoBlock,1800),f(e,Q.armored_tiger.endTurnNoBlock)))}function zn(e,t){const n=e.content.enemiesById[t],r={id:n.id,name:n.name,hp:n.maxHp,maxHp:n.maxHp,intentIndex:0,status:{vuln:0,weak:0,bleed:0,disrupt:0,slash:0},immuneThisTurn:!1,immuneNextTurn:!1,lastIntentKey:null,lastIntentStreak:0};return n.special?.kind==="SOUL_STEALER"&&(r.special={kind:"SOUL_STEALER",warnCount:0,armed:!1,willNukeThisTurn:!1}),$r(e)===1&&(r.maxHp+=10,r.hp+=10),r}function ti(e,t,n,r=5){for(const o of t){const a=e.run.enemyLastSeenBattle?.[o];if(a!=null&&n-a<r)return!1}return!0}function vt(e,t){const n=t?.forceBoss??!1,r=e.run,o=(t?.forceElite??r.pendingElite??!1)===!0;r.pendingElite=!1,e.run.enemyLastSeenBattle??={},e.run.battleCount??=0;const a=e.run.nodePickCount??0,s=(e.run.battleCount??0)+1;if(t?.forcePatternIds&&t.forcePatternIds.length>0){const x=t.forcePatternIds;e.run.battleCount=s;for(const N of x)e.run.enemyLastSeenBattle[N]=s;e.enemies=x.map(N=>zn(e,N)),r.lastBattleEnemyCount=e.enemies.length,e.run.lastBattleWasElite=!1,e.run.lastBattleWasBoss=!1,f(e,`ì „íˆ¬ ì‹œì‘! (ë…¸ë“œ ${a}, ì „íˆ¬ ${s}íšŒì°¨) ì : ${e.enemies.map(N=>N.name).join(", ")}`);return}if(n)if(e.run.lastBattleWasElite=!1,e.run.lastBattleWasBoss=!0,e.run.bossPool??=["boss_gravity_master","boss_cursed_wall","boss_giant_orc","boss_soul_stealer"],e.run.bossPool.length===0&&!e.run.nextBossId)f(e,`ë³´ìŠ¤ í’€ì´ ë¹„ì—ˆìŠµë‹ˆë‹¤. ì¼ë°˜ ì „íˆ¬ë¡œ ì§„í–‰í•©ë‹ˆë‹¤. (ë…¸ë“œ ${a})`);else{let x=e.run.nextBossId??null;if(x!=null){const N=e.content.enemiesById[x];e.run.bossOmenText=Ta[x]??N.omen??null}x?(e.run.nextBossId=null,e.run.bossPool=e.run.bossPool.filter(N=>N!==x)):(x=me(e.run.bossPool),e.run.bossPool=e.run.bossPool.filter(N=>N!==x)),e.enemies=[zn(e,x)],r.lastBattleEnemyCount=e.enemies.length,e.run.ominousProphecySeen=!1,f(e,`ë³´ìŠ¤ ë“±ì¥! (ë…¸ë“œ ${a}) ì : ${e.enemies[0].name}`),e.run.battleCount=s,e.run.enemyLastSeenBattle[x]=s;return}const i=[[["goblin_raider"],["watching_statue"],["pebble_golem"],["slime"],["rat_swarm"],["supply_hound"],["goblin_assassin"]],[["goblin_commander","goblin_archer"],["supply_hound","rat_swarm"],["goblin_commander","goblin_assassin"],["goblin_raider","watching_statue"],["archive_censor"],["living_chain","living_chain"],["poison_spider"],["goblin_archer","goblin_raider"],["pebble_golem","slime"],["living_chain","watching_statue"]],[["rock_golem"],["gravity_echo"],["gloved_hunter"],["debt_collector"],["archive_censor","debt_collector"],["archive_censor","slime"],["poison_spider","slime"],["old_monster_corpse","rat_swarm","rat_swarm"],["punishing_one"]]],l=[["gravity_echo","poison_spider"],["poison_spider","poison_spider","slime"],["goblin_raider","watching_statue","watching_statue"],["poison_spider","poison_spider","goblin_raider"],["rock_golem","gravity_echo"],["goblin_raider","goblin_raider","watching_statue"],["rat_swarm","rat_swarm","rat_swarm"],["archive_censor","debt_collector"]],c=[[["goblin_raider","watching_statue"],["supply_hound","rat_swarm"],["pebble_golem","goblin_archer"]],[["goblin_commander","goblin_archer","goblin_archer"],["archive_censor","goblin_archer","goblin_raider"],["poison_spider","poison_spider","slime"]],[["rock_golem","gravity_echo"],["archive_censor","debt_collector","supply_hound"],["punishing_one","gloved_hunter"]]],d=[["gravity_echo","gravity_echo","living_chain"],["watching_statue","gravity_echo","rock_golem"],["debt_collector","supply_hound","punishing_one"]],h=Number(e.run.timeMove??0)+(e.time??0),m=Math.min(i.length-1,Math.floor(Math.max(0,h)/15)),u=o?e.run.treasureObtained?d:c[m]:e.run.treasureObtained?l:i[m],p=5,y=u.filter(x=>ti(e,x,s,p)),k=y.length>0?y:u,T=me(k);e.run.battleCount=s;for(const x of T)e.run.enemyLastSeenBattle[x]=s;e.enemies=T.map(x=>zn(e,x)),r.lastBattleEnemyCount=e.enemies.length,e.run.lastBattleWasElite=o,e.run.lastBattleWasBoss=!1,f(e,`ì „íˆ¬ ì‹œì‘!${o?" [ì •ì˜ˆ]":""} (ë…¸ë“œ ${a}, ì „íˆ¬ ${s}íšŒì°¨) ì : ${e.enemies.map(x=>x.name).join(", ")}`)}function Jo(e,t,n){const r=Math.max(0,Number(e.usedThisTurn??0)||0);switch(n){case"goblin_raider":return{raw:Math.max(0,12-r),hits:1};case"watching_statue":return{raw:Math.max(0,4+r),hits:1};case"gloved_hunter":return{raw:Math.max(0,Number(e.player.block??0)||0)>=4?12:6,hits:1};case"goblin_assassin":{const o=Math.max(0,Number(t.assassinAim??0)||0);return{raw:Math.max(0,8+4*o),hits:1,consumeEnemyKey:"assassinAim"}}case"old_monster_corpse":{const o=Math.max(0,Number(t.corpseRage??0)||0);return{raw:Math.max(0,9+4*o),hits:1}}case"punishing_one":{const o=Math.max(0,Number(e.hand?.length??0)||0);return{raw:Math.max(0,Math.min(30,6+2*o)),hits:1}}}}function ni(e,t,n){const r=Jo(e,t,n);return{raw:r.raw,hits:r.hits}}function ri(e){return e<0?0:e}function oi(e,t,n){const r=t.player.status?.vuln??0,o=n.status?.weak??0;return ri(e+r-o)}function ai(e,t){let n=Math.max(0,Number(t)||0);const r=[];for(const o of e){const a=Math.min(n,o);n-=a,r.push(o-a)}return r}function ct(e,t){e.push(t)}function si(e){const t=(e.dmgTotal??0)>0||(e.hits??0)>0||(e.perHit??0)>0,n=(e.applies??[]).some(o=>o.target==="player"&&["vuln","weak","bleed","disrupt","supplies","fatigue"].includes(String(o.kind))),r=(e.applies??[]).some(o=>o.target==="enemy"&&["vuln","weak","bleed","disrupt","immune"].includes(String(o.kind)));return t&&n?"ATTACK_DEBUFF":t&&r?"ATTACK_BUFF":t?"ATTACK":n?"DEBUFF":r?"BUFF":"OTHER"}function ii(e,t){const n=Number(t.base??0),r=Number(t.per??0),o=Math.max(1,Number(t.div??1)),a=t.cap==null?1/0:Number(t.cap),s=(e.deck?.length??0)+(e.hand?.length??0)+(e.discard?.length??0)+(e.frontSlots?.filter(Boolean).length??0)+(e.backSlots?.filter(Boolean).length??0)+(e.exhausted?.length??0),i=Math.ceil(s/o),l=n+r*i;return Math.min(a,Math.max(0,l))}function ea(e,t,n,r={}){if(n.meta?.preview){const u=n.meta.preview(e,t);if(u)return u}const o=[],a=[],s=[],i=Math.max(0,Number(t.atkRamp??0)||0);if(n.meta?.applies)for(const u of n.meta.applies)ct(o,u);for(const u of n.acts)switch(u.op){case"damagePlayer":{s.push(Math.max(0,(Number(u.n)||0)+i));break}case"damagePlayerFormula":{const{raw:p,hits:y}=ni(e,t,u.kind),k=Math.max(1,Number(y??1)||1),T=Math.max(0,(Number(p)||0)+i);for(let C=0;C<k;C++)s.push(T);break}case"statusPlayer":{ct(o,{target:"player",kind:u.key,amount:u.n});break}case"supplies":{ct(o,{target:"player",kind:"supplies",amount:u.n});break}case"fatiguePlayer":{ct(o,{target:"player",kind:"fatigue",amount:u.n});break}case"enemyHealSelf":{ct(o,{target:"enemy",kind:"heal",amount:u.n});break}case"enemyImmuneNextTurn":{ct(o,{target:"enemy",kind:"immune",amount:1});break}case"damagePlayerRampHits":{const p=Math.max(1,Number(e.combatTurn??1)),y=Math.max(1,Number(u.baseHits??1)),k=Math.max(1,Number(u.everyTurns??1));let T=y+Math.floor((p-1)/k);u.capHits!=null&&(T=Math.min(T,Math.max(1,Number(u.capHits))));const C=Math.max(0,(Number(u.n)||0)+i);for(let x=0;x<T;x++)s.push(C);break}case"damagePlayerIfSuppliesPositive":{e.player.supplies>0&&s.push(Math.max(0,(Number(u.n)||0)+i));break}case"damagePlayerIfSuppliesZero":{e.player.supplies==0&&s.push(Math.max(0,(Number(u.n)||0)+i));break}case"suppliesIfPlayerBackFull":{(e.backSlots?.filter(Boolean).length??0)>=3&&ct(o,{target:"player",kind:"supplies",amount:u.n});break}case"damagePlayerByDeckSize":{s.push(Math.max(0,ii(e,u)+i));break}}if(!s.length){const u=Math.max(0,Number(n.meta?.hits??0)||0),p=Math.max(0,Number(n.meta?.baseDmg??0)||0);if(u>0&&p>0)for(let y=0;y<u;y++)s.push(p)}let l=s.map(u=>oi(u,e,t));r.includeBlock&&l.length&&(l=ai(l,e.player.block??0));const c=l.length,d=c?l.reduce((u,p)=>u+p,0):void 0,h=c&&l.every(u=>u===l[0])?l[0]:void 0,m={cat:n.meta?.cat??"OTHER",dmgTotal:d,hits:c>0?c:n.meta?.hits,perHit:h??n.meta?.baseDmg,applies:o.length?o:void 0,notes:a.length?a:void 0};return m.cat=n.meta?.cat??si(m),m.shortText||(m.dmgTotal!=null&&(m.hits??0)>1?m.shortText=`${m.dmgTotal} (${m.hits}íƒ€)`:m.dmgTotal!=null&&(m.shortText=`${m.dmgTotal}`)),m}function li(e,t){const n=e?.intentRules?.noRepeatIntentIndexes;return Array.isArray(n)&&n.includes(t)}function ar(e){if(e===null)return"null";const t=typeof e;return t==="number"||t==="boolean"?String(e):t==="string"?JSON.stringify(e):Array.isArray(e)?"["+e.map(ar).join(",")+"]":t==="object"?"{"+Object.keys(e).sort().map(r=>JSON.stringify(r)+":"+ar(e[r])).join(",")+"}":JSON.stringify(String(e))}function ta(e){if(!e)return"NONE";const t={};for(const n of Object.keys(e))n==="label"||n==="text"||n==="desc"||n==="name"||(t[n]=e[n]);return t.effects&&Array.isArray(t.effects)&&(t.effects=t.effects.map(n=>{const r={};for(const o of Object.keys(n??{}))o==="label"||o==="text"||o==="desc"||o==="name"||(r[o]=n[o]);return r})),ar(t)}function ci(e,t){const n=e.lastIntentKey??null,r=e.lastIntentStreak??0;n===t?e.lastIntentStreak=Math.min(3,r+1):(e.lastIntentKey=t,e.lastIntentStreak=1)}function di(e,t,n,r,o){const a=e.length;if(a<=1)return 0;const s=Array.from({length:a},(m,u)=>u),i=m=>m===t&&li(n,m),l=m=>!!r&&o>=2&&ta(e[m])===r,c=s.filter(m=>!i(m)&&!l(m));if(c.length>0)return me(c);const d=s.filter(m=>!l(m));if(d.length>0)return me(d);const h=s.filter(m=>!i(m));return h.length>0?me(h):me(s)}function Mr(e){if(!e.intentsRevealedThisTurn){e.intentsRevealedThisTurn=!0,e.attackedEnemyIndicesThisTurn=[],e.backUidsThisTurn=[],e.placedUidsThisTurn=[],e.drawCountThisTurn=0,e.phase="REVEAL",e.player.immuneToDisruptThisTurn=!1,e.player.nullifyDamageThisTurn=!1,e.player.incomingDamageReductionThisTurn=0,e.disruptIndexThisTurn=null;{const t=Math.max(1,e.backSlots?.length??3);e.backSlotDisabled=Array.from({length:t},()=>!1);const n=e.run,r=Number(n.slotCapBack??3),o=Math.max(3,Math.min(4,Math.floor(r)));(e.player.status.disrupt??0)>0&&(e.disruptIndexThisTurn=Math.floor(Math.random()*o),e.backSlotDisabled[e.disruptIndexThisTurn]=!0)}for(const t of e.enemies)t.immuneThisTurn=t.immuneNextTurn,t.immuneNextTurn=!1;for(const t of le(e)){t.intentLabelOverride=void 0;const n=e.content.enemiesById[t.id],r=n.intents;if(!r||r.length===0)continue;const o=di(r,t.intentIndex??0,n,t.lastIntentKey??null,t.lastIntentStreak??0);t.intentIndex=o;const a=r[o%r.length];ci(t,ta(a));const s=n.special;if(s?.kind==="SOUL_STEALER"){const h=t.special&&t.special.kind==="SOUL_STEALER"?t.special:t.special={kind:"SOUL_STEALER",warnCount:0,armed:!1,willNukeThisTurn:!1};h.willNukeThisTurn=!1;const m=Math.max(0,Number(h.warnCount??0)||0);if(!!h.armed){if(Math.random()<s.nukeChance){h.willNukeThisTurn=!0,t.intentLabelOverride=s.nukeLabel??`ì¢…ë§: ${s.nukeDamage} í”¼í•´`,f(e,`ì  ì˜ë„: ${t.name} â†’ ${t.intentLabelOverride}`);continue}const y=r[t.intentIndex%r.length];t.intentLabelOverride=`${y.label} (í­ë°œ ê°€ëŠ¥ ìƒíƒœ)`,f(e,`ì  ì˜ë„: ${t.name} â†’ ${t.intentLabelOverride}`);continue}const p=r[t.intentIndex%r.length];t.intentLabelOverride=`${p.label} (ê²½ê³  ${m}/${s.warnCap})`,f(e,`ì  ì˜ë„: ${t.name} â†’ ${t.intentLabelOverride}`);continue}const i=r[t.intentIndex%r.length],l=ea(e,t,i);let c="";l.dmgTotal!=null?c=(l.hits??1)>1?` (${l.dmgTotal}, ${l.hits}íƒ€)`:` (${l.dmgTotal})`:(l.hits??0)>1&&(c=` (${l.hits}íƒ€)`);const d=`${i.label}${c}`;t.intentLabelOverride=d,f(e,`ì  ì˜ë„: ${t.name} â†’ ${d}`)}e.disruptIndexThisTurn!==null&&f(e,`êµë€: ì´ë²ˆ í„´ í›„ì—´ ${e.disruptIndexThisTurn} ë¬´íš¨`),an(e,"onReveal"),e.phase="PLACE"}}function ui(e){const t=new Set(e.run.relics??[]);return Object.keys(pe).filter(n=>{const r=pe[n];return!(!r||r.debugOnly||(Array.isArray(r.tags)?r.tags:[]).includes("EVENT_ONLY")||t.has(n))})}function na(e,t=1){const n=ui(e);if(n.length===0)return null;const r=[],o=n.slice(),a=Math.min(t,o.length);for(let s=0;s<a;s++){const i=me(o),l=o.indexOf(i);l>=0&&o.splice(l,1);const c=pe[i]??{};r.push({id:i,name:c.name??String(i),desc:c.desc??c.description??c.text,art:c.art})}return{choices:r}}function ra(e,t){const n=e.run.lastBattleWasBoss?"BOSS":e.run.lastBattleWasElite?"ELITE":"BATTLE",r=Ys(e),o=Ns(e,n,r);if(!o||o.length===0)return;ue(e)==="first_human"?(q(e,"INFO",Q.first_human.reward,1800),f(e,Q.first_human.reward)):ye(e,"first_human")&&(q(e,"WARN",Q.first_human.hostileReward,1800),f(e,Q.first_human.hostileReward));const a=o.map(c=>{const d=xe(e.content,c.defId,c.upgrade),h=Ae(e,d.frontText,d.backText),m=tt(e,d.name,c.upgrade);return{key:`pick:${c.defId}:${c.upgrade}`,label:m,detail:`ì „ì—´: ${h.frontText} / í›„ì—´: ${h.backText}`}});a.push({key:"skip",label:"ìƒëµ",detail:""});const s={kind:"REWARD",title:"ì „íˆ¬ ë³´ìƒ",prompt:"ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ê±°ë‚˜ ìƒëµí•©ë‹ˆë‹¤.",options:a},i=t?.itemOfferId,l=t?.itemSource??"BATTLE";nn(e,s,{kind:"BATTLE_REWARD",offers:o,itemOfferId:i,itemSource:l,cardDecision:void 0,itemDecision:void 0})}function pi(e){if(!e.run.lastBattleWasElite||e.run.eliteRelicOfferedThisBattle)return;const t=na(e,1);if(!t)return;e.run.eliteRelicOfferedThisBattle=!0;const n=t.choices[0];if(!n)return;const r=n.id,o=pe[r],a=!!o?.unlock,s=a?o?.dormantName??o?.name??r:o?.name??r,i=a?[o?.dormantText,o?.unlockHint].filter(Boolean).join(`
 
`):o?.text??"",c={kind:"REWARD",title:"ì •ì˜ˆ ë³´ìƒ: ìœ ë¬¼",prompt:"ìœ ë¬¼ì„ ë°›ê±°ë‚˜ ìƒëµí•©ë‹ˆë‹¤.",options:[{key:"take",label:"ë°›ê¸°",detail:`${s}

${i}`},{key:"skip",label:"ìƒëµ",detail:""}]};c.art=o?.art??void 0,nn(e,c,{kind:"ELITE_RELIC",offerIds:[r]})}function fi(e,t){if(!e.choice)return!1;{const r=e.choiceCtx;if(r?.kind==="BATTLE_REWARD"||r?.kind==="BATTLE_CARD_REWARD"){const o=String(r.itemOfferId??"");if(t==="take_item")return!o||r.itemDecision||!ir(e,o,String(r.itemSource??"BATTLE"))||(r.itemDecision="TAKEN",r.cardDecision&&Oe(e)),!0;if(t==="skip_item")return!o||r.itemDecision||(f(e,"ì•„ì´í…œ ë³´ìƒì„ ìƒëµí–ˆìŠµë‹ˆë‹¤."),r.itemDecision="SKIPPED",r.cardDecision&&Oe(e)),!0}}if(t==="take"){const r=e.choiceCtx;if(r?.kind==="ELITE_RELIC"){const o=r.offerIds?.[0];return o?(e.run.relics??=[],e.run.relics.includes(o)||Jt(e,o),f(e,`ìœ ë¬¼ íšë“: ${pe[o]?.name??o}`),Oe(e),!0):!1}if(r?.kind==="ITEM_REWARD"){const o=String(r.offerId??"");return o?(ir(e,o,String(r.source??"BATTLE"))&&Oe(e),!0):!1}return!1}if(t==="skip"){const r=e.choiceCtx,o=r?.kind==="BATTLE_REWARD"||r?.kind==="BATTLE_CARD_REWARD",a=String(r?.itemOfferId??"");return o&&a?(r.cardDecision||(f(e,"ì¹´ë“œ ë³´ìƒì„ ìƒëµí–ˆìŠµë‹ˆë‹¤."),r.cardDecision="SKIPPED",r.itemDecision&&Oe(e)),!0):(f(e,"ë³´ìƒì„ ìƒëµí–ˆìŠµë‹ˆë‹¤."),Oe(e),!0)}if(t.startsWith("pick:")){const r=t.split(":"),o=r[1]??"",a=Number(r[2]??0);if(!o)return!1;const s=e.choiceCtx,i=s?.kind==="BATTLE_REWARD"||s?.kind==="BATTLE_CARD_REWARD",l=String(s?.itemOfferId??"");return i&&l?(s.cardDecision||(Ve(e,o,{upgrade:Number.isFinite(a)?a:0}),f(e,"ì¹´ë“œ íšë“: "+o+(a>0?" +"+a:"")),s.cardDecision=t,s.itemDecision&&Oe(e)),!0):(Ve(e,o,{upgrade:Number.isFinite(a)?a:0}),f(e,"ì¹´ë“œ íšë“: "+o+(a>0?" +"+a:"")),Oe(e),!0)}if(t.startsWith("up:")){const r=t.slice(3);if(!r)return!1;const o=e.cards[r];if(!o)return!1;const s=e.content.cardsById[o.defId]?.upgrades??[],i=o.upgrade??0;if(i>=s.length)return f(e,"ì´ë¯¸ ìµœëŒ€ ê°•í™”ì…ë‹ˆë‹¤."),Oe(e),!0;o.upgrade=i+1;const l=xe(e.content,o.defId,o.upgrade);return f(e,`ì¹´ë“œ ê°•í™”: ${tt(e,l.name,o.upgrade)}`),Oe(e),!0}if(t.startsWith("remove:")){const r=t.slice(7);return!r||!Qt(e,r)?!1:(Oe(e),!0)}if(t.startsWith("relic:")){const r=t.slice(6);if(!r)return!1;const o=e.choiceCtx?.offerIds;return o&&o.length>0&&!o.includes(r)?!1:(e.run.relics??=[],e.run.relics.includes(r)||Jt(e,r),f(e,`ìœ ë¬¼ íšë“: ${pe[r]?.name??r}`),Oe(e),!0)}if(t.startsWith("slot:")){if(e.choiceCtx?.kind!=="BOSS_SLOT_UPGRADE")return!1;const o=t.slice(5),a=e.run;return a.slotCapFront=Math.max(3,Math.min(4,Math.floor(Number(a.slotCapFront??3)))),a.slotCapBack=Math.max(3,Math.min(4,Math.floor(Number(a.slotCapBack??3)))),o==="front"?(a.slotCapFront<4&&(a.slotCapFront+=1),a.bossSlotFirstPick="front",q(e,"INFO","ë³´ìŠ¤ ë³´ìƒ: ì „ì—´ ìŠ¬ë¡¯ +1",2e3),f(e,"ë³´ìŠ¤ ë³´ìƒ: ì „ì—´ ìŠ¬ë¡¯ +1"),Oe(e),!0):o==="back"?(a.slotCapBack<4&&(a.slotCapBack+=1),a.bossSlotFirstPick="back",q(e,"INFO","ë³´ìŠ¤ ë³´ìƒ: í›„ì—´ ìŠ¬ë¡¯ +1",2e3),f(e,"ë³´ìŠ¤ ë³´ìƒ: í›„ì—´ ìŠ¬ë¡¯ +1"),Oe(e),!0):!1}return!1}function hi(e,t){const n=na(e,t.count);if(!n||n.choices.length===0)return null;const r=n.choices.map(s=>s.id),o=n.choices.map(s=>{const i=pe[s.id],l=!!i?.unlock,c=l?i?.dormantName??i?.name??s.id:i?.name??s.id,d=l?[i?.dormantText,i?.unlockHint].filter(Boolean).join(`
 
`):i?.text??"";return{key:`relic:${s.id}`,label:c,detail:`${c}

${d}`}}),a={kind:"REWARD",title:t.title,prompt:t.prompt,options:o};{const s=String(t.artKeyOrPath),i=s.includes("/")||s.includes("\\")||s.includes(".")?s:`assets/ui/${s}.png`;a.art=i}return nn(e,a,{kind:"RELIC_OFFER",offerIds:r,source:t.source}),r}function mi(e){const t=e.run,n=Math.max(3,Math.min(4,Math.floor(Number(t.slotCapFront??3)))),r=Math.max(3,Math.min(4,Math.floor(Number(t.slotCapBack??3))));if(n>=4&&r>=4)return;const a={kind:"REWARD",title:"ë³´ìŠ¤ ë³´ìƒ: ì§„í˜• í™•ì¥",prompt:"ì „ì—´ ë˜ëŠ” í›„ì—´ ìŠ¬ë¡¯ì„ 1ì¹¸ í™•ì¥í•©ë‹ˆë‹¤.",options:[{key:"slot:front",label:"ì „ì—´ ìŠ¬ë¡¯ +1",detail:"ì „ì—´ ìŠ¬ë¡¯ì´ 1ì¹¸ ì¦ê°€í•©ë‹ˆë‹¤. (ìµœëŒ€ 4) ì „ì—´ì€ ìœ ì§€ë¹„(S)ë¥¼ ì†Œëª¨í•©ë‹ˆë‹¤."},{key:"slot:back",label:"í›„ì—´ ìŠ¬ë¡¯ +1",detail:"í›„ì—´ ìŠ¬ë¡¯ì´ 1ì¹¸ ì¦ê°€í•©ë‹ˆë‹¤. (ìµœëŒ€ 4) í›„ì—´ì€ êµë€(disrupt)ì˜ ì˜í–¥ì„ ë°›ìŠµë‹ˆë‹¤."}]};a.art="assets/ui/choice/slot_pick.png",nn(e,a,{kind:"BOSS_SLOT_UPGRADE"})}function bi(e){return hi(e,{count:3,title:"ë³´ìŠ¤ ë³´ìƒ: ìœ ë¬¼",prompt:"ìœ ë¬¼ 1ê°œë¥¼ ì„ íƒí•©ë‹ˆë‹¤.",source:"BOSS",artKeyOrPath:"what_to_do"})}const Kn=(e,t)=>e+Math.floor(Math.random()*(t-e+1)),yi=e=>{switch(e){case"SPECIAL":return 20;case"RARE":return 30;default:return 10}};function ki(e,t){const n=e.run;n.shops??={};const r=n.shops[t];if(r)return r;const o=ft.filter(p=>(p.weight??0)>0).map(p=>p.id).filter(p=>!!e.content.cardsById[p]),a={COMMON:[],SPECIAL:[],RARE:[]};for(const p of o){const y=e.content.cardsById[p],k=String(y?.rarity??"");k==="COMMON"?a.COMMON.push(p):k==="SPECIAL"?a.SPECIAL.push(p):k==="RARE"&&a.RARE.push(p)}const s=[],i=new Set,l=o.slice(),c=(p,y)=>{const k=p.filter(x=>!i.has(x));for(let x=k.length-1;x>0;x--){const N=Math.floor(Math.random()*(x+1)),W=k[x];k[x]=k[N],k[N]=W}const T=Math.min(y,k.length);for(let x=0;x<T;x++){const N=k[x];i.add(N),s.push(N)}let C=y-T;for(;C>0;){if(p.length>0){const x=p[Math.floor(Math.random()*p.length)];if(x){s.push(x),C-=1;continue}}if(l.length>0){const x=l[Math.floor(Math.random()*l.length)];if(x){s.push(x),C-=1;continue}}break}};c(a.COMMON,2),c(a.SPECIAL,2),c(a.RARE,2);const d=s.map(p=>{const k=e.content.cardsById[p]?.rarity??"COMMON",T=Math.max(1,yi(k)+Kn(-2,2));return{defId:p,upgrade:0,priceGold:T,sold:!1}}),h=(()=>{const p=Gt.map(C=>C.id),y=2,k=[];let T=0;for(;k.length<y&&T++<80&&p.length>0;){const C=p[Math.floor(Math.random()*p.length)];C&&(k.includes(C)&&Math.random()<.85||k.push(C))}return k.map(C=>{const x=We(C),N=Number(x?.priceGold??18)||18,W=Math.max(1,N+Kn(-2,2));return{itemId:C,priceGold:W,sold:!1}})})(),m=(()=>{const p=new Set(e.run.relics??[]),y=Object.keys(pe).filter(x=>{if(p.has(x)||pa(x))return!1;const N=pe[x];return!(!N||N.debugOnly)});if(y.length<=0)return[];const k=[],T=Math.min(2,y.length);let C=0;for(;k.length<T&&C++<80;){const x=y[Math.floor(Math.random()*y.length)];!x||k.includes(x)||k.push(x)}return k.map(x=>({relicId:x,priceGold:60+Kn(-10,10),sold:!1}))})(),u={nodeId:t,cards:d,items:h,relics:m,usedUpgrade:!1,usedRemove:!1,createdAtMove:Number(e.run.timeMove??0)||0,art:"assets/ui/background/shop_bg.png"};return n.shops[t]=u,u}function ie(e,t){const n=ki(e,t);ue(e)==="first_human"&&!n._firstHumanShopToastShown&&(n._firstHumanShopToastShown=!0,q(e,"WARN",Q.first_human.shop,2200),f(e,Q.first_human.shop)),ye(e,"card_dealer")&&!n._cardDealerHostileShopToastShown&&(n._cardDealerHostileShopToastShown=!0,q(e,"WARN",Q.card_dealer.hostileShop,2200),f(e,Q.card_dealer.hostileShop));const r=[];let o=0;for(let h=0;h<n.cards.length;h++){const m=n.cards[h],p=e.content.cardsById[m.defId]?.name??m.defId;if(m.sold){r.push({key:`shop:card:${h}`,label:`${tt(e,p,m.upgrade??0)} (í’ˆì ˆ)`,detail:""});continue}const y=He(e,m.priceGold),k=xe(e.content,m.defId,m.upgrade??0),T=Ae(e,k.frontText,k.backText),C=`ê°€ê²©: ğŸª™${y}

  ì „ì—´: ${T.frontText}
  í›„ì—´: ${T.backText}`;r.push({key:`shop:card:${h}`,label:`${tt(e,p,m.upgrade??0)} (ğŸª™${y})`,detail:C})}if(r.push({key:`shop:sep:${o++}`,label:"â€”",detail:""}),n.items&&n.items.length>0){for(let h=0;h<n.items.length;h++){const m=n.items[h],u=We(m.itemId),p=u?.name??m.itemId;if(m.sold){r.push({key:`shop:item:${h}`,label:`${p} (í’ˆì ˆ)`,detail:""});continue}const y=He(e,m.priceGold),k=`ê°€ê²©: ğŸª™${y}

${u?.text??""}`;r.push({key:`shop:item:${h}`,label:`${p} (ğŸª™${y})`,detail:k})}r.push({key:`shop:sep:${o++}`,label:"â€”",detail:""})}if(n.relics&&n.relics.length>0){for(let h=0;h<n.relics.length;h++){const m=n.relics[h],u=pe[m.relicId],p=u?.name??m.relicId;if(m.sold){r.push({key:`shop:relic:${h}`,label:`${p} (í’ˆì ˆ)`,detail:""});continue}const y=He(e,m.priceGold),k=`ê°€ê²©: ğŸª™${y}

${u?.text??""}`;r.push({key:`shop:relic:${h}`,label:`${p} (ğŸª™${y})`,detail:k})}r.push({key:`shop:sep:${o++}`,label:"â€”",detail:""})}const a=n.usedUpgrade?"ì¹´ë“œ ê°•í™” (ì‚¬ìš© ì™„ë£Œ)":"ì¹´ë“œ ê°•í™”",s=n.usedRemove?"ì¹´ë“œ ì œê±° (ì‚¬ìš© ì™„ë£Œ)":"ì¹´ë“œ ì œê±°",i=He(e,25),l=He(e,25),c=He(e,6);r.push({key:"shop:service:upgrade",label:a,detail:n.usedUpgrade?"":`ê°€ê²©: ğŸª™${i} ì¹´ë“œ 1ì¥ì„ ê°•í™”í•©ë‹ˆë‹¤.`}),r.push({key:"shop:service:remove",label:s,detail:n.usedRemove?"":`ê°€ê²©: ğŸª™${l} ë±ì—ì„œ ì¹´ë“œ 1ì¥ì„ ì œê±°í•©ë‹ˆë‹¤.`}),r.push({key:"shop:supply:buy",label:"ë³´ê¸‰ êµ¬ë§¤",detail:`-ğŸª™${c}, ë‹¤ìŒ ì „íˆ¬ ë³´ê¸‰ ğŸ +3`}),r.push({key:"shop:supply:sell",label:"ë³´ê¸‰ íŒë§¤",detail:"ë‹¤ìŒ ì „íˆ¬ ë³´ê¸‰ ğŸ -3, +ğŸª™4"}),r.push({key:"shop:leave",label:"ë‚˜ê°€ê¸°",detail:""});{const h=new Set,m=[];for(const u of r)h.has(u.key)&&m.push(u.key),h.add(u.key);m.length&&f(e,`ê²½ê³ : ìƒì  ì„ íƒí‚¤ ì¤‘ë³µ: ${m.join(", ")}`)}const d={kind:"EVENT",title:"ê³ ë¸”ë¦°ì˜ ìƒì ",prompt:"ì˜¨ê±´íŒŒ ê³ ë¸”ë¦°ì˜ ìƒì ì…ë‹ˆë‹¤.",options:r};n.art&&(d.art=n.art),e.choiceQueue=[],e.choiceStack=[],e.choice=d,e.choiceCtx={kind:"SHOP",nodeId:t},n.art&&(d.art=n.art)}function Ti(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}function vi(e){const t=e._flipAllCombatOriginal;if(t){for(const[n,r]of Object.entries(t)){const o=e.cards[n];o&&(r===void 0?delete o.flipped:o.flipped=r)}delete e._flipAllCombatOriginal}}function xi(e){const t=[];for(const s of e.deck)t.push(s);for(const s of e.hand)t.push(s);for(const s of e.discard)t.push(s);for(const s of e.frontSlots)s&&t.push(s);for(const s of e.backSlots)s&&t.push(s);for(const s of e.exhausted)t.push(s);const n=new Set;let r=t.filter(s=>n.has(s)?!1:(n.add(s),!0));const o=r.filter(s=>{const i=e.cards[s];return i?!!e.content.cardsById[i.defId]?.tags?.includes("TOKEN"):!1});if(o.length>0){const s=new Set(o);r=r.filter(i=>!s.has(i));for(const i of o)delete e.cards[i]}const a=r.filter(s=>e.cards[s]?.zone!=="vanished");e.deck=a;for(const s of a)e.cards[s].zone="deck";e.hand=[],e.discard=[],e.frontSlots=[null,null,null],e.backSlots=[null,null,null],e.selectedHandCardUid=null,e.exhausted=[],e.pendingTarget=null,e.pendingTargetQueue=[],Ti(e.deck)}function Ci(e){if(!e.winHooksAppliedThisCombat){e.winHooksAppliedThisCombat=!0;for(const t of e.backUidsThisTurn){if(!e.cards[t])continue;const o=Ce(e,t).onWinWhileInBack;!o||o.length===0||Ee({game:e,side:"back",cardUid:t},o)}}}function Rt(e){if(e.player.hp<=0){Jr(e),e.run.finished=!0,f(e,"íŒ¨ë°°: ì£½ì—ˆìŠµë‹ˆë‹¤.");return}if(!e.victoryResolvedThisCombat&&le(e).length===0&&e.phase!=="NODE"){e.victoryResolvedThisCombat=!0;const t=!!e.run.lastBattleWasBoss;Jr(e),Ci(e),f(e,"ì ì„ ëª¨ë‘ ì²˜ì¹˜!"),t&&(e.run.bossOmenText=null);{const o=e.run.map;o&&o.nodes&&o.pos&&o.nodes[o.pos]&&(o.nodes[o.pos].cleared=!0,o.nodes[o.pos].visited=!0)}if(e.run.lastBattleWasElite){const o=Pe(e);o.eliteWins+=1,Re(e)}{const o=e.run,a=Number(o.lastBattleEnemyCount??0)||0;if(!t&&a===3){const s=Pe(e);s.threeEnemyWins+=1,Re(e)}}{const o=e.run,a=Number(o.gold??0)||0,s=Number(o.timeMove??0)+(e.time??0);let l=6+Math.min(3,Math.floor(Math.max(0,s)/15));e.run.lastBattleWasElite&&(l+=10),t&&(l+=30);const c=Number(o.pendingEventWinGold??0)||0;if(c!==0&&(l+=c,o.pendingEventWinGold=0),ye(e,"card_dealer")&&(l=0,o.pendingEventWinGold=0),l!==0&&(o.gold=a+l,f(e,`ì „íˆ¬ ë³´ìƒ: ğŸª™${l}`),q(e,"GOLD",`ğŸª™ +${l}`,1600)),ue(e)==="card_dealer"&&Math.random()<.5){const d=Number(o.gold??0)||0,h=Math.min(10,d);o.gold=d-h,q(e,"WARN",Q.card_dealer.victoryFee,1800),f(e,Q.card_dealer.victoryFee),h>0&&q(e,"GOLD",`ğŸª™ -${h}`,1600),f(e,`ì¹´ë“œ ë”œëŸ¬: ìˆ˜ìˆ˜ë£Œ ğŸª™ -${h}`)}ue(e)==="nameless_vow"&&Math.random()<.2&&(Ve(e,"debt_paper",{upgrade:0}),q(e,"WARN",Q.nameless_vow.victoryDebt,1800),f(e,"ë¬´ëª…ì˜ ì„œì•½: ì „íˆ¬ í›„ ë¹š ë¬¸ì„œ 1ì¥ ì¶”ê°€ (20%)"))}vi(e),xi(e),e.enemies=[],e.player.zeroSupplyTurns=0;{const o=e.run,a=o.pendingEventWinRelicId;a&&(o.pendingEventWinRelicId=null,Jt(e,a,"EVENT"))}if(an(e,"onVictory"),t){e.run.ominousProphecyLockedUntilBossKill=!1,e.run.ominousProphecySeen=!1,e.player.hp=e.player.maxHp,f(e,"ë³´ìŠ¤ ê²©íŒŒ! ì²´ë ¥ì´ ì™„ì „íˆ íšŒë³µë˜ì—ˆìŠµë‹ˆë‹¤.");{const o=e.run;o.slotCapFront=Math.max(3,Math.min(4,Math.floor(Number(o.slotCapFront??3)))),o.slotCapBack=Math.max(3,Math.min(4,Math.floor(Number(o.slotCapBack??3)))),o.bossKillCount=(Number(o.bossKillCount??0)||0)+1;const a=Number(o.bossKillCount)||0;a===1?mi(e):a===2&&(String(o.bossSlotFirstPick??"")==="front"?(o.slotCapBack<4&&(o.slotCapBack+=1),q(e,"INFO","ë³´ìŠ¤ ë³´ìƒ: í›„ì—´ ìŠ¬ë¡¯ +1",2e3),f(e,"ë³´ìŠ¤ ë³´ìƒ: í›„ì—´ ìŠ¬ë¡¯ +1")):(o.slotCapFront<4&&(o.slotCapFront+=1),q(e,"INFO","ë³´ìŠ¤ ë³´ìƒ: ì „ì—´ ìŠ¬ë¡¯ +1",2e3),f(e,"ë³´ìŠ¤ ë³´ìƒ: ì „ì—´ ìŠ¬ë¡¯ +1")))}bi(e)}pi(e);const n=t?"BOSS":e.run.lastBattleWasElite?"ELITE":"BATTLE",r=nl(e,{elite:!!e.run.lastBattleWasElite,boss:!!t});ra(e,{itemOfferId:r??void 0,itemSource:n}),e.phase="NODE";return}}function oa(e){return e.deck.length+e.hand.length+e.discard.length+e.frontSlots.filter(Boolean).length+e.backSlots.filter(Boolean).length+e.exhausted.length}function wi(e){const t=Number(e);return Number.isFinite(t)?Math.max(3,Math.min(4,Math.floor(t))):3}function sr(e,t){const n=e.run;return wi(t==="front"?n.slotCapFront:n.slotCapBack)}function _i(e){return Math.max(sr(e,"front"),sr(e,"back"))}function aa(e,t){return t!==1?!1:le(e).some(n=>n.id==="living_chain")}function sa(e){const t=e?.passives??[];let n=0;for(const r of t){const o=String(r?.id??""),a=/^ramp_atk_(\d+)$/.exec(o);if(!a)continue;const s=Math.max(0,Number(a[1])||0);s>n&&(n=s)}return n}function Si(e){const t=_i(e);e.frontSlots=Array.from({length:t},()=>null),e.backSlots=Array.from({length:t},()=>null),e.backSlotDisabled=Array.from({length:t},()=>!1)}function ia(e){for(const t of Object.values(e.cards))t&&delete t.flipped;delete e._flipAllCombatOriginal}function Ht(e){ia(e),e.combatTurn=1,e.time=(e.time??0)+1,f(e,"ì „íˆ¬: ì‹œê°„ +1"),e.installAgeByUid={},e._passiveGainedThisTurn={},e.player.block=0,e.player.status.vuln=0,e.player.status.weak=0,e.player.status.bleed=0,e.player.status.disrupt=0,e.player.status.slash=0,e.player.zeroSupplyTurns=0,e.phase="REVEAL",Si(e),e.backUidsThisTurn=[],e.hand=[],e.selectedHandCardUid=null,e.pendingTarget=null,e.pendingTargetQueue=[],e.usedThisTurn=0,e._placedUidsThisTurn=[],e._placedSideThisTurn={};for(const r of e.enemies){const o=e.content.enemiesById[r.id];sa(o)>0&&(r.atkRamp=0)}e.frontPlacedThisTurn=0,e._gainedBlockThisTurn=!1,e._indifferentHostileWarnedThisTurn=!1,e._indifferentPatronPenaltyAppliedThisCombat=!1,e._indifferentHostilePenaltyAppliedThisCombat=0,e._rabbitHuntBlockToastShownThisCombat=!1,e.winHooksAppliedThisCombat=!1,e.victoryResolvedThisCombat=!1,e.run.eliteRelicOfferedThisBattle=!1,e.run.itemOfferedThisBattle=!1;const t=e.run.nextBattleSuppliesBonus??0,n=Qo(e);if(e.player.supplies=Math.max(0,7+t+n),t!==0&&(f(e,`ë‹¤ìŒ ì „íˆ¬ S ë³€ë™: ${t}`),e.run.nextBattleSuppliesBonus=0),n!==0){const r=`${n>=0?"+":""}${n}`;f(e,`í›„ì› íš¨ê³¼: ì‹œì‘ ë³´ê¸‰ ${r} (í˜„ì¬ ${e.player.supplies})`)}if(ue(e)==="forge_master"){const o=be(e);o.forgeIntroShown||(o.forgeIntroShown=!0,q(e,"INFO",Q.forge_master.firstBattle,2e3),f(e,Q.forge_master.firstBattle))}e.player.immuneToDisruptThisTurn=!1,e.player.nullifyDamageThisTurn=!1,e.player.incomingDamageReductionThisTurn=0,e.intentsRevealedThisTurn=!1,e.disruptIndexThisTurn=null,e.drawCountThisTurn=0,e.attackedEnemyIndicesThisTurn=[],Us(e),Zs(e);{const r=e.run;let o=4;o+=Qs(e);const a=Number(r.nextCombatDrawDelta??0)||0;a!==0&&(o+=a,r.nextCombatDrawDelta=0);const s=Number(r.rabbitHuntDrawBoostBattles??0)||0;s>0&&(o+=1,r.rabbitHuntDrawBoostBattles=s-1);const i=Number(r.namelessVowDrawBoostBattles??0)||0;i>0&&(o+=2,r.namelessVowDrawBoostBattles=i-1),o=Math.max(0,o);const l=[],c=d=>{const h=d==="deck"?e.deck:e.discard;for(const m of h)Ce(e,m).tags?.includes("INNATE")&&l.push(m)};if(c("deck"),c("discard"),l.length){const d=Array.from(new Set(l));e.deck=e.deck.filter(h=>!d.includes(h)),e.discard=e.discard.filter(h=>!d.includes(h));for(const h of d)e.hand.push(h),e.cards[h].zone="hand";f(e,`ì„ ì²œì„±: ${d.length}ì¥ ì‹œì‘ ì†íŒ¨ì— ë°°ì¹˜`),o=Math.max(0,o-d.length)}gt(e,o)}Mr(e),e.phase="PLACE",an(e,"onCombatStart");{const r=Number(e._combatStartExtraDraw??0);e._combatStartExtraDraw=0,r>0&&gt(e,r)}}function Yr(e,t,n,r){if(e.phase!=="PLACE"||!e.hand.includes(t))return;n==="back"&&(e.backUidsThisTurn.includes(t)||e.backUidsThisTurn.push(t));const o=n==="front"?e.frontSlots:e.backSlots,a=sr(e,n);if(!(r<0||r>=a)&&!(r>=o.length)&&!o[r]){if(n==="front"&&aa(e,r)){f(e,`ì „ì—´ ${r+1}ë²ˆ ì¹¸ì€ ë´‰ì¸ë˜ì–´ ë°°ì¹˜í•  ìˆ˜ ì—†ìŒ`),q(e,"WARN","ì‚´ì•„ìˆëŠ” ì‚¬ìŠ¬: ì „ì—´ 2ë²ˆ ìŠ¬ë¡¯ì€ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",1600);return}e.hand=e.hand.filter(s=>s!==t),o[r]=t,e.cards[t].zone=n,Zt(e,t,n)&&(e.installAgeByUid??={},e.installAgeByUid[t]??=0),e.usedThisTurn+=1,n==="front"&&(e.frontPlacedThisTurn+=1),e.placedUidsThisTurn??=[],e._placedUidsThisTurn??=[],e._placedUidsThisTurn.includes(t)||e._placedUidsThisTurn.push(t),e._placedSideThisTurn??={},e._placedSideThisTurn[t]=n,e.placedUidsThisTurn.includes(t)||e.placedUidsThisTurn.push(t),Js(e),Fi(e,t,n),f(e,`[${Fe(e,t)}]ë¥¼ ${n==="front"?"ì „ì—´":"í›„ì—´"} ${r}ë²ˆì— ë°°ì¹˜`),an(e,"onPlaceCard",{side:n,idx:r,cardUid:t})}}function Xr(e,t,n){return Ce(e,t).tags?.includes(n)??!1}function gi(e,t){e.frontSlots=e.frontSlots.map(r=>r===t?null:r),e.backSlots=e.backSlots.map(r=>r===t?null:r);const n=e.installAgeByUid;n&&t in n&&delete n[t]}function Qr(e,t,n){const r=Ce(e,t);gi(e,t),e.hand=e.hand.filter(l=>l!==t),e.deck=e.deck.filter(l=>l!==t),e.discard=e.discard.filter(l=>l!==t);const o=r.vanishWhen,a=r.exhaustWhen,s=o==="BOTH"||o==="FRONT"&&n==="front"||o==="BACK"&&n==="back",i=a==="BOTH"||a==="FRONT"&&n==="front"||a==="BACK"&&n==="back";if(o&&o!=="NONE"&&s){e.vanished.push(t),e.cards[t].zone="vanished",f(e,`[${Fe(e,t)}] ì†Œì‹¤(ì˜êµ¬ ì œê±°)`);return}if(a&&a!=="NONE"&&i){e.exhausted.push(t),e.cards[t].zone="exhausted",f(e,`[${Fe(e,t)}] ì†Œëª¨(ì´ë²ˆ ì „íˆ¬ì—ì„œ ì œê±°)`),e.run?.faith?.hostile?.retort_fusion&&Me(e,1,"OTHER","ë ˆí† ë¥´íŠ¸ í“¨ì „");return}if(!o&&Xr(e,t,"VANISH")){e.vanished.push(t),e.cards[t].zone="vanished",f(e,`[${Fe(e,t)}] ì†Œì‹¤(ì˜êµ¬ ì œê±°)`);return}if(!a&&Xr(e,t,"EXHAUST")){e.exhausted.push(t),e.cards[t].zone="exhausted",f(e,`[${Fe(e,t)}] ì†Œëª¨(ì´ë²ˆ ì „íˆ¬ì—ì„œ ì œê±°)`),e.run?.faith?.hostile?.retort_fusion&&Me(e,1,"OTHER","ë ˆí† ë¥´íŠ¸ í“¨ì „");return}e.discard.push(t),e.cards[t].zone="discard"}function Zt(e,t,n){const r=Ce(e,t);if(!r.tags?.includes("INSTALL"))return!1;const o=r.vanishWhen,a=r.exhaustWhen,s=o==="BOTH"||o==="FRONT"&&n==="front"||o==="BACK"&&n==="back",i=a==="BOTH"||a==="FRONT"&&n==="front"||a==="BACK"&&n==="back";if(o&&o!=="NONE"&&s||!o&&r.tags?.includes("VANISH")||a&&a!=="NONE"&&i||!a&&r.tags?.includes("EXHAUST"))return!1;const l=r.installWhen;return!l||l==="BOTH"?!0:l==="FRONT"?n==="front":l==="BACK"?n==="back":!1}function Ei(e,t=!1){for(let n=0;n<e.frontSlots.length;n++){const r=e.frontSlots[n];r?!t&&Zt(e,r,"front")||(Qr(e,r,"front"),e.frontSlots[n]=null):e.frontSlots[n]=null;const o=e.backSlots[n];o?!t&&Zt(e,o,"back")||(Qr(e,o,"back"),e.backSlots[n]=null):e.backSlots[n]=null}}function Ni(e){e.installAgeByUid??={};for(let t=0;t<e.frontSlots.length;t++){const n=e.frontSlots[t];n&&Zt(e,n,"front")&&(e.installAgeByUid[n]=(e.installAgeByUid[n]??0)+1);const r=e.backSlots[t];r&&Zt(e,r,"back")&&(e.installAgeByUid[r]=(e.installAgeByUid[r]??0)+1)}}function Ai(e){const t=r=>{switch(r.op){case"damageEnemy":return r.target==="select"?{...r,target:"random"}:r;case"damageEnemyByPlayerFatigue":return r.target==="select"?{...r,target:"random"}:r;case"damageEnemyFormula":return r.target==="select"?{...r,target:"random"}:r;case"statusEnemy":return r.target==="select"?{...r,target:"random"}:r;case"repeat":return{...r,effects:n(r.effects)};case"ifDrewThisTurn":return{...r,then:n(r.then)};case"ifPlacedThisTurn":return{...r,then:n(r.then)};case"ifOtherRowHasDefId":return{...r,then:n(r.then)};case"ifPlaced":return{...r,then:n(r.then)};case"exhaustSlot":return r.then?{...r,then:n(r.then)}:r;default:return r}},n=r=>r.map(t);return n(e)}function Pr(e,t,n){const r=e.cards[t],o=Ce(e,t);return!r?.flipped?n==="front"?o.front:o.back:n==="front"?o.back:o.front}function la(e,t){const n=e.cards[t];n?.synth?.autoFlip&&(n.flipped=!n.flipped,f(e,`í•©ì„±(ë’¤ì§‘ê¸°): [${Fe(e,t)}] ${n.flipped?"ON":"OFF"}`))}function $i(e){if(!(e.phase!=="PLACE"&&e.phase!=="BACK")){e.phase="BACK",f(e,"=== í›„ì—´ ë‹¨ê³„ ===");for(let t=0;t<e.backSlots.length;t++){const n=e.backSlots[t];if(!n)continue;const r=Ce(e,n);if(!e.player.immuneToDisruptThisTurn&&e.backSlotDisabled[t]){f(e,`í›„ì—´ ${t}ë²ˆ [${r.name}] êµë€ìœ¼ë¡œ ë¬´íš¨`);continue}Ee({game:e,side:"back",cardUid:n},Pr(e,n,"back")),la(e,n)}e.phase="FRONT"}}function Mi(e){if(e.phase==="FRONT"){f(e,"=== ì „ì—´ ë‹¨ê³„ ===");for(let t=0;t<e.frontSlots.length;t++){const n=e.frontSlots[t];if(n){if(aa(e,t)){const r=Ce(e,n);f(e,`ì „ì—´ ${t+1}ë²ˆ [${r.name}] ë´‰ì¸ìœ¼ë¡œ ë¬´íš¨`);continue}Ce(e,n),Ee({game:e,side:"front",cardUid:n},Pr(e,n,"front")),la(e,n)}}e.phase="ENEMY"}}function Pi(e){if(e.phase==="ENEMY"){f(e,"=== ì  í–‰ë™ ===");for(const t of le(e)){const n=e.content.enemiesById[t.id],r=n.intents[t.intentIndex%n.intents.length],o=n.special;if(o?.kind==="SOUL_STEALER"){const a=t.special&&t.special.kind==="SOUL_STEALER"?t.special:t.special={kind:"SOUL_STEALER",warnCount:0,armed:!1,willNukeThisTurn:!1};if(a.willNukeThisTurn){const s=t.status.weak??0;Me(e,o.nukeDamage,"ENEMY_ATTACK",t.name,s),f(e,`ì˜í˜¼ ê°•íƒˆì: ì˜í˜¼ í­ë°œ â†’ ${o.nukeDamage} í”¼í•´!`),a.willNukeThisTurn=!1,a.armed=!1,a.warnCount=0;continue}for(const s of r.acts)Zr(e,t,s);t.intentIndex===o.warnIntentIndex&&(a.warnCount=Math.max(0,Number(a.warnCount??0)||0)+1,f(e,`ì˜í˜¼ ê°•íƒˆì: ê²½ê³  +1 (${a.warnCount}/${o.warnCap})`),a.warnCount>=o.warnCap&&(a.armed=!0,f(e,`ì˜í˜¼ ê°•íƒˆì: ê²½ê³  ${o.warnCap}íšŒ ì™„ë£Œ â†’ í­ë°œ ê°€ëŠ¥ ìƒíƒœ!`)));continue}for(const a of r.acts)Zr(e,t,a)}e.phase="UPKEEP"}}function Ri(e){return e.deck.length+e.hand.length+e.discard.length+e.frontSlots.filter(Boolean).length+e.backSlots.filter(Boolean).length+e.exhausted.length}function Bi(e,t){const n=Math.ceil(t/e.div);let r=e.base+e.per*n;return e.cap!=null&&(r=Math.min(r,e.cap)),{dmg:r,scale:n}}function pt(e){const t=Number(e.atkRamp??0)||0;return t>0?t:0}function Zr(e,t,n){switch(n.op){case"damagePlayer":{const r=t.status.weak??0;Me(e,n.n+pt(t),"ENEMY_ATTACK",t.name,r);return}case"damagePlayerFormula":{const r=t.status.weak??0,o=Jo(e,t,n.kind),a=Math.max(1,Number(o.hits??1)||1),s=Math.max(0,Number(o.raw??0)||0),i=pt(t);for(let l=0;l<a;l++)Me(e,s+i,"ENEMY_ATTACK",t.name,r);o.consumeEnemyKey==="assassinAim"&&(t.assassinAim=0);return}case"supplies":{e.player.supplies=Xt(e.player.supplies+n.n,0),f(e,`ì  íš¨ê³¼: ë³´ê¸‰ S ${n.n>=0?"+":""}${n.n} (í˜„ì¬ ${e.player.supplies})`);return}case"statusPlayer":{const r=n.n;Se(e.player,n.key,r,e,"ENEMY");let o=r;n.key==="vuln"&&o>0&&lt(e,"relic_ratskin_charm")&&(o=Math.max(0,o-1)),f(e,`ì  íš¨ê³¼: í”Œë ˆì´ì–´ ìƒíƒœ ${n.key} ${o>=0?"+":""}${o}`);return}case"enemyHealSelf":{t.hp=Math.min(t.maxHp,t.hp+n.n),f(e,`ì (${t.name})ì´(ê°€) ${n.n} íšŒë³µ (HP ${t.hp}/${t.maxHp})`);return}case"enemySetAssassinAim":{t.assassinAim=Math.max(0,Number(t.assassinAim??0)||0)+(Number(n.n??0)||0),f(e,`ì (${t.name})ì´(ê°€) ì¡°ì¤€ ìƒíƒœê°€ ë¨`);return}case"enemyImmuneThisTurn":{t.immuneThisTurn=!0,f(e,`ì (${t.name})ì´(ê°€) í”¼í•´ ë©´ì—­ ìƒíƒœê°€ ë¨`);return}case"enemyImmuneNextTurn":{t.immuneNextTurn=!0,f(e,`ì (${t.name})ì´(ê°€) ë‹¤ìŒ í„´ í”¼í•´ ë©´ì—­ ìƒíƒœê°€ ë¨`);return}case"fatiguePlayer":{e.player.fatigue=Math.max(0,e.player.fatigue+n.n),f(e,`ì  íš¨ê³¼: í”¼ë¡œ F ${n.n>=0?"+":""}${n.n} (í˜„ì¬ ${e.player.fatigue})`);return}case"damagePlayerByDeckSize":{const r=Ri(e),{dmg:o,scale:a}=Bi(n,r),s=t.status.weak??0,i=Me(e,o+pt(t),"ENEMY_ATTACK",t.name,s);f(e,`ì¤‘ë ¥ í”¼í•´(ê³µì‹): base ${n.base} + per ${n.per} * ceil(${r}/${n.div})=${a} => raw ${o}, ì ìš© ${i}`);return}case"damagePlayerRampHits":{const r=Math.max(1,Number(e.combatTurn??1)),o=Math.max(1,Number(n.baseHits??1)),a=Math.max(1,Number(n.everyTurns??1));let s=o+Math.floor((r-1)/a);n.capHits!=null&&(s=Math.min(s,Math.max(1,Number(n.capHits))));const i=t.status.weak??0,l=`${t.name} (${s}íƒ€)`;for(let c=0;c<s;c++)Me(e,n.n+pt(t),"ENEMY_ATTACK",l,i);return}case"damagePlayerIfSuppliesPositive":{if((e.player.supplies??0)>0){const o=t.status.weak??0;Me(e,n.n+pt(t),"ENEMY_ATTACK",t.name,o)}else f(e,"ë®ì¹˜ê¸°: S = 0 â†’ í”¼í•´ ì—†ìŒ");break}case"damagePlayerIfSuppliesZero":{const r=e.player.supplies??0;if(r===0){const o=t.status.weak??0;Me(e,n.n+pt(t),"ENEMY_ATTACK",t.name,o)}else f(e,`ì••ë¥˜: S = ${r} â†’ í”¼í•´ ì—†ìŒ`);break}case"suppliesIfPlayerBackFull":{const r=e.backSlots.filter(Boolean).length,o=3;r>=o?(e.player.supplies=Xt(e.player.supplies+n.n,0),f(e,`ì  íš¨ê³¼: í›„ì—´ ${o}ì¥ ì¡°ê±´ ì¶©ì¡± â†’ ë³´ê¸‰ S ${n.n>=0?"+":""}${n.n} (í˜„ì¬ ${e.player.supplies})`)):f(e,`ì  íš¨ê³¼: í›„ì—´ ${r}/${o}ì¥ â†’ ë³´ê¸‰ ë³€í™” ì—†ìŒ`);return}default:return n}}function Ii(e){if(e.phase!=="UPKEEP")return;if(ei(e),ue(e)==="twin_heart"){const o=e._placedUidsThisTurn??[];if(o.length>0){const a=o[Math.random()*o.length|0],i=String((e._placedSideThisTurn??{})[a]??e.cards[a]?.zone??"")==="front"?"back":"front",l=e.cards[a];if(l){const c=l.zone;l.zone=i,q(e,"INFO","ë‘ ì‹¬ì¥ì´ ê°™ì€ ë°•ìë¥¼ ëƒ…ë‹ˆë‹¤.",1400),f(e,`ìŒë‘¥ì´ ì‹¬ì¥: [${Fe(e,a)}] ë°˜ëŒ€ì—´ íš¨ê³¼ ë°œë™ (${i})`),Ee({game:e,side:i,cardUid:a,sourceLabel:"ìŒë‘¥ì´ ì‹¬ì¥",reason:"OTHER"},Ai(Pr(e,a,i))),l.zone=c}}}f(e,"=== ìœ ì§€ë¹„ / ìƒíƒœ ì²˜ë¦¬ ===");{const r=Pe(e);let o=!1;(e.player.status.weak??0)>0&&(r.endedTurnWeak=(r.endedTurnWeak??0)+1,o=!0),(e.usedThisTurn??0)===0&&(e.frontPlacedThisTurn??0)===0&&(e.backUidsThisTurn?.length??0)===0&&(r.skippedTurn+=1,o=!0),o&&Re(e)}const t=e.frontSlots.filter(Boolean).length;t>0&&f(e,`ì „ì—´ ìœ ì§€ë¹„ ì²˜ë¦¬: ì „ì—´ ${t}ì¥`);{const r=e.player.supplies??0,o=Math.min(r,t);e.player.supplies=r-o;const a=t-o;a>0&&(e.player.fatigue+=a,f(e,`ì „ì—´ ìœ ì§€ë¹„ ë¶€ì¡±! (ë¶€ì¡± ${a} â†’ F +${a})`))}if(e.player.supplies===0){e.player.zeroSupplyTurns+=1;{const o=Pe(e);o.endedTurnSupplyZero=(o.endedTurnSupplyZero??0)+1,Re(e)}const r=e.player.fatigue;Me(e,r,"ZERO_SUPPLY","ë³´ê¸‰ ì—†ì´ í„´ ì¢…ë£Œ! í”¼í•´ "+r)}const n=e.player.status.bleed??0;n>0&&Me(e,n,"BLEED","ì¶œí˜ˆ");for(const r of le(e)){const o=r.status.bleed??0;o>0&&(r.immuneThisTurn?f(e,`ì (${r.name})ì€(ëŠ”) ì´ë²ˆ í„´ ë©´ì—­ì´ë¼ ì¶œí˜ˆ í”¼í•´ ë¬´ì‹œ`):(r.hp=Math.max(0,r.hp-o),f(e,`ì (${r.name}) ì¶œí˜ˆë¡œ HP -${o} (HP ${r.hp}/${r.maxHp})`)))}for(const r of le(e)){const o=e.content.enemiesById[r.id],a=sa(o);a<=0||(r.atkRamp=pt(r)+a,f(e,`ì  íŒ¨ì‹œë¸Œ: ${r.name} ê³µê²©ë ¥ +${a} (ëˆ„ì  +${r.atkRamp})`))}if(e.frontPlacedThisTurn=0,Li(e),Ei(e),Ni(e),wt(e),Rt(e),(e.frontSlots.filter(Boolean).length+e.backSlots.filter(Boolean).length|0)>=3){const o=Pe(e);o.endedTurnWith3Installs+=1,Re(e)}an(e,"onUpkeepEnd"),e.phase="DRAW"}function Li(e){const t=["vuln","weak","bleed","disrupt"];for(const n of t)e.player.status[n]>0&&(e.player.status[n]-=1);for(const n of e.enemies)for(const r of t)n.status[r]>0&&(n.status[r]-=1)}function Oi(e){if(e.phase!=="DRAW"||(e.intentsRevealedThisTurn=!1,e.disruptIndexThisTurn=null,Rt(e),e.run.finished))return;if(le(e).length===0){ca(e),e.phase="NODE";return}const t=e.usedThisTurn;e.usedThisTurn=0,e._placedUidsThisTurn=[],e._placedSideThisTurn={};const n=Number(e._extraDrawNextTurn??0);e._extraDrawNextTurn=0,e._passiveGainedThisTurn={};const r=e.player.block??0;if(gt(e,t+(n>0?n:0)),!Di(e)&&r>0&&(e.player.block=Math.max(0,(e.player.block??0)-r),f(e,"ë°©ì–´(ë¸”ë¡) ì†Œì‹¤")),Mr(e),e.phase="PLACE",e.backUidsThisTurn=[],e.attackedEnemyIndicesThisTurn=[],e.drawCountThisTurn=0,e.combatTurn=(e.combatTurn??0)+1,e._gainedBlockThisTurn=!1,e._indifferentHostileWarnedThisTurn=!1,ue(e)==="armored_tiger"&&(e.combatTurn??0)===2&&(e.player.block=(e.player.block??0)+5,e._gainedBlockThisTurn=!0,f(e,"ì¤‘ê°‘ ì…ì€ í˜¸ë‘ì´: 2í„´ ì‹œì‘ ë°©ì–´ +5")),ue(e)==="twin_heart"){const s=e.player.supplies??0;e.player.supplies=Xt(s-1,0),f(e,`ìŒë‘¥ì´ ì‹¬ì¥: S -1 (S ${s}â†’${e.player.supplies})`)}Ks(e)}function Di(e){for(const t of e.frontSlots){if(!t||!e.cards[t])continue;const o=Ce(e,t)?.passives??[];for(const a of o)if(a?.kind==="retainBlockBetweenTurns"&&a?.side==="front")return!0}return!1}function Hi(e){const t=e._passiveGainedThisTurn??={},n=lt(e,"relic_wrong_dice")?1:0,r=a=>n<=0||a===0?a:a+Math.sign(a)*n,o=(a,s)=>{for(const i of s){if(!i||!e.cards[i])continue;const d=Ce(e,i)?.passives??[];for(let h=0;h<d.length;h++){const m=d[h];if(!m||m.kind!=="onDrawGainBlock"||m.side!==a)continue;const u=Number(m.perTurnCap??0)||0,p=u>0?r(u):0,y=`${i}|${a}|onDrawGainBlock|${h}`,k=Number(t[y]??0)||0;let T=r(Number(m.block??0)||0);if(!(T<=0)){if(p>0){if(k>=p)continue;T=Math.min(T,p-k)}T>0&&(qt(e,T),t[y]=k+T)}}}};o("front",e.frontSlots),o("back",e.backSlots)}function Fi(e,t,n){const o=Ce(e,t)?.passives??[];if(o.length)for(const a of o){if(!a||a.kind!=="onPlaceIncrementUnlockProgress"||a.side&&a.side!==n)continue;const s=String(a.counter??"");if(!s)continue;const i=Number(a.n??1)||1,l=Pe(e);l[s]=(Number(l[s]??0)||0)+i,Re(e)}}function gt(e,t){let n=0;for(let r=0;r<t&&(Wi(e),!e.run.finished);r++){const o=e.deck.pop();if(!o)break;e.hand.push(o),n++,Hi(e)}return f(e,`ë“œë¡œìš° ${n}/${t} (ì†íŒ¨ ${e.hand.length})`),n}function Wi(e){e.deck.length===0&&e.discard.length>0&&(e.deck=Sr(e.discard),e.discard=[],e.player.fatigue+=1,f(e,`í”¼ë¡œë„ F +1 (ì…”í”Œ, í˜„ì¬ ${e.player.fatigue})`))}function ca(e){e.player.block>0&&(e.player.block=0,f(e,"ë°©ì–´(ë¸”ë¡) ì†Œì‹¤")),e.intentsRevealedThisTurn=!1,e.disruptIndexThisTurn=null}function Jr(e){ca(e),ia(e)}function we(e){return e.pendingTarget!=null||(e.pendingTargetQueue?.length??0)>0}function Ui(e,t,n){const r=Number(t.amount??0)|0,o=t.formulaKind;if(!o)return r;const a=le(e).length,s=t.aliveCountSnap,i=Number.isFinite(Number(s))?Number(s):a;return rr({game:e,cardUid:t.sourceCardUid??null},o,n,r,i)}function zi(e,t){if(!e.pendingTarget)return!1;if(le(e).length===0)return e.pendingTarget=null,e.pendingTargetQueue=[],e.selectedEnemyIndex=null,Rt(e),!0;const n=e.enemies[t];if(!n||n.hp<=0)return!1;const r=e.pendingTarget;if(ue(e)==="master_spear"){const o=le(e)[0];if(o&&n!==o)return q(e,"WARN","ë§¨ ì•ì˜ ì ë§Œ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."),f(e,"ë‹¬ì¸ì˜ ì°½: ëŒ€ìƒ ì§€ì •ì€ ì„ ë‘ ì ë§Œ í—ˆìš©"),!1}if(r.kind==="damageSelect"&&e.content.enemiesById[n.id]?.targeting?.forbidTargetedAttackWhenNotLeftmost&&le(e).indexOf(n)+1>1)return q(e,"WARN","ê³µê²© ëŒ€ìƒìœ¼ë¡œ ì§€ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."),f(e,`${n.name}: ê·¸ë¦¼ì ì¥ë§‰ â†’ ëŒ€ìƒ ì§€ì • ê³µê²© ë¬´íš¨ (ì™¼ìª½ì— ì  ì¡´ì¬)`),!1;if(r.kind==="damageSelect"){const o=Ui(e,r,n);Br(e,n,o)}else if(r.kind==="statusSelect"&&(Se(n,r.key,r.n,e,"PLAYER"),r.key==="bleed"&&r.n>0)){const o=Pe(e);o.bleedApplied+=1,Re(e)}return wt(e),Rt(e),le(e).length===0?!0:(Ki(e),!e.pendingTarget&&(e.pendingTargetQueue?.length??0)===0)}function Ki(e){const t=e.pendingTargetQueue??[],n=t.shift()??null;e.pendingTarget=n,e.pendingTargetQueue=t,e.selectedEnemyIndex=null}function ji(e,t,n){const r=e.cards[t];return r?r.zone===n:!1}function Vi(e){const t="_flipAllCombatOriginal";e[t]||(e[t]={});const n=e[t];for(const[r,o]of Object.entries(e.cards))o&&o.zone!=="vanished"&&(n[r]===void 0&&(n[r]=!!o.flipped),o.flipped=!n[r])}function Ft(e,t){if(t!=="select")return t;const n=!!e._waveBreathNoAllThisCombat,r=!!e._waveBreathForceRandomThisCombat,o=Math.max(0,Number(e._waveBreathAllRemainingThisCombat??0)||0);return!n&&o>0?(e._waveBreathAllRemainingThisCombat=o-1,"all"):r?"random":"select"}function cn(e,t,n){const r=e.game,o={kind:"damageSelect",amount:t,formulaKind:n,aliveCountSnap:le(r).length,sourceCardUid:e.cardUid||void 0,sourceLabel:e.sourceLabel,reason:e.reason??(e.side==="front"?"FRONT":"BACK")};r.pendingTargetQueue??=[],r.pendingTarget==null?r.pendingTarget=o:r.pendingTargetQueue.push(o),f(r,`ëŒ€ìƒ ì„ íƒ í•„ìš”: ì ì„ í´ë¦­í•˜ì„¸ìš”. (${1+r.pendingTargetQueue.length}ê°œ ë‚¨ìŒ)`)}function Gi(e,t,n){const r=e.game,o={kind:"statusSelect",key:t,n,sourceCardUid:e.cardUid||void 0,sourceLabel:e.sourceLabel,reason:e.reason??(e.side==="front"?"FRONT":"BACK")};r.pendingTargetQueue??=[],r.pendingTarget==null?r.pendingTarget=o:r.pendingTargetQueue.push(o),f(r,"ëŒ€ìƒ ì„ íƒ í•„ìš”: ì ì„ í´ë¦­í•˜ì„¸ìš”.")}function qi(e,t){if(t.special?.kind==="SOUL_STEALER"&&t.special.willNukeThisTurn)return!0;const n=e.content.enemiesById[t.id];return n.intents[t.intentIndex%n.intents.length].acts.some(o=>o.op==="damagePlayer"||o.op==="damagePlayerFormula"||o.op==="damagePlayerByDeckSize")}function eo(e,t,n=""){for(let r=0;r<e.frontSlots.length;r++)e.frontSlots[r]===t&&(e.frontSlots[r]=null);for(let r=0;r<e.backSlots.length;r++)e.backSlots[r]===t&&(e.backSlots[r]=null);e.hand=e.hand.filter(r=>r!==t),e.deck=e.deck.filter(r=>r!==t),e.discard=e.discard.filter(r=>r!==t),e.exhausted=e.exhausted.filter(r=>r!==t),e.vanished=e.vanished.filter(r=>r!==t),e.exhausted.push(t),e.cards[t].zone="exhausted",f(e,`[${Fe(e,t)}] ì†Œëª¨(ê°•ì œ)${n?" â€” "+n:""}`),e.run?.faith?.hostile?.retort_fusion&&Me(e,1,"OTHER","ë ˆí† ë¥´íŠ¸ í“¨ì „")}function Yi(e,t){const n=t?.excludeUid,r=!!t?.includeSelf;let o=0;const a=[...e.frontSlots,...e.backSlots];for(const s of a){if(!s||!r&&n&&s===n)continue;Ce(e,s)?.tags?.includes("INSTALL")&&(o+=1)}return o}function Xi(e){const t=lt(e,"relic_wrong_dice")?1:0;let n=0;for(const r of e.backSlots){if(!r)continue;const o=e.cards[r];if(!o||o.defId!=="improv_arrow")continue;const a=Ce(e,r),s=Array.isArray(a?.back)?a.back:[];for(const i of s){if(!i||i.op!=="increaseCardDamageByTag"||i.tag!=="ARROW")continue;const l=Number(i.n??0)||0;if(l===0)continue;const c=o?.synth?.overrun?1:0,d=t+c;n+=l+Math.sign(l)*d}}return Math.max(0,n)}function Ee(e,t){const n=e.game,r=n._logSourceCardUid;n._logSourceCardUid=e.cardUid;const o=(()=>{try{const u=Ce(n,e.cardUid);if(!u?.tags?.includes("INSTALL"))return!1;const p=u.installWhen;return!p||p==="BOTH"?!0:p==="FRONT"?e.side==="front":p==="BACK"?e.side==="back":!1}catch{return!1}})(),a=(u,p)=>{const y="_playerDamageFromInstall",k=n[y];n[y]=o;try{Br(n,u,p)}finally{n[y]=k}},i=e.applyNumberBonus!==!1&&lt(n,"relic_wrong_dice")?1:0,l=n.cards[e.cardUid]?.synth?.overrun?1:0,c=i+l,d=u=>c<=0||u===0?u:u+Math.sign(u)*c,h=(()=>{const p=n.cards[e.cardUid]?.defId;if(!p)return 0;const y=n.run,k=Math.max(0,Number(y?.cardDamageBonusByDefId?.[p]??0)||0),T=Ce(n,e.cardUid),C=Array.isArray(T?.tags)?T.tags:[];let x=0;for(const N of C){const W=Math.max(0,Number(y?.cardDamageBonusByTag?.[N]??0)||0);x+=N==="ARROW"?0:W,N==="ARROW"&&(x+=Xi(n))}return k+x})(),m=u=>u<=0||h<=0?u:u+h;try{for(const u of t)switch(u.op){case"block":qt(n,d(u.n));break;case"blockFormula":{const p=Uo({game:n,cardUid:e.cardUid,numBonus:c},u.kind);p>0&&qt(n,p);break}case"supplies":ya(n,d(u.n));break;case"fatigue":yt(n,d(u.n));break;case"heal":kt(n,d(u.n));break;case"hp":n.player.hp=Math.max(0,Math.min(n.player.maxHp,n.player.hp+d(u.n))),f(n,`HP ${d(u.n)>=0?"+":""}${d(u.n)} (í˜„ì¬ ${n.player.hp}/${n.player.maxHp})`);break;case"maxHp":n.player.maxHp+=d(u.n),n.player.hp=Math.min(n.player.maxHp,n.player.hp+d(u.n)),f(n,`ìµœëŒ€ HP +${d(u.n)} (í˜„ì¬ ${n.player.hp}/${n.player.maxHp})`);break;case"setSupplies":n.player.supplies=Math.max(0,d(u.n)),f(n,`ë³´ê¸‰ Së¥¼ ${n.player.supplies}ìœ¼ë¡œ ì„¤ì •`);break;case"setFatigue":n.player.fatigue=Math.max(0,d(u.n)),f(n,`í”¼ë¡œ Fë¥¼ ${n.player.fatigue}ìœ¼ë¡œ ì„¤ì •`);break;case"draw":{const p=gt(n,d(u.n));n.drawCountThisTurn+=p;break}case"discardHandAllDraw":{const p=Number(u.extraDraw??0)||0,y=n.hand.slice();if(y.length>0){n.hand=[];for(const T of y)n.discard.push(T),n.cards[T].zone="discard";f(n,`ì†íŒ¨ ${y.length}ì¥ ë²„ë¦¼`)}else f(n,"ì†íŒ¨ ë²„ë¦¼: 0ì¥");const k=y.length+p;if(k>0){const T=gt(n,k);n.drawCountThisTurn+=T}break}case"discardHandRandom":{let p=d(u.n);if(p=Math.max(0,Math.min(p,n.hand.length)),p<=0){f(n,"ì†íŒ¨ ë¬´ì‘ìœ„ ë²„ë¦¼: 0ì¥");break}const y=n.hand.slice(),k=[];for(let T=0;T<p;T++){const C=me(y),x=y.indexOf(C);x>=0&&y.splice(x,1),k.push(C)}n.hand=n.hand.filter(T=>!k.includes(T));for(const T of k)n.discard.push(T),n.cards[T].zone="discard";f(n,`ì†íŒ¨ ë¬´ì‘ìœ„ ë²„ë¦¼: ${k.length}ì¥`);break}case"discardHandRandomDraw":{let p=d(u.n);if(p=Math.max(0,Math.min(p,n.hand.length)),p<=0){f(n,"ì†íŒ¨ ë¬´ì‘ìœ„ ë²„ë¦¼: 0ì¥");break}const y=n.hand.slice(),k=[];for(let C=0;C<p;C++){const x=me(y),N=y.indexOf(x);N>=0&&y.splice(N,1),k.push(x)}n.hand=n.hand.filter(C=>!k.includes(C));for(const C of k)n.discard.push(C),n.cards[C].zone="discard";f(n,`ì†íŒ¨ ë¬´ì‘ìœ„ ë²„ë¦¼: ${k.length}ì¥`);const T=gt(n,k.length);n.drawCountThisTurn+=T;break}case"ifPlaced":{ji(n,e.cardUid,u.side)&&Ee(e,u.then);break}case"flipAllPlayerCardsUntilCombatEnd":{Vi(n);break}case"pickVanishedToHand":{const p=n.vanished.map(y=>{const k=Ce(n,y),T=Ae(n,k.frontText,k.backText,y);return{key:`pickVanished:${y}`,label:Fe(n,y),detail:`ì „ì—´: ${T.frontText} / í›„ì—´: ${T.backText}`,cardUid:y}});nn(n,{kind:"PICK_CARD",title:u.title??"ì†Œì‹¤ ì¹´ë“œ íšŒìˆ˜",prompt:u.prompt??"ê°€ì ¸ì˜¬ ì†Œì‹¤ ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",options:[...p,{key:"cancel",label:"ì·¨ì†Œ"}]},{kind:"PICK_VANISHED_TO_HAND",sourceCardUid:e.cardUid});break}case"ifDrewThisTurn":{n.drawCountThisTurn>0&&Ee(e,u.then);break}case"ifPlayerSuppliesAtMost":{const p=Math.max(0,d(u.n));n.player.supplies<=p?Ee(e,u.then??[]):Ee(e,u.else??[]);break}case"ifPlayerBlockAtLeast":{const p=Math.max(0,d(u.n));n.player.block>=p&&Ee(e,u.then??[]);break}case"damageEnemy":{const p=Ft(n,u.target),y=m(d(u.n));if(p==="random"){const k=le(n);if(k.length===0)break;a(me(k),y)}else if(p==="all")for(const k of le(n))a(k,y);else cn(e,y);break}case"damageEnemyByPlayerBlock":{const p=Ft(n,u.target),y=Number.isFinite(Number(u.mult))?Number(u.mult):1,k=Math.max(0,Math.floor(n.player.block*y)),T=m(d(k));if(T<=0)break;if(p==="random"){const C=le(n);if(C.length===0)break;a(me(C),T);break}if(p==="all"){for(const C of le(n))a(C,T);break}cn(e,T);break}case"halveEnemyHpAtIndex":{const p=d((u.index??-1)|0),y=n.enemies[p];if(!y||y.hp<=0)break;const k=y.hp,T=Math.max(1,Math.floor(k/(2+c)));if(T>=k)break;y.hp=T,f(n,`ì (${y.name})ì˜ HPë¥¼ ì ˆë°˜ìœ¼ë¡œ: ${k} â†’ ${T}`);break}case"clearStatusSelf":{const p=u.key;n.player.status[p]=0,f(n,`ìƒíƒœ í•´ì œ: ${p} = 0`);break}case"damageEnemyBy":{if(u.target!=="random")break;const p=le(n);if(p.length===0)break;let y=0;u.by==="frontCount"&&(y=n.frontSlots.filter(Boolean).length*d(u.nPer)),a(me(p),y);break}case"damageEnemyByPlayerFatigue":{const p=Ft(n,u.target),y=Math.max(0,Math.floor(n.player.fatigue*d(u.mult)));if(p==="random"){const k=le(n);if(k.length===0)break;a(me(k),y);break}if(p==="all"){if(y<=0)break;for(const k of le(n))a(k,y);break}if(p==="select"){if(y<=0)break;cn(e,y);break}break}case"damageEnemyFormula":{const p=Ft(n,u.target),y={game:n,cardUid:e.cardUid,numBonus:c},k=hs(y,u.kind);if(k<=0)break;if(p==="select"){cn(e,k,u.kind);break}if(p==="random"){const T=le(n);if(T.length===0)break;const C=me(T),x=rr(y,u.kind,C,k,T.length);a(C,x);break}if(p==="all"){const T=le(n),C=T.length;for(const x of T){const N=rr(y,u.kind,x,k,C);a(x,N)}break}break}case"statusPlayer":n.player.status[u.key]=Math.max(0,(n.player.status[u.key]??0)+d(u.n)),f(n,`í”Œë ˆì´ì–´ ìƒíƒœ: ${u.key} ${u.n>=0?"+":""}${u.n}`);break;case"statusEnemy":{const p=Ft(n,u.target);if(p==="random"){const y=le(n);if(y.length===0)break;const k=me(y);if(Se(k,u.key,d(u.n),n,"PLAYER"),f(n,`ì (${k.name}) ìƒíƒœ: ${u.key} ${u.n>=0?"+":""}${u.n}`),u.key==="bleed"&&u.n>0){const T=Pe(n);T.bleedApplied+=1,Re(n)}}else if(p==="all"){const y=le(n);if(y.length===0)break;for(const k of y)Se(k,u.key,d(u.n),n,"PLAYER");if(f(n,`ëª¨ë“  ì  ìƒíƒœ: ${u.key} ${u.n>=0?"+":""}${u.n}`),u.key==="bleed"&&u.n>0){const k=Pe(n);k.bleedApplied+=y.length,Re(n)}}else Gi(e,u.key,d(u.n));break}case"statusEnemiesAttackingThisTurn":{const p=le(n).filter(y=>qi(n,y));if(p.length===0){f(n,`ì´ë²ˆ í„´ ê³µê²© ì˜ë„ ì  ì—†ìŒ â†’ ${u.key} ì ìš© ì—†ìŒ`);break}for(const y of p)y.status[u.key]=Math.max(0,(y.status[u.key]??0)+d(u.n));f(n,`ê³µê²© ì˜ë„ ì ì—ê²Œ ${u.key} ${d(u.n)>=0?"+":""}${d(u.n)} (ëŒ€ìƒ ${p.length})`);break}case"immuneDisruptThisTurn":n.player.immuneToDisruptThisTurn=!0,f(n,"ì´ë²ˆ í„´ êµë€ ë¬´ì‹œ");break;case"nullifyDamageThisTurn":n.player.nullifyDamageThisTurn=!0,f(n,"ì´ë²ˆ í„´ ì  ê³µê²© í”¼í•´ ë¬´íš¨");break;case"reduceIncomingDamageThisTurn":{const p=Math.max(0,d(u.n));if(p<=0)break;n.player.incomingDamageReductionThisTurn=Math.max(0,(n.player.incomingDamageReductionThisTurn??0)+p),f(n,`ì´ë²ˆ í„´ ë°›ëŠ” í”¼í•´ ê°ì†Œ +${p}`);break}case"triggerFrontOfBackSlot":{const p=d((u.index??0)|0),y=n.backSlots[p];if(!y){f(n,`ì¬ë°°ì¹˜: í›„ì—´ ${p+1}ë²ˆ ìŠ¬ë¡¯ì´ ë¹„ì–´ ìˆìŒ`);break}const k=Ce(n,y),C=!!n.cards[y]?.flipped,x=C?k.back:k.front;f(n,`ì¬ë°°ì¹˜: [[${Fe(n,y)}]]ì˜ ì „ì—´ íš¨ê³¼ë¥¼ ì¶”ê°€ ë°œë™${C?"(ë’¤ì§‘í˜)":""}`),Ee({game:n,side:"front",cardUid:y},x);break}case"addCardToHand":{const p=u.defId,y=n.content.cardsById[p];if(!y){f(n,`WARN: addCardToHand unknown defId: ${p}`);break}const k=Math.max(1,d(Number(u.n??1)|0)),T=Math.max(0,Number(u.upgrade??0)|0);for(let C=0;C<k;C++){n.uidSeq+=1;const x=String(n.uidSeq);n.cards[x]={uid:x,defId:p,zone:"hand",upgrade:T},n.hand.push(x)}f(n,`ì†íŒ¨ì— [${y.name}${T>0?" +"+T:""}] ${k}ì¥ ì¶”ê°€`);break}case"repeat":{const p=Math.max(0,d((u.times??0)|0));for(let y=0;y<p;y++)Ee(e,u.effects??[]);break}case"repeatByOtherInstall":{const p=Yi(n,{excludeUid:e.cardUid,includeSelf:!!u.includeSelf});for(let y=0;y<p;y++)Ee(e,u.effects??[]);break}case"ifPlacedThisTurn":{(n.placedUidsThisTurn??[]).includes(e.cardUid)&&Ee(e,u.then??[]);break}case"ifOtherRowHasDefId":{const p=String(u.defId??"");(e.side==="front"?n.backSlots:n.frontSlots).some(T=>T?n.cards[T]?.defId===p:!1)&&Ee(e,u.then??[]);break}case"triggerRandomVanished":{const p=Math.max(0,d((u.times??0)|0)),y=(n.vanished??[]).filter(k=>k&&k!==e.cardUid);if(y.length===0){f(n,"ì†Œì‹¤ëœ ì¹´ë“œê°€ ì—†ì–´ ë°œë™ ì—†ìŒ");break}for(let k=0;k<p;k++){const T=me(y,"triggerRandomVanished"),C=Ce(n,T);f(n,`ì†Œì‹¤ëœ ì¹´ë“œ ë°œë™: [[${Fe(n,T)}]] (${u.side==="front"?"ì „ì—´":"í›„ì—´"})`),Ee({game:n,side:u.side,cardUid:T},u.side==="front"?C.front:C.back)}break}case"exhaustSlot":{const p=u.side,y=d((u.index??-1)|0),k=p==="front"?n.frontSlots:n.backSlots,T=k[y];if(!T){f(n,`ì†Œëª¨ ì‹¤íŒ¨: ${p}${y+1}ë²ˆ ìŠ¬ë¡¯ì´ ë¹„ì–´ ìˆìŒ`);break}eo(n,T,`${p}${y+1} ìŠ¬ë¡¯`),k[y]=null,u.then&&Ee(e,u.then);break}case"exhaustRelativeSlotByCurrentPosition":{const p=ps(n,e.cardUid);if(!p){f(n,`ìƒëŒ€ ìŠ¬ë¡¯ ì†Œëª¨ ì‹¤íŒ¨: í˜„ì¬ ìœ„ì¹˜ë¥¼ ì°¾ì§€ ëª»í•¨ (${e.cardUid})`);break}const y=p.side==="front"?Number(u.frontOffset??0)||0:Number(u.backOffset??0)||0,k=p.index+y,T=p.side==="front"?n.frontSlots:n.backSlots;if(k<0||k>=T.length){f(n,`ì†Œëª¨ ì‹¤íŒ¨: ${p.side}${k+1}ë²ˆ ìŠ¬ë¡¯ ë²”ìœ„ë¥¼ ë²—ì–´ë‚¨`);break}const C=T[k];if(!C){f(n,`ì†Œëª¨ ì‹¤íŒ¨: ${p.side}${k+1}ë²ˆ ìŠ¬ë¡¯ì´ ë¹„ì–´ ìˆìŒ`);break}eo(n,C,`${p.side}${k+1} ìŠ¬ë¡¯`),T[k]=null,u.then&&u.then.length>0&&Ee({...e,applyNumberBonus:!1},u.then);break}case"flipSelf":{const p=n.cards[e.cardUid];p&&(p.flipped=!p.flipped,f(n,`ë’¤ì§‘ìŒ: [[${Fe(n,e.cardUid)}]] (${p.flipped?"ON":"OFF"})`));break}case"blockByPlayerBlock":{const p=Number.isFinite(Number(u.mult))?Number(u.mult):1,y=Math.max(0,d(Math.floor(n.player.block*p)));y>0&&qt(n,y);break}case"damageEnemyLowestHp":{const p=le(n);if(p.length===0)break;let y=1/0;for(const C of p)y=Math.min(y,C.hp);const k=p.filter(C=>C.hp===y),T=me(k,"damageEnemyLowestHp");a(T,Math.max(0,d(u.n??0)));break}case"damageEnemyRepeatByStatus":{const y=1+Math.max(0,n.player.status[u.key]??0),k=le(n);if(k.length===0)break;const T=Math.max(0,d(u.n??0));for(let C=0;C<y;C++)a(me(k),T);u.reset&&(n.player.status[u.key]=c,f(n,`ìƒíƒœ ì†Œëª¨: ${String(u.key)} = ${c}`));break}case"repeatBySupplies":{const p=Number.isFinite(Number(u.timesBase))?Number(u.timesBase)|0:1,y=Math.max(0,Number(n.player.supplies??0)||0),k=Math.max(0,y+d(p));for(let T=0;T<k;T++)Ee(e,u.effects??[]);u.reset&&(n.player.supplies=c,f(n,`ë³´ê¸‰ Së¥¼ ${c}ìœ¼ë¡œ ì„¤ì •`));break}case"increaseCardDamageByDefId":{const p=String(u.defId??"");if(!p)break;const y=n.run;y.cardDamageBonusByDefId??={};const k=d(u.n);y.cardDamageBonusByDefId[p]=Math.max(0,Number(y.cardDamageBonusByDefId[p]??0)+k),f(n,`[${p}] ê³µê²©ë ¥ +${k} (ëˆ„ì  ${y.cardDamageBonusByDefId[p]})`);break}case"increaseCardDamageByTag":{const p=u.tag;if(!p)break;if(n.cards[e.cardUid]?.defId==="improv_arrow"&&p==="ARROW"){const C=d(u.n);f(n,`[íƒœê·¸:${p}] ê³µê²©ë ¥ +${C} (ê¸‰ì¡°ëœ í™”ì‚´ì´ í›„ì—´ì— ìˆëŠ” ë™ì•ˆ ìœ ì§€)`);break}const k=n.run;k.cardDamageBonusByTag??={};const T=d(u.n);k.cardDamageBonusByTag[p]=Math.max(0,Number(k.cardDamageBonusByTag[p]??0)+T),f(n,`[íƒœê·¸:${p}] ê³µê²©ë ¥ +${T} (ëˆ„ì  ${k.cardDamageBonusByTag[p]})`);break}default:return u}}finally{n._logSourceCardUid=r}}const da=2;function Tt(e){const t=e.run;t.items||(t.items=[]),t.itemCap==null&&(t.itemCap=da)}function Qi(e){return Tt(e),e.run.items??[]}function Ln(e){Tt(e);const t=Number(e.run.itemCap);return Number.isFinite(t)?Math.max(0,Math.floor(t)):da}function Zi(e,t,n=""){Tt(e);const r=Math.max(0,Math.floor(Number(t)||0));e.run.itemCap=r,f(e,`ì•„ì´í…œ ë³´ìœ  í•œë„${n?`(${n})`:""}: ${r}`)}function Ji(e,t,n=""){const r=Ln(e);Zi(e,r+(Number(t)||0),n)}function to(e){return Qi(e).length>=Ln(e)}function ir(e,t,n=""){Tt(e);const r=We(t);if(!r)return f(e,`ì•„ì´í…œ íšë“ ì‹¤íŒ¨(ì •ì˜ ì—†ìŒ): ${t}`),!1;const o=Ln(e),a=e.run.items;return a.length>=o?(f(e,`ì•„ì´í…œ íšë“ ì‹¤íŒ¨(ê°€ë°© ê°€ë“ ì°¸ ${a.length}/${o}): ${r.name}`),q(e,"WARN",`ì•„ì´í…œ ê°€ë°©ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤. (${a.length}/${o})`,1600),!1):(a.push(t),f(e,`ì•„ì´í…œ íšë“${n?`(${n})`:""}: ${r.name}`),q(e,"INFO",`${r.name} íšë“`,1600),!0)}function ua(e,t){Tt(e);const n=e.run.items;if(!Array.isArray(n)||t<0||t>=n.length)return null;const[r]=n.splice(t,1);return r??null}function el(e,t,n=""){Tt(e);const r=e.run.items;if(!Array.isArray(r)||r.length===0||t<0||t>=r.length)return!1;const o=String(r[t]),a=We(o);ua(e,t);const s=e.run.unlock??={};return s.itemDiscards=Math.max(0,Number(s.itemDiscards??0)+1),f(e,`ì•„ì´í…œ ë²„ë¦¼${n?`(${n})`:""}: ${a?.name??o}`),q(e,"WARN",`${a?.name??o} ë²„ë¦¼`,1400),!0}function tl(e,t){Tt(e);const n=e.run.items;if(!Array.isArray(n)||n.length===0||t<0||t>=n.length)return!1;if(!(e.enemies.length>0&&e.phase!=="NODE"))return q(e,"WARN","ì „íˆ¬ ì¤‘ì—ë§Œ ì•„ì´í…œì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",1400),!1;const o=n[t],a=We(o);return a?(Ee({game:e,side:"front",cardUid:"",sourceLabel:`ì•„ì´í…œ: ${a.name}`,reason:"OTHER",applyNumberBonus:!1},a.effects??[]),ua(e,t)&&(f(e,`ì•„ì´í…œ ì‚¬ìš©: ${a.name} (ì†Œëª¨)`),q(e,"INFO",`${a.name} ì‚¬ìš©`,1400)),!0):(q(e,"WARN",`ì•„ì´í…œ ì •ì˜ ì—†ìŒ: ${o}`,1400),!1)}function nl(e,t){const n=e.run;if(n.itemOfferedThisBattle||t.boss)return null;const r=t.elite?.4:.3;if(Math.random()>=r)return null;const o=us();return o?(n.itemOfferedThisBattle=!0,o):null}function rl(){return Object.keys(pe).sort((e,t)=>e.localeCompare(t))}const ol=[{id:"relic_ratskin_charm",name:"ì¥ê°€ì£½ ë¶€ì ",text:"ì·¨ì•½ì„ ë°›ì„ ë•Œ 1 ëœ ë°›ìŒ",unlockFlavor:"ì‚´ê°€ì£½. ì–‡ê²Œ, ì•„ì£¼ ì–‡ê²Œ.",tags:["EVENT_ONLY"],art:"assets/relics/relic_ratskin_charm.png"},{id:"relic_wrong_dice",name:"ì˜ëª»ëœ ì£¼ì‚¬ìœ„",text:"ì¹´ë“œì— ì íŒ ëª¨ë“  ìˆ˜ê°€ 1 ì¦ê°€",unlockFlavor:"ëˆˆê¸ˆì´ í•˜ë‚˜ì”© ì–´ê¸‹ë‚˜ ìˆë‹¤.",tags:["EVENT_ONLY"],art:"assets/relics/relic_wrong_dice.png"}],pe={relic_unknown_square:{id:"relic_unknown_square",dormantName:"ì –ì€ ì‚¬ê°í˜•",dormantText:"ê³°íŒ¡ì´ì¼ê¹Œ? ë¨¹ì„ ìˆ˜ ìˆì„ê¹Œ?",unlockHint:"ì¡°ê±´: íœ´ì‹ 1íšŒ",art:"assets/relics/relic_unknown_square.png",unlock:(e,t)=>(e.run.unlock?.rest??0)>=(t.unlock?.rest??0)+1,name:"ë¨¹ì„ ìˆ˜ ìˆëŠ” ì‚¬ê°í˜•",text:"ì „íˆ¬ ì‹œì‘ ì‹œ ğŸ S +2",unlockFlavor:"ë¨¹ì„ ìˆ˜ëŠ” ìˆë‹¤. ì¼ë‹¨ì€.",onCombatStart(e){e.player.supplies+=2,f(e,"ìœ ë¬¼[ë¨¹ì„ ìˆ˜ ìˆëŠ” ì‚¬ê°í˜•]: ğŸ S +2")}},relic_wrong_dice:{id:"relic_wrong_dice",name:"ì˜ëª»ëœ ì£¼ì‚¬ìœ„",text:"ì¹´ë“œì— ì íŒ ëª¨ë“  ìˆ˜ê°€ 1 ì¦ê°€",unlockFlavor:"ëˆˆê¸ˆì´ í•˜ë‚˜ì”© ì–´ê¸‹ë‚˜ ìˆë‹¤.",tags:["EVENT_ONLY"],art:"assets/relics/relic_wrong_dice.png"},relic_monster_leather_helm:{id:"relic_monster_leather_helm",dormantName:"ë“¤ëŸ¬ë¶™ëŠ” ê°€ì£½",dormantText:"í„¸ê³¼ í”¼ê°€ ë’¤ì„ì¸ ê°€ì£½ì´ ì†ì— ë“¤ëŸ¬ë¶™ëŠ”ë‹¤.",unlockHint:"ì¡°ê±´: ì—˜ë¦¬íŠ¸ ì „íˆ¬ ìŠ¹ë¦¬ 1íšŒ",art:"assets/relics/relic_monster_leather_helm.png",unlock:(e,t)=>(e.run.unlock?.eliteWins??0)>=(t.unlock?.eliteWins??0)+1,name:"ëª¬ìŠ¤í„° ê°€ì£½ íˆ¬êµ¬",text:"ì²« í„´ì— ğŸ›¡ï¸ ë°©ì–´ +4",unlockFlavor:"ë¨¸ë¦¬ì— ë“¤ëŸ¬ë¶™ì–´ ë–¨ì–´ì§€ì§€ ì•Šì§€ë§Œ ë‹¹ì¥ì˜ ë¬¸ì œëŠ” ì•„ë‹ˆë‹¤.",onCombatStart(e){e.player.block+=4,f(e,"ìœ ë¬¼[ëª¬ìŠ¤í„° ê°€ì£½ íˆ¬êµ¬]: ğŸ›¡ï¸ ë°©ì–´ +4")}},relic_smoke_bomb:{id:"relic_smoke_bomb",dormantName:"ì†ì´ ë¹„ì–´ ìˆëŠ” íƒ„í™˜",dormantText:"í”ë“¤ë©´ ì‘ì€ ì•Œê°±ì´ê°€ êµ´ëŸ¬ë‹¤ë‹Œë‹¤. ì—°ê¸°ê°€ ì¡°ê¸ˆì”© ìƒŒë‹¤.",unlockHint:"ì¡°ê±´: í•œ ë²ˆì— 10 ì´ìƒì˜ ğŸ—¡ï¸ í”¼í•´ 1íšŒ ë°›ê¸°",art:"assets/relics/relic_smoke_bomb.png",unlock:(e,t)=>(e.run.unlock?.tookBigHit10??0)>=t.unlock.tookBigHit10+1,name:"ì—°ë§‰íƒ„",text:"í™œì„±í™” ì‹œ ì—°ë§‰ ì¹´ë“œ(ì†Œì‹¤) 1ì¥ íšë“",unlockFlavor:"ë¹„ìƒ íƒˆì¶œ!",onActivate(e){const t="smoke";e.uidSeq+=1;const n=String(e.uidSeq);e.cards[n]={uid:n,defId:t,zone:"deck",upgrade:0},e.deck.push(n),f(e,"ìœ ë¬¼[ì—°ë§‰íƒ„]: ì—°ë§‰ ì¹´ë“œ 1ì¥ íšë“")}},relic_bone_compass:{id:"relic_bone_compass",dormantName:"ê¸¸ì„ ìƒëŠ” ë°”ëŠ˜",dormantText:"ë°©í–¥ì„ ê°€ë¦¬í‚¤ì§€ ëª»í•˜ëŠ” ë°”ëŠ˜ì´ ì£¼ë¨¸ë‹ˆ ë°”ê¹¥ìœ¼ë¡œ ë‚˜ì˜¨ë‹¤.",unlockHint:"ì¡°ê±´: íƒí—˜ 5íšŒ",art:"assets/relics/relic_bone_compass.png",unlock:(e,t)=>{const n=e.run;return(Number(n.timeMove??e.run?.nodePickCount??0)||0)>=t.moves+5},name:"ë¼ˆê°€ ë§Œë“  ë‚˜ì¹¨ë°˜",text:"ì „íˆ¬ ì‹œì‘ ì‹œ ğŸƒ ë“œë¡œìš° +1",unlockFlavor:"ì–´ë””ë¥¼ ê°€ë¦¬í‚¤ëŠ” ê²ƒì´ì§€?",onCombatStart(e){e._combatStartExtraDraw=(e._combatStartExtraDraw??0)+1,f(e,"ìœ ë¬¼[ë¼ˆê°€ ë§Œë“  ë‚˜ì¹¨ë°˜]: ì „íˆ¬ ì‹œì‘ ğŸƒ ë“œë¡œìš° +1")}},relic_flesh_whetstone:{id:"relic_flesh_whetstone",dormantName:"ì´ê°€ ë¹ ì§„ ì¹¼ë‚ ",dormantText:"ì–´ë””ì— ì“°ë¼ê³  ìˆëŠ”ì§€ ëª¨ë¥´ê² ë‹¤.",unlockHint:"ì¡°ê±´: ì  ì²˜ì¹˜ 3íšŒ",art:"assets/relics/relic_flesh_whetstone.png",unlock:(e,t)=>(e.run.unlock?.kills??0)>=t.unlock.kills+3,name:"ì†ì‚´ì„ ì°¾ëŠ” ìˆ«ëŒ",text:"ì „íˆ¬ì—ì„œ ì²« ê³µê²©ì´ ì£¼ëŠ” ğŸ—¡ï¸ í”¼í•´ +3",unlockFlavor:"ë°¤ë§ˆë‹¤ ë¬´ì–¸ê°€ ê°ˆê³  ìˆë‹¤.",onCombatStart(e){e._firstPlayerAttackDoneThisCombat=!1},modifyDamage(e,t){if(t.phase!=="PRE_STATUS")return t.current;if(t.target==="ENEMY"&&t.source==="PLAYER_ATTACK"){const n=e;if(!n._firstPlayerAttackDoneThisCombat)return n._firstPlayerAttackDoneThisCombat=!0,t.current+3}return t.current}},relic_weak_bell:{id:"relic_weak_bell",dormantName:"ìƒˆê¹Œë§Œ ì¢…",dormantText:"ë§Œì§€ë©´ ì†ëì´ ë¬´ê²ë‹¤. ë‹¹ì¥ì—” ì•„ë¬´ ì¼ë„ ì—†ë‹¤.",unlockHint:"ì¡°ê±´: ğŸ¥€ ì•½í™”ë¥¼ ë°›ì€ ìƒíƒœë¡œ í„´ ì¢…ë£Œ 1íšŒ",art:"assets/relics/relic_weak_bell.png",unlock:(e,t)=>(e.run.unlock?.endedTurnWeak??0)>=t.unlock.endedTurnWeak+1,name:"í—ˆì•½ì˜ ì¢…ì†Œë¦¬",text:"ì „íˆ¬ ì‹œì‘ ì‹œ ëª¨ë“  ì ì—ê²Œ ğŸ¥€ ì•½í™” +2",unlockFlavor:"ì™ ì§€ ë“¤ìœ¼ë©´ ë§ˆìŒì´ í‰ì˜¨í•´ì§„ë‹¤.",onCombatStart(e){const t=le(e);for(const n of t)Se(n,"weak",2,e,"SYSTEM");t.length&&f(e,"ìœ ë¬¼[í—ˆì•½ì˜ ì¢…ì†Œë¦¬]: ëª¨ë“  ì  ì•½í™” +2")}},relic_return_path_memory:{id:"relic_return_path_memory",dormantName:"ì°¢ì–´ì§„ ì§€ë„ ì¡°ê°",dormantText:"ì½ì„ ìˆ˜ ì—†ëŠ” ê¸¸ì´ ê·¸ë ¤ì ¸ ìˆë‹¤. ê°€ë³´ê³  ì‹¶ë‹¤.",unlockHint:"ì¡°ê±´: ì´ë²¤íŠ¸ 2íšŒ ì„ íƒ",art:"assets/relics/relic_return_path_memory.png",unlock:(e,t)=>(e.run.unlock?.eventPicks??0)>=t.unlock.eventPicks+2,name:"ëŒì•„ì˜¨ ê¸¸ì˜ ê¸°ì–µ",text:"ì „íˆ¬ ìŠ¹ë¦¬ ì‹œ HP +3",unlockFlavor:"ì™”ê¸°ì— ê°ˆ ìˆ˜ ì—†ë‹¤.",onVictory(e){kt(e,3),f(e,"ìœ ë¬¼[ëŒì•„ì˜¨ ê¸¸ì˜ ê¸°ì–µ]: ìŠ¹ë¦¬ ì‹œ HP +3")}},relic_wound_vial:{id:"relic_wound_vial",dormantName:"ë°˜ì´ë‚˜ ë‚¨ì€ ë¶‰ì€ ì•¡ì²´",dormantText:"ë§ˆê°œë¥¼ ì—´ì§€ ì•Šì•˜ëŠ”ë°ë„ í”¼ ëƒ„ìƒˆê°€ ë‚œë‹¤.",unlockHint:"ì¡°ê±´: HPê°€ 15 ì´í•˜ë¡œ ë–¨ì–´ì§„ ì  1íšŒ",art:"assets/relics/relic_wound_vial.png",unlock:(e,t)=>(e.run.unlock?.hpLeq15??0)>=t.unlock.hpLeq15+1,name:"ìƒì²˜ë¡œ ê¸°ì–´ê°€ëŠ” ì•½ë³‘",text:"ì „íˆ¬ ì‹œì‘ ì‹œ HP +3",unlockFlavor:"ì”¨ì•—ì´ ìˆì—ˆë‚˜?",onCombatStart(e){kt(e,3),f(e,"ìœ ë¬¼[ìƒì²˜ë¡œ ê¸°ì–´ê°€ëŠ” ì•½ë³‘]: ì „íˆ¬ ì‹œì‘ ì‹œ HP +3")}},relic_counting_needle:{id:"relic_counting_needle",dormantName:"ë©ˆì¶˜ ë°”ëŠ˜",dormantText:"ì‹œê³„ì¼ê¹Œ? ì‹œê³„ê°€ ì•„ë‹ê¹Œ? ë‘˜ ë‹¤ ì•„ë‹ˆë‹¤.",unlockHint:"ì¡°ê±´: ì•„ë¬´ í–‰ë™ë„ í•˜ì§€ ì•Šê³  í„´ ì¢…ë£Œ 1íšŒ",art:"assets/relics/relic_counting_needle.png",unlock:(e,t)=>(e.run.unlock?.skippedTurn??0)>=t.unlock.skippedTurn+1,name:"ìˆ¨ì„ ì„¸ëŠ” ë°”ëŠ˜",text:"í„´ ì¢…ë£Œ ì‹œ ë‹¤ìŒ í„´ ğŸƒ ë“œë¡œìš° +1",unlockFlavor:"ë°”ëŠ˜ì´ ëˆë‹¤. ì•„ë¬´ê²ƒë„ ì—†ì´.",onUpkeepEnd(e){e._extraDrawNextTurn=Number(e._extraDrawNextTurn??0)+1,f(e,"ìœ ë¬¼[ìˆ¨ì„ ì„¸ëŠ” ë°”ëŠ˜]: ë‹¤ìŒ í„´ ğŸƒ ë“œë¡œìš° +1")}},relic_deeper_needle:{id:"relic_deeper_needle",dormantName:"ë¼ˆë¡œ ë§Œë“  ë°”ëŠ˜",dormantText:"ë”°ë”í•¨ì— ìµìˆ™í•œ ì§€ ì˜¤ë˜ë‹¤.",unlockHint:"ì¡°ê±´: ì ì—ê²Œ ğŸ©¸ ì¶œí˜ˆ ë¶€ì—¬ 3íšŒ",art:"assets/relics/relic_deeper_needle.png",unlock:(e,t)=>(e.run.unlock?.bleedApplied??0)>=t.unlock.bleedApplied+3,name:"ë” ê¹Šì€ ë°”ëŠ˜",text:"ğŸ©¸ ì¶œí˜ˆì„ ë¶€ì—¬í•  ë•Œë§ˆë‹¤ +1 ì¶”ê°€",unlockFlavor:"ë°”ëŠ˜ì´ í”¼ë¥¼ ë¨¹ê³  ê¸¸ì–´ì§„ ê²ƒ ê°™ë‹¤.",onCombatStart(e){e._bleedBonusPerApply=1},onVictory(e){delete e._bleedBonusPerApply}},relic_broken_millstone:{id:"relic_broken_millstone",dormantName:"ê¸ˆ ê°„ ë§·ëŒ",dormantText:"ê°ˆê³  ìˆìœ¼ë©´ ì‹œê°„ ê°€ëŠ” ì¤„ ëª¨ë¥´ê² ë‹¤.",unlockHint:"ì¡°ê±´: ì‹œê°„ 10 ì§€ë‚˜ê¸°",art:"assets/relics/relic_broken_millstone.png",unlock:(e,t)=>{const n=e.run,r=Number(n.timeMove??0)||0,o=Number(e.time??0)||0;return r+o>=t.timeTotal+10},name:"ê¹¨ì§„ ë§·ëŒ",text:"ë§¤ í„´ ëª¨ë“  ì ì—ê²Œ ğŸ—¡ï¸ 2 í”¼í•´",unlockFlavor:"ëŒì´ ë‹³ëŠ”ë‹¤. ì ë„ ë‹³ëŠ”ë‹¤.",onUpkeepEnd(e){const t=le(e);if(t?.length){for(const n of t){let r=2;const o=Number(n.block??0);if(o>0){const a=Math.min(o,r);n.block=o-a,r-=a}if(r>0){const a=Number(n.hp??0);n.hp=Math.max(0,a-r)}}f(e,"ìœ ë¬¼[ê¹¨ì§„ ë§·ëŒ]: ëª¨ë“  ì ì—ê²Œ 2 í”¼í•´")}}},relic_torn_pouch:{id:"relic_torn_pouch",dormantName:"ì°¢ì–´ì§„ ì£¼ë¨¸ë‹ˆ",dormantText:"ë¹„ìš°ëŠ” ê²ƒì´ ì±„ìš°ëŠ” ê²ƒ.",unlockHint:"ì¡°ê±´: ì•„ì´í…œ ë²„ë¦¬ê¸° 1íšŒ",art:"assets/relics/relic_torn_pouch.png",name:"ìˆ˜ì„ í•œ ì£¼ë¨¸ë‹ˆ",text:"í™œì„±í™” ì‹œ ì•„ì´í…œ ë³´ìœ  í•œë„ +2",unlockFlavor:"ë¹„ì›Œë‚¸ ìë¦¬ì— ë” ë§ì´ ë“¤ì–´ê°„ë‹¤.",unlock:(e,t)=>(e.run.unlock?.itemDiscards??0)>=(t.unlock?.itemDiscards??0)+1,onActivate(e){Ji(e,2,"ìˆ˜ì„ í•œ ì£¼ë¨¸ë‹ˆ"),f(e,"ìœ ë¬¼[ìˆ˜ì„ í•œ ì£¼ë¨¸ë‹ˆ]: ì•„ì´í…œ ë³´ìœ  í•œë„ +2")}},relic_bloody_spoon:{id:"relic_bloody_spoon",dormantName:"ë¶‰ì€ ìˆŸê°€ë½",dormantText:"ì‡  ëƒ„ìƒˆê°€ ì§„í•˜ë‹¤.",unlockHint:"ì¡°ê±´: ğŸ’¤ F 10 ì´ìƒ",art:"assets/relics/relic_bloody_spoon.png",unlock:(e,t)=>{const n=Number(e.player.fatigue??0)||0,r=Math.max(10,(Number(t.fatigue??0)||0)+1);return n>=r},name:"í”¼ ë¬»ì€ ìˆŸê°€ë½",text:"íšŒë³µëŸ‰ +1",unlockFlavor:"ì´ëŸ°, í”¼ì˜€ë‹¤."},relic_black_ledger_shard:{id:"relic_black_ledger_shard",dormantName:"ê²€ëŒ• ë¬»ì€ ì¢…ì´",dormantText:"ê²€ì€ ì¢…ì´ë‹¤. íƒ€ê³  ë‚¨ì€ ì¡°ê°ì¼ì§€ë„ ëª¨ë¥´ê² ë‹¤.",unlockHint:"ì¡°ê±´: ğŸ S = 0ìœ¼ë¡œ í„´ ì¢…ë£Œ 1íšŒ",art:"assets/relics/relic_black_ledger_shard.png",unlock:(e,t)=>(e.run.unlock?.endedTurnSupplyZero??0)>=t.unlock.endedTurnSupplyZero+1,name:"ê²€ì€ ì¥ë¶€ ì¡°ê°",text:"ğŸ S = 0ìœ¼ë¡œ í„´ì„ ì¢…ë£Œí•˜ë©´, ğŸ S +2, ğŸ’¤ F +1",unlockFlavor:"ì¥ë¶€. ë¬´ì—‡ì˜?",onUpkeepEnd(e){const t=le(e);if(t?.length){for(const n of t){let r=2;const o=Number(n.block??0);if(o>0){const a=Math.min(o,r);n.block=o-a,r-=a}if(r>0){const a=Number(n.hp??0);n.hp=Math.max(0,a-r)}}f(e,"ìœ ë¬¼[ê²€ì€ ì¥ë¶€ ì¡°ê°]: ğŸ S +2, ğŸ’¤ F +1")}}},relic_ink_bottle:{id:"relic_ink_bottle",dormantName:"ê²€ì€ ì‰í¬ ì–¼ë£©",dormantText:"ì†ê°€ë½ ëì´ ê²€ê²Œ ë¬¼ë“ ë‹¤. ì”»ì–´ë„ ì§€ì›Œì§€ì§€ ì•ŠëŠ”ë‹¤.",unlockHint:"ì¡°ê±´: ğŸ S = 0ìœ¼ë¡œ í„´ ì¢…ë£Œ 1íšŒ",art:"assets/relics/relic_ink_bottle.png",unlock:(e,t)=>(e.run.unlock?.endedTurnSupplyZero??0)>=t.unlock.endedTurnSupplyZero+1,name:"ê²€ì€ ì‰í¬ë³‘",text:"ì „íˆ¬ ì‹œì‘ ì‹œ ë‹¬ë¹› ë‘ë£¨ë§ˆë¦¬ 1ì¥ì„ ì†íŒ¨ì— ì¶”ê°€",unlockFlavor:"ê¸€ìëŠ” ë§ˆì¹˜ ë²Œë ˆì²˜ëŸ¼ ê¸°ì–´ë‹¤ë‹Œë‹¤.",onCombatStart(e){const t="token_moon_scroll";e.uidSeq+=1;const n=String(e.uidSeq);e.cards[n]={uid:n,defId:t,zone:"hand",upgrade:0},e.hand.push(n),f(e,"ìœ ë¬¼[ê²€ì€ ì‰í¬ë³‘]: ë‹¬ë¹› ë‘ë£¨ë§ˆë¦¬ +1")}},relic_moon_scroll_chisel:{id:"relic_moon_scroll_chisel",dormantName:"ë‹¬ë¹› ë¶€ìŠ¤ëŸ¬ê¸°",dormantText:"ì°¨ê°€ìš´ ë¹›ì´ ì†ëì— ë¬»ì–´ ìˆë‹¤.",unlockHint:"ì¡°ê±´: ë‹¬ë¹› ë‘ë£¨ë§ˆë¦¬ 3íšŒ ì‚¬ìš©",art:"assets/relics/relic_moon_scroll_chisel.png",unlock:(e,t)=>{const n=e.run.unlock?.moonScrollUses??0,r=t.unlock.moonScrollUses??0;return n>=r+3},name:"ë‹¬ë¹› ê¹ê°œ",text:"ë‹¬ë¹› ë‘ë£¨ë§ˆë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ ë¬´ì‘ìœ„ ğŸ—¡ï¸ í”¼í•´ 3",unlockFlavor:"ë¬¸ì¥ ì‚¬ì´ë¡œ ë¹›ì´ ìƒˆì–´ ë‚˜ì˜¨ë‹¤.",onPlaceCard(e,t){const n=t.cardUid,r=e.cards[n];if(!r||r.defId!=="token_moon_scroll")return;const o=le(e);o.length!==0&&(Br(e,me(o),3),f(e,"ìœ ë¬¼[ë‹¬ë¹› ê¹ê°œ]: ë¬´ì‘ìœ„ ì ì—ê²Œ 3 í”¼í•´"))}},relic_order_whistle:{id:"relic_order_whistle",dormantName:"ë‹³ì•„ë¹ ì§„ í˜¸ë£¨ë¼ê¸°",dormantText:"ë¶ˆë©´ ì†Œë¦¬ê°€ ë‚˜ì§€ ì•ŠëŠ”ë‹¤. ê·¸ë˜ë„ ëª©ì— ê±´ë‹¤.",unlockHint:"ì¡°ê±´: ì ì´ 3ëª…ì¸ ì „íˆ¬ ìŠ¹ë¦¬",art:"assets/relics/relic_order_whistle.png",unlock:(e,t)=>(e.run.unlock?.threeEnemyWins??0)>=t.unlock.threeEnemyWins+1,name:"ëŒ€ì—´ ì •ë¦¬ì˜ í˜¸ë£¨ë¼ê¸°",text:"ì ì´ ì£½ì„ ë•Œë§ˆë‹¤ ğŸ›¡ï¸ ë°©ì–´ +6",unlockFlavor:"í˜¸ë£¨ë¼ê¸° ì†Œë¦¬ëŠ” ëŒ€ì—´ì„ ë‹¤ì‹œ ì„¸ìš´ë‹¤.",onCombatStart(e){e._orderWhistleKillSet=new Set},onDamageApplied(e,t){if(t.target!=="ENEMY")return;const n=t.enemyIndex;if(n==null||n<0)return;const r=e.enemies[n];if(!r||r.hp!==0)return;const o=`${n}:${t.enemyId??"?"}`,a=e._orderWhistleKillSet,s=a instanceof Set?a:new Set;s.has(o)||(s.add(o),e._orderWhistleKillSet=s,qt(e,6),f(e,"ìœ ë¬¼[ëŒ€ì—´ ì •ë¦¬ì˜ í˜¸ë£¨ë¼ê¸°]: ì  ì²˜ì¹˜ â†’ ğŸ›¡ï¸ ë°©ì–´ +6"))}},relic_field_mechanic_glove:{id:"relic_field_mechanic_glove",dormantName:"ê¸°ë¦„ ëƒ„ìƒˆ ë‚˜ëŠ” ì¥ê°‘",dormantText:"ì†ë°”ë‹¥ì— ë‚¡ì€ ê°€ì£½ì´ ë“¤ëŸ¬ë¶™ëŠ”ë‹¤.",unlockHint:"ì¡°ê±´: ì„¤ì¹˜ë¬¼ì´ 3ê°œ ì´ìƒì¸ ì±„ë¡œ í„´ ì¢…ë£Œ",art:"assets/relics/relic_field_mechanic_glove.png",unlock:(e,t)=>(e.run.unlock?.endedTurnWith3Installs??0)>=t.unlock.endedTurnWith3Installs+1,name:"í˜„ì¥ ì •ë¹„ê³µì˜ ì¥ê°‘",text:"í„´ ì¢…ë£Œ ì‹œ ì„¤ì¹˜ë¬¼ì´ ìˆìœ¼ë©´ ğŸ S +1",unlockFlavor:"ì •ë¹„ëŠ” ê³§ ë³´ê¸‰ì´ë‹¤.",onUpkeepEnd(e){(e.frontSlots.filter(Boolean).length+e.backSlots.filter(Boolean).length|0)<=0||(ya(e,1),f(e,"ìœ ë¬¼[í˜„ì¥ ì •ë¹„ê³µì˜ ì¥ê°‘]: í„´ ì¢…ë£Œ ì„¤ì¹˜ë¬¼ ë³´ìœ  â†’ ğŸ S +1"))}},relic_castle_sight:{id:"relic_castle_sight",dormantName:"íë¦° ì¡°ì¤€ê¸°",dormantText:"ë²½ ë„ˆë¨¸ë¥¼ ë³´ë ¤ë©´, ë¨¼ì € ì´ˆì ì„ ë§ì¶°ì•¼ í•œë‹¤.",unlockHint:"ì¡°ê±´: ì„¤ì¹˜ë¬¼ë¡œ ì¤€ í”¼í•´ ë„í•© 15",art:"assets/relics/relic_castle_sight.png",unlock:(e,t)=>(e.run.unlock?.installDamageDealt??0)>=t.unlock.installDamageDealt+15,name:"ì„±ê³½ ì¡°ì¤€ê¸°",text:"ì„¤ì¹˜ë¬¼ì´ ì£¼ëŠ” ğŸ—¡ï¸ í”¼í•´ +1",unlockFlavor:"ê°€ê¹Œìš´ ì ë¶€í„° ì •í™•íˆ.",modifyDamage(e,t){return t.phase!=="PRE_STATUS"||t.target!=="ENEMY"||t.reason!=="INSTALL"?t.current:t.current+1}},relic_ratskin_charm:{id:"relic_ratskin_charm",name:"ì¥ê°€ì£½ ë¶€ì ",text:"ì·¨ì•½ì„ ë°›ì„ ë•Œ 1 ëœ ë°›ìŒ",unlockFlavor:"ì‚´ê°€ì£½. ì–‡ê²Œ, ì•„ì£¼ ì–‡ê²Œ.",tags:["EVENT_ONLY"],art:"assets/relics/relic_ratskin_charm.png"}};function lr(e,t){return Ze(e),(e.run.relics??[]).includes(t)}const al=new Set(ol.map(e=>e.id));function pa(e){return al.has(e)}const sl={rest:0,eliteWins:0,tookBigHit10:0,kills:0,endedTurnWeak:0,eventPicks:0,hpLeq15:0,skippedTurn:0,bleedApplied:0,endedTurnSupplyZero:0,moonScrollUses:0,threeEnemyWins:0,endedTurnWith3Installs:0,installDamageDealt:0,itemDiscards:0};function Ze(e){e.run.relics??=[],e.run.relicRuntime??={},e.run.pendingRelicActivations??=[],e.run.unlock={...sl,...e.run.unlock??{}},e.run.relicUnlocked??={}}function fa(e){return Ze(e),e.run.relicRuntime}function ha(e){return Ze(e),e.run.pendingRelicActivations}function Pe(e){return Ze(e),e.run.unlock}function ma(e){const t=Pe(e),n=Number(e.run.timeMove??e.run.nodePickCount??0)||0,r=(Number(e.run.timeMove??0)||0)+(Number(e.time??0)||0);return{unlock:{...t},moves:n,timeTotal:r,fatigue:Number(e.player?.fatigue??0)||0,supplies:Number(e.player?.supplies??0)||0}}function on(e,t){const n=fa(e);if(n[t])return n[t];const o=!pe[t]?.unlock;return n[t]={active:o,pending:!1,obtainedAtNode:e.run.nodePickCount},n[t]}function lt(e,t){return Ze(e),lr(e,t)?!!on(e,t).active:!1}function il(e,t){const n=e.run;return n.forceLockedRelics?.[t]===!0?!1:!!(n.forceUnlockedRelics?.[t]===!0||e.run.relicUnlocked?.[t]===!0||Array.isArray(n.unlockedRelics)&&n.unlockedRelics.includes(t)||n.unlockProgress?.relics?.[t]===!0||n.unlocks?.relics?.[t]===!0)}function xn(e,t){Ze(e);const n=pe[t],r=n?.name??t,o=n?.text??"",a=n?.art,s=e.run.relicRuntime?.[t]??null,i=!!n?.unlock,l=il(e,t),c=s?.active===!0?"ACTIVE":s?.pending===!0?"PENDING":"DORMANT",d=(()=>{const h=n?.unlockFlavor;if(!h||i&&!l)return"";const m=typeof h=="function"?h(e):h;return m?`

${m}`:""})();if(c==="ACTIVE")return{id:t,state:c,name:r,text:`${o}${d}`,art:a};if(c==="PENDING")return i&&!l?{id:t,state:c,name:r,text:`${o}

(ë‹¤ìŒ ë…¸ë“œë¶€í„° í™œì„±)`,art:a}:{id:t,state:c,name:r,text:`${o}${d}`,art:a};if(i&&!l){const h=n?.dormantName??r,m=[];n?.dormantText&&m.push(n.dormantText),n?.unlockHint&&m.push(n.unlockHint);const u=m.length?m.join(`
 
`):o;return{id:t,state:c,name:h,text:u,art:a}}return{id:t,state:c,name:r,text:`${o}${d}`,art:a}}function Jt(e,t,n="NORMAL"){if(Ze(e),pa(t)&&n!=="EVENT"){const s=pe[t];f(e,`ì´ ìœ ë¬¼ì€ ì´ë²¤íŠ¸ë¡œë§Œ íšë“í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: ${s?.name??t}`);return}e.run.relics.includes(t)||e.run.relics.push(t);const r=pe[t],o=on(e,t);if(!r?.unlock){o.active=!0,o.pending=!1,e.run.relicUnlocked[t]=!0,f(e,`ìœ ë¬¼ íšë“: ${r?.name??t}`),q(e,"RELIC",`ìœ ë¬¼ íšë“: ${r?.name??t}`,2e3);return}o.active=!1,o.unlockBase||(o.unlockBase=ma(e));const a=xn(e,t);f(e,`ìœ ë¬¼ íšë“: ${a.name}`),q(e,"RELIC",`ìœ ë¬¼ íšë“: ${a.name}`,2e3)}function ll(e,t){const n=on(e,t);if(n.active||n.pending)return;n.pending=!0;const r=ha(e);r.includes(t)||r.push(t);const o=pe[t];f(e,`ìœ ë¬¼ ì¡°ê±´ ë‹¬ì„±: ${o?.name??t} (ë‹¤ìŒ ë…¸ë“œë¶€í„° í™œì„±)`)}function Re(e){Ze(e);for(const t of e.run.relics){const n=pe[t];if(!n?.unlock)continue;const r=on(e,t);if(!(r.active||r.pending)){if(!r.unlockBase){r.unlockBase=ma(e);continue}n.unlock(e,r.unlockBase)&&ll(e,t)}}}function fe(e){Ze(e);const t=ha(e);if(!t.length)return;e.run.pendingRelicActivations=[];const n=fa(e);for(const r of t){const o=n[r]??on(e,r);if(!o.pending)continue;o.pending=!1,o.active=!0,o.activatedAtNode=e.run.nodePickCount,e.run.relicUnlocked[r]=!0;const a=pe[r];a?.onActivate?.(e),f(e,`ìœ ë¬¼ í™œì„±í™”: ${a?.name??r}`)}}function cl(e){return Ze(e),e.run.relics??[]}function Rr(e){return cl(e).filter(t=>lt(e,t))}function an(e,t,...n){for(const r of Rr(e)){const o=pe[r];if(!o)continue;const a=o[t];a?.(e,...n)}}function qe(e,t){let n=t.current;for(const r of Rr(e)){const a=pe[r]?.modifyDamage;if(!a)continue;const s=a(e,{...t,current:n});n=Number.isFinite(s)?s:n,n<0&&(n=0)}return n}function ba(e,t,n){for(const r of Rr(e))pe[r]?.onDamageApplied?.(e,t,n)}function ya(e,t){e.player.supplies=Xt(e.player.supplies+t,0),f(e,`ë³´ê¸‰ S ${t>=0?"+":""}${t} (í˜„ì¬ ${e.player.supplies})`)}function yt(e,t){e.player.fatigue=Xt(e.player.fatigue+t,0),f(e,`í”¼ë¡œ F ${t>=0?"+":""}${t} (í˜„ì¬ ${e.player.fatigue})`)}function kt(e,t){if(t<=0)return;let n=t;lt(e,"relic_bloody_spoon")&&n>0&&(n+=1,f(e,"í”¼ ë¬»ì€ ìˆŸê°€ë½, ì¶”ê°€ íšŒë³µ +1"));const r=e.player.hp;e.player.hp=Math.min(e.player.maxHp,e.player.hp+n),f(e,`HP +${e.player.hp-r} (í˜„ì¬ ${e.player.hp}/${e.player.maxHp})`)}function wt(e){le(e).length===0&&(e.pendingTarget=null,e.pendingTargetQueue=[],e.selectedEnemyIndex=null)}function Br(e,t,n){if(n<=0)return;const r=!!e._playerDamageFromInstall,o=e.enemies.indexOf(t);if(o<0){f(e,`WARN: applyDamageToEnemy target not in g.enemies (${t?.id??"?"})`);return}if(e.attackedEnemyIndicesThisTurn.includes(o)||e.attackedEnemyIndicesThisTurn.push(o),t.immuneThisTurn){f(e,`ì (${t.name})ì€(ëŠ”) ì´ë²ˆ í„´ í”¼í•´ ë©´ì—­ â†’ ${n} í”¼í•´ ë¬´ì‹œ`),wt(e);return}{let p=0;const y=lt(e,"relic_wrong_dice")?1:0,k=C=>y<=0||C===0?C:C+Math.sign(C)*y,T=(C,x)=>{for(const N of x){if(!N||!e.cards[N])continue;const U=Ce(e,N)?.passives??[];for(const V of U)!V||V.kind!=="bonusDamageToEnemyIndex"||V.side===C&&k(Number(V.enemyIndex??-1)|0)===o&&(p+=k(Number(V.bonus??0)||0))}};T("front",e.frontSlots),T("back",e.backSlots),p>0&&(n+=p)}if(ue(e)==="master_spear"){const p=le(e)[0];if(p&&e.enemies.indexOf(p)===o){const y=Math.floor(n*.25);y>0&&(n+=y)}}let a={target:"ENEMY",source:"PLAYER_ATTACK",raw:n,reason:r?"INSTALL":void 0,enemyIndex:o,enemyId:t.id};const s=qe(e,{...a,phase:"PRE_STATUS",current:n,targetVuln:t.status.vuln??0,attackerWeak:e.player.status.weak??0}),i=e.player.status.weak??0,l=t.status.vuln??0,c=Math.max(0,s-i+l),d=qe(e,{...a,phase:"POST_STATUS",current:c,afterStatus:c,targetVuln:l,attackerWeak:i}),h=qe(e,{...a,phase:"FINAL",current:d,afterStatus:d,targetVuln:l,attackerWeak:i}),m=`ì‹: ${n}(ê¸°ë³¸) â†’ ${s}(ì‚¬ì „ë³´ì •) â†’ max(0, ${s} - ${i}(ì•½í™”) + ${l}(ì·¨ì•½)) = ${c} â†’ ${d}(ìƒíƒœí›„) â†’ ${h}(ìµœì¢…)`;if(h<=0){f(e,`ì (${t.name})ì—ê²Œ í”¼í•´ 0 (ìœ ë¬¼/ìƒíƒœë¡œ ìƒì‡„). ${m}`),wt(e);return}const u=t.hp;if(t.hp=Math.max(0,t.hp-h),f(e,`ì (${t.name})ì—ê²Œ ${h} í”¼í•´. ${m}. (HP ${t.hp}/${t.maxHp})`),r&&h>0){const p=Pe(e);p.installDamageDealt+=h,Re(e)}if(u>0&&t.hp===0){const p=Pe(e);p.kills+=1,Re(e)}if(u>0&&t.hp===0)for(const p of le(e))!p||p.hp<=0||p.id==="old_monster_corpse"&&(p.corpseRage=Math.max(0,Number(p.corpseRage??0)||0)+1,f(e,`ì (${p.name}) íŒ¨ì‹œë¸Œ: ì©ì€ ë¶„ë…¸ +1 (í˜„ì¬ ${p.corpseRage})`));ba(e,{...a,phase:"FINAL",current:h,afterStatus:h,targetVuln:l,attackerWeak:i},h),wt(e),le(e).length===0&&(wt(e),Rt(e))}function Me(e,t,n,r,o){if(n==="ENEMY_ATTACK"&&e.player.nullifyDamageThisTurn)return f(e,`ì  ê³µê²© í”¼í•´ ë¬´íš¨ (${r??n})`),0;if(t<=0)return 0;const s={target:"PLAYER",source:n==="ENEMY_ATTACK"?"ENEMY_ATTACK":n==="FATIGUE"?"FATIGUE":"OTHER",raw:t,reason:r},i=qe(e,{...s,phase:"PRE_STATUS",current:t,attackerWeak:o,targetVuln:e.player.status.vuln??0}),l=Math.max(0,Number(e.player.incomingDamageReductionThisTurn??0)||0),c=Math.max(0,i-l);let d=c,h=`ì‹: ${t}(ê¸°ë³¸) â†’ ${i}(ë³´ì •) â†’ max(0, ${i} - ${l}(ë°›ì€ í”¼í•´ ê°ì†Œ)) = ${c} â†’ ${c}(ìµœì¢…)`;if(n==="ENEMY_ATTACK"){const m=o??0,u=e.player.status.vuln??0,p=Math.max(0,c-m+u),y=qe(e,{...s,phase:"POST_STATUS",current:p,afterStatus:p,attackerWeak:m,targetVuln:u}),k=qe(e,{...s,phase:"PRE_BLOCK",current:y,afterStatus:y,attackerWeak:m,targetVuln:u});let T=k,C=0;e.player.block>0&&(C=Math.min(e.player.block,k),e.player.block-=C,T=k-C);const x=qe(e,{...s,phase:"POST_BLOCK",current:T,afterStatus:y,afterBlock:T,attackerWeak:m,targetVuln:u});d=qe(e,{...s,phase:"FINAL",current:x}),h=`ì‹: ${t}(ê¸°ë³¸) â†’ ${i}(ë³´ì •) â†’ max(0, ${i} - ${l}(ë°›ì€ í”¼í•´ ê°ì†Œ)) = ${c} â†’ max(0, ${c} - ${m}(ì•½í™”) + ${u}(ì·¨ì•½)) = ${p} â†’ ${y}(ìƒíƒœí›„) â†’ ${k}(ë°©ì–´ì „) - ${C}(ë°©ì–´) = ${T} â†’ ${x}(ë°©ì–´í›„) â†’ ${d}(ìµœì¢…)`}else{const m=qe(e,{...s,phase:"POST_STATUS",current:c,afterStatus:c});d=qe(e,{...s,phase:"FINAL",current:m}),h=`ì‹: ${t}(ê¸°ë³¸) â†’ ${i}(ë³´ì •) â†’ max(0, ${i} - ${l}(ë°›ì€ í”¼í•´ ê°ì†Œ)) = ${c} â†’ ${m}(ìƒíƒœí›„) â†’ ${d}(ìµœì¢…)`}if(d<=0)return 0;e.player.hp=Math.max(0,e.player.hp-d),f(e,`í”Œë ˆì´ì–´ ${d} í”¼í•´ (${r??n}). ${h}. (HP ${e.player.hp}/${e.player.maxHp})`);{const m=Pe(e);let u=!1;d>=10&&(m.tookBigHit10+=1,u=!0),e.player.hp<=15&&(m.hpLeq15+=1,u=!0),u&&Re(e)}return ba(e,{...s,phase:"FINAL",current:d},d),d}const dl=new Set(["goblin_ambush_low_supplies","rat_circle","tilted_dice_table"]);function ka(e,t){if(e.length<=1)return e[0];if(!t)return e[Math.floor(Math.random()*e.length)];const n=e.filter(o=>o.id!==t),r=n.length>0?n:e;return r[Math.floor(Math.random()*r.length)]}function ul(e){const t=e.run,n=t.eventsSeen??{},r=cr.filter(s=>dl.has(s.id)?(Number(n[s.id]??0)||0)<=0:!0),o=r.length>0?r:cr,a=t.lastEventId??null;return ka(o,a)}function jn(e){const{tier:t}=Ho(e),n=t===0?0:t===1?.25:t===2?.55:.85;return Math.random()<n?fl(e):ul(e)}const Ta={boss_cursed_wall:"ì›€ì§ì´ì§€ ì•ŠëŠ”ë‹¤. ë‹¹ì‹ ì´ ë‹³ì•„ê°„ë‹¤.",boss_giant_orc:"ê±°ëŒ€í•œ ë¬´ì–¸ê°€ê°€ ê¸°ë‹¤ë¦°ë‹¤.",boss_soul_stealer:"í–‰ë™í•˜ì§€ ì•Šìœ¼ë©´ ì¢…ë§ì´ ì˜¨ë‹¤.",boss_gravity_master:"ëª¸ì´ ì ì  ë¬´ê²ë‹¤. ëª¸ì„ ê°€ë³ê²Œ í•˜ë¼."},pl=[{id:"mad_mirror",name:"ê±°ìš¸ì— ì ê¸´ ë¬¼",prompt:"ë¬¼ ì†ì˜ ë‹¹ì‹ ì´ ë¨¼ì € ì›ƒìŠµë‹ˆë‹¤.",art:"assets/events/event_mad_mirror.png",options:e=>[{key:"mad_mirror:take",label:"ì†ì„ ë„£ëŠ”ë‹¤",detail:"ì¹´ë“œ ë³´ìƒ. ğŸ’¤ F +2.",apply:t=>(yt(t,2),f(t,"ê±°ìš¸: ë¬´ì–¸ê°€ë¥¼ ê±´ì ¸ ì˜¬ë ¸ë‹¤. (ğŸ’¤ F +2)"),"REWARD")},{key:"mad_mirror:leave",label:"ì™¸ë©´í•œë‹¤",apply:t=>(f(t,"ê±°ìš¸: ë‹¹ì‹ ì€ ë¬¼ëŸ¬ë‚¬ë‹¤."),"NONE")}]},{id:"mad_contract",name:"ì –ì€ ê³„ì•½ì„œ",prompt:"ê³°íŒ¡ì´ ëƒ„ìƒˆê°€ ë‚©ë‹ˆë‹¤.",art:"assets/events/event_mad_contract.png",options:e=>[{key:"mad_contract:sign",label:"ì„œëª…í•œë‹¤",detail:"ìµœëŒ€ HP +2. ì¹´ë“œ 1ì¥ ì œê±° í›„ ë³´ìƒ.",apply:t=>(t.player.maxHp+=2,t.player.hp=Math.min(t.player.maxHp,t.player.hp+2),f(t,"ê³„ì•½: ìµœëŒ€ HP +2"),{kind:"REMOVE_PICK",title:"ëŒ€ê°€",prompt:"ì œê±°í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",then:"REWARD"})},{key:"mad_contract:burn",label:"ì°¢ì–´ë²„ë¦°ë‹¤",detail:"ğŸ’¤ F +1",apply:t=>(yt(t,1),f(t,"ë¶ˆê¸¸í•¨: ğŸ’¤ F +1"),"NONE")}]},{id:"mad_lullaby",name:"ìì¥ê°€",prompt:"ì ë“¤ë©´ íšŒë³µí•˜ì§€ë§Œ, ê¹¨ì–´ë‚˜ë©´ ìŠìŠµë‹ˆë‹¤.",art:"assets/events/event_mad_lullaby.png",options:e=>[{key:"mad_lullaby:sleep",label:"ì ë“ ë‹¤",detail:"HP +12. ë±ì—ì„œ ë¬´ì‘ìœ„ 1ì¥ ì†Œì‹¤.",apply:t=>(kt(t,12),Nr(t),f(t,"ìì¥ê°€: HP íšŒë³µ, ê·¸ëŸ¬ë‚˜ ìŠì—ˆë‹¤â€¦ (ë¬´ì‘ìœ„ 1ì¥ ì†Œì‹¤)"),"NONE")},{key:"mad_lullaby:stay",label:"ë²„í‹´ë‹¤",detail:"ğŸ’¤ F -1",apply:t=>(yt(t,-1),f(t,"ë²„íŒ€: ğŸ’¤ F -1"),"NONE")}]}];function fl(e){const n=e.run.lastEventId??null;return ka(pl,n)}const cr=[{id:"drop_bag",name:"ì§ ë²„ë¦¬ê¸°",prompt:"ì§ì„ ì¤„ì—¬ í”¼ë¡œë¥¼ ë‚®ì¶”ì.",art:"assets/events/event_drop_bag.png",options:()=>[{key:"drop",label:"ì¹´ë“œ 1ì¥ ì œê±°, ğŸ’¤ F -1",apply:e=>(yt(e,-1),f(e,"ì´ë²¤íŠ¸: ì§ ë²„ë¦¬ê¸° â†’ ì œê±°í•  ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”."),{kind:"REMOVE_PICK",title:"ì§ ë²„ë¦¬ê¸°",prompt:"ì œê±°í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",then:"NONE"})},{key:"skip",label:"ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠëŠ”ë‹¤",apply:e=>(f(e,"ì´ë²¤íŠ¸: ì§ ë²„ë¦¬ê¸°(ìƒëµ)"),"NONE")}]},{id:"hide_from_monster",name:"ëª¬ìŠ¤í„°ë¡œë¶€í„° ìˆ¨ê¸°",prompt:"ì „íˆ¬í•˜ê±°ë‚˜, ëŒ€ê°€ë¥¼ ì¹˜ë¥´ê³  ìˆ¨ì„ ìˆ˜ ìˆë‹¤.",art:"assets/events/event_hide_from_monster.png",options:()=>[{key:"fight",label:"ì „íˆ¬",apply:e=>(f(e,"ì´ë²¤íŠ¸: ëª¬ìŠ¤í„°ë¡œë¶€í„° ìˆ¨ê¸° â†’ ì „íˆ¬ ì„ íƒ"),"BATTLE")},{key:"remove_and_fatigue",label:"ì¹´ë“œ 1ì¥ ì œê±° í›„ ğŸ’¤ F +1",apply:e=>(yt(e,1),f(e,"ì´ë²¤íŠ¸: ëª¬ìŠ¤í„°ë¡œë¶€í„° ìˆ¨ê¸° â†’ ì¹´ë“œ ì œê±° í›„ ğŸ’¤ F +1"),{kind:"REMOVE_PICK",title:"ìˆ¨ê¸°",prompt:"ì œê±°í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",then:"NONE"})}]},{id:"goblin_ambush_low_supplies",name:"ë§¤ë³µí•œ ì•½íƒˆìë“¤",prompt:"ê³ ë¸”ë¦°ë“¤ì´ ë³´ê¸‰ì„ ì•½íƒˆí–ˆë‹¤.",art:"assets/events/event_goblin_ambush_low_supplies.png",options:()=>[{key:"fight",label:"ë§ì„œ ì‹¸ìš´ë‹¤",detail:`ê³ ë¸”ë¦° ì•½íƒˆì 2ë§ˆë¦¬ ì „íˆ¬ (Sê°€ 5 ê°ì†Œí•œ ì±„ë¡œ ì‹œì‘)
ìŠ¹ë¦¬ ì‹œ ğŸª™50`,apply:e=>(e.run.nextBattleSuppliesBonus=-5,{kind:"BATTLE_SPECIAL",title:"ê³ ë¸”ë¦° ë§¤ë³µ",enemyIds:["goblin_raider","goblin_raider"],onWinGrantGold:50})}]},{id:"find_adventurer",name:"ë‹¤ë¥¸ ëª¨í—˜ê°€ ë°œê²¬",prompt:"ê±°ë˜í•œë‹¤.",art:"assets/events/event_find_adventurer.png",options:e=>e.run.treasureObtained?[{key:"adventurer:forced_battle",label:"ëŒ€ì¹˜í•œë‹¤",detail:"ë³´ë¬¼ì„ ë…¸ë¦¬ê³  ë¤ë²¼ë“ ë‹¤.",apply:t=>({kind:"BATTLE_SPECIAL",enemyIds:["other_adventurer"],title:"ë³´ë¬¼ì„ ë…¸ë¦¬ëŠ” ëª¨í—˜ê°€"})}]:[{key:"trade",label:"ì¹´ë“œ 1ì¥ ì œê±° í›„ ì¹´ë“œ ë³´ìƒ(2ì¥ ì¤‘ 1ì¥)",apply:t=>(f(t,"ì´ë²¤íŠ¸: ë‹¤ë¥¸ ëª¨í—˜ê°€ ë°œê²¬ â†’ ì œê±°í•  ì¹´ë“œ ì„ íƒ í›„ ë³´ìƒ"),{kind:"REMOVE_PICK",title:"ë‹¤ë¥¸ ëª¨í—˜ê°€ ë°œê²¬",prompt:"ì œê±°í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",then:"REWARD"})},{key:"leave",label:"ì§€ë‚˜ì¹œë‹¤",apply:t=>(f(t,"ì´ë²¤íŠ¸: ë‹¤ë¥¸ ëª¨í—˜ê°€ ë°œê²¬(ìƒëµ)"),"NONE")}]},{id:"ominous_prophecy",name:"ë¶ˆê¸¸í•œ ì˜ˆì–¸",prompt:"ë¶ˆê¸¸í•œ ì†ì‚­ì„ì´ ê·“ê°€ë¥¼ ë§´ëˆë‹¤. ëŒ€ê°€ë¥¼ ì¹˜ë¥´ê³  ë¯¸ë˜ë¥¼ ì—¿ë³¼ê¹Œ?",art:"assets/events/event_ominous_prophecy.png",options:e=>[{key:"omen:listen",label:"ì˜ˆì–¸ì„ ë“£ëŠ”ë‹¤",detail:"ğŸ’¤ F +1. ë‹¤ìŒ ë³´ìŠ¤ë¥¼ í™•ì •í•˜ê³  ê³µê°œí•©ë‹ˆë‹¤.",apply:t=>{if(yt(t,1),f(t,"ë¶ˆê¸¸í•œ ì˜ˆì–¸: ğŸ’¤ F +1"),t.run.nextBossId||(t.run.bossPool.length>0?t.run.nextBossId=me(t.run.bossPool):t.run.nextBossId=null),!t.run.nextBossId)return f(t,"ì˜ˆì–¸: ë¯¸ë˜ê°€ íë¦¿í•˜ë‹¤. (ë³´ìŠ¤ê°€ ë‚¨ì•„ìˆì§€ ì•ŠìŒ)"),"NONE";t.content.enemiesById[t.run.nextBossId];const n=Ta[t.run.nextBossId]??"ì •ì²´ë¶ˆëª…ì˜ ìœ„í˜‘ì´ ë‹¤ê°€ì˜¨ë‹¤.";return t.run.bossOmenText=`${n}`,f(t,`ì˜ˆì–¸: ${n}`),"NONE"}},{key:"omen:ignore",label:"ë¬´ì‹œí•œë‹¤",detail:"ì•„ë¬´ ì¼ë„ ì¼ì–´ë‚˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",apply:t=>(f(t,"ë¶ˆê¸¸í•œ ì˜ˆì–¸(ë¬´ì‹œ)"),"NONE")}]},{id:"tilted_dice_table",name:"ê¸°ìš¸ì–´ì§„ ì£¼ì‚¬ìœ„ íŒ",prompt:`ê¸ˆì´ ê°„ ëŒíƒì ìœ„, ëˆˆê¸ˆì´ ì–´ê¸‹ë‚œ ì£¼ì‚¬ìœ„ê°€ ëœì»¥ê±°ë¦°ë‹¤.
í•œ ë²ˆë§Œ êµ´ë¦´ ìˆ˜ ìˆë‹¤.`,art:"assets/events/event_tilted_dice_table.png",options:e=>lr(e,"relic_wrong_dice")?[{key:"tilted_dice_table:leave",label:"ì§€ë‚˜ì¹œë‹¤",detail:"ì´ë¯¸ ì˜ëª»ëœ ì£¼ì‚¬ìœ„ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.",apply:n=>(f(n,"ì´ë²¤íŠ¸: ê¸°ìš¸ì–´ì§„ ì£¼ì‚¬ìœ„ íŒ(ì´ë¯¸ ë³´ìœ , ìƒëµ)"),"NONE")}]:[{key:"tilted_dice_table:challenge",label:"íŒì— ì„ ë‹¤",detail:"ì´ë²¤íŠ¸ ì „íˆ¬(ë‹¤ë¥¸ ëª¨í—˜ê°€). ìŠ¹ë¦¬ ì‹œ [ì˜ëª»ëœ ì£¼ì‚¬ìœ„] íšë“",apply:n=>(f(n,"ì´ë²¤íŠ¸: ê¸°ìš¸ì–´ì§„ ì£¼ì‚¬ìœ„ íŒ â†’ ë‹¤ë¥¸ ëª¨í—˜ê°€ì™€ ëŒ€ê²° (ìŠ¹ë¦¬ ì‹œ ì˜ëª»ëœ ì£¼ì‚¬ìœ„)"),{kind:"BATTLE_SPECIAL",title:"ê¸°ìš¸ì–´ì§„ ì£¼ì‚¬ìœ„ íŒ",enemyIds:["other_adventurer"],onWinGrantRelicId:"relic_wrong_dice"})},{key:"tilted_dice_table:leave",label:"ì§€ë‚˜ì¹œë‹¤",apply:n=>(f(n,"ì´ë²¤íŠ¸: ê¸°ìš¸ì–´ì§„ ì£¼ì‚¬ìœ„ íŒ(ìƒëµ)"),"NONE")}]},{id:"rat_circle",name:"ì¥ë“¤ì˜ ì›",prompt:`ì¥ë“¤ì´ ëŒë°”ë‹¥ì— ì›ì„ ë§Œë“ ë‹¤.
ë‹¹ì‹ ì„ ë³´ì ì›ì´ ì»¤ì§„ë‹¤.`,art:"assets/events/event_rat_circle.png",options:e=>{const t=!lr(e,"relic_ratskin_charm"),n=[{key:"rat_circle:one",label:"ì¥ë–¼ í•œ ë§ˆë¦¬ì™€ ì‹¸ìš´ë‹¤",detail:"ì „íˆ¬",apply:r=>(f(r,"ì´ë²¤íŠ¸: ì¥ë“¤ì˜ íŒ â†’ ì¥ë–¼ 1"),{kind:"BATTLE_SPECIAL",title:"ì¥ë“¤ì˜ ì›",enemyIds:["rat_swarm"]})}];return t&&n.splice(1,0,{key:"rat_circle:three_for_relic",label:"ìœ ë¬¼ì„ ê±¸ê³  ì¥ë–¼ ì…‹ê³¼ ì‹¸ìš´ë‹¤",detail:"ìŠ¹ë¦¬ ì‹œ ê³ ìœ  ìœ ë¬¼ íšë“",apply:r=>(f(r,"ì´ë²¤íŠ¸: ì¥ë“¤ì˜ íŒ â†’ ì¥ë–¼ 3 (ê³ ìœ  ìœ ë¬¼)"),{kind:"BATTLE_SPECIAL",title:"ì¥ë“¤ì˜ ì›",enemyIds:["rat_swarm","rat_swarm","rat_swarm"],onWinGrantRelicId:"relic_ratskin_charm"})}),n}}];function dr(e){return cr.find(t=>t.id===e)??null}function hl(){return Object.keys(Oo).sort((e,t)=>e.localeCompare(t))}function ml(){return{cardsById:Oo,enemiesById:ds,itemsById:Do}}function bl(e,t){return t!==1?!1:(e.enemies??[]).some(n=>n&&n.hp>0&&n.id==="living_chain")}function va(e,t){const n=getComputedStyle(document.documentElement),r=parseFloat(n.getPropertyValue("--handCardW"))||240,o=parseFloat(n.getPropertyValue("--handCardH"))||336,a=e.getBoundingClientRect();if(a.width<=0||a.height<=0)return;const s=6,i=Math.max(1,a.width-s*2),l=Math.max(1,a.height-s*2);let c=Math.min(i/r,l/o);c=Math.max(.8,Math.min(1,c)),t.style.setProperty("--slotCardScale",String(c))}function yl(e){if(!e)return!1;const t=String(e.id??""),n=e.tags??[];return!!(Array.isArray(n)&&n.includes("INSTALL")||t.startsWith("install_")||e.installWhen)}function kl(e,t){if(!yl(e))return!1;const n=String(e.installWhen??"BOTH").toUpperCase();return n==="FRONT"?t==="front":n==="BACK"?t==="back":!0}function no(e,t,n,r){const o=document.createElement("div");o.className="grid6";const a=!!e.selectedHandCardUid,s=n==="front"?e.frontSlots:e.backSlots,i=e.run,l=Number(n==="front"?i.slotCapFront:i.slotCapBack),c=Math.max(3,Math.min(4,Math.floor(Number.isFinite(l)?l:3)));for(let d=0;d<c;d++){const h=n==="back"?!!e.backSlotDisabled?.[d]:!1,m=n==="front"?bl(e,d):!1,u=h||m,p=document.createElement("div");p.className="slot"+(u?" disabled":""),m&&p.classList.add("chainLocked"),p.dataset.slotSide=n,p.dataset.slotIndex=String(d),r.hoverSlot&&r.hoverSlot.side===n&&r.hoverSlot.idx===d&&p.classList.add("dropHover"),a&&!u&&p.classList.add("placeable");const y=s[d];if(y){const k=r.getCardDefByUid(e,y);kl(k,n)&&p.classList.add("installed");const T=r.uiSettings.slotCardMode==="NAME_ONLY"?"SLOT_NAME_ONLY":"FULL",C=r.renderCard(e,y,!1,void 0,{draggable:!1,mode:T,hoverPreview:{root:document.body,api:r.cardHoverApi,buildDetail:(N,W)=>{const j=r.getCardDefByUid(N,W),U=Ae(N,j.frontText,j.backText,W);return`ì „ì—´: ${U.frontText}
í›„ì—´: ${U.backText}`}}});C.classList.add("inSlot");const x=document.createElement("div");x.className="slotCardScaler",x.appendChild(C),p.appendChild(x),C.onpointerdown=N=>{N.button!==0&&N.pointerType==="mouse"||r.isTargeting(e)||e.phase==="PLACE"&&r.beginDrag(N,{kind:"slot",cardUid:y,fromSide:n,fromIdx:d})},C.ondblclick=()=>t.onReturnSlotToHand(n,d),requestAnimationFrame(()=>va(p,x))}o.appendChild(p)}return o}function ur(e){if(document.querySelectorAll(".slot.dropHover").forEach(r=>r.classList.remove("dropHover")),!e)return;const t=`.slot[data-slot-side="${e.side}"][data-slot-index="${e.idx}"]`,n=document.querySelector(t);n&&n.classList.add("dropHover")}let Vn=!1;function Tl(){document.querySelectorAll(".slot").forEach(e=>{const t=e.querySelector(".slotCardScaler");t&&va(e,t)})}function vl(e){Vn||(Vn=!0,requestAnimationFrame(()=>{Vn=!1,pr(),fr(),hr(),Tl()}))}function pr(){const e=Array.from(document.querySelectorAll(".enemyName"));if(e.length===0)return;let t=0;for(const o of e){const a=(o.textContent??"").trim();a.length>t&&(t=a.length)}const r=Math.max(6,Math.min(t,24));e.forEach(o=>{o.style.display="inline-block",o.style.width=`${r}ch`,o.style.whiteSpace="nowrap",o.style.overflow="hidden",o.style.textOverflow="ellipsis"})}function fr(e){const t=document.querySelector(".hand"),n=document.querySelector(".handCardsRow");if(!t||!n)return;const r=document.querySelector('.slot[data-slot-side="front"][data-slot-index="1"]'),o=document.querySelector(".stageInner"),a=r?.getBoundingClientRect()??o?.getBoundingClientRect();if(!a)return;const s=a.left+a.width/2,i=Array.from(n.querySelectorAll(".card"));if(i.length===0)return;const l=i[0].getBoundingClientRect(),c=i[i.length-1].getBoundingClientRect(),d=l.left,h=c.right,m=(d+h)/2,u=s-m,p=n.scrollWidth,y=t.clientWidth;if(p<=y+1){const C=u/window.innerWidth*100;n.style.transform=`translateX(${C.toFixed(4)}vw)`,t.scrollLeft=0;return}let k=t.scrollLeft-u;const T=Math.max(0,p-y);k<0&&(k=0),k>T&&(k=T),t.scrollLeft=Math.round(k),n.style.transform=""}function hr(){if(document.body.classList.contains("mobile"))return;const e=document.querySelector(".enemyHudCenter");if(!e)return;const t=e.querySelector(".enemyHudCenterMover")??e,n=e.querySelector(".enemyHud")??e.querySelector(".enemyStrip")??t;e.style.position="fixed",e.style.top="calc(8 * var(--u))",e.style.left="50%",e.style.right="auto",e.style.overflow="visible",t.style.transform="",t.style.overflow="visible",t.style.width="max-content",n.style.display="flex",n.style.flexWrap="nowrap",n.style.justifyContent="center",n.style.alignItems="stretch",n.style.maxWidth="100%",n.style.overflowX="auto";const r=Array.from(e.querySelectorAll(".enemyBanner"));if(r.length===0){e.style.removeProperty("--enemyHudDx");return}e.style.setProperty("--enemyHudDx","0vw");let o=0,a=0;for(const u of r){const p=u.getBoundingClientRect(),y=Math.max(1,p.width),k=p.left+p.width/2;o+=y,a+=k*y}if(o<=0)return;const s=a/o;let l=window.innerWidth*.5-s;const c=e.getBoundingClientRect(),d=Math.max(0,c.left),h=Math.max(0,window.innerWidth-c.right);l>d&&(l=d),l<-h&&(l=-h);const m=l/Math.max(1,window.innerWidth)*100;e.style.setProperty("--enemyHudDx",`${m.toFixed(4)}vw`)}function ze(e,t,n){const r=document.createElement(e);return t&&(r.className=t),n!=null&&(r.textContent=n),r}function L(e,t){return ze("div",e,t)}function Te(e,t){return L(e,t)}function xa(e,t){return ze("span",e,t)}function Ca(e,t){return ze("h2",t,e)}function Cn(e,t){return ze("h3",t,e)}function xl(e,t){return ze("p",t,e)}function wa(e,t,n=!1,r="uiBtn"){const o=ze("button",r,e);return o.type="button",o.disabled=!!n,o.onclick=()=>t(),o}function Cl(e,t,n=""){const r=ze("img",t);return r.src=e,r.alt=n,r}function wl(e){return xa("badge",e)}function mr(e,t,n){const r=ze("button",void 0,e);return typeof n=="string"&&n&&(r.className=n),typeof n=="boolean"&&(r.disabled=n),r.type="button",r.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation(),t()}),r}function Gn(e,t=""){return ze("span","chip"+(t?` ${t}`:""),e)}let ht=!1,br=!1;const _a="deckrogue_logCollapsed";function _l(e){const t=ze("pre","log",e);return requestAnimationFrame(()=>{t.scrollTop=t.scrollHeight}),t}function Sl(e,t){const n=L("logHeaderRow");n.tabIndex=0;const r=Ca("ë¡œê·¸"),o=xa("chev",e?"â–¸":"â–¾");return n.appendChild(r),n.appendChild(o),n.onclick=()=>t(),n.onkeydown=a=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),t())},n}function gl(){try{const e=localStorage.getItem(_a);e!=null&&(ht=e==="1")}catch{}}function El(){try{localStorage.setItem(_a,ht?"1":"0")}catch{}}function Nl(){br=!br}function Al(e,t){const n=L("panel logPanel");return n.classList.toggle("collapsed",ht),n.appendChild(Sl(ht,()=>{ht=!ht,El(),t.rerender()})),n.classList.add("logScroll"),ht||n.appendChild(_l((e.log??[]).join(`
`))),n}function $l(e,t){if(document.querySelector(".logOverlay")?.remove(),!br)return;const n=L("logOverlay");n.style.cssText="position: fixed; inset: 0;pointer-events:auto;background: rgba(0,0,0,.55);backdrop-filter: blur(calc(6 * var(--u)));display: flex;align-items: flex-end;justify-content: center;";const r=L("panel");r.style.cssText="width: min(calc(720 * var(--u)), 100%);max-height: 70vh;border-radius: calc(18 * var(--u)) calc(18 * var(--u)) 0 0;padding: calc(12 * var(--u));margin: 0;";const o=L("panelHeader"),a=Ca("ë¡œê·¸");o.appendChild(a),o.appendChild(t.mkButton("ë‹«ê¸°",()=>t.onClose())),r.appendChild(o);const s=ze("pre","log",(e.log??[]).join(`
`));s.style.maxHeight="60vh",s.style.overflow="auto",requestAnimationFrame(()=>{s.scrollTop=s.scrollHeight}),r.appendChild(s),n.onclick=()=>t.onClose(),r.onclick=i=>i.stopPropagation(),n.appendChild(r),document.body.appendChild(n)}function ro(e,t){e.includes(t)||e.push(t)}function qn(e,t,n){e[t]??=[],e[n]??=[],ro(e[t],n),ro(e[n],t)}function Ml(e,t,n){return(e[t]??[]).includes(n)}function dt(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}function dn(e){return e[Math.floor(Math.random()*e.length)]}function Pl(e){const t=Math.floor((e+1)/2),r=Math.round((Math.max(4,e)-1)/3.2)+1,o=12,a=Math.min(t,32),s=Math.max(o,Math.min(a,r));return Math.max(3,Math.min(t,s))}function Rl(e){let n=Pl(e);for(;n>2&&1+2*(n-1)>e;)n-=1;const r=Math.floor((e+1)/2);for(;n<r&&1+4*(n-1)<e;)n+=1;const o=4,a=new Array(n).fill(2);a[0]=1;let s=e-(1+2*(n-1));for(;s>0;){const i=1+Math.floor(Math.random()*(n-1));a[i]>=o||(a[i]+=1,s-=1)}for(let i=0;i<24;i++){const l=1+Math.floor(Math.random()*(n-1)),c=1+Math.floor(Math.random()*(n-1));l!==c&&(a[l]<=2||a[c]>=o||Math.random()<.5&&(a[l]-=1,a[c]+=1))}return a}function Bl(e){const n=Math.max(18,Math.floor(8.64)),r=Math.max(2,Math.floor(72/15)),o={},a={},s=Rl(72),i=[];let l=0;for(let w=0;w<s.length;w++){const E=s[w],_=[];for(let P=0;P<E;P++){const R=`n${l++}`;_.push(R)}i.push(_)}for(;l<72;)i[i.length-1].length>=4&&i.push([]),i[i.length-1].push(`n${l++}`);for(let w=0;w<i.length;w++){const E=i[w];for(let _=0;_<E.length;_++){const P=E[_];o[P]={id:P,kind:w===0&&_===0?"START":"BATTLE",depth:w,order:_,visited:w===0&&_===0,cleared:w===0&&_===0,reprocCount:0,lastProcTime:-999},a[P]=[]}}const c=i.slice(0,-1).map(()=>[]),d=(w,E)=>{if(Ml(a,w,E))return!1;const _=o[w]?.depth??0,P=o[E]?.depth??0;if(Math.abs(_-P)!==1)return!1;const R=Math.min(_,P),O=_<P?w:E,D=_<P?E:w,z=o[O]?.order??0,G=o[D]?.order??0;for(const[X,ee]of c[R])if(z<X&&G>ee||z>X&&G<ee)return!1;return qn(a,O,D),c[R].push([z,G]),!0};for(let w=0;w<i.length-1;w++){const E=i[w],_=i[w+1];for(let R=0;R<_.length;R++){const O=Math.floor(R*E.length/_.length),D=(Math.random()<.5?-1:1)*(Math.random()<.35?1:0),z=Math.max(0,Math.min(E.length-1,O+D));d(E[z],_[R])}const P=.35;for(let R=0;R<E.length;R++){if(Math.random()>P)continue;const O=Math.floor(R*_.length/E.length),D=(Math.random()<.5?-1:1)*(Math.random()<.35?1:0),z=Math.max(0,Math.min(_.length-1,O+D));d(E[R],_[z])}}i.length>=2&&i[1].length>=2&&d(i[0][0],i[1][i[1].length-1]);const h=Math.max(0,Math.min(n,144));let m=0,u=0;for(;m<h&&u++<8e3;){const w=Math.floor(Math.random()*(i.length-1)),E=i[w],_=i[w+1],P=E[Math.floor(Math.random()*E.length)],R=_[Math.floor(Math.random()*_.length)];d(P,R)&&(m+=1)}const p=.25;for(let w=0;w<i.length;w++){const E=i[w];if(E.length<2)continue;const _=Math.floor(Math.random()*(E.length-1));qn(a,E[_],E[_+1]);for(let P=0;P<E.length-1;P++)P!==_&&Math.random()<p&&qn(a,E[P],E[P+1])}const y={nodes:o,edges:a,startId:i[0][0],pos:i[0][0],treasureId:null,visionNonce:0},k=[],T=Math.max(2,Math.floor(i.length*.85)),C=Math.max(T,Math.floor(i.length*1)-1);for(let w=T;w<=C&&w<i.length;w++)for(const E of i[w])k.push(E);const x=k.length?dn(k):"n71";y.treasureId=x,o[x].kind="TREASURE";const N=Object.keys(o).filter(w=>w!==y.startId&&w!==x);dt(N);const W=5,j=new Set;i.length>1&&j.add(1);const U=[];for(let w=2;w<i.length;w++)U.push(w);dt(U);for(const w of U){if(j.size>=Math.min(W,Math.max(0,i.length-1)))break;j.add(w)}const V=2,M=new Set,B=o[x]?.depth??-1,F=[];for(let w=2;w<i.length;w++)j.has(w)||w!==B&&F.push(w);const K=[...F].sort((w,E)=>w-E),re=Math.max(1,i.length-1),ae=Math.max(2,Math.floor(re*.45)),ne=Math.max(2,Math.ceil(re*.6)),J=Math.max(3,Math.floor(re*.35)),se=K.filter(w=>w<=ae),ce=K.filter(w=>w>=ne),H=(w,E)=>{if(w.length===0)return null;let _=w[0],P=Math.abs(_-E);for(const R of w){const O=Math.abs(R-E);O>P&&(_=R,P=O)}return _},$e=se.length>0?dn(se):K[0]??null;if($e!=null&&M.add($e),M.size<V&&K.length>0){const w=[...M][0]??null,E=ce.filter(P=>w==null||Math.abs(P-w)>=J),_=E.length>0?dn(E):H(K.filter(P=>P!==w),w??0);_!=null&&M.add(_)}if(M.size<Math.min(V,K.length)){const w=[...K].filter(E=>!M.has(E));dt(w);for(const E of w){if(M.size>=Math.min(V,K.length))break;M.add(E)}}const Z=new Set;for(const w of M){const E=[...i[w]??[]].filter(_=>_!==y.startId&&_!==x);dt(E);for(const _ of E.slice(0,2))Z.add(_)}const b=N.filter(w=>(o[w]?.depth??0)>=2).filter(w=>!j.has(o[w]?.depth??0)).filter(w=>!M.has(o[w]?.depth??0));dt(b);const v=new Set(b.slice(0,Math.min(r,b.length))),g=4,S={battleMul:.25,eventMul:1.35,restMul:1.55},A=w=>a[w]?.length??0,I=new Set(Object.keys(o).filter(w=>w===y.startId||(o[w]?.depth??0)<g?!1:A(w)===1)),$=(w,E)=>{let _=.5,P=.25,R=.2,O=.05;w<=1?(_=.8,P=.14,R=.04,O=.02):w<=3?(_=.6,P=.2,R=.15,O=.05):(_=.5,P=.25,R=.15,O=.1),E&&(_*=S.battleMul??.25,P*=S.eventMul??1.35,R*=S.restMul??1.8,O*=.8);const D=_+P+R+O,z=Math.random()*D;return z<_?"BATTLE":z<_+P?"EVENT":z<_+P+R?"REST":"SHOP"};for(const w of N){const E=o[w]?.depth??0;if(Z.has(w)){o[w].kind="REST";continue}if(j.has(E)){o[w].kind="BATTLE";continue}if(v.has(w)){o[w].kind="ELITE";continue}o[w].kind=$(E,I.has(w))}{const w=(_,P)=>{let R=.5,O=.25,D=.05;_<=1?(R=.8,O=.14,D=.02):_<=3?(R=.6,O=.2,D=.05):(R=.5,O=.25,D=.1),P&&(R*=S.battleMul??.25,O*=S.eventMul??1.35,D*=.8);const z=R+O+D,G=Math.random()*z;return G<R?"BATTLE":G<R+O?"EVENT":"SHOP"},E=new Map;for(const _ of Object.keys(o)){const P=o[_]?.depth??0;E.has(P)||E.set(P,[]),E.get(P).push(_)}for(const[_,P]of E){const R=P.filter(z=>o[z].kind==="REST");if(R.length<=2)continue;const O=new Set;for(const z of R)Z.has(z)&&O.add(z);if(O.size>2){const z=[...O];dt(z),O.clear();for(const G of z.slice(0,2))O.add(G)}const D=Math.max(0,2-O.size);if(D>0){const z=R.filter(G=>!O.has(G));dt(z);for(const G of z.slice(0,D))O.add(G)}for(const z of R)O.has(z)||(o[z].kind=w(_,I.has(z)))}}if(!Object.values(o).some(E=>E.kind==="SHOP")){const E=Object.keys(o).filter(_=>_!==y.startId&&_!==x).filter(_=>(o[_]?.depth??0)>=2).filter(_=>o[_].kind!=="ELITE"&&o[_].kind!=="TREASURE").filter(_=>!j.has(o[_]?.depth??0));if(E.length){const _=dn(E);o[_].kind="SHOP"}}return y}function Il(e){return e.uidSeq+=1,String(e.uidSeq)}function Ll(){return{relicRuntime:{},pendingRelicActivations:[],relicUnlocked:{},unlock:{rest:0,eliteWins:0,tookBigHit10:0,kills:0,endedTurnWeak:0,eventPicks:0,hpLeq15:0,skippedTurn:0,bleedApplied:0,endedTurnSupplyZero:0,moonScrollUses:0,threeEnemyWins:0,endedTurnWith3Installs:0,installDamageDealt:0,itemDiscards:0},timeMove:0,slotCapFront:3,slotCapBack:3,bossKillCount:0,bossSlotFirstPick:null,map:Bl(),vision:{mode:"NORMAL",blind:!1,presenceR:2,typeR:2,detailR:0,noise:0},encounterCount:0,treasureObtained:!1,afterTreasureNodePicks:0,nodeOfferQueue:[],finished:!1,nodePickCount:0,nodePickByType:{BATTLE:0,ELITE:0,REST:0,EVENT:0,TREASURE:0,SHOP:0},currentNodeOffers:null,nextBattleSuppliesBonus:0,bossPool:["boss_gravity_master","boss_cursed_wall","boss_giant_orc","boss_soul_stealer"],branchOffer:null,battleCount:0,enemyLastSeenBattle:{},nextBossId:null,nextBossTime:40,forcedNext:null,bossOmenText:null,deckSizeAtTreasure:null,ominousProphecySeen:!1,relics:[],items:[],itemCap:2,lastBattleWasElite:!1,lastBattleWasBoss:!1,eliteRelicOfferedThisBattle:!1,itemOfferedThisBattle:!1,pendingElite:!1,rewardPityNonElite:0,gold:0,shops:{}}}function yr(e){const t={uidSeq:0,combatTurn:0,intentsRevealedThisTurn:!1,disruptIndexThisTurn:null,attackedEnemyIndicesThisTurn:[],phase:"NODE",log:[],run:Ll(),player:{hp:40,maxHp:40,block:0,supplies:7,fatigue:0,zeroSupplyTurns:0,status:{vuln:0,weak:0,bleed:0,disrupt:0,slash:0},immuneToDisruptThisTurn:!1,nullifyDamageThisTurn:!1,incomingDamageReductionThisTurn:0},content:e,cards:{},deck:[],hand:[],discard:[],exhausted:[],vanished:[],frontSlots:[null,null,null],backSlots:[null,null,null],backSlotDisabled:[!1,!1,!1],enemies:[],usedThisTurn:0,frontPlacedThisTurn:0,selectedHandCardUid:null,winHooksAppliedThisCombat:!1,drawCountThisTurn:0,pendingTarget:null,pendingTargetQueue:[],backUidsThisTurn:[],placedUidsThisTurn:[],installAgeByUid:{},victoryResolvedThisCombat:!1,time:0,choice:null,choiceQueue:[],choiceStack:[],choiceCtx:null,selectedEnemyIndex:null,_justStartedCombat:!1};return Ol(t),f(t,"ìƒˆ ëŸ° ì‹œì‘."),be(t),qo(t),t}function xt(e,t,n){for(let r=0;r<n;r++){const o=Il(e),a={uid:o,defId:t,zone:"deck",upgrade:0};e.cards[o]=a,e.deck.push(o)}}function Ol(e){xt(e,"field_ration",2),xt(e,"maintenance",2),xt(e,"scout",2),xt(e,"shield",2),xt(e,"power_arrow",1),xt(e,"arrow",3),e.deck=Sr(e.deck)}function Je(e){return Number(e.run.gold??0)||0}function st(e,t){const n=Number(t)||0;if(n===0)return;const r=Je(e);e.run.gold=r+n;const o=n>0?"+":"";q(e,"GOLD","ğŸª™ "+o+n,1400)}function Sa(e){return Number(e.run.nextBattleSuppliesBonus??0)||0}function oo(e,t){let r=Sa(e)+(Number(t)||0);r<-7&&(r=-7),e.run.nextBattleSuppliesBonus=r}function Dl(e){return Math.max(0,7+Sa(e)+Qo(e))}function un(e,t){if(!t)return;const n=e.player.fatigue??0;n<10||(e.player.fatigue=Math.max(0,n-2),e.time=(e.time??0)+1,f(e,"í”¼ë¡œê°€ ë„ˆë¬´ ë†’ì•„ íœ´ì‹ì´ ë” ì˜¤ë˜ ê±¸ë¦½ë‹ˆë‹¤. (F -2, ì‹œê°„ +1)"))}const ga=[{id:"overrun",label:"í­ì£¼",detail:"ëª¨ë“  ìˆ˜ +1",costHp:10,costF:2,overrun:!0},{id:"install",label:"ì„¤ì¹˜",detail:"ì„¤ì¹˜ ë¶€ì—¬",costHp:5,costF:0,addTag:"INSTALL"},{id:"innate",label:"ì„ ì²œì„±",detail:"ì„ ì²œì„± ë¶€ì—¬",costHp:5,costF:0,addTag:"INNATE"},{id:"flip",label:"ë’¤ì§‘ê¸°",detail:"ë°œë™ í›„ ìë™ ë’¤ì§‘ê¸°",costHp:0,costF:1,autoFlip:!0},{id:"remove_exhaust",label:"ì†Œëª¨ ì œê±°",detail:"ì†Œëª¨ ì œê±°",costHp:8,costF:1,removeExhaust:!0}];function Ea(e){let t=Object.values(e.cards).filter(s=>(s.zone==="deck"||s.zone==="hand"||s.zone==="discard")&&rn(e,s.uid)).map(s=>s.uid);const n=e.player.fatigue??0;let r=1/0;return n>=8?r=4:n>=5&&(r=8),r!==1/0&&t.length>r&&(t=[...t].sort(()=>Math.random()-.5).slice(0,r)),t.length===0?null:{kind:"UPGRADE_PICK",title:"ê°•í™”",prompt:"ê°•í™”í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",options:[...[...t].sort((s,i)=>{const l=e.cards[s],c=e.cards[i],d=e.content.cardsById[l.defId]?.name??l.defId,h=e.content.cardsById[c.defId]?.name??c.defId,m=d.localeCompare(h,"ko");return m!==0?m:(l.upgrade??0)-(c.upgrade??0)}).map(s=>{const i=e.cards[s],l=xe(e.content,i.defId,i.upgrade??0),c=xe(e.content,i.defId,(i.upgrade??0)+1),d=Ge(e,s),h=Ae(e,l.frontText,l.backText,s),m=Ae(e,c.frontText,c.backText,s),u=`í˜„ì¬: ì „ì—´ ${h.frontText} / í›„ì—´ ${h.backText}
ê°•í™”: ì „ì—´ ${m.frontText} / í›„ì—´ ${m.backText}`;return{key:`up:${s}`,label:d,detail:u,cardUid:s}}),{key:"skip",label:"ì·¨ì†Œ"}]}}function Hl(e,t,n){const r="goal_treasure",o=Object.values(e.cards).filter(s=>(s.zone==="deck"||s.zone==="hand"||s.zone==="discard")&&s.defId!==r).map(s=>s.uid);if(o.length===0)return null;const a=[...o.map(s=>{const i=e.cards[s],l=xe(e.content,i.defId,i.upgrade??0),c=Ge(e,s),d=Ae(e,l.frontText,l.backText,s);return{key:`remove:${s}`,label:c,detail:`ì „ì—´: ${d.frontText} / í›„ì—´: ${d.backText}`,cardUid:s}}),{key:"skip",label:"ì·¨ì†Œ"}];return{kind:"REMOVE_PICK",title:t,prompt:n,options:a}}function Na(e){const t="goal_treasure",n=Object.values(e.cards).filter(a=>(a.zone==="deck"||a.zone==="hand"||a.zone==="discard")&&a.defId!==t).filter(a=>!a.synth?.done).map(a=>a.uid);return n.length===0?null:{kind:"EVENT",title:"í•©ì„±",art:"assets/events/event_retort_fusion_synth.png",prompt:"í•©ì„±í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",options:[...[...n].sort((a,s)=>{const i=e.cards[a],l=e.cards[s],c=e.content.cardsById[i.defId]?.name??i.defId,d=e.content.cardsById[l.defId]?.name??l.defId,h=c.localeCompare(d,"ko");return h!==0?h:(i.upgrade??0)-(l.upgrade??0)}).map(a=>{const s=e.cards[a],i=xe(e.content,s.defId,s.upgrade??0),l=Ge(e,a),c=Ae(e,i.frontText,i.backText,a);return{key:`synth:pick:${a}`,label:l,detail:`ì „ì—´: ${c.frontText} / í›„ì—´: ${c.backText}`,cardUid:a}}),{key:"skip",label:"ì·¨ì†Œ"}]}}function Fl(e,t){const n=e.cards[t];if(!n||n.synth?.done)return null;const r=Ge(e,t),o=[...ga.map(a=>{const s=`HP -${a.costHp}${a.costF?`, F +${a.costF}`:""}`;return{key:`synth:tag:${a.id}`,label:`${a.label}`,detail:`${a.detail}
(${s})`}}),{key:"skip",label:"ì·¨ì†Œ"}];return{kind:"EVENT",title:`í•©ì„±: ${r}`,art:"assets/events/event_retort_fusion_synth.png",prompt:"ë¶€ì—¬í•  í•©ì„± íš¨ê³¼ë¥¼ ì„ íƒí•˜ì„¸ìš”.",options:o}}function Wl(e,t){const n=e.choiceCtx&&e.choiceCtx.kind==="REST"&&typeof e.choiceCtx.highF=="boolean"?e.choiceCtx.highF:(e.player.fatigue??0)>=10;if(t.startsWith("rest:")&&t!=="rest:synth"&&Zo(e),t.startsWith("rest:")){const r=Pe(e);r.rest+=1,Re(e)}if(t==="rest:heal")return un(e,n),js(e).healed||(kt(e,15),f(e,"íœ´ì‹: HP +15")),de(e),e.phase="NODE",fe(e),!0;if(t==="rest:clear_f")return un(e,n),e.player.fatigue=Math.max(0,(e.player.fatigue??0)-3),f(e,"íœ´ì‹: í”¼ë¡œ F-=3"),de(e),e.phase="NODE",fe(e),!0;if(t==="rest:upgrade"){if(In(e))return f(e,"ê°•í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."),de(e),e.phase="NODE",fe(e),!0;Vs(e);const a=[...Object.values(e.cards).filter(l=>l.zone==="deck"||l.zone==="hand"||l.zone==="discard").filter(l=>rn(e,l.uid)).map(l=>{const c=xe(e.content,l.defId,l.upgrade??0),d=Ge(e,l.uid),h=Ae(e,c.frontText,c.backText,l.uid);return{key:`up:${l.uid}`,label:d,detail:`ì „ì—´: ${h.frontText} / í›„ì—´: ${h.backText}`,cardUid:l.uid}}),{key:"skip",label:"ì·¨ì†Œ"}],s=e.choice,i=e.choiceCtx;return Be(e,{kind:"UPGRADE_PICK",title:"ê°•í™”",prompt:"ê°•í™”í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",options:a},{kind:"UPGRADE_PICK",returnChoice:s,returnCtx:i}),!0}if(t==="rest:synth"){un(e,n);const r=Na(e);if(!r)return f(e,"í•©ì„±í•  ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤."),!0;const o=e.choice,a=e.choiceCtx;return Be(e,r,{kind:"SYNTH_PICK",returnChoice:o,returnCtx:a}),!0}return t==="rest:skip"?(un(e,n),f(e,"íœ´ì‹: ìƒëµ"),de(e),e.phase="NODE",fe(e),!0):!1}function Ul(e,t){const n=e.choiceCtx;if(!n||n.kind!=="SYNTH_PICK")return!1;if(t==="skip")return n.returnChoice?(Be(e,n.returnChoice,n.returnCtx??null),!0):(de(e),e.phase="NODE",fe(e),!0);if(!t.startsWith("synth:pick:"))return!1;const r=t.slice(11),o=Fl(e,r);return o?(Be(e,o,{kind:"SYNTH_TAG",cardUid:r,returnChoice:n.returnChoice,returnCtx:n.returnCtx}),!0):(f(e,"í•©ì„±í•  ìˆ˜ ì—†ëŠ” ì¹´ë“œì…ë‹ˆë‹¤."),n.returnChoice?(Be(e,n.returnChoice,n.returnCtx??null),!0):(de(e),e.phase="NODE",fe(e),!0))}function zl(e,t){const n=e.choiceCtx;if(!n||n.kind!=="SYNTH_TAG")return!1;const r=String(n.cardUid??""),o=e.cards[r];if(!o)return f(e,"í•©ì„± ì‹¤íŒ¨: ì¹´ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."),de(e),e.phase="NODE",fe(e),!0;if(t==="skip"){const i=Na(e);return i?(Be(e,i,{kind:"SYNTH_PICK",returnChoice:n.returnChoice,returnCtx:n.returnCtx}),!0):n.returnChoice?(Be(e,n.returnChoice,n.returnCtx??null),!0):(de(e),e.phase="NODE",fe(e),!0)}if(!t.startsWith("synth:tag:"))return!1;const a=t.slice(10),s=ga.find(i=>i.id===a);return s?o.synth?.done?(f(e,"ì´ë¯¸ í•©ì„±ëœ ì¹´ë“œì…ë‹ˆë‹¤."),!0):(o.synth??={},o.synth.done=!0,"overrun"in s&&s.overrun&&(o.synth.overrun=!0),"autoFlip"in s&&s.autoFlip&&(o.synth.autoFlip=!0),"removeExhaust"in s&&s.removeExhaust&&(o.synth.removeExhaust=!0),"addTag"in s&&s.addTag&&(o.synth.addTags??=[],o.synth.addTags.includes(s.addTag)||o.synth.addTags.push(s.addTag)),s.costHp>0&&Me(e,s.costHp,"OTHER","í•©ì„±"),s.costF>0&&(e.player.fatigue=(e.player.fatigue??0)+s.costF),f(e,`í•©ì„± ì™„ë£Œ: ${s.label} (HP -${s.costHp}${s.costF?`, F +${s.costF}`:""})`),Zo(e),de(e),e.phase="NODE",fe(e),!0):(f(e,"í•©ì„± ì‹¤íŒ¨: ì•Œ ìˆ˜ ì—†ëŠ” íƒœê·¸"),!0)}function Kl(e,t){if(!e.choiceCtx||e.choiceCtx.kind!=="SHOP")return!1;const n=String(e.choiceCtx.nodeId??"");if(!n)return!1;const r=e.run;r.shops??={};const o=r.shops[n];if(!o)return ie(e,n),!0;if(t==="shop:leave")return f(e,"ìƒì : ë– ë‚œë‹¤."),de(e),e.phase="NODE",!0;if(t==="shop:sep"||t.startsWith("shop:sep:"))return ie(e,n),!0;if(t.startsWith("shop:card:")){const a=Number(t.slice(10)),s=o.cards?.[a];if(!s)return f(e,"ìƒì : ì•Œ ìˆ˜ ì—†ëŠ” ì¹´ë“œ ì„ íƒì…ë‹ˆë‹¤."),ie(e,n),!0;if(s.sold)return f(e,"ìƒì : í’ˆì ˆë˜ì—ˆìŠµë‹ˆë‹¤."),ie(e,n),!0;const i=He(e,Number(s.priceGold??0)||0);return Je(e)<i?(f(e,"ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."),ie(e,n),!0):(st(e,-i),Ve(e,s.defId,{upgrade:Number(s.upgrade??0)||0}),s.sold=!0,f(e,`ìƒì : ì¹´ë“œ êµ¬ë§¤ (-ğŸª™${i})`),ie(e,n),!0)}if(t.startsWith("shop:item:")){const a=Number(t.slice(10)),s=o.items?.[a];if(!s)return f(e,"ìƒì : ì•Œ ìˆ˜ ì—†ëŠ” ì•„ì´í…œ ì„ íƒì…ë‹ˆë‹¤."),ie(e,n),!0;if(s.sold)return f(e,"ìƒì : í’ˆì ˆë˜ì—ˆìŠµë‹ˆë‹¤."),ie(e,n),!0;if(to(e)||to(e))return f(e,"ì•„ì´í…œ ê°€ë°©ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤. ë¨¼ì € ë²„ë¦¬ê±°ë‚˜(ìš°í´ë¦­) ì‚¬ìš©í•˜ì„¸ìš”."),q(e,"WARN","ì•„ì´í…œ ê°€ë°©ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤.",1600),ie(e,n),!0;const i=He(e,Number(s.priceGold??0)||0);if(Je(e)<i)return f(e,"ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."),ie(e,n),!0;if(st(e,-i),!ir(e,String(s.itemId),"SHOP"))return st(e,i),f(e,"ìƒì : ì•„ì´í…œ êµ¬ë§¤ ì‹¤íŒ¨(í™˜ë¶ˆ)"),ie(e,n),!0;s.sold=!0;const c=We(String(s.itemId))?.name??String(s.itemId);return f(e,`ìƒì : ì•„ì´í…œ êµ¬ë§¤ (${c}) (-ğŸª™${i})`),ie(e,n),!0}if(t.startsWith("shop:relic:")){const a=Number(t.slice(11)),s=o.relics?.[a];if(!s)return f(e,"ìƒì : ì•Œ ìˆ˜ ì—†ëŠ” ìœ ë¬¼ ì„ íƒì…ë‹ˆë‹¤."),ie(e,n),!0;if(s.sold)return f(e,"ìƒì : í’ˆì ˆë˜ì—ˆìŠµë‹ˆë‹¤."),ie(e,n),!0;const i=He(e,Number(s.priceGold??0)||0);if(Je(e)<i)return f(e,"ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."),ie(e,n),!0;st(e,-i),Jt(e,String(s.relicId),"NORMAL");const l=String(s.relicId);e.run.relicUnlocked??={},e.run.relicUnlocked[l]=!0,e.run.relicRuntime??={};const c=e.run.relicRuntime[l]??{},d=!!c.active;e.run.relicRuntime[l]={...c,active:!0,pending:!1,obtainedAtNode:c.obtainedAtNode??e.run.nodePickCount,activatedAtNode:e.run.nodePickCount},d||pe[l]?.onActivate?.(e),s.sold=!0;const h=pe?.[l]?.name??l;return f(e,`ìƒì : ìœ ë¬¼ êµ¬ë§¤ (${h}) (-ğŸª™${i})`),ie(e,n),!0}if(t==="shop:supply:buy"){const a=He(e,6),s=3;return Je(e)<a?(f(e,"ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."),ie(e,n),!0):(st(e,-a),oo(e,s),f(e,`ìƒì : ë³´ê¸‰ êµ¬ë§¤ (-ğŸª™${a}, ë‹¤ìŒ ì „íˆ¬ S +${s})`),ie(e,n),!0)}if(t==="shop:supply:sell")return Dl(e)<3?(f(e,"ë‹¤ìŒ ì „íˆ¬ ë³´ê¸‰ì´ ë¶€ì¡±í•˜ì—¬ íŒë§¤í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."),ie(e,n),!0):(oo(e,-3),st(e,4),f(e,"ìƒì : ë³´ê¸‰ íŒë§¤ (ë‹¤ìŒ ì „íˆ¬ S -3, ğŸª™ +4)"),ie(e,n),!0);if(t==="shop:service:upgrade"){if(o.usedUpgrade)return f(e,"ìƒì : ê°•í™”ëŠ” ì´ ìƒì ì—ì„œ ì´ë¯¸ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤."),ie(e,n),!0;const a=He(e,25);if(Je(e)<a)return f(e,"ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."),ie(e,n),!0;const s=Ea(e);return s?(Be(e,s,{kind:"UPGRADE_PICK",returnTo:{kind:"SHOP",nodeId:n},priceGold:a}),!0):(f(e,"ê°•í™”í•  ìˆ˜ ìˆëŠ” ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤."),ie(e,n),!0)}if(t==="shop:service:remove"){if(o.usedRemove)return f(e,"ìƒì : ì œê±°ëŠ” ì´ ìƒì ì—ì„œ ì´ë¯¸ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤."),ie(e,n),!0;const a=He(e,25);if(Je(e)<a)return f(e,"ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."),ie(e,n),!0;const s=Hl(e,"ìƒì : ì¹´ë“œ ì œê±°","ì œê±°í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.");return s?(Be(e,s,{kind:"REMOVE_PICK",returnTo:{kind:"SHOP",nodeId:n},priceGold:a}),!0):(f(e,"ì œê±°í•  ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤."),ie(e,n),!0)}return t.startsWith("shop:")?(f(e,`ìƒì : ì•Œ ìˆ˜ ì—†ëŠ” ì„ íƒ (${t})`),ie(e,n),!0):!1}function jl(e,t){if(!e.choiceCtx||e.choiceCtx.kind!=="EVENT")return!1;const n=dr(e.choiceCtx.eventId);if(!n)return!1;const o=n.options(e).find(i=>i.key===t);if(!o)return!1;const a=Pe(e);a.eventPicks+=1,Re(e);const s=o.apply(e);if(s&&typeof s=="object"&&s.kind==="UPGRADE_PICK"){const i=Ea(e);return i?(Be(e,i,null),!0):(f(e,"ê°•í™”í•  ìˆ˜ ìˆëŠ” ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤."),de(e),e.phase="NODE",fe(e),!0)}if(s&&typeof s=="object"&&s.kind==="REMOVE_PICK"){const l=[...Object.values(e.cards).filter(c=>c.zone==="deck"||c.zone==="hand"||c.zone==="discard").map(c=>c.uid).map(c=>{const d=e.cards[c],h=xe(e.content,d.defId,d.upgrade??0),m=Ge(e,c),u=Ae(e,h.frontText,h.backText,c);return{key:`remove:${c}`,label:m,detail:`ì „ì—´: ${u.frontText} / í›„ì—´: ${u.backText}`,cardUid:c}}),{key:"skip",label:"ì·¨ì†Œ"}];return Be(e,{kind:"REMOVE_PICK",title:s.title??"ì œê±°",prompt:s.prompt??"ì œê±°í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",options:l},null),!0}return de(e),e.phase="NODE",fe(e),!0}function Vl(e,t){const n=e.choice;if(!n)return!1;if(t==="close")return de(e),!0;if(n.kind==="REWARD")return fi(e,t);if(n.kind==="FAITH"){if(!e.choiceCtx||e.choiceCtx.kind!=="FAITH_START"||!t.startsWith("faith:choose:"))return!1;const o=t.slice(13);return Bs(e,o),be(e),de(e),e.phase="NODE",fe(e),!0}if(n.kind==="GOD_TEMPT"){const o=e.choiceCtx;if(!o||o.kind!=="GOD_TEMPT")return!1;const a=o.tempter;if(t==="tempt:reject")return f(e,`ìœ í˜¹ ê±°ë¶€: ${ge(a)}`),de(e),e.phase="NODE",fe(e),!0;if(t==="tempt:accept"){const s=o.tempter;if(s==="first_human"){e.player.fatigue=(e.player.fatigue??0)+3,f(e,"ìœ í˜¹: í”¼ë¡œ +3"),Un(e,s);const l=[...Object.values(e.cards).filter(c=>(c.zone==="deck"||c.zone==="hand"||c.zone==="discard")&&c.defId!=="goal_treasure").map(c=>c.uid).map(c=>{const d=e.cards[c],h=xe(e.content,d.defId,d.upgrade??0),m=Ge(e,c),u=Ae(e,h.frontText,h.backText,c);return{key:`dup:${c}`,label:m,detail:`ì „ì—´: ${u.frontText} / í›„ì—´: ${u.backText}`,cardUid:c}}),{key:"skip",label:"ë³µì œí•˜ì§€ ì•ŠëŠ”ë‹¤"}];return Be(e,{kind:"PICK_CARD",title:"ë³µì œ",prompt:"ë³µì œí•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",options:l},{kind:"FIRST_HUMAN_DUP"}),!0}return s==="twin_heart"?(Un(e,s),de(e),e.phase="NODE",ra(e),fe(e),!0):(Un(e,s),Os(e,s),de(e),e.phase="NODE",fe(e),!0)}return!1}if(e.choiceCtx?.kind==="PICK_VANISHED_TO_HAND"){if(t==="cancel")return de(e),!0;if(t.startsWith("pickVanished:")){const o=t.slice(13),a=e.cards[o];if(a&&a.zone==="vanished"){a.zone="hand",e.hand.includes(o)||e.hand.push(o),e.vanished=e.vanished.filter(l=>l!==o);const i=e.content.cardsById[a.defId]?.name??a.defId;f(e,`ì†Œì‹¤ ì¹´ë“œ íšŒìˆ˜: ${i}`)}return de(e),!0}return!1}if(n.kind==="PICK_CARD"){if(e.choiceCtx?.kind!=="FIRST_HUMAN_DUP")return!1;if(t==="skip")return f(e,"ë³µì œ ì·¨ì†Œ"),de(e),e.phase="NODE",fe(e),!0;if(t.startsWith("dup:")){const a=t.slice(4),s=e.cards[a];if(!s)f(e,"ë³µì œ ì‹¤íŒ¨: ì¹´ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");else{Ve(e,s.defId,{upgrade:Number(s.upgrade??0)||0});const i=e.content.cardsById[s.defId]?.name??s.defId,l=(s.upgrade??0)>0?`${i} +${s.upgrade}`:i;f(e,`ìœ í˜¹: ì¹´ë“œ ë³µì œ (${l})`)}return de(e),e.phase="NODE",fe(e),!0}return!1}if(n.kind==="MADNESS_TEMPT"){const o=e.choiceCtx;return!o||o.kind!=="MADNESS_TEMPT"?!1:t==="madness:accept"?(Fs(e,o.offerBoon),de(e),e.phase="NODE",fe(e),!0):t==="madness:reject"?(Ws(e,o.offerBane),de(e),e.phase="NODE",fe(e),!0):!1}if(n.kind==="UPGRADE_PICK"){if(t==="skip"){const o=e.choiceCtx;return o?.returnTo?.kind==="SHOP"&&o?.returnTo?.nodeId?(f(e,"ìƒì : ê°•í™” ì·¨ì†Œ"),ie(e,String(o.returnTo.nodeId)),!0):o?.returnChoice?(f(e,"ê°•í™” ì·¨ì†Œ"),Be(e,o.returnChoice,o.returnCtx??null),!0):(f(e,"ê°•í™” ì·¨ì†Œ"),de(e),e.phase="NODE",fe(e),!0)}if(t.startsWith("up:")){const o=t.slice(3),a=e.choiceCtx;if(a?.returnTo?.kind==="SHOP"&&a?.returnTo?.nodeId){const i=String(a.returnTo.nodeId),l=Number(a?.priceGold??0)||0;if(l>0){if(Je(e)<l)return f(e,"ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."),ie(e,i),!0;st(e,-l)}const c=Pt(e,o),h=e.run.shops?.[i];return c&&h&&(h.usedUpgrade=!0),f(e,c?"ìƒì : ê°•í™” ì™„ë£Œ":"ìƒì : ê°•í™” ì‹¤íŒ¨"),ie(e,i),!0}const s=Pt(e,o);return f(e,s?"ê°•í™” ì™„ë£Œ":"ê°•í™” ì‹¤íŒ¨"),de(e),e.phase="NODE",fe(e),!0}return!1}if(n.kind==="REMOVE_PICK"){if(t==="skip"){const o=e.choiceCtx;return o?.returnTo?.kind==="SHOP"&&o?.returnTo?.nodeId?(f(e,"ìƒì : ì œê±° ì·¨ì†Œ"),ie(e,String(o.returnTo.nodeId)),!0):(f(e,"ì œê±° ì·¨ì†Œ"),de(e),e.phase="NODE",fe(e),!0)}if(t.startsWith("remove:")){const o=t.slice(7),a=e.choiceCtx;if(a?.returnTo?.kind==="SHOP"&&a?.returnTo?.nodeId){const s=String(a.returnTo.nodeId),i=Number(a?.priceGold??0)||0;if(i>0){if(Je(e)<i)return f(e,"ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."),ie(e,s),!0;st(e,-i)}Qt(e,o);const c=e.run.shops?.[s];return c&&(c.usedRemove=!0),f(e,"ìƒì : ì¹´ë“œë¥¼ ì œê±°í–ˆìŠµë‹ˆë‹¤."),ie(e,s),!0}return Qt(e,o),f(e,"ì¹´ë“œë¥¼ ì œê±°í–ˆìŠµë‹ˆë‹¤."),de(e),e.phase="NODE",fe(e),!0}return!1}if(n.kind==="EVENT"){if(e.choiceCtx?.kind==="SYNTH_PICK")return Ul(e,t);if(e.choiceCtx?.kind==="SYNTH_TAG")return zl(e,t);if(e.choiceCtx?.kind==="REST")return Wl(e,t);if(e.choiceCtx?.kind==="EVENT")return jl(e,t);if(e.choiceCtx?.kind==="SHOP")return Kl(e,t)}return t==="skip"?(de(e),!0):!1}const On="deck-rogue-save-v1",Aa=1;function Gl(e){try{return JSON.parse(e)}catch{return null}}function ql(){return!!localStorage.getItem(On)}function Yl(){localStorage.removeItem(On)}function Xl(e,t){const n={ver:Aa,savedAt:Date.now(),build:t?.build,state:e};localStorage.setItem(On,JSON.stringify(n))}function Ql(){const e=localStorage.getItem(On);if(!e)return null;const t=Gl(e);return!t||t.ver!==Aa||!t.state?null:{state:t.state,savedAt:t.savedAt}}let Wt=null,ao=!1;function Zl(e){const n=(e??"").trim().match(/^url\((.*)\)$/i);if(!n)return null;let r=(n[1]??"").trim();return(r.startsWith('"')&&r.endsWith('"')||r.startsWith("'")&&r.endsWith("'"))&&(r=r.slice(1,-1)),r||null}function so(){if(ao)return;ao=!0;const e=document.documentElement,t=getComputedStyle(e).getPropertyValue("--bgUrl").trim(),n=Zl(t);if(!n){console.warn("[bg] --bgUrl is not a url(...):",t);return}const r=new Image;r.onload=()=>{},r.onerror=()=>{console.warn("[bg] failed to load dungeon background:",n)},r.src=n}function Jl(){if(Wt&&document.body.contains(Wt))return Wt;const e=document.querySelector(".bgLayer");if(e)return Wt=e,so(),e;const t=document.createElement("div");return t.className="bgLayer",t.style.zIndex="0",document.body.appendChild(t),Wt=t,so(),t}let pn=null,Yn=null,Xn=null,Qn=null;function Bt(){if(Yn)return Yn;const e=document.createElement("div");return e.id="itemHoverTip",e.className="itemHoverTip relicHoverTip",e.style.pointerEvents="none",e.style.position="fixed",e.style.left="0",e.style.top="0",e.style.zIndex="70000",document.body.appendChild(e),Yn=e,e}function it(){const e=getComputedStyle(document.documentElement).getPropertyValue("--u"),t=parseFloat(e);return Number.isFinite(t)&&t>0?t:1}function Le(e){const t=it(),n=e/t;return"calc("+(Number.isFinite(n)?n:0)+" * var(--u))"}function ec(e){const t=Bt(),n=We(e);t.innerHTML="";const r=document.createElement("div");r.className="relicTipTitle",r.textContent=n?.name??e;const o=document.createElement("div");o.className="relicTipBody",o.textContent=n?.text??"",t.appendChild(r),t.appendChild(o)}function wn(e,t){const n=Bt(),r=it(),o=12,a=14,s=o*r,i=a*r;let l=e+i,c=t+i;n.style.left=Le(l),n.style.top=Le(c);const d=n.getBoundingClientRect();l+d.width+s>window.innerWidth&&(l=window.innerWidth-d.width-s),c+d.height+s>window.innerHeight&&(c=window.innerHeight-d.height-s),l<s&&(l=s),c<s&&(c=s),n.style.left=Le(Math.round(l)),n.style.top=Le(Math.round(c))}function io(e,t,n){ec(e),Bt().classList.add("show"),wn(t,n),requestAnimationFrame(()=>wn(t,n))}function lo(){Bt().classList.remove("show")}function It(){if(Xn)return Xn;const e=document.createElement("div");return e.id="relicHoverTip",e.className="itemHoverTip relicHoverTip",e.style.pointerEvents="none",e.style.position="fixed",e.style.left="0",e.style.top="0",e.style.zIndex="70000",document.body.appendChild(e),Xn=e,e}function tc(e){const t=It(),n=pe?.[e]??{};t.innerHTML="";const r=document.createElement("div");r.className="relicTipTitle",r.textContent=n?.name??e;const o=document.createElement("div");o.className="relicTipBody",o.textContent=n?.text??"",t.appendChild(r),t.appendChild(o)}function _n(e,t){const n=It(),r=it(),o=12,a=14,s=o*r,i=a*r;let l=e+i,c=t+i;n.style.left=Le(l),n.style.top=Le(c);const d=n.getBoundingClientRect();l+d.width+s>window.innerWidth&&(l=window.innerWidth-d.width-s),c+d.height+s>window.innerHeight&&(c=window.innerHeight-d.height-s),l<s&&(l=s),c<s&&(c=s),n.style.left=Le(Math.round(l)),n.style.top=Le(Math.round(c))}function co(e,t,n){tc(e),It().classList.add("show"),_n(t,n),requestAnimationFrame(()=>_n(t,n))}function uo(){It().classList.remove("show")}function nc(e,t){e.addEventListener("pointerenter",c=>{const d=c;d.pointerType!=="touch"&&co(t,d.clientX??0,d.clientY??0)}),e.addEventListener("pointermove",c=>{const d=c;d.pointerType!=="touch"&&_n(d.clientX??0,d.clientY??0)},{passive:!0}),e.addEventListener("pointerleave",c=>{c.pointerType!=="touch"&&uo()});let n=null,r=0,o=0,a=!1,s=0;const i=()=>{n!=null&&(window.clearTimeout(n),n=null)};e.addEventListener("pointerdown",c=>{const d=c;d.pointerType==="touch"&&(a=!1,r=d.clientX,o=d.clientY,i(),n=window.setTimeout(()=>{a=!0,s=performance.now()+700,e.__relicHoverSuppressClickUntil=s,co(t,r,o)},320))},{passive:!0}),e.addEventListener("pointermove",c=>{const d=c;if(d.pointerType!=="touch")return;if(It().classList.contains("show")){_n(d.clientX,d.clientY);return}if(n==null)return;const m=d.clientX-r,u=d.clientY-o;m*m+u*u>144&&i()},{passive:!0});const l=()=>{i(),It().classList.contains("show")&&(s=Math.max(s,performance.now()+420),e.__relicHoverSuppressClickUntil=s,uo())};e.addEventListener("pointerup",c=>{c.pointerType==="touch"&&l()},{passive:!0}),e.addEventListener("pointercancel",c=>{c.pointerType==="touch"&&l()},{passive:!0}),e.addEventListener("click",c=>{a&&(a=!1,c.preventDefault(),c.stopPropagation())},!0)}function kr(e,t){e.addEventListener("pointerenter",c=>{const d=c;d.pointerType!=="touch"&&io(t,d.clientX??0,d.clientY??0)}),e.addEventListener("pointermove",c=>{const d=c;d.pointerType!=="touch"&&wn(d.clientX??0,d.clientY??0)},{passive:!0}),e.addEventListener("pointerleave",c=>{c.pointerType!=="touch"&&lo()});let n=null,r=0,o=0,a=!1,s=0;const i=()=>{n!=null&&(window.clearTimeout(n),n=null)};e.addEventListener("pointerdown",c=>{const d=c;d.pointerType==="touch"&&(a=!1,r=d.clientX,o=d.clientY,i(),n=window.setTimeout(()=>{a=!0,s=performance.now()+700,e.__itemHoverSuppressClickUntil=s,io(t,r,o)},320))},{passive:!0}),e.addEventListener("pointermove",c=>{const d=c;if(d.pointerType!=="touch")return;if(Bt().classList.contains("show")){wn(d.clientX,d.clientY);return}if(n==null)return;const m=d.clientX-r,u=d.clientY-o;m*m+u*u>144&&i()},{passive:!0});const l=()=>{i(),Bt().classList.contains("show")&&(s=Math.max(s,performance.now()+420),e.__itemHoverSuppressClickUntil=s,lo())};e.addEventListener("pointerup",c=>{c.pointerType==="touch"&&l()},{passive:!0}),e.addEventListener("pointercancel",c=>{c.pointerType==="touch"&&l()},{passive:!0}),e.addEventListener("click",c=>{a&&(a=!1,c.preventDefault(),c.stopPropagation())},!0)}function Ot(){if(Qn)return Qn;const e=document.createElement("div");return e.id="faithHoverTip",e.className="itemHoverTip relicHoverTip",e.style.pointerEvents="none",e.style.position="fixed",e.style.left="0",e.style.top="0",e.style.zIndex="120000",document.body.appendChild(e),Qn=e,e}function rc(e){const t=Ot(),n=be(e);t.innerHTML="";const r=n.offered,o=document.createElement("div");o.className="relicTipTitle";const a=ue(e);o.textContent=`í›„ì›: ${a?ge(a):"ì—†ìŒ"} / í¬ì»¤ìŠ¤: ${ge(n.focus)}`;const s=document.createElement("div");s.className="relicTipBody",s.style.whiteSpace="pre-wrap";const i=r.map(l=>{const c=n.points[l]??0;return`${ge(l)}: ${c}ì 
${Tn(l)}`});s.textContent=i.join(`

`),t.appendChild(o),t.appendChild(s)}function Sn(e,t){const n=Ot(),r=it(),o=12,a=14,s=o*r,i=a*r;let l=e+i,c=t+i;n.style.left=Le(l),n.style.top=Le(c);const d=n.getBoundingClientRect();l+d.width+s>window.innerWidth&&(l=window.innerWidth-d.width-s),c+d.height+s>window.innerHeight&&(c=window.innerHeight-d.height-s),l<s&&(l=s),c<s&&(c=s),n.style.left=Le(Math.round(l)),n.style.top=Le(Math.round(c))}function gn(e,t,n){rc(e),Ot().classList.add("show"),Sn(t,n),requestAnimationFrame(()=>Sn(t,n))}function En(){Ot().classList.remove("show")}function oc(e,t){e.addEventListener("pointerenter",n=>{const r=n;if(r.pointerType==="touch")return;const o=t();o&&gn(o,r.clientX,r.clientY)}),e.addEventListener("pointermove",n=>{const r=n;r.pointerType!=="touch"&&Sn(r.clientX,r.clientY)},{passive:!0}),e.addEventListener("pointerleave",n=>{n.pointerType!=="touch"&&En()}),e.addEventListener("pointerup",n=>{const r=n;if(r.pointerType!=="touch")return;const o=t();if(!o)return;if(Ot().classList.contains("show")){En();return}gn(o,r.clientX,r.clientY)},{passive:!0})}function ac(){if(pn)return pn;const e="/deck-rogue-prototype/";return pn=new URL(e,window.location.origin).href.replace(/\/?$/,"/"),pn}function he(e){if(!e||/^(https?:|data:|blob:)/i.test(e))return e;const t=s=>s.replace(/\.(png|jpe?g)(?=([?#].*)?$)/i,".webp"),n=e.replace(/^public\//,""),r=t(n),o=ac(),a=r.replace(/^\/+/,"");return new URL(a,o).href}let po=!1;function $a(){if(po)return;po=!0;const e=document.documentElement;if(e.style.setProperty("--boardUrl",`url("${he("assets/ui/boards/battle_board.png")}")`),e.style.setProperty("--cardBgBasic",`url("${he("assets/ui/cards/card_basic.png")}")`),e.style.setProperty("--cardBgCommon",`url("${he("assets/ui/cards/card_common.png")}")`),e.style.setProperty("--cardBgSpecial",`url("${he("assets/ui/cards/card_special.png")}")`),e.style.setProperty("--cardBgRare",`url("${he("assets/ui/cards/card_rare.png")}")`),e.style.setProperty("--cardBgMadness",`url("${he("assets/ui/cards/card_madness.png")}")`),e.style.setProperty("--cardUrl",`url("${he("assets/ui/cards/card_parchment.png")}")`),e.style.setProperty("--mapBgUrl",`url("${he("assets/ui/background/map_bg.png")}")`),!document.getElementById("deck-fontfaces")){const t=document.createElement("style");t.id="deck-fontfaces";const n=he("assets/fonts/Mulmaru.woff2"),r=he("assets/fonts/Mulmaru.woff");t.textContent=`@font-face {  font-family: "Mulmaru";  src: url("${n}") format("woff2"), url("${r}") format("woff");  font-weight: 400;  font-style: normal;  font-display: swap;}:root { --gameFont: "Mulmaru", system-ui, -apple-system, "Segoe UI", Arial, sans-serif; }body { font-family: var(--gameFont); }`,document.head.appendChild(t)}Jl()}let Et=!1,Ir=null,_t=[],Ut=[],nt=-1;function sc(e){return Array.from(new Set(e)).sort((t,n)=>t.localeCompare(n))}function fo(e,t){return e.toLowerCase().startsWith(t.toLowerCase())}function ic(e){const t=e.content?.itemsById??e.content?.ITEMS_BY_ID??{};return Object.keys(t).sort((n,r)=>n.localeCompare(r))}function lc(e,t){return!!(e.content?.itemsById??e.content?.ITEMS_BY_ID??{})[t]}function cc(){return[{name:"help",desc:"show commands"},{name:"state",desc:"print game state"},{name:"newrun",desc:"start new run"},{name:"hp",args:"<n>",desc:"set current hp"},{name:"maxhp",args:"<n>",desc:"set max hp"},{name:"supplies",args:"<n>",desc:"set supplies"},{name:"fatigue",args:"<n>",desc:"set fatigue"},{name:"phase",args:"<PLACE|BACK|FRONT|ENEMY|UPKEEP|DRAW|NODE>",desc:"set phase",suggest:()=>["PLACE","BACK","FRONT","ENEMY","UPKEEP","DRAW","NODE"]},{name:"addcard",args:"<defId> [upgrade=0] [zone=deck|hand|discard]",desc:"add card",suggest:(e,t)=>t.length<=2?hl():t.length===4?["deck","hand","discard"]:[]},{name:"removecard",args:"<uid>",desc:"remove card",suggest:e=>sc(Object.keys(e.cards??{}))},{name:"win",desc:"force victory"},{name:"lose",desc:"force defeat"},{name:"log",args:"<text...>",desc:"log message"},{name:"addrelic",args:"<relicId> [now|locked|unlocked]",desc:"grant relic",suggest:(e,t)=>t.length<=2?rl():t.length===3?["now","locked","unlocked"]:[]},{name:"relicapply",desc:"apply pending relic activations"},{name:"gold",args:"<n>",desc:"set gold"},{name:"additem",args:"<itemId> [n=1]",desc:"add item(s) to inventory",suggest:(e,t)=>t.length<=2?ic(e):[]},{name:"faith",desc:"print faith state"},{name:"tempt",args:"<dream_shadow|wing_artery|master_spear|retort_fusion|...>",desc:"open a god temptation choice",suggest:()=>["dream_shadow","wing_artery","master_spear","retort_fusion","nameless_vow","bright_darkness","twin_heart","indifferent_one","armored_tiger","first_human","card_dealer","rabbit_hunt","wave_breath","forge_master"]}]}function Nn(e,t){_t.push({t:Date.now(),kind:e,text:t}),_t.length>300&&(_t=_t.slice(-300))}function dc(e){Ir=e}function uc(){return Et}function pc(e){Et=!Et,St()}function St(){if(document.querySelector(".devConsole")?.remove(),!Et)return;const e=document.createElement("div");e.className="devConsole",e.style.cssText=`
    position: fixed; inset: 0;
    z-index: var(--zDevConsole);
    pointer-events: auto;
    background: rgba(0,0,0,.35);
    backdrop-filter: blur(calc(4 * var(--u)));
    display:flex; align-items:flex-end; justify-content:center;
    padding: calc(12 * var(--u));
    box-sizing: border-box;
  `;const t=document.createElement("div");t.style.cssText=`
    width: min(calc(980 * var(--u)), 100%);
    height: min(calc(420 * var(--u)), 70vh);
    border-radius: calc(16 * var(--u));
    border: calc(1 * var(--u)) solid rgba(255,255,255,.14);
    background: rgba(10,12,14,.92);
    box-shadow: 0 calc(18 * var(--u)) calc(60 * var(--u)) rgba(0,0,0,.55);
    display:flex;
    flex-direction: column;
    overflow:hidden;
  `;const n=document.createElement("div");n.style.cssText=`
    padding: calc(10 * var(--u)) calc(12 * var(--u));
    display:flex; align-items:center; justify-content:space-between;
    border-bottom: calc(1 * var(--u)) solid rgba(255,255,255,.10);
  `;const r=document.createElement("div");r.textContent="Dev Console",r.style.cssText="font-weight:800; color:#fff; opacity:.95;";const o=document.createElement("div");o.style.cssText="display:flex; gap:calc(8 * var(--u));";const a=(T,C)=>{const x=document.createElement("button");return x.type="button",x.textContent=T,x.style.cssText=`
      padding: calc(6 * var(--u)) calc(10 * var(--u));
      border-radius: calc(10 * var(--u));
      border: calc(1 * var(--u)) solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: #fff;
      cursor: pointer;
      font-weight: 700;
    `,x.onclick=C,x};o.appendChild(a("Clear",()=>{_t=[],St()})),o.appendChild(a("Close",()=>{Et=!1,St()})),n.appendChild(r),n.appendChild(o);const s=document.createElement("div");s.className="devConsoleOut",s.style.cssText=`
    flex: 1 1 auto;
    padding: calc(10 * var(--u)) calc(12 * var(--u));
    overflow: auto;
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: calc(12 * var(--u));
    line-height: 1.4;
    color: #ddd;
    white-space: pre-wrap;
  `;const i=T=>(T.kind==="in"?"> ":T.kind==="err"?"! ":"  ")+T.text;s.textContent=_t.map(i).join(`
`),queueMicrotask(()=>{s.scrollTop=s.scrollHeight});const l=document.createElement("div");l.style.cssText=`
    border-top: calc(1 * var(--u)) solid rgba(255,255,255,.10);
    padding: calc(10 * var(--u)) calc(12 * var(--u));
    display:flex; gap:calc(10 * var(--u)); align-items:center;
  `;const c=document.createElement("div");c.className="devConsoleHint",c.style.cssText=`
    margin-left: calc(10 * var(--u));
    max-width: 45%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    color: rgba(255,255,255,.55);
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: calc(12 * var(--u));
  `;const d=document.createElement("div");d.textContent=">",d.style.cssText="color:#fff; font-weight:900; opacity:.9;";const h=document.createElement("input");h.type="text",h.placeholder="help / state / newrun ...",h.style.cssText=`
    flex: 1 1 auto;
    padding: calc(10 * var(--u)) calc(12 * var(--u));
    border-radius: calc(12 * var(--u));
    border: calc(1 * var(--u)) solid rgba(255,255,255,.14);
    background: rgba(255,255,255,.06);
    color: #fff;
    outline: none;
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size: calc(13 * var(--u));
  `;const m=cc();let u={base:"",items:[],idx:-1,lastApplied:""};const p=T=>{const C=Ir?.getG();if(!C)return[];const x=T.split(/\s+/).filter(Boolean),N=/\s$/.test(T);if(x.length===0)return m.map(M=>M.name);if(x.length===1&&!N){const M=x[0];return m.map(B=>B.name).filter(B=>fo(B,M))}const W=(x[0]??"").toLowerCase(),j=m.find(M=>M.name===W);if(!j?.suggest)return[];const U=N?"":x[x.length-1]??"";return j.suggest(C,x).filter(M=>fo(M,U))},y=(T,C)=>{const x=/\s$/.test(T);if(!T.trim())return C+" ";const N=T.split(/\s+/);return x?T+C+" ":(N[N.length-1]=C,N.join(" ")+" ")},k=()=>{const T=p(h.value);if(!T.length){c.textContent="";return}const C=T.slice(0,6);c.textContent=C.join("  ")};h.onkeydown=T=>{if(T.key==="Escape"){Et=!1,St();return}if(T.key==="Enter"){const C=h.value.trim();if(!C)return;h.value="",Ut.unshift(C),nt=-1,Nn("in",C);try{fc(C)}catch(x){Nn("err",String(x?.message??x))}St();return}if(T.key==="ArrowUp"){T.preventDefault();const C=Ut.length;if(C===0)return;nt=Math.min(C-1,nt+1),h.value=Ut[nt]??"";return}if(T.key==="ArrowDown"){if(T.preventDefault(),Ut.length===0)return;nt=Math.max(-1,nt-1),h.value=nt>=0?Ut[nt]??"":"";return}if(T.key==="Tab"){T.preventDefault();const C=T.shiftKey===!0,x=h.value;if(!(u.items.length>0&&(x===u.lastApplied||x===u.base))){const U=p(x);u.base=x,u.items=U,u.idx=-1,u.lastApplied=x}if(!u.items.length){k();return}C?u.idx=(u.idx-1+u.items.length)%u.items.length:u.idx=(u.idx+1)%u.items.length;const W=u.items[u.idx],j=y(u.base,W);h.value=j,u.lastApplied=j,k();return}},h.oninput=()=>{u.items=[],u.base="",u.idx=0,k()},l.appendChild(d),l.appendChild(h),l.appendChild(c),t.appendChild(n),t.appendChild(s),t.appendChild(l),t.onclick=T=>T.stopPropagation(),e.appendChild(t),document.body.appendChild(e),k(),queueMicrotask(()=>h.focus())}function fc(e){const t=Ir;if(!t){Nn("err","Dev console context not set");return}const n=t.getG(),r=e.split(/\s+/).filter(Boolean),o=(r[0]??"").toLowerCase(),a=r[1],s=r[2],i=c=>Nn("out",c);if(o==="help"){i(["help","state","newrun","hp <n> | maxhp <n> | supplies <n> | fatigue <n>","phase <PLACE|BACK|FRONT|ENEMY|UPKEEP|DRAW|NODE>","addcard <defId> [upgrade=0] [zone=deck|hand|discard]","removecard <uid>","addrelic <relicId> [now|locked|unlocked]","relicapply  (apply pending relic activations)","win | lose","log <text...>","gold <n>","additem <itemId> [n=1]","faith","tempt <dream_shadow|wing_artery|master_spear|retort_fusion|...>"].join(`
`));return}if(o==="state"){i(JSON.stringify({phase:n.phase,hp:`${n.player.hp}/${n.player.maxHp}`,supplies:n.player.supplies,fatigue:n.player.fatigue,deck:n.deck.length,hand:n.hand.length,discard:n.discard.length,enemies:n.enemies.map(c=>({id:c.id,hp:`${c.hp}/${c.maxHp}`,intent:c.intentIndex})),gold:n.run.gold??0,items:n.run.items??[]},null,2));return}if(o==="faith"){const c=be(n);i(JSON.stringify({chosen:c.chosen,offered:c.offered.map(ge),points:Object.fromEntries(c.offered.map(d=>[ge(d),c.points[d]??0])),focus:ge(c.focus),patron:(c.points[c.focus]??0)>=3?ge(c.focus):null},null,2));return}if(o==="tempt"){const c=a??"";if(!c){i("ERR: tempt <dream_shadow|wing_artery|master_spear|retort_fusion|...>");return}Yo(n,c),t.rerender(),i(`OK: tempt ${c}`);return}if(o==="newrun"){t.actions.onNewRun(),i("OK: newrun");return}const l=(c,d)=>{const h=Number(a);if(!Number.isFinite(h)){i(`ERR: ${c} requires number`);return}d(h),t.rerender(),i(`OK: ${c} = ${h}`)};if(o==="hp")return l("hp",c=>n.player.hp=Math.max(0,Math.min(n.player.maxHp,c)));if(o==="maxhp")return l("maxHp",c=>{n.player.maxHp=Math.max(1,c),n.player.hp=Math.min(n.player.hp,n.player.maxHp)});if(o==="supplies")return l("supplies",c=>n.player.supplies=Math.max(0,c));if(o==="fatigue")return l("fatigue",c=>n.player.fatigue=Math.max(0,c));if(o==="phase"){const c=(a??"").toUpperCase();if(!new Set(["PLACE","BACK","FRONT","ENEMY","UPKEEP","DRAW","NODE"]).has(c)){i("ERR: phase invalid");return}n.phase=c,t.rerender(),i(`OK: phase=${c}`);return}if(o==="log"){const c=e.slice(e.indexOf(" ")+1);if(!c||c===e){i("ERR: log <text...>");return}t.log?.(`[DEV] ${c}`),i("OK: logged");return}if(o==="addcard"){const c=a;if(!c){i("ERR: addcard <defId> [upgrade=0] [zone=deck|hand|discard]");return}const d=Math.max(0,Number(s??"0")||0),h=r[3]??"deck";Ve(n,c,{upgrade:d});const m=n.deck[n.deck.length-1];m&&h!=="deck"&&(n.deck=n.deck.filter(u=>u!==m),h==="hand"?n.hand.push(m):h==="discard"&&n.discard.push(m),n.cards[m].zone=h),t.log?.(`[DEV] addcard ${c} +${d} (${h}) uid=${m}`),t.rerender(),i(`OK: addcard uid=${m}`);return}if(o==="removecard"){const c=a;if(!c){i("ERR: removecard <uid>");return}if(!n.cards[c]){i(`ERR: uid not found: ${c}`);return}const d=n.deck.includes(c),h=n.hand.includes(c),m=n.discard.includes(c);!d&&!h&&!m&&i(`WARN: uid exists but not in piles (deck/hand/discard): ${c} (zone=${n.cards[c]?.zone??"?"})`),Qt(n,c),t.log?.(`[DEV] removecard ${c}`),t.rerender(),i("OK: removecard");return}if(o==="addrelic"){const c=a,d=(s??"").toLowerCase();if(!c){i("ERR: addrelic <relicId> [now|locked|unlocked]");return}Jt(n,c);const h=n.run;if(h.forceLockedRelics??={},h.forceUnlockedRelics??={},d==="locked"){h.forceLockedRelics[c]=!0,delete h.forceUnlockedRelics[c],h.relicRuntime??={},h.relicRuntime[c]??={active:!1,pending:!1,obtainedAtNode:n.run.nodePickCount},h.relicRuntime[c].active=!1,h.relicRuntime[c].pending=!1,t.log?.(`[DEV] addrelic ${c} (locked)`),t.rerender(),i(`OK: addrelic ${c} (locked)`);return}if(d==="unlocked"){h.forceUnlockedRelics[c]=!0,delete h.forceLockedRelics[c],t.log?.(`[DEV] addrelic ${c} (unlocked)`),t.rerender(),i(`OK: addrelic ${c} (unlocked)`);return}d==="now"&&fe(n),t.log?.(`[DEV] addrelic ${c}${d?` (${d})`:""}`),t.rerender(),i(`OK: addrelic ${c}`);return}if(o==="relicapply"){fe(n),t.log?.("[DEV] relicapply"),t.rerender(),i("OK: relicapply");return}if(o==="gold")return l("gold",c=>{const d=n.run;d.gold=Math.max(0,c|0)});if(o==="additem"){const c=a,d=Math.max(1,Number(s??"1")||1);if(!c){i("ERR: additem <itemId> [n=1]");return}lc(n,c)||i(`WARN: unknown itemId (still adding): ${c}`);const h=n.run;h.items??=[];for(let m=0;m<d;m++)h.items.push(c);t.log?.(`[DEV] additem ${c} x${d}`),t.rerender(),i(`OK: additem ${c} x${d}`);return}if(o==="win"){if(!n.enemies||n.enemies.length===0){i("WARN: enemies=0");return}for(const c of n.enemies)c.hp=0;n.enemies=[],n.pendingTarget=null,n.pendingTargetQueue=[],n.selectedEnemyIndex=null,Rt(n),t.log?.("[DEV] win"),t.rerender(),i("OK: win");return}if(o==="lose"){n.run.finished=!0,t.log?.("[DEV] lose"),t.rerender(),i("OK: lose");return}i(`Unknown command: ${o} (try: help)`)}let Ma=0,Dn=null;function Pa(){return performance.now()<Ma}function An(e=250){Ma=performance.now()+e}function hc(){return Dn}function mc(e){Dn=e}function zt(e){const t=document.createElement("div");return e&&(t.className=e),t}function en(){Dn=null;try{Qe.hide()}catch{}const e=document.querySelector(".cardHoverPreview");e&&e.classList.remove("on","pinned")}const Qe=bc();function bc(){let e=null,t=null,n=null,r=null,o=!1,a=!1;function s(m){if(e)return;e=zt("cardHoverPreview"),t=zt("cardHoverPreviewTitle");const u=zt("cardHoverPreviewRow");n=zt("cardHoverPreviewCard"),r=zt("cardHoverPreviewDetail"),u.appendChild(n),u.appendChild(r),e.appendChild(t),e.appendChild(u),m.appendChild(e),a||(a=!0,document.addEventListener("pointerdown",p=>{if(!o||!e)return;const y=p.target;y&&(e.contains(y)||(Dn=null,d(),l()))},!0))}function i(m){!e||!t||!n||!r||(t.textContent=m.title,n.innerHTML="",m.cardEl&&n.appendChild(m.cardEl),r.textContent=m.detail,e.classList.add("on"))}function l(){e&&e.classList.remove("on")}function c(){e&&(o=!0,e.classList.add("pinned"),e.style.pointerEvents="auto")}function d(){e&&(o=!1,e.classList.remove("pinned"),e.style.pointerEvents="none")}function h(){return o}return{ensure:s,show:i,hide:l,pin:c,unpin:d,isPinned:h}}let ho=!1,Y=null,rt=null;function yc(e,t){let n=e;for(;n;){const r=n.dataset;let o=!0;for(const a of t)if(!r[a]){o=!1;break}if(o)return n;n=n.parentElement}return null}function kc(e,t){const n=document.elementFromPoint(e,t);if(!n)return!1;let r=n;for(;r;){if(r.dataset?.dropHand==="1")return!0;r=r.parentElement}return!1}function mo(e,t,n){const r=document.elementFromPoint(e,t);if(!r)return null;const o=yc(r,["slotSide","slotIndex"]);if(!o)return null;const a=o.dataset.slotSide,s=Number(o.dataset.slotIndex),i=n.run,l=Number(a==="front"?i.slotCapFront:i.slotCapBack),c=Math.max(3,Math.min(4,Math.floor(Number.isFinite(l)?l:3)));return s<0||s>=c||a==="back"&&n.backSlotDisabled?.[s]||a==="front"&&s===1&&(n.enemies??[]).some(d=>d&&d.hp>0&&d.id==="living_chain")?null:{side:a,idx:s}}function Tc(e){const{setHandScrollLocked:t,getOverlay:n,normalizePlacementCounters:r,cardDisplayNameByUid:o,renderAll:a}=e;function s(){return!!(Y&&Y.dragging)}function i(){return Y?Y.pointerId:null}function l(){return rt}function c(){t(!1),Y?.sourceEl&&Y.sourceEl.classList.remove("isDraggingSource"),Y=null,rt=null,ur(null),document.querySelector(".dragLayer")?.remove()}function d(u,p){An(250),en(),t(!0);const y=u.currentTarget;try{y.setPointerCapture(u.pointerId)}catch{}const k=y.closest(".card");k&&k.classList.add("isDraggingSource");const T=k?.getBoundingClientRect(),C=T?u.clientX-T.left:20,x=T?u.clientY-T.top:20,N=getComputedStyle(document.documentElement),W=parseFloat(N.getPropertyValue("--handCardW"))||void 0,j=parseFloat(N.getPropertyValue("--handCardH"))||void 0,U=document.body.classList.contains("mobile");let V,M;const B=document.querySelector(".slot .slotCardInner")??document.querySelector(".slot > .card")??null;if(B){const F=B.getBoundingClientRect();F.width>0&&F.height>0&&(V=F.width,M=F.height)}if(Y={kind:p.kind,cardUid:p.cardUid,fromHandIndex:p.fromHandIndex,fromSide:p.fromSide,fromIdx:p.fromIdx,pointerId:u.pointerId,startX:u.clientX,startY:u.clientY,x:u.clientX,y:u.clientY,dragging:!1,previewEl:void 0,previewW:U?T?.width??W??V:V??T?.width??W,previewH:U?T?.height??j??M:M??T?.height??j,grabDX:C,grabDY:x},k){Y.sourceEl=k;const F=k.cloneNode(!0),K=getComputedStyle(k);F.classList.remove("inSlot"),F.classList.remove("selected"),F.classList.remove("isDraggingSource"),F.style.position="static",F.style.inset="",F.style.width="100%",F.style.height="100%",F.style.margin="0",F.style.boxSizing="border-box",F.style.opacity="1",F.style.filter="none",F.style.transform="none",F.style.backgroundColor="transparent";const re=K.getPropertyValue("--cardInnerMul").trim(),ae=K.getPropertyValue("--slotTextScale").trim();re&&F.style.setProperty("--cardInnerMul",re),ae&&F.style.setProperty("--slotTextScale",ae),F.style.fontSize=K.fontSize,F.style.lineHeight=K.lineHeight,Y.previewEl=F}}function h(u,p){if(!Y||!Y.dragging){document.querySelector(".dragLayer")?.remove();return}let y=document.querySelector(".dragLayer");if(y||(y=document.createElement("div"),y.className="dragLayer",y.style.position="fixed",y.style.inset="0",y.style.zIndex="21000",y.style.pointerEvents="none",document.body.appendChild(y)),y.innerHTML="",!Y.previewEl)return;const k=document.createElement("div");k.className="dragCardPreview",k.style.position="fixed";const T=(Y.x-(Y.grabDX??20))/window.innerWidth*100,C=(Y.y-(Y.grabDY??20))/window.innerHeight*100;k.style.left=`${T.toFixed(4)}vw`,k.style.top=`${C.toFixed(4)}vh`;const x=Y.previewW??0,N=Y.previewH??0;if(x>0){const W=x/window.innerWidth*100;k.style.width=`${W.toFixed(4)}vw`}if(N>0){const W=N/window.innerHeight*100;k.style.height=`${W.toFixed(4)}vh`}k.style.transform="none",k.style.opacity="1",k.style.filter="none",k.style.boxShadow="0 calc(16 * var(--u)) calc(44 * var(--u)) rgba(0,0,0,.65)",k.style.backdropFilter="none",k.style.isolation="isolate",k.style.mixBlendMode="normal",k.style.overflow="hidden",k.style.borderRadius="0",k.style.background="transparent",k.style.clipPath="inset(0)",k.appendChild(Y.previewEl),y.appendChild(k)}function m(u,p){if(ho)return;ho=!0;const y=()=>{if(!Y)return;const k=u();c(),a(k)};window.addEventListener("pointermove",k=>{const T=u();if(T.choice||n()||!Y||k.pointerId!==Y.pointerId)return;Y.x=k.clientX,Y.y=k.clientY;const C=Y.x-Y.startX,x=Y.y-Y.startY,N=Y.dragging;!Y.dragging&&C*C+x*x>36&&(Y.dragging=!0),!N&&Y.dragging&&(An(250),en()),rt=Y.dragging?mo(k.clientX,k.clientY,T):null,h(document.querySelector("#app")),ur(rt)},{passive:!0}),window.addEventListener("pointerup",k=>{const T=u();if(!(!Y||k.pointerId!==Y.pointerId)){if(t(!1),T.choice||n()){Y?.sourceEl&&Y.sourceEl.classList.remove("isDraggingSource"),Y=null,rt=null,a(T);return}if(Y.dragging){const C=kc(k.clientX,k.clientY),x=mo(k.clientX,k.clientY,T);if(C&&Y.kind==="slot"&&Y.fromSide!=null&&Y.fromIdx!=null){!T.run.finished&&!we(T)&&T.phase==="PLACE"&&p.onReturnSlotToHand(Y.fromSide,Y.fromIdx),Y=null,rt=null,a(T);return}if(x)if(Y.kind==="hand"){const N=u();if(!(N.run.finished||we(N)||N.phase!=="PLACE")){const W=x.side,j=x.idx;if(!(W==="back"&&N.backSlotDisabled?.[j])){const U=W==="front"?N.frontSlots:N.backSlots,V=U[j];if(!V)p.onPlaceHandUidToSlot(Y.cardUid,W,j);else{const M=N.cards[V];if(xe(N.content,M.defId,M.upgrade??0).tags?.includes("LOCKED")){q(N,"WARN","ì ê¸´ ì¹´ë“œëŠ” ì´ë™í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",1600),Y=null,rt=null,a(N);return}const F=Y.fromHandIndex!=null&&Y.fromHandIndex>=0?Y.fromHandIndex:N.hand.indexOf(Y.cardUid),K=N.hand.indexOf(Y.cardUid);K>=0&&N.hand.splice(K,1),U[j]=Y.cardUid,N.cards[Y.cardUid].zone=W;const re=F!=null&&F>=0&&F<=N.hand.length?F:N.hand.length;N.hand.splice(re,0,V),N.cards[V].zone="hand",N.selectedHandCardUid=null,r(N),f(N,`[${o(N,Y.cardUid)}] â†” [${o(N,V)}] ìŠ¤ì™‘: ì†íŒ¨ â†” ${W}${j+1}`),a(N)}}}}else Y.kind==="slot"&&Y.fromSide!=null&&Y.fromIdx!=null&&(Y.fromSide===x.side&&Y.fromIdx===x.idx||p.onMoveSlotCard(Y.fromSide,Y.fromIdx,x.side,x.idx))}Y?.sourceEl&&Y.sourceEl.classList.remove("isDraggingSource"),Y=null,rt=null,a(T)}}),window.addEventListener("pointercancel",k=>{!Y||k.pointerId!==Y.pointerId||y()},{passive:!0}),window.addEventListener("blur",()=>{y()},{passive:!0}),document.addEventListener("visibilitychange",()=>{document.visibilityState!=="visible"&&y()},{passive:!0})}return{isDraggingNow:s,getDragPointerId:i,getHoverSlot:l,beginDrag:d,clear:c,renderDragOverlay:h,bindGlobalDragInput:m}}let bo=!1,Ue=null;function vc(e){document.body.classList.toggle("handDragScrollLock",e);const t=document.querySelector(".hand");t&&(e?(t.style.overflowX="hidden",t.style.touchAction="none"):(t.style.overflowX="",t.style.touchAction=""))}function xc(e){e.dataset?.wheelX!=="1"&&(e.dataset.wheelX="1",e.addEventListener("wheel",t=>{if(document.body.classList.contains("handDragScrollLock")){t.preventDefault();return}if(t.shiftKey)return;const n=Math.abs(t.deltaX)>Math.abs(t.deltaY)?t.deltaX:t.deltaY;e.scrollLeft+=n,t.preventDefault()},{passive:!1}))}function Cc(){return Ue?Ue.isDraggingNow():!1}function wc(){return Ue?Ue.getDragPointerId():null}function _c(){return Ue?Ue.getHoverSlot():null}function Ra(e,t){Ue?.beginDrag(e,t)}function Sc(){Ue?.clear()}function gc(e,t){Ue?.renderDragOverlay(e,t)}function Ec(e){bo||(bo=!0,Ue||(Ue=Tc({setHandScrollLocked:vc,getOverlay:e.getOverlay,normalizePlacementCounters:e.normalizePlacementCounters,cardDisplayNameByUid:e.cardDisplayNameByUid,renderAll:e.renderAll}),Ue.bindGlobalDragInput(e.getG,{onReturnSlotToHand:(t,n)=>e.getActions().onReturnSlotToHand(t,n),onPlaceHandUidToSlot:(t,n,r)=>e.getActions().onPlaceHandUidToSlot(t,n,r),onMoveSlotCard:(t,n,r,o)=>e.getActions().onMoveSlotCard(t,n,r,o)})),window.addEventListener("pointerup",t=>{t.pointerType==="mouse"&&e.clearAllHover()},{capture:!0,passive:!0}),window.addEventListener("keydown",t=>{const n=t.target;if(n&&(n.tagName==="INPUT"||n.tagName==="TEXTAREA"))return;if(t.ctrlKey&&t.shiftKey&&t.code==="KeyK"){t.preventDefault(),pc();return}if(uc())return;const r=e.getG(),o=e.getActions();if(t.code==="KeyP"){t.preventDefault(),o.onNewRun();return}if(t.code==="Digit4"){if(t.preventDefault(),we(r)){r.pendingTarget=null,r.pendingTargetQueue=[],r.selectedEnemyIndex=null,f(r,"ëŒ€ìƒ ì„ íƒ ì·¨ì†Œ"),e.renderAll(r);return}o.onClearSelected();return}if(t.key==="Tab"){if(t.preventDefault(),r.hand.length===0)return;const a=r.selectedHandCardUid,s=a?r.hand.indexOf(a):-1,i=t.shiftKey?-1:1,l=((s+i)%r.hand.length+r.hand.length)%r.hand.length;r.selectedHandCardUid=r.hand[l],e.renderAll(r);return}if(t.code==="Space"){if(t.preventDefault(),r.run.finished||r.choice||we(r))return;o.onAutoAdvance();return}if(t.code==="Digit1"||t.code==="Digit2"||t.code==="Digit3"){t.preventDefault();const a=t.code==="Digit1"?0:t.code==="Digit2"?1:2;if(we(r)){const s=r.enemies[a];if(!s||s.hp<=0){f(r,`ëŒ€ìƒ ì„ íƒ ì‹¤íŒ¨: ${a+1}ë²ˆ ì ì´ ì—†ìŠµë‹ˆë‹¤.`),e.renderAll(r);return}o.onSelectEnemy(a);return}o.onHotkeySlot("front",a);return}if(t.code==="KeyQ"||t.code==="KeyW"||t.code==="KeyE"){t.preventDefault();const a=t.code==="KeyQ"?0:t.code==="KeyW"?1:2;o.onHotkeySlot("back",a);return}if(t.code==="Enter"){t.preventDefault();const{action:a,disabled:s}=e.getLastEnter();!s&&a&&a();return}}))}const Ba="deckrogue_uiSettings_v1",Nt=(e,t,n)=>Math.max(t,Math.min(n,e));function Lr(){const e=document.body;if(e?.classList.contains("mobile"))return!0;if(e?.classList.contains("desktop"))return!1;const t=window.innerWidth,n=window.matchMedia?.("(pointer: coarse)")?.matches??!1;return t<=900&&n}function Ia(){try{const e=localStorage.getItem(Ba);if(!e)return{uiScaleDesktop:1,uiScaleMobile:1,slotCardMode:"FULL",animMul:1};const t=JSON.parse(e),n=t.slotCardMode==="NAME_ONLY"?"NAME_ONLY":"FULL";return{uiScaleDesktop:Nt(Number(t.uiScaleDesktop??1)||1,.75,1.5),uiScaleMobile:Nt(Number(t.uiScaleMobile??1)||1,.75,1.5),slotCardMode:n,animMul:Nt(Number(t.animMul??1)||1,0,2)}}catch{return{uiScaleDesktop:1,uiScaleMobile:1,slotCardMode:"FULL",animMul:1}}}let Ie=Ia();function Nc(){return Ie=Ia(),Ie}function Ac(){return Ie}function Tr(){try{localStorage.setItem(Ba,JSON.stringify(Ie))}catch{}}function $c(){const e=Ie,t=Lr()?e.uiScaleMobile:e.uiScaleDesktop;return Nt(t,.65,1.5)}function Or(){return Nt(Number(Ie.animMul??1)||1,0,2)}function Dr(e){return Math.max(0,Math.round(e*Or()))}function vr(){const e=document.documentElement;e.style.setProperty("--uiScaleDesktop",String(Ie.uiScaleDesktop)),e.style.setProperty("--uiScaleMobile",String(Ie.uiScaleMobile)),e.style.setProperty("--animMul",String(Or()))}function Zn(e){const t=Nt(e,.75,1.5);Lr()?Ie.uiScaleMobile=t:Ie.uiScaleDesktop=t,Tr(),vr(),window.dispatchEvent(new CustomEvent("deckrogue:uiFit"))}function fn(e,t){const n=document.createElement("button");return n.type="button",n.textContent=e,n.addEventListener("click",r=>{r.preventDefault(),r.stopPropagation(),t()}),n}function Mc(e,t){const n=L("settingsPanel");n.style.cssText="display:flex; flex-direction:column; gap:calc(12 * var(--u));";const r=L("settingsRow");r.style.cssText="display:flex; align-items:center; gap:calc(12 * var(--u)); flex-wrap:wrap;";const o=Te("","UI ìŠ¤ì¼€ì¼");o.style.cssText="font-weight:800;";const a=()=>Lr()?Ie.uiScaleMobile:Ie.uiScaleDesktop,s=Te("",`${Math.round(a()*100)}%`);s.style.cssText="opacity:.9; min-width:calc(64 * var(--u)); text-align:right;";const i=document.createElement("input");i.type="range",i.min="0.75",i.max="1.25",i.step="0.01",i.value=String(a()),i.style.cssText="flex:1 1 calc(260 * var(--u));",i.oninput=()=>{const T=Number(i.value);Zn(T),s.textContent=`${Math.round(a()*100)}%`,e()},r.appendChild(o),r.appendChild(i),r.appendChild(s),n.appendChild(r);const l=L("settingsPresets");l.style.cssText="display:flex; gap:calc(8 * var(--u)); flex-wrap:wrap;";const c=(T,C)=>{const x=fn(T,()=>{Zn(C),i.value=String(a()),s.textContent=`${Math.round(a()*100)}%`,e()});return x.style.cssText="padding:calc(8 * var(--u)) calc(12 * var(--u)); border-radius:calc(12 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.16);background:rgba(255,255,255,.06); color:#fff; cursor:pointer;",x};l.appendChild(c("ì‘ê²Œ 90%",.9)),l.appendChild(c("ê¸°ë³¸ 100%",1)),l.appendChild(c("í¬ê²Œ 110%",1.1)),l.appendChild(c("ë” í¬ê²Œ 120%",1.2)),n.appendChild(l);const d=L("settingsResetRow");d.style.cssText="display:flex; justify-content:flex-end; margin-top:calc(6 * var(--u));";const h=fn("ìŠ¤ì¼€ì¼ ì´ˆê¸°í™”",()=>{Zn(1),i.value=String(a()),s.textContent=`${Math.round(a()*100)}%`,e()});h.style.cssText="padding:calc(8 * var(--u)) calc(12 * var(--u)); border-radius:calc(12 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.16);background:rgba(255,255,255,.06); color:#fff; cursor:pointer;",d.appendChild(h),n.appendChild(d);const m=L("settingsRow");m.style.cssText="display:flex; align-items:center; gap:calc(12 * var(--u)); flex-wrap:wrap;";const u=Te("","ìŠ¬ë¡¯ ì¹´ë“œ í‘œì‹œ");u.style.cssText="font-weight:800;";const p=Ie.slotCardMode??"FULL",y=fn("ì „ì²´",()=>{Ie.slotCardMode="FULL",Tr(),e()}),k=fn("ì´ë¦„ë§Œ",()=>{Ie.slotCardMode="NAME_ONLY",Tr(),e()});return y.style.cssText=`padding:calc(8 * var(--u)) calc(12 * var(--u)); border-radius:calc(12 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.16);
    background:${p==="FULL"?"rgba(255,255,255,.16)":"rgba(255,255,255,.06)"}; color:#fff; cursor:pointer;`,k.style.cssText=`padding:calc(8 * var(--u)) calc(12 * var(--u)); border-radius:calc(12 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.16);
    background:${p==="NAME_ONLY"?"rgba(255,255,255,.16)":"rgba(255,255,255,.06)"}; color:#fff; cursor:pointer;`,m.appendChild(u),m.appendChild(y),m.appendChild(k),n.appendChild(m),n}function Pc(e){return new Promise(t=>window.setTimeout(t,e))}function Rc(e){switch(e){case"BACK":return 100;case"FRONT":return 100;case"ENEMY":return 100;case"UPKEEP":return 100;case"DRAW":return 100;case"PLACE":return 0;default:return 220}}let La=null,Oa=!0;function yo(e,t){La=e,Oa=t}function Bc(){return{action:La,disabled:Oa}}function Da(e,t,n,r){return e.run.finished?{label:"ì¢…ë£Œ",fn:null,disabled:!0,activePhase:e.phase}:e.choice||r?{label:"ì„ íƒ ì¤‘",fn:null,disabled:!0,activePhase:e.phase}:n?{label:"ëŒ€ìƒ ì„ íƒ",fn:null,disabled:!0,activePhase:e.phase}:e.phase==="NODE"?{label:"ë…¸ë“œ ì„ íƒ",fn:null,disabled:!0,activePhase:e.phase}:e.phase==="PLACE"?e.enemies.length>0&&!e.intentsRevealedThisTurn?{label:"ë‹¤ìŒ: ì •ì°°",fn:t.onRevealIntents,disabled:!1,activePhase:e.phase}:{label:"ë‹¤ìŒ: í›„ì—´",fn:t.onResolveBack,disabled:!1,activePhase:e.phase}:e.phase==="BACK"?{label:"ë‹¤ìŒ: í›„ì—´",fn:t.onResolveBack,disabled:!1,activePhase:e.phase}:e.phase==="FRONT"?{label:"ë‹¤ìŒ: ì „ì—´",fn:t.onResolveFront,disabled:!1,activePhase:e.phase}:e.phase==="ENEMY"?{label:"ë‹¤ìŒ: ì ",fn:t.onResolveEnemy,disabled:!1,activePhase:e.phase}:e.phase==="UPKEEP"?{label:"ë‹¤ìŒ: ì •ë¦¬",fn:t.onUpkeep,disabled:!1,activePhase:e.phase}:e.phase==="DRAW"?{label:"ë‹¤ìŒ í„´",fn:t.onDrawNextTurn,disabled:!1,activePhase:e.phase}:{label:"ë‹¤ìŒ",fn:null,disabled:!0,activePhase:e.phase}}let Jn=!1;async function Ic(e){const{g:t,actions:n,getOverlayActive:r,render:o,animMs:a}=e;if(t._justStartedCombat){t._justStartedCombat=!1;return}if(!Jn){Jn=!0;try{if(t.run.finished||t.choice||we(t)||r()||t.phase==="NODE")return;let s=0;for(;s++<60&&!(t.run.finished||t.choice||r()||we(t));){const i=Da(t,n,!1,r());if(!i.fn||i.disabled)break;const l=t.phase;if(i.fn(),o(t,n),t.phase==="PLACE")break;const c=Rc(l);c>0&&await Pc(a(c))}}finally{Jn=!1}}}const Ct="ï¸";let ut=!1,Yt=null;function hn(){Yt&&(document.removeEventListener("pointerdown",Yt,!0),Yt=null)}function Ha(e){const t=e.run;t.timeMove==null&&(t.timeMove=e.run.nodePickCount??0),t.nextBossTime==null&&(t.nextBossTime=40),t.forcedNext==null&&(t.forcedNext=null)}function tn(e,t){return e==="BATTLE"?t?{icon:"â˜ "+Ct,text:"ë³´ìŠ¤",kind:"boss"}:{icon:"âš”"+Ct,text:"ì „íˆ¬",kind:"battle"}:e==="ELITE"?{icon:"â˜ "+Ct,text:"ì •ì˜ˆ",kind:"elite"}:e==="REST"?{icon:"â›ºï¸"+Ct,text:"íœ´ì‹",kind:"rest"}:e==="EVENT"?{icon:"â”ï¸"+Ct,text:"ë¯¸ì§€",kind:"event"}:e==="SHOP"?{icon:"Â¤"+Ct,text:"ìƒì ",kind:"shop"}:{icon:"âœ¦",text:"ë³´ë¬¼",kind:"treasure"}}function Lc(e,t,n){const r=tn(t,n),o=document.createElement("span");o.className=`nodeIcon ${r.kind}`,o.textContent=r.icon;const a=document.createElement("span");a.className="nodeText",a.textContent=`(${r.text})`,e.appendChild(o),e.appendChild(a)}function Oc(e){return Math.max(0,Math.min(1,e))}function er(e,t,n){return Math.max(t,Math.min(n,Math.floor(e)))}function Hn(e){const t=e.run;if(t.timeMove??=0,t.vision??={mode:"NORMAL",presenceR:2,typeR:1,detailR:0,noise:0},!t.map)t.map=Fc();else{const o=t.map;if(Array.isArray(o.nodes)){const a={};for(const s of o.nodes)a[String(s.id)]=s;o.nodes=a}}const n=t.map;if(!Object.keys(n?.nodes??{}).every(o=>typeof n.nodes[o]?.order=="number"))try{Wa(n,2)}catch{}try{Hr(n)}catch{}return{map:t.map,vision:t.vision,timeMove:t.timeMove}}function Fa(e){const t=e.run,n=Number(t.timeMove??0)||0,r=Number(e.time??0)||0;return n+r}function Lt(e,t,n){const r={},o=[];for(r[t]=0,o.push(t);o.length;){const a=o.shift(),s=r[a]??0;if(s>=n)continue;const i=e.edges[a]??[];for(const l of i)r[l]==null&&(r[l]=s+1,o.push(l))}return r}function Hr(e){const t=e;return t.seen||(t.seen={}),t.seen[e.pos]=3,t.seen}function Dc(e,t){const n=Hr(e),r=Math.max(0,t.presenceR|0),o=Lt(e,e.pos,r);for(const a of Object.keys(o)){const s=o[a]??0,i=$n(s,t),l=n[a]??0;i>l&&(n[a]=i)}n[e.pos]=3}function Hc(e,t){return(e.seen??{})[t]??0}function Wa(e,t=2){const n=Object.keys(e.nodes);if(n.length<=2)return;e.edges??={};for(const h of Object.keys(e.edges))for(const m of(e.edges[h]??[]).slice())e.edges[m]??=[],e.edges[m].includes(h)||e.edges[m].push(h);const r=h=>Number(e.nodes[h]?.depth??999),o=h=>Number(e.nodes[h]?.order??0),a=h=>(e.edges[h]??[]).length,s=n.every(h=>{const m=r(h);return m>=0&&m<900&&typeof e.nodes[h]?.order=="number"}),i=new Map;if(s){for(const h of n){const m=r(h);i.has(m)||i.set(m,[]),i.get(m).push(h)}for(const[h,m]of i)m.sort((u,p)=>o(u)-o(p)||u.localeCompare(p))}const l=h=>{const m=i.get(h)??[],u=i.get(h+1)??[],p=new Map,y=new Map;for(let T=0;T<m.length;T++)p.set(m[T],T);for(let T=0;T<u.length;T++)y.set(u[T],T);const k=[];for(const T of m)for(const C of e.edges[T]??[]){if(r(C)!==h+1)continue;const x=p.get(T),N=y.get(C);x==null||N==null||k.push([x,N])}return{left:m,right:u,li:p,ri:y,pairs:k}},c=(h,m)=>{const u=r(h);if(r(m)!==u+1)return!0;const{li:y,ri:k,pairs:T}=l(u),C=y.get(h),x=k.get(m);if(C==null||x==null)return!0;for(const[N,W]of T)if(C<N&&x>W||C>N&&x<W)return!0;return!1},d=h=>{e.edges[h]??=[];const m=new Set(e.edges[h]??[]),u=r(h);let p=n.filter(k=>k!==h&&!m.has(k));if(p.length===0||s&&(p=p.filter(k=>Math.abs(r(k)-u)===1),p.length===0||(p=p.filter(k=>{const T=r(h),C=r(k),x=T<C?h:k,N=T<C?k:h;return!c(x,N)}),p.length===0)))return!1;p.sort((k,T)=>a(T)-a(k));const y=p[0];return e.edges[h].push(y),e.edges[y]??=[],e.edges[y].push(h),!0};for(let h=0;h<200;h++){const m=n.filter(p=>a(p)<t);if(m.length===0)break;let u=!1;for(const p of m)for(;a(p)<t&&d(p);)u=!0;if(!u)break}}function Fc(){const t={},n={},r=Array.from({length:18},(d,h)=>`n${h}`);n[r[0]]=[],t[r[0]]={id:r[0],kind:"START",visited:!0,cleared:!0,depth:0};for(let d=1;d<r.length;d++){const h=r[d],m=r[Math.floor(Math.random()*d)];n[h]??=[],n[m]??=[],n[h].push(m),n[m].push(h),t[h]={id:h,kind:"BATTLE",visited:!1,cleared:!1}}const o=10;for(let d=0;d<o;d++){const h=r[Math.floor(Math.random()*r.length)],m=r[Math.floor(Math.random()*r.length)];h!==m&&(n[h]??=[],n[m]??=[],!n[h].includes(m)&&(n[h].push(m),n[m].push(h)))}const a={pos:r[0],startId:r[0],nodes:t,edges:n,treasureId:r[r.length-1]};Wa(a,2);const s=Lt(a,r[0],999);let i=r[1],l=-1;for(const d of r){const h=s[d]??999;t[d].depth=h,d!==r[0]&&h>l&&(l=h,i=d)}for(const d of r)d!==r[0]&&(t[d].kind="BATTLE");const c=["BATTLE","BATTLE","BATTLE","EVENT","REST","ELITE"];for(const d of r){if(d===r[0]||d===i)continue;const h=c[Math.floor(Math.random()*c.length)];t[d].kind=h}return t[i].kind="TREASURE",{pos:r[0],startId:r[0],nodes:t,edges:n,visionNonce:1,treasureId:i}}function Wc(e){const{vision:t}=Hn(e),n=e.run,r=Number(n.timeMove??0)||0,o=t;o.forceModeUntilMove!=null&&r>=Number(o.forceModeUntilMove)&&(o.forceModeUntilMove=null,o.forceMode=null),o.switchLockedUntilMove!=null&&r>=Number(o.switchLockedUntilMove)&&(o.switchLockedUntilMove=null);let a=o.forceMode??t.mode??"NORMAL",s=Number(t.presenceR??2)||0,i=Number(t.typeR??1)||0,l=Number(t.detailR??0)||0,c=Oc(Number(t.noise??.08)||0);return a==="FOCUS"?(s-=1,i-=1,l+=1,c=0):a==="WIDE"&&(s+=1,i+=1,l+=0,c=0),e.run.treasureObtained&&(c=0),ue(e)==="bright_darkness"&&(s=Math.max(s,4),i=Math.max(i,4)),s=er(s,0,99),i=er(i,0,s),l=er(l,0,i),c=0,{mode:a,presenceR:s,typeR:i,detailR:l,noise:c}}function $n(e,t){return e<=0||e<=t.detailR?3:e<=t.typeR?2:e<=t.presenceR?1:0}function Mn(e,t,n,r,o){return ye(e,"bright_darkness")?{shown:null,label:"?",certainty:"HIDDEN"}:r===0?{shown:null,label:"ë³´ì´ì§€ ì•ŠìŒ",certainty:"HIDDEN"}:r===1?{shown:null,label:"ë¬´ì–¸ê°€",certainty:"PRESENCE"}:n==="START"?{shown:null,label:"ì…êµ¬",certainty:r===3?"DETAIL":"TYPE"}:n==="EMPTY"?{shown:null,label:"ì§€ë‚˜ê°„ ê³³",certainty:"PRESENCE"}:r===3?{shown:n,label:tn(n,!1).text,certainty:"DETAIL"}:{shown:n,label:tn(n,!1).text,certainty:"TYPE"}}function Uc(e,t){const n=L("mapNodeLine");if(n.style.cssText="display:flex; gap:calc(8 * var(--u)); align-items:center;",t.shown)Lc(n,t.shown,!1);else{const r=document.createElement("span");r.className="nodeText",r.textContent=`(${t.label})`,n.appendChild(r)}e.appendChild(n)}function zc(e){const t=Object.keys(e.nodes);if(t.length===0||t.every(a=>{const s=e.nodes[a]?.depth,i=Number(s);return s!=null&&Number.isFinite(i)&&i>=0&&i<900}))return;const r=Object.values(e.nodes).find(a=>a.kind==="START")?.id??e.pos??t[0],o=Lt(e,r,999);for(const a of t){const s=e.nodes[a]?.depth;if(s!=null&&Number.isFinite(Number(s))&&Number(s)<900)continue;const i=o[a];e.nodes[a].depth=i??e.nodes[a].depth??999}}function Kc(e){zc(e);const t=Object.keys(e.nodes),n=t.every(M=>typeof e.nodes[M]?.order=="number"),r=new Map;let o=0;for(const M of t){const B=Number(e.nodes[M]?.depth??999),F=Number.isFinite(B)?B:999;o=Math.max(o,F),r.has(F)||r.set(F,[]),r.get(F).push(M)}const a=Array.from(r.keys()).sort((M,B)=>M-B),s=a.filter(M=>M<900).length?Math.max(...a.filter(M=>M<900)):o,i=a.some(M=>M>=900),l=s+(i?1:0),c=80,d=64,h=54,m=40,u=M=>{const B=Number(e.nodes[M]?.depth??999),F=Number.isFinite(B)?B:999;return F>=900?s+1:F},p=Array.from({length:l+1},(M,B)=>B),y={};for(const M of p)y[M]=[];for(const M of t){const B=u(M);y[B].push(M)}for(const M of p)y[M].sort((B,F)=>(e.nodes[B].order??0)-(e.nodes[F].order??0)||B.localeCompare(F));const k=M=>{const B=new Map,F=y[M]??[];for(let K=0;K<F.length;K++)B.set(F[K],K);return B},T=M=>e.edges[M]??[],C=M=>{if(M==="LR")for(let B=1;B<=l;B++){const F=y[B-1];if(!F||F.length===0)continue;const K=k(B-1);y[B].sort((ae,ne)=>{const J=x(ae,K,B-1),se=x(ne,K,B-1);return J!==se?J-se:ae.localeCompare(ne)})}else for(let B=l-1;B>=0;B--){const F=y[B+1];if(!F||F.length===0)continue;const K=k(B+1);y[B].sort((ae,ne)=>{const J=x(ae,K,B+1),se=x(ne,K,B+1);return J!==se?J-se:ae.localeCompare(ne)})}},x=(M,B,F)=>{const K=T(M);let re=0,ae=0;for(const ne of K){if(u(ne)!==F)continue;const J=B.get(ne);J!=null&&(re+=J,ae+=1)}if(ae===0){const ne=u(M),J=(y[ne]??[]).indexOf(M);return J<0?9999:J}return re/ae};if(!n)for(let M=0;M<4;M++)C("LR"),C("RL");let N=1;for(const M of p)N=Math.max(N,y[M]?.length??0);const W=N*d,j=m*2+W,U=h*2+(l+1)*c,V={};for(const M of p){const B=y[M]??[],F=B.length,K=F*d,re=(W-K)/2,ae=h+M*c;for(let ne=0;ne<F;ne++){const J=B[ne],se=m+re+(ne+.5)*d;V[J]={x:ae,y:se,depth:Number(e.nodes[J]?.depth??999)}}}return{width:U,height:j,pos:V,maxDepth:l,maxCount:N}}function jc(e,t,n){return n?"â—":t==="HIDDEN"?"":t==="PRESENCE"?"Â·":e?tn(e,!1).icon:"?"}function Vc(e,t,n,r,o,a){const s=Kc(r),i=Hr(r),l=Lt(r,r.pos,Math.max(0,o.presenceR|0)),c=S=>S===r.pos||(i[S]??0)>0,d=Object.keys(r.nodes).filter(c);d.includes(r.pos)||d.push(r.pos);const h=70;let m=1/0,u=1/0,p=-1/0,y=-1/0;for(const S of d){const A=s.pos[S];A&&(m=Math.min(m,A.x),u=Math.min(u,A.y),p=Math.max(p,A.x),y=Math.max(y,A.y))}Number.isFinite(m)||(m=0,u=0,p=300,y=200);const k=m-h,T=u-h,C=p-m+h*2,x=y-u+h*2,N=1.4,W=460,j="#0B0B0B",U="#B34A46",V="rgba(242,241,234,.70)",M="rgba(242,241,234,.34)",B="rgba(179,74,70,.34)",F=j,K=L("mapMiniBox");K.style.cssText="margin-top:calc(12 * var(--u)); border:0 solid rgba(255,255,255,.12); border-radius:calc(12 * var(--u)); background:rgba(0,0,0,0); padding:calc(10 * var(--u));";const re=Te("","");re.style.cssText="font-weight:700; margin-bottom:calc(8 * var(--u)); opacity:.95;",K.appendChild(re);const ae=L("mapMiniScroller"),ne=L("mapMiniViewport");ae.appendChild(ne),ae.style.cssText=`position:relative; overflow:auto; max-height:calc(${W} * var(--u)); border-radius:calc(10 * var(--u)); background:rgba(255,255,255,.0);`,ne.addEventListener("wheel",S=>{Math.abs(S.deltaY)>Math.abs(S.deltaX)&&(ne.scrollLeft+=S.deltaY,S.preventDefault())},{passive:!1});const J=document.createElementNS("http://www.w3.org/2000/svg","svg");J.setAttribute("viewBox",`${k} ${T} ${C} ${x}`),J.style.width=`calc(${C*N} * var(--u))`,J.style.height=`calc(${x*N} * var(--u))`,J.setAttribute("preserveAspectRatio","xMidYMid meet"),J.style.display="block";const se=document.createElementNS("http://www.w3.org/2000/svg","g"),ce=document.createElementNS("http://www.w3.org/2000/svg","g");J.appendChild(se),J.appendChild(ce);const H=new Set(r.edges[r.pos]??[]),$e=(S,A,I)=>{const $=Math.max(0,Math.min(3,I));return Mn(t,S,A,$,{...o})},Z=(S,A)=>{const I=S.x,$=S.y,w=A.x,E=A.y,_=Math.abs((S.depth??0)-(A.depth??0));if(_===0)return`M ${I} ${$} L ${w} ${E}`;if(_>=2){const D=38+10*_,z=Math.max(I,w)+D;return`M ${I} ${$} C ${z} ${$}, ${z} ${E}, ${w} ${E}`}const P=w-I,R=I+P*.35,O=I+P*.65;return`M ${I} ${$} C ${R} ${$}, ${O} ${E}, ${w} ${E}`},b=new Set(d);for(const S of d)for(const A of r.edges[S]??[]){if(S>=A||!b.has(A))continue;const I=r.nodes[S]?.depth,$=r.nodes[A]?.depth;if(I!=null&&$!=null&&Math.abs(Number(I)-Number($))>1)continue;const w=s.pos[S],E=s.pos[A];if(!w||!E)continue;const _=document.createElementNS("http://www.w3.org/2000/svg","path");_.setAttribute("d",Z(w,E)),_.setAttribute("fill","none"),_.setAttribute("stroke",V),_.setAttribute("stroke-width","2"),se.appendChild(_)}const v=d.slice().sort((S,A)=>S.localeCompare(A));for(const S of v){const A=s.pos[S];if(!A)continue;const I=r.nodes[S],$=I?.kind??"BATTLE",w=l[S],E=S===r.pos?3:w==null?0:$n(w,o),_=i[S]??0,P=E>0?Mn(t,S,$,E):$e(S,$,_),R=S===r.pos,O=H.has(S),D=$==="START";if(R){const ke=document.createElementNS("http://www.w3.org/2000/svg","circle");ke.setAttribute("cx",String(A.x)),ke.setAttribute("cy",String(A.y)),ke.setAttribute("r",String(22)),ke.setAttribute("fill","none"),ke.setAttribute("stroke",U),ke.setAttribute("stroke-width",String(3.5)),ke.setAttribute("opacity","0.55"),ke.style.filter="drop-shadow(0 0 calc(6 * var(--u)) rgba(179,74,70,.65))",ce.appendChild(ke)}const z=document.createElementNS("http://www.w3.org/2000/svg","circle");z.setAttribute("cx",String(A.x)),z.setAttribute("cy",String(A.y)),z.setAttribute("r",String(R?13:10));const G=R||O;z.setAttribute("fill",G?B:M),z.setAttribute("stroke","none"),z.setAttribute("stroke-width","0"),z.style.cursor=O&&!R?"pointer":"default",O&&!R&&z.addEventListener("click",ke=>{ke.preventDefault(),ke.stopPropagation(),n.onMoveToNode?.(S)});const X=document.createElementNS("http://www.w3.org/2000/svg","title"),ee=(I?.cleared||I?.visited,"");X.textContent=`${ee}`,z.appendChild(X),ce.appendChild(z);const oe=document.createElementNS("http://www.w3.org/2000/svg","text");oe.setAttribute("x",String(A.x)),oe.setAttribute("y",String(A.y)),oe.setAttribute("dominant-baseline","central"),oe.setAttribute("text-anchor","middle"),oe.setAttribute("font-size","14"),oe.style.fontSize="var(--mapNodeEmojiSize, calc(16 * var(--u)))",oe.setAttribute("fill",F),oe.style.pointerEvents="none",oe.style.userSelect="none";const ve=jc(P.shown,P.certainty,D);oe.textContent=ve,oe.style.opacity="0.95",ce.appendChild(oe)}ne.appendChild(J),K.appendChild(ae),requestAnimationFrame(()=>{const S=s.pos[r.pos];if(!S)return;const A=$c(),I=(S.x-k)*A*N,$=(S.y-T)*A*N,w=Math.max(0,I-ne.clientWidth*.45),E=Math.max(0,$-ne.clientHeight*.45);ne.scrollLeft=w,ne.scrollTop=E});const g=Te("","");g.style.cssText="margin-top:calc(8 * var(--u)); font-size:calc(12 * var(--u)); opacity:.8; line-height:1.3;",K.appendChild(g),e.appendChild(K)}function Gc(e,t,n){const{map:r,timeMove:o}=Hn(t),a=Wc(t);Dc(r,a);const s=L("nodeSelectWrap");s.classList.add("mapNodeSelect");const i=L("nodeSelectHeader");i.style.cssText="display:flex; align-items:flex-end; justify-content:space-between; gap:calc(16 * var(--u));";const l=L("nodeSelectTitle"),c=Fa(t),d=t.run.nodePickCount??0;l.appendChild(Te("",`ì´ ì‹œê°„ ${c} Â· íƒí—˜ ${d} Â· ì´ë™ ${o}`)),Ha(t);const h=t.run,m=Number(h.nextBossTime??40)||40,u=Math.max(0,m-c),p=t.run.bossOmenText&&String(t.run.bossOmenText).trim()!==""?String(t.run.bossOmenText):"ì•„ì§ ì§•ì¡°ê°€ ì—†ë‹¤.";if(l.appendChild(Te("",`ë‹¤ìŒ ë³´ìŠ¤ê¹Œì§€ ${u} Â· ${p}`)),u<=3){const T=t.run,C=Math.max(0,Math.floor(u)),x=String(T.bossApproachToastBossTime??""),N=`${m}:${C}`;x!==N&&(T.bossApproachToastBossTime=N,C>0?q(t,"WARN",`ë³´ìŠ¤ ì¹´ìš´íŠ¸ë‹¤ìš´: ${C} (ì´ ì‹œê°„ ${c}/${m})`,2400):q(t,"WARN",`ë³´ìŠ¤ ì„ê³„ ë„ë‹¬! ë‹¤ìŒ ì´ë™ì—ì„œ ë³´ìŠ¤ ì „íˆ¬ê°€ ì‹œì‘ë©ë‹ˆë‹¤. (ì´ ì‹œê°„ ${c}/${m})`,2600))}if(t.run.treasureObtained){const T=Lt(r,r.pos,9999)[r.startId],C=T==null?"?":String(T);l.appendChild(Te("",`ì…êµ¬ê¹Œì§€ ${C}`))}const y=L("nodeSelectHeaderRight"),k=mr(ut?"ìƒì„¸ ë‹«ê¸°":"ìƒì„¸",()=>{ut=!ut,ut||hn(),n.rerender()});if(k.classList.add("mapDetailToggleBtn"),k.style.cssText="margin-left:calc(-30 * var(--u)); padding:calc(2 * var(--u)) calc(5 * var(--u)); opacity:.9;",y.appendChild(k),i.appendChild(l),i.appendChild(y),s.appendChild(i),Vc(s,t,n,r,a),ut){const T=L("mapDetailPanel");T.style.cssText="position:fixed; right:calc(24 * var(--u)); top:calc(24 * var(--u)); width:min(calc(520 * var(--u)), calc(100vw - calc(64 * var(--u)))); max-height:calc(100vh - calc(64 * var(--u))); overflow-y:auto; overflow-x:hidden; z-index:70001; border:calc(1 * var(--u)) solid rgba(255,255,255,.14); border-radius:calc(14 * var(--u)); background:rgba(0,0,0,1); backdrop-filter:none; padding:calc(12 * var(--u));",T.addEventListener("click",M=>M.stopPropagation()),T.addEventListener("wheel",M=>M.stopPropagation(),{passive:!0});const C=M=>{const B=M.target;if(B&&T.contains(B))return;ut=!1,hn();try{T.remove()}catch{}const F=document.querySelector(".mapDetailToggleBtn");F&&(F.textContent="ìƒì„¸")},x=L("");x.style.cssText="display:flex; align-items:center; justify-content:space-between; gap:calc(10 * var(--u));";const N=Te("","ì§€ë„ ìƒì„¸");N.style.cssText="font-weight:700; opacity:.95;",x.appendChild(N);const W=mr("ë‹«ê¸°",()=>{ut=!1,hn(),n.rerender()});W.style.cssText="padding:calc(6 * var(--u)) calc(10 * var(--u)); opacity:.9;",x.appendChild(W),T.appendChild(x);const j=L("");j.style.cssText="margin-top:calc(10 * var(--u)); padding:calc(10 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.10); border-radius:calc(12 * var(--u)); background:rgba(255,255,255,.03);";const U=Cn("ì´ë™ ê°€ëŠ¥í•œ ì´ì›ƒ");U.style.margin="0 0 calc(6 * var(--u)) 0",j.appendChild(U);const V=r.edges[r.pos]??[];V.length===0&&j.appendChild(xl("ì´ì›ƒì´ ì—†ìŠµë‹ˆë‹¤."));for(let M=0;M<V.length;M++){const B=V[M],K=r.nodes[B]?.kind??"BATTLE",re=a.presenceR>=1?$n(1,a):0,ae=Hc(r,B),ne=re>0?Mn(t,B,K,re):ae>=2?K==="START"?{shown:null,label:"ì…êµ¬"}:{shown:K,label:tn(K,!1).text}:ae===1?{shown:null,label:"ë¬´ì–¸ê°€"}:{shown:null,label:"ë³´ì´ì§€ ì•ŠìŒ"},J=L("");J.style.cssText="display:flex; align-items:center; gap:calc(10 * var(--u)); padding:calc(8 * var(--u)) calc(10 * var(--u)); border-radius:calc(10 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.10); background:rgba(0,0,0,.20);margin-top:calc(6 * var(--u));";const se=Te("",re>0||ae>0?`${B}`:`ì¶œêµ¬ ${M+1}`);se.style.cssText="flex:0 0 auto; padding:calc(4 * var(--u)) calc(8 * var(--u)); border-radius:calc(10 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.14); background:rgba(0,0,0,.25); opacity:.9;",J.appendChild(se);const ce=L("");ce.style.cssText="flex:1 1 auto; min-width:0;",Uc(ce,ne),J.appendChild(ce),j.appendChild(J)}if(T.appendChild(j),a.presenceR>=2){const M=Lt(r,r.pos,a.presenceR),B=Object.keys(M).filter(F=>(M[F]??999)>=2&&(M[F]??999)<=a.presenceR).sort((F,K)=>M[F]-M[K]||F.localeCompare(K));if(B.length){const F=L("");F.style.cssText="margin-top:calc(10 * var(--u)); padding:calc(10 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.10); border-radius:calc(12 * var(--u)); background:rgba(255,255,255,.03);";const K=Cn("ë©€ë¦¬ ë³´ì´ëŠ” ê³³");K.style.margin="0 0 calc(6 * var(--u)) 0",F.appendChild(K);const re=new Map;for(const ne of B){const J=M[ne]??0,ce=r.nodes[ne]?.kind??"BATTLE",H=$n(J,a),$e=Mn(t,ne,ce,H),Z=$e.certainty==="PRESENCE"?"ë¬´ì–¸ê°€":$e.label,b=re.get(J)??{};b[Z]=(b[Z]??0)+1,re.set(J,b)}const ae=Array.from(re.keys()).sort((ne,J)=>ne-J);for(const ne of ae){const J=re.get(ne),se=Object.keys(J).map(ce=>`${ce}Ã—${J[ce]}`);F.appendChild(Te("",`ê±°ë¦¬ ${ne}: ${se.join(" Â· ")}`))}T.appendChild(F)}}hn(),Yt=C,document.addEventListener("pointerdown",Yt,!0),e.appendChild(T)}e.appendChild(s)}function ko(e,t,n){const{map:r}=Hn(t);{const o=t.run,a=`${String(r.pos??"")}::${Number(o.timeMove??0)||0}`;o._bdNodeToastKey!==a&&(o._bdNodeToastKey=a,ue(t)==="bright_darkness"&&(q(t,"INFO",Q.bright_darkness.nodeSelect,1800),f(t,Q.bright_darkness.nodeSelect)),ye(t,"bright_darkness")&&(q(t,"WARN",Q.bright_darkness.hostileMap,2200),f(t,Q.bright_darkness.hostileMap)))}Gc(e,t,n)}function qc(e,t,n,r){let o=e;const{getOverlay:a,setOverlay:s}=r,i=b=>{o=b,t(b)},l=()=>o,c=(b,v)=>Ge(b,v),d=b=>Math.max(0,Math.min(1,b)),h=(b,v)=>{const g=b.cards[v];return xe(b.content,g.defId,g.upgrade??0)},m=(b,v)=>b.content.cardsById[v]?.name??v,u=(b,v)=>{const g=b.content.cardsById[v.defId]?.name??v.defId;return tt(b,g,v.upgrade??0)},p=b=>{const v=(b.placedUidsThisTurn??[]).filter(S=>{const A=b.cards[S];return!!A&&(A.zone==="front"||A.zone==="back")});b.usedThisTurn=v.length;let g=0;for(const S of v)b.cards[S]?.zone==="front"&&(g+=1);b.frontPlacedThisTurn=g},y=(b,v)=>v!==1?!1:(b.enemies??[]).some(g=>g&&g.hp>0&&g.id==="living_chain");let k=null,T=null,C=!1,x=!1;const N=[],W=b=>b==="REWARD"||b==="REWARD_PICK"?"REWARD_PICK":b==="BATTLE"?"BATTLE":"NONE",j=b=>{const v=b.run;v.pendingRemovePickThen=null,v.activeEventId=null,v.choiceHandlerSnapshot=null};function U(b,v,g=null){k=v,T=g,b.run.choiceHandlerSnapshot=g}function V(b){return T||(b.run.choiceHandlerSnapshot??null)}function M(b){N.length=0,b.choice=null,U(b,null,null),j(b),document.querySelector(".choice-overlay")?.remove()}function B(b){N.push({choice:b.choice,handler:k,snapshot:V(b)})}function F(b){const v=N.pop();if(!v){K(b);return}b.choice=v.choice,U(b,v.handler,v.snapshot)}function K(b){if(N.length>0){F(b);return}b.choice=null,U(b,null,null),j(b),document.querySelector(".choice-overlay")?.remove()}function re(b,v,g,S){b.choice&&B(b),b.choice=v,U(b,g,S??null)}function ae(b,v,g){if(b.choice?.kind!=="PICK_CARD")return!1;const S=b.run,A=g??W(String(S.pendingRemovePickThen??"NONE"));if(v==="cancel")return S.pendingRemovePickThen=null,f(b,"ì œê±° ì·¨ì†Œ"),K(b),n(b,H),!0;if(!v.startsWith("remove:"))return!1;const I=v.slice(7);return Qt(b,I),S.pendingRemovePickThen=null,A==="BATTLE"?(M(b),b.phase="NODE",vt(b),Ht(b),n(b,H),!0):A==="REWARD_PICK"?(M(b),$e(b,H,"ì¹´ë“œ ë³´ìƒ","ë‘ ì¥ ì¤‘ í•œ ì¥ì„ ì„ íƒí•˜ê±°ë‚˜ ìƒëµí•©ë‹ˆë‹¤."),n(b,H),!0):(M(b),b.phase="NODE",n(b,H),!0)}function ne(b,v){if(b.choice?.kind!=="REWARD")return!1;if(v.startsWith("pick:")){const g=v.slice(5),[S,A]=g.split(":"),I=Number(A??"0")||0;Ve(b,S,{upgrade:I})}else f(b,"ì¹´ë“œ ë³´ìƒ ìƒëµ");return K(b),b.choice=null,b.run.finished||(b.phase="NODE"),n(b,H),!0}function J(b,v){if(b.choice?.kind!=="UPGRADE_PICK")return!1;if(v==="skip")return f(b,"ê°•í™” ì·¨ì†Œ"),K(b),n(b,H),!0;if(v.startsWith("up:")){const g=v.slice(3),S=Pt(b,g);return f(b,S?`ê°•í™”: [${c(b,g)}]`:"ê°•í™” ì‹¤íŒ¨"),K(b),n(b,H),!0}return K(b),n(b,H),!0}function se(b,v,g){if(g.id==="REMOVE_PICK"){const S=String(g.payload?.then??"NONE"),A=W(S);return ae(b,v,A)}if(g.id==="REWARD_PICK")return ne(b,v);if(g.id==="UPGRADE_PICK")return J(b,v);if(g.id==="EVENT_BY_ID"){const S=String(g.payload?.eventId??"");if(!S)return!1;const I=dr(S)?.options(b).find(E=>E.key===v);if(!I)return!1;const $=Pe(b);$.eventPicks+=1,Re(b);const w=I.apply(b);return ce(b,w),!0}return!1}function ce(b,v){if(typeof v=="object"&&v.kind==="UPGRADE_PICK"){Z(b,H,v.title??"ê°•í™”",v.prompt??"ê°•í™”í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.");return}if(typeof v=="object"&&v.kind==="REMOVE_PICK"){const g=Object.values(b.cards).filter(A=>(A.zone==="deck"||A.zone==="hand"||A.zone==="discard")&&A.defId!=="goal_treasure").map(A=>A.uid),S=W(v.then);b.run.pendingRemovePickThen=S,re(b,{kind:"PICK_CARD",title:v.title,prompt:v.prompt??"ì œê±°í•  ì¹´ë“œ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”.",options:[...g.map(A=>{const I=h(b,A),$=Ae(b,I.frontText,I.backText);return{key:`remove:${A}`,label:c(b,A),detail:`ì „ì—´: ${$.frontText} / í›„ì—´: ${$.backText}`,cardUid:A}}),{key:"cancel",label:"ì·¨ì†Œ"}]},A=>{ae(b,A)||n(b,H)},{id:"REMOVE_PICK",payload:{then:S}}),n(b,H);return}if(typeof v=="object"&&v.kind==="BATTLE_SPECIAL"){M(b),b.run.onWinGrantRelicId=v.onWinGrantRelicId??null,f(b,v.title?`ì´ë²¤íŠ¸ ì „íˆ¬: ${v.title}`:"ì´ë²¤íŠ¸ ì „íˆ¬ ë°œìƒ!");const g=b.run;g.pendingEventWinRelicId=v.onWinGrantRelicId??null,g.pendingEventWinGold=Number(v.onWinGrantGold??0)||0,b.phase="NODE",vt(b,{forcePatternIds:v.enemyIds}),b._justStartedCombat=!0,Ht(b),n(b,H);return}if(v==="BATTLE"){M(b),b.phase="NODE",vt(b),b._justStartedCombat=!0,Ht(b),n(b,H);return}if(v==="REWARD"){M(b),$e(b,H,"ì¹´ë“œ ë³´ìƒ","ë‘ ì¥ ì¤‘ í•œ ì¥ì„ ì„ íƒí•˜ê±°ë‚˜ ìƒëµí•©ë‹ˆë‹¤."),n(b,H);return}K(b),n(b,H)}const H={onHotkeySlot:(b,v)=>{const g=l();if(g.run.finished||we(g)||g.phase!=="PLACE"||b==="back"&&g.backSlotDisabled?.[v])return;const S=b==="front"?g.frontSlots:g.backSlots,A=S[v];if(!g.selectedHandCardUid){if(!A)return;H.onReturnSlotToHand(b,v);return}const I=g.selectedHandCardUid;if(!A){H.onPlaceHandUidToSlot(I,b,v);return}{const w=g.cards[A];if(xe(g.content,w.defId,w.upgrade??0).tags?.includes("LOCKED")){q(g,"WARN","ì´ ì¹´ë“œëŠ” íšŒìˆ˜í•˜ê±°ë‚˜ ì´ë™í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",1600);return}}S[v]=null,(g.placedUidsThisTurn??[]).includes(A)&&(g.usedThisTurn=Math.max(0,g.usedThisTurn-1),b==="front"&&(g.frontPlacedThisTurn=Math.max(0,g.frontPlacedThisTurn-1)),g.placedUidsThisTurn=(g.placedUidsThisTurn??[]).filter(w=>w!==A)),g.hand.push(A),g.cards[A].zone="hand",Yr(g,I,b,v),g.selectedHandCardUid=null,f(g,`[${c(g,I)}] â†” [${c(g,A)}] ìŠ¤ì™‘: ì†íŒ¨ â†” ${b}${v+1}`),n(g,H)},rerender:()=>{const b=l();n(b,H)},onToggleLogOverlay:()=>{Nl(),n(l(),H)},onUseItem:b=>{const v=l();if(v.run.finished||v.choice||a()||we(v))return;tl(v,b)&&n(v,H)},onDiscardItem:b=>{const v=l();if(v.run.finished||a()||we(v))return;el(v,b,"UI")&&(Re(v),n(v,H))},onCloseOverlay:()=>{const b=l();s(null),n(b,H)},onNewRun:()=>{const b=l();Sc(),s(null),ur(null),K(b),Yl(),i(yr(b.content)),n(l(),H)},onViewRulebook:()=>{const b=l();s({kind:"RULEBOOK"}),n(b,H)},onViewPile:b=>{const v=l();s({kind:"PILE",pile:b}),n(v,H)},onViewSettings:()=>{const b=l();s({kind:"SETTINGS"}),n(b,H)},onReturnSlotToHand:(b,v)=>{const g=l();if(g.run.finished||we(g)||g.phase!=="PLACE")return;const S=b==="front"?g.frontSlots:g.backSlots,A=S[v];if(!A)return;{const $=g.cards[A];if(xe(g.content,$.defId,$.upgrade??0).tags?.includes("LOCKED")){q(g,"WARN","ì´ ì¹´ë“œëŠ” íšŒìˆ˜í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",1600);return}}S[v]=null,(g.placedUidsThisTurn??[]).includes(A)&&(g.usedThisTurn=Math.max(0,g.usedThisTurn-1),b==="front"&&(g.frontPlacedThisTurn=Math.max(0,g.frontPlacedThisTurn-1)),g.placedUidsThisTurn=(g.placedUidsThisTurn??[]).filter($=>$!==A)),g.hand.push(A),g.cards[A].zone="hand",f(g,`[${c(g,A)}] íšŒìˆ˜: ${b}${v+1} â†’ ì†íŒ¨`),n(g,H)},onClearSelected:()=>{const b=l();b.selectedHandCardUid=null,n(b,H)},onSelectEnemy:b=>{const v=l();if(x)return;x=!0,requestAnimationFrame(()=>{x=!1});const g=zi(v,b);n(v,H),g&&!v.choice&&!v.run.finished&&H.onAutoAdvance()},onSelectHandCard:b=>{const v=l();we(v)||(v.selectedHandCardUid=v.selectedHandCardUid===b?null:b,n(v,H))},onMoveToNode:b=>{const v=l();if(v.run.finished)return;if(v.choice&&(document.querySelector(".choice-overlay")||(f(v,"ì„ íƒ ìƒíƒœ ë³µêµ¬: ë³´ì´ì§€ ì•ŠëŠ” ì„ íƒì°½ ë°ì´í„°ë¥¼ ì •ë¦¬í•©ë‹ˆë‹¤."),M(v))),v.choice){f(v,"ì´ë™ ë¶ˆê°€: ì„ íƒ ì°½ì´ ì—´ë ¤ ìˆìŠµë‹ˆë‹¤.");return}if(v.phase!=="NODE"){f(v,`ì´ë™ ë¶ˆê°€: í˜„ì¬ í˜ì´ì¦ˆê°€ NODEê°€ ì•„ë‹™ë‹ˆë‹¤. (${v.phase})`);return}if(C){f(v,"ì´ë™ ë¶ˆê°€: ì…ë ¥ ì ê¸ˆ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.");return}C=!0,setTimeout(()=>C=!1,180);const g=v.run,{map:S}=Hn(v),A=S.pos;if(!(S.edges[A]??[]).includes(b)){f(v,`ì´ë™ ë¶ˆê°€: ì¸ì ‘ ë…¸ë“œê°€ ì•„ë‹™ë‹ˆë‹¤. (${A} â†’ ${b})`);return}g.timeMove=Number(g.timeMove??0)+zs(v),S.visionNonce=Number(S.visionNonce??0)+1,S.pos=b;const $=S.nodes[b]??(S.nodes[b]={id:b,kind:"BATTLE"}),w=!$.visited;if(w&&($.visited=!0,v.run.nodePickCount=(v.run.nodePickCount??0)+1),v.run.treasureObtained){if(S.pos===S.startId){v.run.finished=!0,f(v,"ë³´ë¬¼ì„ ë“¤ê³  ì…êµ¬ë¡œ ëŒì•„ì™”ë‹¤! íƒˆì¶œì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤!"),n(v,H);return}w&&$.kind!=="TREASURE"&&$.kind!=="START"&&(v.run.afterTreasureNodePicks=(v.run.afterTreasureNodePicks??0)+1)}Ha(v);const E=Fa(v);if(Number(g.nextBossTime??0)>0&&E>=Number(g.nextBossTime??0)){const R=Number(g.nextBossTime??0)||0;q(v,"WARN",`ë³´ìŠ¤ ì„ê³„ì¹˜ ë„ë‹¬ (${E}/${R})`,2200),g.forcedNext=null,g.nextBossTime=Number(g.nextBossTime??0)+40,v.run.bossOmenText=null,$.cleared=!0,$.kind="EMPTY",$.noRespawn=!0,$.lastClearedMove=Number(g.timeMove??0),f(v,"ì‹œê°„ì´ ë‹¤ ë˜ì–´ ë³´ìŠ¤ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. (ì‹œê°„ +1)"),vt(v,{forceBoss:!0}),Ht(v),n(v,H);return}const _=Number(g.timeMove??0)||0;$.cleared&&($.kind==="BATTLE"||$.kind==="EVENT"||$.kind==="REST"||$.kind==="ELITE")&&($.kind==="ELITE"&&($.noRespawn=!0),$.kind="EMPTY",$.lastClearedMove=Number($.lastClearedMove??_));let P=$.kind;if(P==="EMPTY"){const R=!!$.noRespawn,O=Number($.lastClearedMove??-999),D=Number(g.respawnCooldownMoves??2)||2,z=_-O<=D;if(!R&&!z){const G=Math.max(0,Number(v.player.fatigue??0)||0),X=d(G/25)*.18,ee=v.run.treasureObtained?.22:.12,oe=d(ee+X);if(Math.random()<oe){const ve=Math.random(),ke=v.run.treasureObtained?.72:.55,Dt=v.run.treasureObtained?.9:.85;P=ve<ke?"BATTLE":ve<Dt?"EVENT":"REST",$.kind=P,$.cleared=!1,$.respawnCount=Number($.respawnCount??0)+1,f(v,"ì¬ë°œë™: ì´ê³³ì—ì„œ ë‹¤ì‹œ ë¬´ì–¸ê°€ê°€ ì¼ì–´ë‚©ë‹ˆë‹¤...")}}}if($r(v)===3&&(P==="EVENT"||P==="REST"||P==="SHOP")&&Math.random()<.5&&(P="BATTLE",f(v,"ê´‘ê¸°(ì ëŒ€): ë˜ì „ì´ ë’¤í‹€ë ¤ ì „íˆ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤..."),q(v,"WARN","ê´‘ê¸°ì˜ í˜ì´ ê¸¸ì„ ë§‰ì•„ì„­ë‹ˆë‹¤.",1800)),P==="START"){n(v,H);return}if(P==="TREASURE"){$.cleared=!0,$.kind="EMPTY",$.noRespawn=!0,$.lastClearedMove=_,Cs(v),n(v,H);return}if(P==="BATTLE"||P==="ELITE"){if(Xo(v)===3&&Math.random()<.5){$.cleared=!0,$.kind="EMPTY",$.lastClearedMove=_,P==="ELITE"&&($.noRespawn=!0),f(v,"ê´‘ê¸°: ì „íˆ¬ê°€ ì–´ë”˜ê°€ë¡œ ì‚¬ë¼ì¡Œë‹¤..."),q(v,"INFO","ì „íˆ¬ê°€ ì¼ì–´ë‚˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.",1600),n(v,H);return}$.cleared=!0,$.kind="EMPTY",$.lastClearedMove=_,P==="ELITE"&&($.noRespawn=!0),f(v,"ì´ë™ í›„ ì „íˆ¬ ì‹œì‘ (ì‹œê°„ +1)"),P==="ELITE"?vt(v,{forceBoss:!1,forceElite:!0}):vt(v,{forceBoss:!1}),Ht(v),n(v,H);return}if(P==="REST"){$.cleared=!0,$.kind="EMPTY",$.lastClearedMove=_;const R=(v.player.fatigue??0)>=10;Gs(v);const O=ue(v),D=ye(v,"dream_shadow"),z=In(v),ee=[{key:"rest:heal",label:"íšŒë³µ",detail:D?"íšŒë³µëŸ‰ 0":O==="dream_shadow"?"í•­ìƒ ìµœëŒ€ ì²´ë ¥ (F +3)":"HP +15"},{key:"rest:clear_f",label:"ì •ë¹„",detail:"F -3"},{key:"rest:upgrade",label:"ê°•í™”",detail:z?"(ë¶ˆê°€)":O==="dream_shadow"||D?"ì¹´ë“œ 1ì¥ ê°•í™” (í”¼ë¡œë§Œí¼ í”¼í•´)":"ì¹´ë“œ 1ì¥ ê°•í™”"},{key:"rest:skip",label:"ë– ë‚˜ê¸°"}];qs(v)&&ee.splice(ee.length-1,0,{key:"rest:synth",label:"í•©ì„±",detail:"ì¹´ë“œ 1ì¥ì— íš¨ê³¼ ë¶€ì—¬ (í­ì£¼/ì„¤ì¹˜/ì„ ì²œì„±/ë’¤ì§‘ê¸°/ì†Œëª¨ ì œê±°)"});const ve=z?ee.filter(ke=>ke.key!=="rest:upgrade"):ee;v.choice={kind:"EVENT",title:"íœ´ì‹",art:he("assets/events/event_rest.png"),prompt:R?"í”¼ë¡œê°€ ë„ˆë¬´ ë†’ì•„ ì‹œê°„ì´ ë” ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.":"ìº í”„ì— ì ì‹œ ë¨¸ë¬¸ë‹¤.",options:ve},v.choiceCtx={kind:"REST",highF:R},n(v,H);return}if(P==="SHOP"){$.visited=!0,$.cleared=!0,$.noRespawn=!0,$.lastClearedMove=_,ie(v,b),n(v,H);return}if(P==="EVENT"){$.cleared=!0,$.kind="EMPTY",$.lastClearedMove=_;const R=v.run;if(R.ominousProphecySeen??=!1,be(v).chosen){const X=Is(v);if(X&&Math.random()<.25){Yo(v,X),n(v,H);return}}const O=.3;let D=jn(v);if(R.ominousProphecySeen===!0)for(let G=0;G<50&&D.id==="ominous_prophecy";G++)D=jn(v);else Math.random()<O&&(D=dr("ominous_prophecy")??D);{const G=R.lastEventId??null;if(G&&D?.id===G)for(let X=0;X<60;X++){const ee=jn(v),oe=ee?.id;if(oe&&!(R.ominousProphecySeen===!0&&oe==="ominous_prophecy")&&oe!==G){D=ee;break}}}if(D?.id==="ominous_prophecy"&&(R.ominousProphecySeen=!0),!D){n(v,H);return}{const G=v.run;G.eventsSeen??={};const X=Number(G.eventsSeen[D.id]??0)||0;G.eventsSeen[D.id]=X+1,G.lastEventId=D.id}let z=D.options(v);v.choice={kind:"EVENT",title:D.name,prompt:D.prompt,art:D.art??null,options:z.map(G=>({key:G.key,label:G.label,detail:G.detail}))},v.run.activeEventId=D.id,U(v,G=>{const X=z.find(ve=>ve.key===G);if(!X)return;const ee=Pe(v);ee.eventPicks+=1,Re(v);const oe=X.apply(v);ce(v,oe)},{id:"EVENT_BY_ID",payload:{eventId:D.id}}),n(v,H);return}},onChooseChoice:b=>{const v=l();if(!v.choice)return;const g=v.choice.kind;if(Vl(v,b)){const A=g==="EVENT"&&b==="startBattle";n(v,H),A||H.onAutoAdvance();return}if(k){k(b);const A=g==="EVENT"&&b==="startBattle";n(v,H),A||H.onAutoAdvance();return}const S=V(v);if(S&&se(v,b,S)){H.onAutoAdvance();return}f(v,`ì„ íƒ ì²˜ë¦¬ ë¶ˆê°€: handler ì—†ìŒ (kind=${g}, key=${b})`)},onAutoAdvance:()=>{const b=l();Ic({g:b,actions:H,getOverlayActive:()=>!!a(),render:n,animMs:Dr})},onRevealIntents:()=>{const b=l();b.run.finished||b.enemies.length!==0&&(Mr(b),n(b,H))},onPlaceHandUidToSlot:(b,v,g)=>{const S=l();if(!S.run.finished&&!we(S)&&S.phase==="PLACE"&&!(v==="back"&&S.backSlotDisabled?.[g])){if(v==="front"&&y(S,g)){q(S,"WARN","ì‚´ì•„ìˆëŠ” ì‚¬ìŠ¬: ì „ì—´ 2ë²ˆ ìŠ¬ë¡¯ì€ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",1600),f(S,"ì‚´ì•„ìˆëŠ” ì‚¬ìŠ¬: ì „ì—´ 2ë²ˆ ìŠ¬ë¡¯ ë´‰ì¸"),n(S,H);return}Yr(S,b,v,g),S.selectedHandCardUid=null,n(S,H)}},onPlaceSelected:(b,v)=>{const g=l();g.selectedHandCardUid&&H.onPlaceHandUidToSlot(g.selectedHandCardUid,b,v)},onMoveSlotCard:(b,v,g,S)=>{const A=l();if(A.run.finished||we(A)||A.phase!=="PLACE"||g==="back"&&A.backSlotDisabled?.[S])return;if(g==="front"&&y(A,S)){q(A,"WARN","ì‚´ì•„ìˆëŠ” ì‚¬ìŠ¬: ì „ì—´ 2ë²ˆ ìŠ¬ë¡¯ì€ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",1600),f(A,"ì‚´ì•„ìˆëŠ” ì‚¬ìŠ¬: ì „ì—´ 2ë²ˆ ìŠ¬ë¡¯ ë´‰ì¸"),n(A,H);return}const I=b==="front"?A.frontSlots:A.backSlots,$=g==="front"?A.frontSlots:A.backSlots,w=I[v];if(!w)return;{const _=A.cards[w];if(xe(A.content,_.defId,_.upgrade??0).tags?.includes("LOCKED")){q(A,"WARN","ì´ ì¹´ë“œëŠ” íšŒìˆ˜í•˜ê±°ë‚˜ ì´ë™í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",1600);return}}const E=$[S];if(E){const _=A.cards[E];if(xe(A.content,_.defId,_.upgrade??0).tags?.includes("LOCKED")){q(A,"WARN","ì´ ì¹´ë“œëŠ” íšŒìˆ˜í•˜ê±°ë‚˜ ì´ë™í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",1600);return}}I[v]=E??null,$[S]=w,A.cards[w].zone=g,E&&(A.cards[E].zone=b),b!==g&&(b==="front"&&(A.frontPlacedThisTurn=Math.max(0,A.frontPlacedThisTurn-1)),g==="front"&&(A.frontPlacedThisTurn+=1),E&&(g==="front"&&(A.frontPlacedThisTurn=Math.max(0,A.frontPlacedThisTurn-1)),b==="front"&&(A.frontPlacedThisTurn+=1))),f(A,E?`[${c(A,w)}] â†” [${c(A,E)}] ìŠ¤ì™‘: ${b}${v+1} â†” ${g}${S+1}`:`[${c(A,w)}] ì´ë™: ${b}${v+1} â†’ ${g}${S+1}`),p(A),n(A,H)},onResolveBack:()=>{const b=l();b.phase==="PLACE"&&p(b),$i(b),n(b,H)},onResolveFront:()=>{const b=l();Mi(b),n(b,H)},onResolveEnemy:()=>{const b=l();Pi(b),n(b,H)},onUpkeep:()=>{const b=l();Ii(b),n(b,H)},onDrawNextTurn:()=>{const b=l();Oi(b),n(b,H)}};function $e(b,v,g,S){const I=_s(b).map($=>{const w=xe(b.content,$.defId,$.upgrade),E=Ae(b,w.frontText,w.backText);return{key:`pick:${$.defId}:${$.upgrade}`,label:u(b,$),detail:`ì „ì—´: ${E.frontText} / í›„ì—´: ${E.backText}`}});b.choice={kind:"REWARD",title:g,prompt:S,options:[...I,{key:"skip",label:"ìƒëµ"}]},U(b,$=>{ne(b,$)},{id:"REWARD_PICK"}),n(b,v)}function Z(b,v,g,S,A){let I=Object.values(b.cards).filter(_=>(_.zone==="deck"||_.zone==="hand"||_.zone==="discard")&&rn(b,_.uid)).map(_=>_.uid);const $=b.player.fatigue??0;let w=1/0;if($>=8?w=4:$>=5&&(w=8),w!==1/0&&I.length>w&&(I=[...I].sort(()=>Math.random()-.5).slice(0,w)),I.length===0){f(b,"ê°•í™”í•  ìˆ˜ ìˆëŠ” ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤."),b.choice=null,U(b,null,null),n(b,v);return}const E=[...I].sort((_,P)=>{const R=b.cards[_],O=b.cards[P],D=m(b,R.defId),z=m(b,O.defId),G=D.localeCompare(z,"ko");return G!==0?G:(R.upgrade??0)-(O.upgrade??0)});b.choice={kind:"UPGRADE_PICK",title:g,prompt:S,options:[...E.map(_=>{const P=b.cards[_],R=h(b,_),O=xe(b.content,P.defId,(P.upgrade??0)+1),D=Ae(b,R.frontText,R.backText),z=Ae(b,O.frontText,O.backText),G=c(b,_),X=`í˜„ì¬: ì „ì—´ ${D.frontText} / í›„ì—´ ${D.backText}
ê°•í™”: ì „ì—´ ${z.frontText} / í›„ì—´ ${z.backText}`;return{key:`up:${_}`,label:G,detail:X,cardUid:_}}),{key:"skip",label:"ì·¨ì†Œ"}]},U(b,_=>{if(_==="skip"){f(b,"ê°•í™” ì·¨ì†Œ"),K(b),n(b,v);return}if(_.startsWith("up:")){const P=_.slice(3),R=Pt(b,P);f(b,R?`ê°•í™”: [${c(b,P)}]`:"ê°•í™” ì‹¤íŒ¨"),K(b),n(b,v);return}K(b),n(b,v)},{id:"UPGRADE_PICK"}),n(b,v)}return H}let Ua=null,za=null,Ka=null,ja=!1;function ot(){return Ua}function Yc(e){Ua=e}function To(){return za??null}function Xc(e){za=e}function Vt(){return Ka}function Va(e){Ka=e}function Qc(){return ja}function Zc(e){ja=e}function Jc(e,t){const n=e;return n.content=t,n.time??=0,n.run??={},n.run.relics??=[],n.run.timeMove??=n.run.nodePickCount??0,n.run.nextBossTime??=40,n.run.forcedNext??=null,n.run.bossOmenText??=null,n.run.enemyLastSeenBattle??={},n.run.nodePickByType??={BATTLE:0,ELITE:0,REST:0,EVENT:0,TREASURE:0},n.run.bossPool??=["boss_gravity_master","boss_cursed_wall","boss_giant_orc","boss_soul_stealer"],n.run.nextBossId??=null,n.run.lastBattleWasElite??=!1,n.run.lastBattleWasBoss??=!1,n.run.rewardPityNonElite??=0,n.run.gold??=0,n.run.pendingEventWinGold??=0,n.run.items??=[],n.run.itemOfferedThisBattle??=!1,n.run.afterTreasureNodePicks??=0,n.run.deckSizeAtTreasure??=null,n.run.treasureObtained&&n.run.deckSizeAtTreasure==null&&(n.run.deckSizeAtTreasure=oa(n)),n.choiceStack??=[],n.pendingTargetQueue??=[],n.exhausted??=[],n.vanished??=[],n.choiceQueue??=[],n.choiceCtx??=null,n}function ed(e){if(!ql())return yr(e);const t=Ql();if(!t)return yr(e);const n=Jc(t.state,e),r=be(n);return!n.choice&&!r.chosen&&qo(n),n}function td(e){if(document.querySelector(".floatingNewRun"))return;const t=document.createElement("button");t.className="floatingNewRun",t.type="button",t.textContent="";const n=document.createElement("span");n.className="floatingNewRunLabel",n.textContent="ìƒˆë¡œìš´ ëŸ°",t.appendChild(n),t.style.cssText=`
    position: fixed;
    top: calc(env(safe-area-inset-top, 0) + calc(10 * var(--u)));
    left: calc(env(safe-area-inset-left, 0) + calc(10 * var(--u)));
    pointer-events: auto;
    z-index: calc(var(--zChrome) + 10000);

    display: flex;
    align-items: center;
    gap: calc(10 * var(--u));

    padding: calc(10 * var(--u)) calc(12 * var(--u));
    border-radius: calc(14 * var(--u));
    border: calc(1 * var(--u)) solid rgba(255,255,255,.16);
    background: rgba(0,0,0,.55);
    color: #fff;

    backdrop-filter: blur(calc(8 * var(--u)));
    -webkit-backdrop-filter: blur(calc(8 * var(--u)));
    cursor: pointer;
    touch-action: manipulation;
  `,t.addEventListener("click",r=>{r.preventDefault(),r.stopPropagation(),e()?.()}),document.body.appendChild(t)}function nd(e){if(document.querySelector(".floatingFaithBadge"))return;const t=document.createElement("div");t.className="floatingFaithBadge",t.textContent="",t.style.right="auto",t.style.bottom="auto",oc(t,()=>e()),document.body.appendChild(t)}function rd(e){const t=document.querySelector(".floatingFaithBadge"),n=document.querySelector(".floatingNewRun");if(!t||!n)return;const r=be(e),o=r.points[r.offered[0]]??0,a=r.points[r.offered[1]]??0,s=r.points[r.offered[2]]??0,i=it(),l=n.getBoundingClientRect();t.style.left=`${Math.round(l.right+8*i)}px`,t.style.top=`${Math.round(l.top)}px`,t.style.right="auto",t.textContent=`ì‹ ì•™ ${o}Â·${a}Â·${s}`}function od(e,t){document.querySelector(".phaseBanner")?.remove(),performance.now()}function ad(){$a();const e=document.querySelector("#app");if(!e)throw new Error("#app not found");return e.innerHTML="",e}function te(e){const t=document.createElement("div");return t.className=e,t}function Ke(e,t){const n=te(e);return n.textContent=t,n}function sd(e){const t=document.createElement("h2");return t.textContent=e,t}function id(e){const t=document.createElement("p");return t.textContent=e,t}function at(e,t,n){const r=document.createElement("button");return r.type="button",r.className="uiBtn",r.textContent=e,r.disabled=n,r.onclick=t,r}function ld(e,t,n){const r="shopChoiceOpen";document.querySelector(".choice-overlay")?.remove();const o=e.choice,a=document.querySelector(".mainPanel");if(!o){a?.classList.remove("choiceOpen"),document.body.classList.remove(r);return}if(!a){document.body.classList.remove(r);return}a.classList.add("choiceOpen");const s=e.choiceCtx?.kind==="SHOP";document.body.classList.toggle(r,s);const l=20+70,c=36,d=16,h=16,m=s?12:18,u=10,p=s?220:260,y=s?170:200,k=14,T=12,C=10,x=12,N=220,W=22,j=14,U=te("choice-overlay");s&&U.classList.add("shopOverlay"),U.style.cssText="position:fixed; inset:0; z-index: var(--zChoice);display:flex; justify-content:center; align-items:flex-start;pointer-events:none;";const V=te("choice-backdrop");V.style.cssText="position:absolute; inset:0;background: rgba(0,0,0,1);backdrop-filter: blur(calc(4 * var(--u)));-webkit-backdrop-filter: blur(calc(4 * var(--u)));pointer-events:none;",V.onclick=()=>{};const M=te("choice-padWrap");M.style.cssText=`position:relative; width:100%;padding:calc(${l} * var(--u)) calc(${c} * var(--u)) calc(${d} * var(--u)) calc(${h} * var(--u));box-sizing:border-box;display:flex; justify-content:center; align-items:flex-start;pointer-events:none;`;const B=te("choice-panel");B.style.cssText="position:relative;pointer-events:auto;",B.onclick=Z=>Z.stopPropagation();const F=sd(o.title);if(F.style.cssText=`margin:0 0 calc(8 * var(--u)) 0; font-size:calc(${W} * var(--u)); font-weight:900;text-align:left;`,B.appendChild(F),o.prompt){const Z=id(o.prompt);Z.style.cssText=`margin:0 0 calc(12 * var(--u)) 0; font-size:calc(${j} * var(--u)); line-height:1.25; opacity:.95;`,B.appendChild(Z)}const K=e.choiceCtx,re=Array.isArray(o.options)?o.options:[],ae=K?.kind==="BOSS_SLOT_UPGRADE",ne=re.length===2&&re.some(Z=>String(Z?.text??Z?.label??"").includes("ì „ì—´"))&&re.some(Z=>String(Z?.text??Z?.label??"").includes("í›„ì—´")),J=typeof K?.artPath=="string"?K.artPath:!ae&&ne?"assets/ui/choice/slot_pick.png":null;if(J){const Z=te("choice-art");Z.style.cssText="margin:0 0 calc(12 * var(--u)) 0;border-radius:calc(14 * var(--u)); overflow:hidden;border:calc(1 * var(--u)) solid rgba(255,255,255,.14);background:rgba(255,255,255,.06);";const b=document.createElement("img");b.src=he(J),b.alt="",b.style.cssText="display:block; width:100%; height:auto; max-height:calc(240 * var(--u)); object-fit:cover;",Z.appendChild(b),B.appendChild(Z)}if(o.kind==="FAITH"&&e.choiceCtx?.kind==="FAITH_START"){B.style.cssText+='width:min(100vw, calc(1800 * var(--u))); height:90vh;max-height:94vh; overflow:auto;padding:calc(18 * var(--u)) calc(18 * var(--u));border-radius:calc(18 * var(--u));border:calc(1 * var(--u)) solid rgba(255,255,255,.16);background:rgba(0,0,0,1);box-shadow: 0 calc(18 * var(--u)) calc(60 * var(--u)) rgba(0,0,0,1);font-family:"Mulmaru", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;';const b=be(e).offered,v=te("faith-sub");if(v.style.cssText="margin:0 0 calc(16 * var(--u)) 0;font-size:calc(19 * var(--u)); opacity:.92; line-height:1.35;",v.textContent="ì„ íƒí•œ ì‹ ì€ ì‹ ì•™ 5ë¡œ ì‹œì‘í•©ë‹ˆë‹¤. ìœ í˜¹ ìˆ˜ë½ ì‹œ: ìœ í˜¹í•œ ì‹  +1 / í˜„ì¬ í¬ì»¤ìŠ¤ -1. í¬ì»¤ìŠ¤ ì ìˆ˜ â‰¥3ì´ë©´ í›„ì› íŒ¨ì‹œë¸Œê°€ í™œì„±í™”ë©ë‹ˆë‹¤.",B.appendChild(v),document.body.classList.contains("mobile")&&document.body.classList.contains("portrait")){const S=te("faith-list");S.style.cssText="display:flex; flex-direction:column; gap:calc(16 * var(--u));";const A=I=>{const $=te("faith-godRow");$.style.cssText="display:flex; gap:calc(18 * var(--u)); align-items:stretch;min-height:calc(340 * var(--u));border-radius:calc(16 * var(--u));border:calc(1 * var(--u)) solid rgba(255,255,255,.14);background:#101010; overflow:hidden;";const w=te("faith-godArt");w.style.cssText="flex:0 0 clamp(calc(160 * var(--u)), 36vw, calc(260 * var(--u)));position:relative; overflow:hidden;border-right:calc(1 * var(--u)) solid rgba(255,255,255,.10);background:rgba(0,0,0,1);";const E=document.createElement("img");E.alt=ge(I),E.src=he(or(I)),E.style.imageRendering="pixelated",E.style.cssText="position:absolute; inset:0; width:100%; height:100%; object-fit:cover; object-position:50% 35%;transform: scale(1.06); transform-origin: 50% 50%;image-rendering: pixelated; image-rendering: crisp-edges;",E.onerror=()=>{try{E.remove()}catch{}const z=te("faith-imgPh");z.textContent="(illustration)",z.style.cssText="position:absolute; inset:0; display:flex; align-items:center; justify-content:center;opacity:.35; font-size:calc(18 * var(--u));",w.appendChild(z)},w.appendChild(E),$.appendChild(w);const _=te("faith-godBody");_.style.cssText="flex:1 1 auto; min-width:0;display:flex; flex-direction:column; gap:calc(14 * var(--u));padding:calc(20 * var(--u));";const P=te("faith-godHead");P.style.cssText="display:flex; align-items:center; justify-content:space-between; gap:calc(10 * var(--u));";const R=te("faith-godName");R.textContent=ge(I),R.style.cssText="font-size:calc(34 * var(--u)); font-weight:900;",P.appendChild(R);const O=at("ì„ íƒ",()=>t.onChooseChoice(`faith:choose:${I}`),!1);O.style.cssText+="flex:0 0 auto;font-size:calc(22 * var(--u));padding:calc(14 * var(--u)) calc(16 * var(--u));border-radius:calc(12 * var(--u));",P.appendChild(O),_.appendChild(P);const D=document.createElement("pre");return D.textContent=Tn(I),D.style.cssText='margin:0; padding:calc(14 * var(--u));white-space:pre-wrap; line-height:1.35;font-size:calc(20 * var(--u));border:calc(1 * var(--u)) solid rgba(255,255,255,.10);background:rgba(0,0,0,1);font-family:"Mulmaru", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;',_.appendChild(D),$.appendChild(_),$};for(const I of b)S.appendChild(A(I));B.appendChild(S)}else{const S=te("faith-grid");S.style.cssText="display:grid; grid-template-columns:repeat(3, minmax(0, 1fr));gap:calc(14 * var(--u));";const A=I=>{const $=te("faith-godCard");$.style.cssText="display:flex; flex-direction:column;border-radius:calc(16 * var(--u)); display:flex; align-items:center; justify-content:center;border:calc(1 * var(--u)) solid rgba(255,255,255,.14);background:#101010;overflow:hidden;min-height:calc(640 * var(--u));";const w=te("faith-imgWrap");w.style.cssText="width:70%; aspect-ratio: 1/1; height:auto;background:rgba(0,0,0,0);border-bottom:calc(1 * var(--u)) solid rgba(255,255,255,.10);position:relative; overflow:hidden;";const E=document.createElement("img");E.alt=ge(I),E.src=he(or(I)),E.style.imageRendering="pixelated",E.style.cssText="position:absolute; inset:0; width:100%; height:100%; object-fit:cover; object-position:50% 35%;transform: scale(1.09); transform-origin: 50% 50%;image-rendering: pixelated; image-rendering: crisp-edges;",E.onerror=()=>{E.remove();const D=te("faith-imgPh");D.textContent="(illustration)",D.style.cssText="position:absolute; inset:0; display:flex; align-items:center; justify-content:center;opacity:.35; font-size:calc(14 * var(--u));",w.appendChild(D)},w.appendChild(E),$.appendChild(w);const _=te("faith-body");_.style.cssText="display:flex; flex-direction:column; gap:calc(10 * var(--u));padding:calc(12 * var(--u));";const P=document.createElement("div");P.textContent=ge(I),P.style.cssText="font-size:calc(20 * var(--u)); font-weight:900; letter-spacing: 0.3em;width:100%; text-align:center;",_.appendChild(P);const R=document.createElement("pre");R.textContent=Tn(I),R.style.cssText='margin:0; padding:calc(10 * var(--u));white-space:pre-wrap; line-height:1.35;font-size:calc(13 * var(--u));border:calc(1 * var(--u)) solid rgba(255,255,255,.10);background:rgba(0,0,0,1);font-family:"Mulmaru", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;',_.appendChild(R);const O=at("ì„ íƒ",()=>t.onChooseChoice(`faith:choose:${I}`),!1);return O.style.cssText+="margin-top:auto; width:100%;font-size:calc(15 * var(--u));padding:calc(12 * var(--u)) calc(12 * var(--u));border-radius:calc(12 * var(--u));",_.appendChild(O),$.appendChild(_),$};for(const I of b)S.appendChild(A(I));B.appendChild(S)}M.appendChild(B),U.appendChild(V),U.appendChild(M),document.body.appendChild(U);return}const se=(Z,b=1)=>{const v=b===1?"var(--handCardW)":`calc(var(--handCardW) * ${b})`,g=b===1?"var(--handCardH)":`calc(var(--handCardH) * ${b})`;Z.style.width=v,Z.style.height=g,Z.style.boxSizing="border-box"},ce=Z=>{const b=document.createElement("pre");return b.className="choice-detail",b.textContent=String(Z),b.style.cssText=`margin:calc(10 * var(--u)) 0 0 0; padding:calc(${C} * var(--u));white-space:pre-wrap;border-radius: 0; border:calc(1 * var(--u)) solid rgba(255,255,255,.10);background:rgba(0,0,0,.22);font-size:calc(${x} * var(--u)); line-height:1.45;max-height:calc(${N} * var(--u)); overflow:auto;`,b},H=()=>{const Z=te("choice-item");return Z.style.cssText=`display:flex;gap:calc(12 * var(--u));align-items:flex-start;border:calc(1 * var(--u)) solid rgba(255,255,255,.10); border-radius:calc(${k} * var(--u));padding:calc(${T} * var(--u));background:rgba(255,255,255,.03);`,Z};if(!o.options.some(Z=>!!(Z.cardUid||typeof Z.key=="string"&&Z.key.startsWith("pick:")||s&&typeof Z.key=="string"&&Z.key.startsWith("shop:card:")))){const Z=te("choice-contentRow");Z.style.cssText=`display:flex;gap:calc(${m} * var(--u)); margin-top:calc(12 * var(--u));justify-content:center; align-items:stretch;`;const b=te("choice-leftCol");b.style.cssText=`flex:1 1 calc(${s?560:640} * var(--u)); max-width:calc(${s?640:720} * var(--u)); min-width:0;display:flex; flex-direction:column;`;const v=te("choice-list");v.style.cssText=`display:flex; flex-direction:column; gap:calc(${u} * var(--u));`,o.options.forEach(I=>{const $=H(),w=at(I.label,()=>t.onChooseChoice(I.key),!1);w.classList.add("choiceOptBtn"),w.style.fontSize="calc(14 * var(--u))",w.style.padding="calc(10 * var(--u)) calc(12 * var(--u))",w.style.borderRadius="calc(10 * var(--u))",$.appendChild(w),I.detail&&$.appendChild(ce(I.detail)),v.appendChild($)}),b.appendChild(v);const g=te("choice-illuCol");g.style.cssText=`flex:0 0 calc(${p} * var(--u)); min-width:calc(${y} * var(--u));display:flex; align-items:center; justify-content:center;`;const S=te("choice-illuBox");S.style.cssText="width:100%; aspect-ratio:1/1;border-radius:calc(18 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,1);background:rgba(0,0,0,1);position:relative; overflow:hidden;box-shadow: 0 calc(10 * var(--u)) calc(30 * var(--u)) rgba(0,0,0,.35);";const A=o.art;if(A){const I=document.createElement("img");I.src=he(A),I.alt=o.title??"illustration";const w=String(e.choiceCtx?.kind??"")==="ITEM_REWARD"?1.62:1.5;I.style.imageRendering="pixelated",I.style.cssText=`position:absolute; inset:0;width:${w*100}%; height:${w*100}%;left:${-(w-1)*50}%; top:${-(w-1)*50}%;object-fit:cover; object-position:50% 50%;image-rendering: pixelated; image-rendering: crisp-edges;`,S.appendChild(I)}g.appendChild(S),Z.appendChild(b),Z.appendChild(g),B.appendChild(Z),M.appendChild(B),U.appendChild(V),U.appendChild(M),document.body.appendChild(U);return}if(s){B.classList.add("shopPanel"),B.style.overflow="hidden";const Z=String(e.choiceCtx?.nodeId??""),b=e.run?.shops?.[Z];if(b){const v=te("shopCardsGrid");for(let G=0;G<(b.cards?.length??0);G++){const X=b.cards[G];if(!X?.defId)continue;const ee=te("shopCardTile");X.sold&&ee.classList.add("sold");const oe=n.renderCardPreviewByDef(e,String(X.defId),Number(X.upgrade??0)||0);se(oe,1),ee.appendChild(oe),n.wireUpgradeHoverPreviewForChoice(ee,e,String(X.defId),Number(X.upgrade??0)||0);const ve=Ke("shopTilePrice",X.sold?"í’ˆì ˆ":`ğŸª™${Number(X.priceGold??0)||0}`);ee.appendChild(ve),X.sold||(ee.onclick=()=>t.onChooseChoice(`shop:card:${G}`)),v.appendChild(ee)}const g=te("shopBottomRow"),S=te("shopItemsCol"),A=te("shopItemsGrid");for(let G=0;G<(b.items?.length??0);G++){const X=b.items[G];if(!X?.itemId)continue;const ee=te("shopItemTile");X.sold&&ee.classList.add("sold"),kr(ee,String(X.itemId));const oe=We(String(X.itemId)),ve=document.createElement("img");ve.alt=oe?.name??String(X.itemId),oe?.art&&(ve.src=he(oe.art)),ee.appendChild(ve);const ke=Ke("shopTilePrice",X.sold?"í’ˆì ˆ":`ğŸª™${Number(X.priceGold??0)||0}`);ee.appendChild(ke),X.sold||(ee.onclick=()=>{Number(ee.__itemHoverSuppressClickUntil??0)>performance.now()||t.onChooseChoice(`shop:item:${G}`)}),A.appendChild(ee)}for(let G=0;G<(b.relics?.length??0);G++){const X=b.relics[G];if(!X?.relicId)continue;const ee=te("shopItemTile");X.sold&&ee.classList.add("sold"),nc(ee,String(X.relicId)),ee.style.setProperty("--shopTileIconScale","var(--shopRelicIconZoom, 1.22)");const oe=pe[String(X.relicId)]??{},ve=document.createElement("img");ve.alt=oe?.name??String(X.relicId),oe?.art&&(ve.src=he(oe.art)),ee.appendChild(ve);const ke=Ke("shopTilePrice",X.sold?"í’ˆì ˆ":`ğŸª™${Number(X.priceGold??0)||0}`);ee.appendChild(ke),X.sold||(ee.onclick=()=>{Number(ee.__relicHoverSuppressClickUntil??0)>performance.now()||t.onChooseChoice(`shop:relic:${G}`)}),A.appendChild(ee)}S.appendChild(A);const I=te("shopSvcCol"),$=te("shopSvcGrid"),w=(G,X,ee,oe)=>{const ve=te("shopSvcTile"),ke=at(X,()=>t.onChooseChoice(G),oe);ke.classList.add("primary"),ve.appendChild(ke);const Dt=Ke("shopSvcNote",ee);return ve.appendChild(Dt),ve};$.appendChild(w("shop:service:upgrade",(b.usedUpgrade,"ê°•í™”"),b.usedUpgrade?"ì‚¬ìš© ì™„ë£Œ":"ğŸª™25",!!b.usedUpgrade)),$.appendChild(w("shop:service:remove",(b.usedRemove,"ì œê±°"),b.usedRemove?"ì‚¬ìš© ì™„ë£Œ":"ğŸª™25",!!b.usedRemove)),$.appendChild(w("shop:supply:buy","ë³´ê¸‰ êµ¬ë§¤","-ğŸª™6 / ğŸ+3",!1)),$.appendChild(w("shop:supply:sell","ë³´ê¸‰ íŒë§¤","+ğŸª™4 / ğŸ-3",!1)),I.appendChild($),g.appendChild(S),g.appendChild(I);const E=o.options.find(G=>G.key==="shop:leave")?.label??"ë‚˜ê°€ê¸°",_=at(E,()=>t.onChooseChoice("shop:leave"),!1);_.classList.add("shopLeaveBtn"),_.style.cssText="position:absolute;top:calc(16 * var(--u)); right:calc(16 * var(--u));z-index: 2;border-radius:0;padding:calc(10 * var(--u)) calc(14 * var(--u));font-size:calc(13 * var(--u)); font-weight:900;",B.appendChild(_);const P=te("choice-contentRow");P.classList.add("shopContentRow");const R=te("choice-leftCol");R.classList.add("shopLeftCol"),R.appendChild(v),R.appendChild(g);const O=te("choice-illuCol");O.style.cssText=`flex:0 0 calc(${p} * var(--u)); min-width:calc(${y} * var(--u));display:flex; align-items:center; justify-content:center;`;const D=te("choice-illuBox");D.style.cssText="width:100%; aspect-ratio:1/1;border-radius:calc(18 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,1);background:rgba(0,0,0,1);position:relative; overflow:hidden;box-shadow: 0 calc(10 * var(--u)) calc(30 * var(--u)) rgba(0,0,0,.35);";const z=o.art;if(z){const G=document.createElement("img");G.src=he(z),G.alt=o.title??"illustration";const X=1.5;G.style.imageRendering="pixelated",G.style.cssText=`position:absolute; inset:0;width:${X*100}%; height:${X*100}%;left:${-.5*50}%; top:${-.5*50}%;object-fit:cover; object-position:50% 50%;image-rendering: pixelated; image-rendering: crisp-edges;`,D.appendChild(G)}O.appendChild(D),P.appendChild(R),P.appendChild(O),B.appendChild(P),M.appendChild(B),U.appendChild(V),U.appendChild(M),document.body.appendChild(U);return}}else{const Z=e.choiceCtx?.kind,b=!s&&(Z==="BATTLE_CARD_REWARD"||Z==="BATTLE_REWARD"),v=(S,A,I)=>{const $=`__choice_preview:${S}:${A}:${Math.random().toString(36).slice(2)}`,w=e.cards[$];e.cards[$]={uid:$,defId:S,upgrade:A,zone:"preview"};const E=n.renderCard(e,$,!0,()=>I(),{draggable:!1});return E.classList.add("overlayCard","choicePickCard"),E.draggable=!1,E.style.cursor="pointer",w?e.cards[$]=w:delete e.cards[$],E};if(b){const S=o.options.filter(E=>typeof E.key=="string"&&E.key.startsWith("pick:")),A=o.options.find(E=>E.key==="skip")??null,I=e.choiceCtx,$=I?.cardDecision;{const E=String(I?.itemOfferId??""),_=I?.itemDecision;if(E){const P=We(E),R=te("choice-rewardItemRow");R.style.cssText="display:flex; justify-content:center; align-items:flex-start;gap:calc(14 * var(--u)); margin-bottom:calc(16 * var(--u));";const O=te("itemOfferCard");O.style.cssText="width:calc(170 * var(--u)); aspect-ratio:3/4;border-radius: 0;border:calc(1 * var(--u)) solid rgba(255,255,255,.14);background:rgba(0,0,0,.35);box-shadow: 0 calc(10 * var(--u)) calc(30 * var(--u)) rgba(0,0,0,.35);display:flex; flex-direction:column; align-items:center; justify-content:flex-start;padding:calc(12 * var(--u)); gap:calc(10 * var(--u));cursor:pointer; user-select:none;",kr(O,E),_?(O.style.opacity=".55",O.style.cursor="default"):O.onclick=()=>t.onChooseChoice("take_item");const D=Ke("itemOfferTitle","ì•„ì´í…œ ë³´ìƒ");if(D.style.cssText="font-weight:900; font-size:calc(14 * var(--u)); opacity:.92;",P?.art){const oe=document.createElement("img");oe.src=he(P.art),oe.alt=P.name,oe.style.imageRendering="pixelated",oe.style.cssText="width:calc(96 * var(--u)); height:calc(96 * var(--u));object-fit:contain;image-rendering: pixelated; image-rendering: crisp-edges;",O.appendChild(oe)}const z=Ke("itemOfferName",P?.name??E);z.style.cssText="font-weight:800; font-size:calc(14 * var(--u)); text-align:center;";const G=Ke("itemOfferHint",_==="TAKEN"?"íšë“í•¨":_==="SKIPPED"?"ìƒëµí•¨":"í´ë¦­í•˜ë©´ ë°›ìŠµë‹ˆë‹¤");G.style.cssText="opacity:.75; font-size:calc(12 * var(--u)); text-align:center;";const X=te("itemOfferWrap");X.style.cssText="display:flex; flex-direction:column; align-items:center;",X.appendChild(D),X.appendChild(O);const ee=Ke("itemOfferDesc",P?.text??"");if(ee.style.cssText="opacity:.85; font-size:calc(12 * var(--u)); text-align:center; white-space:pre-wrap; line-height:1.35;",ee.style.maxHeight="calc(54 * var(--u))",ee.style.overflow="hidden",ee.style.textOverflow="ellipsis",O.appendChild(z),O.appendChild(ee),O.appendChild(G),R.appendChild(X),!_){const oe=at("ì•„ì´í…œ ìƒëµ",()=>t.onChooseChoice("skip_item"),!1);oe.classList.add("ghost"),oe.style.fontSize="calc(13 * var(--u))",oe.style.padding="calc(10 * var(--u)) calc(14 * var(--u))",oe.style.borderRadius="calc(10 * var(--u))",R.appendChild(oe)}B.appendChild(R)}}const w=te("choice-rewardCardRow");w.style.cssText="display:flex; justify-content:center; align-items:flex-start;gap:calc(12 * var(--u)); flex-wrap:nowrap;";for(const E of S){const _=E.key.slice(5),[P,R]=_.split(":"),O=Number(R??"0")||0,D=!$,z=v(P,O,()=>{D&&t.onChooseChoice(E.key)});n.wireUpgradeHoverPreviewForChoice(z,e,P,O),D||(z.style.opacity=".55",z.style.cursor="default"),se(z,1),w.appendChild(z)}if(B.appendChild(w),A&&!$){const E=te("choice-rewardSkipRow");E.style.cssText="margin-top:calc(18 * var(--u)); display:flex; justify-content:center;";const _=at(A.label||"ìƒëµ",()=>t.onChooseChoice("skip"),!1);_.classList.add("primary"),_.style.fontSize="calc(14 * var(--u))",_.style.padding="calc(10 * var(--u)) calc(16 * var(--u))",_.style.borderRadius="calc(10 * var(--u))",E.appendChild(_),B.appendChild(E)}M.appendChild(B),U.appendChild(V),U.appendChild(M),document.body.appendChild(U);return}const g=te("choice-list");if(g.style.cssText=`display:flex; flex-direction:column;gap:calc(${u} * var(--u)); margin-top:calc(12 * var(--u));`,o.options.forEach(S=>{if(s&&(S.key==="shop:sep"||S.key.startsWith("shop:sep:"))){const _=te("choice-sep");_.style.cssText="height:calc(1 * var(--u));background:rgba(255,255,255,.12);margin:calc(6 * var(--u)) 0;",g.appendChild(_);return}const A=H(),I=te("choice-left");I.style.cssText="flex:0 0 auto;";const $=S.cardUid;if($){const _=e.choice?.kind==="UPGRADE_PICK",R=(e.cards[$]?.upgrade??0)||0,O=R+1;if(_){const D=te("upgradePair");D.style.cssText="display:flex; gap:calc(10 * var(--u)); align-items:flex-start;";let z,G;try{z=n.renderCardPreviewByUidWithUpgrade(e,$,R)}catch{z=n.renderRealCardForOverlay(e,$)}try{G=n.renderCardPreviewByUidWithUpgrade(e,$,O)}catch{G=n.renderRealCardForOverlay(e,$)}se(z,1),se(G,1);const X=Ke("upgradeArrow","â†’");X.style.cssText="align-self:center; font-weight:900; opacity:.85; margin-top:calc(6 * var(--u));",D.appendChild(z),D.appendChild(X),D.appendChild(G),I.appendChild(D)}else{let D;try{D=n.renderRealCardForOverlay(e,$)}catch{D=n.renderRealCardForOverlay(e,$)}se(D),I.appendChild(D)}}else if(typeof S.key=="string"&&S.key.startsWith("pick:")){const _=S.key.slice(5),[P,R]=_.split(":"),O=Number(R??"0")||0,D=n.renderCardPreviewByDef(e,P,O);se(D),I.appendChild(D),n.wireUpgradeHoverPreviewForChoice(I,e,P,O)}else if(s&&typeof S.key=="string"&&S.key.startsWith("shop:card:")){const _=String(e.choiceCtx?.nodeId??""),P=e.run?.shops?.[_],R=Number(S.key.slice(10)),O=P?.cards?.[R];if(O?.defId){const D=n.renderCardPreviewByDef(e,String(O.defId),Number(O.upgrade??0)||0);se(D),O.sold&&(D.style.opacity=".35"),I.appendChild(D)}}else if(s&&typeof S.key=="string"&&S.key.startsWith("shop:item:")){const _=String(e.choiceCtx?.nodeId??""),P=e.run?.shops?.[_],R=Number(S.key.slice(10)),O=P?.items?.[R];if(O?.itemId){const D=We(String(O.itemId)),z=te("shopItemCard");if(z.style.cssText="width:calc(150 * var(--u)); aspect-ratio:3/4;border-radius: 0;border:calc(1 * var(--u)) solid rgba(255,255,255,.14);background:rgba(0,0,0,.30);box-shadow: 0 calc(10 * var(--u)) calc(30 * var(--u)) rgba(0,0,0,.25);display:flex; flex-direction:column; align-items:center; justify-content:flex-start;padding:calc(10 * var(--u)); gap:calc(8 * var(--u));user-select:none;"+(O.sold?"opacity:.35; cursor:default;":"cursor:pointer;"),O.sold||(z.onclick=()=>t.onChooseChoice(S.key)),D?.art){const ee=document.createElement("img");ee.src=he(D.art),ee.alt=D?.name??String(O.itemId),ee.style.imageRendering="pixelated",ee.style.cssText="width:calc(84 * var(--u)); height:calc(84 * var(--u));object-fit:contain;image-rendering: pixelated; image-rendering: crisp-edges;",z.appendChild(ee)}const G=Ke("shopItemName",D?.name??String(O.itemId));G.style.cssText="font-weight:900; font-size:calc(13 * var(--u)); text-align:center;";const X=Ke("shopItemPrice",O.sold?"í’ˆì ˆ":`ğŸª™${Number(O.priceGold??0)||0}`);X.style.cssText="opacity:.85; font-size:calc(12 * var(--u));",z.appendChild(G),z.appendChild(X),I.appendChild(z)}}const w=te("choice-right");w.style.cssText="flex:1 1 auto; min-width:calc(260 * var(--u));";const E=at(S.label,()=>t.onChooseChoice(S.key),!1);E.classList.add("primary"),E.style.fontSize="calc(14 * var(--u))",E.style.padding="calc(10 * var(--u)) calc(12 * var(--u))",E.style.borderRadius="calc(10 * var(--u))",w.appendChild(E),S.detail&&w.appendChild(ce(S.detail)),A.appendChild(I),A.appendChild(w),g.appendChild(A)}),s){const S=te("choice-contentRow");S.style.cssText=`display:flex;gap:calc(${m} * var(--u)); margin-top:calc(12 * var(--u));justify-content:center; align-items:stretch;`;const A=te("choice-leftCol");A.style.cssText="flex:1 1 calc(560 * var(--u)); max-width:calc(640 * var(--u)); min-width:0;display:flex; flex-direction:column;",A.appendChild(g);const I=te("choice-illuCol");I.style.cssText=`flex:0 0 calc(${p} * var(--u)); min-width:calc(${y} * var(--u));display:flex; align-items:center; justify-content:center;`;const $=te("choice-illuBox");$.style.cssText="width:100%; aspect-ratio:1/1;border-radius:calc(18 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,1);background:rgba(0,0,0,1);position:relative; overflow:hidden;box-shadow: 0 calc(10 * var(--u)) calc(30 * var(--u)) rgba(0,0,0,.35);";const w=o.art;if(w){const E=document.createElement("img");E.src=he(w),E.alt=o.title??"illustration";const _=1.5;E.style.imageRendering="pixelated",E.style.cssText=`position:absolute; inset:0;width:${_*100}%; height:${_*100}%;left:${-.5*50}%; top:${-.5*50}%;object-fit:cover; object-position:50% 50%;image-rendering: pixelated; image-rendering: crisp-edges;`,$.appendChild(E)}I.appendChild($),S.appendChild(A),S.appendChild(I),B.appendChild(S)}else B.appendChild(g)}M.appendChild(B),U.appendChild(V),U.appendChild(M),document.body.appendChild(U)}function Kt(e,t){const n=document.createElement(e);return t&&(n.className=t),n}function cd(e,t){document.querySelector(".itemTray")?.remove(),document.querySelector(".itemCapHud")?.remove();const n=e.run.items??[];if(!n||n.length===0)return;const r=e.enemies.length>0&&e.phase!=="NODE",o=document.createElement("div");o.className="itemTray",o.classList.add("noScrollbar");let a=null;const s=document.createElement("div");s.className="relicHoverTip itemHoverTip",o.appendChild(s);const i=Ln(e),l=document.createElement("div");l.className="itemCapHud";const c=document.createElement("div");c.className="itemCapBadge",c.textContent=n.length+"/"+i;const d=document.createElement("div");d.className="itemCapHint",d.textContent="ìš°í´ë¦­/Ã—: ë²„ë¦¬ê¸°",l.appendChild(c),l.appendChild(d),document.body.appendChild(l);const h=()=>{const m=a;if(!m){s.classList.remove("show"),s.innerHTML="";return}const u=We(m);s.innerHTML="";const p=document.createElement("div");p.className="relicTipTitle",p.textContent=u?.name??m;const y=document.createElement("div");y.className="relicTipBody",y.textContent=u?.text??"",s.appendChild(p),s.appendChild(y),s.classList.add("show")};for(let m=0;m<n.length;m++){const u=String(n[m]),p=We(u),y=document.createElement("div");y.className="itemSlot",kr(y,u);const k=document.createElement("img");k.alt=p?.name??u,p?.art&&(k.src=he(p.art)),y.appendChild(k);const T=document.createElement("button");T.type="button",T.className="itemDropBtn",T.title="",T.textContent="Ã—",T.onclick=x=>{x.preventDefault(),x.stopPropagation(),t.onDiscardItem(m)},y.appendChild(T),y.oncontextmenu=x=>{x.preventDefault(),x.stopPropagation(),t.onDiscardItem(m)};const C=!r||!!e.choice||!!t.overlayOpen||we(e);C&&y.classList.add("disabled"),y.onclick=x=>{x.stopPropagation(),!C&&t.onUseItem(m)},y.onmouseenter=()=>{a=u,h()},y.onmouseleave=()=>{a=null,h()},o.appendChild(y)}document.body.appendChild(o);try{const m=parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--u"))||1,u=o.getBoundingClientRect();l.style.left=`${Math.round(u.left+6*m)}px`,l.style.top=`${Math.round(u.top-10*m)}px`}catch{}}function dd(e,t){const n=document.getElementById("relicTray");n&&n.remove();const r=e.run.relics??[];if(r.length===0)return;const o=Kt("div","relicTray");o.id="relicTray",o.classList.add("noScrollbar");const a=Kt("div","relicHoverTip");o.appendChild(a);const s=Kt("div","relicTrayList");s.classList.add("noScrollbar"),o.appendChild(s);let i=null;const l=()=>{const c=i;if(!c){a.style.display="none",a.textContent="";return}if(!pe[c]){a.style.display="none",a.textContent="";return}const h=xn(e,c);a.style.display="block",a.innerHTML="";const m=Kt("div","relicTipTitle");m.textContent=h.name;const u=Kt("div","relicTipBody");u.textContent=h.text,a.appendChild(m),a.appendChild(u)};for(const c of r){const d=pe[c];if(!d)continue;const h=xn(e,c),m=document.createElement("button");if(m.type="button",m.className="relicIcon",d.art){const u=document.createElement("img");u.className="relicIconImg",u.alt=h.name,u.src=he(d.art),m.appendChild(u)}else m.textContent=h.name.slice(0,1);m.onmouseenter=()=>{i=c,l()},m.onmouseleave=()=>{i=null,l()},m.onclick=()=>{i=null,l(),t.onOpenRelicModal(c)},s.appendChild(m)}l(),document.body.appendChild(o)}let At=null,$t=null,bt=null;function Ga(){const e=getComputedStyle(document.documentElement).getPropertyValue("--u"),t=parseFloat(e);return Number.isFinite(t)&&t>0?t:1}function vo(e){const t=Ga(),n=e/t;return"calc("+(Number.isFinite(n)?n:0)+" * var(--u))"}function Fr(e,t){const n=pe[t]??null,r=xn(e,t),o=n?.art??n?.icon??null,a=o?String(o):null,s=a?he(a):null;return{id:t,name:r.name,desc:r.text,state:r.state,icon:s,art:a}}function Pn(){At=null,$t=null,document.querySelector(".relicTooltip")?.remove()}function ud(e){bt=e,Pn()}function tr(e){if(document.querySelector(".relicTooltip")?.remove(),!At||!$t)return;const t=Fr(e,At);if(!t.desc&&!t.name)return;const n=L("relicTooltip"),r=L("relicTooltipTitle",t.name);if(n.appendChild(r),t.desc){const d=L("relicTooltipDesc",t.desc);n.appendChild(d)}document.body.appendChild(n);const o=Ga(),a=12*o,s=10*o,i=n.getBoundingClientRect();let l=$t.x-i.width,c=$t.y-i.height-s;l=Math.max(a,Math.min(window.innerWidth-i.width-a,l)),c=Math.max(a,Math.min(window.innerHeight-i.height-a,c)),n.style.left=vo(Math.round(l)),n.style.top=vo(Math.round(c))}function pd(e,t){document.querySelector(".relicHud")?.remove(),document.querySelector(".relicTooltip")?.remove();const n=(e.run.relics??[]).slice();if(n.length===0)return;const r=L("relicHud");for(const o of n.slice().reverse()){const a=Fr(e,o),s=L("relicIcon");if(s.setAttribute("role","button"),s.tabIndex=0,a.icon){const l=Cl(a.icon,"relicIconImg",a.name??a.id??"relic");s.appendChild(l)}else{const l=L(void 0,a.name.slice(0,2));l.style.fontWeight="900",l.style.fontSize="calc(12 * var(--u))",l.style.opacity=".95",s.appendChild(l)}const i=(l,c)=>{At=o,$t={x:l,y:c},tr(e)};s.onpointerenter=l=>i(l.clientX??0,l.clientY??0),s.onpointermove=l=>{At===o&&($t={x:l.clientX??0,y:l.clientY??0},tr(e))},s.onpointerleave=()=>{At===o&&Pn()},s.onclick=l=>{l.preventDefault(),l.stopPropagation(),bt=o,Pn(),t.rerender()},s.onkeydown=l=>{(l.key==="Enter"||l.key===" ")&&(l.preventDefault(),bt=o,t.rerender())},r.appendChild(s)}document.body.appendChild(r),tr(e)}function fd(e,t){if(document.querySelector(".relicModal")?.remove(),!bt)return;const n=Fr(e,bt),r=L("relicModal");r.style.cssText="position: fixed;inset: 0;z-index: var(--zRelicModal, 70000);pointer-events: auto;background: rgba(0,0,0,.55);backdrop-filter: blur(calc(6 * var(--u)));-webkit-backdrop-filter: blur(calc(6 * var(--u)));display: flex;align-items: center;justify-content: center;padding: calc(18 * var(--u));box-sizing: border-box;",r.onclick=m=>{m.target===r&&(bt=null,t.rerender())};const o=L("relicModalPanel");o.onclick=m=>m.stopPropagation();const a=L("relicModalHeader"),s=Cn(n.name,"relicModalTitle");s.style.fontFamily='"ë¬¼ë§ˆë£¨", serif';const i=wa("ë‹«ê¸°",()=>{bt=null,t.rerender()},!1,"overlayClose");a.appendChild(s),a.appendChild(i);const l=L("relicModalBody"),c=L("relicModalArt"),d=L("relicModalArtImg");n.art&&(d.style.backgroundImage=`url("${he(n.art)}")`),c.appendChild(d);const h=ze("pre","relicModalDesc",n.desc||"");h.style.fontFamily='"ë¬¼ë§ˆë£¨", serif',l.appendChild(c),l.appendChild(h),o.appendChild(a),o.appendChild(l),r.appendChild(o),document.body.appendChild(r)}const hd=`# Deck Rogue Prototype â€” ë£°ë¶ (í”Œë ˆì´ì–´ìš©)

ì´ ë¬¸ì„œëŠ” ìŠ¤í¬ì¼ëŸ¬ë¥¼ ìµœì†Œí™”í•©ë‹ˆë‹¤.

[1] ê°œìš”
ë…¸ë“œë¥¼ ì„ íƒí•˜ë©° ì§„í–‰í•˜ê³ , ì „íˆ¬ì—ì„œ ì‚´ì•„ë‚¨ì•„ ì„±ì¥í•©ë‹ˆë‹¤.
ë˜ì „ ê¹Šìˆ™í•œ ê³³ì˜ [ì €ì£¼ë°›ì€ ë³´ë¬¼]ì„ ì–»ê³ , ì…êµ¬ë¡œ ë˜ëŒì•„ì˜¤ë©´ ìŠ¹ë¦¬í•©ë‹ˆë‹¤.
ëª¨ë“  ì¹´ë“œëŠ” ì „ì—´ê³¼ í›„ì—´ì´ ìˆìŠµë‹ˆë‹¤. ë°°ì¹˜ì— ë”°ë¼ ì—­í• ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤.

[2] ë³´ê¸‰ê³¼ í”¼ë¡œë„

ë³´ê¸‰(S): ì „ì—´ ì¹´ë“œ ë° ì¼ë¶€ íš¨ê³¼ì˜ ë°œë™ì— ì‚¬ìš©ë©ë‹ˆë‹¤. ì „ì—´ ì¹´ë“œëŠ” ì‚¬ìš©ë§Œìœ¼ë¡œ 1ì˜ ë³´ê¸‰ì„ ì†Œë¹„í•©ë‹ˆë‹¤. ëŒ€ë¶€ë¶„ 7ë¡œ ì‹œì‘í•©ë‹ˆë‹¤.
ë³´ê¸‰ì´ 0ì¸ ìƒíƒœë¡œ í„´ ì¢…ë£Œ ì‹œ í”¼ë¡œë„ë§Œí¼ í”¼í•´ë¥¼ ë°›ìŠµë‹ˆë‹¤.

í”¼ë¡œë„(F): ë±ì„ ì„ì„ ë•Œ 1 ì˜¬ë¼ê°‘ë‹ˆë‹¤. ì „ì—´ ì¹´ë“œë¥¼ ìœ„í•œ ë³´ê¸‰ì´ ì—†ëŠ” ì±„ë¡œ í„´ì´ ì¢…ë£Œë˜ë©´ ë¶€ì¡±ë¶„ë§Œí¼ í”¼ë¡œë„ë¥¼ ì–»ìŠµë‹ˆë‹¤. ì¼ë¶€ ì¹´ë“œì˜ íš¨ê³¼ë¡œë„ ëŠ˜ì–´ë‚˜ê±°ë‚˜ ì¤„ì–´ë“­ë‹ˆë‹¤. í”¼ë¡œë„ëŠ” ì „íˆ¬ê°€ ëë‚˜ë„ ìœ ì§€ë©ë‹ˆë‹¤. ë„ˆë¬´ ìŒ“ì¸ í”¼ë¡œëŠ” ë•Œë•Œë¡œ ë‹¹ì‹ ì„ ë³€í•˜ê²Œ í•©ë‹ˆë‹¤.

[3] ì „íˆ¬ íë¦„
ë°°ì¹˜ â†’ í›„ì—´ ë°œë™ â†’ ì „ì—´ ë°œë™ â†’ ì  í–‰ë™ â†’ ì •ë¦¬ â†’ ë“œë¡œìš°
â€» â€œëŒ€ìƒ ì„ íƒ í•„ìš”â€ê°€ ëœ¨ë©´ ì‚´ì•„ìˆëŠ” ì ì„ í´ë¦­í•´ ëŒ€ìƒì„ ì •í•˜ì„¸ìš”.
â€» "ë‹¤ìŒ í„´"ì„ ëˆ„ë¥´ë©´ í„´ì´ ì§„í–‰ë˜ì–´, ì¹´ë“œì˜ ë°°ì¹˜ë¥¼ ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
ë³´ê¸‰ ë¹„ìš© ë° ê·¸ì— ë”°ë¥¸ í”¼ë¡œë„ ë“±ì˜ ë³€í™”ëŠ” ì •ë¦¬ ë‹¨ê³„ì—ì„œ ì²˜ë¦¬í•©ë‹ˆë‹¤.

ì†íŒ¨ëŠ” í„´ì´ ì¢…ë£Œë˜ì–´ë„ ìœ ì§€ë©ë‹ˆë‹¤.
ì¹´ë“œëŠ” ë§¤ í„´ë§ˆë‹¤ ì‚¬ìš©í•œ ë§Œí¼ ë½‘ìŠµë‹ˆë‹¤. ì¦‰, ì¹´ë“œë¡œ ì¸í•œ ë“œë¡œìš°ëŠ” íŒ¨ì˜ ë§¤ìˆ˜ ìì²´ë¥¼ ëŠ˜ë¦¬ëŠ” íš¨ê³¼ê°€ ìˆìŠµë‹ˆë‹¤.

[4] ìš©ì–´
- ì†Œëª¨: ì´ë²ˆ ì „íˆ¬ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ì—†ê²Œ ë˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
- ì†Œì‹¤: ëŸ° ì „ì²´ì—ì„œ í•´ë‹¹ ì¹´ë“œê°€ ì‚¬ë¼ì§€ëŠ” ê²ƒì…ë‹ˆë‹¤.
- ì·¨ì•½: ë°›ëŠ” í”¼í•´ê°€ (ì·¨ì•½)ë§Œí¼ ì¦ê°€í•©ë‹ˆë‹¤.
- ì•½í™”: ì£¼ëŠ” í”¼í•´ê°€ (ì•½í™”)ë§Œí¼ ê°ì†Œí•©ë‹ˆë‹¤.
- ì¶œí˜ˆ: í„´ ì¢…ë£Œ ì‹œ (ì¶œí˜ˆ)ë§Œí¼ í”¼í•´ë¥¼ ì…ìŠµë‹ˆë‹¤.
- êµë€: 0ë³´ë‹¤ ë†’ìœ¼ë©´, ë¬´ì‘ìœ„ í›„ì—´ ìŠ¬ë¡¯ í•˜ë‚˜ê°€ ë¹„í™œì„±í™”ë©ë‹ˆë‹¤.
- ì„¤ì¹˜: í„´ì´ ëë‚  ë•Œ íšŒìˆ˜í•˜ì§€ ì•ŠëŠ” ì¹´ë“œì…ë‹ˆë‹¤. ì „ì—´ì˜ ê²½ìš° SëŠ” ê·¸ëŒ€ë¡œ ì†Œëª¨í•©ë‹ˆë‹¤.
- ì„ ì²œì„±: ì²« í„´ì— í™•ì •ì ìœ¼ë¡œ ë½‘ìŠµë‹ˆë‹¤. ê¸°ì¡´ì˜ ì‹œì‘ ì†íŒ¨ë³´ë‹¤ ë§ì€ ì„ ì²œì„± ì¹´ë“œë¥¼ ì§€ë‹Œ ê²½ìš°, ê·¸ ìˆ˜ì™€ ë¬´ê´€í•˜ê²Œ ëª¨ë“  ì„ ì²œì„± ì¹´ë“œë¥¼ ë½‘ìŠµë‹ˆë‹¤.
- ë¶€ë™: ì´ë™í•˜ê±°ë‚˜ íšŒìˆ˜í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

[5] ì¡°ì‘

(ì»´í“¨í„°)
- 4: ì„ íƒ í•´ì œ
- Tab: ì†íŒ¨ ì„ íƒ ì´ë™
- 1~3: ì „ì—´ ë°°ì¹˜ / q,w,e: í›„ì—´ ë°°ì¹˜
- ë“œë˜ê·¸: ì†íŒ¨â†’ìŠ¬ë¡¯ ë°°ì¹˜, ìŠ¬ë¡¯â†”ìŠ¬ë¡¯ ìŠ¤ì™‘, ìŠ¬ë¡¯â†’ì†íŒ¨ íšŒìˆ˜
- Space: ë‹¤ìŒ í„´
- P: ìƒˆë¡œìš´ ëŸ°

[6]

ì‹œê°„ì€ ê¸ˆì…ë‹ˆë‹¤. ëª¨ë“  í–‰ë™ì€ ì‹œê°„ì„ ì†Œëª¨í•©ë‹ˆë‹¤. ì‹¸ì›€ì€ ì¢€ ë” ì†Œëª¨í•©ë‹ˆë‹¤.
ì¤‘ìš”í•œ ê±´ ì´ê³³ì´ ë‹¹ì‹ ì—ê²Œ ë„‰ë„‰í•œ ì‹œê°„ì„ ì£¼ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒì´ê² ì§€ìš”.
`;function md(e,t,n,r){if(document.querySelector(".overlay-layer")?.remove(),!t)return;const o=t.kind==="SETTINGS",a=L("overlay-layer");a.style.cssText=o?"position:fixed; inset:0;background:rgba(0,0,0,1);display:flex; justify-content:center; align-items:flex-start;padding:calc(24 * var(--u)); box-sizing:border-box;":"position:fixed; inset:0;background:rgba(0,0,0,.55);display:flex; justify-content:center; align-items:center;",a.onclick=h=>{h.target===a&&n.onCloseOverlay?.()};const s=L("overlay-panel");s.style.cssText=o?"width:min(calc(860 * var(--u)), 96vw); max-height:calc(100vh - calc(48 * var(--u))); overflow:auto;padding:calc(16 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.12); border-radius:calc(16 * var(--u));background:rgba(15,18,22,1); box-shadow:0 calc(18 * var(--u)) calc(60 * var(--u)) rgba(0,0,0,.45);":"width:min(calc(980 * var(--u)), 92vw); max-height:80vh; overflow:auto; padding:calc(16 * var(--u));border:calc(1 * var(--u)) solid rgba(255,255,255,.12); border-radius:calc(16 * var(--u));background:rgba(15,18,22,.92); box-shadow:0 calc(18 * var(--u)) calc(60 * var(--u)) rgba(0,0,0,.45);",s.onclick=h=>h.stopPropagation();const i=t.kind==="RULEBOOK"?"ë£°ë¶":t.kind==="SETTINGS"?"ì„¤ì •":t.pile==="deck"?"ë±":t.pile==="discard"?"ë²„ë¦¼ ë”ë¯¸":t.pile==="exhausted"?"ì†Œëª¨(ì´ë²ˆ ì „íˆ¬)":t.pile==="vanished"?"ì†Œì‹¤(ì˜êµ¬)":"ì†íŒ¨",l=L("overlayHeader");l.style.cssText="display:flex; align-items:center; justify-content:space-between; gap:calc(12 * var(--u)); position:sticky; top:0; padding-bottom:calc(12 * var(--u)); margin-bottom:calc(12 * var(--u)); background:rgba(15,18,22,.92);";const c=Cn(i);c.classList.add("overlayTitle");const d=wa("ë‹«ê¸°",()=>n.onCloseOverlay?.());if(d.classList.add("overlayClose"),d.style.cssText="padding:calc(8 * var(--u)) calc(12 * var(--u)); border-radius:calc(12 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.16); background:rgba(255,255,255,.06); color:#fff; cursor:pointer;",l.appendChild(c),l.appendChild(d),s.appendChild(l),t.kind==="RULEBOOK"){const h=document.createElement("pre");h.className="rulebook",h.textContent=hd,h.style.cssText="white-space:pre-wrap; line-height:1.45; font-size:calc(13 * var(--u)); margin:0; padding:calc(12 * var(--u)); border-radius:calc(12 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.10); background:rgba(0,0,0,.18);",s.appendChild(h)}else if(t.kind==="SETTINGS")s.appendChild(r.renderSettingsPanel(()=>{r.onAfterSettingsChange(),n.rerender?.()},n));else{const m=[...t.pile==="deck"?e.deck:t.pile==="discard"?e.discard:t.pile==="exhausted"?e.exhausted:t.pile==="vanished"?e.vanished:e.hand].sort((W,j)=>{const U=r.displayNameForUid(e,W),V=r.displayNameForUid(e,j);return U.localeCompare(V,"ko")}),u=L("pileView");u.style.cssText="display:grid;grid-template-columns: 1fr calc(320 * var(--u));gap:calc(16 * var(--u));align-items:start;";const p=L("pileGrid");p.style.cssText="display:grid;grid-template-columns: repeat(auto-fill, minmax(var(--handCardW), 1fr));gap:calc(10 * var(--u));align-content:start;min-width:0;max-height: 62vh;overflow-y: auto;overflow-x: hidden;";const y=L("pileSide");y.style.cssText="position:sticky; top:calc(72 * var(--u));align-self:start;border:calc(1 * var(--u)) solid rgba(255,255,255,.10);border-radius:calc(14 * var(--u));padding:calc(12 * var(--u));background:rgba(0,0,0,.22);";const k=L("pileSideTitle");k.style.cssText="font-weight:800; margin:0 0 calc(10 * var(--u)) 0; opacity:.95;",y.appendChild(k);const T=L("pilePreviewBox");T.style.cssText="display:flex; justify-content:center; align-items:flex-start;padding:calc(8 * var(--u)) 0 calc(10 * var(--u)) 0;",y.appendChild(T);const C=document.createElement("pre");C.className="pileSideDetail",C.style.cssText="margin:0;padding:calc(10 * var(--u));white-space:pre-wrap;border-radius:calc(12 * var(--u));border:calc(1 * var(--u)) solid rgba(255,255,255,.10);background:rgba(0,0,0,.20);font-size:calc(12 * var(--u));line-height:1.45;",y.appendChild(C);let x=m[0]??null;const N=()=>{if(T.innerHTML="",!x){k.textContent="ì„ íƒëœ ì¹´ë“œ ì—†ìŒ",C.textContent="";return}const W=r.getCardDefByUid(e,x),j=r.displayNameForUid(e,x),U=Ae(e,W.frontText,W.backText,x);k.textContent=j,T.appendChild(r.renderRealCardForOverlay(e,x)),C.textContent=`ì „ì—´: ${U.frontText}
í›„ì—´: ${U.backText}`};if(m.length===0){const W=L("overlayEmpty");W.textContent="ë¹„ì–´ ìˆìŒ",W.style.cssText="padding:calc(12 * var(--u)); border-radius:calc(12 * var(--u)); border:calc(1 * var(--u)) solid rgba(255,255,255,.10); background:rgba(255,255,255,.03);",p.appendChild(W)}else for(const W of m){const j=r.renderRealCardForOverlay(e,W,U=>{x=U,p.querySelectorAll(".pileSelected").forEach(V=>V.classList.remove("pileSelected")),j.classList.add("pileSelected"),N()});j.style.width="var(--handCardW)",j.style.height="var(--handCardH)",j.style.boxSizing="border-box",j.style.cursor="pointer",W===x&&j.classList.add("pileSelected"),p.appendChild(j)}u.appendChild(p),u.appendChild(y),s.appendChild(u),N()}a.appendChild(s),document.body.appendChild(a)}function bd(e,t){const{g:n,cardUid:r,draggable:o,isTargeting:a,beginDrag:s,isDraggingNow:i,onTouchHold:l}=t;let c=null,d=0,h=0,m=!1,u=-1,p=!1;const y=()=>!(a(n)||n.phase!=="PLACE"||!o),k=()=>{c!=null&&(window.clearTimeout(c),c=null)};e.onpointerdown=T=>{if(T.button!==0&&T.pointerType==="mouse")return;const C=T;if(C.pointerType==="touch"){m=!1,u=C.pointerId,p=!0,d=C.clientX,h=C.clientY,k(),l&&(c=window.setTimeout(()=>{p&&(i()||l())},320));return}if(a(n)||n.phase!=="PLACE"||!o)return;const x=n.hand.indexOf(r);s(T,{kind:"hand",cardUid:r,fromHandIndex:x})},e.addEventListener("pointermove",T=>{const C=T;if(C.pointerType!=="touch")return;const x=C.clientX-d,N=C.clientY-h;if(!(x*x+N*N>144)||(k(),i())||!p||!y())return;m=!0,p=!1;const j=n.hand.indexOf(r),U={currentTarget:e,pointerId:u,clientX:C.clientX,clientY:C.clientY};s(U,{kind:"hand",cardUid:r,fromHandIndex:j})},{passive:!0}),e.addEventListener("pointerup",T=>{T.pointerType==="touch"&&(p=!1,k())},{passive:!0}),e.addEventListener("pointercancel",T=>{T.pointerType==="touch"&&(p=!1,k())},{passive:!0}),e.addEventListener("click",T=>{m&&(m=!1,T.preventDefault(),T.stopPropagation())},!0)}function yd(e,t){const{title:n,detailText:r,root:o,api:a,buildBigCardEl:s,isDraggingNow:i,isHoverSuppressed:l,suppressHover:c,isMobile:d,getPinnedCardUid:h,setPinnedCardUid:m,clearCardHoverPreview:u,getDragPointerId:p}=t;a.ensure(o),e.addEventListener("pointerenter",()=>{if(l()||i()||a.isPinned?.()&&h())return;const y=s();a.show({title:n,detail:r,cardEl:y})}),e.addEventListener("pointerleave",()=>{a.isPinned?.()||a.hide()}),e.addEventListener("pointerup",y=>{const k=y;if(k.pointerType==="mouse"||k.pointerType==="touch"||!d()||i())return;const T=p();if(T!=null&&T===k.pointerId||l())return;if(h()===t.cardUid&&a.isPinned?.()){m(null),a.unpin?.(),a.hide();return}m(t.cardUid);const x=s();a.show({title:n,detail:r,cardEl:x}),a.pin?.()},{passive:!0}),e.addEventListener("pointerdown",y=>{y.pointerType!=="touch"&&(c(250),!(a.isPinned?.()&&h())&&u())},{capture:!0})}const kd={ì·¨ì•½:"ğŸ¯",ì•½í™”:"ğŸ¥€",ì¶œí˜ˆ:"ğŸ©¸",êµë€:"ğŸŒ€",ë©´ì—­:"âœ¨",S:"ğŸ",F:"ğŸ’¤",ë“œë¡œìš°:"ğŸƒ",í”¼í•´:"ğŸ—¡ï¸",íšŒë³µ:"ğŸ’Š",ë°©ì–´:"ğŸ›¡ï¸",ë¸”ë¡:"ğŸ›¡ï¸",ì†Œëª¨:"ğŸ”¥",ì†Œì‹¤:"ğŸ•³ï¸"};function xo(e,t,n,r){const o=kd[e]??"",a=t!=null?r?`<span class="${r}">${t}</span>`:t:"",s=t!=null?`${e} ${a}`:e;return`<span class="kwBadge"><span class="kwIcon">${o}</span> <span class="kwLabel">${s}</span><span class="kwPunc">${n||""}</span></span>`}const qa="[,ï¼Œã€]",xr=new RegExp(`(ì·¨ì•½|ì•½í™”|ì¶œí˜ˆ|êµë€|ë©´ì—­|S|F|ë“œë¡œìš°|í”¼í•´|ë°©ì–´|ë¸”ë¡|íšŒë³µ|ì†Œëª¨|ì†Œì‹¤)\\s*([+-]?\\d+)\\s*(${qa})?`,"g"),Td=new RegExp(`(^|[^ê°€-í£A-Za-z0-9_])(ì†Œëª¨|ì†Œì‹¤)\\s*(${qa})?`,"g");function vd(e,t){const n=[];String(t??"").replace(xr,(a,s,i)=>{const l=Number(i);return n.push(Number.isFinite(l)?l:0),a});const r=[];String(e??"").replace(xr,(a,s,i)=>{const l=Number(i);return r.push(Number.isFinite(l)?l:0),a});let o=0;return a=>{const s=Number(a),i=n[o]??s,l=r[o]??s;return o+=1,!Number.isFinite(s)||!Number.isFinite(i)||!Number.isFinite(l)?"":l>i?"numDeltaUp":l<i?"numDeltaDown":""}}function xd(e,t){const n=String(e??""),r=vd(n,t??n);let o=n.replace(xr,(a,s,i,l)=>xo(s,i,l,r(String(i))));return o=o.replace(Td,(a,s,i,l)=>`${s}${xo(i,void 0,l)}`),o=o.replace(/\\n/g,"<br>"),o}function Co(e,t){const n=document.createElement("div");return n.className="cardText",n.innerHTML=xd(e,t),n}function Xe(e){if(!e)return"";if(typeof e=="string")return e;if(Array.isArray(e))return e.map(Xe).join("");if(typeof e=="object"){if(e.text)return String(e.text);if(e.children)return Xe(e.children)}return""}function Cr(e,t,n,r,o,a){const s=t.cards[n],i=xe(t.content,s.defId,s.upgrade??0),l=Ae(t,i.frontText,i.backText,n),d=!!s?.synth?.done,h=a?.draggable??!0,m=a?.mode??"FULL",u=e.div("card"),p=i.rarity??(String(s.defId).startsWith("mad_")?"MADNESS":"COMMON");u.classList.add(`rarity-${String(p).toLowerCase()}`),d&&u.classList.add("synthesized"),t.selectedHandCardUid===n&&u.classList.add("selected");const y=i.exhaustWhen,k=i.vanishWhen,T=y&&y!=="NONE"||i.tags?.includes("EXHAUST"),C=k&&k!=="NONE"||i.tags?.includes("VANISH");T&&u.classList.add("exhaust"),C&&u.classList.add("vanish"),m==="SLOT_NAME_ONLY"&&u.classList.add("slotNameOnly");const x=e.div("cardHeader"),N=e.displayNameForUid(t,n);if(x.appendChild(e.divText("cardTitle",N)),m==="FULL"){const W=e.div("cardMeta");T&&W.appendChild(e.badge("")),C&&W.appendChild(e.badge("")),x.appendChild(W)}if(u.appendChild(x),m==="FULL"){const W=e.div("cardBody"),U=!!t.cards[n]?.flipped,V=U?l.backText:l.frontText,M=U?l.frontText:l.backText,B=U?i.backText:i.frontText,F=U?i.frontText:i.backText,K=e.div("cardSection");K.classList.add("front"),K.appendChild(Co(V,B)),W.appendChild(K);const re=e.div("cardSection");re.classList.add("back"),re.appendChild(Co(M,F)),W.appendChild(re),u.appendChild(W)}if(r&&o&&(u.onclick=()=>o(n)),r){const W=()=>{if(!a?.hoverPreview||e.isDraggingNow())return;const{root:j,api:U,buildDetail:V}=a.hoverPreview;U.ensure(j);const M=V?.(t,n)??(()=>{const F=Xe(je(t,i.frontText,n)),K=Xe(je(t,i.backText,n));return`ì „ì—´: ${F||"ì—†ìŒ"}
í›„ì—´: ${K||"ì—†ìŒ"}`})(),B=Cr(e,t,n,!1,void 0,{draggable:!1,mode:"FULL"});B.classList.add("isPreviewCard"),e.setPinnedCardUid(n),U.show({title:N,detail:M,cardEl:B}),U.pin?.()};bd(u,{g:t,cardUid:n,draggable:h,isTargeting:e.isTargeting,isDraggingNow:e.isDraggingNow,beginDrag:e.beginDrag,onTouchHold:W})}if(a?.hoverPreview){const{root:W,api:j,buildDetail:U}=a.hoverPreview;j.ensure(W);const V=U?.(t,n)??(()=>{const M=Xe(je(t,i.frontText,n)),B=Xe(je(t,i.backText,n));return`ì „ì—´: ${M||"ì—†ìŒ"}
í›„ì—´: ${B||"ì—†ìŒ"}`})();yd(u,{cardUid:n,title:N,detailText:V,root:W,api:j,buildBigCardEl:()=>{const M=Cr(e,t,n,!1,void 0,{draggable:!1,mode:"FULL"});return M.classList.add("isPreviewCard"),M},isDraggingNow:e.isDraggingNow,isHoverSuppressed:e.isHoverSuppressed,suppressHover:e.suppressHover,isMobile:e.isMobile,getPinnedCardUid:e.getPinnedCardUid,setPinnedCardUid:e.setPinnedCardUid,clearCardHoverPreview:e.clearCardHoverPreview,getDragPointerId:e.getDragPointerId})}return u}let Ye=null;function Cd(){Ye||(Ye=document.createElement("div"),Ye.id="hudSOnly",Ye.style.display="none",document.body.appendChild(Ye))}function wd(e){if(Ye||Cd(),!!Ye){if(e==null||Number.isNaN(e)){Ye.style.display="none";return}Ye.textContent=`ğŸ ${e}`,Ye.style.display=""}}function _d(){return{seq:1,list:[]}}function jt(e,t,n,r,o){e.list.push({id:e.seq++,kind:t,text:n,x:r,y:o,born:performance.now()})}function Sd(e,t){const n=performance.now();e.list=e.list.filter(r=>n-r.born<t(700))}function gd(e,t){Sd(e,t);let n=document.querySelector(".floatFxLayer");n||(n=document.createElement("div"),n.className="floatFxLayer",document.body.appendChild(n)),n.style.cssText="position:fixed; inset:0;pointer-events:none;z-index: var(--zChrome);";const r=new Set(e.list.map(o=>String(o.id)));Array.from(n.querySelectorAll(".floatNum[data-fx-id]")).forEach(o=>{const a=String(o.dataset.fxId??"");r.has(a)||o.remove()});for(const o of e.list){const a=String(o.id);let s=n.querySelector(`.floatNum[data-fx-id="${a}"]`);s||(s=document.createElement("div"),s.className=`floatNum ${o.kind}`,s.dataset.fxId=a,s.textContent=o.text,s.style.position="absolute",n.appendChild(s));const i=o.x/window.innerWidth*100,l=o.y/window.innerHeight*100;s.style.left=`${i.toFixed(4)}vw`,s.style.top=`${l.toFixed(4)}vh`}}function Ed(){return{seq:1,list:[]}}function Nd(e,t){const n=e,r=n.uiToasts??[];if(!r||r.length===0)return;const o=performance.now();for(const a of r){const s=String(a.kind??"INFO"),i=String(a.text??""),l=Math.max(200,Number(a.ms??1600)||1600);t.list.push({id:t.seq++,kind:s,text:i,born:o,ms:l})}n.uiToasts=[]}function Ad(e,t){const n=performance.now(),r=Math.max(0,Math.min(2,Number(t()??1)||1));e.list=e.list.filter(o=>n-o.born<o.ms*r)}function $d(e,t,n){Nd(e,t),Ad(t,n);let r=document.querySelector(".toastLayer");r||(r=document.createElement("div"),r.className="toastLayer",document.body.appendChild(r)),r.innerHTML="";for(const o of t.list){const a=document.createElement("div");a.className=`toast toast-${o.kind.toLowerCase()}`,a.textContent=o.text,r.appendChild(a)}}function Md(e,t){let n=null,r=null,o=[];function a(){n=null,r=null,o=[]}function s(d){const h=it(),m=document.querySelector(".playerHudBox")??document.querySelector(".playerHudLeft");if(!m)return;const u=m.getBoundingClientRect(),p=(u.left+u.right)/2,y=u.top+14*h;d<0?jt(e,"dmg",`${d}`,p,y):jt(e,"heal",`+${d}`,p,y),m.classList.add("fxFlash"),setTimeout(()=>m.classList.remove("fxFlash"),t(240))}function i(d){const h=it(),m=document.querySelector(".playerHudBox")??document.querySelector(".playerHudLeft");if(!m)return;const u=m.getBoundingClientRect(),p=(u.left+u.right)/2,y=u.top+34*h;jt(e,"block",d>0?`+${d}`:`${d}`,p,y)}function l(d,h){const u=Array.from(document.querySelectorAll(".enemyHudCenter .enemyBanner"))[d];if(!u)return;const p=u.getBoundingClientRect(),y=(p.left+p.right)/2,k=p.top+14;h<0?jt(e,"dmg",`${h}`,y,k):jt(e,"heal",`+${h}`,y,k),u.classList.add("fxFlash"),setTimeout(()=>u.classList.remove("fxFlash"),t(240))}function c(d){if(!(!d.run.finished&&d.enemies.length>0&&d.phase!=="NODE")){a();return}if(n!=null){const m=d.player.hp-n;m!==0&&s(m)}if(r!=null){const m=d.player.block-r;m!==0&&i(m)}for(let m=0;m<d.enemies.length;m++){const u=d.enemies[m].hp,p=o[m];p!=null&&u!==p&&l(m,u-p)}n=d.player.hp,r=d.player.block,o=d.enemies.map(m=>m.hp)}return{tick:c,reset:a}}let mn=null;function Pd(e){mn!=null&&window.clearTimeout(mn),mn=window.setTimeout(()=>{mn=null,Xl(e)},250)}function Ne(e,t,n){const r=document.createElement("button");return r.type="button",r.textContent=e,r.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation(),t()}),r}function Rd(e){const t=document.createElement("span");return t.className="badge",t.textContent=e,t}function Bd(e){return he(`assets/enemies/${e}.png`)}const wo={vuln:"ğŸ¯",weak:"ğŸ¥€",bleed:"ğŸ©¸",disrupt:"ğŸŒ€",immune:"âœ¨",supplies:"ğŸ",fatigue:"ğŸ’¤",slash:"ğŸ—¡ï¸"};function Id(e,t){const n=L("enemyStatusEmojiRow"),r=(o,a)=>{if(!a||a<=0)return;const s=document.createElement("span");s.className="stEmoji",s.textContent=`${wo[o]??"?"}${a}`,n.appendChild(s)};if(r("vuln",e?.vuln??0),r("weak",e?.weak??0),r("bleed",e?.bleed??0),r("disrupt",e?.disrupt??0),r("slash",e?.slash??0),t){const o=document.createElement("span");o.className="stEmoji",o.textContent=`${wo.immune}1`,n.appendChild(o)}return n}function Ya(e){return e==="ATTACK"||e==="ATTACK_BUFF"||e==="ATTACK_DEBUFF"}function Ld(e,t,n){if(!n||!Ya(n.cat))return"";const r=Math.max(1,Number(n.hits??1)||1),o=Math.max(0,Number(n.perHit??0)||0),a=Math.max(0,Number(n.dmgTotal??o*r)||0);if(r>1){if(o<=0)return`${a} (${r}íƒ€)`;const s=o*r;if(a===s)return`${a} (${o}x${r})`;const i=Math.max(0,Number(e.player?.block??0)||0);if(i>0){let l=i;const c=[];for(let h=0;h<r;h++){const m=Math.min(l,o);l-=m,c.push(o-m)}if(c.reduce((h,m)=>h+m,0)===a)return c.every(m=>m===c[0])?`${a} (${c[0]}x${r})`:`${a} (${c.join("+")})`}return`${a} (${o}x${r})`}return`${a}`}function Od(e){if(!e)return"?";const t=Ya(e.cat),n=e.applies??[],r=n.some(s=>s.target==="player"),o=n.some(s=>s.target==="enemy");let a="";if(t&&(a+="ğŸ—¡ï¸"),r&&(a+="ğŸŒ€"),o&&(a+="âœ¨"),!a){const s=e.cat;return s==="DEFEND"?"ğŸ›¡ï¸":s==="BUFF"?"âœ¨":s==="DEBUFF"?"ğŸŒ€":"?"}return a}function Dd(e,t){document.querySelectorAll(".topHud").forEach(x=>x.remove()),document.querySelectorAll(".enemyHudCenter").forEach(x=>x.remove());const n=document.body.classList.contains("mobile"),r=document.body.classList.contains("portrait"),o=n&&r,a=L("topHud");a.appendChild(L("topHudLeftSpacer"));const s=L("playerHudLeft"),i=L("playerTitleRow");if(i.appendChild(Te("playerHudTitle","í”Œë ˆì´ì–´")),!o){const x=L("pileButtons");x.appendChild(Ne("ë±",()=>t.onViewPile("deck"))),x.appendChild(Ne("ë²„ë¦¼",()=>t.onViewPile("discard"))),x.appendChild(Ne("ì†íŒ¨",()=>t.onViewPile("hand"))),x.appendChild(Ne("ì†Œëª¨",()=>t.onViewPile("exhausted"))),x.appendChild(Ne("ì†Œì‹¤",()=>t.onViewPile("vanished"))),i.appendChild(x)}s.appendChild(i);const l=L("enemyChip");l.classList.add("playerHudBox");const c=L("enemyChipTop");c.appendChild(Te("","HP")),c.appendChild(Te("",`${e.player.hp}/${e.player.maxHp}`)),l.appendChild(c);const d=L("enemyHPOuter"),h=L("enemyHPFill");h.style.width=`${Math.max(0,Math.min(100,e.player.hp/Math.max(1,e.player.maxHp)*100))}%`,d.appendChild(h),l.appendChild(d);const m=L("enemyChipTop");m.appendChild(Te("","ë¸”ë¡")),m.appendChild(Te("",`${e.player.block}`)),l.appendChild(m);const u=L("enemyHPOuter"),p=L("enemyHPFill");p.style.background="#2a7cff",p.style.width=`${Math.max(0,Math.min(100,e.player.block/Math.max(1,e.player.maxHp)*100))}%`,u.appendChild(p),l.appendChild(u);const y=e.player.status,k=L("enemyBadges");l.appendChild(k);const T=[];(y.vuln??0)>0&&T.push(`ì·¨ì•½ ${y.vuln}`),(y.weak??0)>0&&T.push(`ì•½í™” ${y.weak}`),(y.bleed??0)>0&&T.push(`ì¶œí˜ˆ ${y.bleed}`),(y.disrupt??0)>0&&T.push(`êµë€ ${y.disrupt}`),(y.slash??0)>0&&T.push(`ì¹¼ë¶€ë¦¼ ${y.slash}`);for(const x of T)k.appendChild(Rd(x));if(s.appendChild(l),!e.run.finished&&e.enemies.length>0&&e.phase!=="NODE"){const x=L(o?"mobileEnemyStrip":"enemyHudCenter");x.dataset.enemyCount=String(e.enemies.length),e.enemies.length===2&&x.classList.add("enemyCount2"),e.enemies.length===3&&x.classList.add("enemyCount3");const N=L("enemyHudCenterMover"),W=L("enemyHud");W.style.cssText=`
      display: flex;
      flex-direction: row;
      flex-wrap: nowrap;
      justify-content: center;
      align-items: stretch;
      gap: calc(14 * var(--u));
      overflow: visible;
      white-space: nowrap;
    `,x.style.overflow="visible",N.style.overflow="visible",N.style.width="max-content";const j=we(e);N.appendChild(W),x.appendChild(N),o?a.appendChild(x):document.body.appendChild(x);for(let U=0;U<e.enemies.length;U++){const V=e.enemies[U],M=L("enemyBanner enemyCardWrap");let B=!1;if(j&&V.hp>0&&(e.pendingTarget??null)?.kind==="damageSelect"&&V.id==="goblin_assassin"){const D=e.enemies.filter(z=>z.hp>0).indexOf(V)+1;(D===2||D===3)&&(B=!0)}j&&V.hp>0&&!B&&M.classList.add("targetable"),B&&M.classList.add("untargetable");const F=()=>{const P=M.classList.contains("touchHover");document.querySelectorAll(".enemyBanner.touchHover").forEach(R=>R.classList.remove("touchHover")),P||M.classList.add("touchHover")};let K=!1;M.addEventListener("pointerdown",P=>{P.pointerType==="touch"&&(j||(F(),K=!0,P.preventDefault(),P.stopPropagation()))},{passive:!1}),M.addEventListener("pointerenter",P=>{P.pointerType!=="touch"&&M.classList.add("touchHover")}),M.addEventListener("pointerleave",P=>{P.pointerType!=="touch"&&M.classList.remove("touchHover")}),M.addEventListener("pointerup",P=>{if(P.pointerType==="touch"){if(j){t.onSelectEnemy(U);return}F(),K=!0,P.preventDefault(),P.stopPropagation()}},{passive:!1}),M.onclick=P=>{if(K){K=!1,P.preventDefault(),P.stopPropagation();return}if(j){t.onSelectEnemy(U);return}F(),P.preventDefault(),P.stopPropagation()};const re=L("enemyArtWrap"),ae=L("enemyArtCard");re.style.setProperty("--frameImg",`url("${he("assets/enemies/enemies_frame.png")}")`),re.style.setProperty("--artImg",`url("${Bd(V.id)}")`),re.appendChild(ae);const ne=L("enemyMiniHud"),J=e.content.enemiesById[V.id],se=J.intents[V.intentIndex%J.intents.length],ce=V.intentLabelOverride??se.label,H=e.intentsRevealedThisTurn?ea(e,V,se,{includeBlock:!1}):null,$e=L("enemyIntentTopRow");let Z="ï¼Ÿ",b="";e.intentsRevealedThisTurn&&H?(Z=Od(H),b=Ld(e,V,H)??""):(Z="ï¼Ÿ",b=""),$e.appendChild(Te("enemyIntentIcon",Z)),$e.appendChild(Te("enemyIntentDmg",b)),ne.appendChild($e);const v=J.passives;if(v&&v.length){const P=L("enemyPassiveRow");for(const R of v.slice(0,4)){const O=Te("enemyPassiveIcon",String(R.icon??"â“…"));P.appendChild(O)}ne.appendChild(P)}const g=L("enemyHpLine");g.appendChild(Te("enemyHpText",`HP ${V.hp}/${V.maxHp}`));const S=L("enemyHPOuter"),A=L("enemyHPFill");A.style.width=`${Math.max(0,Math.min(100,V.hp/Math.max(1,V.maxHp)*100))}%`,S.appendChild(A),g.appendChild(S),ne.appendChild(g),ne.appendChild(Id(V.status,V.immuneThisTurn));const I=L("enemyHoverDetail"),$=V.status,w=[];($.vuln??0)>0&&w.push(`ì·¨ì•½ ${$.vuln}`),($.weak??0)>0&&w.push(`ì•½í™” ${$.weak}`),($.bleed??0)>0&&w.push(`ì¶œí˜ˆ ${$.bleed}`),($.disrupt??0)>0&&w.push(`êµë€ ${$.disrupt}`),V.immuneThisTurn&&w.push("ë©´ì—­");const E=[],_=J.passives;if(_&&_.length)for(const P of _)E.push(`${String(P.icon??"â“…")} ${String(P.name??"íŒ¨ì‹œë¸Œ")}: ${String(P.text??"")}`);I.textContent=e.enemies[U].name+`

`+(E.length?`íŒ¨ì‹œë¸Œ:
${E.join(`
`)}

`:"")+`ì˜ë„: ${ce}

`+(w.length?`ìƒíƒœ: ${w.join(", ")}`:"ìƒíƒœ: ì—†ìŒ"),M.appendChild(re),M.appendChild(ne),M.appendChild(I),W.appendChild(M)}}if(a.appendChild(s),o){const x=L("mobileEnemyLeftBtn");x.appendChild(Ne("ìƒˆ ëŸ°",()=>t.onNewRun())),a.appendChild(x);const N=L("mobileEnemyRightChrome");N.appendChild(Ne("ë£°ë¶",()=>t.onViewRulebook())),N.appendChild(Ne("ë¡œê·¸",()=>t.onToggleLogOverlay())),N.appendChild(Ne("ì„¤ì •",()=>t.onViewSettings())),a.appendChild(N);const W=L("mobileActionPanel"),j=L("mobilePileButtons");j.appendChild(Ne("ë±",()=>t.onViewPile("deck"))),j.appendChild(Ne("ë²„ë¦¼",()=>t.onViewPile("discard"))),j.appendChild(Ne("ì†íŒ¨",()=>t.onViewPile("hand"))),j.appendChild(Ne("ì†Œëª¨",()=>t.onViewPile("exhausted"))),j.appendChild(Ne("ì†Œì‹¤",()=>t.onViewPile("vanished"))),W.appendChild(j);const U=L("mobileRunButtons"),V=be(e),M=V.offered?.[0],B=V.offered?.[1],F=V.offered?.[2],K=M?V.points[M]??0:0,re=B?V.points[B]??0:0,ae=F?V.points[F]??0:0,ne=M&&B&&F?`ì‹ ì•™ ì ìˆ˜ ${K}Â·${re}Â·${ae}`:"ì‹ ì•™ ì ìˆ˜",J=Ne(ne,()=>{if(Ot().classList.contains("show")){En();return}const H=J.getBoundingClientRect();gn(e,H.left+H.width/2,H.top+H.height/2)});J.addEventListener("pointerenter",ce=>{const H=ce;H.pointerType!=="touch"&&gn(e,H.clientX,H.clientY)}),J.addEventListener("pointermove",ce=>{const H=ce;H.pointerType!=="touch"&&Sn(H.clientX,H.clientY)},{passive:!0}),J.addEventListener("pointerleave",ce=>{ce.pointerType!=="touch"&&En()}),U.appendChild(J),W.appendChild(U);const se=L("mobileHudRow");se.appendChild(s),se.appendChild(W),a.appendChild(se)}return a}function Hd(e,t){document.querySelector(".topHudRightChrome")?.remove();const n=L("topHudRight");n.classList.add("topHudRightChrome"),n.style.zIndex="var(--zDevConsole)",n.appendChild(Ne("ë£°ë¶",()=>t.onViewRulebook())),n.appendChild(Ne("ë¡œê·¸",()=>t.onToggleLogOverlay())),n.appendChild(Ne("ì„¤ì •",()=>t.onViewSettings())),document.body.appendChild(n)}function Fd(e,t){return Ge(e,t)}function Wd(e){if(!we(e)||e.selectedEnemyIndex!=null)return null;const t=e.pendingTarget??null,n=t?.sourceCardUid?Fd(e,t.sourceCardUid):null,r=t?.sourceLabel??null,o=t?.reason??null,a=n?`ëŒ€ìƒ ì„ íƒ (${n})`:r?`ëŒ€ìƒ ì„ íƒ (${r})`:"ëŒ€ìƒ ì„ íƒ í•„ìš”",s=o==="FRONT"?"ì „ì—´":o==="BACK"?"í›„ì—´":o==="EVENT"?"ì´ë²¤íŠ¸":o==="RELIC"?"ìœ ë¬¼":null,i=s?` - ${s}`:"",l=e.pendingTargetQueue?.length??0,c=(e.pendingTarget?1:0)+l,d=c>1?` (ë‚¨ì€ ${c}ê°œ)`:" (ë‚¨ì€ 1ê°œ)";return`${a}${i}${d}`}function Ud(e){const t=L("battleTitleRow");t.style.display="flex",t.style.alignItems="center",t.style.gap="calc(12 * var(--u))";const n=document.createElement("h2");n.textContent="",t.appendChild(n);const r=Wd(e),o=Te("targetHintInline","");o.style.cssText="padding:calc(8 * var(--u)) calc(12 * var(--u)); border-radius:calc(12 * var(--u)); border:calc(1 * var(--u)) solid rgba(0,0,0,.55);background: rgb(255, 0, 0);opacity:1;font-weight:700; font-size:calc(16 * var(--u)); line-height:1.25;white-space:nowrap; overflow:hidden; text-overflow:ellipsis;width: min(calc(320 * var(--u)), 92vw);max-width: none;pointer-events:auto;",r?(o.textContent=r,o.style.visibility="visible",o.style.pointerEvents="auto"):(o.textContent="ëŒ€ìƒ ì„ íƒ í•„ìš”",o.style.visibility="hidden",o.style.pointerEvents="none");const a=L("battleTitleRight");a.style.cssText="margin-left:auto;display:flex; align-items:center; gap:calc(10 * var(--u));flex: 0 0 auto;white-space:nowrap;position:relative;";const s=L("resourceRow inline");return s.appendChild(Gn("")),s.appendChild(Gn("")),s.appendChild(Gn("")),a.appendChild(s),o.style.position="absolute",o.style.right="calc(207 * var(--u))",o.style.top="calc(100% - calc(34 * var(--u)))",o.style.marginTop="0",o.style.zIndex="5",o.style.pointerEvents=r?"auto":"none",t.appendChild(o),t.appendChild(a),t}function zd(e){const t=Number(e.run.nextBattleSuppliesBonus??0)||0,n=Number(e.run.gold??0)||0,r=[];if(r.push(`ğŸª™ G ${n}`),t!==0){const o=t>0?`+${t}`:`${t}`;r.push(`ë‹¤ìŒ ì „íˆ¬ ğŸ ${o}`)}return r.join(" | ")}function Kd(e){const t=e.run,n=Number(t.timeMove??0)||0,r=Number(e.time??0)||0,o=n+r,a=[];return a.push(`â³ ì´ ${o}`),a.push(`ğŸƒ ë± ${e.deck?.length??0}`),a.push(`ğŸ’¤ F ${e.player?.fatigue??0}`),a.join(" | ")}function jd(e){const t=document.querySelector(".stageInner");if(!t)return;document.querySelector(".stageCornerHud")?.remove();const n=document.createElement("div");n.className="stageCornerHud";const r=document.createElement("div");r.className="stageCornerHudTop",r.textContent=zd(e);const o=document.createElement("div");o.className="stageCornerHudBottom",o.textContent=Kd(e),n.appendChild(r),n.appendChild(o),document.body.appendChild(n);const a=t.getBoundingClientRect(),l=-56*it(),c=(a.left+a.right)/2;n.style.right="",n.style.left=Le(Math.round(c)),n.style.top=Le(Math.round(a.top+l)),n.style.transform="translateX(-50%)"}function Vd(e,t,n,r){const o=L("combatRoot"),a=L("boardArea"),s=!t.run?.finished&&t.enemies?.length>0&&t.phase!=="NODE";a.classList.toggle("slabOn",s);const i=document.body.classList.contains("mobile")&&document.body.classList.contains("portrait");if(i&&a.appendChild(Ud(t)),i&&t.phase==="NODE"){r.renderNodeSelect(a,t,n),o.appendChild(a),e.appendChild(o);return}const l=L("boardSlotsWrap");l.style.paddingTop="calc(6 * var(--u))";const c={uiSettings:Ac(),cardHoverApi:Qe,hoverSlot:_c(),renderCard:r.renderCard,getCardDefByUid:r.getCardDefByUid,isTargeting:we,beginDrag:Ra};l.appendChild(no(t,n,"front",c)),l.appendChild(no(t,n,"back",c)),a.appendChild(l),o.appendChild(a),e.appendChild(o)}function Gd(e,t,n,r){const o=document.querySelector(".handDock");o&&o.remove(),document.querySelectorAll(".mobileHandScrollBtn").forEach(k=>k.remove());const a=!e.run?.finished&&e.enemies?.length>0&&e.phase!=="NODE";document.querySelector(".combatControls")?.remove();const s=L("handDock"),i=Da(e,t,n,r.overlayOpen);if(a){const k=L("combatControls"),T=document.createElement("button");T.textContent="ë‹¤ìŒ í„´",T.className="stepBtn primary",T.disabled=i.disabled||e.phase==="NODE",T.onclick=()=>t.onAutoAdvance(),k.appendChild(T),document.body.appendChild(k);const C=document.querySelector('.slot[data-slot-side="front"][data-slot-index="1"]')??document.querySelector(".stageInner");if(C){const x=C.getBoundingClientRect(),N=x.left+x.width/2;k.style.left=Le(Math.round(N))}yo(()=>t.onAutoAdvance(),T.disabled)}else yo(null,!0);const l=L("hand");l.style.touchAction="pan-x",l.dataset.dropHand="1";const c=L("handCardsRow");if(l.appendChild(c),(e.hand?.length??0)===0){const k=L("handEmptyHint");k.textContent="",c.appendChild(k)}else for(const k of e.hand)c.appendChild(r.renderCard(e,k,!0,t.onSelectHandCard,{draggable:!0,hoverPreview:{root:document.body,api:Qe,buildDetail:(T,C)=>{const x=r.getCardDefByUid(T,C),N=Ae(T,x.frontText,x.backText,C);return`ì „ì—´: ${N.frontText}
í›„ì—´: ${N.backText}`}}}));if(s.appendChild(l),document.body.appendChild(s),xc(l),!document.body.classList.contains("mobile"))return;const h=()=>{const k=l.querySelector(".card");if(k){const T=l.querySelector(".handCardsRow"),C=T&&parseFloat(getComputedStyle(T).columnGap||"0")||0;return Math.max(24,Math.round(k.getBoundingClientRect().width+C))}return Math.max(48,Math.round(l.clientWidth*.6))},m=k=>{const T=document.createElement("button");return T.type="button",T.className=`mobileHandScrollBtn mobileHandScrollBtn-${k}`,T.textContent=k==="left"?"â—€":"â–¶",T.onclick=C=>{C.preventDefault(),C.stopPropagation();const x=h(),N=k==="left"?-x:x;l.scrollBy({left:N,behavior:"smooth"}),window.setTimeout(y,120)},T},u=m("left"),p=m("right");document.body.appendChild(u),document.body.appendChild(p);const y=()=>{const k=Math.max(0,l.scrollWidth-l.clientWidth);if(k<=1){u.disabled=!0,p.disabled=!0;return}u.disabled=l.scrollLeft<=1,p.disabled=l.scrollLeft>=k-1};l.addEventListener("scroll",y,{passive:!0}),window.setTimeout(y,0)}const Xa=_d(),qd=Ed(),Yd=Md(Xa,Dr);let _o=null,So=0,go=0;function Eo(e,t){const n=e.cards[t];return xe(e.content,n.defId,n.upgrade??0)}function Qa(e,t){return Ge(e,t)}function Wr(){return Cc()}function Rn(e,t,n=!1,r,o){return Cr(Xd(),e,t,n,r,o)}function Xd(){return{div:L,divText:Te,badge:wl,displayNameForUid:es,isTargeting:we,isDraggingNow:Wr,beginDrag:(e,t)=>Ra(e,t),getDragPointerId:()=>wc(),isHoverSuppressed:()=>Pa(),suppressHover:An,isMobile:()=>document.body.classList.contains("mobile"),getPinnedCardUid:()=>hc(),setPinnedCardUid:e=>{mc(e)},clearCardHoverPreview:en}}function Ur(e,t,n){const o=e.content?.cardsById?.[t]?.upgrades,a=Number(n)||0;return!!o&&o.length>a}function Za(e,t,n){const r=Number(n??0)||0,o=xe(e.content,t,r),a=xe(e.content,t,r+1),s=Xe(je(e,o?.frontText??"")),i=Xe(je(e,o?.backText??"")),l=Xe(je(e,a?.frontText??"")),c=Xe(je(e,a?.backText??""));return`í˜„ì¬: ì „ì—´ ${s||"ì—†ìŒ"} / í›„ì—´ ${i||"ì—†ìŒ"}
ê°•í™”: ì „ì—´ ${l||"ì—†ìŒ"} / í›„ì—´ ${c||"ì—†ìŒ"}`}function No(e,t,n){if(!Ur(e,t,n))return;Qe.ensure(document.body);const r=e.content?.cardsById?.[t]?.name??t,o=Number(n)||0,a=o+1,s=`${Ja(e,r,a)} (ê°•í™” ë¯¸ë¦¬ë³´ê¸°)`,i=Za(e,t,o),l=Fn(e,t,a);l.classList.add("isPreviewCard");const c=document.querySelector(".cardHoverPreview");c&&c.classList.remove("previewAtBattlefield"),Qe.show({title:s,detail:i,cardEl:l})}function Ao(e,t,n){if(!Ur(e,t,n))return;Qe.ensure(document.body);const r=e.content?.cardsById?.[t]?.name??t,o=Number(n)||0,a=o+1,s=`${Ja(e,r,a)} (ê°•í™” ë¯¸ë¦¬ë³´ê¸°)`,i=Za(e,t,o),l=Fn(e,t,a);l.classList.add("isPreviewCard");const c=document.querySelector(".cardHoverPreview");c&&c.classList.add("previewAtBattlefield"),Qe.show({title:s,detail:i,cardEl:l})}function Qd(e,t,n,r){if((Number(r??0)||0)!==0||!Ur(t,n,0))return;const a=!!e.closest(".choice-rewardCardRow");e.addEventListener("pointerenter",m=>{m.pointerType==="mouse"&&(Pa()||Wr()||(a?Ao(t,n,0):No(t,n,0)))}),e.addEventListener("pointerleave",m=>{m.pointerType==="mouse"&&Qe.hide()});let s=null,i=0,l=0,c=!1;const d=()=>{s!=null&&(window.clearTimeout(s),s=null)};e.addEventListener("pointerdown",m=>{const u=m;An(250),en(),Qe.hide(),u.pointerType==="touch"&&(c=!1,i=u.clientX,l=u.clientY,d(),s=window.setTimeout(()=>{c=!0,a?Ao(t,n,0):No(t,n,0)},320))},{capture:!0,passive:!0}),e.addEventListener("pointermove",m=>{const u=m;if(u.pointerType!=="touch"||s==null)return;const p=u.clientX-i,y=u.clientY-l;p*p+y*y>144&&d()},{passive:!0});const h=()=>{d(),Qe.hide()};e.addEventListener("pointerup",m=>{m.pointerType==="touch"&&h()},{passive:!0}),e.addEventListener("pointercancel",m=>{m.pointerType==="touch"&&h()},{passive:!0}),e.addEventListener("click",m=>{c&&(c=!1,m.preventDefault(),m.stopPropagation())},!0)}function Zd(e){const t=document.createElement("p");return t.textContent=e,t}function Ja(e,t,n){return tt(e,t,n)}function es(e,t){return Ge(e,t)}function ts(e,t){return qc(e,t,(n,r)=>De(n,r),{getOverlay:()=>Vt(),setOverlay:n=>{Va(n)}})}function $o(){en(),Pn(),document.querySelectorAll(".itemHoverTip").forEach(e=>{e.classList.remove("show"),e.innerHTML=""})}function Jd(e,t,n){const r=e.cards[t];return Fn(e,r.defId,n)}function Mo(e,t,n){const o=Rn(e,t,!!n,n,{draggable:!1});return o.classList.add("overlayCard"),o}function Fn(e,t,n){const r=`__preview:${t}:${n}:${Math.random().toString(36).slice(2)}`,o=e.cards[r];e.cards[r]={uid:r,defId:t,upgrade:n,zone:"preview"};const a=Rn(e,r,!1,void 0,{draggable:!1});return a.classList.add("overlayCard"),a.draggable=!1,a.style.pointerEvents="none",o?e.cards[r]=o:delete e.cards[r],a}function eu(e){const t=(e.placedUidsThisTurn??[]).filter(r=>{const o=e.cards[r];return!!o&&(o.zone==="front"||o.zone==="back")});e.usedThisTurn=t.length;let n=0;for(const r of t)e.cards[r]?.zone==="front"&&(n+=1);e.frontPlacedThisTurn=n}function Po(){const e=document.body;return!!e&&e.classList.contains("mobile")&&e.classList.contains("portrait")}function De(e,t){De._uiScaleInitDone||(De._uiScaleInitDone=!0,Nc(),vr(),window.dispatchEvent(new CustomEvent("deckrogue:uiFit"))),Yc(e),Xc(t),$o(),dc({getG:()=>ot()??e,actions:{onNewRun:()=>t.onNewRun()},rerender:()=>De(ot()??e,t),log:h=>f(ot()??e,h)}),St(),_o=()=>t.onNewRun(),td(()=>_o),nd(()=>ot()),rd(e),De._logInitDone||(De._logInitDone=!0,gl());const n=document.querySelector(".mainPanel");n&&(So=n.scrollTop,go=n.scrollLeft);const r=ad();Qc()||(window.addEventListener("resize",()=>{}),Ec({getG:()=>ot()??e,getActions:()=>To()??t,getOverlay:()=>Vt(),normalizePlacementCounters:eu,cardDisplayNameByUid:Qa,renderAll:h=>De(h,To()??t),clearAllHover:$o,getLastEnter:Bc}),Zc(!0)),r.appendChild(Dd(e,t)),Hd(e,t);const o=L("mainRow"),a=L("stage"),s=L("stageInner"),i=L("panel mainPanel"),l=!e.run.finished&&e.enemies.length>0&&e.phase!=="NODE";i.classList.toggle("inCombat",l),i.scrollTop=So,i.scrollLeft=go;const c={renderCard:Rn,getCardDefByUid:Eo,renderNodeSelect:ko,overlayOpen:!!Vt()};Po()||i.appendChild(nu(e)),e.run.finished?i.appendChild(Zd("ëŸ° ì¢…ë£Œ. ìƒˆë¡œìš´ ëŸ°ì„ ì›í•˜ì‹œë©´ ë²„íŠ¼ì„ ëˆ„ë¥´ê±°ë‚˜ í‚¤ë³´ë“œ Pë¥¼ ì…ë ¥í•˜ì‹­ì‹œì˜¤.")):e.phase==="NODE"&&!Po()?ko(i,e,t):Vd(i,e,t,c),s.appendChild(i),a.appendChild(s);const d=Al(e,{rerender:()=>De(ot()??e,t)});o.appendChild(a),o.appendChild(d),r.appendChild(o),pr(),jd(e),Gd(e,t,we(e),c),fr(),hr(),gc(r,e),md(e,Vt(),{...t,onCloseOverlay:()=>{Va(null),De(ot()??e,t)}},{renderSettingsPanel:(h,m)=>Mc(h),onAfterSettingsChange:()=>{ot()&&(pr(),fr(),hr(),vr()),t.rerender()},renderRealCardForOverlay:Mo,getCardDefByUid:Eo,displayNameForUid:es}),ld(e,t,{renderCard:Rn,renderCardPreviewByDef:Fn,renderCardPreviewByUidWithUpgrade:Jd,renderRealCardForOverlay:Mo,wireUpgradeHoverPreviewForChoice:Qd}),$l(e,{onClose:()=>t.onToggleLogOverlay(),mkButton:mr}),cd(e,{onUseItem:t.onUseItem,onDiscardItem:t.onDiscardItem,overlayOpen:!!Vt()}),dd(e,{onOpenRelicModal:h=>{ud(h),t.rerender()}}),fd(e,{rerender:t.rerender}),Yd.tick(e),od(),gd(Xa,Dr),$d(e,qd,Or),pd(e,{rerender:t.rerender}),Pd(e),vl(),wd(tu(e))}function tu(e){const t=e.player.supplies;return!e.run.finished&&e.enemies.length>0&&e.phase!=="NODE"&&typeof t=="number"?t:null}function nr(e,t=""){const n=document.createElement("span");return n.className="chip"+(t?` ${t}`:""),n.textContent=e,n}function nu(e){const t=L("battleTitleRow");t.style.display="flex",t.style.alignItems="center",t.style.gap="calc(12 * var(--u))";const n=document.createElement("h2");n.textContent="",t.appendChild(n);const r=ru(e),o=Te("targetHintInline","");o.style.cssText="padding:calc(8 * var(--u)) calc(12 * var(--u)); border-radius:calc(12 * var(--u)); border:calc(1 * var(--u)) solid rgba(0,0,0,.55);background: rgb(255, 0, 0);opacity:1;font-weight:700; font-size:calc(16 * var(--u)); line-height:1.25;white-space:nowrap; overflow:hidden; text-overflow:ellipsis;width: min(calc(320 * var(--u)), 92vw);max-width: none;pointer-events:auto;",r?(o.textContent=r,o.style.visibility="visible",o.style.pointerEvents="auto"):(o.textContent="ëŒ€ìƒ ì„ íƒ í•„ìš”",o.style.visibility="hidden",o.style.pointerEvents="none");const a=L("battleTitleRight");a.style.cssText="margin-left:auto;display:flex; align-items:center; gap:calc(10 * var(--u));flex: 0 0 auto;white-space:nowrap;position:relative;";const s=L("resourceRow inline");return s.appendChild(nr("")),s.appendChild(nr("")),s.appendChild(nr("")),a.appendChild(s),o.style.position="absolute",o.style.right="calc(207 * var(--u))",o.style.top="calc(100% - calc(34 * var(--u)))",o.style.marginTop="0",o.style.zIndex="5",o.style.pointerEvents=r?"auto":"none",t.appendChild(o),t.appendChild(a),t}function ru(e){if(!we(e)||e.selectedEnemyIndex!=null)return null;const t=e.pendingTarget??null,n=t?.sourceCardUid?Qa(e,t.sourceCardUid):null,r=t?.sourceLabel??null,o=t?.reason??null,a=n?`ëŒ€ìƒ ì„ íƒ (${n})`:r?`ëŒ€ìƒ ì„ íƒ (${r})`:"ëŒ€ìƒ ì„ íƒ í•„ìš”",s=o==="FRONT"?"ì „ì—´":o==="BACK"?"í›„ì—´":o==="EVENT"?"ì´ë²¤íŠ¸":o==="RELIC"?"ìœ ë¬¼":null,i=s?` - ${s}`:"",l=e.pendingTargetQueue?.length??0,c=(e.pendingTarget?1:0)+l,d=c>1?` (ë‚¨ì€ ${c}ê°œ)`:" (ë‚¨ì€ 1ê°œ)";return`${a}${i}${d}`}const ou=ml();let Mt=ed(ou),Bn=ts(Mt,ns);function ns(e){Mt=e,Bn=ts(Mt,ns),De(Mt,Bn)}function zr(){let e="/deck-rogue-prototype/";if(e&&e!=="/")return e.endsWith("/")||(e+="/"),e;try{const t=new URL(import.meta.url).pathname,n=t.indexOf("/src/");if(n>=0){const r=t.slice(0,n+1);return r.endsWith("/")?r:`${r}/`}}catch{}try{const n=(window.location.pathname||"/").match(/^\/([^/]+)\//);if(n&&n[1]&&n[1]!=="src")return`/${n[1]}/`}catch{}return"/"}function au(){const e=zr(),t=document.documentElement,n=(r,o)=>{t.style.setProperty(r,`url("${e}${o}")`)};n("--cardBgBasic","assets/ui/cards/card_basic.png"),n("--cardBgCommon","assets/ui/cards/card_common.png"),n("--cardBgSpecial","assets/ui/cards/card_special.png"),n("--cardBgRare","assets/ui/cards/card_rare.png"),n("--cardBgMadness","assets/ui/cards/card_madness.png"),n("--cardUrl","assets/ui/cards/card_parchment.png"),n("--bgUrl","assets/ui/background/dungeon_bg.png"),n("--boardUrl","assets/ui/boards/battle_board.png"),n("--mapBgUrl","assets/ui/background/map_bg.png")}function su(){const e=zr(),t=`
@font-face{
  font-family: "Mulmaru";
  src:
    url("${e}assets/fonts/Mulmaru.woff2") format("woff2"),
    url("${e}assets/fonts/Mulmaru.woff") format("woff");
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}
  `.trim();let n=document.getElementById("fontFaces");n||(n=document.createElement("style"),n.id="fontFaces",document.head.appendChild(n)),n.textContent=t}function iu(){let e=0;const t=()=>{e=0;const r=document.querySelector(".handDock");if(!r)return;const o=document.documentElement,a=r.getBoundingClientRect();o.style.setProperty("--handDockTopPx",`${a.top}px`),o.style.setProperty("--handDockRightPx",`${a.right}px`),o.style.setProperty("--handDockBottomPx",`${a.bottom}px`),o.style.setProperty("--handDockLeftPx",`${a.left}px`)},n=r=>{e||(e=requestAnimationFrame(t))};window.addEventListener("deckrogue:layout",n,{passive:!0}),window.addEventListener("resize",n,{passive:!0}),window.visualViewport?.addEventListener("resize",n,{passive:!0}),window.visualViewport?.addEventListener("scroll",n,{passive:!0}),n()}function lu(){let e=0,t=!1;const n=()=>{if(e=0,Wr()){t=!0,window.setTimeout(()=>{t&&r()},120);return}t=!1,De(Mt,Bn)},r=s=>{e||(e=requestAnimationFrame(()=>requestAnimationFrame(n)))},o=()=>{window.dispatchEvent(new CustomEvent("deckrogue:uiFit"))};window.addEventListener("deckrogue:layout",r,{passive:!0}),window.addEventListener("resize",r,{passive:!0}),window.visualViewport?.addEventListener("resize",r,{passive:!0}),window.visualViewport?.addEventListener("scroll",r,{passive:!0}),document.addEventListener("visibilitychange",()=>{document.hidden||r()}),window.addEventListener("focus",()=>{o(),r()},{passive:!0}),new ResizeObserver(()=>r()).observe(document.documentElement),o(),r()}au();su();$a();as();ss();iu();lu();De(Mt,Bn);document.documentElement.style.setProperty("--base",zr());const{vw:wr,vh:Ro}=(()=>{const e=window.visualViewport;return{vw:e?.width??window.innerWidth,vh:e?.height??window.innerHeight}})(),rs=_r(wr),Kr=Ro>=wr*1.08?"portrait":wr>=Ro*1.08?"landscape":"square";document.body.classList.toggle("mobile",rs);document.body.classList.toggle("desktop",!rs);document.body.classList.toggle("portrait",Kr==="portrait");document.body.classList.toggle("landscape",Kr==="landscape");document.body.classList.toggle("square",Kr==="square");
