/* =========================================================
   FINAL CSS — UI SCALE + DESKTOP FOCUSED (mobile later)
   - One :root (tokens)
   - --uiScale is the single effective scale
   - Choice/Event overlay fully CSS-driven (no inline sizing)
   - Removes uiScale^2 traps
   ========================================================= */


/* =========================
   0) ROOT TOKENS (SINGLE SOURCE OF TRUTH)
   ========================= */
:root{
  /* ---------- UI SCALE ---------- */
  --uiScale: 1;
  --uiScaleDesktop: 1;
  --uiScaleMobile: 1;

  /* ---------- Z-LAYERS ---------- */
  --zBg: -10;
  --zStatus: 10;         /* status bar region (background 바로 위) */
  --zMain: 1000;
  --zHandDock: 2000;

  --zChrome: 60000;      /* always-clickable chrome */
  --zChoiceBackdrop: 49000;
  --zChoicePanel: 51000;
  --zChoice: 52000;

  --zRelicHud: 65000;
  --zRelicModal: 70000;

  --zRulebook: 71000;
  --zLogOverlay: 79000;
  --zSettings: 80000;
  --zDevConsole: 100000;

  /* ---------- THEME ---------- */
  --bg0:#060708;
  --bg1:#0b0d10;
  --panel:#0f1216cc;
  --panel2:#0f1216f0;
  --line:#ffffff14;
  --line2:#ffffff1f;
  --text:#e7e9ee;
  --muted:#b7bdc8;

  /* ---------- LAYOUT (scale-aware) ---------- */
  --edgePad: calc(14px * var(--uiScale));
  --logW:   calc(360px * var(--uiScale));
  --logGap: calc(14px * var(--uiScale));

  --hudH:   calc(100px * var(--uiScale));   /* reserved height */
  --dockH:  calc(185px * var(--uiScale));   /* hand dock height */

  --stageMaxW: calc(720px * var(--uiScale));
  --boardAR: 1200/922;

  /* ---------- CARDS + SLOTS ---------- */
  --cardW: calc(122px * var(--uiScale));
  --cardH: calc(var(--cardW) * 7 / 5);
  --handCardW: var(--cardW);
  --handCardH: var(--cardH);

  --boardScale: 1;

  --boardImgZoom: 1.1;
  --boardImgPosY: 36%;             /* 이미지 중심 Y */
  --boardImgShiftY: calc(34px * var(--uiScale)); /* 레이어 전체 이동 */  

  --slotCardW: calc(100px * var(--uiScale) * var(--boardScale));
  --slotCardH: calc(var(--slotCardW) * 7 / 5);
  
  --slotPad: calc(6px * var(--uiScale));
  --slotW: calc(var(--slotCardW) + (var(--slotPad) * 2));
  --slotH: calc(var(--slotCardH) + (var(--slotPad) * 2));
  --slotGap: calc(12px * var(--uiScale) * var(--boardScale));
  --slotRowGap: calc(2px * var(--uiScale));

  --boardPadX: calc(56px * var(--uiScale));
  --boardPadY: calc(34px * var(--uiScale));
  --slotCenterNudgeY: calc(14px * var(--uiScale));

  /* ---------- RADII / SHADOW ---------- */
  --radius: calc(18px * var(--uiScale));
  --selR: calc(8px * var(--uiScale));
  --shadow: 0 calc(18px * var(--uiScale)) calc(60px * var(--uiScale)) rgba(0,0,0,.65);

  /* ---------- HUD PANEL LOOK ---------- */
  --hudPanelBg: rgba(10,12,14,1);
  --hudPanelLine: rgba(255,255,255,.14);
  --hudPanelR: calc(18px * var(--uiScale));

  /* ---------- LOGS ---------- */
  --logLine: rgba(255,255,255,.22);
  --logLineStrong: rgba(255,255,255,.32);
  --logShadow: 0 calc(18px * var(--uiScale)) calc(60px * var(--uiScale)) rgba(0,0,0,.70);
  --logBg: rgba(0,0,0,.75);

  /* ---------- ASSETS ---------- */
  --bgUrl: url("assets/ui/background/dungeon_bg.png");
  --boardUrl: url("assets/ui/boards/battle_board.png");
  --cardUrl: url("assets/ui/cards/card_parchment.png");
  --mapBgUrl: url("assets/ui/background/map_bg.png");
  /* ---------- ENEMY HUD ---------- */
  --enemyBannerW: calc(360px * var(--uiScale));
  --enemyHudDx: 0px;

  /* ---------- DOCK ---------- */
  --dockDrop: calc(12px * var(--uiScale));
  --dockContentDrop: calc(10px * var(--uiScale));

  /* ---------- HP BARS ---------- */
  --hpH: calc(10px * var(--uiScale));
  --hpSeg: calc(6px * var(--uiScale));
  --hpBorder: rgba(0,0,0,.65);
  --hpFrame: rgba(255,255,255,.18);

  /* ---------- STAGE CORNER / HINTS ---------- */
  --hudTop: calc(150px * var(--uiScale));
  --hintGap: calc(20px * var(--uiScale));
  --targetHintTop: calc(56px * var(--uiScale));

  /* ---------- CHOICE OVERLAY ---------- */
  --choicePadTop: calc(180px * var(--uiScale));
  --choicePadR:   calc(36px  * var(--uiScale));
  --choicePadB:   calc(12px  * var(--uiScale));
  --choicePadL:   calc(12px  * var(--uiScale));

  --choicePanelW: calc(760px * var(--uiScale));
  --choicePanelPad: calc(16px * var(--uiScale));
  --choicePanelR: calc(16px * var(--uiScale));

  --choiceRowGap: calc(18px * var(--uiScale));
  --choiceListGap: calc(10px * var(--uiScale));

  --choiceIlluSize: calc(260px * var(--uiScale));
  --choiceIlluMin:  calc(200px * var(--uiScale));

  --choicePanelDx: 0px;
  --choicePanelDy: 40px;

  --choicePanelMarginY: 24px;

  /* ---------- PLAYER HUD POSITION ---------- */
  --playerHudLeftX: calc(var(--edgePad) + calc(30px * var(--uiScale)));
  --playerHudTop:   calc(var(--hudH) + calc(157px * var(--uiScale)));
  --playerHudDropY: calc(196px * var(--uiScale));
  --statusBarGap: calc(10px * var(--uiScale));

  /* ---------- NODE UI ---------- */
  --gap: calc(6px * var(--uiScale));
  --colNow:   calc(70px * var(--uiScale));
  --colArrow: calc(22px  * var(--uiScale));
  --colNext:  calc(70px * var(--uiScale));
  --colSlash: calc(18px  * var(--uiScale));

  /* ---------- RELICS ---------- */
  --relicIconSize: 64px;
  --relicIconGap: 10px;
  --relicImgZoom: 1.3;
  --relicTrayRight: 14px;
  --relicTrayBottom: 170px;

  /* ---------- ENEMY CARDS ---------- */
  --enemyCardW: calc(160px * var(--uiScale));
  --enemyCardH: calc(var(--enemyCardW) * 7 / 5);
  --enemyArtH:  calc(420px * var(--uiScale));
  --enemyHudW: calc(208px * var(--uiScale));
}

/* Optional: font scale */
html{ font-size: calc(16px * var(--uiScale)); }


/* =========================
   1) FONTS
   ========================= */
@font-face{
  font-family: "Mulmaru";
  src: url("fonts/Mulmaru.woff2") format("woff2");
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

html, body, #app, button, input, textarea, select{
  font-family: "Mulmaru", ui-sans-serif, system-ui, -apple-system,
               "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", sans-serif !important;
}

body{
  font-variant-numeric: tabular-nums;
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
}

/* logs use readable sans */
pre.log,
.logPanel pre.log,
.logOverlay pre.log,
pre.log.log{
  font-family: ui-sans-serif, system-ui, -apple-system,
               "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", sans-serif !important;
}


/* =========================
   2) BASE
   ========================= */
html, body{ height:100%; }
body{
  margin:0;
  color:var(--text);
  overflow:hidden;
  background: transparent;
}
#app{
  height:100vh;
  min-height:100vh;
  display:flex;
  flex-direction:column;
  position: relative;
  z-index: var(--zMain);
}

/* safety: avoid white backgrounds */
html, body, #app,
.mainRow, .stage, .stageInner,
.combatRoot, .boardArea{
  background: transparent !important;
}

/* final overflow safety */
.battleTitleRow, .mainPanel, .stage, .stageInner{ overflow: visible !important; }


/* =========================
   3) GLOBAL BACKGROUND
   ========================= */
.bgLayer{
  position: fixed;
  inset: 0;
  background: var(--bgUrl) center / cover no-repeat;
  image-rendering: pixelated;
  z-index: var(--zBg) !important;
  pointer-events:none !important;
}
.bgLayer::after{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  background: radial-gradient(ellipse at center,
    rgba(0,0,0,0.28) 0%,
    rgba(0,0,0,0.38) 55%,
    rgba(0,0,0,0.55) 100%);
}


/* =========================
   4) TOP HUD + PLAYER HUD
   ========================= */
.topHud{
  height: var(--hudH);
  display: grid;
  grid-template-columns: 1fr minmax(0, var(--stageMaxW)) 1fr;
  align-items: start;
  gap: calc(12px * var(--uiScale));
  padding: calc(8px * var(--uiScale)) var(--edgePad) 0 var(--edgePad);
  box-sizing: border-box;
  overflow: visible;
  position: relative;
  z-index: var(--zStatus) !important;
  pointer-events: auto !important; /* ✅ 자식 클릭 살리기 */
}

/* 스테이터스바에서 클릭 통과시키고 싶은 영역만 none */
.topHudLeftSpacer{ pointer-events: none !important; }

/* 클릭되어야 하는 것들은 auto */
.playerHudLeft,
.topHudRight{ pointer-events: auto !important; }

/* right buttons area (always clickable) */
.topHudRight{
  position: fixed !important;
  top: var(--edgePad);
  right: var(--edgePad);
  z-index: var(--zChrome) !important;
  pointer-events: auto !important;
}
.topHudRight *{ pointer-events:auto !important; }

.enemyHud{ display: flex; gap: calc(10px * var(--uiScale)); flex-wrap: wrap; }

/* PLAYER HUD (left fixed) */
.playerHudLeft{
  position: fixed;
  left: var(--playerHudLeftX);
  top:  calc(var(--playerHudTop) + var(--playerHudDropY));
  width: calc(360px * var(--uiScale));
  padding: calc(12px * var(--uiScale));
  background: var(--hudPanelBg);
  border: 1px solid var(--hudPanelLine);
  border-radius: var(--hudPanelR);
  box-shadow: 0 calc(14px * var(--uiScale)) calc(40px * var(--uiScale)) rgba(0,0,0,.40);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  z-index: var(--zChrome) !important;
  pointer-events: auto !important;
}
.playerHudLeft *{ pointer-events:auto !important; }

.playerHudLeft .enemyBadges{
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: calc(4px * var(--uiScale));
  min-height: calc(24px * var(--uiScale));
}

.playerTitleRow{
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: calc(10px * var(--uiScale));
  margin-bottom: calc(10px * var(--uiScale));
}

.playerHudTitle{
  font-weight: 900;
  font-size: calc(16px * var(--uiScale));
  white-space: nowrap;
}

/* 버튼 5개는 오른쪽으로 몰기 */
.pileButtons{
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: calc(1px * var(--uiScale));
  flex-wrap: nowrap;
}


/* =========================
   5) MAIN AREA + STAGE
   ========================= */
.mainRow{
  position: relative;
  flex: 1;
  min-height: 0;
  height: calc(100vh - var(--hudH) - var(--dockH));
  box-sizing: border-box;
  overflow: hidden;
}

.stage{
  height: 100%;
  display:flex;
  justify-content:center;
  align-items:center;
  background: transparent !important;
}

.stageInner{
  width: min(var(--stageMaxW), 100%);
  max-height: 100%;
  aspect-ratio: var(--boardAR);
  display:flex;
  margin: 0 auto;
  box-shadow: none !important;
  filter: none !important;
  overflow: visible !important;
  transform: translateY(calc(60px * var(--uiScale)));
}


/* =========================
   6) MAIN PANEL (board background)
   ========================= */
.mainPanel{
  position: relative;
  width: 100%;
  height: 100%;
  box-sizing: border-box;
  padding: calc(10px * var(--uiScale)) calc(16px * var(--uiScale)) calc(16px * var(--uiScale)) calc(16px * var(--uiScale));
  background: transparent !important;
  border: 0;
  box-shadow: none;
  backdrop-filter: none !important;
  overflow: visible !important;
}

/* board image layer (combat only) */
.mainPanel::before{
  content:"";
  position:absolute;
  inset: 0;
  pointer-events:none;
  opacity: 0;
}
.mainPanel.inCombat::before{
  opacity: 1;
  background: var(--boardUrl) center / cover no-repeat;
  image-rendering: pixelated;
  background-repeat: no-repeat;

  background-size: calc(100% * var(--boardImgZoom)) calc(100% * var(--boardImgZoom));
  background-position: 50% var(--boardImgPosY);
  transform: translateY(calc(-4px * var(--uiScale)));
}

/* actual UI above board */
.mainPanel > *{ position: relative; }


/* =========================
   7) BOARD AREA (slots center)
   ========================= */
.combatRoot,
.boardArea{
  background: transparent !important;
}

.boardArea{
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: var(--slotRowGap);

  padding: calc(10px * var(--uiScale) * var(--boardScale));
  border-radius: calc(18px * var(--uiScale) * var(--boardScale));
  box-sizing: border-box;
  transform: translateY(var(--slotCenterNudgeY));

  padding-top: calc(22px * var(--uiScale));
  padding-bottom: calc(22px * var(--uiScale));
  min-height: 78%;
}
.mainPanel.inCombat .boardArea{ min-height: 86%; }

/* slot rows */
.grid6{
  display: flex;
  justify-content: center;
  align-items: center;
  gap: var(--slotGap);
  width: 100%;
}


/* =========================
   8) SLOTS
   ========================= */
.slot{
  position: relative;
  display: grid;
  place-items: center;
  width: var(--slotW);
  height: var(--slotH);
  border: 0 !important;
  background: transparent !important;
  border-radius: calc(14px * var(--uiScale));
  overflow: hidden;
  --slotTextScale: 0.78;
}

/* 슬롯 안에서 "정중앙"에 놓는 컨테이너 */
.slotCardScaler{
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: auto; /* 슬롯 클릭/드래그 막지 않게 */
}

/* 기준 크기 박스 (여기에 scale만 걸림) */
.slotCardInner{
  width: var(--handCardW);
  height: var(--handCardH);
  transform-origin: 50% 50%;
  transform: scale(var(--slotCardScale, 1));
  pointer-events: auto; /* 카드에 이벤트 필요하면 다시 켜기 */
}

.slot .slotCardInner{
  /* 텍스트는 카드 스케일보다 "조금 더" 줄어들게 */
  --slotTextScale: calc(var(--slotCardScale, 1) * 0.92);
}

.slot .card{
  font-size: calc(14px * var(--uiScale) * var(--slotTextScale));
  line-height: 1.12;
}
/* 이제 내부는 em로만! (px 쓰지 마세요) */
.slot .card .cardTitle{ font-size: 1.00em !important; line-height: 1.05 !important;}
.slot .card .cardMeta,
.slot .card .badge{ font-size: 0.80em; line-height: 1.05; }
.slot .card .cardText{ font-size: 0.8em !important; line-height: 1.15 !important; }

/* 슬롯에서 패딩도 em로 줄여서 더 “쏙” 들어가게 */
.slot .card .cardHeader{ padding: 0.45em 0.55em; }
.slot .card .cardBody{ padding: 0.45em 0.55em; }
.slot .card .cardSection{ padding: 0.40em; }

/* 카드가 기준 박스에 꽉 차도록 */
.slotCardInner > .card{
  width: 100%;
  height: 100%;
}

/* slot recess */
.slot::before{
  content:"";
  position:absolute;
  inset: var(--slotPad);
  border-radius: calc(4px * var(--uiScale));
  pointer-events:none;
  background: rgba(0,0,0,.50);
  box-shadow:
    inset 0 calc(12px * var(--uiScale)) calc(18px * var(--uiScale)) rgba(0,0,0,.65),
    inset 0 calc(-10px * var(--uiScale)) calc(16px * var(--uiScale)) rgba(255,255,255,.06),
    inset 0 0 0 1px rgba(255,255,255,.08);
  opacity: .95;
}
.slot > *{ position: relative;}

/* slot states */
.slot.placeable::before{
  box-shadow:
    inset 0 calc(10px * var(--uiScale)) calc(18px * var(--uiScale)) rgba(0,0,0,.52),
    inset 0 0 0 1px rgba(255,255,255,.16),
    0 0 0 1px rgba(255,255,255,.10);
}
.slot.dropHover::before{
  box-shadow:
    inset 0 calc(10px * var(--uiScale)) calc(18px * var(--uiScale)) rgba(0,0,0,.52),
    inset 0 0 0 1px rgba(255,255,255,.22),
    0 0 0 calc(2px * var(--uiScale)) rgba(255,255,255,.18);
}

/* force card size in slot */
.slot > .card,
.slot .card.inSlot{
  width: var(--slotCardW) !important;
  height: var(--slotCardH) !important;
}

.slot .card.slotNameOnly{
  --slotTextScale: calc(var(--slotCardScale, 1) * 1.25);
}

/* =========================
   9) CARDS (parchment-only)
   ========================= */
.card{
  position: relative;
  width: var(--handCardW);
  height: var(--handCardH);
  padding: calc(10px * var(--uiScale)) calc(10px * var(--uiScale));
  box-sizing: border-box;

  display:flex;
  flex-direction:column;

  background: transparent !important;
  border: 0 !important;
  box-shadow: none !important;
  filter: none !important;
  backdrop-filter: none !important;

  color: rgba(25,18,10,.92) !important;
  text-shadow: none !important;
}

/* parchment layer */
.card::before{
  content:"";
  position:absolute;
  inset:0;
  border-radius: calc(16px * var(--uiScale));
  background: var(--cardUrl) center / 100% 100% no-repeat !important;
  image-rendering: pixelated;
  pointer-events:none;
}
.card::after{ content:none !important; display:none !important; }
.card > *{ position: relative; }

.cardHeader{
  background: transparent !important;
  border: 0 !important;
  box-shadow: none !important;
  margin: 0 0 calc(6px * var(--uiScale)) 0 !important;
  padding: 0 !important;
}

.cardTitle{
  text-align: center !important;
  font-family: "Mulmaru", serif !important;
  font-weight: 400 !important;
  font-size: calc(13px * var(--uiScale)) !important;
  line-height: 1.1 !important;
  letter-spacing: -0.2px !important;
  white-space: nowrap !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
}

.cardBody{
  display:flex !important;
  flex-direction:column !important;
  gap: 0 !important;
  min-height: 0 !important;
  flex: 1 1 auto !important;
  overflow: visible !important;
}

.cardSection{
  flex: 1 1 0 !important;
  min-height: 0 !important;
  background: transparent !important;
  border: 0 !important;
  border-radius: 0 !important;
  box-shadow: none !important;
  padding: 0 !important;
  overflow: hidden !important;
  position: relative;
}

.cardText{
  font-size: calc(11px * var(--uiScale)) !important;
  line-height: 1.25 !important;
  letter-spacing: -0.2px !important;
  margin: 0 !important;
  padding: 0 !important;

  overflow: hidden !important;
  overflow-wrap: anywhere !important;
  word-break: keep-all !important;
}

/* Front/Back separator */
.cardSection.front{
  position: relative;
  padding-bottom: calc(10px * var(--uiScale));
  margin-bottom: calc(8px * var(--uiScale));
}
.cardSection.front::after{
  content:"";
  position:absolute;
  left: calc(10px * var(--uiScale));
  right: calc(10px * var(--uiScale));
  bottom: 0;
  height: 1px;
  background: rgba(90,60,30,.45);
  opacity: .55;
  pointer-events:none;
}

.cardSection.back{
  padding-top: calc(10px * var(--uiScale));
  margin-top: calc(8px * var(--uiScale));
  position: relative;
}

/* Optional double-line feel */
.cardSection.back::after{
  content: "";
  position: absolute;
  left: calc(8px * var(--uiScale));
  right: calc(8px * var(--uiScale));
  top: calc(-17px * var(--uiScale));
  height: 1px;
  background: rgba(110, 70, 35, .55);
  pointer-events: none;
}

/* selection */
.card.selected{
  border-radius: var(--selR) !important;
  outline: none !important;
  box-shadow:
    0 0 0 calc(2px * var(--uiScale)) rgba(255,255,255,.60),
    0 calc(12px * var(--uiScale)) calc(22px * var(--uiScale)) rgba(0,0,0,.35) !important;
  transform: translateY(calc(-2px * var(--uiScale)));
  animation: pickPulse .16s ease-out;
}
.card.selected .cardTitle{
  text-shadow: 0 0 calc(10px * var(--uiScale)) rgba(255,255,255,.28);
}
@keyframes pickPulse{
  0%{ transform: translateY(0); }
  40%{ transform: translateY(calc(-3px * var(--uiScale))); }
  100%{ transform: translateY(0); }
}

/* drag */
.card.isDraggingSource{ opacity: 0.4; filter: saturate(.8); }
.dragLayer .dragCardPreview{
  overflow: hidden;
  border-radius: calc(10px * var(--uiScale));
  background: transparent !important;
  clip-path: inset(0 round calc(16px * var(--uiScale)));
  isolation: isolate;
}
.dragLayer .dragCardPreview *{
  background: transparent !important;
  filter: none !important;
  backdrop-filter: none !important;
  mix-blend-mode: normal !important;
}

/* keyword blocks */
.kwRun, .kwBadge{
  display: inline-flex;
  align-items: baseline;
  gap: calc(2px * var(--uiScale));
  white-space: nowrap;
}
.kwRun *, .kwBadge *{ white-space: nowrap; }


.card.slotNameOnly{
  height: 100%;
  display:flex;
  align-items:center;
  justify-content:center;
  padding: calc(6px * var(--uiScale) * var(--boardScale));
  text-align: center;

  overflow: hidden; /* ✅ 삐져나오는 텍스트/요소 잘라내기 */
  border-radius: calc(16px * var(--uiScale)); /* ✅ 카드 모서리랑 맞추기 */
  clip-path: inset(0 round calc(16px * var(--uiScale))); /* ✅ 더 확실하게 */
}
.card.slotNameOnly .cardTitle{
  font-size: calc(10px * var(--uiScale) * var(--boardScale));
  font-weight: 900 !important;

  width: 100%;                /* ✅ 제목 박스가 카드 폭을 넘지 않게 */
  box-sizing: border-box;
  padding: 0 0.35em;          /* ✅ 좌우 안전 여백 */

  white-space: normal;
  overflow-wrap: anywhere;
  word-break: break-word;
  line-height: 1.1;

  display: -webkit-box;       /* ✅ 너무 길면 2줄에서 컷 */
  -webkit-box-orient: vertical;
  line-clamp: 2;
  -webkit-line-clamp: 2;
  overflow: hidden;
}

.card.slotNameOnly .cardBody{ display:none !important; }


.cardHoverPreview{
  position: fixed;
  right: calc(var(--edgePad) + calc(14px * var(--uiScale)));
  top: calc(var(--hudH) + calc(110px * var(--uiScale)));
  z-index: var(--zChrome);
  width: calc(360px * var(--uiScale));
  height: auto;

  border-radius: calc(18px * var(--uiScale));
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.78);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  box-shadow: 0 calc(18px * var(--uiScale)) calc(60px * var(--uiScale)) rgba(0,0,0,.55);

  padding: calc(14px * var(--uiScale));
  display: none;
  pointer-events: none; /* hover 유지로 꼬이는 거 방지 */
}

.cardHoverPreview.on{ display:block; }

.cardHoverPreviewTitle{
  font-weight: 900;
  font-size: calc(18px * var(--uiScale));
  margin-bottom: calc(10px * var(--uiScale));
  opacity: .95;
}

.cardHoverPreviewRow{
  display: grid;
  grid-template-columns: 1fr;
  gap: calc(12px * var(--uiScale));
  align-items: start;
}

.cardHoverPreviewCard{
  width: calc(220px * var(--uiScale));
  margin: 0 auto;
  transform: translateY(calc(4px * var(--uiScale)));
}

.cardHoverPreviewDetail{
  border-radius: calc(14px * var(--uiScale));
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.03);
  padding: calc(12px * var(--uiScale));
  white-space: pre-wrap;
  line-height: 1.4;
  font-size: calc(13px * var(--uiScale));
}


/* =========================
   10) HAND DOCK
   ========================= */
.handDock{
  position: fixed;
  left: 0;
  right: 0;
  bottom: calc(-3 * var(--dockDrop));
  height: var(--dockH);
  padding: calc(6px * var(--uiScale)) var(--edgePad) calc(10px * var(--uiScale)) var(--edgePad) !important;
  background: linear-gradient(180deg, rgba(0,0,0,0.0), rgba(0,0,0,.85));
  pointer-events: none;
  margin: 0 auto;
  justify-content: center;
  z-index: var(--zHandDock);
}
.handDock * { pointer-events: auto; }

.handDock > .controlsDock,
.handDock > .hand{
  transform: translateY(var(--dockContentDrop));
}

.hand{
  height: calc(var(--handCardH) + calc(12px * var(--uiScale)));
  overflow-x: auto;
  overflow-y: visible;
  -webkit-overflow-scrolling: touch;
}
.handCardsRow{
  display: flex;
  justify-content: center;
  flex-wrap: nowrap;
  gap: calc(10px * var(--uiScale));
  align-items: flex-end;
  width: max-content;
  min-width: 100%;
  padding: calc(6px * var(--uiScale)) calc(12px * var(--uiScale)) 0 calc(12px * var(--uiScale));
  box-sizing: border-box;
  overflow: visible !important;
}


/* =========================
   11) LOG PANEL + OVERLAY
   ========================= */
.logPanel{
  position: fixed;
  top: calc(var(--hudH) + calc(8px * var(--uiScale)));
  right: var(--edgePad);
  width: var(--logW);
  height: min(46vh, calc(420px * var(--uiScale)));
  padding: calc(14px * var(--uiScale));
  display:flex;
  flex-direction:column;
  box-sizing: border-box;
  isolation: isolate;

  background: var(--logBg);
  border: 1px solid var(--logLine);
  box-shadow: var(--logShadow);
  border-radius: calc(18px * var(--uiScale));
}

.logPanel .log{
  flex:1;
  min-height:0;
  margin:0;
  padding: calc(10px * var(--uiScale));
  border-radius: calc(12px * var(--uiScale));
  border:1px solid var(--line);
  background: rgba(0,0,0,.55);
  color: #cfd5e2;
  font-size: calc(12px * var(--uiScale));
  line-height: 1.45;
  overflow:auto;
  white-space: pre-wrap;
}

/* collapsed => button-only */
.logPanel.collapsed{
  width: calc(56px * var(--uiScale));
  height: calc(56px * var(--uiScale));
  padding: calc(10px * var(--uiScale));
  background: transparent !important;
  border: 0 !important;
  box-shadow: none !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}
.logPanel.collapsed .log{ display:none; }
.logPanel.collapsed:hover{ opacity: .85; }
.logPanel.collapsed::before,
.logPanel.collapsed::after{ content:none !important; display:none !important; }

.logPanel.collapsed .logHeaderRow{
  background: rgba(0,0,0,.92) !important;
  border: 1px solid rgba(255,255,255,.22) !important;
  box-shadow: 0 calc(10px * var(--uiScale)) calc(24px * var(--uiScale)) rgba(0,0,0,.55) !important;
}

.logHeaderRow{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: calc(8px * var(--uiScale));
  user-select:none;
  cursor:pointer;
  padding: calc(8px * var(--uiScale)) calc(10px * var(--uiScale));
  border-radius: calc(12px * var(--uiScale));
  border: 1px solid var(--line);
  background: rgba(0,0,0,1);
  margin-bottom: calc(10px * var(--uiScale));
}
.logHeaderRow h2{ margin:0; font-size: calc(14px * var(--uiScale)); }
.logHeaderRow .chev{ opacity:.85; font-size: calc(14px * var(--uiScale)); }

.logOverlay,
.logOverlayLayer{
  position: fixed;
  inset: 0;
  z-index: var(--zLogOverlay) !important;
  pointer-events: auto !important;
}

/* 로그 스크롤바 투명 */
.logScroll{
  scrollbar-width: none;
  scrollbar-color: transparent transparent;
}
.logScroll::-webkit-scrollbar{ width: 0px; height: 0px; }
.logScroll::-webkit-scrollbar-thumb{ background: transparent; }
.logScroll::-webkit-scrollbar-track{ background: transparent; }


/* =========================
   12) NODE PREVIEW
   ========================= */
.nodeIcon{
  display:inline-block;
  width:1.25em;
  text-align:center;
  line-height:1;
  vertical-align:middle;
  font-family:"Mulmaru","Segoe UI Symbol","Noto Sans Symbols 2","Noto Sans Symbols",sans-serif;
  font-variant-emoji:text;
}
.nodeText{ margin-left:.15em; vertical-align:middle; }
.nodeSep{ margin: 0 .25em; opacity: .8; }

.nodePreviewRow{
  display: grid;
  grid-template-columns: var(--colNow) var(--colArrow) var(--colNext) var(--colSlash) var(--colNext);
  column-gap: var(--gap);
  align-items: center;

  padding: calc(10px * var(--uiScale));
  border-radius: calc(14px * var(--uiScale));
  cursor: pointer;
}
.nodeCol{ min-width: 0; }
.nodeSepArrow,
.nodeSepSlash{
  text-align: center;
  opacity: .9;
  user-select: none;
  pointer-events: none;
}


/* =========================
   13) ENEMY HUD CENTER
   ========================= */
.enemyHudCenter{
  position: fixed;
  top: calc(8px * var(--uiScale));
  left: 50%;
  transform: translateX(calc(-50% + var(--enemyHudDx)));

  width: auto;
  max-width: calc(100vw - calc(24px * var(--uiScale)));
  height: auto;

  background: none !important;
  border: 0 !important;
  box-shadow: none !important;
  padding: 0 !important;
  margin: 0 !important;

  z-index: var(--zChrome) !important;
  pointer-events: auto !important;
}
.enemyHudCenter *{ pointer-events: auto !important; }

.enemyHudCenter .enemyHudCenterMover,
.enemyHudCenter .enemyHud,
.enemyHudCenter .enemyStrip{
  display:flex;
  flex-direction: row;
  gap: calc(12px * var(--uiScale));
  align-items: stretch;
  justify-content: center;
  flex-wrap: nowrap;
  background: none !important;
  pointer-events: auto;
}

/* clickable banners */
.enemyHudCenter .enemyChip,
.enemyHudCenter .enemyBanner{
  flex: 0 0 var(--enemyHudW) !important;
  width: var(--enemyHudW) !important;
  max-width: var(--enemyHudW) !important;

  pointer-events: auto !important;
  cursor: pointer;

  border-radius: calc(18px * var(--uiScale));
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.68);
  box-shadow: 0 calc(18px * var(--uiScale)) calc(50px * var(--uiScale)) rgba(0,0,0,.35);
  overflow: hidden;
  box-sizing: border-box;
}

.enemyHudCenter .enemyChipTop,
.enemyHudCenter .enemyIntent{
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.enemyChipTop{
  display: flex;
  flex-direction: row;
  align-items: baseline;
  justify-content: space-between; /* 왼쪽: HP, 오른쪽: 10/10 */
  gap: calc(8px * var(--uiScale));
  white-space: nowrap;            /* ✅ 줄바꿈 금지 */
}

/* =========================
   14) HP PIXEL BARS
   ========================= */
.enemyHPOuter{
  height: var(--hpH) !important;
  border-radius: calc(2px * var(--uiScale)) !important;
  overflow: hidden !important;
  background: rgba(0,0,0,.35) !important;
  border: 1px solid var(--hpBorder) !important;
  box-shadow:
    inset 0 1px 0 var(--hpFrame),
    inset 0 -1px 0 rgba(0,0,0,.55);
  image-rendering: pixelated;
}
.enemyHPFill{
  height: 100% !important;
  border-radius: 0 !important;
  transition: none !important;
  background-image:
    repeating-linear-gradient(
      90deg,
      rgba(255,255,255,.18) 0,
      rgba(255,255,255,.18) 1px,
      rgba(0,0,0,0) 1px,
      rgba(0,0,0,0) var(--hpSeg)
    ),
    linear-gradient(180deg, rgba(255,255,255,.12), rgba(0,0,0,.20));
  background-size: auto 100%, 100% 100%;
  background-blend-mode: overlay;
  background-color: #7f241d !important;
}


/* =========================
   15) FX / MISC HUD
   ========================= */
.combatControls{
  position: fixed;
  bottom: calc(var(--dockH) + calc(-36px * var(--uiScale)));
  transform: translateX(-50%);
  display: flex;
  gap: calc(10px * var(--uiScale));
  z-index: var(--zChrome) !important;
  pointer-events: auto;
}
.combatControls *{ pointer-events: auto !important; }

.combatControls .stepBtn,
.combatControls .clearBtn{
  padding: calc(6px * var(--uiScale)) calc(10px * var(--uiScale));
  border-radius: calc(12px * var(--uiScale));
  font-size: calc(13px * var(--uiScale));
  line-height: 1.1;
}
.combatControls .stepBtn.primary,
.combatControls .clearBtn.primary{ font-weight: 600; }

.phaseBanner{
  position: fixed;
  left: 50%;
  top: calc(64px * var(--uiScale));
  transform: translateX(-50%);
  padding: calc(10px * var(--uiScale)) calc(14px * var(--uiScale));
  border-radius: calc(14px * var(--uiScale));
  border: 1px solid rgba(255,255,255,.18);
  background: rgba(0,0,0,.80);
  color: #fff;
  font-weight: 900;
  letter-spacing: .2px;
  backdrop-filter: blur(6px);
  pointer-events: none;
  animation: phaseInOut 420ms ease both;
}
@keyframes phaseInOut{
  0%   { opacity: 0; transform: translateX(-50%) translateY(calc(-6px * var(--uiScale))); }
  20%  { opacity: 1; }
  70%  { opacity: 1; }
  100% { opacity: 0; transform: translateX(-50%) translateY(calc(-12px * var(--uiScale))); }
}

/* Stage corner HUD */
.stageCornerHud{
  position: fixed;
  pointer-events: none;
  left: var(--playerHudLeftX) !important;
  transform: none !important;

  top: calc((var(--playerHudTop) + var(--playerHudDropY)) - var(--statusBarGap) - calc(34px * var(--uiScale))) !important;

  text-align: left;
  white-space: nowrap;

  padding: calc(6px * var(--uiScale)) calc(10px * var(--uiScale));
  background: rgba(0,0,0,0.9);
  border: 1px solid rgba(255,255,255,.18);
  border-radius: calc(2px * var(--uiScale));
  box-shadow:
    0 2px 0 rgba(0,0,0,.55),
    inset 0 1px 0 rgba(255,255,255,.10),
    inset 0 -1px 0 rgba(0,0,0,.45);

  color: rgba(235,240,255,.96);
  font-size: calc(19px * var(--uiScale));
  line-height: 1.05;
  text-shadow:
    2px 2px 0 rgba(0,0,0,.90),
    -2px 2px 0 rgba(0,0,0,.90),
    2px -2px 0 rgba(0,0,0,.90),
    -2px -2px 0 rgba(0,0,0,.90);
}

/* new run fixed button */
.newRunBtn{
  position: fixed;
  top: calc(8px * var(--uiScale));
  right: calc(8px * var(--uiScale));
  z-index: var(--zChrome) !important;
  pointer-events: auto !important;
}
.newRunBtn *{ pointer-events:auto !important; }

/* target hint near HUD */
.targetHintInline{
  position: fixed;
  left: 50%;
  top: calc(var(--targetHintTop) * var(--uiScale)) !important;
  transform: translateX(-50%);
  pointer-events: none;

  max-width: min(calc(720px * var(--uiScale)), calc(100vw - calc(24px * var(--uiScale))));
  padding: calc(6px * var(--uiScale)) calc(10px * var(--uiScale));
  border-radius: calc(12px * var(--uiScale));

  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.floatFxLayer{
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: var(--zChrome);
}

.floatNum{
  position: absolute;
  transform: translate(-50%, -50%);
  font-weight: 900;
  font-size: calc(18px * var(--uiScale));
  text-shadow: 0 2px 0 rgba(0,0,0,.55), 0 0 12px rgba(0,0,0,.45);
  animation: floatUp 650ms ease-out both;
  will-change: transform, opacity;
}
.floatNum.dmg{  color: #ff6b6b; }
.floatNum.heal{ color: #6bff9e; }
.floatNum.block{ color:#8cc7ff; }

@keyframes floatUp{
  0%   { opacity: 0; transform: translate(-50%, -50%) translateY(8px) scale(.96); }
  15%  { opacity: 1; }
  100% { opacity: 0; transform: translate(-50%, -50%) translateY(-22px) scale(1.05); }
}


/* =========================
   16) SETTINGS / RULEBOOK OVERLAYS
   ========================= */
.overlay-layer{
  position: fixed !important;
  inset: 0 !important;
  z-index: var(--zRulebook) !important;
  pointer-events: auto !important;
}
.overlay-panel{
  z-index: calc(var(--zRulebook) + 1) !important;
  pointer-events: auto !important;
}

.settingsOverlay{
  position: fixed;
  inset: 0;
  z-index: var(--zSettings) !important;

  background: rgba(0,0,0,0.92);
  display: flex;
  justify-content: center;
  align-items: flex-start;
  padding: calc(24px * var(--uiScale));
  box-sizing: border-box;

  pointer-events: auto !important;
}
.settingsOverlay *{ pointer-events:auto !important; }

.settingsPanel{
  width: min(calc(760px * var(--uiScale)), 90%) !important;
  max-width: none !important;
  max-height: none !important;
  overflow: visible;

  border-radius: calc(18px * var(--uiScale));
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(10,12,14,1);
  padding: calc(16px * var(--uiScale));
}


/* =========================
   17) CHOICE / EVENT OVERLAY (KEY FIX)
   ========================= */
.choice-contentRow{
  display:flex;
  gap: var(--choiceRowGap);
  margin-top: calc(12px * var(--uiScale));
  justify-content:center;
  align-items:stretch;
}

.choice-leftCol{
  flex: 1 1 calc(640px * var(--uiScale));
  max-width: calc(720px * var(--uiScale));
  min-width: 0;
}

.choice-illuCol{
  flex: 0 0 var(--choiceIlluSize);
  min-width: var(--choiceIlluMin);
  display:flex;
  align-items:center;
  justify-content:center;
}

.choice-illuBox{
  width: 100%;
  aspect-ratio: 1 / 1;
  border-radius: calc(18px * var(--uiScale));
  border: 1px solid rgba(255,255,255,.16);
  background: rgba(0,0,0,.35);
  overflow: hidden;
  position: relative;
}

.choice-list{
  display:flex;
  flex-direction:column;
  gap: var(--choiceListGap);
}

.choice-item{
  display:flex;
  gap: calc(12px * var(--uiScale));
  align-items:flex-start;
  border:1px solid rgba(255,255,255,.10);
  border-radius: calc(14px * var(--uiScale));
  padding: calc(12px * var(--uiScale));
  background: rgba(255,255,255,.03);
  position:relative;
}

pre.choice-detail,
.choice-panel pre.choice-detail{
  font-family: "Mulmaru", sans-serif !important;
  font-size: calc(13px * var(--uiScale));
  line-height: 1.35;
  letter-spacing: -0.2px;
}

.choice-overlay{
  position: fixed;
  inset: 0;
  z-index: var(--zChoiceBackdrop) !important;
  pointer-events: none !important;

  background: transparent !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;

  display:flex;
  justify-content:center;
  align-items:flex-start;
  box-sizing:border-box;
}

/* kill the backdrop */
.choice-backdrop{
  display: none !important;
  pointer-events: none !important;
  background: transparent !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}

/* panel (modal) */
.choice-panel{
  position: fixed !important;
  z-index: var(--zChoicePanel) !important;
  pointer-events: auto !important;

  display: flex;
  flex-direction: column;


  left: 50% !important;
  top: 50% !important;

  /* ✅ 중심(-50%,-50%)을 잡고, Dx/Dy를 uiScale 한 번만 먹여서 이동 */
  transform:
    translate(-50%, -50%)
    translate(
      calc(var(--choicePanelDx) * var(--uiScale)),
      calc(var(--choicePanelDy) * var(--uiScale))
    ) !important;

  width: min(calc(800px * var(--uiScale)), 96vw);
  max-height: calc(92vh - calc(var(--choicePanelMarginY) * var(--uiScale)) * 2);
  padding: var(--choicePanelPad); /* 원래 패딩 복귀 권장 */
  box-sizing: border-box;
  overflow: auto;
  overflow-x: hidden;
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: var(--choicePanelR);
  background: rgba(0,0,0,1);
  box-shadow: 0 calc(18px * var(--uiScale)) calc(60px * var(--uiScale)) rgba(0,0,0,1);
}

.choice-contentRow{
  flex: 1 1 auto;
  min-height: 0;  /* ✅ overflow 계산에 필수 */
}

/* 왼쪽 컬럼이 세로로 늘 수 있게 */
.choice-leftCol{
  display: flex;
  flex-direction: column;
  flex: 1 1 auto;
  min-height: 0;
}

/* 리스트가 남는 공간을 먹고, 넘치면 리스트만 스크롤 */
.choice-list{
  flex: 1 1 auto;
  min-height: 0;
  overflow: auto;
  padding-right: calc(6px * var(--uiScale)); /* 스크롤바 여유(선택) */
}
/* =========================
   18) RELICS
   ========================= */
.relicTray{
  position: fixed;
  right: var(--relicTrayRight);
  bottom: var(--relicTrayBottom);
  z-index: var(--zRelicHud);
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 8px;
  pointer-events: auto;
}

/* 4열, 3행까지만 보이고 그 이상 스크롤 */
.relicTrayList{
  display: grid;
  grid-template-columns: repeat(4, var(--relicIconSize));
  grid-auto-rows: var(--relicIconSize);
  gap: var(--relicIconGap);

  justify-content: end;
  justify-items: stretch;
  align-items: stretch;

  max-height: calc(var(--relicIconSize) * 3 + var(--relicIconGap) * 2);
  overflow-y: auto;
  overflow-x: hidden;

  max-width: calc(var(--relicIconSize) * 4 + var(--relicIconGap) * 3);
  padding: 8px;

  scrollbar-gutter: stable;
  scroll-snap-type: y mandatory;

  transform: rotate(180deg);
}
.relicTrayList .relicIcon{ transform: rotate(180deg); }

.relicIcon, .relicHoverTip, .relicModalPanel{ direction: ltr; }

.relicTrayList::-webkit-scrollbar{ width: 10px; }
.relicTrayList::-webkit-scrollbar-thumb{
  background: rgba(255,255,255,0.18);
  border-radius: 999px;
}
.relicTrayList::-webkit-scrollbar-track{
  background: rgba(0,0,0,0.18);
  border-radius: 999px;
}

.relicIcon{
  width: var(--relicIconSize);
  height: var(--relicIconSize);
  border-radius: 14px;

  border: 1px solid rgba(255, 255, 255, 0.18);
  background: rgba(0, 0, 0, 0.35);
  color: rgba(255, 255, 255, 0.92);

  display: grid;
  place-items: center;
  cursor: pointer;

  overflow: hidden;
  scroll-snap-align: start;
}
.relicIconImg{
  width: 100%;
  height: 100%;
  display: block;

  object-fit: cover;
  object-position: center;
  transform: scale(var(--relicImgZoom));
  transform-origin: center;

  image-rendering: pixelated;
}

.relicHoverTip{
  display: none;
  min-width: 220px;
  max-width: 360px;
  background: rgba(0, 0, 0, 0.82);
  border: 1px solid rgba(255, 255, 255, 0.12);
  border-radius: 12px;
  padding: 10px 12px;
  color: rgba(255, 255, 255, 0.92);
  box-shadow: 0 18px 40px rgba(0, 0, 0, 0.45);
}
.relicTipTitle{ font-weight: 700; margin-bottom: 6px; }
.relicTipBody{ font-size: 12.5px; line-height: 1.35; white-space: pre-wrap; }

.relicModal{
  position: fixed;
  inset: 0;
  z-index: var(--zRelicModal);
  background: rgba(0, 0, 0, 0.55);
  display: grid;
  place-items: center;
  padding: 18px;
}

.relicModalPanel{
  width: min(720px, 96vw);
  max-height: min(84vh, 900px);
  overflow: auto;
  background: rgba(18, 18, 18, 0.96);
  border: 1px solid rgba(255, 255, 255, 0.14);
  border-radius: 16px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.55);
  transform: translateY(-60px);
}

.relicModalHeader{
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 16px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.10);
}
.relicModalTitle{ font-weight: 800; }

.relicModalBody{
  padding: 16px;
  display: grid;
  grid-template-columns: 160px 1fr;
  gap: 16px;
  align-items: start;
}

.relicModalArt{
  width: 160px;
  height: 160px;
  border-radius: 14px;
  overflow: hidden;
  border: 1px solid rgba(255,255,255,0.12);
  background: rgba(0,0,0,0.28);
}
.relicModalArtImg{
  width: 100%;
  height: 100%;
  background-repeat: no-repeat;
  background-position: center;
  background-size: cover;
  transform: scale(1.15);
  transform-origin: center;
  image-rendering: pixelated;
}
.relicModalArtImg:empty{ background-image: none; }

.relicModalText{
  white-space: pre-wrap;
  line-height: 1.45;
}


/* =========================
   19) ENEMY CARDS
   ========================= */

.enemyBanner.enemyCardWrap{
  position: relative;
  flex: 0 0 auto;
  padding: 0;
  border: none;
  background: transparent;

  display: flex;
  flex-direction: column;
  align-items: center;
  overflow: visible !important;

  --enemyUi: 0.94;
}

.enemyArtWrap{
  position: relative;
  overflow: visible;
  width: calc(var(--enemyCardW)*1);
  --artZoom: 1;
  --framePad: 120;
}

/* 아트 카드(프레임+아트) */
.enemyArtCard{
  position: relative;
  width: calc(100% * var(--enemyUi));
  margin: calc(8px * var(--uiScale)) auto 0;
  aspect-ratio: 5 / 7;
  height: auto;
  flex: 0 0 auto;
  border-radius: 5px;
  overflow: visible;
  background: rgba(0,0,0,.22);
  padding-bottom: 6px; /* 프레임 하단 숨통 */

}
.enemyArtCard::before{
  content:"";
  position:absolute;
  inset:0;
  background-image: var(--artImg);
  background-size: calc(100% * var(--artZoom, 1.0)) auto;
  background-position: 50% 35%;
  background-repeat: no-repeat;
  image-rendering: pixelated;
  opacity: 1;
  z-index: 1;
}
.enemyArtWrap::after{
  content:"";
  position:absolute;
  inset: calc(-1px * var(--framePad));  /* ✅ 프레임이 바깥으로 튀어나오는 정도 */
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  background-image: var(--frameImg);
  background-repeat:no-repeat;
  background-position: 50% 23%;
  background-size: 120% 160%;
  image-rendering: pixelated;

  pointer-events:none;
  z-index: 5;
}

/* 하단 HUD 박스 */
.enemyMiniHud{
  width: 95%;
  padding: calc(7px * var(--uiScale) * var(--enemyUi)) calc(9px * var(--uiScale) * var(--enemyUi));
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(0,0,0,0.7);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  display:flex;
  flex-direction:column;
  gap: calc(5px * var(--uiScale) * var(--enemyUi));
  border-radius: calc(12px * var(--uiScale));
  margin-top: -10px;
  z-index: 10;
}

.enemyIntentTopRow{
  display:flex;
  justify-content: center !important;
  align-items:center;
  gap: 8px;
}

.enemyIntentIcon{
  font-size: calc(20px * var(--uiScale) * var(--enemyUi));
  line-height: 1;
}

.enemyIntentDmg{
  font-size: calc(20px * var(--uiScale) * var(--enemyUi));
  font-weight: 900;
  line-height: 1;
  white-space: nowrap;
}

.enemyIntentLine{
  font-size: calc(11px * var(--uiScale) * var(--enemyUi));
  opacity: .92;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* HP 라인 */
.enemyMiniHud .enemyHpLine{
  display:flex;
  flex-direction: row;
  align-items:center;
  gap: calc(8px * var(--uiScale) * var(--enemyUi));
}
.enemyMiniHud .enemyHpText{
  font-size: calc(15px * var(--uiScale) * var(--enemyUi));
  width: calc(78px * var(--uiScale) * var(--enemyUi));
  flex: 0 0 auto;
  white-space: nowrap;
}
.enemyMiniHud .enemyHPOuter{
  flex: 1 1 auto;
  height: calc(7px * var(--uiScale) * var(--enemyUi));
  border-radius: 999px;
  overflow:hidden;
}
.enemyMiniHud .enemyHPFill{ height: 100%; }

/* 상태 이모지 */
.enemyStatusEmojiRow{
  display:flex;
  flex-wrap: wrap;
  align-items: center;
  font-size: calc(10px * var(--uiScale) * var(--enemyUi));
  gap: calc(3px * var(--uiScale) * var(--enemyUi));
  min-height: calc(16px * var(--uiScale) * var(--enemyUi));
}
.enemyStatusEmojiRow .stEmoji{
  line-height: 1.1;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.04);
  padding: calc(1px * var(--uiScale) * var(--enemyUi)) calc(3px * var(--uiScale) * var(--enemyUi));
  border-radius: calc(7px * var(--uiScale) * var(--enemyUi));
}

/* hover 상세 */
.enemyHoverDetail{
  display:none;
  position:absolute;
  left: 10px; right: 10px;
  bottom: 10px;
  transform: translateY(-6px);
  opacity: 0;
  pointer-events: none;
  white-space: pre-wrap;
  font-size: calc(12px * var(--uiScale));
  line-height: 1.35;
  padding: 10px 12px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.86);
  backdrop-filter: blur(4px);
  z-index: 50;
}

.enemyBanner:hover .enemyHoverDetail{ display:block; }

.enemyBanner.enemyCardWrap .enemyHoverDetail{
  left: -18px;
  right: -18px;

  bottom: -14px;
  transform: translateY(14px);

  font-size: calc(14px * var(--uiScale));
  padding: 14px 16px;
  border-radius: 18px;

  max-height: min(40vh, calc(260px * var(--uiScale)));
  overflow: auto;

  display: none;
  opacity: 0;
  pointer-events: none;

  box-shadow: 0 22px 70px rgba(0,0,0,.60);
}
.enemyBanner.enemyCardWrap:hover .enemyHoverDetail{
  display: block;
  opacity: 1;
  transform: translateY(calc(-30px * var(--uiScale)));
}
.enemyBanner.enemyCardWrap:hover .enemyMiniHud{ opacity: 0.18; }

/* =========================
   20) MAP (2-column, full-viewport)
   ========================= */

:root{
  /* ui scale (already in your project, fallback=1) */
  --S: var(--uiScale, 1);

  /* ---- Panel placement (center + tweak; %는 스케일 영향 X) ---- */
  --mapPanelCX: 50%;
  --mapPanelCY: 50%;
  --mapPanelDX: 0%;
  --mapPanelDY: -30%;

  /* ---- Base sizes (px) : 여기 숫자만 바꾸면 됨 ---- */
  --panelInsetPx: 3;      /* 화면 여백 */
  --panelMaxInsetPx: 60;   /* max-height 계산용(=2*inset 느낌) */
  --panelMaxWidthPx: 650;

  --gridGapPx: 16;
  --sideColWidthPx: 380;

  --boxPadPx: 14;
  --boxRadiusPx: 14;
  --scrollerRadiusPx: 12;

  /* ---- Map content transform ---- */
  --mapSvgScale: 0.70; /* (배율은 숫자라 uiScale과 별개) */
  --mapSvgDX: 0%;
  --mapSvgDY: 0%;

  /* ---- Background image ---- */
  --mapBgDim: 0.25;       /* 어둡게 덮는 정도 */
  --mapBgOpacity: 1;      /* cover 레이어는 opacity 대신 dim으로 조절 추천 */
  --mapHeaderSafeTopPx: 12;
  --mapHeaderSafeSidePx: 14;

  /* ✅ 패널 최대높이(스케일 반영해서 clamp) */
  --mapPanelMaxHPx: 900; /* 필요하면 숫자만 조절 */
  --mapScrollerMinHPx: 520;
  --mapSvgScale: 1.0;

  --pillarPx: 49;
  --pillarW: calc(var(--pillarPx) * 1px * var(--S));

  /* ✅ 지도 창 최소 높이(노드 적어도 높이 유지) */
  --mapScrollerMinHPx: 520;

}


.nodeSelectWrap.mapNodeSelect{
  position: fixed !important;
  inset: auto !important;

  left: calc(var(--mapPanelCX) + var(--mapPanelDX)) !important;
  top:  calc(var(--mapPanelCY) + var(--mapPanelDY)) !important;
  transform: translate(-50%, -40%) !important;

  /* width / max-height : uiScale 적용 */
  width: min(
    calc(var(--panelMaxWidthPx) * 1px * var(--S)),
    calc(100vw - (calc(var(--panelMaxInsetPx) * 1px * var(--S))))
  ) !important;

  max-height: calc(var(--mapPanelMaxHPx) * 1px * var(--S)) !important;

  display: flex !important;
  flex-direction: column !important;
  overflow: hidden !important;

  box-sizing: border-box !important;
  z-index: 52000 !important;

}


.mapNodeSelectBody{
  flex: 1 1 auto;
  min-height: 0;

  display: grid;
  grid-template-columns: minmax(0, 1fr) calc(var(--sideColWidthPx) * 1px * var(--S));
  gap: calc(var(--gridGapPx) * 1px * var(--S));

  margin-top: calc(3px * var(--S));
}

.mapNodeSelectMapCol{
  min-width: 0;
  min-height: 0;
  display: flex;
}

.mapNodeSelectSideCol{
  min-height: 0;
  overflow: auto;

  scrollbar-width: none;
  -ms-overflow-style: none;
}
.mapNodeSelectSideCol::-webkit-scrollbar{ width:0; height:0; }


.mapNodeSelectMapCol .mapMiniBox,
.mapNodeSelect .mapMiniBox{
  flex: 1 1 auto;
  min-height: 0;

  display: flex;
  flex-direction: column;

  padding: calc(var(--boxPadPx) * 1px * var(--S)) !important;
  border-radius: calc(var(--boxRadiusPx) * 1px * var(--S)) !important;
  margin: 0 !important;
}

/* scroller: fill + center */
.mapNodeSelectMapCol .mapMiniScroller,
.mapNodeSelect .mapMiniScroller{
  flex: 1 1 auto;
  min-height: calc(var(--mapScrollerMinHPx) * 1px * var(--S)) !important;
  overflow-x: auto !important;
  overflow-y: hidden !important;
  display: block !important;
  align-items: center !important;
  justify-content: center !important;
  scrollbar-width: none;
  -ms-overflow-style: none;
  border-radius: calc(var(--scrollerRadiusPx) * 1px * var(--S)) !important;

  /* ✅ JS inline background 덮어쓰기 + 배경 이미지 */
  background: var(--mapBgUrl) center/cover no-repeat !important;
}

.mapNodeSelect .mapMiniViewport{
  width: 100%;
  height: 100%;

  overflow-x: auto;
  overflow-y: hidden;

  /* ✅ 기둥 사이만 보이게 */
  clip-path: inset(0 var(--pillarW) 0 var(--pillarW));

  /* (선택) 시작부터 기둥 안쪽에서 보이게 약간 여백 */
  padding-left: var(--pillarW);
  padding-right: var(--pillarW);
  box-sizing: border-box;

  scrollbar-width: none;
  -ms-overflow-style: none;
}
.mapNodeSelect .mapMiniViewport::-webkit-scrollbar{ width:0; height:0; }

.mapNodeSelect .mapMiniViewport svg{
  height: 100% !important;
  width: auto !important;
  max-width: none !important;
  display: block !important;

  transform: none !important; /* “전체 축소” 범인 제거 */
}

.mapNodeSelectMapCol .mapMiniScroller svg,
.mapNodeSelect .mapMiniScroller svg{
  height: 100% !important;
  width: auto !important;      /* ✅ 이게 핵심: 가로는 늘어나게 */
  max-width: none !important;  /* ✅ auto가 다시 눌리지 않게 */
  display: block !important;

  /* 필요하면 약간만(권장: 1.0~1.08) */
  transform: scale(var(--mapSvgScale)) !important;
  transform-origin: top left !important;
}


.mapNodeSelectMapCol .mapMiniScroller svg path,
.mapNodeSelect .mapMiniScroller svg path{
  stroke-width: calc(1px * var(--S)) !important;
  stroke: rgb(255, 255, 255) !important;
}

.mapNodeSelectMapCol .mapMiniScroller svg circle,
.mapNodeSelect .mapMiniScroller svg circle{
  stroke-width: calc(3px * var(--S)) !important;
}

.mapNodeSelectMapCol .mapMiniScroller svg text,
.mapNodeSelect .mapMiniScroller svg text{
  font-size: calc(16px * var(--S)) !important;
  text-anchor: middle !important;
  dominant-baseline: central !important;
}


.mapDetailPanel{
  width: min(
    calc(520px * var(--S)),
    calc(100vw - (calc(64px * var(--S))))
  ) !important;

  max-height: calc(100vh - (calc(64px * var(--S)))) !important;
  overflow-y: auto !important;
  transform: translate(-11%, 0%) !important;
}


.mapNodeSelect .nodeSelectHeader{
  padding:
    calc(14px * var(--S))
    calc(16px * var(--S))
    calc(8px  * var(--S))
    calc(16px * var(--S)) !important;

  /* 혹시라도 내부가 튀어나오면 보이게 */
  padding-top:  calc(6px * var(--S)) !important;
  padding-right:calc(6px * var(--S)) !important;
  overflow: visible !important;
}
/* 버튼 자체도 위/오른쪽 여유(보험) */
.mapNodeSelect .nodeSelectHeaderRight button{
  margin-top: calc(2px * var(--S)) !important;
}
/* =========================
   21) MOBILE (placeholder)
   ========================= */
/* keep empty for now */