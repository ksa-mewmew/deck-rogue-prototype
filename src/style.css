/* =========================================================
   CLEANED CSS (draft)
   - duplicate :root merged
   - conflicting selectors consolidated
   - theme urls unified (--bgUrl, --boardUrl, --cardUrl)
   ========================================================= */

/* =========================
   0) THEME + TOKENS
   ========================= */
:root{
  /* Base colors */
  --bg0:#060708;
  --bg1:#0b0d10;
  --panel:#0f1216cc;
  --panel2:#0f1216f0;
  --line:#ffffff14;
  --line2:#ffffff1f;
  --text:#e7e9ee;
  --muted:#b7bdc8;

  /* Layout */
  --edgePad: 14px;
  --logW: 360px;
  --logGap: 14px;

  --hudH: 100px;      /* top HUD reserved height (desktop) */
  --dockH: 185px;     /* hand dock height */

  --stageMaxW: 800px;
  --boardAR: 1200/922; /* board aspect */

  /* Cards + slots */
  --cardW: 118px;
  --cardH: calc(var(--cardW) * 7 / 5);
  --handCardW: var(--cardW);
  --handCardH: var(--cardH);

  --slotPad: 6px;
  --slotW: calc(var(--cardW) + (var(--slotPad) * 2));
  --slotH: calc(var(--cardH) + (var(--slotPad) * 2));
  --slotXGap: 18px;
  --slotRowGap: 10px;

  --boardPadX: 56px;
  --boardPadY: 34px;
  --slotCenterNudgeY: 20px;

  /* Radii / shadows */
  --radius: 18px;
  --selR: 8px;
  --shadow: 0 18px 60px rgba(0,0,0,.65);

  /* HUD panel look */
  --hudPanelBg: rgba(10,12,14,1);
  --hudPanelLine: rgba(255,255,255,.14);
  --hudPanelR: 18px;

  /* Logs */
  --logLine: rgba(255,255,255,.22);
  --logLineStrong: rgba(255,255,255,.32);
  --logShadow: 0 18px 60px rgba(0,0,0,.70);
  --logBg: rgba(0,0,0,.75); /* (기존에 var(--logBg) 있었는데 정의가 불명확해서 기본값 추가) */

  /* Assets (single source of truth) */
  --bgUrl: url("ui/background/dungeon_bg.png");
  --boardUrl: url("ui/boards/battle_board.png");
  --cardUrl: url("ui/cards/card_parchment.png");

  /* Enemy banner */
  --enemyBannerW: 360px;
  --enemyHudDx: 0px; /* center nudge */

  /* Misc */
  --dockDrop: 10px;
  --dockContentDrop: 10px;
}

/* =========================
   1) FONTS
   ========================= */
@font-face{
  font-family: "Mulmaru";
  src: url("fonts/Mulmaru.woff2") format("woff2");
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

html, body, #app, button, input, textarea, select{
  font-family: "Mulmaru", ui-sans-serif, system-ui, -apple-system,
               "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", sans-serif !important;
}

body{
  font-variant-numeric: tabular-nums;
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
}

/* logs use readable sans */
pre.log,
.logPanel pre.log,
.logOverlay pre.log,
pre.log.log{
  font-family: ui-sans-serif, system-ui, -apple-system,
               "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", sans-serif !important;
}

/* =========================
   2) BASE
   ========================= */
html, body{ height:100%; }
body{
  margin:0;
  color:var(--text);
  overflow:hidden;
  background: transparent;
}
#app{
  height:100vh;
  min-height:100vh;
  display:flex;
  flex-direction:column;
}

/* =========================
   3) GLOBAL BACKGROUND
   ========================= */
.bgLayer{
  position: fixed;
  inset: 0;
  z-index: 0;
  background: var(--bgUrl) center / cover no-repeat;
  image-rendering: pixelated;
}
.bgLayer::after{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  background: radial-gradient(ellipse at center,
    rgba(0,0,0,0.28) 0%,
    rgba(0,0,0,0.38) 55%,
    rgba(0,0,0,0.55) 100%);
}

/* =========================
   4) TOP HUD (desktop)
   ========================= */
.topHud{
  height: var(--hudH);
  display: grid;
  grid-template-columns: 1fr minmax(0, var(--stageMaxW)) 1fr;
  align-items: start;
  gap: 12px;
  padding: 8px var(--edgePad) 0 var(--edgePad);
  box-sizing: border-box;
  overflow: visible;
  position: relative;
  z-index: 30000;
}

.enemyHud{ display: flex; gap: 10px; flex-wrap: wrap; }

/* right buttons area */
.topHudRight{
  grid-column: 3;
  justify-self: end;
  align-self: start;
  display: flex;
  gap: 8px;
  position: relative;
  z-index: 30001;
}

/* =========================
   5) PLAYER HUD (left fixed)
   ========================= */
.playerHudLeft{
  position: fixed;
  left: calc(var(--edgePad) + 30px);
  top: calc(var(--hudH) + 157px);
  width: 360px;
  z-index: 1200;

  padding: 12px;
  background: var(--hudPanelBg);
  border: 1px solid var(--hudPanelLine);
  border-radius: var(--hudPanelR);
  box-shadow: 0 14px 40px rgba(0,0,0,.40);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
}

/* =========================
   6) MAIN AREA + STAGE
   ========================= */
.mainRow{
  position: relative;
  flex: 1;
  min-height: 0;
  height: calc(100vh - var(--hudH) - var(--dockH));

  box-sizing: border-box;
  overflow: hidden;
}

.stage{
  height: 100%;
  display:flex;
  justify-content:center;
  align-items:center;
  background: transparent !important;
}

.stageInner{
  width: min(var(--stageMaxW), 100%);
  max-height: 100%;
  aspect-ratio: var(--boardAR);
  display:flex;
  margin: 0 auto;
  box-shadow: none !important;
  filter: none !important;
  overflow: visible !important;
}

/* =========================
   7) MAIN PANEL (board background)
   ========================= */
.mainPanel{
  position: relative;
  width: 100%;
  height: 100%;
  overflow: hidden;
  box-sizing: border-box;
  padding: 10px 16px 16px 16px;

  background: transparent !important;
  border: 0;
  box-shadow: none;
  backdrop-filter: none !important;
  overflow: visible !important;
}

/* board image layer (combat only) */
.mainPanel::before{
  content:"";
  position:absolute;
  inset: 0;
  pointer-events:none;
  z-index: 0;
  opacity: 0;
}
.mainPanel.inCombat::before{
  opacity: 1;
  background: var(--boardUrl) center / cover no-repeat;
  image-rendering: pixelated;
  background-repeat: no-repeat;

  /* crop/zoom tuning */
  background-size: 110% 110%;
  background-position: 50% 10%;
  transform: translateY(-40px);
  z-index: 1;

  box-shadow: none !important;
  filter: none !important;
}

/* actual UI above board */
.mainPanel > *{
  position: relative;
  z-index: 2;
}

/* =========================
   8) BOARD AREA (slots center)
   ========================= */
.combatRoot,
.boardArea{
  background: transparent !important;
}

.boardArea{
  position: relative;
  z-index: 2;

  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: var(--slotRowGap);

  padding: var(--boardPadY) var(--boardPadX);
  box-sizing: border-box;
  transform: translateY(var(--slotCenterNudgeY));

  /* board occupies more space */
  padding-top: 22px;
  padding-bottom: 22px;
  min-height: 78%;
}

/* combat extra */
.mainPanel.inCombat .boardArea{
  min-height: 86%;
}

/* slabOn mode (if you prefer boardArea background instead of mainPanel::before) */
.boardArea.slabOn{
  background-image: var(--boardUrl);
  background-repeat: no-repeat;
  background-size: 112% 125% !important;
  background-position: 50% 45% !important;
  border-radius: 18px;
}

/* slot rows */
.grid6{
  display: flex;
  justify-content: center;
  align-items: center;
  gap: var(--slotXGap);
  width: 100%;
}

/* =========================
   9) SLOTS
   ========================= */
.slot{
  position: relative;
  display: grid;
  place-items: center;
  width: var(--slotW);
  height: var(--slotH);
  border: 0 !important;
  background: transparent !important;
  border-radius: 14px;
  overflow: hidden;
}

/* slot recess */
.slot::before{
  content:"";
  position:absolute;
  inset: 6px;
  border-radius: 4px;
  pointer-events:none;
  z-index: 0;

  background: rgba(0,0,0,.50);
  box-shadow:
    inset 0 12px 18px rgba(0,0,0,.65),
    inset 0 -10px 16px rgba(255,255,255,.06),
    inset 0 0 0 1px rgba(255,255,255,.08);
  opacity: .95;
}

.slot > *{ position: relative; z-index: 1; }

/* slot states */
.slot.placeable::before{
  box-shadow:
    inset 0 10px 18px rgba(0,0,0,.52),
    inset 0 0 0 1px rgba(255,255,255,.16),
    0 0 0 1px rgba(255,255,255,.10);
}
.slot.dropHover::before{
  box-shadow:
    inset 0 10px 18px rgba(0,0,0,.52),
    inset 0 0 0 1px rgba(255,255,255,.22),
    0 0 0 2px rgba(255,255,255,.18);
}

/* force card size in slot */
.slot > .card,
.slot .card.inSlot{
  width: var(--cardW) !important;
  height: var(--cardH) !important;
}

/* =========================
   10) CARDS (parchment-only)
   ========================= */
.card{
  position: relative;
  width: var(--handCardW);
  height: var(--handCardH);
  padding: 10px 12px;
  box-sizing: border-box;

  display:flex;
  flex-direction:column;

  background: transparent !important;
  border: 0 !important;
  box-shadow: none !important;
  filter: none !important;
  backdrop-filter: none !important;

  color: rgba(25,18,10,.92) !important;
  text-shadow: none !important;
}

/* parchment layer */
.card::before{
  content:"";
  position:absolute;
  inset:0;
  border-radius: 16px;
  background: var(--cardUrl) center / 100% 100% no-repeat !important;
  image-rendering: pixelated;
  pointer-events:none;
  z-index:0;
}
.card::after{
  content:none !important;
  display:none !important;
}
.card > *{ position: relative; z-index: 1; }

.cardHeader{
  background: transparent !important;
  border: 0 !important;
  box-shadow: none !important;
  margin: 0 0 6px 0 !important;
  padding: 0 !important;
}

.cardTitle{
  text-align: center !important;
  font-family: "Mulmaru", serif !important;
  font-weight: 400 !important;
  font-size: 13px !important;
  line-height: 1.1 !important;
  letter-spacing: -0.2px !important;

  white-space: nowrap !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
}

.cardBody{
  display:flex !important;
  flex-direction:column !important;
  gap: 0 !important;
  min-height: 0 !important;
  flex: 1 1 auto !important;
  overflow: visible !important;
}

.cardSection{
  flex: 1 1 0 !important;     /* 50:50 */
  min-height: 0 !important;
  background: transparent !important;
  border: 0 !important;
  border-radius: 0 !important;
  box-shadow: none !important;
  padding: 0 !important;
  overflow: hidden !important;
  position: relative;
}

.cardText{
  font-size: 11px !important;
  line-height: 1.25 !important;
  letter-spacing: -0.2px !important;
  margin: 0 !important;
  padding: 0 !important;

  overflow: hidden !important;
  overflow-wrap: anywhere !important;
  word-break: keep-all !important;
}

/* back section separator */
.cardSection.back{
  padding-top: 14px;
  margin-top: 10px;
}
.cardSection.back::after{
  content: "";
  position: absolute;
  left: 8px; right: 8px;
  top: -17px;
  height: 1px;
  background: rgba(110, 70, 35, .55);
  z-index: 4;
  pointer-events: none;
}

/* selection */
.card.selected{
  border-radius: var(--selR) !important;
  outline: none !important;
  box-shadow:
    0 0 0 2px rgba(255,255,255,.60),
    0 12px 22px rgba(0,0,0,.35) !important;
  transform: translateY(-2px);
  animation: pickPulse .16s ease-out;
}
.card.selected .cardTitle{
  text-shadow: 0 0 10px rgba(255,255,255,.28);
}
@keyframes pickPulse{
  0%{ transform: translateY(0); }
  40%{ transform: translateY(-3px); }
  100%{ transform: translateY(0); }
}

/* drag */
.card.isDraggingSource{ opacity: 0.4; filter: saturate(.8); }
.dragLayer .dragCardPreview{
  overflow: hidden;
  border-radius: 10px;
  background: transparent !important;
  clip-path: inset(0 round 16px);
  isolation: isolate;
}
.dragLayer .dragCardPreview *{
  background: transparent !important;
  filter: none !important;
  backdrop-filter: none !important;
  mix-blend-mode: normal !important;
}

/* keyword blocks (no wrap) */
.kwRun, .kwBadge{
  display: inline-flex;
  align-items: baseline;
  gap: 2px;
  white-space: nowrap;
}
.kwRun *, .kwBadge *{ white-space: nowrap; }

/* =========================
   11) HAND DOCK
   ========================= */
.handDock{
  z-index: 12000 !important;
  position: fixed;
  left: 0;
  right: 0;
  bottom: calc(-1 * var(--dockDrop));
  height: var(--dockH);
  padding: 6px 14px calc(10px + env(safe-area-inset-bottom)) 14px !important;
  background: linear-gradient(180deg, rgba(0,0,0,.00), rgba(0,0,0,.65));
  pointer-events: none;
  margin: 0 auto;          /* ✅ 행 자체를 중앙으로 */
  justify-content: center; /* 유지 */
}
.handDock * { pointer-events: auto; }

.handDock > .controlsDock,
.handDock > .hand{
  transform: translateY(var(--dockContentDrop));
}

.hand{
  height: calc(var(--handCardH) + 12px);
  overflow-x: auto;
  overflow-y: visible;
  -webkit-overflow-scrolling: touch;
}
.handCardsRow{
  display: flex;
  justify-content: center;
  flex-wrap: nowrap;
  gap: 10px;
  align-items: flex-end;
  width: max-content;
  min-width: 100%;
  padding: 6px 12px 0 12px;
  box-sizing: border-box;
  overflow: visible !important;
}

/* =========================
   12) LOG PANEL (desktop)
   ========================= */
.logPanel{
  position: fixed;
  top: calc(var(--hudH) + 8px);
  right: var(--edgePad);
  width: var(--logW);
  height: min(46vh, 420px);
  z-index: 20000;
  padding: 14px;
  display:flex;
  flex-direction:column;
  box-sizing: border-box;

  background: var(--logBg);
  border: 1px solid var(--logLine);
  box-shadow: var(--logShadow);
  border-radius: 18px;
}

.logPanel .log{
  flex:1;
  min-height:0;
  margin:0;
  padding: 10px;
  border-radius: 12px;
  border:1px solid var(--line);
  background: rgba(0,0,0,.55);
  color: #cfd5e2;
  font-size: 12px;
  line-height: 1.45;
  overflow:auto;
  white-space: pre-wrap;
}

/* collapsed => button-only */
.logPanel.collapsed{
  width: 56px;
  height: 56px;
  padding: 10px;
  background: transparent !important;
  border: 0 !important;
  box-shadow: none !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}
.logPanel.collapsed .log{ display:none; }
.logPanel.collapsed:hover{ opacity: .85; }
.logPanel.collapsed::before,
.logPanel.collapsed::after{ content:none !important; display:none !important; }

.logPanel.collapsed .logHeaderRow{
  background: rgba(0,0,0,.92) !important;
  border: 1px solid rgba(255,255,255,.22) !important;
  box-shadow: 0 10px 24px rgba(0,0,0,.55) !important;
}

.logHeaderRow{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 8px;
  user-select:none;
  cursor:pointer;
  padding: 8px 10px;
  border-radius: 12px;
  border: 1px solid var(--line);
  background: rgba(0,0,0,1);
  margin-bottom: 10px;
}
.logHeaderRow h2{ margin:0; font-size: 14px; }
.logHeaderRow .chev{ opacity:.85; font-size: 14px; }

/* =========================
   13) ENEMY HUD CENTER (consolidated)
   ========================= */
.enemyHudCenter{
  position: fixed;
  top: 8px; /* tune */
  left: 50%;
  transform: translateX(calc(-50% + var(--enemyHudDx)));
  z-index: 50000;

  width: auto;
  max-width: calc(100vw - 24px);
  height: auto;

  background: none !important;
  border: 0 !important;
  box-shadow: none !important;
  padding: 0 !important;
  margin: 0 !important;

  pointer-events: none; /* enable only on banners */
}

.enemyHudCenter .enemyHudCenterMover,
.enemyHudCenter .enemyHud,
.enemyHudCenter .enemyStrip{
  display:flex;
  flex-direction: row;
  gap: 12px;
  align-items: stretch;
  justify-content: center;
  flex-wrap: nowrap;
  background: none !important;
  pointer-events: none;
}

/* actual clickable banners */
.enemyHudCenter .enemyChip,
.enemyHudCenter .enemyBanner{
  flex: 0 0 var(--enemyBannerW);
  width: var(--enemyBannerW);
  pointer-events: auto !important;
  cursor: pointer;

  border-radius: 18px;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.68);
  box-shadow: 0 18px 50px rgba(0,0,0,.35);
  overflow: hidden;
  box-sizing: border-box;
}

/* prevent vertical growth by long lines */
.enemyHudCenter .enemyChipTop,
.enemyHudCenter .enemyIntent{
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* enemy banners internal layout (from your later block) */
.enemyRow{
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  width: 100%;
  box-sizing: border-box;
  overflow-x: hidden;
}
.enemyBanner{
  padding: 10px 12px;
  background: rgba(0,0,0,.55);
  border: 1px solid rgba(255,255,255,.12);
  border-radius: 12px;
}
.enemyTop{
  display: flex;
  align-items: center;
  gap: 8px;
  min-width: 0;
}
.enemyName{
  flex: 1 1 auto;
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.enemyHpText{ flex: 0 0 auto; white-space: nowrap; }
.enemySub{
  margin-top: 6px;
  font-size: 12px;
  line-height: 1.3;
  white-space: normal;
  overflow-wrap: anywhere;
}

/* stable height reservations */
.enemyIntent{ min-height: 18px; display:block; }
.enemyBadges{
  min-height: 22px;
  display:flex;
  gap: 6px;
  align-items:center;
  flex-wrap: wrap;
}
.enemyBadges:empty::before{ content:""; display:block; height:22px; }

.mobileStatusLine{
  min-height: 22px;
  display:flex;
  gap: 6px;
  align-items:center;
  flex-wrap: wrap;
}
.mobileStatusLine:empty::before{ content:""; display:block; height:22px; }

/* =========================
   14) PLAYER/ENEMY HP PIXEL BARS
   ========================= */
:root{
  --hpH: 10px;
  --hpSeg: 6px;
  --hpBorder: rgba(0,0,0,.65);
  --hpFrame: rgba(255,255,255,.18);
}
.enemyHPOuter{
  height: var(--hpH) !important;
  border-radius: 2px !important;
  overflow: hidden !important;
  background: rgba(0,0,0,.35) !important;
  border: 1px solid var(--hpBorder) !important;
  box-shadow:
    inset 0 1px 0 var(--hpFrame),
    inset 0 -1px 0 rgba(0,0,0,.55);
  image-rendering: pixelated;
}
.enemyHPFill{
  height: 100% !important;
  border-radius: 0 !important;
  transition: none !important;
  background-image:
    repeating-linear-gradient(
      90deg,
      rgba(255,255,255,.18) 0,
      rgba(255,255,255,.18) 1px,
      rgba(0,0,0,0) 1px,
      rgba(0,0,0,0) var(--hpSeg)
    ),
    linear-gradient(180deg, rgba(255,255,255,.12), rgba(0,0,0,.20));
  background-size: auto 100%, 100% 100%;
  background-blend-mode: overlay;
  background-color: #7f241d !important;
}

/* (NOTE) player block bar targeting via nth-of-type is fragile.
   가능하면 .hpFill--block 같은 클래스로 분리하는 게 안전합니다. */

/* =========================
   15) CONTROLS / BANNERS / FX
   ========================= */
.combatControls{
  position: fixed;
  z-index: 22000;
  bottom: calc(var(--dockH) + -16px);
  transform: translateX(-50%);
  display: flex;
  gap: 10px;
  pointer-events: auto;
}
.combatControls .stepBtn{
  padding: 6px 10px;
  border-radius: 12px;
  font-size: 13px;
  line-height: 1.1;
}
.combatControls .stepBtn.primary{ font-weight: 600; }

.phaseBanner{
  position: fixed;
  left: 50%;
  top: calc(env(safe-area-inset-top, 0px) + 64px);
  transform: translateX(-50%);
  z-index: 26000;
  padding: 10px 14px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,.18);
  background: rgba(0,0,0,.80);
  color: #fff;
  font-weight: 900;
  letter-spacing: .2px;
  backdrop-filter: blur(6px);
  pointer-events: none;
  animation: phaseInOut 420ms ease both;
}
@keyframes phaseInOut{
  0%   { opacity: 0; transform: translateX(-50%) translateY(-6px); }
  20%  { opacity: 1; }
  70%  { opacity: 1; }
  100% { opacity: 0; transform: translateX(-50%) translateY(-12px); }
}

.floatFxLayer{
  position: fixed;
  inset: 0;
  z-index: 26010;
  pointer-events: none !important;
}
.floatNum{
  position: absolute;
  font-weight: 900;
  font-size: 16px;
  text-shadow: 0 2px 0 rgba(0,0,0,.65);
  animation: floatUp 650ms ease-out both;
  white-space: nowrap;
}
.floatNum.dmg{ color: #ff5a5a; }
.floatNum.heal{ color: #73ff8b; }
.floatNum.block{ color: #64b5ff; }
@keyframes floatUp{
  0%   { opacity: 0; transform: translate(-50%, 6px) scale(.96); }
  15%  { opacity: 1; transform: translate(-50%, 0) scale(1); }
  100% { opacity: 0; transform: translate(-50%, -22px) scale(1.02); }
}
.fxFlash{ animation: fxFlash 220ms ease-out; }
@keyframes fxFlash{
  0%   { filter: brightness(1.0); }
  40%  { filter: brightness(1.35); }
  100% { filter: brightness(1.0); }
}

/* Stage corner HUD */
.stageCornerHud{
  position: fixed;
  z-index: 10;
  pointer-events: none;

  transform: none;
  text-align: center;
  white-space: nowrap;

  font-size: 19px;
  line-height: 1.05;

  padding: 6px 10px;
  background: rgba(0,0,0,0.9);
  border: 1px solid rgba(255,255,255,.18);
  border-radius: 2px;
  box-shadow:
    0 2px 0 rgba(0,0,0,.55),
    inset 0 1px 0 rgba(255,255,255,.10),
    inset 0 -1px 0 rgba(0,0,0,.45);

  color: rgba(235,240,255,.96);
  text-shadow:
    2px 2px 0 rgba(0,0,0,.90),
    -2px 2px 0 rgba(0,0,0,.90),
    2px -2px 0 rgba(0,0,0,.90),
    -2px -2px 0 rgba(0,0,0,.90);
}

/* new run fixed button */
.newRunBtn{
  position: fixed;
  top: 8px;
  right: 8px;
  z-index: 99999;
}

/* target hint near HUD */
:root{
  --hudTop: 150px;
  --hudBarH: 60px;
  --hintGap: 0px;
}
.stageCornerHud{
  top: var(--hudTop) !important;
  left: 50% !important;
  transform: translateX(-50%) !important;
}
.targetHintInline{
  position: fixed;
  left: 50%;
  top: calc(var(--hudTop) + var(--hudBarH) + var(--hintGap));
  transform: translateX(-50%);
  z-index: 99998;
  pointer-events: none;

  max-width: min(720px, calc(100vw - 24px));
  padding: 6px 10px;
  border-radius: 12px;

  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* =========================
   16) POINTER EVENTS POLICY (clean)
   ========================= */
/* 기본: topHud는 클릭을 통과. 단, 필요한 영역은 다시 켬 */
.topHud{ pointer-events: none !important; }
.topHudRight, .topHudRight *,
.newRunBtn, .newRunBtn *,
.playerHudLeft, .playerHudLeft *{
  pointer-events: auto !important;
}
/* enemy center is clickable on banners only (already set) */
.enemyHudCenter{ pointer-events: none !important; }
.enemyHudCenter .enemyChip,
.enemyHudCenter .enemyBanner{ pointer-events: auto !important; }

/* overlays (주의: 이건 상황 따라 켜고 끄는 게 안전합니다) */
/* .choice-overlay{ pointer-events: none !important; } */

/* =========================
   17) NODE / OVERLAY (kept, trimmed)
   ========================= */
.nodeCard{
  width: min(720px, 92%);
  margin: 140px auto 0;
  padding: 16px 16px 14px;
  background: transparent !important;
  border: 0 !important;
  box-shadow: none !important;
}
.nodeCardTitle{
  font-size: 22px;
  font-weight: 900;
  text-align: center;
  margin: 0 0 8px;
}
.nodeCardSub{
  opacity: 1;
  font-size: 14px;
  line-height: 1.25;
  margin: 0 0 12px;
  text-align: center;
}
.nodeChoiceRow{
  display:flex;
  gap: 12px;
  justify-content: center;
  margin-top: 12px;
}
.nodeChoiceBtn{
  flex: 0 0 auto;
  width: min(320px, 44vw);
  padding: 14px;
  border-radius: 8px;
  border: 1px solid rgba(255,255,255,1);
  background: rgba(0,0,0,1);
  color: rgba(255,255,255,1);
  cursor: pointer;
  text-align: left;
}
.nodeChoiceBtn:hover{
  background: rgba(255,255,255,1);
  color: rgba(0,0,0,1);
}
.nodeChoiceLabel{ font-weight: 900; font-size: 16px; line-height: 1.1; }
.nodeChoiceHint{ opacity: 1; font-size: 13px; margin-top: 6px; line-height: 1.2; }

.choice-illustSlot{
  width: min(240px, 52vw);
  aspect-ratio: 1 / 1;
  height: auto;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,.18);
  background: rgba(0,0,0,1);
  box-shadow: none;
  image-rendering: pixelated;
  background-position: center;
  background-size: cover;
  background-repeat: no-repeat;
}

/* overlay text */
pre.choice-detail,
.choice-panel pre.choice-detail{
  font-family: "Mulmaru", ui-sans-serif, system-ui, -apple-system,
               "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", sans-serif !important;
  font-size: 13px;
  line-height: 1.35;
  letter-spacing: -0.2px;
}

/* piles */
.pileView, .pileGrid { min-width: 0; }
.pileGrid { overflow-x: hidden; grid-auto-flow: row; }
pre.pileSideDetail,
.pileSideDetail,
pre.overlayItemDetail,
.overlayItemDetail{
  font-family: "Mulmaru", ui-sans-serif, system-ui, -apple-system,
               "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", sans-serif !important;
}

/* =========================
   18) MOBILE (minimal)
   ========================= */
@media (max-width: 900px) and (pointer: coarse){
  :root{
    --edgePad: 10px;
    --dockH: 180px;
    --slotXGap: 10px;
    --slotRowGap: 18px;

    /* smaller slots on mobile */
    --cardW: 108px;
  }

  .topHud{
    height: auto;
    grid-template-columns: 1fr;
  }
  .topHudRight{ display:none !important; }

  .mainRow{
    height: calc(100vh - var(--dockH));
    padding: 0 var(--edgePad) 0 var(--edgePad) !important;
  }

  .stage{ justify-content: stretch; }
  .stageInner{
    width: 100%;
    max-width: 100%;
    aspect-ratio: var(--boardAR);
  }

  .logPanel{
    position: static !important;
    width: 100% !important;
    height: auto !important;
    margin-top: 10px;
  }
  .logPanel .log{ max-height: 28vh; }
}

/* safety: avoid white backgrounds */
html, body, #app,
.mainRow, .stage, .stageInner,
.combatRoot, .boardArea, .handDock{
  background: transparent !important;
}

/* final overflow safety */
.battleTitleRow, .mainPanel, .stage, .stageInner{ overflow: visible !important; }