:root{
  
  --uiScale: 1;
  --uiScaleDesktop: 1;
  --uiScaleMobile: 1;

  
  --safeT: env(safe-area-inset-top, 0);
  --safeR: env(safe-area-inset-right, 0);
  --safeB: env(safe-area-inset-bottom, 0);
  --safeL: env(safe-area-inset-left, 0);

  
  --uBase: min(calc(100vw / 1440), calc(100vh / 900));
  --u: calc(var(--uBase) * var(--uiScale));

  
  --animMul: 1;  

  
  --zBg: -10;
  --zStatus: 10;         
  --zMain: 1000;
  --zHandDock: 2000;

  --zChrome: 60000;      
  
  --zChoiceBackdrop: 60000;
  --zChoicePanel: 62000;
  --zChoice: 63000;

  --zRelicHud: 65000;
  --zRelicModal: 70000;

  --zRulebook: 71000;
  --zLogOverlay: 79000;
  --zSettings: 80000;
  --zDevConsole: 100000;

  --bg0:#060708;
  --bg1:#0b0d10;
  --panel:#0f1216cc;
  --panel2:#0f1216f0;
  --line:#ffffff14;
  --line2:#ffffff1f;
  --text:#e7e9ee;
  --muted:#b7bdc8;

  
  --edgePad: calc(14 * var(--u));
  --logW:   calc(360 * var(--u));
  --logGap: calc(14 * var(--u));

  
  --hudH:  calc(64 * var(--u));
  --dockH: calc(160 * var(--u));

  
  --stageMaxW: calc(760 * var(--u));
  --boardAR: 1200/922;

  
  --cardW: calc(122 * var(--u));
  --cardH: calc(var(--cardW) * 7 / 5);
  --handCardW: var(--cardW);
  --handCardH: var(--cardH);

  --boardScale: 1;

  
  --boardImgZoom: 1.1;
  --boardImgPosY: 32%;
  --boardImgShiftY: calc(34 * var(--u));

  
  --slotCardW: calc(110 * var(--u) * var(--boardScale));
  --slotCardH: calc(var(--slotCardW) * 7 / 5);

  --slotPad: calc(6 * var(--u));
  --slotW: calc(var(--slotCardW) + (var(--slotPad) * 2));
  --slotH: calc(var(--slotCardH) + (var(--slotPad) * 2));
  --slotGap: calc(12 * var(--u) * var(--boardScale));
  --slotRowGap: calc(2 * var(--u));

  --boardPadX: calc(56 * var(--u));
  --boardPadY: calc(34 * var(--u));

  
  --slotCenterNudgeY: calc(50 * var(--u));

  
  --radius: calc(18 * var(--u));
  --selR: calc(8 * var(--u));
  --shadow: 0 calc(18 * var(--u)) calc(60 * var(--u)) rgba(0,0,0,.65);

  
  --hudPanelBg: rgba(10,12,14,1);
  --hudPanelLine: rgba(255,255,255,.14);
  --hudPanelR: calc(18 * var(--u));

  
  --logLine: rgba(255,255,255,.22);
  --logLineStrong: rgba(255,255,255,.32);
  --logShadow: 0 calc(18 * var(--u)) calc(60 * var(--u)) rgba(0,0,0,.70);
  --logBg: rgba(0,0,0,.75);

  
  --bgUrl: none;
  --boardUrl: none;
  --mapBgUrl: none;

  
  --cardBgBasic:   none;
  --cardBgCommon:  none;
  --cardBgSpecial: none;
  --cardBgRare:    none;
  --cardBgMadness: none;

  
  --cardUrl: var(--cardBgCommon, none);

  
  --enemyBannerW: calc(360 * var(--u));
  --enemyHudDx: 0;

  
  --dockDrop:        calc(0 * var(--u));
  --dockContentDrop: calc(0 * var(--u));

  
  --hpH: calc(10 * var(--u));
  --hpSeg: calc(6 * var(--u));
  --hpBorder: rgba(0,0,0,.65);
  --hpFrame: rgba(255,255,255,.18);

  
  --hudTop: calc(150 * var(--u));
  --hintGap: calc(20 * var(--u));
  --targetHintTop: calc(70 * var(--u));

  
  --choicePadTop: calc(180 * var(--u));
  --choicePadR:   calc(36 * var(--u));
  --choicePadB:   calc(12 * var(--u));
  --choicePadL:   calc(12 * var(--u));

  --choicePanelW: calc(760 * var(--u));
  --choicePanelPad: calc(16 * var(--u));
  --choicePanelR: calc(16 * var(--u));

  --choiceRowGap: calc(18 * var(--u));
  --choiceListGap: calc(10 * var(--u));

  --choiceIlluSize: calc(260 * var(--u));
  --choiceIlluMin:  calc(200 * var(--u));

  
  --choicePanelDx: 0;
  --choicePanelDy: 40;
  --choicePanelMarginY: 24;

  
  --playerHudLeftX: calc(var(--safeL) + var(--edgePad));

  
  --trayRaise: calc(-1 * var(--u));
  --playerHudTop:   calc(var(--safeT) + calc(620 * var(--u)));
  --playerHudDropY: 0px;
  --stageCornerLiftY: calc(-1 * var(--trayRaise));

  --statusBarGap: calc(30 * var(--u));

  
  --gap: calc(6 * var(--u));
  --colNow:   calc(70 * var(--u));
  --colArrow: calc(22 * var(--u));
  --colNext:  calc(70 * var(--u));
  --colSlash: calc(18 * var(--u));

  
  --relicImgZoom: 1.3;

  
  --enemyCardW: calc(160 * var(--u));
  --enemyCardH: calc(var(--enemyCardW) * 7 / 5);
  --enemyArtH:  calc(420 * var(--u));
  --enemyHudW: calc(208 * var(--u));

  
  --mapPanelCX: 50%;
  --mapPanelCY: 50%;
  --mapPanelDX: 0%;
  --mapPanelDY: -24%;

  
  --panelInsetPx: 3;
  --panelMaxInsetPx: 60;
  --panelMaxWidthPx: 800;

  --gridGapPx: 16;
  --sideColWidthPx: 380;

  --boxPadPx: 14;
  --boxRadiusPx: 14;
  --scrollerRadiusPx: 12;

  --mapSvgScale: 1.0;
  --mapSvgDX: 0%;
  --mapSvgDY: 0%;

  --mapBgDim: 0;
  --mapBgOpacity: 0;
  --mapHeaderSafeTopPx: 12;
  --mapHeaderSafeSidePx: 14;

  --mapPanelMaxHPx: 900;
  --mapScrollerMinHPx: 520;

  --pillarPx: 90;
  --pillarW: calc(var(--pillarPx) * var(--u));

  
  --shopPanelW:    calc(700 * var(--u));
  --shopSvcW:      calc(240 * var(--u));
  --shopSvcGap:    calc(8 * var(--u));
  --shopItemSize:  calc(76 * var(--u));
  --shopItemIcon:  calc(50 * var(--u));

  
  --toastGap:   calc(8 * var(--u));
  --toastPadY:  calc(8 * var(--u));
  --toastPadX:  calc(12 * var(--u));
  --toastR:     calc(10 * var(--u));
  --toastFont:  calc(25 * var(--u));
  --toastMaxW:  calc(380 * var(--u));

  
  --trayCols: 4;
  --trayRowsMax: 3;

  --traySlot: calc(72 * var(--u));
  --trayGap:  calc(10 * var(--u));
  --trayPad:  calc(10 * var(--u));

  
  --traySidePad: calc(22 * var(--u));
  --trayInwardX: calc(14 * var(--u)); 

  
  --trayBottom: calc(var(--safeB) + calc(10 * var(--u)) + var(--trayRaise));

  
  --itemTrayLeft:   calc(var(--safeL) + var(--traySidePad) + var(--trayInwardX));
  --relicTrayRight: calc(var(--safeR) + var(--traySidePad) + var(--trayInwardX));

  
  --relicIconSize: var(--traySlot);
  --relicIconGap:  var(--trayGap);
  --relicTrayBottom: var(--trayBottom);

  --itemTrayCols:  var(--trayCols);
  --itemTrayGap:   var(--trayGap);
  --itemSlotSize:  var(--traySlot);
  --itemTrayRowsMax: var(--trayRowsMax);

  
  --iconBorder: rgba(255,255,255,.28);
  --iconGlow:   rgba(210,240,255,.18);

  
  --sHudLeft: calc(300 * var(--u));
  --sHudTop:  calc(var(--safeT) + var(--hudH) + calc(330 * var(--u)));
  --sHudOffX: calc(0 * var(--u));
  --sHudOffY: calc(140 * var(--u));

  --sHudFont: clamp(calc(24 * var(--u)), 4vw, calc(36 * var(--u)));
  --sHudPadY: calc(10 * var(--u));
  --sHudPadX: calc(14 * var(--u));
  --sHudR:    calc(12 * var(--u));

  
  --combatCtrlLift: calc(10 * var(--u));

  
  --toastCX: 50%;
  --toastCY: 50%;
  --toastDx: 0; 
  --toastDy: -270; 
}



html{ font-size: calc(16 * var(--u)); }



html, body, #app, button, input, textarea, select, .choice-panel{
  font-family: "Mulmaru", ui-sans-serif, system-ui, -apple-system,
               "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", sans-serif !important;
}

body{
  font-variant-numeric: tabular-nums;
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
}


pre.log,
.logPanel pre.log,
.logOverlay pre.log,
pre.log.log{
  font-family: ui-sans-serif, system-ui, -apple-system,
               "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", sans-serif !important;
}



html, body{ height:100%; }

body{
  margin:0;
  color:var(--text);
  overflow:hidden;
  background: transparent;
}

#app{
  height:100vh;
  min-height:100vh;
  display:flex;
  flex-direction:column;
  position: relative;
  z-index: var(--zMain);
  pointer-events: none;
}


html, body, #app,
.mainRow, .stage, .stageInner,
.combatRoot, .boardArea{
  background: transparent !important;
}


.battleTitleRow, .mainPanel, .stage, .stageInner{ overflow: visible !important; }



.bgLayer{
  position: fixed;
  inset: 0;
  background-image: var(--bgUrl);
  background-position: center;
  background-size: cover;
  background-repeat: no-repeat;
  background-color: #000;  image-rendering: pixelated;
  z-index: var(--zBg) !important;
  pointer-events:none !important;
}

.bgLayer::after{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  background: radial-gradient(ellipse at center,
    rgba(0,0,0,0.28) 0%,
    rgba(0,0,0,0.38) 55%,
    rgba(0,0,0,0.55) 100%);
}



.topHud{
  height: var(--hudH);
  display: grid;
  grid-template-columns: 1fr minmax(0, var(--stageMaxW)) 1fr;
  align-items: start;
  gap: calc(10 * var(--u));
  padding: calc(6 * var(--u)) var(--edgePad) 0 var(--edgePad);
  box-sizing: border-box;
  overflow: visible;
  position: relative;
  z-index: var(--zChrome);
  pointer-events: none !important; 
}

.topHudLeftSpacer{ pointer-events: none !important; }
.playerHudLeft, .topHudRight{ pointer-events: auto; }


.topHudRight{
  position: fixed;
  top:   calc(var(--safeT) + calc(8 * var(--u)));
  right: calc(var(--safeR) + calc(10 * var(--u)));
  z-index: calc(var(--zChrome)+20000);
  pointer-events: auto;
}
.topHudRight *{ pointer-events:auto; }

.enemyHud{ display: flex; gap: calc(10 * var(--u)); flex-wrap: wrap; }


.playerHudLeft{
  position: fixed;
  left: var(--playerHudLeftX);
  top:  calc(var(--playerHudTop) + var(--playerHudDropY));
  width: min(calc(420 * var(--u)), calc(100vw - (var(--edgePad) * 2)));
  padding: calc(14 * var(--u));
  background: var(--hudPanelBg);
  border: calc(1 * var(--u)) solid var(--hudPanelLine);
  border-radius: var(--hudPanelR);
  box-shadow: 0 calc(14 * var(--u)) calc(40 * var(--u)) rgba(0,0,0,.40);
  backdrop-filter: blur(calc(6 * var(--u)));
  -webkit-backdrop-filter: blur(calc(6 * var(--u)));
  z-index: var(--zChrome);
  pointer-events: auto;
}
.playerHudTitle{ font-size: calc(19 * var(--u)); font-weight: 900; }
.playerHudLeft *{ pointer-events:auto !important; }

.playerHudLeft .enemyBadges{
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: calc(4 * var(--u));
  min-height: calc(24 * var(--u));
}

.playerTitleRow{
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: calc(10 * var(--u));
  margin-bottom: calc(10 * var(--u));
}


.pileButtons{
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: calc(1 * var(--u));
  flex-wrap: nowrap;
}



.mainRow{
  position: relative;
  flex: 1;
  min-height: 0;
  box-sizing: border-box;
  overflow: hidden;
  padding-bottom: calc(var(--dockH) + calc(6 * var(--u)));
  pointer-events: auto;
}

.stage{
  height: 100%;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  padding-top: calc(0 * var(--u));
  background: transparent;
}

.stageInner{
  width: min(var(--stageMaxW), 100%);
  max-height: 100%;
  aspect-ratio: var(--boardAR);
  display:flex;
  margin: 0 auto;
  overflow: visible;
  transform: translateY(0);
}



.mainPanel{
  position: relative;
  width: 100%;
  height: 100%;
  box-sizing: border-box;
  padding: calc(210 * var(--u)) calc(12 * var(--u)) calc(12 * var(--u)) calc(12 * var(--u));
  background: transparent;
  overflow: visible;
}


.mainPanel::before{
  content:"";
  position:absolute;
  inset: 0;
  pointer-events:none;
  opacity: 0;
}

.mainPanel.inCombat::before{
  opacity: 1;
  background: var(--boardUrl) center / cover no-repeat;
  image-rendering: pixelated;
  background-size: calc(100% * var(--boardImgZoom)) calc(100% * var(--boardImgZoom));
  background-position: 50% var(--boardImgPosY);
  transform: translateY(calc(210 * var(--u)));
}


.mainPanel > *{ position: relative; }



.combatRoot,
.boardArea{
  background: transparent !important;
}

.boardArea{
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: var(--slotRowGap);

  padding: calc(10 * var(--u));
  box-sizing: border-box;

  transform: translateY(var(--slotCenterNudgeY));
  min-height: 82%;
}


.mainPanel.inCombat .boardArea{ min-height: 86%; }


.grid6{
  display: flex;
  justify-content: center;
  align-items: center;
  gap: var(--slotGap);
  width: 100%;
}



.slot{
  position: relative;
  display: grid;
  place-items: center;
  width: var(--slotW);
  height: var(--slotH);
  border: 0 !important;
  background: transparent !important;
  border-radius: 0;
  overflow: hidden;
  --slotTextScale: 0.78;
}


.slot.locked{
  opacity: 0.38;
}
.slot .slotLock{
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: calc(26 * var(--u));
  pointer-events: none;
  text-shadow: 0 2px 6px rgba(0,0,0,0.55);
}



.slotCardScaler{
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: auto;
}


.slotCardInner{
  width: var(--handCardW);
  height: var(--handCardH);
  transform-origin: 50% 50%;
  transform: scale(var(--slotCardScale, 1));
  pointer-events: auto;
}


.slot .slotCardInner{
  --slotTextScale: calc(var(--slotCardScale, 1) * 0.92);
}

.slot .card{
  font-size: calc(14 * var(--u) * var(--slotTextScale));
  line-height: 1.12;
}


.slot .card .cardTitle{ font-size: 1.00em !important; line-height: 1.05 !important;}
.slot .card .cardMeta,
.slot .card .badge{ font-size: 0.80em; line-height: 1.05; }
.slot .card .cardText{ font-size: 0.8em !important; line-height: 1.15 !important; }


.slot .card .cardHeader{ padding: 0.45em 0.55em; }
.slot .card .cardBody{ padding: 0.45em 0.55em; }
.slot .card .cardSection{ padding: 0.40em; }


.slotCardInner > .card{
  width: 100%;
  height: 100%;
}


.slot::before{
  content:"";
  position:absolute;
  inset: var(--slotPad);
  border-radius: 0;
  pointer-events:none;
  background: rgba(0,0,0,.50);
  box-shadow:
    inset 0 calc(12 * var(--u)) calc(18 * var(--u)) rgba(0,0,0,.65),
    inset 0 calc(-10 * var(--u)) calc(16 * var(--u)) rgba(255,255,255,.06),
    inset 0 0 0 calc(1 * var(--u)) rgba(255,255,255,.08);
  opacity: .8;
}
.slot > *{ position: relative;}

.slot.installed::before{
  opacity: 1;
  box-shadow:
    inset 0 calc(12 * var(--u)) calc(18 * var(--u)) rgba(0,0,0,.65),
    inset 0 calc(-10 * var(--u)) calc(16 * var(--u)) rgba(255,255,255,.06),
    inset 0 0 0 calc(1 * var(--u)) rgba(255,255,255,.08),
    inset 0 0 0 calc(3 * var(--u)) rgba(255, 70, 70, .40),
    0 0 0 calc(3 * var(--u)) rgba(255, 60, 60, .50),
    0 0 calc(26 * var(--u)) rgba(255, 50, 50, .45),
    inset 0 0 calc(22 * var(--u)) rgba(255, 90, 90, .18);
  animation: installedPulse 1.45s ease-in-out infinite;
}


.slot.placeable::before{
  box-shadow:
    inset 0 calc(10 * var(--u)) calc(18 * var(--u)) rgba(0,0,0,.52),
    inset 0 0 0 calc(1 * var(--u)) rgba(255,255,255,.16),
    0 0 0 calc(1 * var(--u)) rgba(255,255,255,.10);
}

.slot.installed.placeable::before{
  opacity: 1;
  box-shadow:
    inset 0 calc(10 * var(--u)) calc(18 * var(--u)) rgba(0,0,0,.52),
    inset 0 0 0 calc(1 * var(--u)) rgba(255,255,255,.16),
    0 0 0 calc(1 * var(--u)) rgba(255,255,255,.10),
    inset 0 0 0 calc(3 * var(--u)) rgba(255, 70, 70, .40),
    0 0 0 calc(3 * var(--u)) rgba(255, 60, 60, .50),
    0 0 calc(26 * var(--u)) rgba(255, 50, 50, .45),
    inset 0 0 calc(22 * var(--u)) rgba(255, 90, 90, .18);
  animation: installedPulse 1.45s ease-in-out infinite;
}

.slot.installed.dropHover::before{
  opacity: 1;
  box-shadow:
    inset 0 calc(10 * var(--u)) calc(18 * var(--u)) rgba(0,0,0,.52),
    inset 0 0 0 calc(1 * var(--u)) rgba(255,255,255,.22),
    0 0 0 calc(2 * var(--u)) rgba(255,255,255,.18),
    inset 0 0 0 calc(3 * var(--u)) rgba(255, 70, 70, .50),
    0 0 0 calc(3 * var(--u)) rgba(255, 70, 70, .60),
    0 0 calc(30 * var(--u)) rgba(255, 60, 60, .55),
    inset 0 0 calc(24 * var(--u)) rgba(255, 110, 110, .22);
  animation: installedPulse 1.45s ease-in-out infinite;
}

@keyframes installedPulse{
  0%{ filter: saturate(1) brightness(1); }
  50%{ filter: saturate(1.3) brightness(1.12); }
  100%{ filter: saturate(1) brightness(1); }
}

@media (prefers-reduced-motion: reduce){
  .slot.installed::before,
  .slot.installed.placeable::before,
  .slot.installed.dropHover::before{ animation: none; }
}
.slot.dropHover::before{
  box-shadow:
    inset 0 calc(10 * var(--u)) calc(18 * var(--u)) rgba(0,0,0,.52),
    inset 0 0 0 calc(1 * var(--u)) rgba(255,255,255,.22),
    0 0 0 calc(2 * var(--u)) rgba(255,255,255,.18);
}


.slot > .card,
.slot .card.inSlot{
  width: var(--slotCardW) !important;
  height: var(--slotCardH) !important;
}

.slot .card.slotNameOnly{
  --slotTextScale: calc(var(--slotCardScale, 1) * 1.25);
}


.slot.disabled{
  cursor: not-allowed;
}


.slot.disabled::before{
  background: rgba(40, 0, 60, .55);
  box-shadow:
    inset 0 calc(12 * var(--u)) calc(18 * var(--u)) rgba(0,0,0,.70),
    inset 0 calc(-10 * var(--u)) calc(16 * var(--u)) rgba(255,255,255,.05),
    inset 0 0 0 calc(1 * var(--u)) rgba(200,140,255,.14);
  opacity: .95;
}


.slot.disabled::after{
  content: "ðŸŒ€";
  position: absolute;
  inset: var(--slotPad);
  pointer-events: none;

  display: flex;
  justify-content: flex-end;
  align-items: flex-start;
  padding: calc(6 * var(--u));

  font-size: calc(20 * var(--u));
  line-height: 1;

  color: rgba(235, 230, 255, .90);
  text-shadow: 0 0 calc(10 * var(--u)) rgba(170, 90, 255, .35);

  
  background: repeating-linear-gradient(
    135deg,
    rgba(255,255,255,.08) 0,
    rgba(255,255,255,.08) calc(6 * var(--u)),
    rgba(0,0,0,0) calc(6 * var(--u)),
    rgba(0,0,0,0) calc(12 * var(--u))
  );
  opacity: .85;
}


.slot.disabled .slotCardInner{
  opacity: .82;
}


.card{
  --cardInnerMul: 1;
  position: relative;
  width: var(--handCardW);
  height: var(--handCardH);
  padding: calc(10 * var(--u) * var(--cardInnerMul)) calc(10 * var(--u) * var(--cardInnerMul));
  box-sizing: border-box;

  display:flex;
  flex-direction:column;

  background: transparent !important;
  border: 0 !important;
  box-shadow: none !important;
  filter: none !important;
  -webkit-backdrop-filter: none !important;
  backdrop-filter: none !important;

  color: rgba(25,18,10,.92) !important;
  text-shadow: none !important;
}


.card::before{
  content:"";
  position:absolute;
  inset:0;
  border-radius: 0;
  background: var(--cardUrl) center / 100% 100% no-repeat !important;
  image-rendering: pixelated;
  pointer-events:none;
}
.card::after{ content:none !important; display:none !important; }
.card > *{ position: relative; }


.card.rarity-basic{ --cardUrl: var(--cardBgBasic); }
.card.rarity-common{ --cardUrl: var(--cardBgCommon); }
.card.rarity-special{ --cardUrl: var(--cardBgSpecial); }
.card.rarity-rare{ --cardUrl: var(--cardBgRare); }
.card.rarity-madness{ --cardUrl: var(--cardBgMadness); }

.cardHeader{
  background: transparent !important;
  border: 0 !important;
  box-shadow: none !important;
  margin: 0 0 calc(6 * var(--u) * var(--cardInnerMul)) 0 !important;
  padding: 0 !important;
}

.cardTitle{
  text-align: center !important;
  font-family: "Mulmaru", serif !important;
  font-weight: 400 !important;
  font-size: calc(13 * var(--u) * var(--cardInnerMul)) !important;
  line-height: 1.1 !important;
  letter-spacing: -calc(0.2 * var(--u) * var(--cardInnerMul)) !important;
  white-space: nowrap !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
}

.cardBody{
  display:flex !important;
  flex-direction:column !important;
  gap: 0 !important;
  min-height: 0 !important;
  flex: 1 1 auto !important;
  overflow: visible !important;
}

.cardSection{
  flex: 1 1 0 !important;
  min-height: 0 !important;
  background: transparent !important;
  border: 0 !important;
  border-radius: 0 !important;
  box-shadow: none !important;
  padding: 0 !important;
  overflow: hidden !important;
  position: relative;
}

.cardText{
  font-size: calc(11 * var(--u) * var(--cardInnerMul)) !important;
  line-height: 1.25 !important;
  letter-spacing: -calc(0.2 * var(--u) * var(--cardInnerMul)) !important;
  margin: 0 !important;
  padding: 0 !important;

  overflow: hidden !important;
  overflow-wrap: anywhere !important;
  word-break: keep-all !important;
}


.card.rarity-madness,
.card.rarity-madness *{
  color: #fff !important;
}


.cardSection.front{
  position: relative;
  padding-bottom: calc(10 * var(--u) * var(--cardInnerMul));
  margin-bottom: calc(8 * var(--u) * var(--cardInnerMul));
}
.cardSection.front::after{
  content:"";
  position:absolute;
  left: calc(10 * var(--u) * var(--cardInnerMul));
  right: calc(10 * var(--u) * var(--cardInnerMul));
  bottom: 0;
  height: calc(1 * var(--u));
  background: rgba(90,60,30,.45);
  opacity: .55;
  pointer-events:none;
}

.cardSection.back{
  padding-top: calc(10 * var(--u) * var(--cardInnerMul));
  margin-top: calc(8 * var(--u) * var(--cardInnerMul));
  position: relative;
}


.cardSection.back::after{
  content: "";
  position: absolute;
  left: calc(8 * var(--u) * var(--cardInnerMul));
  right: calc(8 * var(--u) * var(--cardInnerMul));
  top: calc(-17 * var(--u) * var(--cardInnerMul));
  height: calc(1 * var(--u));
  background: rgba(110, 70, 35, .55);
  pointer-events: none;
}


.card.selected{
  border-radius: 0 !important;
  outline: none !important;
  box-shadow:
    0 0 0 calc(2 * var(--u)) rgba(255,255,255,.60),
    0 calc(12 * var(--u)) calc(22 * var(--u)) rgba(0,0,0,.35) !important;
  transform: translateY(calc(-2 * var(--u)));
  animation-name: pickPulse;
  animation-duration: calc(160ms * var(--animMul));
  animation-timing-function: ease-out;
  animation-fill-mode: both;
}
.card.selected .cardTitle{
  text-shadow: 0 0 calc(10 * var(--u)) rgba(255,255,255,.28);
}
@keyframes pickPulse{
  0%{ transform: translateY(0); }
  40%{ transform: translateY(calc(-3 * var(--u))); }
  100%{ transform: translateY(0); }
}


.card.isDraggingSource{ opacity: 0.4; filter: saturate(.8); }


.dragLayer .dragCardPreview{
  overflow: hidden;
  border-radius: 0;
  background: transparent !important;
  clip-path: inset(0);
  isolation: isolate;
}
.dragLayer .dragCardPreview *{
  filter: none !important;
  mix-blend-mode: normal !important;
}


.kwRun, .kwBadge{
  display: inline-flex;
  align-items: baseline;
  gap: calc(2 * var(--u));
  white-space: nowrap;
}
.kwRun *, .kwBadge *{ white-space: nowrap; }


.card.slotNameOnly{
  height: 100%;
  display:flex;
  align-items:center;
  justify-content:center;
  padding: calc(6 * var(--u) * var(--boardScale));
  text-align: center;

  overflow: hidden;
  border-radius: 0;
  clip-path: inset(0);
}
.card.slotNameOnly .cardTitle{
  font-size: calc(10 * var(--u) * var(--boardScale));
  font-weight: 900 !important;

  width: 100%;
  box-sizing: border-box;
  padding: 0 0.35em;

  white-space: normal;
  overflow-wrap: anywhere;
  word-break: break-word;
  line-height: 1.1;

  display: -webkit-box;
  -webkit-box-orient: vertical;
  line-clamp: 2;
  -webkit-line-clamp: 2;
  overflow: hidden;
}
.card.slotNameOnly .cardBody{ display:none !important; }


.cardHoverPreview{
  position: fixed;
  right: calc(var(--edgePad) + calc(14 * var(--u)));
  top: calc(var(--hudH) + calc(110 * var(--u)));
  z-index: var(--zChrome);
  width: calc(360 * var(--u));
  height: auto;

  border-radius: 0;
  border: calc(1 * var(--u)) solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.78);
  backdrop-filter: blur(calc(10 * var(--u)));
  -webkit-backdrop-filter: blur(calc(10 * var(--u)));
  box-shadow: 0 calc(18 * var(--u)) calc(60 * var(--u)) rgba(0,0,0,.55);

  padding: calc(14 * var(--u));
  display: none;
  pointer-events: none;
}
.cardHoverPreview.on{ display:block; }

.cardHoverPreviewTitle{
  font-weight: 900;
  font-size: calc(18 * var(--u));
  margin-bottom: calc(10 * var(--u));
  opacity: .95;
}
.cardHoverPreviewRow{
  display: grid;
  grid-template-columns: 1fr;
  gap: calc(12 * var(--u));
  align-items: start;
}
.cardHoverPreviewCard{
  width: calc(220 * var(--u));
  margin: 0 auto;
  transform: translateY(calc(4 * var(--u)));
}
.cardHoverPreviewDetail{
  border-radius: 0;
  border: calc(1 * var(--u)) solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.03);
  padding: calc(12 * var(--u));
  white-space: pre-wrap;
  line-height: 1.4;
  font-size: calc(13 * var(--u));
}



.slot,
.slot::before,
.slotCardScaler,
.slotCardInner,
.card,
.card::before,
.card.selected,
.card.slotNameOnly,
.dragLayer .dragCardPreview,
.cardHoverPreview,
.cardHoverPreviewDetail{
  border-radius: 0 !important;
}
.card.slotNameOnly,
.dragLayer .dragCardPreview{
  clip-path: inset(0) !important;
}



.handDock{
  position: fixed;
  left: 50%;
  width: min(calc(780 * var(--u)), calc(100vw - var(--safeL) - var(--safeR)));
  max-width: calc(100vw - var(--safeL) - var(--safeR));
  transform: translateX(-50%);
  bottom: var(--safeB);
  height: var(--dockH);
  padding: calc(6 * var(--u)) var(--edgePad) calc(10 * var(--u)) var(--edgePad);
  background: linear-gradient(
    to top,
    rgba(0,0,0,0.92) 0%,
    rgba(0,0,0,0.65) 35%,
    rgba(0,0,0,0.00) 100%
  );

  z-index: var(--zHandDock);
  pointer-events: none;
}
.handDock * { pointer-events: auto; }

.handDock > .controlsDock,
.handDock > .hand{
  transform: none !important;
}

.hand{
  height: calc(var(--handCardH) + calc(12 * var(--u)));
  position: relative;
  box-sizing: border-box;
  padding-inline: calc(22 * var(--u));
  scroll-padding-left: calc(22 * var(--u));
  scroll-padding-right: calc(22 * var(--u));

  overflow-x: auto;
  overflow-y: visible;
  -webkit-overflow-scrolling: touch;

  
  scrollbar-width: none;
  -ms-overflow-style: none;
}

body.handDragScrollLock .hand{
  overflow-x: hidden !important;
  touch-action: none !important;
}
.hand::-webkit-scrollbar{ width: 0; height: 0; }
.hand::-webkit-scrollbar-thumb{ background: transparent; }
.hand::-webkit-scrollbar-track{ background: transparent; }


.hand::before,
.hand::after{
  content: "";
  position: absolute;
  top: 0;
  bottom: 0;
  width: calc(28 * var(--u));
  pointer-events: none;
  z-index: 5;
}



.handCardsRow{
  display: flex;
  justify-content: center;
  flex-wrap: nowrap;
  gap: calc(10 * var(--u));
  align-items: flex-end;
  width: max-content;
  min-width: 100%;
  padding: calc(6 * var(--u)) 0 0 0;
  overflow: visible !important;
}



.logPanel{
  position: fixed;
  top: calc(var(--safeT) + var(--hudH) + calc(8 * var(--u)));
  right: var(--edgePad);
  width: var(--logW);
  height: min(46vh, calc(420 * var(--u)));
  padding: calc(14 * var(--u));
  display:flex;
  flex-direction:column;
  box-sizing: border-box;
  isolation: isolate;

  background: var(--logBg);
  border: calc(1 * var(--u)) solid var(--logLine);
  box-shadow: var(--logShadow);
  border-radius: calc(18 * var(--u));
  z-index: var(--zChrome);
}

.logPanel .log{
  flex:1;
  min-height:0;
  margin:0;
  padding: calc(10 * var(--u));
  border-radius: calc(12 * var(--u));
  border:calc(1 * var(--u)) solid var(--line);
  background: rgba(0,0,0,.55);
  color: #cfd5e2;
  font-size: calc(12 * var(--u));
  line-height: 1.45;
  overflow:auto;
  white-space: pre-wrap;
}


.logPanel.collapsed{
  width: calc(56 * var(--u));
  height: calc(56 * var(--u));
  padding: calc(10 * var(--u));
  background: transparent !important;
  border: 0 !important;
  box-shadow: none !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}
.logPanel.collapsed .log{ display:none; }
.logPanel.collapsed:hover{ opacity: .85; }
.logPanel.collapsed::before,
.logPanel.collapsed::after{ content:none !important; display:none !important; }

.logPanel.collapsed .logHeaderRow{
  background: rgba(0,0,0,.92) !important;
  border: calc(1 * var(--u)) solid rgba(255,255,255,.22) !important;
  box-shadow: 0 calc(10 * var(--u)) calc(24 * var(--u)) rgba(0,0,0,.55) !important;
}

.logHeaderRow{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: calc(8 * var(--u));
  -webkit-user-select: none;
  user-select:none;
  cursor:pointer;
  padding: calc(8 * var(--u)) calc(10 * var(--u));
  border-radius: calc(12 * var(--u));
  border: calc(1 * var(--u)) solid var(--line);
  background: rgba(0,0,0,1);
  margin-bottom: calc(10 * var(--u));
}
.logHeaderRow h2{ margin:0; font-size: calc(14 * var(--u)); }
.logHeaderRow .chev{ opacity:.85; font-size: calc(14 * var(--u)); }

.logOverlay,
.logOverlayLayer{
  position: fixed;
  inset: 0;
  z-index: var(--zLogOverlay) !important;
  pointer-events: auto !important;
}


.logScroll{
  scrollbar-width: none;
  scrollbar-color: transparent transparent;
}
.logScroll::-webkit-scrollbar{ width: 0; height: 0; }
.logScroll::-webkit-scrollbar-thumb{ background: transparent; }
.logScroll::-webkit-scrollbar-track{ background: transparent; }



.nodeIcon{
  display:inline-block;
  width:1.25em;
  text-align:center;
  line-height:1;
  vertical-align:middle;
  font-family:"Mulmaru","Segoe UI Symbol","Noto Sans Symbols 2","Noto Sans Symbols",sans-serif;
  font-variant-emoji:text;
}
.nodeText{ margin-left:.15em; vertical-align:middle; }
.nodeSep{ margin: 0 .25em; opacity: .8; }

.nodePreviewRow{
  display: grid;
  grid-template-columns: var(--colNow) var(--colArrow) var(--colNext) var(--colSlash) var(--colNext);
  column-gap: var(--gap);
  align-items: center;

  padding: calc(10 * var(--u));
  border-radius: calc(14 * var(--u));
  cursor: pointer;
}
.nodeCol{ min-width: 0; }
.nodeSepArrow,
.nodeSepSlash{
  text-align: center;
  opacity: .9;
  -webkit-user-select: none;
  user-select: none;
  pointer-events: none;
}



.enemyHudCenter{
  position: fixed;
  top: calc(8 * var(--u));
  left: 50%;
  transform: translateX(calc(-50% + var(--enemyHudDx)));

  width: auto;
  max-width: calc(100vw - calc(24 * var(--u)));
  height: auto;

  background: none !important;
  border: 0 !important;
  box-shadow: none !important;
  padding: 0 !important;
  margin: 0 !important;

  z-index: var(--zChrome) !important;
  pointer-events: auto !important;
}
.enemyHudCenter *{ pointer-events: auto !important; }

.enemyHudCenter .enemyHudCenterMover,
.enemyHudCenter .enemyHud,
.enemyHudCenter .enemyStrip{
  display:flex;
  flex-direction: row;
  gap: calc(12 * var(--u));
  align-items: stretch;
  justify-content: center;
  flex-wrap: nowrap;
  background: none !important;
  pointer-events: auto;
}


.enemyHudCenter .enemyChip,
.enemyHudCenter .enemyBanner{
  flex: 0 0 var(--enemyHudW) !important;
  width: var(--enemyHudW) !important;
  max-width: var(--enemyHudW) !important;

  pointer-events: auto !important;
  cursor: pointer;

  border-radius: calc(18 * var(--u));
  border: calc(1 * var(--u)) solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.68);
  box-shadow: 0 calc(18 * var(--u)) calc(50 * var(--u)) rgba(0,0,0,.35);
  overflow: hidden;
  box-sizing: border-box;
}

.enemyHudCenter .enemyChipTop,
.enemyHudCenter .enemyIntent{
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.enemyChipTop{
  display: flex;
  flex-direction: row;
  align-items: baseline;
  justify-content: space-between;
  gap: calc(8 * var(--u));
  white-space: nowrap;
}

.enemyHudCenter{
  min-height: 0 !important;
  height: auto !important;
}



.enemyHPOuter{
  height: var(--hpH) !important;
  border-radius: calc(2 * var(--u)) !important;
  overflow: hidden !important;
  background: rgba(0,0,0,.35) !important;
  border: calc(1 * var(--u)) solid var(--hpBorder) !important;
  box-shadow:
    inset 0 calc(1 * var(--u)) 0 var(--hpFrame),
    inset 0 -calc(1 * var(--u)) 0 rgba(0,0,0,.55);
  image-rendering: pixelated;
}
.enemyHPFill{
  height: 100% !important;
  border-radius: 0 !important;
  transition: none !important;
  background-image:
    repeating-linear-gradient(
      90deg,
      rgba(255,255,255,.18) 0,
      rgba(255,255,255,.18) calc(1 * var(--u)),
      rgba(0,0,0,0) calc(1 * var(--u)),
      rgba(0,0,0,0) var(--hpSeg)
    ),
    linear-gradient(180deg, rgba(255,255,255,.12), rgba(0,0,0,.20));
  background-size: auto 100%, 100% 100%;
  background-blend-mode: overlay;
  background-color: #7f241d !important;
}





.combatControls{
  position: fixed;
  display: flex;
  justify-content: center;


  bottom: calc(100vh - var(--handDockTopPx) + calc(10 * var(--u)) + var(--safeB));

  right: calc(var(--edgePad) + var(--safeR));
  left: auto;
  transform: none;

  z-index: var(--zHandDock, 2000); 
  pointer-events: auto;
}
.combatControls *{ pointer-events: auto !important; }

.combatControls .stepBtn{
  padding: calc(10 * var(--u)) calc(14 * var(--u));
  border-radius: calc(6 * var(--u));
  font-size: calc(20 * var(--u));
  line-height: 1.1;
}
.combatControls .stepBtn.primary{ font-weight: 600; }


.phaseBanner{
  position: fixed;
  left: 50%;
  top: calc(64 * var(--u));
  transform: translateX(-50%);
  padding: calc(10 * var(--u)) calc(14 * var(--u));
  border-radius: calc(14 * var(--u));
  border: calc(1 * var(--u)) solid rgba(255,255,255,.18);
  background: rgba(0,0,0,.80);
  color: #fff;
  font-weight: 900;
  letter-spacing: calc(2 * var(--u));
  -webkit-backdrop-filter: blur(calc(6 * var(--u)));
  backdrop-filter: blur(calc(6 * var(--u)));
  pointer-events: none;
  animation-name: phaseInOut;
  animation-duration: calc(420ms * var(--animMul));
  animation-timing-function: ease;
  animation-fill-mode: both;
}
@keyframes phaseInOut{
  0%   { opacity: 0; transform: translateX(-50%) translateY(calc(-6 * var(--u))); }
  20%  { opacity: 1; }
  70%  { opacity: 1; }
  100% { opacity: 0; transform: translateX(-50%) translateY(calc(-12 * var(--u))); }
}


.stageCornerHud{
  position: fixed;
  pointer-events: none;

  left: calc(var(--safeL) + calc(160 * var(--u))) !important;
  right: auto !important;

  text-align: left;
  white-space: nowrap;

  padding: calc(17 * var(--u)) calc(10 * var(--u));
  background: rgba(0, 0, 0, 1);
  border: calc(1 * var(--u)) solid rgba(255,255,255,.18);
  border-radius: calc(10 * var(--u));
  box-shadow:
    0 calc(2 * var(--u)) 0 rgba(0,0,0,.55),
    inset 0 calc(1 * var(--u)) 0 rgba(255,255,255,.10),
    inset 0 -calc(1 * var(--u)) 0 rgba(0,0,0,.45);

  color: rgba(235,240,255,.96);
  font-size: calc(18 * var(--u));
  line-height: 1.5;
  text-shadow:
    calc(2 * var(--u)) calc(2 * var(--u)) 0 rgba(0,0,0,.90),
    -calc(2 * var(--u)) calc(2 * var(--u)) 0 rgba(0,0,0,.90),
    calc(2 * var(--u)) -calc(2 * var(--u)) 0 rgba(0,0,0,.90),
    -calc(2 * var(--u)) -calc(2 * var(--u)) 0 rgba(0,0,0,.90);

  top:  calc(var(--safeT) + calc(10 * var(--u)));
  transform: translateX(-50%) translateY(570%) translateY(var(--stageCornerLiftY)) !important;
  z-index: var(--zChrome);
}


#hudSOnly{
  position: fixed;
  left: var(--sHudLeft);
  top:  var(--sHudTop);
  transform: translate(var(--sHudOffX), var(--sHudOffY));
  z-index: var(--zChrome);

  padding: var(--sHudPadY) var(--sHudPadX);
  background: rgb(0, 0, 0);
  border: calc(1 * var(--u)) solid rgba(255,255,255,0);
  border-radius: var(--sHudR);

  font-weight: 900;
  font-size: var(--sHudFont);
  color: rgb(254, 254, 254);
  line-height: 1;
  white-space: nowrap;

  pointer-events: none;
}


.floatingNewRun,
.newRunBtn{
  position: fixed;
  top:  calc(var(--safeT) + calc(8 * var(--u)));
  left: calc(var(--safeL) + calc(10 * var(--u)));
  z-index: calc(var(--zChrome) + 10000);
  pointer-events: auto;
}
.newRunBtn *{ pointer-events:auto !important; }


.floatingFaithBadge{
  position: fixed;
  z-index: calc(var(--zChrome) + 10000);
  pointer-events: auto;

  display: inline-flex;
  align-items: center;
  justify-content: center;

  padding: calc(8 * var(--u)) calc(10 * var(--u));
  border-radius: calc(999 * var(--u));
  border: calc(1 * var(--u)) solid rgba(255,255,255,.18);
  background: rgba(0,0,0,1);
  color: rgba(255,255,255,.92);

  font-size: calc(13 * var(--u));
  line-height: 1;
  white-space: nowrap;

  font-family: "Mulmaru", ui-sans-serif, system-ui, -apple-system,
               "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", sans-serif !important;
}


.targetHintInline{
  position: fixed;
  left: 50%;
  top: var(--targetHintTop) !important;
  transform: translateX(-50%);
  pointer-events: none;

  max-width: min(calc(720 * var(--u)), calc(100vw - calc(24 * var(--u))));
  padding: calc(6 * var(--u)) calc(10 * var(--u));
  border-radius: calc(12 * var(--u));

  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}


.floatFxLayer{
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: var(--zChrome);
}

.floatNum{
  position: absolute;
  transform: translate(-50%, -50%);
  font-weight: 900;
  font-size: calc(18 * var(--u));
  text-shadow: 0 calc(2 * var(--u)) 0 rgba(0,0,0,.55), 0 0 calc(12 * var(--u)) rgba(0,0,0,.45);
  animation-name: floatUp;
  animation-duration: calc(650ms * var(--animMul));
  animation-timing-function: ease-out;
  animation-fill-mode: both;
  will-change: transform, opacity;
}
.floatNum.dmg{  color: #ff6b6b; }
.floatNum.heal{ color: #6bff9e; }
.floatNum.block{ color:#8cc7ff; }

@keyframes floatUp{
  0%   { opacity: 0; transform: translate(-50%, -50%) translateY(calc(8 * var(--u))) scale(.96); }
  15%  { opacity: 1; }
  100% { opacity: 0; transform: translate(-50%, -50%) translateY(-calc(22 * var(--u))) scale(1.05); }
}



.overlay-layer{
  position: fixed !important;
  inset: 0 !important;
  z-index: var(--zRulebook) !important;
  pointer-events: auto !important;
}
.overlay-panel{
  z-index: calc(var(--zRulebook) + 1) !important;
  pointer-events: auto !important;
}

.settingsOverlay{
  position: fixed;
  inset: 0;
  z-index: var(--zSettings) !important;

  background: rgba(0,0,0,0.92);
  display: flex;
  justify-content: center;
  align-items: flex-start;
  padding: calc(24 * var(--u));
  box-sizing: border-box;

  pointer-events: auto !important;
}
.settingsOverlay *{ pointer-events:auto !important; }

.settingsPanel{
  width: min(calc(760 * var(--u)), 90%) !important;
  max-width: none !important;
  max-height: none !important;
  overflow: visible;

  border-radius: calc(18 * var(--u));
  border: calc(1 * var(--u)) solid rgba(255,255,255,.14);
  background: rgba(10,12,14,1);
  padding: calc(16 * var(--u));
}



.choice-contentRow{
  display:flex;
  gap: var(--choiceRowGap);
  margin-top: calc(12 * var(--u));
  justify-content:center;
  align-items:stretch;

  flex: 1 1 auto;
  min-height: 0;
}

.choice-leftCol{
  flex: 1 1 calc(640 * var(--u));
  max-width: calc(720 * var(--u));
  min-width: 0;

  display: flex;
  flex-direction: column;
  flex: 1 1 auto;
  min-height: 0;
}

.choice-illuCol{
  flex: 0 0 var(--choiceIlluSize);
  min-width: var(--choiceIlluMin);
  display:flex;
  align-items:center;
  justify-content:center;
}

.choice-illuBox{
  width: 100%;
  aspect-ratio: 1 / 1;
  border-radius: calc(18 * var(--u));
  border: calc(1 * var(--u)) solid rgba(255,255,255,.16);
  background: rgba(0,0,0,.35);
  overflow: hidden;
  position: relative;
}

.choice-list{
  display:flex;
  flex-direction:column;
  gap: var(--choiceListGap);

  flex: 1 1 auto;
  min-height: 0;
  overflow: auto;
  padding-right: calc(6 * var(--u));
}

.choice-item{
  display:flex;
  gap: calc(12 * var(--u));
  align-items:flex-start;
  border:calc(1 * var(--u)) solid rgba(255,255,255,.10);
  border-radius: calc(14 * var(--u));
  padding: calc(12 * var(--u));
  background: rgba(255,255,255,.03);
  position:relative;
}

pre.choice-detail,
.choice-panel pre.choice-detail{
  font-family: "Mulmaru", sans-serif !important;
  font-size: calc(13 * var(--u));
  line-height: 1.35;
  letter-spacing: -calc(0.2 * var(--u));
}

.choice-overlay{
  position: fixed;
  inset: 0;
  z-index: var(--zChoiceBackdrop) !important;
  pointer-events: none !important;

  
  background: rgba(0,0,0,0) !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;

  display:flex;
  justify-content:center;
  align-items:flex-start;
  box-sizing:border-box;
}


.choice-backdrop{
  pointer-events: none !important;
  background: rgba(0, 0, 0, 0) !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}


.choice-panel{
  position: fixed !important;
  z-index: var(--zChoicePanel) !important;
  pointer-events: auto !important;

  display: flex;
  flex-direction: column;

  left: 50% !important;
  top: 50% !important;

  transform:
    translate(-50%, -50%)
    translate(
      calc(var(--choicePanelDx) * var(--u)),
      calc(var(--choicePanelDy) * var(--u))
    ) !important;

  width: min(calc(800 * var(--u)), 96vw);
  max-height: calc(92vh - calc(var(--choicePanelMarginY) * var(--u)) * 2);
  padding: var(--choicePanelPad);
  box-sizing: border-box;
  overflow: auto;
  overflow-x: hidden;
  border: calc(1 * var(--u)) solid rgba(255,255,255,0.1);
  border-radius: var(--choicePanelR);
  background: rgba(0,0,0,1);
  box-shadow: 0 calc(18 * var(--u)) calc(60 * var(--u)) rgba(0,0,0,1);

  
  font-family: "Mulmaru", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
}





.itemSlot{
  width: calc(60 * var(--u));
  height: calc(60 * var(--u));
  border-radius: calc(14 * var(--u));
  border: calc(1 * var(--u)) solid rgba(255,255,255,.18);
  background: rgba(0,0,0,.35);
  box-shadow: 0 calc(8 * var(--u)) calc(20 * var(--u)) rgba(0,0,0,.35);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  overflow: hidden;
}
.itemSlot img{
  width: 86%;
  height: 86%;
  object-fit: contain;
  image-rendering: pixelated;
}
.itemSlot:hover{ background: rgba(255,255,255,.06); }
.itemSlot:active{ transform: translateY(calc(1 * var(--u))); }
.itemSlot.disabled{ opacity: .45; cursor: default; }


.itemDropBtn{
  position: absolute;
  top: calc(2 * var(--u));
  right: calc(2 * var(--u));
  width: calc(18 * var(--u));
  height: calc(18 * var(--u));
  border-radius: calc(6 * var(--u));
  border: calc(1 * var(--u)) solid rgba(255,255,255,.22);
  background: rgba(0,0,0,.55);
  color: rgba(255,255,255,.85);
  font-size: calc(12 * var(--u));
  line-height: 1;
  display: grid;
  place-items: center;
  cursor: pointer;
  opacity: 0;
  transform: translateY(calc(-1 * var(--u)));
  transition: opacity .12s ease, transform .12s ease, background .12s ease;
  z-index: 2;
}
.itemSlot:hover .itemDropBtn{
  opacity: 1;
  transform: translateY(0);
}
.itemDropBtn:hover{ background: rgba(0,0,0,.78); }
.itemDropBtn:active{ transform: translateY(calc(1 * var(--u))); }


.itemCapBadge{
  position: absolute;
  left: calc(6 * var(--u));
  top: calc(6 * var(--u));
  padding: calc(3 * var(--u)) calc(6 * var(--u));
  border-radius: calc(999 * var(--u));
  background: rgba(0,0,0,.55);
  border: calc(1 * var(--u)) solid rgba(255,255,255,.18);
  font-size: calc(11 * var(--u));
  color: rgba(255,255,255,.85);
  pointer-events: none;
  z-index: 2;
}


.itemCapHud{
  position: fixed;
  display: flex;
  align-items: center;
  gap: calc(6 * var(--u));
  pointer-events: none;
  z-index: calc(var(--zRelicHud) + 2);
}
.itemCapHud .itemCapBadge{
  position: static;
  left: auto;
  top: auto;
}
.itemCapHint{
  padding: calc(3 * var(--u)) calc(7 * var(--u));
  border-radius: calc(999 * var(--u));
  background: rgba(0,0,0,.42);
  border: calc(1 * var(--u)) solid rgba(255,255,255,.14);
  font-size: calc(11 * var(--u));
  color: rgba(255,255,255,.78);
  white-space: nowrap;
}


#itemTray .itemSlot,
#itemTray .itemCell,
.itemSlot,
.itemCard,
.shopItemCard,
.shopItemIconWrap{
  overflow: hidden !important;
  position: relative;
}


:is(#itemTray, .itemTray){
  position: fixed !important;
  left: var(--itemTrayLeft) !important;
  bottom: var(--trayBottom) !important;
  z-index: var(--zRelicHud) !important;
  pointer-events: auto !important;

  display: grid !important;
  grid-template-columns: repeat(var(--trayCols), var(--traySlot)) !important;
  grid-auto-rows: var(--traySlot) !important;
  gap: var(--trayGap) !important;

  box-sizing: border-box !important;
  max-height: calc(
    (var(--traySlot) * var(--trayRowsMax))
    + (var(--trayGap) * (var(--trayRowsMax) - 1))
    + (var(--trayPad) * 2)
  ) !important;

  max-width: calc(
    (var(--traySlot) * var(--trayCols))
    + (var(--trayGap) * (var(--trayCols) - 1))
    + (var(--trayPad) * 2)
  ) !important;

  padding: var(--trayPad) !important;

  overflow-y: auto !important;
  overflow-x: hidden !important;
  align-content: start !important;

  
  scrollbar-width: none;
  -ms-overflow-style: none;
}
:is(#itemTray, .itemTray)::-webkit-scrollbar{ width: 0; height: 0; }
:is(#itemTray, .itemTray)::-webkit-scrollbar-thumb{ background: transparent; }
:is(#itemTray, .itemTray)::-webkit-scrollbar-track{ background: transparent; }


:is(#itemTray, .itemTray) :is(.itemSlot, .itemCell, .itemCard){
  width:  var(--traySlot) !important;
  height: var(--traySlot) !important;
  box-sizing: border-box !important;

  border: calc(1 * var(--u)) solid rgba(255,255,255,.18) !important;
  background: rgba(0,0,0,0.35) !important;

  border-radius: calc(14 * var(--u)) !important;
  box-shadow: 0 calc(8 * var(--u)) calc(20 * var(--u)) rgba(0,0,0,.35) !important;

  display: grid !important;
  place-items: center !important;
  cursor: pointer;
  overflow: hidden !important;
}


:is(#itemTray, .itemTray) :is(.itemSlot, .itemCell, .itemCard) img{
  width: 86% !important;
  height: 86% !important;
  object-fit: contain !important;
  image-rendering: pixelated !important;
}


#itemTray img,
.itemSlot img,
.itemCard img,
.shopItemCard img,
.shopItemIconWrap img{
  transform: scale(1.8);
  transform-origin: center;
  display: block;
}


:is(#itemTray, .itemTray) .itemHoverTip{
  display: none !important;
}




.relicTray{
  position: fixed;
  right: var(--relicTrayRight) !important;
  bottom: var(--trayBottom) !important;
  z-index: var(--zRelicHud);
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: calc(8 * var(--u));
  pointer-events: auto;


}


.relicTrayList{
  display: grid;
  grid-template-columns: repeat(var(--trayCols), var(--traySlot)) !important;
  grid-auto-rows: var(--traySlot) !important;
  gap: var(--trayGap) !important;

  justify-content: end;
  justify-items: stretch;
  align-items: stretch;

  box-sizing: border-box !important;
  max-height: calc(
    (var(--traySlot) * var(--trayRowsMax))
    + (var(--trayGap) * (var(--trayRowsMax) - 1))
    + (var(--trayPad) * 2)
  ) !important;

  max-width: calc(
    (var(--traySlot) * var(--trayCols))
    + (var(--trayGap) * (var(--trayCols) - 1))
    + (var(--trayPad) * 2)
  ) !important;

  overflow-y: auto;
  overflow-x: hidden;

  padding: var(--trayPad) !important;

  scrollbar-gutter: stable;
  scroll-snap-type: y mandatory;

  
  transform: rotate(180deg);
}


.relicTrayList .relicIcon{ transform: rotate(180deg); }

.relicIcon, .relicHoverTip, .relicModalPanel{ direction: ltr; }


.relicTrayList::-webkit-scrollbar{ width: calc(10 * var(--u)); }
.relicTrayList::-webkit-scrollbar-thumb{
  background: rgba(255,255,255,0.18);
  border-radius: calc(999 * var(--u));
}
.relicTrayList::-webkit-scrollbar-track{
  background: rgba(0,0,0,0.18);
  border-radius: calc(999 * var(--u));
}

.relicIcon{
  width: var(--relicIconSize);
  height: var(--relicIconSize);
  border-radius: calc(14 * var(--u));

  border: calc(2 * var(--u)) solid rgba(255, 255, 255, 1);
  background: rgba(0, 0, 0, 0.35);
  color: rgba(255, 255, 255, 0.92);

  display: grid;
  place-items: center;
  cursor: pointer;

  overflow: hidden;
  scroll-snap-align: start;

  box-sizing: border-box;
}

.relicIconImg{
  width: 100%;
  height: 100%;
  display: block;

  object-fit: cover;
  object-position: center;
  transform: scale(var(--relicImgZoom));
  transform-origin: center;

  image-rendering: pixelated;
}

.relicHoverTip{
  display: none;
  min-width: calc(220 * var(--u));
  max-width: calc(360 * var(--u));
  background: rgba(0, 0, 0, 0.82);
  border: calc(1 * var(--u)) solid rgba(255, 255, 255, 0.12);
  border-radius: calc(14 * var(--u));
  padding: calc(10 * var(--u)) calc(12 * var(--u));
  color: rgba(255, 255, 255, 0.92);
  box-shadow: 0 calc(18 * var(--u)) calc(40 * var(--u)) rgba(0, 0, 0, 0.45);
}
.relicTipTitle{ font-weight: 700; margin-bottom: calc(6 * var(--u)); }
.relicTipBody{ font-size: calc(12.5 * var(--u)); line-height: 1.35; white-space: pre-wrap; }

.relicModal{
  position: fixed;
  inset: 0;
  z-index: var(--zRelicModal);
  background: rgba(0, 0, 0, 0.55);
  display: grid;
  place-items: center;
  padding: calc(18 * var(--u));
}

.relicModalPanel{
  width: min(calc(720 * var(--u)), 96vw);
  max-height: min(84vh, calc(900 * var(--u)));
  overflow: auto;
  background: rgba(18, 18, 18, 0.96);
  border: calc(1 * var(--u)) solid rgba(255, 255, 255, 0.14);
  border-radius: calc(16 * var(--u));
  box-shadow: 0 calc(20 * var(--u)) calc(60 * var(--u)) rgba(0, 0, 0, 0.55);
  transform: translateY(-calc(60 * var(--u)));
}

.relicModalHeader{
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: calc(14 * var(--u)) calc(16 * var(--u));
  border-bottom: calc(1 * var(--u)) solid rgba(255, 255, 255, 0.10);
}
.relicModalTitle{ font-weight: 800; }

.relicModalBody{
  padding: calc(16 * var(--u));
  display: grid;
  grid-template-columns: calc(160 * var(--u)) 1fr;
  gap: calc(16 * var(--u));
  align-items: start;
}

.relicModalArt{
  width: calc(160 * var(--u));
  height: calc(160 * var(--u));
  border-radius: calc(14 * var(--u));
  overflow: hidden;
  border: calc(1 * var(--u)) solid rgba(255,255,255,0.12);
  background: rgba(0,0,0,0.28);
}
.relicModalArtImg{
  width: 100%;
  height: 100%;
  background-repeat: no-repeat;
  background-position: center;
  background-size: cover;
  transform: scale(1.15);
  transform-origin: center;
  image-rendering: pixelated;
}
.relicModalArtImg:empty{ background-image: none; }

.relicModalText{
  white-space: pre-wrap;
  line-height: 1.45;
}



.enemyBanner.enemyCardWrap{
  position: relative;
  flex: 0 0 auto;
  padding: 0;
  border: none;
  background: transparent;

  display: flex;
  flex-direction: column;
  align-items: center;
  overflow: visible !important;

  --enemyUi: 0.95;
}

.enemyArtWrap{
  position: relative;
  width: 100%;
  display: flex;
  justify-content: center;
  overflow: visible;
  --artZoom: 1;
}


.enemyArtCard{
  position: relative;
  width: calc(70% * var(--enemyUi));
  margin: calc(8 * var(--u)) auto 0;
  aspect-ratio: 1365 / 2048;
  height: auto;
  flex: 0 0 auto;

  border-radius: calc(2 * var(--u));
  overflow: visible;
  background: transparent;

  --frameBleed: calc(6 * var(--u));
}


.enemyArtCard::before{
  content:"";
  position:absolute;
  inset:0;
  background-image: var(--artImg);
  background-repeat: no-repeat;
  background-position: 50% 35%;
  background-size: calc(100% * var(--artZoom, 1.0)) auto;
  image-rendering: pixelated;
  z-index: 1;
}


.enemyArtCard::after{
  content:"";
  position:absolute;
  inset: calc(-2 * var(--frameBleed));
  background-image: var(--frameImg);
  background-repeat:no-repeat;
  background-position:center;
  background-size: 100% 100%;
  image-rendering: pixelated;
  pointer-events:none;
  z-index: 5;
}


.enemyMiniHud{
  width: 70%;
  padding: calc(7 * var(--u) * var(--enemyUi)) calc(9 * var(--u) * var(--enemyUi));
  border: calc(1 * var(--u)) solid rgba(255,255,255,.10);
  background: rgba(0,0,0,0.7);
  backdrop-filter: blur(calc(8 * var(--u)));
  -webkit-backdrop-filter: blur(calc(8 * var(--u)));
  display:flex;
  flex-direction:column;
  gap: calc(5 * var(--u) * var(--enemyUi));
  border-radius: calc(3 * var(--u));
  margin-top: -calc(10 * var(--u));
  z-index: 10;
}

.enemyIntentTopRow{
  display:flex;
  justify-content: center !important;
  align-items:center;
  gap: calc(8 * var(--u));
}

.enemyIntentIcon{
  font-size: calc(20 * var(--u) * var(--enemyUi));
  line-height: 1;
}

.enemyIntentDmg{
  font-size: calc(20 * var(--u) * var(--enemyUi));
  font-weight: 900;
  line-height: 1;
  white-space: nowrap;
}

.enemyIntentLine{
  font-size: calc(11 * var(--u) * var(--enemyUi));
  opacity: .92;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}


.enemyMiniHud .enemyHpLine{
  display:flex;
  flex-direction: row;
  align-items:center;
  gap: calc(8 * var(--u) * var(--enemyUi));
}
.enemyMiniHud .enemyHpText{
  font-size: calc(13 * var(--u) * var(--enemyUi));
  width: calc(78 * var(--u) * var(--enemyUi));
  flex: 0 0 auto;
  white-space: nowrap;
}
.enemyMiniHud .enemyHPOuter{
  flex: 1 1 auto;
  height: calc(7 * var(--u) * var(--enemyUi));
  border-radius: calc(999 * var(--u));
  overflow:hidden;
}
.enemyMiniHud .enemyHPFill{ height: 100%; }


.enemyStatusEmojiRow{
  display:flex;
  flex-wrap: wrap;
  align-items: center;
  font-size: calc(10 * var(--u) * var(--enemyUi));
  gap: calc(3 * var(--u) * var(--enemyUi));
  min-height: calc(16 * var(--u) * var(--enemyUi));
}
.enemyStatusEmojiRow .stEmoji{
  line-height: 1.1;
  border: calc(1 * var(--u)) solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.04);
  padding: calc(1 * var(--u) * var(--enemyUi)) calc(3 * var(--u) * var(--enemyUi));
  border-radius: calc(7 * var(--u) * var(--enemyUi));
}




.enemyPassiveRow{
  display:flex;
  justify-content:center;
  align-items:center;
  gap: calc(6 * var(--u) * var(--enemyUi));
  min-height: calc(14 * var(--u) * var(--enemyUi));
}
.enemyPassiveIcon{
  font-size: calc(13 * var(--u) * var(--enemyUi));
  line-height: 1;
  border: calc(1 * var(--u)) solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.05);
  padding: calc(1 * var(--u) * var(--enemyUi)) calc(4 * var(--u) * var(--enemyUi));
  border-radius: calc(8 * var(--u) * var(--enemyUi));
}


.enemyBanner.targetable{ cursor:pointer; }
.enemyBanner.untargetable{ cursor:not-allowed; opacity:.65; filter: grayscale(.20); }
.enemyBanner.untargetable .enemyMiniHud{ opacity: .85; }


.enemyHoverDetail{
  display:none;
  position:absolute;
  left: calc(10 * var(--u)); right: calc(10 * var(--u));
  bottom: calc(10 * var(--u));
  transform: translateY(-calc(6 * var(--u)));
  opacity: 0;
  pointer-events: none;
  white-space: pre-wrap;
  font-size: calc(12 * var(--u));
  line-height: 1.35;
  padding: calc(10 * var(--u)) calc(12 * var(--u));
  border-radius: calc(5 * var(--u));
  border: calc(1 * var(--u)) solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.86);
  -webkit-backdrop-filter: blur(calc(4 * var(--u)));
  backdrop-filter: blur(calc(4 * var(--u)));
  z-index: 50;
}
.enemyBanner:hover .enemyHoverDetail{ display:block; }

.enemyBanner.enemyCardWrap .enemyHoverDetail{
  left: -calc(18 * var(--u));
  right: -calc(18 * var(--u));
  top: -calc(10 * var(--u));
  bottom: -calc(10 * var(--u));
  transform: translateY(calc(14 * var(--u)));

  font-size: calc(14 * var(--u));
  padding: calc(14 * var(--u)) calc(16 * var(--u));
  border-radius: calc(10 * var(--u));

  max-height: min(40vh, calc(260 * var(--u)));
  overflow: auto;

  display: none;
  opacity: 0;
  pointer-events: none;

  box-shadow: 0 calc(22 * var(--u)) calc(70 * var(--u)) rgba(0,0,0,.60);
}
.enemyBanner.enemyCardWrap:hover .enemyHoverDetail{
  display: block;
  opacity: 1;
  transform: translateY(calc(-30 * var(--u)));
}
.enemyBanner.enemyCardWrap.touchHover .enemyHoverDetail{
  display: block;
  opacity: 1;
  transform: translateY(calc(-30 * var(--u)));
}
.enemyBanner.enemyCardWrap:hover .enemyMiniHud{ opacity: 0.18; }
.enemyBanner.enemyCardWrap.touchHover .enemyMiniHud{ opacity: 0.18; }

/* Enemy intent/desc hover: bigger on mobile */
body.mobile .enemyHoverDetail{
  font-size: calc(24 * var(--u));
  line-height: 1.45;
  padding: calc(16 * var(--u)) calc(18 * var(--u));
  border-radius: calc(10 * var(--u));
}
body.mobile .enemyBanner.enemyCardWrap .enemyHoverDetail{
  font-size: calc(28 * var(--u));
  padding: calc(20 * var(--u)) calc(22 * var(--u));
  max-height: min(52vh, calc(520 * var(--u)));
}




.nodeSelectWrap.mapNodeSelect{
  position: fixed !important;
  inset: auto !important;

  left: calc(var(--mapPanelCX) + var(--mapPanelDX)) !important;
  top:  calc(var(--mapPanelCY) + var(--mapPanelDY)) !important;
  transform: translate(-50%, 0%) !important;
  background: rgb(9,8,7) !important;
  border-radius: 5%;

  width: calc(var(--panelMaxWidthPx) * var(--u)) !important;
  max-height: calc(var(--mapPanelMaxHPx) * var(--u)) !important;

  display: flex !important;
  flex-direction: column !important;
  overflow: hidden !important;

  box-sizing: border-box !important;
  z-index: 52000 !important;
}

.mapNodeSelectBody{
  flex: 1 1 auto;
  min-height: 0;

  display: grid;
  grid-template-columns: minmax(0, 1fr) calc(var(--sideColWidthPx) * var(--u));
  gap: calc(var(--gridGapPx) * var(--u));

  margin-top: calc(3 * var(--u));
}

.mapNodeSelectMapCol{
  min-width: 0;
  min-height: 0;
  display: flex;
}

.mapNodeSelectSideCol{
  min-height: 0;
  overflow: auto;
  scrollbar-width: none;
  -ms-overflow-style: none;
}
.mapNodeSelectSideCol::-webkit-scrollbar{ width:0; height:0; }

.mapNodeSelectMapCol .mapMiniBox,
.mapNodeSelect .mapMiniBox{
  flex: 1 1 auto;
  min-height: 0;

  display: flex;
  flex-direction: column;

  padding: calc(var(--boxPadPx) * var(--u)) !important;
  border-radius: calc(var(--boxRadiusPx) * var(--u)) !important;
  margin: 0 !important;
}


.mapNodeSelectMapCol .mapMiniScroller,
.mapNodeSelect .mapMiniScroller{
  flex: 1 1 auto;
  min-height: calc(var(--mapScrollerMinHPx) * var(--u)) !important;
  overflow-x: auto !important;
  overflow-y: hidden !important;
  display: block !important;
  align-items: center !important;
  justify-content: center !important;
  scrollbar-width: none;
  -ms-overflow-style: none;
  border-radius: calc(var(--scrollerRadiusPx) * var(--u)) !important;

  background: var(--mapBgUrl) center/cover no-repeat !important;
}
.mapNodeSelect .mapMiniScroller::-webkit-scrollbar{ width:0; height:0; }

.mapNodeSelect .mapMiniViewport{
  width: 100%;
  height: 100%;

  overflow-x: auto;
  overflow-y: hidden;

  clip-path: inset(0 var(--pillarW) 0 var(--pillarW));
  padding-left: var(--pillarW);
  padding-right: var(--pillarW);
  box-sizing: border-box;

  scrollbar-width: none;
  -ms-overflow-style: none;
}
.mapNodeSelect .mapMiniViewport::-webkit-scrollbar{ width:0; height:0; }

.mapNodeSelectMapCol .mapMiniScroller svg,
.mapNodeSelect .mapMiniScroller svg{
  display: block !important;

  transform: scale(var(--mapSvgScale)) translate(var(--mapSvgDX), var(--mapSvgDY)) !important;
  transform-origin: top left !important;
}

.mapNodeSelectMapCol .mapMiniScroller svg path,
.mapNodeSelect .mapMiniScroller svg path{
  stroke-width: calc(1 * var(--u)) !important;
  stroke: rgb(255, 255, 255) !important;
}

.mapNodeSelectMapCol .mapMiniScroller svg circle,
.mapNodeSelect .mapMiniScroller svg circle{
  stroke-width: calc(3 * var(--u)) !important;
}

.mapNodeSelectMapCol .mapMiniScroller svg text,
.mapNodeSelect .mapMiniScroller svg text{
  font-size: calc(16 * var(--u)) !important;
  text-anchor: middle !important;
  dominant-baseline: central !important;
}

.mapDetailPanel{
  width: calc(685 * var(--u)) !important;
  max-height: calc(100vh - (calc(64 * var(--u)))) !important;
  overflow-y: auto !important;
  transform: translate(0%, 39%) !important;
}

.mapNodeSelect .nodeSelectHeader{
  height: auto !important;
  min-height: calc(40 * var(--u)) !important;
  padding-top: calc(15 * var(--u)) !important;
  padding-bottom: calc(0 * var(--u)) !important;
  padding-left: calc(40 * var(--u)) !important;
  padding-right: calc(40 * var(--u)) !important;
  overflow: visible !important;
}
.mapNodeSelect .nodeSelectHeaderRight button{
  margin-top: calc(2 * var(--u)) !important;
}



.toastLayer{
  position: fixed !important;
  z-index: calc(var(--zChrome) + 500) !important;

  left: var(--toastCX) !important;
  top:  var(--toastCY) !important;
  right: auto !important;
  bottom: auto !important;

  transform:
    translate(-50%, -50%)
    translate(
      calc(var(--toastDx) * var(--u)),
      calc(var(--toastDy) * var(--u))
    ) !important;

  display: flex;
  flex-direction: column-reverse;
  gap: var(--toastGap);
  align-items: center;
}

.toast{
  background: rgba(0,0,0,0.72);
  color: #fff;
  padding: var(--toastPadY) var(--toastPadX);
  border-radius: var(--toastR);
  font-size: var(--toastFont);
  line-height: 1.2;
  box-shadow: 0 calc(6 * var(--u)) calc(18 * var(--u)) rgba(0,0,0,0.35);
  max-width: min(var(--toastMaxW), 88vw);
}

.toast-gold{ border: calc(1 * var(--u)) solid rgba(255,215,0,0.35); }
.toast-warn{ border: calc(1 * var(--u)) solid rgba(255,120,120,0.35); }
.toast-relic{ border: calc(1 * var(--u)) solid rgba(120,200,255,0.35); }
.toast-info{ border: calc(1 * var(--u)) solid rgba(255,255,255,0.18); }



.choice-panel.shopPanel{
  width: var(--shopPanelW);
  overflow: hidden;
}

.choice-overlay.shopOverlay{
  z-index: calc(var(--zRelicHud) + 40) !important;
}

.choice-overlay.shopOverlay .choice-panel.shopPanel{
  z-index: calc(var(--zRelicHud) + 41) !important;
}

.shopContentRow{
  display:flex;
  gap: calc(14 * var(--u));
  margin-top: calc(10 * var(--u));
  align-items: stretch;
}

.shopLeftCol{
  flex: 1 1 auto;
  min-width: 0;
  display:flex;
  flex-direction: column;
  gap: calc(12 * var(--u));
}


.shopCardsGrid{
  display:grid;
  grid-template-columns: repeat(3, var(--handCardW));
  gap: calc(12 * var(--u));
  justify-content: start;
  align-items: start;
}

.shopCardTile{
  display:flex;
  flex-direction: column;
  align-items: center;
  gap: calc(6 * var(--u));
  cursor: pointer;
  -webkit-user-select: none;
  user-select: none;
}
.shopCardTile.sold{ opacity: .35; cursor: default; }

.shopTilePrice{
  font-weight: 900;
  font-size: calc(15 * var(--u));
  opacity: .90;
}


.shopBottomRow{
  display:flex;
  gap: calc(14 * var(--u));
  align-items: flex-start;
  justify-content: flex-start;
}


.shopItemsGrid{
  display:flex;
  gap: calc(10 * var(--u));
  flex-wrap: wrap;
}

.shopItemTile{
  width: var(--shopItemSize);
  aspect-ratio: 1/1;
  border: calc(1 * var(--u)) solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.30);
  overflow: hidden;
  display:flex;
  flex-direction: column;
  align-items:center;
  justify-content:center;
  gap: calc(6 * var(--u));
  cursor:pointer;
}
.shopItemTile.sold{ opacity:.35; cursor:default; }
.shopItemTile img{
  width: var(--shopItemIcon);
  height: var(--shopItemIcon);
  object-fit: contain;
  transform: scale(1.1);
  image-rendering: pixelated;
}


.shopSvcGrid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--shopSvcGap);
  width: var(--shopSvcW);
}
.shopSvcTile button{
  width: 100%;
  padding: calc(7 * var(--u)) calc(8 * var(--u));
  font-size: calc(12 * var(--u));
  border-radius: 0;
}
.shopSvcNote{
  margin-top: calc(4 * var(--u));
  font-size: calc(12 * var(--u));
  line-height: 1.25;
  font-weight: 800;
  opacity: .85;
  text-align:center;
}



.itemHoverTip{
  display: block !important;
  opacity: 0;
  visibility: hidden;
  transform: translateY(calc(-4 * var(--u)));
  transition: opacity 90ms ease, transform 90ms ease;
  max-width: calc(260 * var(--u));
  padding: calc(10 * var(--u));
  border: calc(1 * var(--u)) solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.72);
  backdrop-filter: blur(calc(4 * var(--u)));
  -webkit-backdrop-filter: blur(calc(4 * var(--u)));
}
.itemHoverTip.show{
  opacity: 1;
  visibility: visible;
  transform: translateY(0);
}


/* =========================
   MOBILE: TYPOGRAPHY + CHROME POSITION
   - Respect existing PC layout; only enlarge non-card text.
   - Hide ALL scrollbars (scroll still works).
   ========================= */

body.mobile{
  /* Pull floating chrome upward (stage corner / player HUD / sHudOnly) */
  --playerHudTop: calc(var(--safeT) + calc(1000* var(--u)));
  --sHudTop:      calc(var(--safeT) + var(--hudH) + calc(280 * var(--u)));
  --sHudOffY:     calc(10 * var(--u));
  --stageCornerLiftY: calc(-18 * var(--u));

  /* Make HUDs chunkier on mobile */
  --sHudFont: clamp(calc(30 * var(--u)), 6vw, calc(46 * var(--u)));
  --sHudPadY: calc(12 * var(--u));
  --sHudPadX: calc(16 * var(--u));
  --sHudR:    calc(14 * var(--u));
}

/* Hide scrollbars everywhere on mobile */
body.mobile *{
  scrollbar-width: none;
  scrollbar-color: transparent transparent;
}
body.mobile *::-webkit-scrollbar{ width: 0; height: 0; }
body.mobile *::-webkit-scrollbar-thumb{ background: transparent; }
body.mobile *::-webkit-scrollbar-track{ background: transparent; }

/* Log / Rulebook / Settings */
body.mobile pre.log,
body.mobile .logPanel pre.log,
body.mobile .logOverlay pre.log,
body.mobile pre.log.log{
  font-size: calc(20 * var(--u));
  line-height: 1.55;
}

body.mobile .settingsPanel{
  font-size: calc(18 * var(--u));
}

body.mobile .overlay-panel{
  font-size: calc(18 * var(--u));
  line-height: 1.55;
}

body.mobile .relicModalText{
  font-size: calc(18 * var(--u));
  line-height: 1.55;
}

/* Faith hover tip (and other hover tips) */
body.mobile #faithHoverTip,
body.mobile .itemHoverTip{
  font-size: calc(22 * var(--u));
  max-width: min(calc(560 * var(--u)), calc(100vw - calc(16 * var(--u))));
  padding: calc(14 * var(--u)) calc(16 * var(--u));
}
body.mobile #faithHoverTip .relicTipTitle,
body.mobile .itemHoverTip .relicTipTitle{
  font-size: calc(26 * var(--u));
  font-weight: 900;
}
body.mobile #faithHoverTip .relicTipBody,
body.mobile .itemHoverTip .relicTipBody{
  font-size: calc(22 * var(--u));
  line-height: 1.5;
}

/* Enemy intent / HP / Block (includes player HUD mini bars that reuse enemyChipTop classes) */
body.mobile .enemyChipTop{ font-size: calc(18 * var(--u)); }
body.mobile .enemyHudCenter .enemyChipTop{ font-size: calc(18 * var(--u)); }
body.mobile .enemyHudCenter .enemyIntent{ font-size: calc(16 * var(--u)); }

/* Enemy description hover should be bigger on mobile */
body.mobile .enemyHoverDetail{
  font-size: calc(18 * var(--u));
  line-height: 1.55;
  padding: calc(14 * var(--u)) calc(16 * var(--u));
}
body.mobile .enemyBanner.enemyCardWrap .enemyHoverDetail{
  font-size: calc(18 * var(--u));
  max-height: min(52vh, calc(520 * var(--u)));
}

body.mobile .enemyHoverDetail{
  font-size: calc(19 * var(--u));      /* 12 -> 19 ì •ë„ë¡œ */
  line-height: 1.45;
  padding: calc(16 * var(--u)) calc(18 * var(--u));
  border-radius: calc(10 * var(--u));
}

/* ì  ì¹´ë“œ ìœ„ì— ëœ¨ëŠ”(=enemyCardWrap) í˜¸ë²„ë„ ê°™ì´ */
body.mobile .enemyBanner.enemyCardWrap .enemyHoverDetail{
  font-size: calc(20 * var(--u));      /* 14 -> 22 ì •ë„ë¡œ */
  padding: calc(18 * var(--u)) calc(20 * var(--u));
  max-height: min(52vh, calc(420 * var(--u)));
}

/* Keep enemy UI readable, but shrink the illustration on mobile */
body.mobile .enemyBanner.enemyCardWrap{ --enemyUi: 1.15; }
body.mobile .enemyArtCard{
  width: calc(46% * var(--enemyUi));
  margin-top: calc(4 * var(--u));
  --artZoom: 0.95;
}
body.mobile .enemyMiniHud{ width: 92%; }


/* Mobile safe-area padding (PC testing + real phones) */
body.mobile{
  --safePad: calc(6 * var(--u));
  --safeT: calc(env(safe-area-inset-top, 0) + var(--safePad));
  --safeR: calc(env(safe-area-inset-right, 0) + var(--safePad));
  --safeB: calc(env(safe-area-inset-bottom, 0) + var(--safePad));
  --safeL: calc(env(safe-area-inset-left, 0) + var(--safePad));
}

body.mobile{
  --playerHudTop: calc(var(--safeT) + calc(100 * var(--u))); /* ìˆ«ìž ì¤„ì´ë©´ ìœ„ë¡œ */
  --playerHudLeftX: calc(var(--safeL) + calc(8 * var(--u))); /* ë” ì™¼ìª½ */
}

body.mobile{
  --stageCornerLiftY: calc(-430 * var(--u)); /* ì–‘ìˆ˜ë©´ ì•„ëž˜ë¡œ, ìŒìˆ˜ë©´ ìœ„ë¡œ(ì—°ê²° ë°©ì‹ì— ë”°ë¼ ë°˜ëŒ€ì¼ ìˆ˜ë„) */
}

body.mobile{
  --sHudLeft: calc(var(--safeL) + calc(100 * var(--u)));
}

body.mobile .stageCornerHud{
  left: calc(var(--safeL) + calc(210 * var(--u))) !important; /* 160 -> 90 */
}

body.mobile .nodeIcon{ font-size: 2.7em; }
 


/* Hovered card preview panel: big readable text on mobile */
body.mobile .cardHoverPreview{
  width: min(calc(420 * var(--u)), calc(100vw - var(--edgePad) - var(--safeR) - calc(10 * var(--u))));
  top: calc(var(--safeT) + var(--hudH) + calc(18 * var(--u)));
  right: calc(var(--safeR) + calc(10 * var(--u)));
}
body.mobile .cardHoverPreviewTitle{ font-size: calc(40 * var(--u)); }
body.mobile .cardHoverPreviewDetail{
  font-size: calc(30 * var(--u));
  line-height: 1.55;
  max-height: min(46vh, calc(520 * var(--u)));
  overflow: auto;
}

/* Rulebook + log readability (mobile: ~2x) */
body.mobile pre.rulebook{ font-size: calc(26 * var(--u)) !important; line-height: 1.55 !important; }
body.mobile pre.log,
body.mobile .logPanel pre.log,
body.mobile .logOverlay pre.log{ font-size: calc(24 * var(--u)) !important; line-height: 1.55 !important; }
body.mobile .logHeaderRow h2{ font-size: calc(28 * var(--u)) !important; }
body.mobile .logHeaderRow .chev{ font-size: calc(28 * var(--u)) !important; }


/* Player HUD + stage corner: bigger on mobile */
body.mobile .playerHudLeft{
  width: min(calc(520 * var(--u)), calc(100vw - (var(--edgePad) * 2)));
  padding: calc(18 * var(--u));
}
body.mobile .playerHudTitle{ font-size: calc(20 * var(--u)); }
body.mobile .playerHudLeft .enemyChipTop{ font-size: calc(30 * var(--u)); }

body.mobile .stageCornerHud{
  font-size: calc(30 * var(--u));
  padding: calc(18 * var(--u)) calc(12 * var(--u));
}

.floatingFaithBadge{ font-size: 150%; }
.faithHoverTip{
  font-size: calc(22 * var(--u));
  line-height: 1.45;
  padding: calc(14 * var(--u)) calc(16 * var(--u));
  border-radius: calc(12 * var(--u));
  max-width: min(calc(560 * var(--u)), calc(100vw - calc(16 * var(--u))));
}
/* When pinned (tap), keep it interactive */
.cardHoverPreview.pinned{
  pointer-events: auto;
}


html.mobile .mapNodeSelect .mapMiniScroller svg text,
body.mobile .mapNodeSelect .mapMiniScroller svg text{
  font-size: var(--mapNodeEmojiSize) !important;
}




/* =========================
   MOBILE LAYOUT (respect PC logic)
   - layout switches are driven by body classes set in uiFit.ts
   - .mobile / .desktop
   - .portrait / .landscape
   ========================= */

body.mobile{
  /* ì¡°ê¸ˆ ë” íƒ€ì´íŠ¸í•˜ê²Œ: ë³´ë“œê°€ ëœ ìž‘ì•„ì§€ê²Œ */
  --edgePad: calc(10 * var(--u));
  --logW:   calc(320 * var(--u));
  --logGap: calc(10 * var(--u));

  /* ì†íŒ¨ê°€ í™”ë©´ì„ ë„ˆë¬´ ë¨¹ì§€ ì•Šë„ë¡ */
  --dockH: calc(148 * var(--u));
  --handCardW: calc(80 * var(--u));
  --handCardH: calc(var(--handCardW) * 7 / 5);
  --handTextMul: calc(var(--handCardW) / var(--cardW));

  /* ë³´ë“œ í­ í™•ë³´ */
  --slotGap: calc(10 * var(--u) * var(--boardScale));
  --boardPadX: calc(44 * var(--u));
  --boardPadY: calc(30 * var(--u));

  /* íŠ¸ë ˆì´ ì‚´ì§ ì¶•ì†Œ */
  --traySlot: calc(64 * var(--u));
  --trayGap:  calc(8 * var(--u));
  --trayPad:  calc(8 * var(--u));
}

body.mobile .hand .card,
body.mobile .cardHoverPreviewCard .card{
  --cardInnerMul: var(--handTextMul);
}

body.mobile .cardHoverPreviewCard{
  width: min(var(--handCardW), calc(300 * var(--u)));
}

/* ëª¨ë°”ì¼ ì„¸ë¡œ: stage ìœ„ / ë¡œê·¸ ì•„ëž˜(ë°”í…€ íŒ¨ë„), PC êµ¬ì¡° ìœ ì§€ */
body.mobile.portrait .logPanel{
  left: var(--edgePad);
  right: var(--edgePad);
  width: auto;

  top: auto;
  bottom: calc(var(--safeB) + var(--dockH) + calc(10 * var(--u)));

  height: min(30vh, calc(340 * var(--u)));
}

body.mobile.portrait .logPanel.collapsed{
  left: auto;
  right: var(--edgePad);

  bottom: calc(var(--safeB) + var(--dockH) + calc(10 * var(--u)));
}

body.mobile.portrait .playerHudLeft{
  /* ê¸°ì¡´ PC ë°°ì¹˜(620u)ëŠ” ì„¸ë¡œì—ì„œ í™”ë©´ ë°–ìœ¼ë¡œ íŠ€ëŠ” ê²½ìš°ê°€ ë§Žì•„ì„œ ìƒë‹¨ìœ¼ë¡œ */
  top:  calc(var(--safeT) + var(--hudH) + calc(390 * var(--u)));
  left: calc(var(--safeL) + var(--edgePad));
  width: calc(520 * var(--u));
  font-size: 150%;
}

body.mobile.portrait .topHudRight{
  top:   calc(var(--safeT) + calc(8 * var(--u)));
  right: calc(var(--safeR) + calc(8 * var(--u)));
}

/* ëª¨ë°”ì¼ ì„¸ë¡œ: ì¤‘ì•™ ë³´ë“œê°€ ì†íŒ¨/ë¡œê·¸ì— ê°€ë¦¬ì§€ ì•Šë„ë¡ ì—¬ìœ  */
body.mobile.portrait .mainRow{
  padding-bottom: calc(var(--dockH) + calc(12 * var(--u)));
}

/* ëª¨ë°”ì¼ ê°€ë¡œ(landscape): PCì— ìµœëŒ€í•œ ê°€ê¹ê²Œ, ë‹¤ë§Œ ë†’ì´ë§Œ ì œí•œ */
body.mobile.landscape .logPanel{
  height: min(48vh, calc(420 * var(--u)));
}

/* =========================
   MOBILE PORTRAIT â€” COMBAT REBUILD
   (enemies top â†’ (player/status + action panel) â†’ board
    items left / relics right (scroll) â†’ hand at bottom)
   ========================= */

/* Utility: hide scrollbars even on desktop when needed */
.noScrollbar{
  scrollbar-width: none;
  scrollbar-color: transparent transparent;
}
.noScrollbar::-webkit-scrollbar{ width: 0; height: 0; }
.noScrollbar::-webkit-scrollbar-thumb{ background: transparent; }
.noScrollbar::-webkit-scrollbar-track{ background: transparent; }

body.mobile.portrait .topHudRightChrome{ display:none !important; }
body.mobile.portrait .floatingNewRun,
body.mobile.portrait .floatingFaithBadge,
body.mobile.portrait .relicHud{
  display:none !important;
}

/* We use the log overlay button on mobile; keep the side logPanel out of the way */
body.mobile.portrait .logPanel{ display:none !important; }

body.mobile.portrait .topHud{
  position: sticky;
  top: 0;
  left: 0;
  right: 0;
  z-index: var(--zChrome);
  padding: calc(var(--safeT) + calc(8 * var(--u))) calc(var(--safeR) + var(--edgePad)) calc(10 * var(--u)) calc(var(--safeL) + var(--edgePad));
  box-sizing: border-box;
  background: rgba(0,0,0,.35);
  backdrop-filter: blur(calc(6 * var(--u)));
  -webkit-backdrop-filter: blur(calc(6 * var(--u)));
}

body.mobile.portrait .mobileEnemyStrip{
  width: 100%;
  margin: 0 0 calc(10 * var(--u)) 0;
}
body.mobile.portrait .mobileEnemyStrip .enemyHud{
  gap: calc(10 * var(--u)) !important;
  overflow-x: auto;
  padding-bottom: calc(6 * var(--u));
  justify-content: center;
}

body.mobile.portrait .enemyBanner.enemyCardWrap{ --enemyUi: 1.55; }

body.mobile.portrait .mobileHudRow{
  display: grid;
  gap: calc(10 * var(--u));
  align-items: start;
}

body.mobile.portrait .mobileHudRow,
body.mobile.portrait .mobileActionPanel,
body.mobile.portrait .mobileActionPanel *{
  pointer-events: auto !important;
}

body.mobile.portrait .playerHudLeft{
  width: 100% !important;
  max-width: none !important;
}

body.mobile.portrait .mobileActionPanel{
  width: 100%;
  padding: calc(14 * var(--u));
  border-radius: calc(16 * var(--u));
  border: calc(1 * var(--u)) solid rgba(255,255,255,.12);
  background: rgba(0,0,0,.22);
  box-sizing: border-box;
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: calc(8 * var(--u));
}

body.mobile.portrait .mobileActionPanel button{
  font-size: calc(18 * var(--u));
  padding: calc(10 * var(--u)) calc(12 * var(--u));
  border-radius: calc(14 * var(--u));
  width: 100%;
}

body.mobile.portrait .mobilePileButtons,
body.mobile.portrait .mobileChromeButtons,
body.mobile.portrait .mobileRunButtons{
  display: contents;
}

body.mobile.portrait .mobileActionPanel .mobileRunButtons button{
  grid-column: span 3;
}

/* Stage/main panel spacing: topHud is sticky now */
body.mobile.portrait .mainRow{
  padding-top: 0;
  padding-bottom: calc(var(--dockH) + calc(12 * var(--u)));
}

body.mobile.portrait .mainPanel{ min-height: 100vh; }
body.mobile.portrait .mainRow{ min-height: 100vh; }
body.mobile.portrait .combatRoot{
  display: flex;
  flex-direction: column;
  min-height: 0;
}
body.mobile.portrait .boardArea{
  flex: 1 1 auto;
  min-height: 0;
  transform: none;
  justify-content: flex-start;
  padding-top: calc(8 * var(--u));
  padding-bottom: calc(6 * var(--u));
}

/* Battle title row (=status bar + target hint) sits at the top of the board on mobile */
body.mobile.portrait .battleTitleRow{
  position: static;
  top: auto;
  z-index: auto;
  width: 100%;
  margin: 0 0 calc(10 * var(--u)) 0;
}

/* Item / Relic trays as left/right rails around the board */
body.mobile.portrait .itemTray{
  position: fixed;
  left: calc(var(--safeL) + calc(8 * var(--u)));
  top: calc(var(--safeT) + calc(330 * var(--u)));
  bottom: calc(var(--safeB) + var(--dockH) + calc(14 * var(--u)));
  z-index: var(--zChrome);
  overflow-y: auto;
  max-width: calc(96 * var(--u));
}

body.mobile.portrait .relicTray{
  position: fixed;
  right: calc(var(--safeR) + calc(8 * var(--u)));
  top: calc(var(--safeT) + calc(330 * var(--u)));
  bottom: calc(var(--safeB) + var(--dockH) + calc(14 * var(--u)));
  z-index: var(--zChrome);
  overflow: hidden;
  max-width: calc(104 * var(--u));
}

body.mobile.portrait .relicTrayList{
  height: 100%;
  overflow-y: auto;
}

/* Make sure the board doesn't hide behind rails */
body.mobile.portrait .boardArea{
  padding-left: calc(var(--boardPadX) + calc(90 * var(--u)));
  padding-right: calc(var(--boardPadX) + calc(94 * var(--u)));
}

/* í„°ì¹˜ ë””ë°”ì´ìŠ¤ì—ì„œ ìŠ¤í¬ë¡¤/ì¤Œ ì œìŠ¤ì²˜ ì¶©ëŒì„ ì¤„ìž„ */
body.mobile .hand{
  touch-action: pan-x;
}
body.mobile .handDock{
  touch-action: manipulation;
}

/* === Mobile portrait tweaks: bigger enemies + centered === */
body.mobile.portrait .mobileEnemyStrip{ display:flex; justify-content:center; }
body.mobile.portrait .mobileEnemyStrip .enemyHudCenterMover{ width:100% !important; display:flex; justify-content:center; }
body.mobile.portrait .enemyBanner.enemyCardWrap{ --enemyUi: 1.45; }
body.mobile.portrait .enemyArtCard{ width: calc(86% * var(--enemyUi)); }

/* === Mobile portrait tuning (v2) === */
body.mobile.portrait{
  --handCardW: min(calc(300 * var(--u)), calc((100vw - var(--safeL) - var(--safeR) - calc(24 * var(--u))) / 5));
  --handCardH: calc(var(--handCardW) * 7 / 5);
  --dockH: calc(var(--handCardH) + calc(24 * var(--u)));
}

body.mobile.portrait .mobileHudRow{
  grid-template-columns: auto 1fr !important;
  align-items: start;
}

body.mobile.portrait .playerHudLeft{
  width: auto !important;
  max-width: 46vw !important;
}

/* Rotate-like feel: wider button block, shorter height */
body.mobile.portrait .mobileActionPanel{
  display: grid !important;
  grid-template-columns: repeat(6, minmax(0, 1fr));
  gap: calc(8 * var(--u));
  align-content: start;
  padding: calc(12 * var(--u));
}

body.mobile.portrait .mobilePileButtons,
body.mobile.portrait .mobileChromeButtons,
body.mobile.portrait .mobileRunButtons{
  display: contents !important;
}

body.mobile.portrait .mobileActionPanel button{
  width: 100%;
  font-size: calc(16 * var(--u));
  padding: calc(10 * var(--u)) calc(10 * var(--u));
  border-radius: calc(14 * var(--u));
}

/* Let board/map reach right above the hand dock */
body.mobile.portrait .boardArea{
  flex: 1 1 auto;
  min-height: 0 !important;
  justify-content: flex-start;
  transform: translateY(var(--boardSlotOffsetY, calc(-12 * var(--u)))) !important;
  padding-bottom: 0;
}

/* === Mobile portrait tuning (round2 overrides; keep last) === */
body.mobile.portrait{
  --handCardW: calc(300 * var(--u));
  --handCardH: calc(var(--handCardW) * 7 / 5);
  --dockH: calc(var(--handCardH) + calc(26 * var(--u)));

  --enemyBannerW: calc(560 * var(--u));
}

body.mobile.portrait .enemyBanner.enemyCardWrap{ --enemyUi: 1.65; }

/* Mobile: keep main board directly above the hand dock */
body.mobile .mainRow{
  padding-bottom: var(--dockH) !important;
}

body.mobile .mainPanel.inCombat{
  padding-bottom: 0 !important;
}

body.mobile .boardArea{
  padding-bottom: 0 !important;
}

/* Mobile: keep battlefield background aspect ratio (avoid vertical stretch) */
body.mobile .mainPanel.inCombat::before{
  display: none !important;
  opacity: 0 !important;
  background: none !important;
}

body.mobile .mainPanel.inCombat .boardArea{
  background: transparent !important;
  border: 0 !important;
  border-radius: 0 !important;
}

/* Shared background behind front/back slot rows (common backdrop for 6 slots) */
.boardSlotsWrap{
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--slotRowGap);
}
.boardSlotsWrap::before{
  content: "";
  display: none;
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  width: min(calc((var(--slotW) * 4) + (var(--slotGap) * 3) + calc(28 * var(--u))), calc(100% - calc(12 * var(--u))));
  height: calc((var(--slotH) * 2) + var(--slotRowGap) + calc(18 * var(--u)));
  border: calc(1 * var(--u)) solid rgba(255,255,255,.10);
  background:
    radial-gradient(120% 90% at 50% 18%, rgba(255,255,255,.08) 0%, rgba(255,255,255,0) 48%),
    linear-gradient(180deg, rgba(22, 28, 40, .88), rgba(8, 12, 20, .92));
  box-shadow:
    inset 0 calc(10 * var(--u)) calc(20 * var(--u)) rgba(255,255,255,.04),
    inset 0 calc(-12 * var(--u)) calc(24 * var(--u)) rgba(0,0,0,.45),
    0 calc(12 * var(--u)) calc(28 * var(--u)) rgba(0,0,0,.35);
  pointer-events: none;
  z-index: 0;
}
body.mobile .boardSlotsWrap::before{
  display: block;
}
.boardSlotsWrap > *{
  position: relative;
  z-index: 1;
}

/* Mobile portrait: hand-dock anchored chained layout */
body.mobile.portrait{
  --mobileActionPanelDx: calc(0 * var(--u));
  --mobileActionPanelDy: calc(0 * var(--u));
  --mapNodeEmojiSize: calc(100 * var(--u));

  --handDockTop: calc(100vh - var(--safeB) - var(--dockH));

  --boardGapFromDock: calc(8 * var(--u));
  --boardH: calc(500 * var(--u));
  --boardSlotOffsetY: calc(0 * var(--u));

  --boardBottom: calc(100vh - var(--handDockTop) + var(--boardGapFromDock));
  --boardTop: calc(var(--handDockTop) - var(--boardGapFromDock) - var(--boardH));

  --hudRowH: calc(130 * var(--u));
  --hudRowGapFromBoard: calc(130 * var(--u));
  --hudRowTop: calc(var(--boardTop) - var(--hudRowGapFromBoard) - var(--hudRowH));

  --enemyRowH: calc(220 * var(--u));
  --enemyRowGapFromHud: calc(400 * var(--u));
  --enemyRowTop: calc(var(--hudRowTop) - var(--enemyRowGapFromHud) - var(--enemyRowH));

  --hudRowLeft: calc(var(--safeL) + var(--edgePad));
  --hudRowRight: calc(var(--safeR) + var(--edgePad));

  --stageCornerX: calc(var(--hudRowLeft) + calc(320 * var(--u)));
  --sHudLeft: calc(var(--hudRowLeft) + calc(520 * var(--u)));
  --sHudTop: var(--hudRowTop);
  --sHudOffX: calc(0 * var(--u));
  --sHudOffY: calc(0 * var(--u));
}

body.mobile.portrait .topHud{
  height: 0 !important;
  padding: 0 !important;
  background: transparent !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}

body.mobile.portrait .mobileHudRow{
  position: fixed;
  top: var(--hudRowTop);
  left: var(--hudRowLeft);
  right: var(--hudRowRight);
  z-index: var(--zChrome);
}

body.mobile.portrait .mobileActionPanel{
  position: relative;
  transform: translate(var(--mobileActionPanelDx), var(--mobileActionPanelDy));
  grid-template-columns: repeat(6, minmax(0, 1fr)) !important;
}

body.mobile.portrait .mobilePileButtons{
  display: grid !important;
  grid-row: 1;
  grid-column: 1 / -1;
  grid-template-columns: repeat(5, minmax(0, 1fr));
  gap: calc(8 * var(--u));
}
body.mobile.portrait .mobileChromeButtons{
  display: grid !important;
  grid-row: 2;
  grid-column: 1 / -1;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: calc(8 * var(--u));
}
body.mobile.portrait .mobileRunButtons{
  display: grid !important;
  grid-row: 2;
  grid-column: 1 / -1;
  grid-template-columns: minmax(0, 1fr);
  gap: calc(8 * var(--u));
}
body.mobile.portrait .mobileActionPanel .mobileRunButtons button{ grid-column: auto !important; }

body.mobile.portrait.shopChoiceOpen .mobilePileButtons{
  position: fixed;
  top: calc(var(--hudRowTop) + var(--hudRowH) + calc(8 * var(--u)));
  left: calc(var(--safeL) + var(--edgePad));
  right: calc(var(--safeR) + var(--edgePad));
  z-index: calc(var(--zChoicePanel) + 2);
  display: grid !important;
  grid-template-columns: repeat(5, minmax(0, 1fr));
  gap: calc(8 * var(--u));
  pointer-events: auto !important;
}

body.mobile.portrait .mobileEnemyLeftBtn,
body.mobile.portrait .mobileEnemyRightChrome{
  position: fixed;
  top: calc(var(--enemyRowTop) - calc(58 * var(--u)));
  z-index: var(--zChrome);
  display: flex;
  gap: calc(8 * var(--u));
  pointer-events: auto;
}
body.mobile.portrait .mobileEnemyLeftBtn{
  left: calc(var(--safeL) + var(--edgePad));
}
body.mobile.portrait .mobileEnemyRightChrome{
  right: calc(var(--safeR) + var(--edgePad));
}
body.mobile.portrait .mobileEnemyLeftBtn button,
body.mobile.portrait .mobileEnemyRightChrome button{
  font-size: calc(16 * var(--u));
  padding: calc(9 * var(--u)) calc(12 * var(--u));
  border-radius: calc(12 * var(--u));
}

body.mobile.portrait .mobileEnemyStrip{
  position: fixed;
  top: var(--enemyRowTop);
  left: 0;
  right: 0;
  z-index: var(--zChrome);
  pointer-events: auto !important;
}
body.mobile.portrait .mobileEnemyStrip .enemyHud,
body.mobile.portrait .mobileEnemyStrip .enemyBanner{
  pointer-events: auto !important;
}

body.mobile.portrait .boardArea{
  position: fixed;
  top: var(--boardTop);
  bottom: var(--boardBottom);
  left: calc(var(--safeL) + var(--boardPadX));
  right: calc(var(--safeR) + var(--boardPadX));
  transform: translateY(var(--boardSlotOffsetY)) !important;
  padding-bottom: 0 !important;
}

body.mobile.portrait .itemTray,
body.mobile.portrait .relicTray{
  top: var(--boardTop);
  bottom: var(--boardBottom);
}

body.mobile.portrait .relicTrayList{
  scrollbar-width: none;
  -ms-overflow-style: none;
}
body.mobile.portrait .relicTrayList::-webkit-scrollbar{ width: 0; height: 0; }

body.mobile.portrait .stageCornerHud{
  top: var(--hudRowTop) !important;
  left: var(--stageCornerX) !important;
  transform: translateX(0) translateY(0) !important;
  font-size: 150%;
}

body.mobile.portrait #hudSOnly{
  top: var(--sHudTop) !important;
  left: var(--sHudLeft) !important;
  transform: translate(var(--sHudOffX), var(--sHudOffY)) !important;
}

/* Mobile map node emoji size control */
html.mobile .mapNodeSelect .mapMiniScroller svg text,
body.mobile .mapNodeSelect .mapMiniScroller svg text{
  font-size: var(--mapNodeEmojiSize) !important;
}

body.mobile.portrait .mobileActionPanel button,
body.mobile.portrait .mobileEnemyLeftBtn button,
body.mobile.portrait .mobileEnemyRightChrome button{
  font-size: calc(20 * var(--u)) !important;
}

.mobileHandScrollBtn{
  display: none;
}

body.mobile .mobileHandScrollBtn{
  display: flex;
  align-items: center;
  justify-content: center;
  position: fixed;
  top: calc(100vh - var(--safeB) - (var(--dockH) / 2));
  transform: translateY(-50%);
  z-index: calc(var(--zHandDock) + 2);
  pointer-events: auto;
  font-size: calc(22 * var(--u));
  line-height: 1;
  padding: calc(8 * var(--u)) calc(10 * var(--u));
  border-radius: calc(12 * var(--u));
}

body.mobile .mobileHandScrollBtn-left{
  left: calc(var(--safeL) + calc(4 * var(--u)));
}

body.mobile .mobileHandScrollBtn-right{
  right: calc(var(--safeR) + calc(4 * var(--u)));
}

body.mobile .mapNodeSelect,
body.mobile .mapNodeSelect .nodeSelectHeader,
body.mobile .mapNodeSelect .nodeSelectHeaderRight button,
body.mobile .mapNodeSelect .mapDetailPanel,
body.mobile .mapNodeSelect .mapMiniOverlay{
  font-size: calc(18 * var(--u)) !important;
}

/* === Mobile portrait final layout: board image + slots + 3-column HUD row === */
body.mobile.portrait{
  --hudColGap: calc(10 * var(--u));
  --hudRowW: calc(100vw - var(--safeL) - var(--safeR) - (var(--edgePad) * 2));
  --hudColW: calc((var(--hudRowW) - (var(--hudColGap) * 2)) / 3);
  --hudCenterX: calc(var(--hudRowLeft) + var(--hudColW) + var(--hudColGap) + (var(--hudColW) / 2));
}

body.mobile.portrait .mainPanel.inCombat::before{
  position: fixed;
  top: var(--boardTop);
  bottom: var(--boardBottom);
  left: calc(var(--safeL) + var(--boardPadX));
  right: calc(var(--safeR) + var(--boardPadX));
  transform: none !important;
  display: none !important;
  opacity: 0 !important;
  background: none !important;
}

body.mobile .hand .card,
body.mobile .hand .card *,
body.mobile .slot .card,
body.mobile .slot .card *{
  -webkit-user-select: none;
  user-select: none;
  -webkit-touch-callout: none;
}

body.mobile .mapNodeSelect .mapMiniScroller svg path{
  stroke-width: calc(3.4 * var(--u)) !important;
}

body.mobile .mapNodeSelect .mapMiniScroller svg circle{
  stroke-width: calc(6.8 * var(--u)) !important;
}

body.mobile.portrait .mobileHudRow{
  display: grid !important;
  grid-template-columns: minmax(0, 1fr) minmax(0, 1fr) minmax(0, 1fr) !important;
  column-gap: var(--hudColGap);
  align-items: start;
}

body.mobile.portrait .mobileHudRow > .playerHudLeft{
  grid-column: 1;
  position: static !important;
  left: auto !important;
  top: auto !important;
  width: 86% !important;
  max-width: none !important;
  font-size: 100% !important;
  justify-self: start;
}

body.mobile.portrait .mobileHudRow > .mobileActionPanel{
  grid-column: 3;
  width: 100%;
}

body.mobile.portrait .stageCornerHud{
  top: calc(var(--hudRowTop) + calc(2 * var(--u))) !important;
  left: var(--hudCenterX) !important;
  transform: translateX(-50%) translateY(0) !important;
}

body.mobile.portrait #hudSOnly{
  top: calc(var(--hudRowTop) + calc(58 * var(--u))) !important;
  left: var(--hudCenterX) !important;
  transform: translateX(-50%) translateY(150%)!important;
  z-index: var(--zChrome) !important;
  display: flex !important;
}

body.mobile .combatControls{
  left: 50% !important;
  right: auto !important;
  transform: translateX(-50%) !important;
  bottom: calc(var(--safeB) + var(--dockH) + calc(8 * var(--u))) !important;
  z-index: var(--zChrome) !important;
}

/* Mobile: make choice/reward overlays larger and more readable */
body.mobile .choice-padWrap{
  padding: calc(72 * var(--u)) calc(36 * var(--u)) calc(10 * var(--u)) calc(16 * var(--u)) !important;
}

body.mobile .choice-panel{
  width: min(calc(800 * var(--u)), 96vw) !important;
  max-height: 96vh !important;
  height: auto !important;
  overflow-y: auto !important;
  overflow-x: hidden !important;
  padding: calc(20 * var(--u)) !important;
}

body.mobile .choice-panel > h2{
  font-size: calc(30 * var(--u)) !important;
  margin-bottom: calc(10 * var(--u)) !important;
}

body.mobile .choice-panel > p{
  font-size: calc(30 * var(--u)) !important;
  line-height: 1.4 !important;
  margin-bottom: calc(14 * var(--u)) !important;
}

body.mobile .choice-panel .choice-item{
  padding: calc(16 * var(--u)) !important;
  gap: calc(14 * var(--u)) !important;
}

body.mobile .choice-panel pre.choice-detail,
body.mobile .choice-panel .choice-detail{
  font-size: calc(30 * var(--u)) !important;
  line-height: 1.45 !important;
}

body.mobile .choice-panel button,
body.mobile .choice-panel .choiceOptBtn{
  font-size: calc(30 * var(--u)) !important;
  padding: calc(12 * var(--u)) calc(16 * var(--u)) !important;
}

/* Mobile item UIs: bigger and top-to-bottom flow */
body.mobile.portrait :is(#itemTray, .itemTray){
  grid-template-columns: repeat(1, calc(98 * var(--u))) !important;
  grid-auto-rows: calc(98 * var(--u)) !important;
  gap: calc(10 * var(--u)) !important;
  max-width: calc((98 * var(--u)) + (var(--trayPad) * 2)) !important;
}

body.mobile.portrait :is(#itemTray, .itemTray) :is(.itemSlot, .itemCell, .itemCard){
  width: calc(98 * var(--u)) !important;
  height: calc(98 * var(--u)) !important;
}

body.mobile.portrait .itemCapHud .itemCapBadge{
  font-size: calc(15 * var(--u));
  padding: calc(5 * var(--u)) calc(9 * var(--u));
}

body.mobile .choice-rewardItemRow{
  flex-direction: column !important;
  align-items: center !important;
  gap: calc(14 * var(--u)) !important;
}

body.mobile .itemOfferCard{
  width: calc(220 * var(--u)) !important;
}

body.mobile .shopBottomRow{
  flex-direction: row;
  align-items: flex-start;
  justify-content: space-between;
  gap: calc(14 * var(--u));
  width: 100%;
}

body.mobile .shopItemsCol{ flex: 1 1 auto; min-width: 0; }
body.mobile .shopSvcCol{ flex: 0 0 auto; }

body.mobile .shopItemsGrid{
  display: grid;
  grid-template-columns: minmax(0, 1fr);
  gap: calc(12 * var(--u));
  justify-items: center;
}

body.mobile .shopItemTile{
  width: calc(120 * var(--u));
}

body.mobile .shopItemTile img{
  width: calc(80 * var(--u));
  height: calc(80 * var(--u));
}

body.mobile .shopSvcNote{
  font-size: calc(20 * var(--u));
  line-height: 1.3;
}

body.mobile .shopTilePrice{
  font-size: calc(24 * var(--u));
}

body.mobile .cardHoverPreview.previewAtBattlefield{
  right: auto !important;
  left: 50% !important;
  top: calc(var(--enemyRowTop) + calc(8 * var(--u))) !important;
  transform: translateX(-50%) !important;
  width: min(calc(500 * var(--u)), calc(100vw - var(--safeL) - var(--safeR) - calc(16 * var(--u)))) !important;
}

/* Mobile shop: hide illustration panel and tone down card size */
body.mobile .choice-panel.shopPanel .choice-illuCol{
  display: none !important;
}

body.mobile .choice-panel.shopPanel .shopContentRow{
  justify-content: center;
}

body.mobile .choice-panel.shopPanel .shopLeftCol{
  max-width: 100%;
}

body.mobile .choice-panel.shopPanel .shopCardsGrid{
  grid-template-columns: repeat(3, calc(var(--handCardW) * 0.96));
  gap: calc(10 * var(--u));
}

body.mobile .choice-panel.shopPanel .shopCardsGrid .card,
body.mobile .choice-panel.shopPanel .shopCardsGrid .overlayCard,
body.mobile .choice-panel.shopPanel .shopCardsGrid .choicePickCard{
  width: calc(var(--handCardW) * 0.96) !important;
  height: calc(var(--handCardH) * 0.96) !important;
}



/* Mobile: unify card size in all choice/reward/upgrade/remove overlays */
body.mobile :is(
  .choice-overlay,
  .choice-panel,
  .overlay-panel,
  .pileView,
  .shopCardsGrid,
  .choice-rewardCardRow,
  .upgradePair
) .card,
body.mobile :is(
  .choice-overlay,
  .choice-panel,
  .overlay-panel,
  .pileView,
  .shopCardsGrid,
  .choice-rewardCardRow,
  .upgradePair
) .overlayCard,
body.mobile :is(
  .choice-overlay,
  .choice-panel,
  .overlay-panel,
  .pileView,
  .shopCardsGrid,
  .choice-rewardCardRow,
  .upgradePair
) .choicePickCard{
  width: calc(var(--handCardW) * 1.12) !important;
  height: calc(var(--handCardH) * 1.12) !important;
  --cardInnerMul: var(--handTextMul, 1);
}

/* Mobile: battle card reward cards should be slightly smaller, with proportional content */
body.mobile .choice-rewardCardRow :is(.card, .overlayCard, .choicePickCard){
  width: calc(var(--handCardW) * 0.94) !important;
  height: calc(var(--handCardH) * 0.94) !important;
  --cardInnerMul: calc(var(--handTextMul, 1) * 0.94) !important;
}

body.mobile.portrait .mobileEnemyStrip.enemyCount3 .enemyHud{
  gap: calc(var(--enemyHudW) * 0.52) !important;
  align-items: flex-start !important;
}

body.mobile.portrait .mobileEnemyStrip.enemyCount2 .enemyHud{
  gap: calc(var(--enemyHudW) * 0.40) !important;
  align-items: flex-start !important;
}

body.mobile.portrait .mobileEnemyStrip.enemyCount3 .enemyBanner.enemyCardWrap{
  align-self: flex-start !important;
  margin-top: 0 !important;
}

body.mobile.portrait .mobileEnemyStrip.enemyCount2 .enemyBanner.enemyCardWrap{
  align-self: flex-start !important;
  margin-top: 0 !important;
}

/* Mobile: keep enemy illustration/card size fixed by viewport (do not react to intent text size) */
body.mobile.portrait{
  --mobileEnemyCardW: clamp(calc(210 * var(--u)), min(31vw, 26vh), calc(300 * var(--u)));
  --mobileEnemyArtW: calc(var(--mobileEnemyCardW) * 0.80);
  --mobileEnemyHudW: calc(var(--mobileEnemyCardW) * 0.80);
}

body.mobile.portrait .mobileEnemyStrip .enemyBanner.enemyCardWrap{
  width: var(--mobileEnemyCardW) !important;
  min-width: var(--mobileEnemyCardW) !important;
  max-width: var(--mobileEnemyCardW) !important;
  flex: 0 0 var(--mobileEnemyCardW) !important;
  --enemyUi: 1 !important;
}

body.mobile.portrait .mobileEnemyStrip .enemyArtCard{
  width: var(--mobileEnemyArtW) !important;
}

body.mobile.portrait .mobileEnemyStrip .enemyMiniHud{
  width: var(--mobileEnemyHudW) !important;
}

/* Mobile shop: make cards noticeably smaller (final override) */
body.mobile .choice-panel.shopPanel .shopCardsGrid{
  grid-template-columns: repeat(3, calc(var(--handCardW) * 0.80)) !important;
}

body.mobile .choice-panel.shopPanel .shopCardsGrid :is(.card, .overlayCard, .choicePickCard){
  width: calc(var(--handCardW) * 0.80) !important;
  height: calc(var(--handCardH) * 0.80) !important;
  --cardInnerMul: calc(var(--handTextMul, 1) * 0.92) !important;
}

/* While shop is open: keep status bar fixed at very top for gold check */
body.mobile.portrait.shopChoiceOpen .stageCornerHud,
body.mobile.shopChoiceOpen .stageCornerHud{
  top: calc(var(--safeT) + calc(4 * var(--u))) !important;
  left: 50% !important;
  right: auto !important;
  transform: translateX(-50%) translateY(0) !important;
  z-index: calc(var(--zRelicHud) + 120) !important;
}

/* While shop is open: card hover preview should render above shop overlay */
body.shopChoiceOpen .cardHoverPreview{
  z-index: calc(var(--zRelicHud) + 130) !important;
}
